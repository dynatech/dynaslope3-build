(this["webpackJsonpmia-3.0"]=this["webpackJsonpmia-3.0"]||[]).push([[0],{10:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return r}));const n="http://192.168.150.253:5000",l="http://192.168.150.253",r=15e5},1055:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),r=a(20),c=a.n(r),i=(a(636),a(25)),o=a(2),s=a(37),m=a(56),d=a(8),u=a(3),p=a(154),b=a(1087),g=a(321),E=a(412),f=a(1086),h=a(107),_=a(377),y=a(350),v=a(47),O=a(74),x=a(1089),j=a(22),k=a(204),S=a.n(k),C=a(584),w=a.n(C);function D(){return l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",l.a.createElement(f.a,{color:"inherit",href:"https://material-ui.com/"},"Project Dynaslope")," ",(new Date).getFullYear(),".")}const A=Object(O.a)(e=>({root:{height:"100vh"},image:{backgroundImage:"url(".concat(w.a,")"),backgroundSize:"cover",backgroundPosition:"center"},paperContainer:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{margin:e.spacing(0,4),display:"flex",flexDirection:"column",alignItems:"center",paddingBottom:e.spacing(5),[e.breakpoints.up("lg")]:{paddingBottom:e.spacing(9)}},phivolcsDynaslopeLogo:{margin:e.spacing(1),height:200,[e.breakpoints.between("sm","md")]:{height:164},[e.breakpoints.only("xs")]:{height:140}},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},title:{margin:e.spacing(2,0),[e.breakpoints.down("sm")]:{fontSize:"1.25rem"},[e.breakpoints.only("xs")]:{margin:e.spacing(0,0)}},passwordField:{margin:e.spacing(0,0,3,0),[e.breakpoints.only("xs")]:{margin:e.spacing(0,0,1,0)}},buttonChild:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"}}));function I(e){const t=A(),a=Object(n.useState)({username:"",password:""}),r=Object(o.a)(a,2),c=r[0],i=r[1],s=Object(n.useState)({username:!1,password:!1}),m=Object(o.a)(s,2),d=m[0],f=m[1],O=Object(n.useState)(""),k=Object(o.a)(O,2),C=k[0],w=k[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=e.history,R=e.onLogin,H=()=>{Object.entries(c).forEach(e=>{const t=Object(o.a)(e,2),a=t[0],n=t[1];""===n&&U(a,n)}),Object.values(d).includes(!0)?w("Fill up all required fields"):(N(!0),Object(j.c)(c,()=>{N(!1),R(),Y.push("/")},e=>{N(!1),w(e)}))},B=c.username,P=c.password,L=e=>t=>{const a=t.target.value;i(Object(u.a)(Object(u.a)({},c),{},{[e]:a})),w(""),U(e,a)},F=e=>t=>{U(e,c[e])},U=(e,t)=>{f(Object(u.a)(Object(u.a)({},d),{},{[e]:""===t}))};return l.a.createElement(y.a,{container:!0,component:"main",className:t.root},l.a.createElement(b.a,null),l.a.createElement(y.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),l.a.createElement(y.a,{item:!0,xs:12,sm:8,md:5,component:h.a,elevation:6,square:!0,className:t.paperContainer},l.a.createElement("div",{className:t.paper},l.a.createElement("img",{src:S.a,alt:"PHIVOLCS-Dynaslope Logo",className:t.phivolcsDynaslopeLogo}),l.a.createElement(v.a,{component:"h1",variant:"h5",align:"center",className:t.title},l.a.createElement("strong",null,"MONITORING AND INFORMATION APPLICATION (MIA 3.0)")),l.a.createElement("div",{className:t.form},l.a.createElement(g.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:B,onChange:L("username"),onFocus:F("username"),error:d.username}),l.a.createElement(g.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:P,onChange:L("password"),onKeyPress:e=>{"Enter"===e.key&&H()},onFocus:F("password"),error:d.password,className:t.passwordField}),""!==C&&l.a.createElement(E.a,{error:!0,focused:!0},C),l.a.createElement(p.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:H,disabled:T},T?l.a.createElement("div",{className:t.buttonChild},l.a.createElement("span",{style:{marginRight:6}},"Signing In... "),l.a.createElement(x.a,{color:"secondary",size:20})):l.a.createElement("span",null,"Sign In")),l.a.createElement(_.a,{mt:5},l.a.createElement(D,null))))))}var M=a(1090),T=a(328);var N=Object(d.a)(e=>({footer:{display:"flex",padding:"2% 0",flexDirection:"column",marginTop:40,justifyContent:"center",alignItems:"center",textAlign:"center",[e.breakpoints.down("sm")]:{marginTop:30},zIndex:0},footerText:{fontSize:"0.5rem",[e.breakpoints.up("sm")]:{fontSize:"0.85rem"}}}))((function(e){const t=e.classes;return l.a.createElement(M.a,{position:"static",className:t.footer},l.a.createElement(T.a,null,l.a.createElement(v.a,{variant:"subtitle2",color:"inherit",className:t.footerText},"4F PHIVOLCS Building, C. P. Garcia Avenue, UP Campus, Diliman, Quezon City 1101 ",l.a.createElement("br",null),"Tel. no. (02) 8426-1468 loc. 401 & 403 | dynaslope.phivolcs@gmail.com ",l.a.createElement("br",null),"www.facebook.com/dynaslopecommunity")))})),Y=a(211),R=a(1097),H=a(586),B=a(494),P=a(618),L=a(622),F=a(1096),U=a(1098),z=a(1065),W=a(1066),G=a(1091),q=a(1092),V=a(621),Q=a(1093),Z=a(1094),K=a(1095),J=a(7),X=a.n(J),$=a(81),ee=a(10),te=a(15),ae=a.n(te);function ne(e,t=!0,a="end"){const n=e.purok,l=e.sitio,r=e.barangay,c=e.municipality,i=e.province,o=e.site_code;let s="";if(null!==l&&""!==l&&(s="Sitio ".concat(l,", ")),null!==n&&""!==n&&(s+="Purok ".concat(n,", ")),s+="Brgy. ".concat(r,", ").concat(c,", ").concat(i),t){const e=o.toUpperCase();"end"===a?s+=" (".concat(e,")"):s="".concat(e," (").concat(s,")")}return s}function le(e,t=!1){const a=e=>e.charAt(0).toUpperCase()+e.slice(1);if(t){return e.split(" ").map(e=>a(e)).join(" ")}return a(e)}function re(e,t=!1){let a=null;const n=e.map(e=>{const n=e.site,l=e.org_name;return a=l.toUpperCase(),t?n:n.site_code.toUpperCase()});return t?{sites:n,org:a}:(a&&n.unshift(a),n)}function ce(e){let t=!1;return e.length>0&&(t=Boolean(e[0].primary_contact)),t}function ie(e){return"0"===e[0]||e.match(/[a-z]/i)?e:"+".concat(e)}function oe(e,t=7,a="days"){if("all"===a)return"None";return e.clone().subtract(t,a).format("YYYY-MM-DD HH:mm:ss")}function se(e,t,a=null,n=null){ae.a.post(e,t).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e),null!==n&&n(e)})}function me(e,t=null){ae.a.get(e).then(e=>{const a=e.data;null!==t&&t(a)}).catch(e=>{console.log(e)})}function de(e){const t=["january","february","march","april","may","june","july","august","september","october","november","december"];e.sort((e,a)=>t.indexOf(e)-t.indexOf(a))}const ue=Object(n.createContext)(),pe=({children:e})=>{const t=Object(n.useReducer)((function(e,t){const a=t.action,n=t.data,l=e.notifications;switch(a){case"INSERT":return Object(u.a)({},n);case"UPDATE_COUNT":return Object(u.a)(Object(u.a)({},e),{},{count:n});case"UPDATE_NOTIFICATION":const t=n.notification_id,a=n.value,r=[...l],c=r.findIndex(e=>e.notification_id===t);return r[c].ts_read=a,Object(u.a)(Object(u.a)({},e),{},{notifications:r});default:return e}}),{notifications:[],count:0}),a=Object(o.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)(()=>{Object($.c)(),Object($.f)(e=>c({action:"INSERT",data:e}))},[]);const i={notifications_object:r,setNotificationsObject:c,setNotificationCountToZero:function(e){c({action:"UPDATE_COUNT",data:0}),function(e){se("".concat(ee.b,"/api/notifications/set_all_seen_notifications"),{user_id:e})}(e),Object($.f)(e=>c({action:"INSERT",data:e}))},toggleReadTS:function(e,t,a){const n="read"===a?X()().format("YYYY-MM-DD HH:mm:ss"):null;c({action:"UPDATE_NOTIFICATION",data:{notification_id:t,value:n}}),function(e,t,a){se("".concat(ee.b,"/api/notifications/update_ts_read"),{user_id:e,notification_id:t,ts_read:a})}(e,t,n)},getUserNotifications:$.c};return l.a.createElement(ue.Provider,{value:i},e)},be=Object(O.a)(e=>({divider:{margin:"16px 0"},sectionHead:{marginBottom:12},cardSection:{marginBottom:12},card:{marginBottom:8},cardUnread:{backgroundColor:"lightgray"},cardContent:{paddingBottom:"16px !important",display:"flex",justifyContent:"space-between",alignItems:"center"},toggleReadIcon:{marginLeft:8},notifTS:{marginTop:8},noNotifs:{display:"flex",padding:48,justifyContent:"center",border:"1px solid lightgray"}})),ge=l.a.memo(e=>{const t=e.classes,a=e.details,n=e.toggleNotifStatus,r=e.goToLink,c=a.notification_id,i=a.message,o=a.ts_read,s=a.ts,m=a.link,d=o?"unread":"read";return l.a.createElement(G.a,{variant:"outlined",className:"".concat(t.card," ").concat(o?"":t.cardUnread)},l.a.createElement(q.a,{className:t.cardContent,component:_.a},l.a.createElement(_.a,null,l.a.createElement(v.a,{variant:"body2",component:"div"},i),l.a.createElement(v.a,{variant:"caption",component:"div",className:t.notifTS},X()(s).format("D MMMM YYYY, HH:mm"))),l.a.createElement(_.a,{align:"right",className:t.toggleReadIcon},m&&l.a.createElement(Y.a,{"aria-label":"go-to-link",color:"primary",disableRipple:!0,disableFocusRipple:!0,edge:"end",size:"small",onClick:r(m,c,!o),title:"Go to link"},l.a.createElement(Q.a,null)),l.a.createElement(Y.a,{"aria-label":"toggle-notif-status",color:"primary",disableRipple:!0,disableFocusRipple:!0,edge:"end",size:"small",onClick:n(c,d),title:"Mark as ".concat(d)},o?l.a.createElement(Z.a,null):l.a.createElement(K.a,null)))))});var Ee=function(e){const t=e.history,a=e.handleCloseNotif,r=be(),c=Object(j.a)().user_id,i=Object(n.useContext)(ue),s=i.notifications_object,m=i.toggleReadTS,d=s.notifications,u=Object(n.useState)(1),b=Object(o.a)(u,2),g=b[0],E=b[1],f=[],h=[];d.forEach(e=>{null===e.ts_read?f.push(e):h.push(e)});const y=h.slice(0,10*g),O=h.length>10*g,x=0!==f.length,k=l.a.useCallback((e,t)=>()=>{m(c,e,t)},[]),S=(e,n,l)=>()=>{a(),t.push(e),l&&m(c,n,"read")};return l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{variant:"h4"},"Notifications"),l.a.createElement(V.a,{className:r.divider}),l.a.createElement(_.a,{display:"flex",justifyContent:"space-between",alignItems:"baseline"},l.a.createElement(v.a,{variant:"h6",className:r.sectionHead},"Unread notifications"),x&&l.a.createElement(p.a,{color:"primary",onClick:()=>{f.forEach(e=>{const t=e.notification_id;m(c,t,"read")})}},"Mark all as read")),l.a.createElement("div",{className:r.cardSection},x?f.map(e=>l.a.createElement(ge,{classes:r,details:e,key:e.notification_id,toggleNotifStatus:k,goToLink:S})):l.a.createElement(v.a,{variant:"body1",component:"div",className:r.noNotifs},"No unread notifications")),l.a.createElement(v.a,{variant:"h6",className:r.sectionHead,style:{marginTop:24}},"Previous notifications"),l.a.createElement("div",{className:r.cardSection},0===y.length?l.a.createElement(v.a,{variant:"body1",component:"div",className:r.noNotifs},"No previous notifications"):y.map(e=>l.a.createElement(ge,{classes:r,details:e,key:"notification-".concat(e.notification_id),toggleNotifStatus:k,goToLink:S}))),l.a.createElement(_.a,{display:"flex",justifyContent:"space-between",alignItems:"baseline"},O&&l.a.createElement(p.a,{color:"primary",onClick:()=>E(g+1)},"Load more previous notifications...")))},fe=a(24);const he=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(fe.d)(e)),{},{root:{width:"100%"},grow:{flexGrow:1},menuButton:{display:"flex",marginLeft:-12,marginRight:0,[e.breakpoints.up("md")]:{display:"none"}},projectTitle:{display:"block",fontWeight:900},titleBlock:{display:"block",margin:"0 4px",alignItems:"center",textAlign:"center",justifyContent:"center"},projectSubtitle:{display:"none",fontSize:"0.7rem",marginTop:-3,[e.breakpoints.up("md")]:{display:"block"}},logo:{marginRight:12,[e.breakpoints.down("sm")]:{marginRight:0}},sectionDesktop:{display:"none",[e.breakpoints.up("md")]:{display:"flex",padding:"4px 0"}},list:{width:250},menu:{marginTop:40},icon:{paddingRight:e.spacing(2)},paper:{position:"fixed",right:0,width:"45vw",[e.breakpoints.down("sm")]:{width:"55vw"},[e.breakpoints.up("lg")]:{width:"40vw"},height:"100vh",zIndex:1300,padding:24,overflowY:"auto",boxSizing:"border-box"},backdrop:{zIndex:1299}}));var _e=function(e){const t=e.drawerHandler,a=e.history,r=e.onLogout,c=Object(n.useState)(null),i=Object(o.a)(c,2),s=i[0],m=i[1],d=he(),u=()=>{m(null)},b=Object(j.a)(),g=b.user_id,E=b.first_name,f=Object(n.useContext)(ue),_=f.notifications_object,y=f.setNotificationCountToZero,O=f.getUserNotifications,x=_.count,k=Object(n.useState)(!1),C=Object(o.a)(k,2),w=C[0],D=C[1],A=()=>{D(!1),document.body.style.overflow="auto",y(g),console.log("notifications_object close",_)};return l.a.createElement("div",{className:d.root},l.a.createElement(M.a,{position:"fixed",color:"primary"},l.a.createElement(T.a,null,l.a.createElement(Y.a,{onClick:t(!0),className:d.menuButton,color:"inherit","aria-label":"Open drawer"},l.a.createElement(F.a,null)),l.a.createElement("img",{src:S.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(d.phivolcsDynaslopeLogo," ").concat(d.logo," ").concat(d.sectionDesktop)}),l.a.createElement("div",{className:d.titleBlock},l.a.createElement(v.a,{className:d.projectTitle,variant:"h4",color:"inherit",noWrap:!0},"MIA 3.0"),l.a.createElement(v.a,{variant:"caption",className:d.projectSubtitle,color:"inherit"},"Monitoring and Information Application")),l.a.createElement("div",{className:d.grow}),l.a.createElement("div",{className:d.sectionDesktop},l.a.createElement(Y.a,{color:"inherit",onClick:()=>{D(!0),document.body.style.overflow="hidden",O(),console.log("notifications_object open",_)}},l.a.createElement(R.a,{badgeContent:x,color:"secondary"},l.a.createElement(U.a,null))),l.a.createElement(p.a,{"aria-owns":"menu-list-grow","aria-haspopup":"true",onClick:e=>{m(e.currentTarget)},color:"inherit",startIcon:l.a.createElement(z.a,null)},l.a.createElement("strong",null,E))))),l.a.createElement(H.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:u,className:d.menu},l.a.createElement(B.a,{onClick:()=>{a.push("/profile"),u()}},l.a.createElement(z.a,{className:d.icon})," Profile"),l.a.createElement(B.a,{onClick:()=>{Object(j.d)(()=>{r(),a.push("/login")})}},l.a.createElement(W.a,{className:d.icon})," Logout")),l.a.createElement(P.a,{direction:"left",in:w,mountOnEnter:!0},l.a.createElement(h.a,{elevation:4,className:d.paper},l.a.createElement(Ee,{history:a,handleCloseNotif:A}))),l.a.createElement(L.a,{open:w,className:d.backdrop,onClick:A}))},ye=a(1079),ve=a(625),Oe=a(1071),xe=a(251),je=a(620),ke=a(1063),Se=a(194),Ce=a(587),we=a(147);const De=Object(O.a)(e=>({navBar:{display:"none",[e.breakpoints.up("md")]:{display:"block"}},appBar:{top:70},popper:{zIndex:500,marginTop:2},list:{width:250},link:{textDecoration:"none",color:"blue"}})),Ae=[{key:"monitoring",main:"Monitoring",sub:[{label:"Dashboard",link:"/"},{label:"Events Table",link:"/monitoring/events"},{label:"Shifts and Reports",link:"/monitoring/shifts_and_reports"},{label:"Issues and Reminders",link:"/monitoring/issues_and_reminders"},{label:"Site Logs",link:"/monitoring/logs"},{label:"Quality Assurance",link:"/monitoring/qa"}]},{key:"analysis",main:"Analysis",sub:[{label:"Site Data Analytics",link:"/analysis/sites"},{label:"Communications Analytics",link:"/analysis/communications",soon:!0},{label:"Monitoring Alerts Analytics",link:"/analysis/alerts"},{divider:!0},{label:"Loggers and Sensors Form",link:"/analysis/forms/loggers_and_sensors"}]},{key:"communication",main:"Communication",sub:[{label:"Chatterbox",link:"/communication/chatterbox"},{label:"Contacts",link:"/communication/contacts"},{label:"Mailbox",link:"/communication/mailbox"}]},{key:"community",main:"Community",sub:[{label:"Site Information",link:"/community/site_info"},{label:"Stakeholders' Concerns",link:"/community/concerns",soon:!0},{label:"Community Feedback",link:"/community/feedback",soon:!0}]},{key:"knowledge",main:"Knowledge Management",sub:[{label:"Protocols",link:"/knowlegde/protocols",soon:!0},{label:"Papers",link:"/knowledge/papers",soon:!0}]}];var Ie=l.a.memo(Object(Se.a)()((function(e){const t=e.width,a=e.drawerHandler,r=e.drawer,c=e.history,i=e.onLogout,m=De(),d=window.location.pathname.split("/")[1],u=Ae.findIndex(e=>e.key===d),p=Object(n.useState)(-1===u?0:u),b=Object(o.a)(p,2),g=b[0],E=b[1],f=Object(n.useState)(null),_=Object(o.a)(f,2),O=_[0],x=_[1],j=Object(n.useState)(null),k=Object(o.a)(j,2),S=k[0],C=k[1],w=Object(n.useState)(!1),D=Object(o.a)(w,2),A=D[0],I=D[1],T=Object(n.useState)(null),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useContext)(we.a).server_time,P=Ae[g===O&&null!==S?S:g].sub;Object(n.useEffect)(()=>{C(g)},[g]);const L=e=>{const t=g;I(!0),R(e.currentTarget),x(t)},F=e=>{Y.contains(e.target)||(I(!1),setTimeout(()=>E(O),100))},U=e=>{I(!1)};return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:m.navBar},l.a.createElement(M.a,{position:"fixed",color:"default",className:m.appBar},l.a.createElement(y.a,{container:!0,spacing:0,alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:10},l.a.createElement(ye.a,{value:g,onChange:(e,t)=>{E(t)},indicatorColor:"primary",textColor:"primary",variant:Object(Se.c)("md",t)?"standard":"scrollable",scrollButtons:"on",centered:Object(Se.c)("md",t)},Ae.map(({main:e,key:t})=>l.a.createElement(ve.a,{key:t,label:e,"aria-owns":A?"monitoring-menu":null,"aria-haspopup":"true",onClick:L})))),l.a.createElement(y.a,{item:!0,xs:2,align:"center"},l.a.createElement(v.a,{variant:"button"},H?X()(H).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time..."))))),l.a.createElement(Oe.a,{className:m.popper,open:A,anchorEl:Y,transition:!0,disablePortal:!0},({TransitionProps:e,placement:t})=>l.a.createElement(xe.a,Object.assign({},e,{id:"monitoring-menu",style:{transformOrigin:"bottom"===t?"center top":"center bottom"}}),l.a.createElement(h.a,null,l.a.createElement(je.a,{onClickAway:F},l.a.createElement(ke.a,null,P.map((e,t)=>{const a=e.label,n=e.link,r=e.soon,c=e.divider,i="undefined"!==typeof r;return i?l.a.createElement(B.a,{key:a,onClick:U,disabled:i},a,i&&l.a.createElement(v.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")):"undefined"!==typeof c?l.a.createElement(B.a,{key:t,divider:!0,button:!1,style:{paddingTop:2,marginBottom:8}}):l.a.createElement(s.b,{to:n,key:a,className:m.link},l.a.createElement(B.a,{onClick:U},a))})))))),l.a.createElement(Ce.a,{drawer:r,drawerHandler:a,navigationLabels:Ae,history:c,onLogout:i}))}))),Me=a(1205),Te=a(1113),Ne=a(1114),Ye=a(1115),Re=a(1137),He=a(1136),Be=a(1118),Pe=a(1069),Le=a(1138),Fe=a(1208),Ue=a(1139);var ze=Object(d.a)(e=>({pageTitleContainer:{margin:"24px 0 18px",[e.breakpoints.down("sm")]:{margin:"10px 0 10px"}},pageTitle:{fontSize:"0.85rem"},hasCustomButtons:{display:"flex",alignItems:"baseline",justifyContent:"space-between",paddingTop:12,paddingBottom:12}}))((function({title:e,classes:t,customButtons:a}){const n=void 0!==a&&a;let r=t.pageTitleContainer;return n&&(r+=" ".concat(t.hasCustomButtons)),l.a.createElement("div",{className:r},l.a.createElement(v.a,{variant:"overline",className:t.pageTitle},e),a)})),We=a(1099);const Ge=e=>{e.preventDefault()};function qe(e){return l.a.createElement(ve.a,Object.assign({component:"a",onClick:Ge},e))}var Ve=Object(d.a)(e=>({root:{flexGrow:1}}))((function(e){const t=e.chosenTab,a=e.onSelect,n=e.tabsArray,r=e.classes;return l.a.createElement(We.a,null,l.a.createElement(M.a,{position:"static",color:"default",className:r.root},l.a.createElement(ye.a,{variant:"fullWidth",value:t,onChange:(e,t)=>{a(t)}},n.map(e=>{const t=e.label,a=e.href;return l.a.createElement(qe,{label:t,href:a,key:a})}))))})),Qe=a(65),Ze=a(1116),Ke=a(419),Je=a(1117),Xe=a(1119),$e=a(1120),et=a(1121),tt=a(1122),at=a(1123),nt=a(1124),lt=a(1072),rt=a(1101),ct=a(1073),it=a(1102),ot=a(410),st=a(495),mt=a(496),dt=a(1204),ut=a(1074),pt=a(1103),bt=a(205),gt=a.n(bt);let Et;function ft(){"undefined"!==typeof Et&&null!==Et||(Et=gt()("".concat(ee.b,"/monitoring"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function ht(e){ft(),Et.on("reconnecting",()=>{e(!0)}),Et.on("reconnect",()=>{e(!1)}),Et.on("reconnect_failed",()=>{console.log("failed")})}function _t(e,t=null){ft(),console.log("Payload: { key: data }",e,t);const a={data:t,key:e};Et.send(a)}function yt(){Et.close(),Et=null}function vt(e){ft(),Et.on("receive_alerts_from_db",t=>{const a=JSON.parse(t);console.log("Alerts from DB: ",a),e(a)})}var Ot=Object(pt.a)()(e=>{const t=e.isShowing,a=e.hide,r=e.data,i=e.isValidating,s=r.site,m=r.trigger_id,d=r.ts_updated,u=Object(n.useState)(""),b=Object(o.a)(u,2),E=b[0],f=b[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),y=_[0],v=_[1],O=Object(j.a)();O.user_id;function x(){a(),f(""),v("")}const k=""===E;return t?c.a.createPortal(l.a.createElement(n.Fragment,null,l.a.createElement(lt.a,{open:!0,onClose:x,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Validate Trigger"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Select whether trigger is valid or invalid. Also, provide remarks."),l.a.createElement(ot.a,{component:"fieldset",style:{display:"flex"}},l.a.createElement(st.a,{"aria-label":"trigger_validity",name:"trig_validity_1",row:!0,style:{justifyContent:"space-around"},value:E,onChange:function(e){const t=Number.parseInt(e.target.value,10);f(t)}},l.a.createElement(mt.a,{value:1,control:l.a.createElement(dt.a,null),label:"Valid"}),!i&&l.a.createElement(mt.a,{value:0,control:l.a.createElement(dt.a,null),label:"Validating"}),l.a.createElement(mt.a,{value:-1,control:l.a.createElement(dt.a,null),label:"Invalid"}))),l.a.createElement(g.a,{autoFocus:!0,margin:"dense",id:"remarks",label:"Remarks",onChange:function(e){v(e.target.value)},value:y,fullWidth:!0})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:x,color:"primary"},"Cancel"),l.a.createElement(p.a,{onClick:e=>{!function(e,t,a,n,l,r){_t("validate_trigger",{site_code:e,alert_status:n,trigger_id:t,trigger_ts:a,remarks:l,user_id:r})}(s,m,d,E,y,O.user_id),a(),f(""),v("")},color:"primary",disabled:k},"Confirm")))),document.body):null});var xt=()=>{const e=Object(n.useState)(!1),t=Object(o.a)(e,2),a=t[0],l=t[1];return{isShowing:a,toggle:function(){l(!a)}}},jt=a(212),kt=a.n(jt),St=a(589),Ct=a.n(St),wt=a(590),Dt=a.n(wt);function At(e,t=!1){const a=e.offsetHeight,n=getComputedStyle(e),l=n.marginBottom,r=n.marginTop,c=parseFloat(l)+parseFloat(r);return t?c:a+c}function It(e){const t=e.classes;return l.a.createElement("div",{id:"letter-head",className:t.letterHeadContainer},l.a.createElement("img",{src:Ct.a,alt:"PHIVOLCS Letter Head",className:t.phivolcsLetterHead}))}function Mt(e){const t=e.classes;return l.a.createElement("div",{id:"letter-foot",className:"".concat(t.letterHeadContainer," ").concat(t.letterFooterContainer)},l.a.createElement("img",{src:Dt.a,alt:"PHIVOLCS Letter Footer",className:t.phivolcsLetterHead}))}function Tt(e){const t=e.classes,a=e.bulletinDetail,r=e.isMD,c=a.bulletin_control_code,i=a.site_address,o=a.data_ts,s=a.alert_description_group,m=a.recommended_response;return l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{variant:"body2",align:"center",className:t.title},l.a.createElement("strong",null,"DYNASLOPE LANDSLIDE ALERT LEVEL INFORMATION: ",c)),l.a.createElement(v.a,{variant:"body2",component:"div",className:t.mainInfo},l.a.createElement(y.a,{container:!0,spacing:r?2:1},l.a.createElement(y.a,{item:!0,xs:4},"Location:"),l.a.createElement(y.a,{item:!0,xs:8},l.a.createElement("strong",null,i)),l.a.createElement(y.a,{item:!0,xs:4},"Date/Time:"),l.a.createElement(y.a,{item:!0,xs:8},l.a.createElement("strong",null,o)),l.a.createElement(y.a,{item:!0,xs:4},"Alert Level Released:"),l.a.createElement(y.a,{item:!0,xs:8},l.a.createElement("strong",null,s)),l.a.createElement(y.a,{item:!0,xs:4},"Recommended Response:"),l.a.createElement(y.a,{item:!0,xs:8},l.a.createElement("strong",null,m)))))}var Nt=Object(Se.a)()((function(e){const t=e.releaseId,a=e.width,r=(e=>Object(O.a)(t=>{let a;return a="undefined"===typeof e?{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"28px 44px",[t.breakpoints.only("md")]:{padding:"58.3324px 91.6652px"},[t.breakpoints.up("lg")]:{padding:"116.6648px 183.3304px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"33.3328px"},[t.breakpoints.up("lg")]:{marginTop:"66.6656px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{padding:"0 44px",height:629,maxHeight:629,overflowY:"hidden",[t.breakpoints.only("md")]:{padding:"0 91.6652px",height:1310.3957,maxHeight:1310.3957},[t.breakpoints.up("lg")]:{padding:"0 183.3304px",height:2620.7914,maxHeight:2620.7914}},title:{marginBottom:16,fontSize:"0.8rem",[t.breakpoints.only("md")]:{marginBottom:33.3328,fontSize:"1.6664rem"},[t.breakpoints.up("lg")]:{marginBottom:66.6656,fontSize:"3.47111rem"}},mainInfo:{border:"0.5px solid black",padding:"8px 12px",fontSize:"0.65rem",letterSpacing:0,marginBottom:12,[t.breakpoints.only("md")]:{padding:"16.6664px 24.9996px",fontSize:"1.354145rem",marginBottom:24.9996},[t.breakpoints.up("lg")]:{padding:"33.3328px 49.9992px",fontSize:"2.70829rem",marginBottom:49.9992}},sectionHeader:{fontSize:"0.7rem",[t.breakpoints.only("md")]:{fontSize:"1.45831rem"},[t.breakpoints.up("lg")]:{fontSize:"2.91662rem"}},sectionDetails:{fontSize:"0.65rem",[t.breakpoints.only("md")]:{fontSize:"1.354145rem"},[t.breakpoints.up("lg")]:{fontSize:"2.70829rem"}},indent:{marginLeft:24,[t.breakpoints.only("md")]:{marginLeft:49.9992},[t.breakpoints.up("lg")]:{marginLeft:99.9984}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}:{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"7px 11px",[t.breakpoints.only("md")]:{padding:"20px 22.9163px"},[t.breakpoints.up("lg")]:{padding:"29.1662px 45.8326px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"8.3332px"},[t.breakpoints.up("lg")]:{marginTop:"16.6664px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{overflowY:"hidden",padding:"0 11px",height:"100%",maxHeight:"100%",[t.breakpoints.only("md")]:{padding:"0 22.9163px",height:"100%",maxHeight:"100%"},[t.breakpoints.up("lg")]:{padding:"0 45.8326px",height:"100%",maxHeight:"100%"}},title:{marginBottom:4,fontSize:"0.65625rem",[t.breakpoints.only("md")]:{marginBottom:16,fontSize:"1.45rem"},[t.breakpoints.up("lg")]:{marginBottom:33.3328,fontSize:"1.367163rem"}},mainInfo:{border:"0.5px solid black",letterSpacing:0,padding:"2px 3px",fontSize:"0.4875rem",marginBottom:3,[t.breakpoints.only("md")]:{padding:"10px 16px",fontSize:"1rem",marginBottom:12},[t.breakpoints.up("lg")]:{padding:"8.3332px 12.4998px",fontSize:"1.01560875rem",marginBottom:12.4998}},sectionHeader:{fontSize:"0.525rem",[t.breakpoints.only("md")]:{fontSize:"1.2rem"},[t.breakpoints.up("lg")]:{fontSize:"1.0937325rem"}},sectionDetails:{fontSize:"0.4875rem",[t.breakpoints.only("md")]:{fontSize:"1rem"},[t.breakpoints.up("lg")]:{fontSize:"1.01560875rem"}},indent:{marginLeft:6,[t.breakpoints.only("md")]:{marginLeft:12.4998},[t.breakpoints.up("lg")]:{marginLeft:24.9996}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}},a}))(t)(),c=Object(n.useState)([]),i=Object(o.a)(c,2),s=i[0],m=i[1],d=Object(n.useState)(!1),p=Object(o.a)(d,2),b=p[0],g=p[1],E=Object(n.useState)(!1),f=Object(o.a)(E,2),h=f[0],_=f[1],j=Object(n.useRef)(null),k=Object(n.useState)({site:{},alert_level:0,bulletin_control_code:"",site_address:"",alert_description_group:"",recommended_response:"",community_response:"",lewc_lgu_response:"",households_at_risk:"",has_ground_trigger:!1,ground_movement_details:"",prepared_triggers:[],no_data_triggers:[],publishers:"",next_ewi_release_ts:""}),S=Object(o.a)(k,2),C=S[0],w=S[1],D=C.alert_level,A=C.community_response,I=C.households_at_risk,M=C.lewc_lgu_response,T=C.prepared_triggers,N=C.has_ground_trigger,Y=C.site.barangay,R=C.no_data_triggers,H=C.publishers,B=C.next_ewi_release_ts,P=C.ground_movement_details,L=Object(Se.c)("md",a);Object(n.useEffect)(()=>{let a=t;if("undefined"===typeof t){a=e.match.params.release_id}!function(e,t){const a="".concat(ee.b,"/api/monitoring/create_bulletin/").concat(e);ae.a.get(a).then(e=>{const a=e.data;console.log("Bulletin details",a),t(a)}).catch(e=>{console.log(e)})}(a,e=>{const t=ne(e.site,!1),a=Object(u.a)(Object(u.a)({},e),{},{site_address:t});g(!0),w(a)})},[]),Object(n.useEffect)(()=>{if(null!==j.current){const e=j.current,t=Array.from(e.children);let a=0;t.forEach((e,t)=>{if("subcontent"!==e.id)a+=At(e);else{a+=At(e,!0);const t=Array.from(e.children),n=[];t.forEach(e=>{const t=At(e);a+t<1310.3957?a+=t:(a+=t,n.push(e.children[0]),e.setAttribute("style","display: none"))}),m(n)}}),""!==C.site_address&&_(!0)}},[C,j]);let F=!1;return l.a.createElement(n.Fragment,null,b?l.a.createElement(n.Fragment,null,l.a.createElement("div",{id:"bulletin-root",className:r.root},l.a.createElement(It,{classes:r}),l.a.createElement("div",{id:"bulletin-content",className:r.body,ref:j},l.a.createElement(Tt,{classes:r,bulletinDetail:C,isMD:L}),l.a.createElement(y.a,{container:!0,spacing:L?2:1,id:"subcontent"},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionHeader},l.a.createElement("strong",null,l.a.createElement("u",null,"AREA SITUATION"),":"))),T.map((e,t,a)=>{const c=e.is_ground,i=e.trigger_source;let o="";!F&&c&&(o=l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionHeader},l.a.createElement("strong",null,"GROUND MOVEMENT"))),F=!0);let s=!1;(0===t||a[t-1].trigger_source!==i)&&(s=!0);let m="";if(s){const e=i.toUpperCase();m=l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:"".concat(r.sectionHeader," ").concat(c?r.indent:"")},l.a.createElement("strong",null,c?l.a.createElement("u",null,l.a.createElement("i",null,e)):e)))}let d="";return R.includes(i)&&(d=l.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:"0 !important"}},l.a.createElement(v.a,{variant:"body2",className:"".concat(r.sectionDetails," ").concat(r.indent)},"Currently, no data available."))),l.a.createElement(n.Fragment,{key:"key-".concat(t+1)},o,m,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:"".concat(r.sectionDetails," ").concat(r.indent),dangerouslySetInnerHTML:{__html:e.description}})),d)}),(!N||0===D)&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionHeader},l.a.createElement("strong",null,"GROUND MOVEMENT"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:"".concat(r.sectionDetails," ").concat(r.indent)},P))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionHeader},l.a.createElement("strong",null,"ELEMENTS AT RISK"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:"".concat(r.sectionDetails," ").concat(r.indent)},I)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionHeader},l.a.createElement("strong",null,l.a.createElement("u",null,"OTHER RECOMMENDATIONS"),":"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionDetails},l.a.createElement("strong",null,"For the Landslide Early Warning Committee (LEWC):")," ",l.a.createElement("span",{dangerouslySetInnerHTML:{__html:M}}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionDetails},l.a.createElement("strong",null,"For the Community:")," ",A)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",className:r.sectionDetails},l.a.createElement("strong",null,"NOTE:")," This bulletin contains the official Alert Level and Recommended Response of the Dynaslope Project for Brgy. ",Y," and will hold true until a new bulletin is released.")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{className:r.divider})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{component:"div",variant:"body2",className:"".concat(r.sectionDetails," ").concat(r.releaseDetailsArea)},0===D?l.a.createElement("span",null):l.a.createElement("span",null,"Next bulletin on: ",l.a.createElement("strong",null,B)),l.a.createElement("span",null,"Released by: ",l.a.createElement("strong",null,H)))))),l.a.createElement(Mt,{classes:r})),s.length>0&&l.a.createElement("div",{id:"bulletin-root-2",className:r.root},l.a.createElement(It,{classes:r}),l.a.createElement("div",{id:"bulletin-content",className:r.body,ref:j},l.a.createElement(Tt,{classes:r,bulletinDetail:C,isMD:L}),l.a.createElement(y.a,{container:!0,spacing:L?2:1,id:"excess-content"},s.map((e,t)=>{const a=[];e.classList.forEach(e=>{if(e.includes("makeStyles")){const t=e.split("-")[1];a.push(r[t])}else a.push(e)});const n=e.outerHTML.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,'"'.concat(a.join(" "),'"'));return l.a.createElement(y.a,{key:"key-".concat(t+1),item:!0,xs:12,dangerouslySetInnerHTML:{__html:n}})}))),l.a.createElement(Mt,{classes:r})),h&&l.a.createElement("div",{id:"is-loaded"})):l.a.createElement(y.a,{item:!0,style:{textAlign:"center"}},l.a.createElement(x.a,{size:50}),l.a.createElement(v.a,null,"Loading Bulletin")))}));var Yt=Object(pt.a)()((function(e){const t=e.classes,a=e.fullScreen,r=e.isOpenBulletinModal,c=e.setIsOpenBulletinModal,s=e.releaseDetail,m=s.release_id,d=s.site_code,u=s.site_id,b=s.type,E=s.is_bulletin_sent,f=Object(n.useState)(""),h=Object(o.a)(f,2),_=h[0],v=h[1],O=Object(n.useState)([]),x=Object(o.a)(O,2),k=x[0],S=x[1],C=Object(n.useState)(""),w=Object(o.a)(C,2),D=w[0],A=w[1],I=Object(n.useState)(""),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)({}),R=Object(o.a)(Y,2),H=R[0],B=R[1],P=Object(i.b)(),L=P.enqueueSnackbar,F=P.closeSnackbar,U=Object(j.a)().user_id,z=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{F(e)}},"Dismiss");Object(n.useEffect)(()=>{"undefined"!==typeof m&&r&&function(e,t){me("".concat(ee.b,"/api/bulletin_email/get_bulletin_email_details/").concat(e),t)}(m,e=>{const t=e.subject,a=e.recipients,n=e.mail_body,l=e.file_name,r=e.narrative_details;B(r),S(a),v(t),A(n),N(l)})},[r]);const W=()=>{c(!1),B({}),S([]),v(""),A(""),N("")};let G="";return"undefined"!==typeof d&&(G=d.toUpperCase()),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:a,open:r,"aria-labelledby":"form-dialog-title",maxWidth:"md"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Early Warning Bulletin for ",G),l.a.createElement(ct.a,null,l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{required:!0,label:"Mail Content",value:D,onChange:e=>{A(e.target.value)},placeholder:"Add mail content",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(kt.a,{label:"To",value:k,onAdd:e=>(e=>{const t=k;t.push(e),S([...t])})(e),onDelete:(e,t)=>((e,t)=>{k.splice(k.indexOf(e),1),S([...k])})(e),fullWidth:!0,required:!0})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{className:t.divider})),l.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},l.a.createElement(Nt,{releaseId:m})))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:(q=m,()=>{!function(e,t){me("".concat(ee.b,"/api/bulletin/download_bulletin/").concat(e),t)}(q,e=>{console.log("LOG bulletin_download",e)})}),color:"primary"},"Download"),l.a.createElement(p.a,{color:"secondary",onClick:()=>{const e={subject:_,recipients:k,mail_body:D,release_id:m,file_name:T,alert_db_group:b,site_id:u,sender_id:U,narrative_details:H},t=L("Sending EWI bulletin...",{variant:"warning",persist:!0});W(),function(e,t,a){se("".concat(ee.b,"/api/mailbox/send_bulletin_email"),e,t,a)}(e,e=>{console.log("Sent bulletin email...",e);const a=e.status,n=e.message;let l;F(t),l=a?"success":"error",L(n,{variant:l,autoHideDuration:7e3,action:z})},()=>{F(t),L("Send bulletin failed. Ask the devs.",{variant:"error",autoHideDuration:7e3,action:z})})},disabled:!1},E?"Sent already (Send again?)":"Send"),l.a.createElement(p.a,{onClick:W,color:"primary"},"Cancel")));var q}));var Rt=a(1112),Ht=a(1111),Bt=a(1107),Pt=a(1108),Lt=a(576),Ft=a(50),Ut=a(1106),zt=a(28);function Wt(e,t,a){const n="".concat(ee.b,"/api/chatterbox/send_message");ae.a.post(n,e).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e),a(e)})}var Gt=a(623);const qt=Object(n.forwardRef)((e,t)=>l.a.createElement(P.a,Object.assign({direction:"up"},e,{ref:t}))),Vt=Object(n.forwardRef)((e,t)=>l.a.createElement(Gt.a,Object.assign({},e,{ref:t})));var Qt=a(92),Zt=a(617),Kt=a(578),Jt=a(591),Xt=a.n(Jt),$t=a(417);function ea(e){const t=e.selectProps,a=e.innerProps,n=e.children;return l.a.createElement(v.a,Object.assign({color:"textSecondary",className:t.classes.noOptionsMessage},a),n)}function ta(e){let t=e.inputRef,a=Object(Qt.a)(e,["inputRef"]);return l.a.createElement("div",Object.assign({ref:t},a))}function aa(e){const t=e.selectProps,a=e.innerRef,n=e.children,r=e.innerProps,c=e.isDisabled;return l.a.createElement(g.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:ta,inputProps:Object(u.a)({className:t.classes.input,inputRef:a,children:n},r)}},t.textFieldProps,{disabled:c}))}function na(e){const t=e.innerRef,a=e.isFocused,n=e.isSelected,r=e.innerProps,c=e.children,i=e.data.color;return l.a.createElement(B.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400,color:i}},r),c)}function la(e){const t=e.selectProps,a=e.innerProps,n=e.children;return l.a.createElement(v.a,Object.assign({color:"textSecondary",className:t.classes.placeholder},a),n)}function ra(e){const t=e.selectProps,a=e.children;return l.a.createElement("div",{className:t.classes.valueContainer},a)}function ca(e){const t=e.children,a=e.selectProps,n=e.isFocused,r=e.data,c=e.removeProps,i=r.chipLabel,o="undefined"!==typeof i?i:t;return l.a.createElement(Kt.a,{tabIndex:-1,label:o,className:"".concat(a.classes.chip," ").concat({[a.classes.chipFocused]:n}),onDelete:c.onClick,deleteIcon:l.a.createElement(Xt.a,c)})}function ia(e){const t=e.selectProps,a=e.innerProps,n=e.children;return l.a.createElement(h.a,Object.assign({square:!0,className:t.classes.paper},a),n)}var oa=Object(d.a)(e=>({root:{flexGrow:1},input:{display:"flex",padding:0,height:"auto"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object($t.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:2,marginTop:e.spacing(1),left:0,right:0},divider:{height:e.spacing(2)}}),{withTheme:!0})((function(e){const t=e.classes,a=e.changeHandler,n=e.isRequired,r=e.options,c=e.value,i=e.label,o=e.placeholder,s=e.renderDropdownIndicator,m=e.openMenuOnClick,d=e.isMulti,p=e.isDisabled,b=e.isClearable,g=e.hasAlternativeChipLabel,E={input:e=>Object(u.a)(Object(u.a)({},e),{},{color:"blue","& input":{font:"inherit"}}),menuPortal:e=>Object(u.a)(Object(u.a)({},e),{},{zIndex:9999})},f={Control:aa,Menu:ia,MultiValue:ca,NoOptionsMessage:ea,Option:na,Placeholder:la,ValueContainer:ra},h=void 0===m||m,_=void 0!==d&&d,y=void 0!==p&&p,v=void 0!==b&&b,O=void 0!==n&&n;return!1===(void 0===s||s)&&(f.DropdownIndicator=()=>null,f.IndicatorSeparator=()=>null),l.a.createElement("div",{className:t.root},l.a.createElement(We.a,null,l.a.createElement(Zt.a,{required:O,classes:t,styles:E,textFieldProps:{label:i,InputLabelProps:{shrink:!0}},menuPortalTarget:document.body,options:r,components:f,value:c,onChange:a,placeholder:o,isMulti:_,openMenuOnFocus:!1,openMenuOnClick:h,isDisabled:y,isClearable:v,hasAlternativeChipLabel:g})))}));const sa=Object(n.createContext)(),ma=({children:e})=>{const t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],c=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],u=m[1],p=Object(n.useState)(!0),b=Object(o.a)(p,2),g=b[0],E=b[1];Object(n.useEffect)(()=>{var e;g&&(e=e=>{const t=e.filter(e=>e.active);c(t),u(e),E(!1)},me("".concat(ee.b,"/api/sites/get_sites_data?include_inactive=true"),e))},[g]);const f=Object(n.useState)([]),h=Object(o.a)(f,2),_=h[0],y=h[1],v=Object(n.useState)(!0),O=Object(o.a)(v,2),x=O[0],j=O[1];Object(n.useEffect)(()=>{var e;x&&(e=e=>{y(e),j(!1)},me("".concat(ee.b,"/api/users/get_dynaslope_users/true/true"),e))},[x]);const k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],w=S[1];Object(n.useEffect)(()=>{var e;e=e=>{w(e)},me("".concat(ee.b,"/api/users/get_organizations"),e)},[]);const D=Object(n.useState)(null),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(i.b)(),N=T.enqueueSnackbar,Y=T.closeSnackbar,R=Object(n.useState)(null),H=Object(o.a)(R,2),B=H[0],P=H[1];Object(n.useEffect)(()=>{if(null!==I)if(!0===I){const e=N("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});P(e)}else Y(B),N("Reconnection successful...",{variant:"success",autoHideDuration:5e3})},[I]);const L={users:_,sites:r,all_sites_including_inactive:d,organizations:C,is_reconnecting:I,setIsReconnecting:M,setRefreshUser:j,setRefreshSites:E};return l.a.createElement(sa.Provider,{value:L},e)};function da(e,t,a){return e.map(e=>{const n=e.site_code,l=e.site_id;let r=n.toUpperCase();t&&(r=ne(e,!0,"start"));let c="black",i=null;if("undefined"!==typeof a&&null!==a){const e=a.latest,t=a.extended,l=[...e,...a.overdue],r=n.toLowerCase(),o=l.findIndex(e=>e.event.site.site_code===r),s=t.findIndex(e=>e.event.site.site_code===r);o>-1&&(c="red",i=l[o].event.event_id),s>-1&&(c="green",i=t[s].event.event_id)}return{value:l,label:r,data:e,color:c,event_id:i}})}var ua=function(e){const t=e.value,a=e.changeHandler,r=e.isMulti,c=e.renderDropdownIndicator,i=e.includeAddressOnOptions,o=e.returnSiteDataCallback,s=e.isFromSiteLogs,m=e.disabled,d=e.customPlaceholder,u=e.isClearable,p=e.required,b=Object(n.useContext)(sa).sites,g=da(b,"undefined"===typeof i||i,s),E="undefined"!==typeof r&&r;let f=E?"Select site(s)":"Select site";f=d||f;const h="undefined"!==typeof c&&c,_="undefined"!==typeof u&&u;let y=t;if(""!==t&&null!==t){const e=t.label,a=t.value;if("undefined"!==typeof o&&o){const e=b.find(e=>e.site_id===a);"undefined"!==typeof e&&o(e)}"undefined"!==typeof e||E||(y=g[a-1])}let v=r?"Site(s)":"Site";return p&&(v+=" *"),l.a.createElement(oa,{isRequired:Boolean(p),label:v,options:g,value:y,changeHandler:a,placeholder:f,renderDropdownIndicator:h,openMenuOnClick:!0,isMulti:E,isDisabled:Boolean(m),isClearable:_})};const pa=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}));var ba=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.inputFieldLength,c=e.clickHandler,s=e.setComposedMessage,m=e.maxCharacters,d=pa(),u=Object(n.useState)(X()().format("YYYY-MM-DD HH:mm:ss")),b=Object(o.a)(u,2),g=b[0],E=b[1],f=Object(n.useState)(null),h=Object(o.a)(f,2),_=h[0],v=h[1],O=Object(n.useState)(!0),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(i.b)(),C=S.enqueueSnackbar,w=S.closeSnackbar,D=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{w(e)}},"Dismiss"),A=()=>{const e=function(e){const t=[];return e.forEach((e,a)=>{const n=e.data,l=n.site_code,r=n.barangay,c=n.municipality,i=n.province,o="Brgy. ".concat(r,", ").concat(c,", ").concat(i);t.push({site_code:l,site_info:o})}),t}(_),t=j,a=X()(g).format("LLL");!function(e,t){const a="".concat(ee.b,"/api/rainfall/get_all_site_rainfall_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Get rain information data reponse",a),t(a)}).catch(e=>{console.error(e)})}({is_express:t,site_details:e,date_time:g,as_of:a},e=>{const t=e.status,a=e.message,n=e.ewi;s(n.slice(0,r));let l=a,i="error";!0===t&&(c(),i="success",n.length>r&&(i="warning",l="Rainfall information message is trimmed down because of length restrictions (max characters: ".concat(m,")"))),C(l,{variant:i,autoHideDuration:3e3,action:D})})},I=Object(n.useState)(!0),M=Object(o.a)(I,2),T=M[0],N=M[1];return Object(n.useEffect)(()=>{N(null===g||null===_)},[g,_]),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Load Rainfall Information"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Fill-up the form with needed data."),l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:12,className:d.inputGridContainer},l.a.createElement(ua,{value:_,changeHandler:e=>{v(e)},isMulti:!0})),l.a.createElement(y.a,{item:!0,xs:6,className:d.inputGridContainer},l.a.createElement(Ke.a,{title:"Example tooltip",placement:"top",interactive:!0},l.a.createElement(ot.a,null,l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:j,onChange:e=>k(e.target.checked),value:"checkedB",color:"primary"}),label:"Express data in percentage"})))),l.a.createElement(y.a,{item:!0,xs:6,className:d.inputGridContainer},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Data timestamp",value:g,onChange:e=>E(X()(e).format("YYYY-MM-DD HH:mm:ss")),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0}))))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{color:"primary",onClick:()=>A(),disabled:T},"Select"),l.a.createElement(p.a,{onClick:c},"Cancel")))}));var ga=function(e){const t=e.limitRows,a=e.value,r=e.disableSend,c=e.messageChangeHandler,i=e.sendButtonClickHandler,s=e.setComposedMessage,m=e.disableTemplateLoader,d=void 0===t||t,u=Object(n.useState)(!1),p=Object(o.a)(u,2),b=p[0],E=p[1],f=e=>()=>E(e),h=Object(j.a)().nickname,_=" - ".concat(h," from PHIVOLCS-DYNASLOPE"),O=a.length+_.length;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",style:{paddingTop:16}},l.a.createElement(y.a,{item:!0,xs:10,sm:11},l.a.createElement(g.a,{id:"message_textbox",label:"Message",multiline:!0,rows:"4",rowsMax:d?4:10,fullWidth:!0,margin:"dense",variant:"filled",inputProps:{maxLength:1e3},value:a,onChange:c}),l.a.createElement(v.a,{variant:"caption",align:"right",component:"div"},l.a.createElement("strong",null,"Character count (including signature): ",O,"/",1e3))),l.a.createElement(y.a,{item:!0,xs:1,container:!0,direction:"column"},l.a.createElement(Y.a,{color:"primary","aria-label":"Send message",onClick:i,disabled:r},l.a.createElement(Bt.a,null)),!m&&l.a.createElement(Y.a,{color:"primary","aria-label":"More options",onClick:f(!0)},l.a.createElement(Pt.a,null)))),l.a.createElement(ba,{isOpen:b,setComposedMessage:s,clickHandler:f(!1),maxCharacters:1e3,inputFieldLength:1e3-_.length}))},Ea=a(1061),fa=a(416),ha=a(1109),_a=a(1110);var ya=Object(d.a)(e=>({checkboxes:{paddingTop:4,paddingBottom:4}}))((function(e){const t=e.classes,a=(e.label,e.changeHandler),r=e.choices,c=e.checkboxStyle;return l.a.createElement(n.Fragment,null,r.map(({state:e,value:n,label:r,is_disabled:i},o)=>l.a.createElement(mt.a,{key:o,control:l.a.createElement(Lt.a,{checked:e,onChange:a(n),value:n,disabled:"undefined"!==typeof i&&i,className:t.checkboxes}),label:r,className:c})))}));const va=Object(O.a)(e=>({formControl:{width:"-webkit-fill-available",marginTop:8,"&:first-child":{marginTop:12}},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxSites:{flex:"1 1 25%",[e.breakpoints.down("xs")]:{"&:last-child":{flexBasis:"58.5%"}},[e.breakpoints.up("sm")]:{flexBasis:"17%"},[e.breakpoints.up("md")]:{flexBasis:"9%"}},checkboxOrganizations:{flex:"1 1 45%",[e.breakpoints.up("sm")]:{flexBasis:"17%","&:last-child":{flexBasis:"77%"}},[e.breakpoints.up("md")]:{flexBasis:"9%","&:last-child":{flexBasis:"45%"}}},checkboxGroup:{flexDirection:"row",paddingTop:6},buttons:{[e.breakpoints.down("xs")]:{padding:"12px 6px"}}}));var Oa=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.setRecipients,i=va(),s=Object(n.useContext)(sa),m=s.sites,d=s.organizations,b=m.map(e=>({label:e.site_code.toUpperCase(),value:e.site_id,state:!1})),g=d.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{label:t+e.name.toUpperCase(),value:e.org_id,state:!1}}),E=Object(n.useState)(!1),f=Object(o.a)(E,2),h=f[0],_=f[1],y=Object(n.useState)(b),v=Object(o.a)(y,2),O=v[0],x=v[1],j=Object(n.useState)(g),k=Object(o.a)(j,2),S=k[0],C=k[1],w={handleCheckAll:(e,t)=>()=>{let a,n;"sites"===e?(a=O,n=x):"organizations"===e&&(a=S,n=C);n([...a.map(e=>Object(u.a)(Object(u.a)({},e),{},{state:t}))])},handleChange:e=>t=>a=>{const n=a.target.checked;if("only_ewi_recipient"===e)_(n);else{let a,l;"sites"===e?(a=O,l=x):"organizations"===e&&(a=S,l=C);const r=a.findIndex(e=>e.value===t);a[r].state=n,l([...a])}}};return l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt,maxWidth:"md"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Select recipients"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Choose your preferred sites and offices as message recipients."),l.a.createElement(ot.a,{className:i.formControl},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:h,onChange:e=>_(e.target.checked),value:"only_ewi_recipients",className:i.checkboxes}),label:"Only EWI Recipients"})),[{state_list:S,group:"Organizations",list:d},{state_list:O,group:"Sites",list:m}].map(e=>function(e,t,a){const n=t.state_list,r=t.group,c=t.list,i=a.handleCheckAll,o=a.handleChange,s=r.toLowerCase();return l.a.createElement(ot.a,{component:"fieldset",className:e.formControl,key:r},l.a.createElement(Ea.a,{component:"legend",className:e.formLabel},l.a.createElement("span",null,r),l.a.createElement("span",null,[{label:"Check all",component:l.a.createElement(ha.a,null),bool:!0},{label:"Uncheck all",component:l.a.createElement(_a.a,null),bool:!1}].map(t=>l.a.createElement(Y.a,{"aria-label":t.label,color:"primary",className:e.buttons,onClick:i(s,t.bool),key:t.label},t.component)))),l.a.createElement(fa.a,{className:e.checkboxGroup},l.a.createElement(ya,{choices:c.map(e=>function(e,t,a){let n;"Sites"===t?n="site_id":"Organizations"===t&&(n="org_id");return a.filter(t=>t.value===e[n]).pop()}(e,r,n)),changeHandler:o(s),checkboxStyle:e["checkbox".concat(r)]})))}(i,e,w))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:()=>{const e=[],t=[];O.forEach(t=>{t.state&&e.push(t.value)}),S.forEach(e=>{e.state&&t.push(e.value)});!function(e,t){const a="".concat(ee.b,"/api/contacts/get_recipients_option");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Selected recipients",a),t(a)}).catch(e=>{console.error(e)})}({site_ids:e,org_ids:t,only_ewi_recipients:h},e=>{const t=e.map(e=>{const t=e.label,a=e.mobile_id,n=e.org,l=e.sim_num;let r=t;""!==n&&(r="".concat(t," (").concat(n,")")),r+=" - ".concat(l);return{label:r,chipLabel:"".concat(t," - ").concat(l),value:a,sim_num:l,data:e}});c(t)}),r()},color:"primary"},"Select"),l.a.createElement(p.a,{onClick:r},"Cancel"))))}));var xa=function(e){const t=e.textboxValue,a=e.disableQuickSelect,r=e.releaseId,c=e.siteCode,s=e.fromEWIModal,m=e.modalStateHandler,d=e.updateSentStatusObj,b=e.recipientsList,g=Object(i.b)(),E=g.enqueueSnackbar,f=g.closeSnackbar,h=Object(j.a)(),_=Object(n.useState)([]),v=Object(o.a)(_,2),O=v[0],k=v[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(!1),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)(t),R=Object(o.a)(N,2),H=R[0],B=R[1],P="undefined"!==typeof a&&a,L="undefined"!==typeof s&&s,F=Object(n.useState)(!1),U=Object(o.a)(F,2),z=U[0],W=U[1];Object(n.useEffect)(()=>{"undefined"!==typeof c&&(W(!0),function(e,t){const a="".concat(ee.b,"/api/contacts/get_contacts_per_site/").concat(e);ae.a.get(a).then(e=>{const a=e.data;console.log(e),console.log(a),t(a)}).catch(e=>{console.error(e)})}(c,e=>{const t=[],a=[],n=d.type,l=d.public_alert_symbol.alert_level,r=d.highest_event_alert_level;e.forEach(e=>{if(e.mobile_numbers.length>0){const c=e.user_id,i=e.last_name,o=e.first_name,s=e.organizations,m=e.ewi_recipient,d=e.ewi_restriction,u=s[0].organization,p=u.name,b=u.scope;let g=p.toUpperCase();if("lgu"===p){let e;1===b&&(e="B"),2===b&&(e="M"),3===b&&(e="P"),g=e+g}const E={label:"".concat(i,", ").concat(o," (").concat(g,")"),value:c,data:e};if(t.push(E),1===m){let e=!0;if("extended"===n)e=!1,("lewc"===p||b<3&&"lgu"===p)&&(e=!0);else if(null!==d){const t=d.alert_level;(0!==l&&l<=t||0===l&&r<=t)&&(e=!1)}e&&a.push(E)}}}),D(t),k(a),W(!1)}))},[c,d]),Object(n.useEffect)(()=>{if("undefined"!==typeof b){W(!0);const e=b.map(e=>{const t=e.label,a=e.mobile_id,n=e.org,l=e.sim_num;let r=t;""!==n&&(r="".concat(t," (").concat(n,")")),r+=" - ".concat(l);return{label:r,chipLabel:"".concat(t," - ").concat(l),value:a,sim_num:l,data:e}});D(e),k([]),W(!1)}},[b]);const G=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{f(e)}},"Dismiss"),q=null===O||0===O.length,V=""===H||"undefined"===typeof H;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},z&&l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(x.a,{size:20})),l.a.createElement(y.a,{item:!0,xs:!0},l.a.createElement(oa,{label:"Recipients",options:w,value:O,changeHandler:e=>k(e),placeholder:"Select recipients",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0})),!P&&l.a.createElement(y.a,{item:!0,style:{textAlign:"right"}},l.a.createElement(Y.a,{"aria-label":"Quick select option",onClick:e=>T(!0)},l.a.createElement(Ht.a,null)))),l.a.createElement(Oa,{isOpen:M,closeHandler:e=>T(!1),setRecipients:k}),l.a.createElement("div",{style:{marginTop:16}},l.a.createElement(ga,{limitRows:!1,value:H,disableSend:q||V,sendButtonClickHandler:()=>{const e=[];L?O.forEach(t=>{const a=t.data;a.mobile_numbers.forEach(t=>e.push({mobile_id:t.mobile_number.mobile_id,gsm_id:t.mobile_number.gsm_id,data:a}))}):O.forEach(({data:{mobile_id:t,gsm_id:a}})=>{e.push({mobile_id:t,gsm_id:a})});let t={sms_msg:"".concat(H," - ").concat(h.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:e,is_ewi:L};if(L){const e=d.site_id,a=d.type;t=Object(u.a)(Object(u.a)({},t),{},{release_id:r,user_id:h.user_id,site_id:e,alert_db_group:a})}const a=E("Sending EWI message...",{variant:"warning",persist:!0});m(),Wt(t,e=>{f(a);let t,n=e.message;e.status?(t="success",n="EWI SMS sent!"):t="error",E(n,{variant:t,autoHideDuration:7e3,action:G})},()=>{E("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:G})})},messageChangeHandler:e=>B(e.target.value),setComposedMessage:B,disableTemplateLoader:L})))};var ja=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,r=e.textboxValue,c=e.releaseDetail,i=c.release_id,o=c.site_code;return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},l.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},l.a.createElement("span",null,"Send Early Warning Information"),l.a.createElement(Y.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},l.a.createElement(Rt.a,null)))),l.a.createElement(ct.a,{style:{overflowY:"auto"}},l.a.createElement(it.a,null,"Early warning information recipients for this site is already pre-loaded. Add additional site-related contacts if necessary. Use Chatterbox for non-site-related contacts."),l.a.createElement("div",{style:{marginTop:20}},l.a.createElement(xa,{isMobile:t,textboxValue:r,disableQuickSelect:!0,releaseId:i,siteCode:o,fromEWIModal:!0,updateSentStatusObj:c,modalStateHandler:a}))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))}));const ka=Object(O.a)(e=>Object(fe.d)(e));function Sa(e){const t=e.is_loading_recipients,a=e.textboxValue,r=e.sendHandler;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},t&&l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(x.a,{size:20}))),l.a.createElement("div",{style:{marginTop:16}},l.a.createElement(ga,{limitRows:!1,value:a,disableSend:!1,sendButtonClickHandler:r,messageChangeHandler:()=>console.log("tried msg change")})))}var Ca=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,r=e.textboxValue,c=e.siteList,o=ka(),s=Object(i.b)(),m=s.enqueueSnackbar,d=s.closeSnackbar,u=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{d(e)}},"Dismiss");return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},l.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},l.a.createElement("span",null,"Send Routine Early Warning Information"),l.a.createElement(Y.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},l.a.createElement(Rt.a,null)))),l.a.createElement(ct.a,{style:{overflowY:"hidden"}},l.a.createElement(it.a,null,"Early warning information recipients for this site is already pre-loaded. Recipients are LEWC, Barangay, and Municipal LGUs per site. If you need to add a new recipient, add a new community contact via chatterbox."),l.a.createElement(it.a,{className:o.dyna_error},"NOTE: Ensure first that alerts for ALL sites under routine monitoring has been released before sending routine EWI SMS. Sending routine EWI in multiple batches will result in message duplication on our stakeholders."),l.a.createElement("div",{style:{marginTop:20}},l.a.createElement(Sa,{isMobile:t,textboxValue:r,disableQuickSelect:!0,sendHandler:()=>{const e=Object(j.a)(),t=e.user_id,n=e.nickname,l={site_list:c,user_id:t,nickname:n};a(),function(e,t,a){const n="".concat(ee.b,"/api/chatterbox/send_routine_ewi_sms");ae.a.post(n,e).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e),a(e)})}(l,e=>{if(console.log(e),e.status)m("Routine EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:u});else{const t=e.site_ids.map(e=>e.toUpperCase());m("Some problems occurred sending EWI SMS to ".concat(t.join(", ")),{variant:"error",persist:!0,action:u})}},e=>{console.log("error_response",e),m("Error sending routine EWI SMS...",{variant:"error",autoHideDuration:7e3,action:u})})},fromEWIModal:!0,updateSentStatusObj:"",modalStateHandler:a}))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),wa=a(411),Da=a(424);var Aa=Object(d.a)(e=>({formControl:{minWidth:120}}))((function(e){const t=e.classes,a=e.list,r=e.mapping,c=e.label,i=e.div_id,o=e.changeHandler,s=e.value,m=e.css,d=e.error,u=e.required,p=e.disabled,b="undefined"!==typeof u&&u,g="undefined"!==typeof d&&d;return l.a.createElement(n.Fragment,null,l.a.createElement(ot.a,{required:b,error:g,className:"".concat(t.formControl," ").concat(m),fullWidth:!0},l.a.createElement(wa.a,{htmlFor:i},c),l.a.createElement(Da.a,{value:s,onChange:o,name:i,inputProps:{id:i},disabled:p},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"---")),a.map((e,t)=>l.a.createElement(B.a,{value:e[r.id],key:t},e[r.label])))))})),Ia=a(423);class Ma extends n.Component{constructor(...e){super(...e),this.state={labelWidth:0}}componentDidMount(){this.setState({labelWidth:c.a.findDOMNode(this.InputLabelRef).offsetWidth})}render(){const e=this.props,t=e.classes,a=e.list,n=e.mapping,r=e.label,c=e.div_id,i=e.changeHandler,o=e.value,s=e.css,m=this.state.labelWidth;return l.a.createElement(ot.a,{required:!0,variant:"outlined",className:"".concat(t.formControl," ").concat(s)},l.a.createElement(wa.a,{ref:e=>{this.InputLabelRef=e},htmlFor:c},r),l.a.createElement(Da.a,{value:o,onChange:i,name:c,input:l.a.createElement(Ia.a,{labelWidth:m,id:c}),fullWidth:!0},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"---")),a.map((e,t)=>l.a.createElement(B.a,{value:e[n.id],key:t},e[n.label]))))}}var Ta=Object(d.a)(e=>({formControl:{minWidth:120}}))(Ma);const Na={id:"user_id",label:"name"};function Ya(e){return e.map(({user_id:e,first_name:t,last_name:a})=>({user_id:e,name:"".concat(a,", ").concat(t)}))}var Ra=function(e){const t=e.variant,a=e.label,r=e.div_id,c=e.changeHandler,i=e.value,s=e.css,m=e.disabled,d=e.returnFullNameCallback,u=e.isCommunityStaff,p=Object(n.useState)([]),b=Object(o.a)(p,2),g=b[0],E=b[1],f=Object(n.useContext)(sa).users;if(Object(n.useEffect)(()=>{const t=ae.a.CancelToken.source();if(u){const a=e.site_code,n="".concat(ee.b,"/api/users/get_community_users_by_site/").concat(a);ae.a.get(n,{cancelToken:t.token}).then(e=>{const t=Ya(e.data);E(t)}).catch(e=>{console.log(e)})}else{const e=Ya(f);E(e)}return()=>{t.cancel()}},[f]),"undefined"!==typeof d&&d){const e=g.find(e=>e.user_id===i);"undefined"!==typeof e&&d(e.name)}return l.a.createElement(n.Fragment,null,"standard"===t&&l.a.createElement(Aa,{label:a,div_id:r,changeHandler:c,value:0===g.length?"":i,list:g,mapping:Na,css:s,disabled:m}),"outlined"===t&&l.a.createElement(Ta,{label:a,div_id:r,changeHandler:c,value:0===g.length?"":i,list:g,mapping:Na,css:s}))};const Ha=Object(n.createContext)(),Ba=({children:e})=>{const t=Object(n.useState)(""),a=Object(o.a)(t,2),r=a[0],c=a[1],i=Object(n.useState)("---"),s=Object(o.a)(i,2),m=s[0],d=s[1];return l.a.createElement(Ha.Provider,{value:{reporter_id_ct:r,setReporterIdCt:c,ct_full_name:m,setCTFullName:d}},e)},Pa=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{root:{width:"100%"},sectionHead:Object(u.a)(Object(u.a)({},t.sectionHead),{},{marginBottom:24}),AccordionSummaryContent:{justifyContent:"space-between"},invalidCandidate:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)"},validCandidate:{background:"linear-gradient(315deg, #00b712 0%, #5aff15 74%)"},partialInvalidCandidate:{background:"linear-gradient(315deg, #bbf0f3 0%, #f6d285 74%)"},inputWidth:{width:"50%"}})});function La(e){return X()(e).format("DD MMMM YYYY, HH:mm")}const Fa=()=>l.a.createElement(Qe.a,{height:60,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},l.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}));function Ua(e){const t=e.alertData,a=e.classes,r=e.expanded,c=e.handleExpansion,i=e.index,o=e.releaseFormOpenHandler,s=e.isShowingValidation,m=e.toggleValidation,d=e.validationDetails,u=Object(n.useContext)(sa).sites;let b="",g="",E="",f=[],h=!1;const _=t.general_status,O=t.is_release_time,x=t.unresolved_moms_list,j=[],k=[];let S=[];const C=t.validity_status;let w="valid";if("undefined"!==typeof C&&(w=C),"routine"===_){const e=t.data_ts,a=t.public_alert_symbol,n=t.overdue_routine_list,l=t.routine_details;b="ROUTINE RELEASE",g=La(e),E=a,S=n,l.forEach(e=>{"ND"===e.internal_alert_level&&null!==u&&e.site_id_list.forEach(e=>{const t=u.filter(t=>t.site_id===e);k.push(t[0])}),"A0"===e.internal_alert_level&&null!==u&&e.site_id_list.forEach(e=>{const t=u.filter(t=>t.site_id===e);j.push(t[0])})})}else{const e=t.site_code,a=t.release_details,n=t.internal_alert_level,l=t.trigger_list_arr,r=a.data_ts;b=e,g=La(r),E=n,f="undefined"===typeof l?[]:l,h="No new triggers"!==f&&f.length>0}b=b.toUpperCase();const D=_.toUpperCase();let A=a.alert0;return"invalid"===w?A=a.alert3:"partially valid"===w&&(A=a.alert2),l.a.createElement(Te.a,{key:"panel-".concat(i+1),expanded:r==="panel".concat(i),onChange:c("panel".concat(i))},l.a.createElement(Ne.a,{"aria-controls":"panel".concat(i,"bh-content"),id:"panel".concat(i,"bh-header"),classes:{content:a.AccordionSummaryContent,root:A}},[b,g,w.toUpperCase(),D].map((e,t)=>l.a.createElement(v.a,{key:"candidate-column-".concat(t+1),color:"textSecondary",variant:"body2"},e))),l.a.createElement(V.a,{style:{marginBottom:12}}),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},g)),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Internal Alert:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},E))),l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},"ROUTINE"===D?l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,justify:"space-between"},l.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6"},l.a.createElement("strong",null,"A0"))),j.length>0?j.map(e=>l.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_code,style:{padding:3}},l.a.createElement(v.a,{variant:"body1"},e.site_code.toUpperCase()))):l.a.createElement(v.a,{variant:"subtitle2"},"None")),l.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12,alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6"},l.a.createElement("strong",null,"ND"))),k.length>0&&"undefined"!==typeof k?k.map(e=>l.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_id,style:{padding:3}},l.a.createElement(v.a,{variant:"body1"},e.site_code.toUpperCase()))):l.a.createElement(v.a,{variant:"subtitle2"},"None")),l.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12},S.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:a.routineSitesContainer},l.a.createElement(v.a,{variant:"h6"},l.a.createElement("strong",null,"Overdue"))),S.map(e=>l.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_code,style:{justifyItems:"center",padding:3}},l.a.createElement(v.a,{variant:"body1"},e.site_code.toUpperCase())))))):l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(y.a,{item:!0,xs:12,md:12},l.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"TRIGGERS")),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},h?f.map((e,t)=>{const a=e.ts_updated,r=e.alert,c=(e.tech_info,e.trigger_id),i=e.trigger_type,o=La(a);let u="Valid",g=!1,E=!1;try{const t=e.validating_status;0===t?(u="Validating",E=!0,g=!0):null===t?(u="---",g=!0):1===t&&(g=!1)}catch(_){}try{e.invalid&&(u="Invalid")}catch(_){}const h=["surficial","rainfall","subsurface"].includes(i)&&g;return l.a.createElement(n.Fragment,{key:"trigger-".concat(i,"-").concat(r)},l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Trigger"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},r)),l.a.createElement(y.a,{item:!0,xs:4,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Trigger timestamp"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),l.a.createElement(y.a,{item:!0,xs:!0,align:h?"flex-start":"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Status:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},u)),h&&l.a.createElement(y.a,{item:!0,xs:!0,justify:"flex-end",container:!0},l.a.createElement(p.a,{onClick:m(!0,{site:b,trigger_id:c,ts_updated:a}),variant:"contained",color:"secondary",size:"small","aria-label":"Validate trigger"},"Validate")),l.a.createElement(Ot,{isShowing:s,data:d,hide:m(!1,{}),isValidating:E}),f.length>t+1&&l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)))}):l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"No new triggers")))))),"undefined"!==typeof x&&x.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"UNRESOLVED MOMS LIST")),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},x.map((e,t)=>{const a=e.moms_instance,r=e.observance_ts,c=e.op_trigger,i=a.feature.feature_type,o=a.feature_name,s="".concat(le(i)," ").concat(o.toUpperCase()),m=La(r);return l.a.createElement(n.Fragment,{key:e.moms_id},l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Feature"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},s)),l.a.createElement(y.a,{item:!0,xs:4,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Last Report"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},m)),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Alert Level"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},c)),x.length>t+1&&l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)))})))))),l.a.createElement(V.a,null),l.a.createElement(Ze.a,null,l.a.createElement(p.a,{color:"secondary",size:"small","aria-label":"Release candidate alert",startIcon:l.a.createElement(Je.a,null),onClick:o(t,_),disabled:!O},"Release")))}function za(e){const t=e.siteAlert,a=e.classes,r=e.expanded,c=e.handleExpansion,i=e.smsHandler,o=e.bulletinHandler,s=e.keyName,m=e.type,d=e.history,u=t.event,b=t.internal_alert_level,g=t.releases,E=t.day,f=t.sent_statuses,h=t.public_alert_symbol,_=t.is_onset_release,O=t.prescribed_release_time,x=t.has_alert_release_today,j=t.highest_event_alert_level,k=h.alert_level,S=Object(n.useContext)(we.a).server_time,C=f.is_sms_sent,w=f.is_bulletin_sent,D=u.validity,A=u.site,I=u.event_start,M=u.event_id,T=A.site_code,N=A.site_id,Y=T.toUpperCase(),R=La(I),H=La(D),B=g[0],P=B.release_id,L=B.data_ts,F=B.release_time;let U=L;_||(U=X()(L).add(30,"minutes")),U=La(U);const z=[Y,b];if("extended"===m){let e="";x||(e=l.a.createElement(Ke.a,{arrow:!0,title:"Don't forget to release today's site alert for extended monitoring!"},l.a.createElement(Be.a,{fontSize:"small",style:{marginLeft:8},className:a.dyna_error})));const t=l.a.createElement("span",{style:{display:"flex",alignItems:"center"}},"Day ",E,e);z.push(t)}else z.push(U,F);let W=C?l.a.createElement(Xe.a,null):"",G=w?l.a.createElement(Xe.a,null):"";const q=null!==S&&X()(S).isBefore(O)&&!_;q&&(W=l.a.createElement($e.a,null),G=l.a.createElement($e.a,null));const Q=e=>{const t=e.toLowerCase();return"bulletin"===t&&"extended"===m?"No need to send EWI bulletin on sites under extended monitoring":q?"Wait for EWI sending time":f["is_".concat(t,"_sent")]?"EWI ".concat(e," sent!"):"Send EWI ".concat(e)};return l.a.createElement(Te.a,{expanded:r===s,onChange:c(s)},l.a.createElement(Ne.a,{"aria-controls":"".concat(s,"bh-content"),id:"".concat(s,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a["alert".concat(k)]}},z.map((e,t)=>l.a.createElement(v.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e))),l.a.createElement(V.a,{style:{marginBottom:12}}),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Start:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},R)),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Validity:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},H))),l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"LATEST RELEASE")),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},[["Internal Alert",b],["Data Timestamp",La(L)],["Release Time",F]].map((e,t)=>l.a.createElement(y.a,{key:e[0],item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},e[0]),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},e[1])))))),l.a.createElement(V.a,null),l.a.createElement(Ze.a,null,l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(et.a,null),onClick:()=>d.push("/monitoring/events/".concat(M)),align:"left"},"Timeline"),l.a.createElement(Ke.a,{arrow:!0,title:Q("SMS")},l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(tt.a,null),onClick:i({release_id:P,site_code:T,site_id:N,type:m,public_alert_symbol:h,highest_event_alert_level:j}),endIcon:W,className:q&&a.dyna_error},"EWI SMS")),l.a.createElement(Ke.a,{arrow:!0,title:Q("Bulletin")},l.a.createElement("span",null,l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(at.a,null),onClick:o({release_id:P,site_code:T,site_id:N,type:m,is_bulletin_sent:w}),endIcon:G,className:q?a.dyna_error:"",disabled:"extended"===m},"Bulletin")))))}function Wa(e){const t=e.siteAlert,a=e.classes,n=e.expanded,r=e.handleExpansion,c=e.smsHandler,i=e.keyName,o=t.released_sites;let s=o[0].data_ts;return s=La(s),l.a.createElement(Te.a,{expanded:n===i,onChange:r(i)},l.a.createElement(Ne.a,{"aria-controls":"".concat(i,"bh-content"),id:"".concat(i,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a.alert0}},["ROUTINE",s].map((e,t)=>l.a.createElement(v.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e))),l.a.createElement(V.a,{style:{marginBottom:12}}),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),l.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},s))),l.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"ROUTINE SITES")),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},o.map((e,t)=>l.a.createElement(y.a,{key:"site-".concat(e.site_code),item:!0,xs:2,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},e.site_code.toUpperCase())))))),l.a.createElement(V.a,null),l.a.createElement(Ze.a,null,l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(tt.a,null),onClick:c(o)},"EWI SMS")))}var Ga=function(e){const t=e.candidateAlertsData,a=e.alertsFromDbData,r=e.releaseFormOpenHandler,c=e.history,i=Pa(),s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],u=m[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],E=b[1],f=Object(n.useState)({}),h=Object(o.a)(f,2),_=h[0],O=h[1],x=xt(),j=x.isShowing,k=x.toggle,S=xt(),C=S.isShowing,w=S.toggle,D=Object(n.useState)({}),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=l.a.useContext(Ha),B=H.reporter_id_ct,P=H.setReporterIdCt,L=H.setCTFullName,F=Object(n.useState)({}),U=Object(o.a)(F,2),z=U[0],W=U[1],G=e=>(t,a)=>{u(!!a&&e)},q=Object(n.useState)(""),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=e=>t=>{M(e);!function(e,t){const a="".concat(ee.b,"/api/chatterbox/get_ewi_message/").concat(e);ae.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(e.release_id,e=>{Z(e),k()})},J=(e,t)=>()=>{O(t),E(e)},X=e=>t=>{M(e),R(!0)};let $=[],te=[],ne=[],le=[];if(null!==a){$=a.latest,te=a.extended,ne=a.overdue,le=a.routine}return l.a.createElement("div",{className:i.root},l.a.createElement(y.a,{container:!0,className:i.sectionHeadContainer},l.a.createElement(y.a,{item:!0,xs:12,align:"right",style:{marginBottom:22}},l.a.createElement(Ra,{variant:"standard",label:"Monitoring Partner",div_id:"reporter_id_ct",changeHandler:e=>P(e.target.value),value:B,css:i.inputWidth,returnFullNameCallback:e=>L(e)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{className:i.sectionHead,variant:"h5"},"Candidate Alerts")),l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===t?l.a.createElement(Fa,null):0!==t.length?t.map((e,a)=>l.a.createElement(Ua,{key:"exp-".concat(a+1),classes:i,alertData:e,expanded:d,handleExpansion:G,releaseFormOpenHandler:r,index:a,isShowingValidation:g,toggleValidation:J,validationDetails:_,candidateAlertsData:t})):l.a.createElement(v.a,{variant:"body1",align:"center"},"No candidate alerts")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{className:i.sectionHead,variant:"h5"},"Event Monitoring")),l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?l.a.createElement(Fa,null):$.length>0?$.map((e,t)=>l.a.createElement(za,{key:"latest-".concat(t+1),keyName:"latest-".concat(t+1),classes:i,siteAlert:e,expanded:d,handleExpansion:G,smsHandler:K,bulletinHandler:X,type:"latest",history:c})):l.a.createElement(v.a,{variant:"body1",align:"center"},"No active alerts on database")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{className:i.sectionHead,variant:"h5",component:y.a,container:!0,alignItems:"center"},"Overdue Event Monitoring",l.a.createElement(Ke.a,{title:"This section shows all monitoring events that are beyond their validities. Possible causes of not updated validity: no latest release, wrong internal alert to extend validity (for cases like ND).",style:{marginLeft:8},arrow:!0},l.a.createElement(nt.a,{color:"primary"})))),l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?l.a.createElement(Fa,null):ne.length>0?ne.map((e,t)=>l.a.createElement(za,{key:"overdue-alert-".concat(t+1),keyName:"overdue-alert-".concat(t+1),classes:i,siteAlert:e,expanded:d,handleExpansion:G,smsHandler:K,index:t,bulletinHandler:X,type:"overdue",history:c})):l.a.createElement(v.a,{variant:"body1",align:"center"},"No sites with monitoring events beyond their validity")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{className:i.sectionHead,variant:"h5"},"Extended Monitoring")),l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?l.a.createElement(Fa,null):te.length>0?te.map((e,t)=>l.a.createElement(za,{key:"db-alert-".concat(t+1),keyName:"db-alert-".concat(t+1),classes:i,siteAlert:e,expanded:d,handleExpansion:G,smsHandler:K,index:t,bulletinHandler:X,type:"extended",history:c})):l.a.createElement(v.a,{variant:"body1",align:"center"},"No sites under extended monitoring")),null===a?l.a.createElement(Fa,null):"undefined"!==typeof le.released_sites&&le.released_sites.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{className:i.sectionHead,variant:"h5"},"Routine Monitoring")),l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},l.a.createElement(Wa,{key:"routine-alert-panel",keyName:"routine-alert-panel",classes:i,siteAlert:le,expanded:d,handleExpansion:G,smsHandler:e=>()=>{!function(e,t){const a="".concat(ee.b,"/api/chatterbox/get_routine_ewi_template");ae.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(0,t=>{W(e),Z(t),w()})},index:0,bulletinHandler:X,type:"routine",history:c}))),l.a.createElement(Yt,{classes:i,isOpenBulletinModal:Y,setIsOpenBulletinModal:R,releaseDetail:I})),l.a.createElement(ja,{modalStateHandler:k,modalState:j,textboxValue:Q,releaseDetail:I}),l.a.createElement(Ca,{modalStateHandler:w,modalState:C,textboxValue:Q,siteList:z}))},qa=a(1125);function Va(e){return X()(e).format("D MMMM YYYY, H:mm")}const Qa=()=>l.a.createElement(Qe.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},l.a.createElement("rect",{x:"8",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),l.a.createElement("rect",{x:"238",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),l.a.createElement("rect",{x:"469",y:"0",rx:"0",ry:"0",width:"206",height:"116"}),l.a.createElement("rect",{x:"8",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),l.a.createElement("rect",{x:"238",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),l.a.createElement("rect",{x:"469",y:"140",rx:"0",ry:"0",width:"206",height:"116"}));var Za=function(e){const t=Object(n.useState)(!1),a=Object(o.a)(t,2),r=a[0],c=a[1],i=Object(n.useState)(0),s=Object(o.a)(i,2),m=s[0],d=s[1],u=e=>t=>{c(!0),d(e)},b=()=>{c(!1)};let g="";const E=e.generatedAlertsData,f=Object(n.useContext)(sa).sites;if(null!==E&&E.length>0){g=function(e,t,a,r){const c=e.site_code,i=e.ts,o=e.internal_alert,s=e.validity,m=e.current_trigger_alerts,d=e.event_triggers,u=function(e,t){let a=null;for(let n=0;n<t.length;n+=1)if(t[n].site_code===e){a=t[n];break}return a}(c,r),b=Va(i),g=ne(u),E=[];let f=null;return m.forEach(e=>{const t=e.type,a=e.details;if("subsurface"===t)f=a.trigger_details;else{const e=a.alert_level,n=a.alert_symbol,r="rainfall"===t&&e>0?" (".concat(a.rain_gauge,")"):"";E.push(l.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t},l.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},t.charAt(0).toUpperCase()+t.slice(1)," Alert"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},n,l.a.createElement(v.a,{component:"span",variant:"body2",color:"textPrimary",align:"center"},r))))}}),l.a.createElement(lt.a,{fullWidth:!0,open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},l.a.createElement(rt.a,{id:"alert-dialog-title"},l.a.createElement("div",null,g),l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},b)),l.a.createElement(ct.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Internal Alert Level"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),""!==s&&l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Validity"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},Va(s))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"caption",color:"textPrimary"},l.a.createElement("strong",null,"OPERATIONAL ALERT STATUS"))),E.map(e=>e),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body2",color:"textPrimary"},"Subsurface Column Status")),f.length>0?f.map(e=>{const t=e.alert_symbol,a=e.tsm_name,n=e.ts;return l.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},a.toUpperCase()),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},Va(n)),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},t))}):l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"No subsurface sensors available")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),d.length>0&&l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"caption",color:"textPrimary"},l.a.createElement("strong",null,"EVENT TRIGGERS"))),d.map(e=>{const t=e.ts_updated,a=e.alert,r=e.tech_info,c=e.invalid,i=e.invalid_details,o=Va(t);return l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:a},l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},l.a.createElement("strong",null,"Trigger | ",a))),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},r)),"undefined"!==typeof c&&!0===c&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},l.a.createElement("strong",null,"INVALIDATED ALERT"))),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},"".concat(i.user.first_name," ").concat(i.user.last_name))),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},Va(i.ts_ack))),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},i.remarks))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)))}))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:a,color:"primary",autoFocus:!0},"Close")))}(E[m],r,b,f)}return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:2},null===E?l.a.createElement(Qa,null):E.map((e,t)=>function(e,t,a,n){const r=e.ts,c=e.site_code,i=e.internal_alert,o=Va(r);return l.a.createElement(y.a,{item:!0,xs:6,sm:4,lg:3,key:t},l.a.createElement(G.a,{className:"alert-card"},l.a.createElement(qa.a,{onClick:a(t)},l.a.createElement(q.a,{style:{paddingBottom:16}},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",gutterBottom:!0},o),l.a.createElement("div",{style:{display:"flex",alignItems:"baseline",alignContent:"flex-end",justifyContent:"space-between"}},l.a.createElement(v.a,{variant:"h5",component:"h2"},c.toUpperCase()),l.a.createElement(v.a,{className:"card-internal-alert",color:"textSecondary"},i))))))}(e,t,u)),g))},Ka=a(1126),Ja=a(1127),Xa=a(1128),$a=a(1129),en=a(1130);var tn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{justifyContent:"space-between",marginLeft:0},checkboxes:{paddingTop:4,paddingBottom:4},checkboxesGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}))((function(e){const t=e.classes,a=e.switchState,r=e.switchHandler,c=e.switchValue,i=e.label,o=e.changeHandler,s=e.choices;return l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:a,onChange:r,value:c}),label:i,labelPlacement:"start"}),a?l.a.createElement(n.Fragment,null,l.a.createElement(fa.a,{className:t.checkboxesGroup},s.map(({state:e,value:a,label:n},r)=>{const c=e.status,i=e.disabled;return l.a.createElement(mt.a,{key:r,control:l.a.createElement(Lt.a,{checked:c,onChange:o(a),value:a,className:t.checkboxes,disabled:i}),label:n})})),l.a.createElement(E.a,null,"Add required if required")):l.a.createElement("div",null))}));const an=(e,t)=>(a,n)=>l=>{const r="timestamp"===a?l:l.target.value,c=parseInt(n.charAt(1),10);e({action:"UPDATE_DETAILS",trigger_type:t,value:{alert_level:c,[a]:r}})},nn=(e,t)=>a=>{const n=a.target.checked;if(e({action:"TOGGLE_SWITCH",trigger_type:t,value:n}),["on_demand","earthquake"].includes(t)){let a,l=null;"on_demand"===t?(a={reason:"",reporterId:""},l=12):"earthquake"===t&&(a={magnitude:"",longitude:"",latitude:""},l=11),e({action:n?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:Object(u.a)({alert_level:1,timestamp:null,tech_info:"",internal_sym_id:l},a)})}},ln=(e,t)=>a=>n=>{const l=n.target.checked;let r=null;"surficial"===t?2===a?r=6:3===a&&(r=4):"subsurface"===t&&(2===a?r=3:3===a&&(r=1)),e({action:l?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:{alert_level:a,status:l,disabled:!1,timestamp:null,tech_info:"",internal_sym_id:r}})},rn=(e,t)=>a=>{const n=a.target.value;e({action:"REMOVE_TRIGGER",trigger_type:t,value:"clear_all"}),e({action:"ADD_TRIGGER",trigger_type:t,value:{alert_level:parseInt(n,10),timestamp:null,tech_info:"",internal_sym_id:8}})},cn=(e,t,a)=>n=>{const l=n.target.value;t({action:"UPDATE_DETAILS",trigger_type:a,value:{alert_level:1,[e]:l}})};var on=Object(d.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.changeHandler,r=e.labelFor,c=e.trigger_timestamp,i=e.tech_info;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Trigger Timestamp (".concat(r,")"),value:c,onChange:a("timestamp",r),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,label:"Technical Information (".concat(r,")"),multiline:!0,rowsMax:"2",placeholder:'Enter technical info for "'.concat(r,'" trigger'),value:i,onChange:a("tech_info",r),fullWidth:!0})))}));var sn=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=e.triggersReleased,i=a.subsurface,o=i.switchState,s=i.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach(e=>{const t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(u.a)(Object(u.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0});const d=m.trigger_2,p=m.trigger_3,b=m.trigger_nd,g=[{state:d,value:2,label:"Release trigger (s2)"},{state:p,value:3,label:"Release trigger (S3)"}],E=c.filter(e=>"subsurface"===e.trigger_source);if(E.length>0){const e=E.pop();g.push({state:b,value:"nd",label:"No data ([s/S]0)"}),-1===e.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},l.a.createElement(tn,{label:"Subsurface",switchState:o,switchHandler:nn(r,"subsurface"),switchValue:"subsurface_switch",choices:g,changeHandler:ln(r,"subsurface")})),d.status&&o?l.a.createElement(on,{labelFor:"s2",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:an(r,"subsurface")}):l.a.createElement("div",null),p.status&&o?l.a.createElement(on,{labelFor:"S3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:an(r,"subsurface")}):l.a.createElement("div",null))}));var mn=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=e.triggersReleased,i=a.surficial,o=i.switchState,s=i.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach(e=>{const t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(u.a)(Object(u.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0});const d=m.trigger_2,p=m.trigger_3,b=m.trigger_nd,g=[{state:d,value:2,label:"Release trigger (g2)"},{state:p,value:3,label:"Release trigger (G3)"}],E=c.filter(e=>"surficial"===e.trigger_source);if(E.length>0){const e=E.pop();g.push({state:b,value:"nd",label:"No data ([g/G]0)"}),-1===e.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},l.a.createElement(tn,{label:"Surficial",switchState:o,switchHandler:nn(r,"surficial"),switchValue:"surficial_switch",choices:g,changeHandler:ln(r,"surficial")})),d.status?l.a.createElement(on,{labelFor:"g2",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:an(r,"surficial")}):l.a.createElement("div",null),p.status?l.a.createElement(on,{labelFor:"G3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:an(r,"surficial")}):l.a.createElement("div",null))}));var dn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{justifyContent:"space-between",marginLeft:0},radios:{paddingTop:4,paddingBottom:4},radioGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}))((function(e){const t=e.classes,a=e.id,r=e.label,c=e.changeHandler,i=e.radioValue,o=e.choices,s=e.switchState,m=e.switchValue,d=e.switchHandler;return l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:s,onChange:d,value:m}),label:r,labelPlacement:"start"}),s?l.a.createElement(n.Fragment,null,l.a.createElement(st.a,{className:t.radioGroup,"aria-label":r,name:a,value:i,onChange:c},o.map(({value:e,label:a},n)=>l.a.createElement(mt.a,{key:n,value:e,control:l.a.createElement(dt.a,{className:t.radios}),label:a}))),l.a.createElement(E.a,null,"Add required if required")):l.a.createElement("div",null))}));var un=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=e.triggersReleased,i=a.rainfall,o=i.switchState,s=i.triggers;let m={alert_level:""};0!==s.length&&s.forEach(e=>{m=Object(u.a)(Object(u.a)({},e),{},{alert_level:"".concat(e.alert_level)})});const d=[{value:"1",label:"Release new trigger"}],p=c.filter(e=>"rainfall"===e.trigger_source);if(p.length>0){p.pop();d.push({value:"-1",label:"No data (R0)"},{value:"-2",label:"Intermediate threshold (rx)"})}return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},l.a.createElement(dn,{label:"Rainfall",id:"rainfall",switchState:o,switchHandler:nn(r,"rainfall"),switchValue:"rainfall_switch",radioValue:m.alert_level,choices:d,changeHandler:rn(r,"rainfall")})),"1"===m.alert_level&&o?l.a.createElement(on,{labelFor:"R1",trigger_timestamp:m.timestamp,tech_info:m.tech_info,changeHandler:an(r,"rainfall")}):l.a.createElement("div",null))}));var pn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{justifyContent:"space-between",marginLeft:0},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=a.earthquake,i=c.switchState,o=c.triggers;let s={timestamp:null,tech_info:"",magnitude:null,latitude:null,longitude:null};0!==o.length&&(s=Object(u.a)({},o[0]));const m=s,d=m.timestamp,p=m.tech_info,b=m.magnitude,E=m.latitude,f=m.longitude;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:i?t.groupGridContainer:""},l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:i,onChange:nn(r,"earthquake"),value:"switch_earthquake"}),label:"Earthquake",labelPlacement:"start"}))),i?l.a.createElement(n.Fragment,null,l.a.createElement(on,{labelFor:"e1",trigger_timestamp:d,tech_info:p,changeHandler:an(r,"earthquake")}),l.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,id:"magnitude",label:"Magnitude",value:b,onChange:cn("magnitude",r,"earthquake"),type:"number"})),l.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,id:"latitude",label:"Latitude",value:E,onChange:cn("latitude",r,"earthquake"),type:"number"})),l.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,id:"longitude",label:"Longitude",value:f,onChange:cn("longitude",r,"earthquake"),type:"number"}))):l.a.createElement("div",null))}));var bn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{justifyContent:"space-between",marginLeft:0},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=a.on_demand,i=c.switchState,o=c.triggers;let s={timestamp:null,tech_info:"",reason:"",reporterId:1};0!==o.length&&(s=Object(u.a)({},o[0]));const m=s,d=m.timestamp,p=m.tech_info,b=m.reason;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:i?t.groupGridContainer:""},l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:i,onChange:nn(r,"on_demand"),value:"switch_on_demand"}),label:"On Demand",labelPlacement:"start"}))),i?l.a.createElement(n.Fragment,null,l.a.createElement(on,{labelFor:"d1",trigger_timestamp:d,tech_info:p,changeHandler:an(r,"on_demand")}),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,id:"reason",label:"Reason",value:b,onChange:cn("reason",r,"on_demand"),placeholder:"Enter reason of on-demand request",multiline:!0,rowsMax:2,fullWidth:!0}))):l.a.createElement("div",null))}));const gn=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},formControl:{width:"100%"},formLabel:{justifyContent:"space-between",marginLeft:0,color:"#f50057"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}));function En(e){const t=e.setModalTitle,a=e.generalData,r=e.classes,c=e.handleEventChange,i=e.handleDateTime,o=e.setGeneralData,s=e.isUpdatingRelease,m=e.changeState,d=a.siteId,p=a.dataTimestamp,b=a.releaseTime,g=a.reporterIdMt,E=a.reporterIdCt;Object(n.useEffect)(()=>{t("Provide information to the following fields.")},[]);return l.a.createElement(n.Fragment,null,s&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",color:"secondary"},"You chose a data timestamp that has been released. You are allowed to update release details but changes on triggers and alert level cannot be accepted. For those kind of changes, please contact the Software Infra Devs. Thank you."))),l.a.createElement(y.a,{item:!0,xs:12,className:r.inputGridContainer},l.a.createElement(ua,{value:d,changeHandler:e=>(e=>{const t=e.label,n=e.data;o(Object(u.a)(Object(u.a)({},a),{},{siteId:e,address:t,siteCode:n.site_code})),m("siteId",e)})(e)})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:r.inputGridContainer},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Data timestamp",value:p,onChange:i("dataTimestamp"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:r.inputGridContainer},l.a.createElement(Ja.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:b,onChange:i("releaseTime"),clearable:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:r.inputGridContainer},l.a.createElement(Ra,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",changeHandler:c("reporterIdMt"),value:g,disabled:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:r.inputGridContainer},l.a.createElement(Ra,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",changeHandler:c("reporterIdCt"),value:E})))}function fn(e){const t=e.classes,a=e.triggersState,r=e.setTriggersState,c=e.setModalTitle,i=e.hasNoGroundData,o=e.setHasNoGroundData,s=e.triggersReleased,m=e.alert_level,d=e.setAlert0,u=e.isAlert0,p=a.subsurface.switchState,b=a.surficial.switchState,g=a.moms.switchState;return Object(n.useEffect)(()=>{c("Toggle ON all the triggers to be included in the internal alert computation, otherwise toggle them OFF. Fill in the required fields for each selected trigger.")},[]),l.a.createElement(n.Fragment,null,0!==m&&l.a.createElement(y.a,{item:!0,xs:12,className:u?t.groupGridContainer:""},l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:u,onChange:e=>d(e.target.checked),value:"lower_to_a0"}),label:"Lower to Alert 0",labelPlacement:"start"}))),!p&&!b&&!g&&m<=1&&l.a.createElement(y.a,{item:!0,xs:12,className:i?t.groupGridContainer:""},l.a.createElement(ot.a,{component:"fieldset",className:t.formControl},l.a.createElement(mt.a,{className:t.formLabel,control:l.a.createElement(Ka.a,{checked:i,onChange:e=>o(e.target.checked),value:"has_no_ground_data"}),label:"No Ground Data (ND)",labelPlacement:"start"}))),!1===u&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",color:"secondary"},"Ground-Related Triggers")),l.a.createElement(sn,{triggersState:a,setTriggersState:r,triggersReleased:s}),l.a.createElement(mn,{triggersState:a,setTriggersState:r,triggersReleased:s}),l.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},l.a.createElement(v.a,{variant:"h6",color:"secondary"},"Secondary Triggers")),l.a.createElement(un,{triggersState:a,setTriggersState:r,triggersReleased:s}),l.a.createElement(pn,{triggersState:a,setTriggersState:r}),l.a.createElement(bn,{triggersState:a,setTriggersState:r})))}function hn(e){const t=e.classes,a=e.handleEventChange,r=e.generalData,c=e.internalAlertLevel,i=e.setModalTitle,s=e.mtFullName,m=e.ctFullName,d=e.ewiPayload,u=e.isAlertRecomputing,p=r.siteId,b=r.dataTimestamp,E=r.releaseTime,f=r.comments,h=Object(n.useState)(null),_=Object(o.a)(h,2),O=_[0],j=_[1];Object(n.useEffect)(()=>{i("Review release summary. Add comment if necessary.");let e=[];"undefined"!==typeof d.trigger_list_arr&&(e=d.trigger_list_arr);let t=l.a.createElement(v.a,{variant:"body2",color:"textPrimary",align:"center"},"No triggers included in this release.");e.length>0&&(t=e.map((e,t)=>{const a=e.ts_updated,r=e.alert_level,c=e.trigger_type,i=e.tech_info,o=c.charAt(0).toUpperCase()+c.slice(1),s=X()(a).format("DD MMMM YYYY, HH:mm");return l.a.createElement(n.Fragment,{key:"".concat(t+1)},l.a.createElement(y.a,{item:!0,xs:6,align:"center"},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Trigger"),l.a.createElement(v.a,{variant:"body2",color:"textPrimary"},"".concat(o," Alert ").concat(r))),l.a.createElement(y.a,{item:!0,xs:6,align:"center"},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Trigger timestamp"),l.a.createElement(v.a,{variant:"body2",color:"textPrimary"},s)),l.a.createElement(y.a,{item:!0,xs:12,align:"center",style:{paddingBottom:20}},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Tech info"),l.a.createElement(v.a,{variant:"caption",color:"textPrimary"},i)))})),j(t)},[d]);const k=X()(b).format("DD MMMM YYYY, HH:mm"),S=X()(E).format("HH:mm");return l.a.createElement(n.Fragment,null,u?l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(x.a,null)):l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Site"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},p.label)),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Internal Alert"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},c)),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Data Timestamp"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},k)),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Release Time"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},S)),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"MT Personnel"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},s)),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"CT Personnel"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary"},m)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{className:t.divider})),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"button",color:"textSecondary"},"Triggers")),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,align:"center"},O)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{className:t.divider})),l.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},l.a.createElement(g.a,{label:"Comments",multiline:!0,rowsMax:"2",placeholder:"Enter additional comments necessary",value:f,onChange:a("comments"),fullWidth:!0}))))}var _n=function(e){const t=e.activeStep,a=e.generalData,r=e.setGeneralData,c=e.setInternalAlertLevel,i=e.internalAlertLevel,s=e.setPublicAlertLevel,m=e.isUpdatingRelease,d=e.currentTriggersStatus,p=e.setDBSavedTriggers,b=e.siteCurrentAlertLevel,g=e.setSiteCurrentAlertLevel,E=gn(),f=Object(u.a)({classes:E},e),h=Object(j.a)(),_=h.first_name,O=h.last_name,x="".concat(O,", ").concat(_),k=l.a.useContext(Ha).ct_full_name,S=Object(n.useState)([...d]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=(e,t)=>{if("siteId"===e){!function(e,t){const a=e.site_id;let n="".concat(ee.b,"/api/monitoring/get_site_alert_details");n+="?site_id=".concat(a),me(n,t)}({site_id:t.value},e=>{console.log(e);const t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_sources,l=e.alert_level;D(n),p(n),s(a),c(t),g(l)})}else r(Object(u.a)(Object(u.a)({},a),{},{[e]:t}))},I=e=>t=>{A(e,t)},M=e=>t=>{const a=t.target.value;A(e,a)},T=["What are the release details?","List the triggers.","Add Comments and Review Release Summary"];return l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},(e=>{switch(e){case 0:return l.a.createElement(En,Object.assign({},f,{handleDateTime:I,handleEventChange:M,isUpdatingRelease:m,changeState:A}));case 1:return l.a.createElement(fn,Object.assign({},f,{triggersReleased:w,alert_level:b}));case 2:return l.a.createElement(hn,Object.assign({},f,{mtFullName:x,ctFullName:k,internalAlertLevel:i,handleEventChange:M}));case 3:return l.a.createElement(v.a,{variant:"body1"},"Early warning information released! Please wait for the dashboard to update or check the site event timeline to confirm if EWI is released.");default:return"Uknown stepIndex"}})(t),l.a.createElement("div",{className:E.root},l.a.createElement(v.a,{className:E.instructions}),l.a.createElement(Xa.a,{activeStep:t,alternativeLabel:!0},T.map(e=>l.a.createElement($a.a,{key:e},l.a.createElement(en.a,null)))))))};const yn=Object(O.a)(e=>({inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}}}));function vn(e,t){const a=t.rainfall;let n=!1;return a.switchState&&a.triggers.forEach(e=>{e.alert_level<0&&(n=!0)}),e||n}const On={subsurface:{switchState:!1,triggers:[]},surficial:{switchState:!1,triggers:[]},moms:{switchState:!1,triggers:[]},rainfall:{switchState:!1,triggers:[]},earthquake:{switchState:!1,triggers:[]},on_demand:{switchState:!1,triggers:[]}};function xn(e,{action:t,trigger_type:a,value:n}){let l={},r=[];if("RESET_STATE"!==t){const t=e[a];l=Object(u.a)({},t);r=l.triggers}switch(t){case"TOGGLE_SWITCH":return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},l),{},{switchState:n})});case"ADD_TRIGGER":return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},l),{},{triggers:[...r,n]})});case"REMOVE_TRIGGER":let t;return t="clear_all"===n?[]:r.filter(e=>e.alert_level!==n.alert_level),Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},l),{},{triggers:t})});case"UPDATE_DETAILS":const c=r.map(e=>e.alert_level===n.alert_level?Object(u.a)(Object(u.a)({},e),n):e);return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},l),{},{triggers:c})});case"RESET_STATE":return Object(u.a)({},On);default:return e}}var jn=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=e.setIsOpenRoutineModal,d=yn(),b=Object(j.a)().user_id,g=Object(n.useState)({}),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)(0),v=Object(o.a)(_,2),O=v[0],x=v[1],k=Object(n.useState)(!0),S=Object(o.a)(k,2),C=S[0],w=S[1],D=[1,2,3],A=Object(n.useState)(""),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)(""),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)(""),P=Object(o.a)(B,2),L=P[0],F=P[1],U=l.a.useContext(Ha).reporter_id_ct,z={dataTimestamp:null,releaseTime:X()(),siteId:{},siteCode:"",address:"",reporterIdCt:U,reporterIdMt:b,comments:"",publicAlertSymbol:"",publicAlertLevel:"",triggerListStr:""},W=Object(n.useState)(Object(u.a)({},z)),G=Object(o.a)(W,2),q=G[0],V=G[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],$=Object(n.useState)(!1),te=Object(o.a)($,2),ae=te[0],ne=te[1],le=Object(n.useState)(0),re=Object(o.a)(le,2),ce=re[0],ie=re[1],oe=Object(n.useState)(!1),de=Object(o.a)(oe,2),ue=de[0],pe=de[1],be=Object(n.useReducer)(xn,Object(u.a)({},On)),ge=Object(o.a)(be,2),Ee=ge[0],fe=ge[1],he=Object(n.useState)([]),_e=Object(o.a)(he,2),ye=_e[0],ve=_e[1],Oe=Object(n.useState)([]),xe=Object(o.a)(Oe,2),je=xe[0],ke=xe[1],Se=Object(i.b)().enqueueSnackbar;Object(n.useEffect)(()=>{const e=q.dataTimestamp,t=q.siteCode;if("object"===typeof e&&X.a.isMoment(e)){const r=X()(e).format("YYYY-MM-DD HH:mm:00");a=t,n=r,l=e=>{Object.entries(e).length>1&&ne(!0)},me("".concat(ee.b,"/api/monitoring/get_monitoring_releases_by_data_ts/").concat(a,"/").concat(n),l)}var a,n,l},[q.dataTimestamp]),Object(n.useEffect)(()=>{if(null!==c&&"routine"!==c.general_status){const e=c.site_id,t=c.site_code,a=c.public_alert_level,n=c.public_alert_symbol,l=c.release_details,r=c.trigger_list_arr,i=c.has_ground_data,o=c.non_triggering_moms,s=c.internal_alert_level,m=c.current_triggers_status,d=c.saved_event_triggers,p=c.to_extend_validity,g=l.data_ts,E=l.trigger_list_str;T(s);const _=[];r.forEach(e=>{if(!0!==e.invalid&&_.push(e),"moms"===e.trigger_type){const t=e.moms_list;e.moms_id_list=t.map(e=>e.moms_id)}});let y=null;if(o.length>0){y={moms_id_list:o.map(e=>e.moms_id)}}h(Object(u.a)(Object(u.a)({},f),{},{site_id:e,site_code:t,public_alert_level:a,public_alert_symbol:n,release_details:{data_ts:g,trigger_list_str:E,release_time:X()().format("HH:mm:00")},publisher_details:{publisher_mt_id:b,publisher_ct_id:U},trigger_list_arr:_,non_triggering_moms:y,to_extend_validity:p}));J(!i);const v=Object(u.a)(Object(u.a)({},q),{},{reporterIdCt:U,dataTimestamp:X()(g),siteId:{value:e,label:t.toUpperCase()},siteCode:t,triggerListStr:E,publicAlertSymbol:n,publicAlertLevel:a,nonTriggeringMoms:o});V(Object(u.a)({},v)),fe({action:"RESET_STATE"}),"undefined"!==typeof d&&ve(d);const O=[];r.forEach(e=>{const t=e.trigger_type,a=e.alert_level,n=e.ts_updated,l=e.internal_sym_id,r=e.tech_info,c=e.alert;if("undefined"===typeof e.invalid){let i={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};fe(i);const o={alert:c,alert_level:a,internal_sym_id:l,tech_info:r,disabled:!1,status:!0,timestamp:X()(n)};if("moms"===t){const t=e.moms_list;o.moms_list=t,o.moms_id_list=t.map(e=>e.moms_id)}if(i={action:"ADD_TRIGGER",trigger_type:t,value:o},fe(i),t in["on demand","earthquake"]){let e=null;switch(t){case"on demand":e={action:"UPDATE_TRIGGER",trigger_type:t,value:{od_details:{request_ts:"",narrative:""}}};break;case"earthquake":e={action:"UPDATE_TRIGGER",trigger_type:t,value:{eq_details:{magnitude:"",latitude:"",longitude:""}}}}null!=e&&fe(e)}}else O.push(t)}),ke(m),m.forEach(e=>{const t=e.trigger_source,a=e.alert_level;if(O.includes(t))return;let n=a;-1===a&&"rainfall"!==t&&(n="nd");let l=!0;a<=1&&["surficial","subsurface"].includes(t)&&(l=!1);let r={action:"TOGGLE_SWITCH",trigger_type:t,value:l};fe(r);r={action:"ADD_TRIGGER",trigger_type:t,value:{status:!0,disabled:!1,alert_level:n,timestamp:null,tech_info:""}},fe(r)}),x(2)}else V(Object(u.a)({},z)),fe({action:"RESET_STATE"}),ve([]),ke([]),T(""),x(0)},[c,U]);const Ce=Object(n.useState)(!1),we=Object(o.a)(Ce,2),De=we[0],Ae=we[1];Object(n.useEffect)(()=>{if(w(!0),0===O){const e=q.siteId,t=q.dataTimestamp,a=q.releaseTime,n=q.reporterIdCt,l=q.reporterIdMt;w(""===e||null===t||null===a||""===n||""===l)}else if(1===O){const e=Object.keys(Ee);let t=!1;for(let a=0;a<e.length;a+=1){const n=Ee[e[a]],l=n.switchState,r=n.triggers;if(l){const n=r.length;if(0===n)t=!0;else for(let l=0;l<n;l+=1)if([1,2,3].includes(r[l].alert_level)){if("on_demand"===e[a]){const e=r[l],a=e.reason,n=e.reporterId,c=e.tech_info,i=e.timestamp;""!==c&&""!==i&&""!==a&&""!==n||(t=!0)}else if("earthquake"===e[a]){const e=r[l],a=e.tech_info,n=e.timestamp,c=e.magnitude,i=e.longitude,o=e.latitude;""!==a&&""!==n&&""!==c&&""!==i&&""!==o||(t=!0)}else{const e=r[l],a=e.tech_info,n=e.timestamp;""!==a&&null!==n||(t=!0)}break}}}w(t)}else if(2===O){w(""===U||De)}},[q,Ee,O,U,De]),Object(n.useEffect)(()=>{const e=Ee.subsurface,t=Ee.surficial;(e.switchState||t.switchState)&&J(!1)},[Ee.subsurface,Ee.surficial]);const Ie=()=>{r(),x(0),s(null),V(Object(u.a)({},z)),h({}),pe(!1),J(!1)};return l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Alert Release Form"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,L),l.a.createElement(_n,{activeStep:O,isUpdatingRelease:ae,triggersState:Ee,setTriggersState:fe,generalData:q,setGeneralData:V,internalAlertLevel:M,setInternalAlertLevel:T,publicAlertLevel:R,setPublicAlertLevel:H,setModalTitle:F,ewiPayload:f,hasNoGroundData:K,setHasNoGroundData:J,currentTriggersStatus:je,setDBSavedTriggers:ve,siteCurrentAlertLevel:ce,setSiteCurrentAlertLevel:ie,isAlert0:ue,setAlert0:pe,isAlertRecomputing:De})),l.a.createElement(ut.a,null,O===D.length?l.a.createElement("div",null,l.a.createElement(p.a,{onClick:Ie,color:"primary"},"Okay")):l.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},l.a.createElement(y.a,{item:!0,xs:!0,style:{display:null===c?"flex":"none"}},l.a.createElement(p.a,{onClick:m,className:d.backButton},"Release Routine")),l.a.createElement(y.a,{item:!0,xs:!0,align:"right"},l.a.createElement(p.a,{onClick:Ie,color:"primary"},"Cancel"),l.a.createElement(p.a,{disabled:0===O,onClick:()=>{x(e=>e-1)},className:d.backButton},"Back"),l.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{x(e=>e+1);const e=q.siteId,t=q.siteCode,a=q.publicAlertSymbol,n=q.dataTimestamp,l=q.releaseTime,r=q.reporterIdMt,c=q.reporterIdCt,i=q.comments,o=q.triggerListStr;let s=[],m=[],d={};if(0===O)h(Object(u.a)(Object(u.a)({},f),{},{site_id:e.value,site_code:t,public_alert_level:R,public_alert_symbol:a,release_details:{data_ts:X()(n).format("YYYY-MM-DD HH:mm:00"),trigger_list_str:o,release_time:X()(l).format("HH:mm:00")},publisher_details:{publisher_mt_id:r,publisher_ct_id:c},non_triggering_moms:[]}));else if(1===O){s=function(e){const t=[];return Object.keys(e).forEach(a=>{if(e[a].switchState){const n=e[a].triggers,l="on_demand"===a?"on demand":a;n.forEach(e=>{const n=e.timestamp,r=e.alert_level,c=e.internal_sym_id,i=e.tech_info;let o=null;null!==n&&(o=n.format("YYYY-MM-DD HH:mm:00"));let s,m=r;switch("nd"===r?m=-1:"rx"===r&&(m=-2),a){case"moms":s={moms_id_list:e.moms_id_list};break;case"on_demand":s={od_details:{request_ts:o,narrative:e.reason,reporter_id:e.reporterId}};break;case"earthquake":const t=e.magnitude,a=e.latitude,n=e.longitude;s={eq_details:{magnitude:parseFloat(t),latitude:parseFloat(a),longitude:parseFloat(n)}};break;default:s={}}const d=Object(u.a)(Object(u.a)({},s),{},{alert_level:m,internal_sym_id:c,tech_info:i,trigger_type:l,ts_updated:o});t.push(d)})}}),t}(Ee),m=ye;const e={latest_trigger_list:s,current_trigger_list:m,has_no_ground_data:K,is_alert_0:ue};console.log("JSON data for alert generation recomputation",e),Ae(!0);const t=s.filter(e=>e.alert_level>0);!function(e,t){se("".concat(ee.b,"/api/monitoring/create_release_details"),e,t)}(e,e=>{const a=e.internal_alert_level,n=e.public_alert_level,l=e.trigger_list_str,r=e.public_alert_symbol;H(n),T(a),h(Object(u.a)(Object(u.a)({},f),{},{public_alert_level:n,public_alert_symbol:r,internal_alert_level:a,release_details:Object(u.a)(Object(u.a)({},f.release_details),{},{trigger_list_str:l}),trigger_list_arr:t,to_extend_validity:vn(K,Ee)})),Ae(!1)})}else if(O===D.length-1){F(""),d=f,d.release_details.comments=i;const e=Se("Inserting EWI release...",{variant:"warning",persist:!0});d.snackbar_key=e,h(d),console.log("Submitting data...",f),_t("insert_ewi",f)}},disabled:C},O===D.length-1?"Submit":"Next"))))))})),kn=a(351),Sn=a(1131),Cn=a(171),wn=a(168),Dn=a(624);const An=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{margin:"auto"},cardHeader:{padding:e.spacing(1,2)},list:{width:200,height:230,backgroundColor:e.palette.background.paper,overflow:"auto"},button:{margin:e.spacing(.5,0)}}));function In(e,t){return e.filter(e=>!t.some(t=>t.value===e.value))}function Mn(e,t){return e.filter(e=>t.some(t=>t.value===e.value))}var Tn=function(e){const t=e.routineData,a=e.setRoutineData,r=e.a0SiteList,c=e.setA0SiteList,i=e.NDSiteList,s=e.setNDSiteList,m=e.dataTimestamp,d=e.setDataTimestamp,b=An(),g=l.a.useContext(Ha).reporter_id_ct,E=Object(n.useState)(null),f=Object(o.a)(E,2),h=f[0],_=f[1];Object(n.useEffect)(()=>{_(t.release_time)},[t]);const v=t.reporter_id_mt,O=e=>n=>{const l=Object(u.a)(Object(u.a)({},t),{},{[e]:n});a(l),"data_ts"===e&&d(X()(n).format("YYYY-MM-DD HH:mm:00"))},x=l.a.useState([]),j=Object(o.a)(x,2),k=j[0],S=j[1],C=Mn(k,r.site_id_list),w=Mn(k,i.site_id_list),D=(e,t)=>()=>{const a=k.findIndex(t=>t.value===e),n=[...k];if(-1===a){const a=t.find(t=>t.value===e);n.push(a)}else n.splice(a,1);S(n)},A=e=>Mn(k,e).length,I=e=>()=>{var t,a;A(e)===e.length?S(In(k,e)):S((t=k,a=e,[...t,...In(a,t)]))},M=(e,t)=>{const a=t.site_id_list;return l.a.createElement(G.a,null,l.a.createElement(Sn.a,{className:b.cardHeader,avatar:l.a.createElement(Lt.a,{onClick:I(a),checked:A(a)===a.length&&0!==a.length,indeterminate:A(a)!==a.length&&0!==A(a),disabled:0===a.length,inputProps:{"aria-label":"all site_id_list selected"}}),title:e}),l.a.createElement(V.a,null),l.a.createElement(kn.a,{className:b.list,dense:!0,component:"div",role:"list"},a.map(e=>{const t=e.value,n=e.label,r="transfer-list-all-item-".concat(t,"-label");return l.a.createElement(Cn.a,{key:t,role:"listitem",button:!0,onClick:D(t,a)},l.a.createElement(Dn.a,null,l.a.createElement(Lt.a,{checked:k.some(e=>e.value===t),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":r}})),l.a.createElement(wn.a,{id:r,primary:n}))}),l.a.createElement(Cn.a,null)))};return l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Data timestamp",value:m,onChange:O("data_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,error:null===m})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},l.a.createElement(Ja.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:h,onChange:O("release_time"),clearable:!0})),l.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center",className:b.root},l.a.createElement(y.a,{item:!0},M("A0 Sites",r)),l.a.createElement(y.a,{item:!0},l.a.createElement(y.a,{container:!0,direction:"column",alignItems:"center"},l.a.createElement(p.a,{variant:"outlined",size:"small",className:b.button,onClick:()=>{s(Object(u.a)(Object(u.a)({},i),{},{site_id_list:i.site_id_list.concat(C)})),c(Object(u.a)(Object(u.a)({},r),{},{site_id_list:In(r.site_id_list,C)})),S(In(k,C))},disabled:0===C.length,"aria-label":"move selected NDSiteList"},">"),l.a.createElement(p.a,{variant:"outlined",size:"small",className:b.button,onClick:()=>{c(Object(u.a)(Object(u.a)({},r),{},{site_id_list:r.site_id_list.concat(w)})),s(Object(u.a)(Object(u.a)({},i),{},{site_id_list:In(i.site_id_list,w)})),S(In(k,w))},disabled:0===w.length,"aria-label":"move selected a0SiteList"},"<"))),l.a.createElement(y.a,{item:!0},M("ND Sites",i))),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},l.a.createElement(Ra,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:v,disabled:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},l.a.createElement(Ra,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:g,disabled:!0}))))};function Nn(e){let t=[];return e.length>0&&(t=e.map(e=>{const t=e.site_code;return{state:!0,value:e.site_id,label:t.toUpperCase(),is_disabled:!1}})),t.sort((e,t)=>e.site_id>t.site_id)}var Yn=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=Object(j.a)().user_id,d=l.a.useContext(Ha).reporter_id_ct,b=Object(n.useContext)(sa).sites,g=Object(n.useState)({}),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(i.b)().enqueueSnackbar,y={public_alert_symbol:"A0",public_alert_level:0,data_ts:null,release_time:X()(),general_status:"routine",reporter_id_ct:d,reporter_id_mt:m,non_triggering_moms:{}},v=Object(n.useState)(Object(u.a)({},y)),O=Object(o.a)(v,2),x=O[0],k=O[1],S=Object(n.useState)(Object(u.a)({},{site_id_list:[],internal_alert_level:"A0",trigger_list_str:null})),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(Object(u.a)({},{site_id_list:[],internal_alert_level:"ND",trigger_list_str:null})),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)(null),P=Object(o.a)(B,2),L=P[0],F=P[1],U=0===w.site_id_list.length&&0===M.site_id_list.length||""===d;return Object(n.useEffect)(()=>{k(Object(u.a)({},y));const e=Nn(b);H(e)},[b]),Object(n.useEffect)(()=>{var e,t;null===c&&(null!==L?(e=L,t=e=>{const t=Nn(e.unreleased_sites);D(Object(u.a)(Object(u.a)({},w),{},{site_id_list:t}))},me("".concat(ee.b,"/api/monitoring/get_unreleased_routine_sites/").concat(e),t)):(D(Object(u.a)(Object(u.a)({},w),{},{site_id_list:[]})),T(Object(u.a)(Object(u.a)({},M),{},{site_id_list:[]}))))},[L,c]),Object(n.useEffect)(()=>{if("undefined"!==typeof c&&null!==c&&"routine"===c.general_status){const e=Object(u.a)({},c);delete e.routine_details;const t=Object(u.a)(Object(u.a)({},y),e);k(t),F(e.data_ts);Object(u.a)({},c).routine_details.forEach(e=>{const t=e.site_id_list,a=e.internal_alert_level,n=R.filter(e=>t.includes(e.value)),l=Object(u.a)(Object(u.a)({},e),{},{site_id_list:n});"A0"===a?D(l):T(l)}),h(Object(u.a)({},f))}},[c,R]),l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Routine Release Form"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Transfer site codes to their respective list if needed. Put sites with ground data on A0 Sites list while put sites without ground data on ND Sites."),l.a.createElement(Tn,{routineData:x,setRoutineData:k,a0SiteList:w,setA0SiteList:D,NDSiteList:M,setNDSiteList:T,dataTimestamp:L,setDataTimestamp:F})),l.a.createElement(ut.a,null,l.a.createElement("div",null,l.a.createElement("div",null,l.a.createElement(p.a,{onClick:()=>{r(),s(null),F(null)},color:"primary"},"Cancel"),l.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{const e=X()(x.data_ts).format("YYYY-MM-DD HH:mm:00"),t=X()(x.release_time).format("HH:mm:ss"),a=_("Inserting Routine EWI release...",{variant:"warning",persist:!0}),n=Object(u.a)(Object(u.a)({},x),{},{data_timestamp:e,release_time:t,reporter_id_ct:d,routine_details:[Object(u.a)({},w),Object(u.a)({},M)],snackbar_key:a});console.log("Submitting data...",n),_t("insert_ewi",n),r()},disabled:U},"Submit"))))))})),Rn=a(1132),Hn=a(1133),Bn=a(1134),Pn=a(427),Ln=a.n(Pn);function Fn(e){const t=e,a=e.ts_posted,n=e.ts_expiration,l=e.site_id_list,r=[];return null!==l&&l.forEach(({value:e})=>{r.push(e)}),t.user_id=Object(j.a)().user_id,t.ts_posted=X()(a).format("YYYY-MM-DD HH:mm:ss"),"Invalid date"!==n&&(t.ts_expiration=X()(n).format("YYYY-MM-DD HH:mm:ss")),t.site_id_list=r,t}function Un(e,t){!function(e,t,a=null){ae.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}(Fn(e),"".concat(ee.b,"/api/issues_and_reminders/write_issue_reminder_to_db"),t)}const zn=[{active:!0,barangay:"Agbatuan",municipality:"Dumarao",province:"Capiz",psgc:61904001,purok:null,region:"VI",season:1,site_code:"agb",site_id:1,sitio:null,latitude:11.28137,longitude:122.8311},{active:!0,barangay:"Poblacion",municipality:"Bakun",province:"Benguet",psgc:141103009,purok:null,region:"CAR",season:2,site_code:"bak",site_id:2,sitio:null,latitude:16.7907,longitude:120.6616},{active:!0,barangay:"Banlasan",municipality:"Calape",province:"Bohol",psgc:71210003,purok:null,region:"VI",season:1,site_code:"ban",site_id:3,sitio:null,latitude:9.888559,longitude:123.9488},{active:!0,barangay:"Baras",municipality:"Tarangnan",province:"Samar",psgc:86020008,purok:null,region:"VIII",season:1,site_code:"bar",site_id:4,sitio:null,latitude:11.90208,longitude:124.6566},{active:!0,barangay:"Bayabas",municipality:"Labo",province:"Camarines Norte",psgc:51606009,purok:null,region:"V",season:1,site_code:"bay",site_id:5,sitio:null,latitude:14.18797,longitude:122.4675},{active:!0,barangay:"Boloc",municipality:"Tubungan",province:"Iloilo",psgc:63046016,purok:null,region:"VI",season:2,site_code:"blc",site_id:6,sitio:null,latitude:10.82665,longitude:122.3108},{active:!0,barangay:"Bolodbolod",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412004,purok:"3 & 4",region:"VIII",season:1,site_code:"bol",site_id:7,sitio:null,latitude:10.30199,longitude:125.1279},{active:!0,barangay:"Bato",municipality:"Sibonga",province:"Cebu",psgc:72246007,purok:null,region:"VI",season:1,site_code:"bto",site_id:8,sitio:null,latitude:10.01379,longitude:123.5776},{active:!0,barangay:"San Carlos",municipality:"Dapa",province:"Surigao del Norte",psgc:166707025,purok:null,region:"XIII",season:1,site_code:"car",site_id:9,sitio:null,latitude:9.719629,longitude:125.9737},{active:!0,barangay:"Cudog",municipality:"Lagawe",province:"Ifugao",psgc:142704010,purok:null,region:"CAR",season:2,site_code:"cud",site_id:10,sitio:"Natuwolan at Wadwad",latitude:16.80931,longitude:121.1047},{active:!0,barangay:"Dadong",municipality:"Tarragona",province:"Davao Oriental",psgc:112511003,purok:null,region:"XI",season:1,site_code:"dad",site_id:11,sitio:"Sagasa",latitude:7.13731,longitude:126.4509},{active:!0,barangay:"Gaas",municipality:"Balamban",province:"Cebu",psgc:72208014,purok:null,region:"VII",season:1,site_code:"gaa",site_id:12,sitio:null,latitude:10.42352,longitude:123.7851},{active:!0,barangay:"Gamut",municipality:"Tago",province:"Surigao del Sur",psgc:166818012,purok:null,region:"XIII",season:1,site_code:"gam",site_id:13,sitio:null,latitude:9.0101,longitude:126.1676},{active:!0,barangay:"1 & 2",municipality:"Hinabangan",province:"Samar",psgc:86008012,purok:null,region:"VIII",season:1,site_code:"hin",site_id:14,sitio:null,latitude:11.70064,longitude:125.0691},{active:!0,barangay:"Humayhumay",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611013,purok:null,region:"VII",season:1,site_code:"hum",site_id:15,sitio:null,latitude:10.18392,longitude:123.2503},{active:!0,barangay:"Imelda",municipality:"Tarangnan",province:"Samar",psgc:86020024,purok:null,region:"VIII",season:1,site_code:"ime",site_id:16,sitio:null,latitude:11.90383,longitude:124.7526},{active:!0,barangay:"Immuli",municipality:"Pidigan",province:"Abra",psgc:140118005,purok:null,region:"CAR",season:2,site_code:"imu",site_id:17,sitio:null,latitude:17.52308,longitude:120.6046},{active:!0,barangay:"Inabasan",municipality:"Maasin",province:"Iloilo",psgc:63029025,purok:null,region:"VI",season:2,site_code:"ina",site_id:18,sitio:"Sambag",latitude:10.86991,longitude:122.4362},{active:!0,barangay:"Poblacion 1",municipality:"San Jorge",province:"Samar",psgc:86025024,purok:null,region:"VIII",season:1,site_code:"jor",site_id:19,sitio:null,latitude:11.97779,longitude:124.8249},{active:!0,barangay:"Ambuklao",municipality:"Bokod",province:"Benguet",psgc:141104001,purok:null,region:"CAR",season:2,site_code:"lab",site_id:20,sitio:"Labey",latitude:16.47032,longitude:120.7054},{active:!0,barangay:"Laygayon",municipality:"Pinabacdao",province:"Samar",psgc:86013013,purok:null,region:"VIII",season:1,site_code:"lay",site_id:21,sitio:null,latitude:11.5127,longitude:125.0257},{active:!0,barangay:"Lipanto",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412016,purok:"1",region:"VIII",season:1,site_code:"lip",site_id:22,sitio:null,latitude:10.22767,longitude:125.1266},{active:!0,barangay:"Looc",municipality:"Villanueva",province:"Misamis Oriental",psgc:104326011,purok:null,region:"X",season:1,site_code:"loo",site_id:23,sitio:null,latitude:8.597964,longitude:124.7775},{active:!0,barangay:"Lipata",municipality:"Paranas",province:"Samar",psgc:86022016,purok:null,region:"VIII",season:1,site_code:"lpa",site_id:24,sitio:null,latitude:11.78625,longitude:125.0196},{active:!0,barangay:"Literon",municipality:"Calbiga",province:"Samar",psgc:86004017,purok:null,region:"VIII",season:1,site_code:"lte",site_id:25,sitio:null,latitude:11.59037,longitude:125.0903},{active:!0,barangay:"Lunas",municipality:"Maasin City",province:"Southern Leyte",psgc:86407034,purok:null,region:"VIII",season:1,site_code:"lun",site_id:26,sitio:"Caianuhan",latitude:10.25819,longitude:124.877},{active:!0,barangay:"Magsaysay",municipality:"Kibawe",province:"Bukidnon",psgc:101308016,purok:"1, 2 & 3",region:"X",season:1,site_code:"mag",site_id:27,sitio:null,latitude:7.51923,longitude:125.0598},{active:!0,barangay:"Ambassador",municipality:"Tublay",province:"Benguet",psgc:141114001,purok:null,region:"CAR",season:2,site_code:"mam",site_id:28,sitio:"Mamuyod",latitude:16.4883,longitude:120.689},{active:!0,barangay:"Marirong",municipality:"Leon",province:"Iloilo",psgc:63028059,purok:null,region:"VI",season:2,site_code:"mar",site_id:29,sitio:null,latitude:10.827459,longitude:122.321555},{active:!0,barangay:"Mac-Arthur",municipality:"Esperanza",province:"Agusan del Sur",psgc:160303010,purok:null,region:"XIII",season:1,site_code:"mca",site_id:30,sitio:null,latitude:8.58543,longitude:125.741},{active:!0,barangay:"Manghulyawon",municipality:"La Libertad",province:"Negros Oriental",psgc:184613013,purok:null,region:"VII",season:1,site_code:"mng",site_id:31,sitio:"Dao",latitude:10.04793,longitude:123.2062},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msl",site_id:32,sitio:"Lower Mesolong",latitude:7.629616,longitude:125.5445},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msu",site_id:33,sitio:"Upper Mesolong",latitude:7.628743,longitude:125.5403},{active:!0,barangay:"Nagyubuyuban",municipality:"San Fernando City",province:"La Union",psgc:13314034,purok:"5",region:"I",season:2,site_code:"nag",site_id:34,sitio:null,latitude:16.62678,longitude:120.4176},{active:!0,barangay:"Nurcia",municipality:"Lanuza",province:"Surigao del Sur",psgc:166810011,purok:null,region:"XIII",season:1,site_code:"nur",site_id:35,sitio:null,latitude:9.269702,longitude:126.1384},{active:!0,barangay:"Oslao",municipality:"San Francisco",province:"Surigao del Norte",psgc:166719010,purok:null,region:"XIII",season:1,site_code:"osl",site_id:36,sitio:null,latitude:9.75719,longitude:125.4014},{active:!0,barangay:"Parasanon",municipality:"Pinabacdao",province:"Samar",psgc:86013022,purok:null,region:"VIII",season:1,site_code:"par",site_id:37,sitio:null,latitude:11.51487,longitude:125.0255},{active:!0,barangay:"Pepe",municipality:"Leon",province:"Iloilo",psgc:63028070,purok:null,region:"VI",season:2,site_code:"pep",site_id:38,sitio:"Bangi",latitude:10.78788,longitude:122.3336},{active:!0,barangay:"Pinagkamaligan",municipality:"Calauag",province:"Quezon",psgc:45607060,purok:null,region:"IVB",season:1,site_code:"pin",site_id:39,sitio:null,latitude:13.9536,longitude:122.2855},{active:!0,barangay:"Planas",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611027,purok:null,region:"VII",season:1,site_code:"pla",site_id:40,sitio:"Mambog",latitude:10.15984,longitude:123.2459},{active:!0,barangay:"Pange",municipality:"Matnog",province:"Sorsogon",psgc:56212032,purok:null,region:"V",season:1,site_code:"png",site_id:41,sitio:null,latitude:12.63063,longitude:124.0183},{active:!0,barangay:"Puguis",municipality:"La Trinidad",province:"Benguet",psgc:141110013,purok:null,region:"CAR",season:2,site_code:"pug",site_id:42,sitio:"Longlong",latitude:16.44655,longitude:120.5706},{active:!0,barangay:"Antadao",municipality:"Sagada",province:"Mt. Province",psgc:144409005,purok:null,region:"CAR",season:2,site_code:"sag",site_id:43,sitio:null,latitude:17.08263,longitude:120.9248},{active:!0,barangay:"Sibajay",municipality:"Boston",province:"Davao Oriental",psgc:112503006,purok:null,region:"XI",season:1,site_code:"sib",site_id:44,sitio:null,latitude:7.82567,longitude:126.3834},{active:!0,barangay:"Amgaleyguey",municipality:"Buguias",province:"Benguet",psgc:141105002,purok:null,region:"CAR",season:2,site_code:"sin",site_id:45,sitio:"Sinipsip",latitude:16.7234,longitude:120.7815},{active:!0,barangay:"Sumalsag",municipality:"Malitbog",province:"Bukidnon",psgc:101313011,purok:null,region:"X",season:1,site_code:"sum",site_id:46,sitio:null,latitude:8.54511,longitude:124.8597},{active:!0,barangay:"Talahid",municipality:"Almeria",province:"Biliran",psgc:87801012,purok:null,region:"VIII",season:1,site_code:"tal",site_id:47,sitio:null,latitude:11.63742,longitude:124.3665},{active:!0,barangay:"Taga",municipality:"Pinukpuk",province:"Kalinga",psgc:143209022,purok:null,region:"CAR",season:2,site_code:"tga",site_id:48,sitio:null,latitude:17.57347,longitude:121.3834},{active:!0,barangay:"Tue",municipality:"Tadian",province:"Mt. Province",psgc:144410019,purok:null,region:"CAR",season:2,site_code:"tue",site_id:49,sitio:null,latitude:16.97229,longitude:120.8286},{active:!0,barangay:"Umingan",municipality:"Alimodian",province:"Iloilo",psgc:63002053,purok:null,region:"VI",season:2,site_code:"umi",site_id:50,sitio:null,latitude:10.90807,longitude:122.3278}],Wn=da(zn),Gn=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},justify:{display:"flex",justifyContent:"space-evenly"}}));var qn=function(e){const t=e.issueReminderData,a=e.setIssueReminderData,r=e.fullScreen,c=e.toResolve,i=Gn(),s=t.iar_id,m=t.detail,d=t.ts_expiration,p=t.resolution,b=t.is_event_entry,E=t.site_id_list,f=Object(n.useState)("general"),h=Object(o.a)(f,2),_=h[0],v=h[1],O=Object(n.useState)(_),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(n.useState)(j),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(!1),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)(!1),Y=Object(o.a)(N,2),R=Y[0],H=Y[1];Object(n.useEffect)(()=>{if(T(b),""!==s&&"undefined"!==typeof s){const e=E.map(e=>Wn.filter(t=>t.value===e).pop());a(Object(u.a)(Object(u.a)({},t),{},{site_id_list:e}))}null!==E&&"undefined"!==typeof E&&E.length>0&&(v("site"),k("site"),D("site")),null===d&&H(!0)},[]);const B=e=>n=>{const l=n.target.value;a(Object(u.a)(Object(u.a)({},t),{},{[e]:l}))},P=e=>{const n=e.target,l=n.value,r=n.checked;switch(l){case"is_event_entry":T(r),r||H(!1),a(Object(u.a)(Object(u.a)({},t),{},{is_event_entry:r}));break;case"is_persistent":H(r),a(Object(u.a)(Object(u.a)({},t),{},{is_persistent:r}))}};return l.a.createElement(Ft.a,{utils:zt.a},c?l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{required:!0,label:"Resolution",value:p||"",onChange:B("resolution"),placeholder:"Enter resolution",multiline:!0,rowsMax:6,fullWidth:!0,className:i.textField}))):l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(st.a,{"aria-label":"position",name:"position",value:j,onChange:e=>{const t=e.target.value;k(t),D(t)},row:!0,className:r?"":i.justify},l.a.createElement(mt.a,{value:"general",control:l.a.createElement(dt.a,{color:"primary"}),label:"General issue/reminder",labelPlacement:"end"}),l.a.createElement(mt.a,{value:"site",control:l.a.createElement(dt.a,{color:"primary"}),label:"Site-specific issue/reminder",labelPlacement:"end"}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{style:{marginBottom:8}})),"site"===w&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ua,{value:E,changeHandler:e=>a(Object(u.a)(Object(u.a)({},t),{},{site_id_list:e})),isMulti:!0,includeAddressOnOptions:!1})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(mt.a,{key:"is_event_entry",control:l.a.createElement(Lt.a,{checked:M,onChange:P,value:"is_event_entry",className:i.checkboxes}),label:l.a.createElement("div",null,"Related to current monitoring event ",l.a.createElement(Ke.a,{title:"Checking this will make the issue/reminder expire at the end of site(s) current monitoring event validity"},l.a.createElement("strong",null,"[?]"))),className:"primary"}))),(w||!M)&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,md:6,container:!0,justify:"center"},l.a.createElement(mt.a,{key:"is_persistent",control:l.a.createElement(Lt.a,{checked:R,onChange:P,value:"is_persistent",className:i.checkboxes}),label:"Persistent reminder",className:"primary"})),R?l.a.createElement(y.a,{item:!0,md:6}):l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(Ut.b,{autoOk:!0,label:"Issue/Reminder Expiration",value:d,onChange:(L="ts_expiration",e=>{a(Object(u.a)(Object(u.a)({},t),{},{[L]:e}))}),ampm:!1,format:"YYYY-MM-DD HH:mm:ss",mask:"____-__-__ __:__:__",clearable:!0}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{style:{margin:"8px 0"}})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{required:!0,label:"Details",value:m,onChange:B("detail"),placeholder:"Enter detail",multiline:!0,rowsMax:6,fullWidth:!0,className:i.textField}))));var L};const Vn={detail:"",iar_id:"",site_id_list:null,user_id:"",postings:"",resolution:null,resolved_by:null,ts_resolved:null,ts_posted:X()().format("YYYY-MM-DD HH:mm:ss"),ts_expiration:null,is_event_entry:!1,is_persistent:!1};var Qn=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.setIsIandRUpdateNeeded,i=e.chosenIssueReminder,s=e.isIandRUpdateNeeded,m=e.toResolve,d=e.setToRefresh,b=e.toRefresh,g=Object(n.useState)({}),E=Object(o.a)(g,2),f=E[0],h=E[1];Object(n.useEffect)(()=>{if(s){const e=i,t=i.postings.map(e=>e.site_id),a=[];i.postings.forEach(e=>{const t=e.event;null!==t&&a.push(t)}),e.site_id_list=t,e.is_event_entry=a.length>0,h(e)}else h(Vn)},[a,i]);const _=()=>{c(!1),r(!1)};return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Issues and Reminder Form"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Provide information to the following fields."),l.a.createElement(qn,{issueReminderData:f,setIssueReminderData:h,fullScreen:t,toResolve:m})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:_,color:"primary"},"Cancel"),l.a.createElement(p.a,{color:"secondary",onClick:()=>{const e=f.resolution,t=X()().format("YYYY-MM-DD HH:mm:ss");let a=Object(u.a)(Object(u.a)({},f),{},{ts_posted:t});if(""!==e&&null!==e){const e=Object(j.a)().user_id;a=Object(u.a)(Object(u.a)({},f),{},{ts_resolved:t,resolved_by:e})}Un(a,e=>{e&&"undefined"!==typeof b&&d(!b)}),_()},disabled:!1},"Submit")))}));const Zn=Object(O.a)(e=>({inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},gridList:{height:"100vh",margin:"0 !important",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"},position:"sticky",top:148,padding:8},hasNoIssues:{display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"},icon:{color:"rgba(255, 255, 255, 0.54)"},previewText:{padding:"12px",fontSize:"14px",minHeight:68},tile:{border:"0.5px solid #b2b2b2",padding:"0 !important",marginBottom:6,"&:last-of-type":{marginBottom:0}},tileBar:{background:"#7f7f7f",height:"50px !important"}}));function Kn(e){const t=e.isCardModalOpen,a=e.chosenIssueReminder,n=e.setCardModalOpen,r=e.setIsOpenIssueReminderModal,c=e.setToResolve,i=e.setIsIandRUpdateNeeded,o=a.site_list,s=a.ts_posted,m=a.detail,d=a.issue_reporter,u=d.first_name,b=d.last_name,g=Jn(o,!1),E=X()(s).format("DD MMMM YYYY, HH:mm");return l.a.createElement(lt.a,{open:t,maxWidth:"sm"},l.a.createElement(rt.a,{style:{paddingBottom:8}},l.a.createElement("div",{style:{display:"flex",alignItems:"center"}},l.a.createElement(Ln.a,{style:{paddingRight:8}})," ",g)),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,E),l.a.createElement(it.a,{style:{textIndent:40},align:"justify"},m),l.a.createElement(it.a,{align:"right",style:{marginBottom:0}},"".concat(u," ").concat(b))),l.a.createElement(ut.a,{disableSpacing:!0},l.a.createElement(p.a,{onClick:()=>{n(!1),c(!1),r(!0),i(!0)},color:"primary"},"Edit"),l.a.createElement(p.a,{onClick:()=>{n(!1),c(!0),r(!0),i(!0)},color:"secondary"},"Resolve"),l.a.createElement(p.a,{onClick:()=>n(!1),color:"primary",autoFocus:!0},"Close")))}function Jn(e,t){let a=t?"GENERAL":"General";return 0!==e.length&&(a=e.join(", ")),a}var Xn=function(e){const t=e.isOpenIssueReminderModal,a=e.setIsOpenIssueReminderModal,r=e.isIandRUpdateNeeded,c=e.setIsIandRUpdateNeeded,i=Zn(),s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],p=m[1],b=Object(n.useState)(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],h=Object(n.useState)({site_list:[],site_id_list:null,ts_posted:null,detail:"",issue_reporter:{first_name:"",last_name:""}}),_=Object(o.a)(h,2),y=_[0],O=_[1],x=Object(n.useState)(!1),j=Object(o.a)(x,2),k=j[0],S=j[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),D=w[0],A=w[1];Object(n.useEffect)(()=>{var e;e=e=>{f(!1);let t=l.a.createElement(v.a,{component:"div",style:{fontStyle:"italic",width:"auto",height:0}},"No active issues");if(0!==e.length){const a=function(e){return e.map((e,t)=>{const a=[],n=[],l=[],r=null===e.ts_expiration;e.postings.forEach(e=>{const t=e.event_id,r=e.site_id,c=e.site;null!==r&&(a.push(r),n.push(c.site_code.toUpperCase()),l.push(t))});const c=0!==l.length;return Object(u.a)(Object(u.a)({},e),{},{site_id_list:a,site_list:n,site_events_list:l,is_event_entry:c,is_persistent:r})})}(e);t=function(e,t,a){return t.map((t,n)=>{const r=t.site_list,c=t.detail,i=t.issue_reporter,o=t.iar_id,s=Jn(r);return l.a.createElement(Rn.a,{key:"test ".concat(n+1),cols:2,className:e.tile},l.a.createElement(v.a,{className:e.previewText},c),l.a.createElement(Hn.a,{className:e.tileBar,title:"".concat(o," ").concat(s),subtitle:"".concat(i.first_name," ").concat(i.last_name),actionIcon:l.a.createElement(Ke.a,{title:"Expand card"},l.a.createElement(Y.a,{"aria-label":"Expand",className:e.icon,onClick:a(t)},l.a.createElement(Ln.a,null)))}))})}(i,a,I),f(!0)}p(t)},ft(),Et.on("receive_issues_and_reminders",t=>{const a=JSON.parse(t);e(a)})},[i]);const I=e=>t=>{O(e),S(!0)};return l.a.createElement(n.Fragment,null,l.a.createElement(Bn.a,{component:"div",cellHeight:"auto",className:"".concat(i.gridList," ").concat(!E&&i.hasNoIssues)},d),l.a.createElement(Kn,{isCardModalOpen:k,setCardModalOpen:S,chosenIssueReminder:y,setToResolve:A,setIsOpenIssueReminderModal:a,setIsIandRUpdateNeeded:c}),l.a.createElement(Qn,{isOpen:t,isIandRUpdateNeeded:r,chosenIssueReminder:y,setIsIandRUpdateNeeded:c,toResolve:D,closeHandler:()=>{a(!1)}}))},$n=a(133),el=a.n($n),tl=a(592),al=a.n(tl);const nl=Object(O.a)(e=>({summary:{minHeight:24},summaryContent:{marginBottom:6,marginTop:6},icon:{paddingTop:6,paddingBottom:6},details:{paddingTop:16}}));var ll=function(e){const t=e.shiftData,a=nl(),r=Object(n.useState)([]),c=Object(o.a)(r,2),i=c[0],m=c[1];return Object(n.useEffect)(()=>{if(null!==t||"undefined"!==t){const e=t.filter(e=>X()(e.ts)>X()().subtract({hours:12})?e:null).slice(0,3);m(e)}},[t]),l.a.createElement(Te.a,{defaultExpanded:!1},l.a.createElement(Ne.a,{expandIcon:l.a.createElement(el.a,null),"aria-controls":"panel1c-content",id:"panel1c-header",className:a.summary,IconButtonProps:{className:a.icon},classes:{content:a.summaryContent}},l.a.createElement(y.a,{container:!0,justify:"space-between",alignItems:"baseline"},l.a.createElement(y.a,{item:!0,xs:!0},l.a.createElement(v.a,{variant:"caption"},l.a.createElement("strong",null,"MONITORING SHIFT"))),i.length>0&&l.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"space-evenly"},l.a.createElement(v.a,{variant:"overline"},"MT - ",i[0].iompmt),l.a.createElement(v.a,{variant:"overline"},"CT - ",i[0].iompct)))),l.a.createElement(V.a,null),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,justify:"space-evenly",className:a.details},i.length>0&&i.map(e=>l.a.createElement(y.a,{item:!0,xs:6,sm:4,key:e.ts},l.a.createElement(v.a,{variant:"subtitle2",align:"center"},l.a.createElement("strong",null,(e=>{const t=X()(),a=X()(e),n=X()(e).add(12,"hours");return t>a&&a<=n?"Current":t.add(12,"hours")>a?"Next":t.add(24,"hours")>a?a.format("MMMM D, A (ddd)"):null})(e.ts))),l.a.createElement(v.a,{variant:"body2",align:"center"},e.iompmt," (MT)"),l.a.createElement(v.a,{variant:"body2",align:"center",gutterBottom:!0},e.iompct," (CT)"))))),l.a.createElement(V.a,null),l.a.createElement(Ze.a,null,l.a.createElement(s.b,{to:"monitoring/shifts_and_reports/shifts",style:{textDecoration:"none"}},l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(al.a,null)},"Go to Calendar"))))},rl=a(1135);function cl(e){const t=e.momsEntry,a=e.updateField,n=e.isAddingNewInstance,r=e.setIsNoneEntrySelected,c=e.location,i=e.site_code,o=t.moms,s=t.options,m=o.feature_type,d=null!==m&&"None"===m.label;return r(d),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(oa,{label:"Feature Type",options:s.feature_type,value:o.feature_type,changeHandler:a("feature_type"),placeholder:"Select feature type",renderDropdownIndicator:!0,openMenuOnClick:!0})),!d&&l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},l.a.createElement(Ke.a,{title:"Feature names are auto-generated. To add new MOMs feature name, choose (Add new instance)",placement:"top",interactive:!0},l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(oa,{label:"Feature Name",options:s.feature_name.options,isDisabled:s.feature_name.disabled,value:o.feature_name,changeHandler:a("feature_name"),placeholder:s.feature_name.disabled?"Disabled":"Select feature name",renderDropdownIndicator:!0,openMenuOnClick:!0}))),n&&l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(g.a,{label:"Location",multiline:!0,rowsMax:"2",placeholder:"Enter location of new instance",value:c,onChange:a("location"),fullWidth:!0,InputLabelProps:{shrink:!0}}))),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(oa,{label:"Alert Level",options:s.alert_level.options,isDisabled:s.alert_level.disabled,value:o.alert_level,changeHandler:a("alert_level"),placeholder:s.alert_level.disabled?"Disabled":"Select alert level",renderDropdownIndicator:!0,openMenuOnClick:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Observance Timestamp",value:o.observance_ts,onChange:a("observance_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(g.a,{label:"Narrative",multiline:!0,rowsMax:"2",placeholder:"Enter report narrative",value:o.narrative,onChange:a("narrative"),fullWidth:!0,InputLabelProps:{shrink:!0}})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(Ra,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:a("reporter"),value:o.reporter,isCommunityStaff:"true",site_code:i})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(g.a,{label:"Remarks",multiline:!0,rowsMax:"2",placeholder:"Enter expert's remarks",value:o.remarks,onChange:a("remarks"),fullWidth:!0,InputLabelProps:{shrink:!0}})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},l.a.createElement(Ra,{variant:"standard",label:"Validator",div_id:"validator",changeHandler:a("validator"),value:o.validator})))}var il=function(e){const t=e.momsEntries,a=e.setMomsEntries,r=e.selectSite,c=e.site,i=e.setSite,s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],u=m[1],b=Object(n.useState)(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],h=e=>t=>n=>{let l="";if("feature_name"===t&&("(Add new instance)"===n.label?u(!0):u(!1)),["feature_type","feature_name","alert_level","observance_ts"].includes(t))l=n;else if(["narrative","remarks","reporter","validator","location"].includes(t)){l=n.target.value}a({action:"UPDATE_DETAILS",key:e,attribute:t,value:l})},_=e=>()=>a({action:"DELETE_INSTANCE",key:e});return l.a.createElement(n.Fragment,null,r&&l.a.createElement("div",{style:{marginBottom:12}},l.a.createElement(ua,{value:c,changeHandler:e=>i(e)})),null!==c&&l.a.createElement(n.Fragment,null,l.a.createElement(Ft.a,{utils:zt.a},t.map((e,a)=>{const r=0===a,i=t.length===a+1;return l.a.createElement(n.Fragment,{key:"moms_".concat(a)},l.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:r?12:0}},l.a.createElement(v.a,{variant:"subtitle2"},"Entry Number ",a+1),!r&&l.a.createElement(Y.a,{"aria-label":"delete",color:"primary",onClick:_(a)},l.a.createElement(rl.a,null))),l.a.createElement(cl,{momsEntry:e,updateField:h(a),isAddingNewInstance:d,setIsNoneEntrySelected:f,site_code:c.data.site_code}),!i&&l.a.createElement(V.a,{style:{margin:"24px 0 12px"},variant:"middle"}))})),!E&&l.a.createElement("div",{style:{margin:"16px 0",textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>a({action:"ADD_INSTANCE"})},"Add MOMs Observation"))))};const ol={moms:{feature_type:null,feature_name:null,alert_level:null,observance_ts:null,narrative:"",reporter:"",remarks:"",validator:"",location:""},options:{feature_type:[],feature_name:{options:[],disabled:!0},alert_level:{options:[],disabled:!0}}};function sl(e,t){const a=t.action,n=t.key,l=t.attribute,r=t.value,c=JSON.parse(JSON.stringify(e));switch(a){case"OVERWRITE":return[...r];case"ADD_INSTANCE":return[...e,JSON.parse(JSON.stringify(ol))];case"DELETE_INSTANCE":return c.splice(n,1),[...c];case"UPDATE_DETAILS":if(c[n].moms[l]=r,"feature_type"===l){const e=r.instances,t=r.alerts,a=e.map(e=>({value:e.instance_id,label:le(e.feature_name)}));a.push({value:0,label:"(Add new instance)"});const l=t.map(e=>{const t=e.feature_alert_id,a=e.alert_level,n=e.description;return{value:r,feature_alert_id:t,label:a,description:n}}),i=c[n],o=i.moms,s=i.options;c[n].options=Object(u.a)(Object(u.a)({},s),{},{feature_name:{options:a,disabled:!1},alert_level:{options:l,disabled:!1}}),c[n].moms=Object(u.a)(Object(u.a)({},o),{},{feature_name:null,alert_level:null})}return[...c];default:return e}}const ml=Object(O.a)(e=>({form_message_style:{color:"red",fontStyle:"italic"}}));var dl=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.match,s=ml(),m=Object(n.useContext)(sa).sites,d=Object(n.useState)(null),b=Object(o.a)(d,2),g=b[0],E=b[1],f=Object(n.useState)(null),h=Object(o.a)(f,2),_=h[0],O=h[1],x=Object(n.useState)(!0),k=Object(o.a)(x,2),S=k[0],C=k[1],w=Object(n.useReducer)(sl,[]),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(!1),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(""),H=Object(o.a)(R,2),B=H[0],P=H[1];Object(n.useEffect)(()=>{if("undefined"!==typeof c){const e=c.params.site_code;C(!1),O(e)}},[c]),Object(n.useEffect)(()=>{const e=m.find(e=>e.site_code===_);e&&E({value:e.site_id,data:e})},[m,_]);const L=Object(i.b)(),F=L.enqueueSnackbar,U=L.closeSnackbar,z=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{U(e)}},"Dismiss"),W=Object(n.useState)([]),G=Object(o.a)(W,2),q=G[0],V=G[1];return Object(n.useEffect)(()=>{null!==g&&function(e,t){const a="".concat(ee.b,"/api/manifestations_of_movement/get_moms_features/").concat(e);ae.a.get(a).then(e=>{const a=e.data;console.log("MOMs Features",a),t(a)}).catch(e=>{console.error(e)})}(g.data.site_code,e=>{const t=e.map(e=>{const t=e.feature_id,a=e.feature_type,n=e.instances,l=e.alerts;return{value:t,label:le(a),instances:n,alerts:l}});V(Object(u.a)(Object(u.a)({},q),{},{feature_type:t}));const a=ol;a.options.feature_type=t;I({action:"OVERWRITE",value:[a]})})},[g]),Object(n.useEffect)(()=>{const e=function(e){let t=!1,a=!1,n=new Set;const l=[],r=[];let c,i="";return e.forEach((e,c)=>{const i=e.moms,o=i.alert_level,s=i.feature_type,m=i.narrative,d=i.observance_ts,u=i.remarks,p=i.reporter,b=i.validator;let g=i.feature_name,E=i.location;const f=X()(d).format("YYYY-MM-DD HH:mm:00");if(null!==s){9===s.value&&(g="value")}if(null!==g){const e=g.value;l.includes(e)?!1===t&&(t=!0):l.push(e),0===e?void 0===E&&(E=""):E="value"}!0!==t&&"Invalid date"===f||(r.includes(f)?!1===a&&(a=!0):r.push(f)),null===s&&n.add("feature type"),null===g&&n.add("feature name"),""===E&&n.add("location"),null===o&&n.add("alert level"),null===d&&n.add("observance timestamp"),""===m&&n.add("narrative"),""===p&&n.add("reporter"),""===u&&n.add("remarks"),""===b&&n.add("validator")}),n=[...n],!1===t&&(a=!1),0!==n.length||!0===a?(c=!0,i="Please input ".concat(n.join(", ")," form(s). "),a&&(i+="Duplicate observance time for the same feature instance.")):c=!1,{button_state:c,form_messsage:i}}(A),t=e.button_state,a=e.form_messsage;Y(t),P(a)},[A]),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Insert Manifestation of Movement Form"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Provide manifestation of movement (MOMs) details to save information in our database."),l.a.createElement(il,{momsEntries:A,setMomsEntries:I,site:g,setSite:E,selectSite:S})),l.a.createElement(ut.a,null,l.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:12,sm:8,align:"center"},l.a.createElement(v.a,{variant:"caption",className:s.form_message_style,gutterBottom:!0},B)),l.a.createElement(y.a,{item:!0,xs:12,sm:4,align:"right"},l.a.createElement(p.a,{onClick:r,color:"primary"},"Cancel"),l.a.createElement(p.a,{onClick:()=>{console.log("moms_entries",A);const e=A.map(({moms:e},t)=>{const a=e.alert_level,n=e.feature_name,l=e.feature_type,r=e.narrative,c=e.observance_ts,i=e.remarks,o=e.reporter,s=e.validator,m=e.location,d=X()(c).format("YYYY-MM-DD HH:mm:ss"),u=Object(j.a)(),p=l.label;let b="None",g=null;if("None"!==p){const e=n.value,t=n.label;b="(Add new instance)"===t?null:t,g=e}return{alert_level:a.label,instance_id:g,feature_name:b,feature_type:p,report_narrative:r,observance_ts:d,remarks:i,reporter_id:o,validator_id:s,location:m,iomp:u.user_id}}),t=g.data.site_code,a={moms_list:e,site_code:t};console.log("PAYLOAD",a),r(),function(e,t,a){const n="".concat(ee.b,"/api/manifestations_of_movement/write_monitoring_moms_to_db");console.log("moms_list",e),ae.a.post(n,e).then(e=>{const a=e.data;null!==t&&(console.log("Moms Insert result",a),t(a))}).catch(e=>{console.log(e),null!==a&&a(e)})}(a,e=>{let a="MOMs input success!",n="success";if(e.status)_t("run_alert_generation",{site_code:t});else{a=e.message,n="error"}F(a,{variant:n,autoHideDuration:7e3,action:z})},()=>{F("Error MOMS input...",{variant:"error",autoHideDuration:7e3,action:z})})},color:"primary",disabled:N},"Submit")))))}));function ul(e){const t=e.clickHandler;return l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:t,startIcon:l.a.createElement(He.a,null)},"Insert MOMs")}const pl=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)({},t.pageContentMargin),tabBarContent:{marginTop:30},speedDial:{position:"fixed","&.MuiSpeedDial-directionUp":{bottom:e.spacing(2),right:e.spacing(2)}}})}),bl=[{label:"Monitoring Tables",href:"monitoring-tables"},{label:"Generated Alerts",href:"generated-alerts"}];var gl=Object(Se.a)()((function(e){const t=e.width,a=e.history,r=pl(),c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],d=s[1],u=Object(n.useState)(null),b=Object(o.a)(u,2),g=b[0],E=b[1],f=Object(n.useState)([]),h=Object(o.a)(f,2),_=h[0],O=h[1],x=Object(n.useState)(null),j=Object(o.a)(x,2),k=j[0],S=j[1],C=Object(n.useState)(null),w=Object(o.a)(C,2),D=w[0],A=w[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)(!1),R=Object(o.a)(Y,2),H=R[0],B=R[1],P=Object(n.useState)(null),L=Object(o.a)(P,2),F=L[0],U=L[1],z=Object(n.useState)(!1),W=Object(o.a)(z,2),G=W[0],q=W[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)(!1),ee=Object(o.a)(X,2),te=ee[0],ae=ee[1],ne=e=>()=>ae(e),le=Object(n.useContext)(sa).setIsReconnecting,re=Object(i.b)(),ce=re.enqueueSnackbar,ie=re.closeSnackbar;Object(n.useEffect)(()=>{var e;return ht(le),e=e=>E(e),ft(),Et.on("receive_generated_alerts",t=>{const a=JSON.parse(t);console.log("Generated alerts: ",a),e(a)}),function(e){ft(),Et.on("receive_candidate_alerts",t=>{const a=JSON.parse(t);console.log("Candidate alerts: ",a),e(a)})}(e=>S(e)),vt(e=>A(e)),Object($.a)(),Object($.d)(e=>O(e)),function(e){ft(),Et.on("receive_ewi_insert_response",t=>{const a=JSON.parse(t);e(a)})}(e=>{const t=e.snackbar_key,a=e.message,n=e.status;ie(t),ce(a,{variant:n?"success":"error",autoHideDuration:7e3})}),function(){yt(),Object($.g)()}},[]);const oe=(e,t)=>()=>{"is_open_release_modal"===e?N(t):"is_open_issues_modal"===e?(J(!t),q(t)):"is_routine_modal_open"===e&&B(t)},se=(e,t)=>()=>{U(e),"routine"===t?oe("is_routine_modal_open",!0)():oe("is_open_release_modal",!0)()},me=Object(Se.c)("md",t),de=Object(n.useState)(!1),ue=Object(o.a)(de,2),pe=ue[0],be=ue[1],ge=[{icon:l.a.createElement(Re.a,null),name:"Release alert",action:se(null)},{icon:l.a.createElement(He.a,null),name:"Insert MOMs",action:ne(!0)},{icon:l.a.createElement(Be.a,null),name:"Add issue/reminder",action:oe("is_open_issues_modal",!0)}],Ee=l.a.createElement("span",null,l.a.createElement(p.a,{"aria-label":"Add issue/reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:oe("is_open_issues_modal",!0),startIcon:l.a.createElement(Be.a,null)},"Add issue/reminder"),l.a.createElement("span",{style:{marginRight:8}},l.a.createElement(ul,{clickHandler:ne(!0)})),l.a.createElement(p.a,{"aria-label":"Release alert",variant:"contained",color:"primary",size:"small",onClick:se(null),startIcon:l.a.createElement(Re.a,null)},"Release Alert"));return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:r.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Dashboard",customButtons:!!me&&Ee})),l.a.createElement("div",{className:r.tabBar},l.a.createElement(y.a,{container:!0,spacing:3},l.a.createElement(y.a,{item:!0,xs:12,md:3},l.a.createElement(Me.a,{smDown:!0},l.a.createElement(Xn,{isOpenIssueReminderModal:G,setIsOpenIssueReminderModal:q,isIandRUpdateNeeded:K,setIsIandRUpdateNeeded:J})),l.a.createElement(Me.a,{mdUp:!0},l.a.createElement(Te.a,{defaultExpanded:!1},l.a.createElement(Ne.a,{expandIcon:l.a.createElement(Pe.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},l.a.createElement(y.a,{container:!0,justify:"space-between",alignItems:"baseline"},l.a.createElement(v.a,{variant:"caption"},l.a.createElement("strong",null,"ISSUES AND REMINDERS")))),l.a.createElement(V.a,null),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,justify:"space-evenly",className:r.details},l.a.createElement(Xn,{isOpenIssueReminderModal:G,setIsOpenIssueReminderModal:q,isIandRUpdateNeeded:K,setIsIandRUpdateNeeded:J})))))),l.a.createElement(y.a,{item:!0,xs:12,md:9},l.a.createElement("div",{style:{marginBottom:12}},l.a.createElement(ll,{shiftData:_})),l.a.createElement(Ve,{chosenTab:m,onSelect:e=>{d(e)},tabsArray:bl}),l.a.createElement("div",{className:r.tabBarContent},0===m&&l.a.createElement(Ga,{width:t,candidateAlertsData:k,alertsFromDbData:D,releaseFormOpenHandler:se,history:a}),1===m&&l.a.createElement(Za,{generatedAlertsData:g}))))),!me&&l.a.createElement(Le.a,{ariaLabel:"SpeedDial example",className:r.speedDial,FabProps:{color:"secondary"},icon:l.a.createElement(Fe.a,null),onClose:()=>be(!1),onOpen:()=>be(!0),open:pe},ge.map(e=>l.a.createElement(Ue.a,{key:e.name,icon:e.icon,tooltipTitle:e.name,onClick:e.action}))),l.a.createElement(jn,{isOpen:T,closeHandler:oe("is_open_release_modal",!1),setChosenCandidateAlert:U,chosenCandidateAlert:F,alertsFromDbData:D,setIsOpenRoutineModal:(fe=null,()=>{U(fe),oe("is_open_release_modal",!1)(),oe("is_routine_modal_open",!0)()})}),l.a.createElement(Yn,{isOpen:H,closeHandler:oe("is_routine_modal_open",!1),chosenCandidateAlert:F,setChosenCandidateAlert:U}),l.a.createElement(dl,{isOpen:te,closeHandler:ne(!1)}));var fe})),El=a(60),fl=a.n(El),hl=a(195),_l=a(1105),yl=a(261),vl=a(1144),Ol=a(1149);const xl=Object(O.a)(e=>({timeline:{margin:"0 auto",lineColor:"#DDDDDD",paddingTop:24}}));function jl(e,t,a=!1){const n=e.moms_details,r=n.moms_instance,c=r.feature.feature_type,i=r.feature_name,o=n.op_trigger,s=n.validator,m=s.first_name,d=s.last_name,u=n.reporter,p=u.first_name,b=u.last_name,g=n.narrative.narrative,E=n.remarks,f=n.moms_id,h=a?"Non-triggering ":"";return l.a.createElement("ul",{key:f},l.a.createElement("li",null,h,"Feature: ",le(c)," ",i," (",t+o,")"),l.a.createElement("ul",null,l.a.createElement("li",null,"Narrative: ",g),l.a.createElement("li",null,"Reporter: ","".concat(p," ").concat(b)),l.a.createElement("li",null,"Remarks: ",E),l.a.createElement("li",null,"Validator: ","".concat(m," ").concat(d))))}function kl(e,t,a,r){const c=[];let i=0;return e.forEach(e=>{i+=1;const o=e.item_timestamp,s=e.item_data,m=e.item_type;let d=null;const u=X()(o).format("DD MMMM YYYY, hh:mm A");if("narrative"===m)d=l.a.createElement(yl.TimelineItem,{key:i,dateText:u,style:{color:"#969696"},dateComponent:l.a.createElement("div",{style:{display:"block",float:"right",padding:"10px",marginRight:38,background:"rgb(150, 150, 150)",color:"#fff"}},u)},l.a.createElement(v.a,{variant:"body2",component:"div"},s.narrative));else if("release"===m){const c=s.release_time,o=s.data_ts,m=s.release_publishers,b=s.triggers,g=s.is_onset,E=s.internal_alert_level,f=s.moms_releases,h=s.release_id,_=s.comments,O=e.release_type,x=function(e){let t="#F8991D";return"end_of_validity"===e?t="#00B200":"overdue"===e?t="#FA4413":"extended"===e?t="#00B200":"routine"===e&&(t="#59081E"),t}(O),j=function(e){let t="EARLY WARNING INFORMATION";return"end_of_validity"===e?t="END OF MONITORING":"overdue"===e?t="OVERDUE":"extended"===e?t="EXTENDED MONITORING":"routine"===e&&(t="ROUTINE MONITORING"),t}(O);let k=X()(o);g||(k=k.add(30,"minutes")),k=k.format("MMMM Do YYYY, h:mm A");let S="",C="";m.forEach(e=>{const t=e.role,a=e.user_details,n=a.first_name,l=a.last_name;"mt"===t&&(S="".concat(n," ").concat(l)),"ct"===t&&(C="".concat(n," ").concat(l))}),d=l.a.createElement(yl.TimelineItem,{key:i,dateText:u,style:{color:x},dateInnerStyle:{background:x,lineHeight:"48px",textAlign:"center"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},l.a.createElement(vl.a,{style:{color:x,height:45,width:"auto",paddingRight:8}},l.a.createElement(at.a,{style:{height:45,width:"auto"}})),l.a.createElement("div",null,l.a.createElement(v.a,{variant:"caption",component:"div",style:{color:x}},l.a.createElement("strong",null,j)),l.a.createElement(v.a,{variant:"h6",component:"div",style:{color:x,lineHeight:1.2}},l.a.createElement("strong",null,k)))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},l.a.createElement(v.a,{variant:"body2",style:{color:x}},"Release Time: ",l.a.createElement("strong",null,c)),l.a.createElement(v.a,{variant:"body2",style:{color:x}},"Internal Alert Level: ",l.a.createElement("strong",null,E))),b.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",component:"div",style:{color:x}},l.a.createElement("strong",null,function(e){return l.a.createElement("ul",null,e.map(e=>{const t=e.ts,a=e.info,r=e.internal_sym,c=r.trigger_symbol,i=c.alert_symbol,o=c.trigger_hierarchy.trigger_source,s=r.alert_symbol,m=e.trigger_id,d="moms"===o?"Manifestation of Movement":le(o),u=l.a.createElement("li",null,"".concat(d," (").concat(i,") alert triggered on ").concat(X()(t).format("MMMM Do YYYY, hh:mm A"))),p=l.a.createElement("ul",null,l.a.createElement("li",null,a)),b=[];if("moms"===o){e.trigger_misc.moms_releases.forEach(e=>{const t=jl(e,s);b.push(t)})}else if("on demand"===o){const t=e.trigger_misc.on_demand.narrative.narrative;b.push(l.a.createElement("ul",{key:"od"},l.a.createElement("li",null,"Reason:"),l.a.createElement("ul",null,l.a.createElement("li",null,t))))}return l.a.createElement(n.Fragment,{key:m},u,p,b.map(e=>e))}))}(b))))),f.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",component:"div",style:{color:x}},l.a.createElement("strong",null,f.map(e=>jl(e,"m",!0)))))),""!==_&&null!==_&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},l.a.createElement(v.a,{variant:"body2",style:{color:x}},"Comments: ",l.a.createElement("strong",null,_)))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between",alignItems:"center"},l.a.createElement(v.a,{variant:"body2",style:{color:x}},S," | ",C),l.a.createElement(p.a,{"aria-label":"Show bulletin",variant:"text",color:"primary",size:"small",onClick:t({release_id:h,site_code:a,site_id:r})},"Bulletin"))))}else if("eos"===m){const e="#3f51b5";d=l.a.createElement(yl.TimelineItem,{key:i,dateText:u,style:{color:e},dateInnerStyle:{background:e,lineHeight:"48px"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},l.a.createElement(vl.a,{style:{color:e,height:45,width:"auto",paddingRight:8}},l.a.createElement(Ol.a,{style:{height:45,width:"auto"}})),l.a.createElement("div",null,l.a.createElement(v.a,{variant:"caption",component:"div",style:{color:e}},l.a.createElement("strong",null,"END-OF-SHIFT-ANALYSIS")),l.a.createElement(v.a,{variant:"h6",component:"div",style:{color:e,lineHeight:1.2}},l.a.createElement("strong",null,X()(o).format("MMMM Do YYYY, h:mm A"))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",style:{color:e},dangerouslySetInnerHTML:{__html:s}}))))}c.push(d)}),c}var Sl=function(e){const t=e.match.params.event_id,a=xl(),r=Object(n.useState)({event_id:t,site_code:"---",site_id:1,validity:X()(),event_start:X()(),site_address:"",status:1}),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),p=d[0],b=d[1],g=Object(n.useState)({}),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),x=O[0],j=O[1];Object(n.useEffect)(()=>{!function(e,t){const a=e.event_id,n="".concat(ee.b,"/api/monitoring/get_event_timeline_data/").concat(a);ae.a.get(n).then(e=>{const a=e.data;console.log("Event details",a),t(a)}).catch(e=>{console.error("Problem in getEventTimelineEntries Axios request"),console.error(e)})}({event_id:t},e=>{const t=e.event_details,a=e.timeline_items;Object.keys(t).length>0&&(s(t),b(a))})},[]);const k=1===i.status?"ROUTINE":"EVENT",S=X()(i.event_start).format("MMMM Do YYYY, hh:mm A");let C="PRESENT";return null!==i.validity&&(C=X()(i.validity).format("MMMM Do YYYY, hh:mm A")),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},l.a.createElement("strong",null,k," MONITORING TIMELINE")),l.a.createElement(v.a,{variant:"h4",align:"center"},i.site_address," (",i.site_code.toUpperCase(),")"),l.a.createElement(v.a,{variant:"subtitle1",align:"center"},"".concat(S," to ").concat(C))),l.a.createElement(yl.Timeline,{className:a.timeline,lineColor:"#DDDDDD"},kl(p,e=>t=>{console.log(e);const a=Object(u.a)(Object(u.a)({},e),{},{type:null});h(a),j(!0)},i.site_code,i.site_id)),l.a.createElement(Yt,{classes:a,isOpenBulletinModal:x,setIsOpenBulletinModal:j,releaseDetail:f}))},Cl=a(207),wl=a.n(Cl),Dl=a(163),Al=a.n(Dl);class Il extends l.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props,a=t.options,n=t.onSearch,l=a.onSearchChange;l&&l(e.target.value),n(e.target.value)},this.onKeyDown=e=>{const t=this.props,a=t.onHide,n=t.onSearchClick;27===e.keyCode?a():13===e.keyCode&&n()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,r=e.searchText,c=e.onSearchClick;return l.a.createElement(xe.a,{appear:!0,in:!0,timeout:300},l.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},l.a.createElement(g.a,{placeholder:"Search events using YYYY-MM-DD format...",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:r||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),l.a.createElement(Y.a,{className:t.clearIcon,style:{marginLeft:6},onClick:c},l.a.createElement(wl.a,null)),l.a.createElement(Y.a,{className:t.clearIcon,onClick:n},l.a.createElement(Al.a,null))))}}var Ml=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(Il);const Tl=[],Nl=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(fe.d)(e)),{},{eventTable:{minWidth:"900px"}}));const Yl=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Rl=Object(Se.a)()((function(e){const t=e.width,a=e.location,r=e.match.url,c=Nl(),i=Object(n.useState)([["Loading Data..."]]),d=Object(o.a)(i,2),p=d[0],b=d[1],g=Object(n.useState)(0),E=Object(o.a)(g,2),f=E[0],_=E[1],y=Object(n.useState)(10),O=Object(o.a)(y,2),j=O[0],k=O[1],S=Object(n.useState)(1),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(!1),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)({}),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)([]),z=Object(o.a)(U,2),W=z[0],G=z[1],q=Object(n.useState)(""),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(!1),J=Object(o.a)(K,2),$=J[0],te=J[1],le=Object(n.useContext)(sa).sites;Object(n.useEffect)(()=>{const e={};le.forEach(t=>{const a=ne(t,!0,"start"),n=t.site_code.toUpperCase();Tl.push(n),e[n]={site_id:t.site_id,address:a}}),H(e)},[le]),Object(n.useEffect)(()=>{T(!0);!function(e,t){const a=e.limit,n=e.offset,l=e.include_count,r=e.filters,c=e.search_str;let i="".concat(ee.b,"/api/monitoring/get_monitoring_events?filter_type=complete&offset=").concat(n,"&limit=").concat(a);if(l&&(i+="&include_count=true"),r.length>0){i+=r.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==c&&(i+="&search=".concat(c)),ae.a.get(i).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({include_count:!0,limit:f*j+j,offset:f*j,filters:L,search_str:Q},e=>{const t=e.events,a=e.count,n=function(e,t){return e.map((e,a)=>{const n=e.event_id,l=e.site_code,r=e.entry_type,c=e.event_start,i=e.validity,o=e.public_alert;let s=null,m="ROUTINE";""!==c&&null!==c&&(s=X()(c).format("D MMMM YYYY, HH:mm")),""!==i&&null!==i&&(m=X()(i).format("D MMMM YYYY, HH:mm"));let d="";if(Object.keys(t).length){d=t[l.toUpperCase()].address}return[n,d,r,o,s,m]})}(t,R);b(n),D(a),T(!1)})},[f,j,L,Q,r,R]);const re={textLabels:{body:{noMatch:"No data"}},filterType:"multiselect",responsive:Object(Se.c)(t,"xs")?"standard":"simple",searchText:Q,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:j,count:w,page:f,filter:!0,selectableRows:"none",print:!1,download:!1,serverSide:!0,onTableChange:(e,t)=>{if("changePage"===e){const e=t.page;_(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==j&&k(e)}else"resetFilters"===e?(G({}),F([])):"onSearchOpen"===e&&te(!0)},onSearchChange:e=>{console.log("Searching for ".concat(e))},onFilterChange:(e,t)=>{const a=[];let n=!0;t.forEach((e,t)=>{let l=null;if(0!==e.length){n=!1;const r=ce[t].name;if("site_name"===r){const t=[],n=[];e.forEach(e=>{t.push(R[e].site_id),n.push(e)}),a.push({name:"site_ids",data:t}),l=n}else if("entry_type"===r){const t=[],n=[];let r;e.forEach(e=>{"EVENT"===e?r=2:"ROUTINE"===e&&(r=1),t.push(e),n.push(r)}),a.push({name:"entry_types",data:n}),l=t}G(Object(u.a)(Object(u.a)({},W),{},{[r]:l}))}}),n&&G({}),F(a)},customSearchRender:(e,t,a,n)=>{let r=e||"";$&&(r=Q,te(!1));return l.a.createElement(Ml,{searchText:e,onSearch:t,onHide:()=>{a(),te(!1)},options:n,onSearchClick:()=>Z(r)})}},ce=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:(e,{rowIndex:t})=>"Loading Data..."===e?e:function(e,t){return l.a.createElement(s.b,{to:"".concat(e,"/").concat(t)},t)}(r,e)}},{name:"site_name",label:"Site",options:{filter:!0,filterList:"undefined"===typeof W.site_name?[]:W.site_name,filterOptions:{names:Tl}}},{name:"entry_type",label:"Entry Type",options:{filter:!0,filterList:"undefined"===typeof W.entry_type?[]:W.entry_type,filterOptions:{names:["ROUTINE","EVENT"]},sort:!1}},{name:"public_alert",label:"Last Alert Level",options:{filter:!0,sort:!0}},{name:"ts_start",label:"Event Start",options:{filter:!1,sort:!1}},{name:"ts_end",label:"Event End",options:{filter:!1,sort:!1}}];return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:c.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Events"})),l.a.createElement("div",{className:c.pageContentMargin},l.a.createElement(m.d,{location:a},l.a.createElement(m.b,{exact:!0,path:r,render:e=>l.a.createElement(h.a,{className:c.paperContainer},l.a.createElement(_l.a,{theme:Yl},l.a.createElement(fl.a,{title:l.a.createElement(v.a,{variant:"h5",component:"div"},"Monitoring Events Table",M&&l.a.createElement(x.a,{size:24,style:{marginLeft:15,position:"relative",top:4}})),data:p,columns:ce,options:re})))}),l.a.createElement(m.b,{path:"".concat(r,"/:event_id"),render:e=>l.a.createElement(Sl,Object.assign({},e,{width:t}))}))))})),Hl=a(1157),Bl=a(1156),Pl=a(1150),Ll=a(1151),Fl=a(1152),Ul=a(1153),zl=a(1154),Wl=a(256),Gl=a.n(Wl);a(573);const ql={toolbar:[["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],["clean"]],clipboard:{matchVisual:!1}},Vl=["bold","italic","underline","strike","blockquote","list","bullet","indent","link"],Ql=Object(O.a)(e=>({root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}}}));function Zl(e){return Object.keys(e).filter(t=>!0===e[t])}function Kl(e){const t=e.shiftSummary,a=e.dataAnalysis,n=e.shiftNarratives,l=t.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),r=a.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),c=n.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>");return"<p>".concat(l,"</p><br/><p>").concat(r,"</p><br/><p>").concat(c,"</p>")}var Jl=function(e){const t=e.data,a=e.shiftStartTs,r=e.currentUser,c=Ql(),s=t.site_code,m=t.eos_head,d=t.shift_start_info,b=t.shift_end_info,g=t.data_analysis,E=t.narratives,f=t.event_id,_=t.validity,O="".concat(m,"<br/>").concat(d,"<br/><br/>").concat(b),j=Object(n.useState)(O),k=Object(o.a)(j,2),S=k[0],C=k[1],w=Object(n.useState)(g),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(g.length),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(E),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(i.b)(),F=L.enqueueSnackbar,U=L.closeSnackbar,z=Object(n.useState)([]),W=Object(o.a)(z,2),G=W[0],q=W[1],Q={rainfall:!1,surficial:!1},Z=[["rainfall","Rainfall",!1]],K=t.has_markers,J=t.has_surficial_data,$=t.subsurface_columns;let te="Surficial",ne=!1;K?J||(te+=" (No data)",ne=!0):(te+=" (No markers)",ne=!0),Z.push(["surficial",te,ne]),$.forEach(e=>{const t=e.logger.logger_name,a="subsurface_".concat(t);let n="Subsurface - ".concat(t.toUpperCase());Q[a]=!1;const l=!e.has_data;l&&(n+=" (No data)"),Z.push([a,n,l])});const le=Object(n.useState)(Q),re=Object(o.a)(le,2),ce=re[0],ie=re[1],oe=Z.map(e=>({state:ce[e[0]],value:e[0],label:e[1],is_disabled:e[2]})),me=Object(n.useState)(!1),de=Object(o.a)(me,2),ue=de[0],pe=de[1],be=Object(n.useState)(null),ge=Object(o.a)(be,2),Ee=ge[0],fe=ge[1],he=Object(n.useState)(null),_e=Object(o.a)(he,2),ye=_e[0],ve=_e[1];Object(n.useEffect)(()=>{if(ue){null!==Ee&&clearTimeout(Ee),ve("typing");const e=setTimeout(()=>{ve("saving");const e=setTimeout(()=>{var e,t;e={shift_ts:a,event_id:f,dataAnalysis:A},t=e=>{console.log("response",e),ve("saved"),pe(!1)},se("".concat(ee.b,"/api/end_of_shift/save_eos_data_analysis"),e,t)},3e3);fe(e)},3e3);fe(e)}},[A]);const Oe=X()(a).add(12,"hours"),xe=X()(_),je=xe.isBefore(Oe)?xe.subtract(30,"minutes").format("YYYY-MM-DD HH:mm:ss"):X()(Oe).format("YYYY-MM-DD HH:mm:ss"),ke=window.location,Se=ke.host,Ce=ke.protocol,we="".concat(Ce,"//").concat(Se,"/chart_rendering/").concat(s,"/").concat(je),De=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{U(e)}},"Dismiss"),Ae=e=>()=>{const t=G;t.splice(e,1),q([...t])},Ie=[{label:"Shift Summary",value:S,key:"shift_summary",updateFn:C},{label:"Data Analysis",value:A,key:"data_analysis",updateFn:I}],Me=N>3e3;return l.a.createElement(Te.a,null,l.a.createElement(Ne.a,{expandIcon:l.a.createElement(el.a,null)},l.a.createElement("div",{className:c.column},l.a.createElement(v.a,{variant:"body1"},s.toUpperCase())),l.a.createElement("div",{className:c.column},l.a.createElement(v.a,{variant:"body1"},"Shift Report"))),l.a.createElement(V.a,null),l.a.createElement(Ye.a,{className:c.details},l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:12}},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Charts"))),l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,justify:"space-around"},l.a.createElement(ya,{label:"Data Sources",changeHandler:e=>t=>{const a=t.target.checked;if(ie(Object(u.a)(Object(u.a)({},ce),{},{[e]:a})),a){let t=e;["surficial","rainfall"].includes(e)||(t=e.replace("_","/")),window.open("".concat(we,"/").concat(t),"_blank")}},choices:oe,checkboxStyle:"primary"})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Attachments"))),l.a.createElement(y.a,{item:!0,xs:12,container:!0},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(h.a,{square:!0,style:{padding:"8px 12px",marginBottom:12,background:"gainsboro",border:"4px solid #CCCCCC"}},G.length>0?G.map((e,t)=>l.a.createElement(Kt.a,{key:e.name,label:e.name,onDelete:Ae(t),color:"primary"})):l.a.createElement(v.a,{variant:"body2"},l.a.createElement("i",null,"None")))),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end"},l.a.createElement("input",{className:c.input,style:{display:"none"},multiple:!0,type:"file",onChange:e=>{const t=e.target.files;for(let a=0;a<t.length;a+=1){const e=t.item(a);G.some(t=>t.name===e.name)||G.push(e)}q([...G])},onClick:e=>{e.target.value=null},id:"input-file-".concat(s)}),l.a.createElement("label",{htmlFor:"input-file-".concat(s)},l.a.createElement(p.a,{startIcon:l.a.createElement(Pl.a,null),variant:"contained",component:"span",color:"primary",size:"small"},G.length>0?"Add more":"Attach File")))),Ie.map(({label:e,value:t,key:a,updateFn:r})=>l.a.createElement(n.Fragment,{key:a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,e))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Gl.a,{onChange:t=>{"Data Analysis"===e&&(Y(t.length),null!==Ee?pe(!0):fe(1)),r(t)},defaultValue:t,modules:ql,formats:Vl})),"Data Analysis"===e&&l.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",style:{color:Me?"red":"black"}},l.a.createElement(Ke.a,{title:"Content of text area is formatted on the background using HTML. HTML elements are included in the character count.",placement:"top",interactive:!0,arrow:!0},l.a.createElement("div",null,l.a.createElement(Ll.a,{color:"primary",fontSize:"small"}),"\xa0")),l.a.createElement(v.a,{variant:"caption"},l.a.createElement("strong",null,"Character count (including HTML): ",N,"/3000")),null!==ye&&l.a.createElement(v.a,{variant:"caption",component:"div",style:{marginLeft:24,display:"flex",alignItems:"center",color:["typing","saving"].includes(ye)?"orange":"green"}},l.a.createElement("div",{style:{marginRight:6}},l.a.createElement("strong",null,ye.toUpperCase())),["typing","saving"].includes(ye)?l.a.createElement(x.a,{size:20}):l.a.createElement(ha.a,null))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Shift Narratives ")),l.a.createElement(v.a,{variant:"body2"},l.a.createElement("i",null,"NOTE: It is recommended NOT to add narratives via this text box. Use Site Logs Form instead then click Refresh."))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Gl.a,{onChange:e=>P(e),value:B,defaultValue:B,modules:ql,formats:Vl,bounds:".app"})))),l.a.createElement(V.a,null),l.a.createElement(Ze.a,null,l.a.createElement(p.a,{size:"small",onClick:()=>{const e=Zl(ce),t={site_code:s,user_id:r.user_id,charts:e,file_name:"".concat(s,"_chart.pdf")};var a,n;a=t,n=e=>{const t=e.message,a=e.file_response,n=a.file_path,l=a.message;console.log("response",l),"success"===t?F("Charts Saved! Path: ".concat(n),{variant:"success",autoHideDuration:7e3,action:De}):F("Error saving charts...",{variant:"error",autoHideDuration:7e3,action:De})},se("".concat(ee.b,"/api/end_of_shift/download_eos_charts"),a,n)},startIcon:l.a.createElement(Fl.a,null)},"Download Charts"),l.a.createElement(p.a,{size:"small",startIcon:l.a.createElement(Ul.a,null),onClick:()=>{!function(e,t){const a=e.shift_ts,n=e.event_id,l="".concat(ee.b,"/api/end_of_shift/get_narrative/").concat(a,"/").concat(n);ae.a.get(l).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({shift_ts:a,event_id:f},e=>{console.log(e),P(e)})}},"Refresh Narratives"),l.a.createElement(p.a,{size:"small",color:"primary",startIcon:l.a.createElement(zl.a,null),onClick:()=>{const e=F("Sending End-of-Shift Report...",{variant:"warning",persist:!0}),t=new FormData,n=X()(je).add(30,"minutes").format("YYYY-MM-DD HH:mm:ss");Zl(ce).forEach(e=>t.append("charts",e)),G.forEach(e=>{t.append("attached_files",e)});const l={shift_ts:a,event_id:f,data_analysis:A,file_name_ts:n,mail_body:Kl({shiftSummary:S,dataAnalysis:A,shiftNarratives:B}),site_code:s,user_id:r.user_id};for(const a in l)l.hasOwnProperty(a)&&t.append(a,l[a]);var c,i,o;c=t,i=t=>{U(e),console.log(t);let a="Error sending End-of-Shift Report...",n="error";"Success"===t&&(a="End-of-Shift Report Sent!",n="success"),F(a,{variant:n,autoHideDuration:7e3,action:De})},o=()=>{U(e),F("Error sending End-of-Shift Report...",{variant:"error",autoHideDuration:7e3,action:De})},se("".concat(ee.b,"/api/mailbox/send_eos_email"),c,i,o)},disabled:Me},"Send")))},Xl=a(1155);function $l(e){const t=e.selectedSites,a=e.setSelectedSites,n=e.site_code,l=e.checkAll,r=t;if(r.includes(n)){if(!l){const e=r.indexOf(n);r.splice(e,1)}}else r.push(n);a([...r])}var er=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.eosData,i=e.setSelectedEosData,s=e.setModalOpen,m=e.setEosData,d=Object(n.useState)([]),u=Object(o.a)(d,2),b=u[0],g=u[1],E=Object(n.useState)(!0),f=Object(o.a)(E,2),h=f[0],O=f[1],j=e=>t=>{$l({selectedSites:b,setSelectedSites:g,site_code:e})},k=null!==c&&0===c.length;return l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Generate End-of-Shift Report"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Select sites to create end-of-shift report."),null===c&&l.a.createElement(_.a,{display:"flex",justifyContent:"center"},l.a.createElement(x.a,null)),!0===k&&l.a.createElement(v.a,{variant:"subtitle1",align:"center"},"No active sites."),null!==c&&l.a.createElement(y.a,{container:!0,alignItems:"baseline"},l.a.createElement(Y.a,{onClick:()=>{c.forEach(e=>{const t=e.site_code;$l({selectedSites:b,setSelectedSites:g,site_code:t,checkAll:h})}),O(!h)},style:{marginRight:6},"aria-label":"Select all"},l.a.createElement(Xl.a,null)),c.map(e=>{const t=e.site_code,a=e.event_id,n=b.includes(t),r=t.toUpperCase();return l.a.createElement(ot.a,{key:a},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{key:a,onChange:j(t),value:t,color:"primary",checked:n}),label:r}))}))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:()=>{r(),m(null)},color:"primary"},"Cancel"),l.a.createElement(p.a,{onClick:()=>{const e=c.filter(e=>b.includes(e.site_code));i(e),s(!1)},color:"primary"},"Submit"))))}));const tr=Object(O.a)(e=>({inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},AccordionsGroup:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"24px 0"},marginTop:16},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},hidden:{display:"none !important"}})),ar=()=>l.a.createElement(Qe.a,{height:150,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},l.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}));function nr({label:e,value:t,id:a},n){return l.a.createElement(Bl.b,{required:!0,autoOk:!0,label:e,value:t,onChange:n,ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,variant:"dialog",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}function lr(e,t,a){const n="am"===t?"07:30:00":"19:30:00",l=X()(e).format("YYYY-MM-DD ".concat(n));return function(e,t){const a=e.shift_start,n="".concat(ee.b,"/api/end_of_shift/get_end_of_shift_reports/").concat(a);ae.a.get(n).then(e=>{const a=e.data;console.log("EOS Data",a),t(a)}).catch(e=>{console.error("Problem in Axios request"),console.error(e)})}({shift_start:l},e=>{a(e)}),l}function rr(e){const t=e.isStart;let a="No event report to generate";return"undefined"!==t&&t&&(a="Generate end-of-shift reports here"),l.a.createElement(h.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},l.a.createElement("div",null,a))}var cr=Object(Se.a)()((function(e){const t=e.width,a=e.hidden,r=tr(),c=X()(),i=c.hour(),s=Object(n.useState)(c.format("YYYY-MM-DD")),m=Object(o.a)(s,2),d=m[0],u=m[1],b=Object(n.useState)(i>=10&&i<=22?"am":"pm"),g=Object(o.a)(b,2),E=g[0],f=g[1],_=Object(n.useState)(!1),v=Object(o.a)(_,2),O=v[0],x=(v[1],Object(n.useState)(null)),k=Object(o.a)(x,2),S=k[0],C=k[1],w=Object(n.useState)(null),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(null),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(!1),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(j.a)(),F=e=>{u(e)},U=()=>A.map((e,t)=>l.a.createElement(Jl,{data:e,key:t,shiftStartTs:N,currentUser:L}));return l.a.createElement("div",{className:a?r.hidden:""},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:4,style:{display:a?"none !important":""}},[{label:"Shift Start",value:d,id:"start_ts"}].map(e=>{const t=e.id;return l.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t,className:r.inputGridContainer},nr(e,F))}),l.a.createElement(y.a,{item:!0,xs:12,sm:!0},l.a.createElement(Aa,{div_id:"shift_time",label:"Shift Time",changeHandler:e=>f(e.target.value),value:E,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,className:"".concat(r.inputGridContainer," ").concat(r.buttonGrid)},l.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(Se.b)("sm",t)?"small":"medium",onClick:(W="site_list",e=>{if("generate_report"===W)P(!1);else{P(!0);const e=lr(d,E,C);Y(e)}})},"Generate ",l.a.createElement(Hl.a,{className:r.button}))))),l.a.createElement("div",{className:r.AccordionsGroup},null===A&&!O&&l.a.createElement(rr,{isStart:!0}),O?l.a.createElement(ar,null):l.a.createElement(h.a,null,null!==A&&(A.length>0?l.a.createElement(U,null):l.a.createElement(rr,null)))),l.a.createElement(er,{isOpen:B,closeHandler:(z=!1,()=>P(z)),eosData:S,setSelectedEosData:I,setModalOpen:P,setEosData:C}));var z,W})),ir=a(1158),or=a(594),sr=a.n(or),mr=a(326),dr=a(431);a(1053);function ur({event:e}){const t=Object(n.useState)(null),a=Object(o.a)(t,2),r=a[0],c=a[1],i=Boolean(r),s=i?"simple-popover":void 0;return l.a.createElement("div",{style:{width:"inherit"}},l.a.createElement("div",{"aria-describedby":s,onClick:e=>{c(e.currentTarget)},role:"button",tabIndex:"0"},e.title),l.a.createElement(mr.a,{id:s,open:i,anchorEl:r,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},l.a.createElement(v.a,{variant:"body1",style:{padding:8}},e.title)))}var pr=l.a.memo((function(e){const t=e.nickname,a="undefined"!==typeof t,r=Object(dr.b)(X.a),c=Object(n.useState)([]),i=Object(o.a)(c,2),s=i[0],m=i[1],d=Object(n.useState)([]),u=Object(o.a)(d,2),p=u[0],b=u[1],g=Object(n.useState)([]),E=Object(o.a)(g,2),f=E[0],h=E[1];Object(n.useEffect)(()=>(Object($.d)(e=>m(e)),Object($.a)(),function(){Object($.g)()}),[]),Object(n.useEffect)(()=>{null===s&&"undefined"===s||b(s)},[s]),Object(n.useEffect)(()=>{const e=p.flatMap(e=>{const n=X()(e.ts),l=X()(e.ts),r=n.hours()>19?"PM":"AM";let c=l.add(12,"hours");if("PM"===r&&(c=n.set({h:23,m:59})),!a)return[{title:"".concat(e.iompmt," (MT - ").concat(r,")"),start:n,end:c},{title:"".concat(e.iompct," (CT - ").concat(r,")"),start:n,end:c}];{let a=null;if(e.iompmt===t&&(a="".concat(t," (MT")),e.iompct===t&&(a="".concat(t," (CT")),a)return[{title:"".concat(a," - ").concat(r,")"),start:n,end:c}]}});h(e)},[p,t]);const _=X()();return l.a.createElement("div",{style:{height:a?300:850,width:"-webkit-fill-available"}},l.a.createElement(v.a,{variant:"subtitle2",align:"center"},l.a.createElement("i",null,"Note: The border color of the bordered box specifies the current monitoring shift.")),l.a.createElement(dr.a,{events:f,localizer:r,defaultDate:new Date,eventPropGetter:(e,t,a)=>{let n="#E5DE44",l="black";return X()(t).hours()>19&&(n="#053752",l="white"),{className:"",style:{color:l,borderRadius:5,border:"none",fontSize:12,backgroundColor:n}}},defaultView:"month",dayPropGetter:e=>{const t=_.hours(),a=X()(e),n=_.clone().subtract(1,"day"),l=t<8&&n.isSame(a,"day"),r=t>=8&&a.isSame(_,"day");if(l||r){return{className:"current-shift",style:{border:"dashed 5px ".concat(t>=8&&t<20?"#E5DE44":"#053752")}}}return{}},views:["month"],components:{event:ur},popup:!0}))}));const br=Object(O.a)(e=>{const t=Object(fe.d)(e);return{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),selects:{width:"auto",[e.breakpoints.up("md")]:{width:"-webkit-fill-available"}},link:{textDecoration:"none"},valueFont:{color:"black",textDecoration:"none"},hidden:{display:"none !important"}}});function gr(e,t){return t.map((t,a)=>{const n=t.date,r=t.data,c=t.ampm,i=t.mt,o=t.ct,m=sr.a.toWords(r.length),d="".concat(le(m)," (").concat(r.length,")"),u=r.map((t,a)=>{const n=t.general_status,r=t.site_code,c=t.public_alert_level,i=t.event_id,o=t.internal_alert,m=function(e,t,a){return l.a.createElement(s.b,{className:e.link,to:"/monitoring/events/".concat(t),target:"_blank"},a.toUpperCase())}(e,i,r);return l.a.createElement(y.a,{container:!0,justify:"space-evenly",direction:"column",item:!0,xs:4,key:"site_alert_".concat(a+1)},l.a.createElement(v.a,{variant:"body2",align:"center"},l.a.createElement("span",{className:e.valueFont},m)),l.a.createElement(v.a,{variant:"body2",align:"center"},l.a.createElement("span",{className:e.valueFont},"Alert ",c," (",o,")")),l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"Monitoring status: ",l.a.createElement("span",{className:e.valueFont},le(n))))});return l.a.createElement(Te.a,{key:"monitoring_date_".concat(a+1)},l.a.createElement(Ne.a,{expandIcon:l.a.createElement(el.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},l.a.createElement(y.a,{container:!0},l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{color:"textSecondary",align:"center"},"Shift Date: ",l.a.createElement("span",{className:e.valueFont},X()(n).format("MMMM D, YYYY")))),l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{color:"textSecondary",align:"center"},"Sites Monitored: ",l.a.createElement("span",{className:e.valueFont},d))),l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{color:"textSecondary",align:"center"},"Shift Schedule: ",l.a.createElement("span",{className:e.valueFont},c))))),l.a.createElement(V.a,null),l.a.createElement(Ye.a,null,l.a.createElement(y.a,{container:!0,spacing:2,className:e.def_padding},l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"Shift Schedule"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},c)),l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"MT Personnel"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},i)),l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"CT Personnel"),l.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},o)),l.a.createElement("div",{style:{paddingTop:20,paddingBottom:20}},l.a.createElement(V.a,null)),u)),l.a.createElement(V.a,null))})}var Er=Object(Se.a)()((function(e){const t=e.hidden,a=e.width,r=e.defaultCalendarOpen,c=br(),i=Object(n.useState)(null),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)(null),b=Object(o.a)(u,2),g=b[0],E=b[1],f=Object(n.useState)(""),_=Object(o.a)(f,2),O=_[0],x=_[1],j=Object(n.useState)({}),k=Object(o.a)(j,2),S=k[0],C=k[1],w=Object(n.useState)(""),D=Object(o.a)(w,2),A=D[0],I=D[1];Object(n.useEffect)(()=>{C({ts_start:X()(m).format("YYYY-MM-DD HH:mm:ss"),ts_end:X()(g).format("YYYY-MM-DD HH:mm:ss"),user_id:O})},[m,g,O]);const M=e=>t=>{switch(e){case"ts_start":d(t);break;case"ts_end":E(t)}};return l.a.createElement("div",{className:t?c.hidden:""},l.a.createElement(Te.a,{defaultExpanded:r},l.a.createElement(Ne.a,{expandIcon:l.a.createElement(el.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},l.a.createElement(v.a,{variant:"body1",component:y.a,container:!0},l.a.createElement(ir.a,{style:{marginRight:8}})," ",l.a.createElement("div",null,l.a.createElement("strong",null,"MONITORING SHIFTS CALENDAR")))),l.a.createElement(V.a,null),l.a.createElement(Ye.a,null,l.a.createElement(pr,null))),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(h.a,{component:y.a,container:!0,spacing:2,style:{marginTop:16,marginBottom:16,padding:8},alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6"},l.a.createElement("strong",null,"MONITORING SHIFT CHECKER")),l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("i",null,"Note: The checker currently shows event and extended releases only. Routine releases are NOT yet reflected."))),l.a.createElement(y.a,{container:!0,spacing:2,item:!0,xs:12,sm:10},[{label:"Start Timestamp",value:m,id:"ts_start"},{label:"End Timestamp",value:g,id:"ts_end"}].map(e=>l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,key:e.id},function({label:e,value:t,id:a},n){return l.a.createElement(Ut.a,{required:!0,autoOk:!0,label:e,value:t,onChange:n(a),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,inputVariant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,M))),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4},l.a.createElement(Ra,{label:"Staff Name",div_id:"user_id",changeHandler:(T="user_id",e=>{const t=e.target.value;switch(T){case"user_id":x(t)}}),value:O,css:c.selects,variant:"outlined"}))),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,container:!0,justify:"center"},l.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(Se.b)("sm",a)?"small":"medium",onClick:()=>{var e,t;e=S,t=e=>{const t=gr(c,e);I(l.a.createElement(v.a,{style:{fontStyle:"italic"}},"No shift data")),t.length>0&&I(t)},se("".concat(ee.b,"/api/shift_checker/get_shift_data"),e,t)},endIcon:l.a.createElement(Hl.a,null)},"Generate"))),l.a.createElement(y.a,{item:!0,sm:12},A)));var T}));const fr=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})}),hr=[{label:"End-of-Shift Report Generator",href:"report_generator"},{label:"Monitoring Shifts",href:"shifts"}];Object(n.createContext)();var _r=function(e){const t=e.history,a=e.match.url,r=e.location.pathname,c=Object(n.useState)(0),i=Object(o.a)(c,2),s=i[0],d=i[1],u=fr(),p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],E=b[1];return Object(n.useEffect)(()=>{const e=Object(m.f)(r,{path:"".concat(a,"/:tab"),exact:!0});if(e){const t=e.params.tab,a=hr.findIndex(e=>e.href===t);d(a),1===a&&E(!0)}},[a]),l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:u.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Shifts & Reports"})),l.a.createElement("div",{className:u.tabBar},l.a.createElement(Ve,{chosenTab:s,onSelect:e=>{d(e),t.push("".concat(a,"/").concat(hr[e].href))},tabsArray:hr})),l.a.createElement("div",{className:"".concat(u.pageContentMargin," ").concat(u.tabBarContent)},l.a.createElement(cr,{hidden:0!==s}),l.a.createElement(Er,{hidden:1!==s,defaultCalendarOpen:g})))},yr=a(1145),vr=a(1159),Or=a(1160);class xr extends l.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,r=e.searchText,c=e.onSearchClick;return l.a.createElement(xe.a,{appear:!0,in:!0,timeout:300},l.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},l.a.createElement(g.a,{placeholder:"Type words to search narrative column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:r||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),l.a.createElement(Y.a,{className:t.clearIcon,style:{marginLeft:6},onClick:c},l.a.createElement(wl.a,null)),l.a.createElement(Y.a,{className:t.clearIcon,onClick:n},l.a.createElement(Al.a,null))))}}var jr=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(xr);function kr(e,t,a=null){ae.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}const Sr=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}));var Cr=function(e){const t=Sr(),a=e.narrativeData,n=e.setNarrativeData,r=e.siteList,c=e.setSiteList,i=e.isFromSiteLogs,o=e.callAck,s=e.setCallAck,m=e.callAckHashtag,d=e.toUseCurrentInstance,p=e.setToUseCurrentInstance,b=a.narrative,E=a.timestamp,f=a.user_id,h=a.narrative_id,_=e=>t=>{n(Object(u.a)(Object(u.a)({},a),{},{[e]:t}))},O=e=>t=>{const l=t.target.value;n(Object(u.a)(Object(u.a)({},a),{},{[e]:l}))};return l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},l.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},l.a.createElement(ua,{value:r,changeHandler:e=>{c(e)},isMulti:!0,isFromSiteLogs:i,disabled:Boolean(h)})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},l.a.createElement(Bl.a,{required:!0,autoOk:!0,label:"Date",value:E,onChange:_("timestamp"),ampm:!1,placeholder:"2020-01-01",format:"YYYY-MM-DD",mask:"____-__-__",clearable:!0,disableFuture:!0,fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},l.a.createElement(Ja.b,{required:!0,autoOk:!0,label:"Time",value:E,onChange:_("timestamp"),ampm:!1,placeholder:"00:00",format:"HH:mm",mask:"__:__",clearable:!0,disableFuture:!0,fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},l.a.createElement(Ra,{variant:"standard",label:"Reporter",div_id:"user_id",changeHandler:O("user_id"),value:f,disabled:!0})),l.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},l.a.createElement(mt.a,{value:"callAck",control:l.a.createElement(Lt.a,{color:"primary",checked:d,onClick:e=>p(e.target.checked)}),label:l.a.createElement("div",null,"Associate site log to current monitoring instance\xa0",l.a.createElement(Ke.a,{title:"Unchecking this will associate the log on the montoring event where the log's timestamp falls through."},l.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(mt.a,{value:"callAck",control:l.a.createElement(Lt.a,{color:"primary",checked:o,onClick:e=>{const t=e.target.checked;s(t);let l=b;const r=" ".concat(m);t?(b.length+r.length>1e3&&l.substring(0,1e3-r.length),l+=r):l=b.replace(r,""),n(Object(u.a)(Object(u.a)({},a),{},{narrative:l}))}}),label:l.a.createElement("div",null,"Early Warning Information (EWI) acknowledgement call\xa0",l.a.createElement(Ke.a,{title:"Tick this if the log to enter is a call that acknowledges an EWI. This will add #EWIResponseCall on the narrative."},l.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),l.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},l.a.createElement(g.a,{required:!0,id:"standard-multiline-static",label:"Narrative",value:b,onChange:O("narrative"),placeholder:"Enter narrative",multiline:!0,rows:"4",rowsMax:4,fullWidth:!0,inputProps:{maxLength:1e3},variant:"filled"}),l.a.createElement(v.a,{component:y.a,container:!0,justify:"flex-end",variant:"caption"},"Characters: ",b.length,"/1000"))))};var wr=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.setIsUpdateNeeded,s=e.chosenNarrative,m=e.isEditMode,d=e.isFromSiteLogs,u=e.setSort,b=e.resetInput,g=Object(i.b)(),E=g.enqueueSnackbar,f=g.closeSnackbar,h=Object(j.a)(),_={narrative_id:null,timestamp:X()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:h.user_id,event_id:null,type_id:1},y=Object(n.useState)(null),v=Object(o.a)(y,2),O=v[0],x=v[1],k=Object(n.useState)(_),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)(!0),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useContext)(sa).sites,N=(Y=!0,T.map(e=>{const t=e.site_code,a=e.site_id;let n=t.toUpperCase();return Y&&(n=ne(e,!0,"start")),{value:a,label:n,data:e}}));var Y;const R=Object(n.useState)(!1),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(n.useState)(!0),F=Object(o.a)(L,2),U=F[0],z=F[1];Object(n.useEffect)(()=>{let e={},t="";if(0!==Object.keys(s).length){const a=s.id,n=s.narrative,l=s.timestamp,r=s.site_id,c=s.user_id,i=s.event_id,o=s.type_id,m=N.filter(e=>e.value===r);delete m.data,m.event_id=i,x([...m]),e={narrative_id:a,timestamp:l,narrative:n,user_id:c,event_id:i,type_id:o},w(e),t=n}P(t.includes("#EWIResponseCall"))},[s]),Object(n.useEffect)(()=>{const e=""===C.narrative||null===O;M(e)},[C,O]);const W=()=>{w({narrative_id:null,narrative:"",user_id:h.user_id,event_id:"",type_id:1}),x(O),P(!1),z(!0)},G=()=>{w({narrative_id:null,timestamp:X()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:h.user_id,event_id:"",type_id:1}),x(null),z(!0)},q=()=>{r(),G()};return l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Site Logs Form"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Note: Only monitoring-related narratives can be entered in this form. Please use other forms dedicated to its purposes."),l.a.createElement(Cr,{narrativeData:C,setNarrativeData:w,siteList:O,setSiteList:x,isFromSiteLogs:d,callAck:B,setCallAck:P,callAckHashtag:"#EWIResponseCall",toUseCurrentInstance:U,setToUseCurrentInstance:z})),l.a.createElement(ut.a,null,l.a.createElement("div",null,l.a.createElement(p.a,{onClick:q,color:"primary"},"Cancel"),l.a.createElement(p.a,{onClick:G},"Reset"),l.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{M(!0);const e=E("Inserting site log...",{variant:"warning",persist:!0}),t=O.map(e=>{const t=e.value;let a=e.event_id||null;return U||(a=null),{site_id:t,event_id:a}});var a;C.site_list=t,C.timestamp=X()(C.timestamp).format("YYYY-MM-DD HH:mm:ss"),C.user_id=h.user_id,console.log(C),a=t=>{console.log("ret",t),W(),f(e),E("Site log inserted successfully!",{variant:"success",autoHideDuration:3e3}),u({order_by:"id",order:"desc"}),b(),c(!0),m&&q()},kr(C,"".concat(ee.b,"/api/narratives/write_narratives_to_db"),a)},disabled:I},m?"Save Edits":"Save & Add More")))))}));var Dr=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,n=e.closeHandler,r=e.chosenNarrative,c=e.setIsUpdateNeeded,i=r.id,o=r.narrative;return l.a.createElement("div",null,l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Site Logs Delete"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Are you sure you want to delete this narrative?"),l.a.createElement(it.a,{align:"center"},'"'.concat(o,'"'))),l.a.createElement(ut.a,null,l.a.createElement("div",null,l.a.createElement(p.a,{onClick:n,color:"primary"},"Cancel"),l.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:()=>{n();var e;e=e=>{console.log("ret",e),c(!0)},kr({narrative_id:i},"".concat(ee.b,"/api/narratives/delete_narratives_from_db"),e)},disabled:!1},"Confirm")))))}));const Ar=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(u.a)(Object(u.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}})})}),Ir=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Mr=Object(Se.a)()((function(e){const t=e.width,a=Ar(),r=Object(n.useState)([]),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)(0),d=Object(o.a)(m,2),b=d[0],g=d[1],E=Object(n.useState)(10),f=Object(o.a)(E,2),_=f[0],y=f[1],v=Object(n.useState)(0),O=Object(o.a)(v,2),x=O[0],j=O[1],k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)([]),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useState)(""),N=Object(o.a)(T,2),R=N[0],H=N[1],P=Object(n.useState)({order_by:"timestamp",order:"desc"}),L=Object(o.a)(P,2),F=L[0],U=L[1],z=Object(n.useState)(!0),W=Object(o.a)(z,2),G=W[0],q=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)(!1),$=Object(o.a)(J,2),te=$[0],le=$[1],re=Object(n.useState)(!1),ce=Object(o.a)(re,2),ie=ce[0],oe=ce[1],se=Object(n.useState)({}),me=Object(o.a)(se,2),de=me[0],ue=me[1],pe=Object(n.useState)(!0),be=Object(o.a)(pe,2),ge=be[0],Ee=be[1],fe=Object(n.useState)(null),he=Object(o.a)(fe,2),_e=he[0],ye=he[1],ve=Object(n.useContext)(sa).setIsReconnecting,Oe=Object(n.useContext)(sa).sites,xe=[],je={};Oe.forEach(e=>{const t=e.site_code.toUpperCase();xe.push(t),je[t]=e.site_id}),Object(n.useEffect)(()=>(ht(ve),vt(e=>ye(e)),function(){yt()}),[]),Object(n.useEffect)(()=>{if(ge){q(!0);!function(e,t){const a=e.include_count,n=e.limit,l=e.offset,r=e.filters,c=e.search_str,i=e.order_by,o=e.order;let s="".concat(ee.b,"/api/narratives/get_narratives?limit=").concat(n,"&offset=").concat(l);if(s+="&order_by=".concat(i,"&order=").concat(o),a&&(s+="&include_count=true"),0!==r.length){s+=r.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==c&&(s+="&search=".concat(c)),ae.a.get(s).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(Object(u.a)({include_count:!0,limit:_,offset:b*_,filters:C,search_str:R},F),e=>{const t=e.narratives,a=e.count,n=t.map(e=>{const t=e.narrative,a=e.user_details,n=e.site_id,l=e.user_id,r=e.id,c=e.type_id,i=e.event_id,o=e.timestamp;let s="---";if(null!==a){const e=a.last_name,t=a.first_name;s="".concat(t," ").concat(e)}return{narrative:t,user_details:s,site_name:ne(e.site,!0,"start"),timestamp:o,type:e.type_id,actions:"---",site_id:n,user_id:l,id:r,type_id:c,event_id:i}});s(n),j(a),q(!1)}),Ee(!1)}},[b,_,C,R,F,ge]);const ke=(e=!1)=>{g(0),e||w([]),H("")},Ce=(e,t)=>()=>{"is_narrative_modal_open"===e?(K(!Z),oe(!1),ue({})):"is_open_delete_modal"===e&&le(!te)},we={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(Se.c)(t,"xs")?"standard":"simple",serverSide:!0,searchText:R,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:x,page:b,onTableChange(e,t){if("changePage"===e){const e=t.page;g(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==_&&y(e)}else"resetFilters"===e&&(M({}),w([]));["changePage","changeRowsPerPage","resetFilters"].includes(e)&&Ee(!0)},onColumnSortChange(e,t){U({order_by:e,order:"ascending"===t?"asc":"desc"}),Ee(!0)},onFilterChange(e,t){const a=[];let n=!0;t.forEach((e,t)=>{if(0!==e.length){n=!1;const l=De[t].name;if("site_name"===l){const t=[],n=[];e.forEach(e=>{t.push(je[e]),n.push(e)}),a.push({name:"site_ids",data:t}),M(Object(u.a)(Object(u.a)({},I),{},{[l]:n}))}}}),n&&M({}),w(a),Ee(!0)},customSearchRender:(e,t,a,n)=>{const r=e||"";return l.a.createElement(jr,{searchText:e,onSearch:t,onHide:()=>{a(),H(""),Ee(!0)},options:n,onSearchClick:()=>{ke(!0),H(r),Ee(!0)}})}},De=[{name:"id",label:"Log ID",options:{filter:!1,display:!1,sort:!0}},{name:"timestamp",label:"Timestamp",options:{filter:!1,sort:!0,sortDirection:"timestamp"===F.order_by?F.order:"none",customBodyRender:e=>X()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"site_name",label:"Site",options:{display:"true",filter:!0,filterType:"custom",filterList:"undefined"===typeof I.site_name?[]:I.site_name,filterOptions:{fullWidth:!0,logic:(e,t)=>!!t.length&&!t.includes(e),display(e,t,n,r){const c=_e.latest,i=_e.extended,o=[...c,..._e.overdue];return l.a.createElement(ot.a,null,l.a.createElement(wa.a,null,"Site"),l.a.createElement(Da.a,{multiple:!0,value:e[n],renderValue:e=>e.join(", "),onChange:a=>{e[n]=a.target.value,t(e[n],n,r)}},xe.map(t=>{const r=t.toLowerCase(),c=o.find(e=>e.event.site.site_code===r),s=i.find(e=>e.event.site.site_code===r);let m=a.alert0;c&&(m=a.alert3),s&&(m=a.extended);const d=c||s?l.a.createElement(Dn.a,null,l.a.createElement(Be.a,null)):"";return l.a.createElement(B.a,{key:t,value:t,className:m},l.a.createElement(Lt.a,{color:"primary",checked:e[n].indexOf(t)>-1}),l.a.createElement(wn.a,{primary:t}),d)})))}},sort:!1}},{name:"narrative",label:"Narrative",options:{filter:!1,sort:!1}},{name:"type",label:"Type",options:{filter:!0}},{name:"user_details",label:"Reporter",options:{filter:!1}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,{rowIndex:t})=>function(e,t){const a=t.setChosenNarrative,n=t.setIsOpenNarrativeModal,r=t.setIsOpenDeleteModal,c=t.setIsEditMode;return l.a.createElement("span",null,l.a.createElement(Y.a,{tooltip:"Edit",style:{float:"left"},onClick:t=>{a(e),n(!0),c(!0)}},l.a.createElement(vr.a,{style:{fontSize:20}})),l.a.createElement(Y.a,{tooltip:"Delete",style:{float:"left"},onClick:t=>{a(e),r(!0)}},l.a.createElement(Or.a,{style:{fontSize:20}})))}(i[t],{setChosenNarrative:ue,setIsOpenNarrativeModal:K,isOpenNarrativeModal:Z,setIsOpenDeleteModal:le,isOpenDeleteModal:te,setIsEditMode:oe,isEditMode:ie})}}],Ae=Object(Se.c)("md",t),Ie=l.a.createElement("span",null,l.a.createElement(p.a,{"aria-label":"Write a site log",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:Ce("is_narrative_modal_open")},l.a.createElement(Re.a,{style:{paddingRight:4,fontSize:20}}),"Write a Site Log"));return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Site Logs",customButtons:!!Ae&&Ie})),l.a.createElement(lt.a,{open:G,fullWidth:!0},l.a.createElement(ct.a,null,l.a.createElement("div",{style:{flexGrow:1}},l.a.createElement(yr.a,{variant:"query",color:"secondary"})))),l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(h.a,{className:a.paperContainer},l.a.createElement(_l.a,{theme:Ir},l.a.createElement(fl.a,{title:"Site Logs",data:i,columns:De,options:we})))),l.a.createElement(wr,{isOpen:Z,closeHandler:Ce("is_narrative_modal_open"),setIsUpdateNeeded:Ee,chosenNarrative:de,isFromSiteLogs:_e,isEditMode:ie,setSort:U,resetInput:ke}),l.a.createElement(Dr,{isOpen:te,closeHandler:Ce("is_open_delete_modal"),chosenNarrative:de,setIsUpdateNeeded:Ee}))}));class Tr extends l.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,r=e.searchText,c=e.onSearchClick;return l.a.createElement(xe.a,{appear:!0,in:!0,timeout:300},l.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},l.a.createElement(g.a,{placeholder:"Type words to search details column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:r||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),l.a.createElement(Y.a,{className:t.clearIcon,style:{marginLeft:6},onClick:c},l.a.createElement(wl.a,null)),l.a.createElement(Y.a,{className:t.clearIcon,onClick:n},l.a.createElement(Al.a,null))))}}var Nr=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(Tr);const Yr={},Rr=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(fe.d)(e)),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8}})),Hr=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Br=Object(Se.a)()((function(e){const t=e.width,a=Rr(),r=Object(n.useState)([]),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)(0),d=Object(o.a)(m,2),b=d[0],g=d[1],E=Object(n.useState)(5),f=Object(o.a)(E,2),_=f[0],y=f[1],v=Object(n.useState)(0),O=Object(o.a)(v,2),x=O[0],j=O[1],k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)([]),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useState)(""),N=Object(o.a)(T,2),R=N[0],H=N[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(!0),z=Object(o.a)(U,2),W=z[0],G=z[1],q=Object(n.useState)(!1),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)({}),J=Object(o.a)(K,2),$=J[0],te=J[1],ne=Object(n.useState)(!1),le=Object(o.a)(ne,2),re=le[0],ce=le[1],ie=Object(n.useState)(!1),oe=Object(o.a)(ie,2),se=oe[0],me=oe[1],de=Object(n.useState)(!0),ue=Object(o.a)(de,2),pe=ue[0],be=ue[1];Object(n.useEffect)(()=>{G(!0);!function(e,t){const a=e.include_count,n=e.limit,l=e.offset,r=e.filters,c=e.search_str,i=e.include_expired;let o="".concat(ee.b,"/api/issues_and_reminders/get_issues_and_reminders");if(o+="?include_expired=".concat(i),null!==n||null!==l){if(o+="&limit=".concat(n,"&offset=").concat(l),a&&(o+="&include_count=true"),0!==r.length){o+=r.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==c&&(o+="&search=".concat(c))}ae.a.get(o).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}({include_count:!0,limit:_,offset:b*_,filters:C,search_str:R,include_expired:!0},e=>{const t=e.issues_and_reminders,a=e.count;s(t),j(a),G(!1)})},[b,_,C,R,pe]);const ge=(e,t)=>()=>{"is_issue_reminder_modal_open"===e&&(Z(t),ce(!1))},Ee={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(Se.c)(t,"xs")?"standard":"simple",serverSide:!0,rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:x,page:b,onTableChange(e,t){if("changePage"===e){const e=t.page;g(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==_&&y(e)}else"resetFilters"===e?(M({}),w([])):"onSearchOpen"===e&&F(!0)},onFilterChange(e,t){const a=[];let n=!0;t.forEach((e,t)=>{if(0!==e.length){n=!1;const l=fe[t].name;if("site_name"===l){const t=[],n=[];e.forEach(e=>{t.push(Yr[e]),n.push(e)}),a.push({name:"site_ids",data:t}),M(Object(u.a)(Object(u.a)({},I),{},{[l]:n}))}}}),n&&M({}),w(a)},customSearchRender:(e,t,a,n)=>{let r=e||"";L&&(r=R,F(!1));return l.a.createElement(Nr,{searchText:e,onSearch:t,onHide:()=>{a(),F(!1)},options:n,onSearchClick:()=>H(r)})}},fe=[{name:"ts_posted",label:"Date Posted",options:{filter:!1,customBodyRender:e=>X()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"detail",label:"Details",options:{filter:!1}},{name:"reporter",label:"Reporter",options:{filter:!0,customBodyRender:(e,{rowIndex:t})=>{const a=i[t];return"".concat(a.issue_reporter.first_name," ").concat(a.issue_reporter.last_name)}}},{name:"ts_expiration",label:"Posted Until",options:{filter:!1,sort:!1,customBodyRender:e=>null===e?"-":X()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"resolved_by",label:"Resolved By",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"resolution",label:"Resolution",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,{rowIndex:t})=>{const a=i[t],n=a.ts_expiration,r=a.resolution;return X()(n).isAfter(X()())||null!==r?"Finished":function(e,t){const a=t.setChosenIssueReminder,n=t.setIsOpenIssueReminderModal,r=t.setToResolve,c=t.setIsIandRUpdateNeeded,i=e.ts_resolved,o=e.ts_expiration,s=X()().isBefore(o)||null===o,m=null===i&&(s||null===o);return l.a.createElement("span",null,s&&l.a.createElement(Y.a,{tooltip:"Edit",style:{float:"left"},onClick:t=>{a(e),n(!0),c(!0),r(!1)}},l.a.createElement(vr.a,{style:{fontSize:20}})),m&&l.a.createElement(Y.a,{tooltip:"Delete",style:{float:"left"},onClick:t=>{a(e),n(!0),c(!0),r(!0)}},l.a.createElement(Or.a,{style:{fontSize:20}})),!s&&!m&&"Finished")}(a,{setChosenIssueReminder:te,setIsOpenIssueReminderModal:Z,isOpenIssueReminderModal:Q,setToResolve:me,setIsIandRUpdateNeeded:ce})}}}],he=Object(Se.c)("md",t),_e=l.a.createElement("span",null,l.a.createElement(p.a,{"aria-label":"Post an Issue or reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:ge("is_issue_reminder_modal_open",!0)},l.a.createElement(Re.a,{style:{paddingRight:4,fontSize:20}}),"Post an Issue / Reminder"));return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Issues and Reminders",customButtons:!!he&&_e})),l.a.createElement(lt.a,{open:W,fullWidth:!0},l.a.createElement(ct.a,null,l.a.createElement("div",{style:{flexGrow:1}},l.a.createElement(yr.a,{variant:"query",color:"secondary"})))),l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(h.a,{className:a.paperContainer},l.a.createElement(_l.a,{theme:Hr},l.a.createElement(fl.a,{title:"Issues and Reminders",data:i,columns:fe,options:Ee})))),l.a.createElement(Qn,{isOpen:Q,closeHandler:ge("is_issue_reminder_modal_open",!1),isIandRUpdateNeeded:re,setIsIandRUpdateNeeded:ce,chosenIssueReminder:$,toResolve:se,setToRefresh:be,toRefresh:pe}))})),Pr=a(597),Lr=a.n(Pr),Fr=a(131),Ur=a.n(Fr);const zr=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Wr=Object(Se.a)()((function(e){const t=e.width,a=e.isLoading,r=e.columns,c=e.type,i=e.datas,s=e.shift_start_ts,m=Object(n.useState)(i),d=Object(o.a)(m,2),p=d[0],b=d[1],g=Object(n.useState)([]),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Ur()(p).groupBy("site_name").map((e,t)=>t).value().length;Object(n.useEffect)(()=>{r.map((e,t)=>{switch(e.name){case"ewi_sms":e.options=Object(u.a)(Object(u.a)({},e.options),{},{customBodyRender:(e,t)=>{const a=t.tableData,n=t.rowIndex,r=X()(a[n].ts_limit_start),i=X()(e);_>5?r.add(_,"minutes"):r.add(5,"minutes"),"Lowering"===c&&r.add(15,"minutes");const o=i>r;return l.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"Routine"!==c:e.options=Object(u.a)(Object(u.a)({},e.options),{},{customBodyRender:(e,t,a)=>{const n=t.tableData,r=t.rowIndex,i=X()(n[r].ts_limit_start).format("YYYY-MM-DD HH:mm:ss");let o=X()(n[r].ts_limit_start).add(10,"minutes");const s=X()(e);_>5&&(o=i.add(2*_,"minutes")),"Lowering"===c&&o.add(15,"minutes");const m=s>o;return l.a.createElement("span",{style:{color:m?"red":""}},e)}});break;case"rainfall_info":e.options=Object(u.a)(Object(u.a)({},e.options),{},{customBodyRender:(e,t,a)=>{const n=t.tableData,r=t.rowIndex,c=X()(n[r].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),i=X()(c).add(15,"minutes"),o=X()(e)>i;return l.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"ground_measurement":e.options=Object(u.a)(Object(u.a)({},e.options),{},{customBodyRender:(e,t,a)=>{const n=t.tableData,r=t.rowIndex,c=X()(n[r].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),i=X()(c).subtract(2.5,"hours"),o=X()(c).subtract(2,"hours"),s=X()(e),m=!!(s>=i&&s<=o);return l.a.createElement("span",{style:{color:m?"red":""}},e)}})}}),h(r)},[r,i]);const y={textLabels:{body:{noMatch:"No ".concat(c," event(s)")}},responsive:Object(Se.c)(t,"xs")?"standard":"vertical",filter:!0,selectableRows:"none",print:!0,download:!0,downloadOptions:{filename:"".concat(c,"_releases_").concat(s,".csv"),separator:";"},filterType:"dropdown",onTableChange:(e,t)=>{"resetFilters"===e&&b(i),"propsUpdate"===e&&b(i)}};return l.a.createElement("div",null,l.a.createElement(_l.a,{theme:zr},l.a.createElement(fl.a,{title:l.a.createElement("div",null,l.a.createElement(v.a,{variant:"h5",component:"div"},c," releases",a&&l.a.createElement(x.a,{size:24,style:{marginLeft:15,position:"relative",top:4}}))),data:p,columns:f,options:y})))}));const Gr=Object(O.a)(e=>({root:{width:"100%"}}));function qr(e){const t=Gr(),a=e.releasesData,n=e.isLoading;return l.a.createElement("div",{className:t.root},l.a.createElement(Wr,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Event",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}const Vr=Object(O.a)(e=>({root:{width:"100%"}}));function Qr(e){const t=Vr(),a=e.releasesData,n=e.isLoading;return l.a.createElement("div",{className:t.root},l.a.createElement(Wr,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Lowering",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}const Zr=Object(O.a)(e=>({root:{width:"100%"}}));function Kr(e){const t=Zr(),a=e.releasesData,n=e.isLoading;return l.a.createElement("div",{className:t.root},l.a.createElement(Wr,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Extended",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}const Jr=Object(O.a)(e=>({root:{width:"100%"}}));function Xr(e){const t=Jr(),a=e.releasesData,n=e.isLoading,r=e.shift_start_ts;return l.a.createElement("div",{className:t.root},l.a.createElement(Wr,{isLoading:n,tableTitle:"QA for Routine Monitoring",type:"Routine",shift_start_ts:r,datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}const $r=Object(O.a)(e=>({root:{width:"100%"}}));function ec(e){const t=$r(),a=e.releasesData,n=e.isLoading;return l.a.createElement("div",{className:t.root},l.a.createElement(Wr,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Raising",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}const tc=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(fe.d)(e)),{},{root:{display:"flex",flexGrow:1},content:{flexGrow:1,padding:e.spacing(3),overFlowY:"auto"}}));function ac(e){const t=e.isStart;let a="No available data for QA";return"undefined"!==t&&t&&(a="Select shift to generate data for QA"),l.a.createElement(h.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},l.a.createElement("div",null,a))}const nc=e=>{const t=e.selectedTab,a=e.eventData,n=e.loweringData,r=e.extendedData,c=e.routineData,i=e.raisingData;return[l.a.createElement(qr,Object.assign({releasesData:a},e)),l.a.createElement(Qr,Object.assign({releasesData:n},e)),l.a.createElement(Kr,Object.assign({releasesData:r},e)),l.a.createElement(Xr,Object.assign({releasesData:c},e)),l.a.createElement(ec,Object.assign({releasesData:i},e))][t]};function lc(){const e=tc(),t=Object(n.useState)(0),a=Object(o.a)(t,2),r=a[0],c=a[1],i=X()(),s=i.hour(),m=Object(n.useState)(i.format("YYYY-MM-DD")),d=Object(o.a)(m,2),u=d[0],b=d[1],g=Object(n.useState)(s>=10&&s<=22?"am":"pm"),f=Object(o.a)(g,2),h=f[0],_=f[1],v=Object(n.useState)(!1),O=Object(o.a)(v,2),j=O[0],k=O[1],S=Object(n.useState)(null),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(null),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],U=L[1],z=Object(n.useState)([]),W=Object(o.a)(z,2),G=W[0],q=W[1],V=Object(n.useState)([]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),$=Object(o.a)(J,2),te=$[0],ne=$[1],le=e=>{b(e)};return Object(n.useEffect)(()=>{null!==w&&(w.raising.length>0&&ne(w.raising),w.event.length>0&&H(w.event),w.routine.length>0&&U(w.routine),w.extended.length>0&&q(w.extended),w.lowering.length>0&&K(w.lowering),k(!1))},[w]),Object(n.useEffect)(()=>{const e=[R.length,Z.length,G.length,F.length,te.length];c(e.indexOf(Math.max(...e)))},[R,F,Z,G,te]),l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:e.pageContentMargin},l.a.createElement(ze,{title:"Alert Monitoring | Quality Assurance"})),l.a.createElement("div",{className:e.pageContentMargin},l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:2,item:!0,xs:12,style:{marginBottom:8}},[{label:"Shift Start",value:u,id:"start_ts"}].map(t=>{const a=t.id;return l.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,className:e.inputGridContainer},nr(t,le))}),l.a.createElement(y.a,{item:!0,xs:12,sm:!0},l.a.createElement(Aa,{div_id:"shift_time",label:"Shift Time",changeHandler:e=>_(e.target.value),value:h,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"right"},l.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:()=>{k(!0);const e=function(e,t){const a=e.shift_time,n=e.start_ts,l="am"===a?"08:00:00":"20:00:00",r=X()(n).format("YYYY-MM-DD ".concat(l)),c="".concat(ee.b,"/api/monitoring/get_monitoring_releases_for_qa/").concat(r);return ae.a.get(c).then(e=>{const a=e.data;console.log("Releases",a),t(a)}).catch(e=>{console.error("Problem in Axios request"),console.error(e)}),r}({start_ts:u,shift_time:h},D);T(e)},endIcon:l.a.createElement(Lr.a,{className:e.button})},"Generate")))),null!==w&&0!==w.length?l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,sm:!0,container:!0,justify:"flex-end"},l.a.createElement(ot.a,null,l.a.createElement(Da.a,{value:r,onChange:e=>c(e.target.value),style:{width:200},autoFocus:!0},l.a.createElement(B.a,{value:0},"Event (".concat(R.length,")")),l.a.createElement(B.a,{value:4},"Raising (".concat(te.length,")")),l.a.createElement(B.a,{value:1},"Lowering (".concat(Z.length,")")),l.a.createElement(B.a,{value:2},"Extended (".concat(G.length,")")),l.a.createElement(B.a,{value:3},"Routine (".concat(F.length,")"))),l.a.createElement(E.a,null,"Select monitoring type to display"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(nc,{routineData:F,eventData:R,loweringData:Z,extendedData:G,raisingData:te,isLoading:j,shift_start_ts:M,selectedTab:r}))):l.a.createElement(y.a,{item:!0,xs:12,align:"center"},j?l.a.createElement(x.a,null):null!==M&&null!==w&&0===w.length?l.a.createElement(ac,null):l.a.createElement(ac,{isStart:!0})))))}var rc=a(1172),cc=a(1173),ic=a(108),oc=a.n(ic),sc=a(341),mc=a.n(sc),dc=a(52),uc=a.n(dc),pc=a(30),bc=a.n(pc),gc=a(208),Ec=a.n(gc),fc=a(542),hc=a(540),_c=a(1140),yc=a(1164),vc=a(1165),Oc=a(1163),xc=a(1166),jc=a(598),kc=a.n(jc),Sc=a(1161);function Cc(e,t){const a="".concat(ee.b,"/api/analysis/get_latest_data_presence/").concat(e);ae.a.get(a).then(a=>{const n=a.data;console.log("Data Presence: ".concat(e),n),t(n)}).catch(e=>{console.error(e)})}function wc(e,t){const a=e.subsurface_column,n=e.ts_end,l=e.ts_start,r=e.node_id;console.log("node level input",e);const c="".concat(ee.b,"/api/subsurface/get_subsurface_node_level/").concat(a,"/").concat(n,"/").concat(l,"/").concat(r);ae.a.get(c).then(e=>{const a=e.data;console.log("Subsurface Node Level Data",a),t(a)}).catch(e=>{console.error(e)})}function Dc(e,t){const a="".concat(ee.b,"/api/analysis/save_chart_svg");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save SVG",a),t(a)}).catch(e=>{console.error(e)})}function Ac(e){ae.a.get("".concat(ee.b,"/api/sensor_deployment/get_loggers_data")).then(t=>{const a=t.data;console.log("Loggers and Sensors Data",a),e(a)}).catch(e=>{console.log(e)})}function Ic(e,t){const a="".concat(ee.b,"/api/monitoring/get_monitoring_analytics_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Monitoring analytics data",a),t(a)}).catch(e=>{console.error(e)})}function Mc(e,t){const a=[];return t.forEach(t=>{const n=t.dataset_name,l=function(e){const t=e.dataset_name,a=e.dataset;return"velocity_acceleration"===t?a.forEach(({name:e},t)=>{"Trend Line"===e?a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{type:"spline"}):"Threshold Interval"===e?a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,color:"#FFEB32"}):"Last Data Point"===e&&(a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{marker:{symbol:"asterisk",lineColor:"#ff9e32",lineWidth:4}}))}):"displacement_interpolation"===t?a.forEach(({name:e},t)=>{"Surficial Data"===e?a[t].type="scatter":"Interpolation"===e&&(a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{marker:{enabled:!0,radius:0}}))}):"velocity_acceleration_time"===t&&a.forEach(({name:e},t)=>{"Velocity"===e?a[t].yAxis=0:"Acceleration"===e&&(a[t].yAxis=1)}),a}(t);let r;if("velocity_acceleration"===n)r=function(e,t){const a=t.site_code,n=t.marker_name,l=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity Acceleration Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(X()(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{title:{text:"<b>Velocity (cm/day)</b>"}},yAxis:{title:{text:"<b>Acceleration (cm/day^2)</b>"}},tooltip:{headerFormat:"",shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1}}}(l,e);else if("displacement_interpolation"===n)r=function(e,t){const a=t.site_code,n=t.marker_name,l=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"spline",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Displacement Interpolation Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(X()(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},tooltip:{crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}},scatter:{tooltip:{pointFormat:"Date/Time: <b>{point.x:%A, %e %b, %H:%M:%S}</b><br>Displacement: <b>{point.y:.2f}</b>"}}},credits:{enabled:!1}}}(l,e);else if("velocity_acceleration_time"===n){const t=l.findIndex(e=>"Timestamps"===e.name),a=JSON.parse(JSON.stringify(l)),n=a.splice(t,1);r=function(e,t,a){const n=a.site_code,l=a.marker_name,r=a.ts;return{series:e,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity & Acceleration vs Time Chart of ".concat(n.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(l,"</b><br/>Timestamp: <b>").concat(X()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{categories:t,type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},labels:{formatter(){return X()(this.value).format("D MMM")}},title:{text:"<b>Time (Days)</b>"}},yAxis:[{title:{text:"<b>Velocity (cm/day)</b>",style:{color:bc.a.getOptions().colors[1]}}},{title:{text:"<b>Acceleration (cm/days^2)</b>",style:{color:bc.a.getOptions().colors[0]}},labels:{style:{color:bc.a.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!1}}},credits:{enabled:!1}}}(a,Object(o.a)(n,1)[0].data,e)}a.push(r)}),a}kc()(bc.a),bc.a.SVGRenderer.prototype.symbols.asterisk=(e,t,a,n)=>["M",e-3,t-3,"L",e+a+3,t+n+3,"M",e+a+3,t-3,"L",e-3,t+n+3,"M",e-4,t+n/2,"L",e+a+4,t+n/2,"M",e+a/2,t-4,"L",e+a/2,t+n+4,"z"],bc.a.VMLRenderer&&(bc.a.VMLRenderer.prototype.symbols.asterisk=bc.a.SVGRenderer.prototype.symbols.asterisk);var Tc=function(e){const t=e.siteCode,a=e.generateTrending,r=e.setShowTrending,c=e.setGenerateTrending,i=e.chosenPoint,s=l.a.useRef(null),m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],b=d[1],g=Object(n.useState)([]),E=Object(o.a)(g,2),f=E[0],_=E[1],v=Object(n.useState)(!1),O=Object(o.a)(v,2),x=O[0],j=O[1],k=i.ts,S=i.name,C={site_code:t,ts:X()(k).format("YYYY-MM-DD HH:ss:mm"),marker_name:S};return Object(n.useEffect)(()=>{a&&(j(!0),function(e,t){const a=e.site_code,n=e.marker_name,l=e.ts,r="".concat(ee.b,"/api/surficial/get_surficial_marker_trending_data/")+"".concat(a,"/").concat(n,"/").concat(l);ae.a.get(r).then(e=>{const a=e.data;console.log("Surficial Marker Trending Data",a),t(a)}).catch(e=>{console.error(e)})}(C,e=>{const t=e.has_trend,a=e.trending_data,n=t?[...a]:[];b(n),c(!1),j(!1)}))},[a]),Object(n.useEffect)(()=>{if(0!==u.length){const e=function(e,t,a){return Mc(e,t).map(e=>l.a.createElement(uc.a,{highcharts:bc.a,options:e,ref:a}))}(C,u,s);_(e)}},[u]),l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),x?l.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:16}},l.a.createElement(yr.a,{variant:"query",style:{height:8}})):l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},l.a.createElement(p.a,{variant:"contained",onClick:()=>r(!1),color:"primary",size:"small",endIcon:l.a.createElement(Sc.a,null)},"Hide")),l.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"center",spacing:1},0!==u.length?f.map((e,t)=>l.a.createElement(y.a,{item:!0,xs:12,sm:6,key:t},l.a.createElement(h.a,null,e))):l.a.createElement(h.a,{component:y.a,container:!0,item:!0,alignItems:"center",justify:"center",style:{height:"20vh",padding:60,background:"gainsboro",border:"4px solid #CCCCCC"}},"Selected data has no trend."))))},Nc=a(1162);const Yc=e=>t=>{t.preventDefault(),e.push("/analysis/sites"),e.replace("/analysis/sites")};var Rc=function(e){const t=e.width,a=e.history;return Object(Se.b)(t,"sm")?l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:Yc(a)},l.a.createElement(Nc.a,{style:{fontSize:16}})," Back to site list"):l.a.createElement(Y.a,{variant:"contained",color:"primary",size:"small",onClick:Yc(a),style:{marginLeft:6}},l.a.createElement(Nc.a,null))};const Hc=[{label:"3 days",unit:"days",duration:3},{label:"7 days",unit:"days",duration:7},{label:"10 days",unit:"days",duration:10},{label:"2 weeks",unit:"weeks",duration:2},{label:"1 month",unit:"months",duration:1},{label:"3 months",unit:"months",duration:3},{label:"6 months",unit:"months",duration:6},{label:"1 year",unit:"years",duration:1},{label:"All",unit:"all",duration:0}],Bc=[{label:"4 hours",hour_value:4},{label:"8 hours",hour_value:8},{label:"12 hours",hour_value:12},{label:"1 day",hour_value:24}];var Pc=function(e){const t=e.isSubsurface,a=e.selectedRangeInfo,r=e.setSelectedRangeInfo,c=e.selectedHourInterval,i=e.setSelectedHourInterval,s=e.disableAll,m=Object(n.useState)(null),d=Object(o.a)(m,2),u=d[0],b=d[1],g=Object(n.useState)(null),E=Object(o.a)(g,2),f=E[0],h=E[1],_="undefined"!==typeof s&&s,y="undefined"!==typeof t&&t;let v="";if(c){const e=c.label;v=e}const O=e=>{h(e.currentTarget)},x=()=>{h(null)};return l.a.createElement("div",null,y&&l.a.createElement(n.Fragment,null,l.a.createElement(Ke.a,{title:"Select time interval",arrow:!0},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:O,style:{marginRight:6},endIcon:l.a.createElement(Oc.a,null)},v)),l.a.createElement(H.a,{id:"simple-menu",anchorEl:f,keepMounted:!0,open:Boolean(f),onClose:x},Bc.map((e,t)=>{const a=e.label;return l.a.createElement(B.a,{key:"hour_interval_".concat(t),onClick:()=>(i(e),void h(null))},a)}))),l.a.createElement(Ke.a,{title:"Select date range",arrow:!0},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{b(e.currentTarget)},style:{marginRight:y?8:0},endIcon:l.a.createElement(Oc.a,null)},a.label)),l.a.createElement(H.a,{id:"simple-menu",anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:()=>{b(null)}},Hc.map((e,t)=>{const a=e.label;return"all"===e.unit&&_?null:l.a.createElement(B.a,{key:"date_range_".concat(t),onClick:()=>(r(e),void b(null))},a)})))};function Lc(e,t){return l.a.createElement(p.a,{color:"primary",onClick:()=>{e(t)}},"Dismiss")}function Fc(e){const t=e.fullScreen,a=e.open,r=e.setIsOpen,c=e.selectedMarker,s=e.historicalMarkers,m=e.addNewMarker,d=e.siteCode,u=e.setRedrawChart,b=e.history,E=e.match.url;let f=null,h=null;if(null!==c){const e=c.marker_id,t=c.marker_name;f=e,h=t}const _=Object(i.b)(),O=_.enqueueSnackbar,x=_.closeSnackbar,j=Object(n.useState)(""),k=Object(o.a)(j,2),S=k[0],C=k[1],w=Object(n.useState)(null),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(""),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(""),H=Object(o.a)(R,2),B=H[0],P=H[1],L=()=>{r(!1),I(null),Y(""),W(null),C(""),P("")},F=Object(n.useState)(null),U=Object(o.a)(F,2),z=U[0],W=U[1],G=()=>{""===N&&W("Required field")};Object(n.useEffect)(()=>{""!==N?/[^a-zA-Z]/.test(N)?W("Enter alphabet characters only."):s.includes(N)?W("Marker name already exists."):W(null):W("")},[N]);const q=Object(n.useState)(!1),Q=Object(o.a)(q,2),Z=Q[0],K=Q[1];return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},m?"Add new marker":"Add event to Marker ".concat(h)),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,m?"Choose a new marker name then submit.":"Choose a marker event then answer the corresponding field(s)."),l.a.createElement(ot.a,{component:"fieldset",style:{display:"flex"}},!m&&l.a.createElement(st.a,{"aria-label":"marker_event",name:"marker_event",row:!0,style:{justifyContent:"space-around"},value:S,onChange:e=>{C(e.target.value),I(null),Y(""),W(null),P("")}},l.a.createElement(mt.a,{value:"reposition",control:l.a.createElement(dt.a,null),label:"Reposition"}),l.a.createElement(mt.a,{value:"rename",control:l.a.createElement(dt.a,null),label:"Rename"}),l.a.createElement(mt.a,{value:"decommission",control:l.a.createElement(dt.a,null),label:"Decommission"})),l.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:8}},""!==S&&l.a.createElement(y.a,{item:!0,xs:12,sm:!0},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Timestamp",value:A,onChange:e=>I(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),("rename"===S||m)&&l.a.createElement(y.a,{item:!0,xs:12,sm:!0},l.a.createElement(g.a,{error:Boolean(z),label:"New Marker Name",value:N,onChange:e=>Y(e.target.value.toUpperCase()),onBlur:G,type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:1},placeholder:"Input a letter",helperText:z||""})),(""!==S||m)&&l.a.createElement(y.a,{item:!0,xs:12,sm:12},l.a.createElement(g.a,{label:"Remarks",value:B,onChange:e=>P(e.target.value),onBlur:G,type:"text",multiline:!0,rowsMax:3,fullWidth:!0,inputProps:{maxLength:1500},placeholder:"Input remarks"})))),Z&&l.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:12}},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},"Are you sure submitting this data?")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)))),l.a.createElement(ut.a,null,Z&&l.a.createElement(p.a,{onClick:()=>K(!1)},"Go Back"),l.a.createElement(p.a,{variant:Z?"contained":"text",color:"secondary",onClick:()=>{let e=!0;if(("reposition"!==S||m)&&(e=!1,Z?(e=!0,K(!1)):K(!0)),e){L();const e=m?"add":S,t=m?X()():A;!function(e,t){const a="".concat(ee.b,"/api/surficial/insert_marker_event");ae.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({site_code:d,event:e,marker_id:f,ts:X()(t).format("YYYY-MM-DD HH:mm:ss"),marker_name:N,remarks:""===B?null:B},t=>{const a=t.status;let n="Error inserting new marker event...";m&&(n="Error creating new marker..."),"success"===a&&(n="Inserting new marker event successful!",m&&(n="Creating new marker successful!"),u(!0),["add","rename"].includes(e)&&b.push("".concat(E,"/").concat(N))),O(n,{variant:a,autoHideDuration:7e3,action:e=>Lc(x,e)})})}}},"Submit"),!Z&&l.a.createElement(p.a,{onClick:L},"Cancel")))}function Uc(e){const t=e.markerInfo,a=e.markerName,n=[{name:"ts",label:"Timestamp",options:{filter:!1,customBodyRender:e=>X()(e).format("D MMMM YYYY, HH:mm"),sort:!0}},{name:"event",label:"Event"},{name:"m_name",label:"Name",options:{filter:!1}},{name:"remarks",label:"Remarks",options:{filter:!1,display:!1}}],r={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",expandableRows:!0,expandableRowsHeader:!1,expandableRowsOnClick:!0,renderExpandableRow:(e,t)=>{const a=e.length+1,n=e[3];return l.a.createElement(fc.a,null,l.a.createElement(hc.a,{colSpan:a,align:"justify"},l.a.createElement("strong",null,"Remarks:")," ",n))},rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",customSort:(e,t,a)=>e.sort((e,n)=>0===t?(X()(e.data[t]).isAfter(n.data[t])?-1:1)*("desc"===a?1:-1):(e.data[t]<n.data[t]?-1:1)*("desc"===a?1:-1))};let c=[];return t&&(c=t.marker_history.map(e=>{const t=e.ts,a=e.event,n=e.marker_name,l=e.remarks,r=n?n.marker_name:"---";return{event:le(a),m_name:r,ts:t,remarks:l||"None"}})),l.a.createElement(fl.a,{title:"Marker ".concat(a," History"),columns:n,options:r,data:c})}function zc(e){const t=e.editModal,a=e.fullScreen,r=e.setEditModal,c=e.siteCode,s=e.setRedrawChart,m=e.chosenPoint,d=t.is_open,b=t.ts,E=t.name,f=t.measurement,h=t.mo_id,_=t.data_id,O=m.ts,x=m.measurement,j=Object(i.b)(),k=j.enqueueSnackbar,S=j.closeSnackbar,C=Object(n.useState)(!1),w=Object(o.a)(C,2),D=w[0],A=w[1],I=Object(n.useState)("one"),M=Object(o.a)(I,2),T=M[0],N=M[1];Object(n.useEffect)(()=>{A(!1)},[d]);const Y=(e,a)=>n=>{let l=a;"ts"===e?l=n:"measurement"===e&&(l=n.target.value),r(Object(u.a)(Object(u.a)({},t),{},{[e]:l}))};return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:a,open:d,"aria-labelledby":"form-dialog-title",TransitionComponent:a?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Update surficial data"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Carefully edit the necessary fields or delete entries if needed."),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"subtitle1",style:{fontWeight:"bold"}},c.toUpperCase()," - Marker ",E),l.a.createElement(v.a,{variant:"body2"},"Timestamp: ",X()(O).format("DD MMMM YYYY, HH:mm:ss")),l.a.createElement(v.a,{variant:"body2"},"Measurement: ",x," cm")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"EDIT")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{label:"Change marker data measurement",value:f,onChange:Y("measurement"),type:"number",fullWidth:!0,required:!0})),l.a.createElement(y.a,{item:!0,xs:12},"Change observation timestamp (applies to the rest of the points)"),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Observation Timestamp",value:X()(b),onChange:Y("ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>{let e={};O!==b&&(e=Object(u.a)(Object(u.a)({},e),{},{mo_id:h,ts:X()(b).format("YYYY-MM-DD HH:mm:ss")})),x!==f&&(e=Object(u.a)(Object(u.a)({},e),{},{data_id:_,measurement:f})),r(Object(u.a)(Object(u.a)({},t),{},{is_open:!1})),0!==Object.keys(e).length&&function(e,t){const a="".concat(ee.b,"/api/surficial/update_surficial_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Update Surficial Data Response",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{let t="Error updating surficial data...",a="error";"success"===e.status&&(t="Surficial data update successful!",a="success",s(!0)),k(t,{variant:a,autoHideDuration:7e3,action:e=>Lc(S,e)})})}},"Update Data")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"DELETE")),l.a.createElement(y.a,{item:!0,xs:12},"Be careful on deleting marker data. Delete only IF REALLY NEEDED."),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ot.a,{component:"fieldset"},l.a.createElement(st.a,{"aria-label":"gender",name:"gender1",value:T,onChange:e=>N(e.target.value)},l.a.createElement(mt.a,{value:"one",control:l.a.createElement(dt.a,null),label:"Delete measurement of this marker only"}),l.a.createElement(mt.a,{value:"all",control:l.a.createElement(dt.a,null),label:"Delete all measurements from given marker observation"})))),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>A(!0)},"Delete Data")),D&&l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(_c.a,{variant:"contained",size:"small",color:"secondary","aria-label":"small contained button group"},l.a.createElement(p.a,{disabled:!0},"Are you sure?"),l.a.createElement(p.a,{onClick:()=>{const e=t.data_id,a=t.mo_id;let n=e;"all"===T&&(n=a);const l={quantity:T,id:n};r(Object(u.a)(Object(u.a)({},t),{},{is_open:!1})),function(e,t){const a="".concat(ee.b,"/api/surficial/delete_surficial_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Delete Surficial Data Response",a),t(a)}).catch(e=>{console.error(e)})}(l,e=>{let t="Error deleting surficial data...",a="error";"success"===e.status&&(t="Surficial data delete successful!",a="success",s(!0)),k(t,{variant:a,autoHideDuration:7e3,action:e=>Lc(S,e)})})}},"Yes"),l.a.createElement(p.a,{onClick:()=>A(!1)},"No"))))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:Y("is_open",!1)},"Cancel")))}function Wc(e){const t=e.surficialDataTagModal,a=e.setSurficialDataTagModal,r=e.siteCode,c=e.setRedrawChart,s=t.is_open,m=t.ts,d=t.name,b=t.measurement,E=t.data_id,f=t.unreliable_data,h=Object(j.a)().user_id,_=Object(n.useState)(""),O=Object(o.a)(_,2),x=O[0],k=O[1],S=Object(i.b)(),C=S.enqueueSnackbar,w=S.closeSnackbar,D=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{w(e)}},"Dismiss");return l.a.createElement(lt.a,{open:s,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},f?"Unreliable data tag information":"Tag unreliable data"),l.a.createElement(ct.a,null,l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"subtitle1",style:{fontWeight:"bold"}},r.toUpperCase()," - Marker ",d),l.a.createElement(v.a,{variant:"body2"},"Timestamp: ",X()(m).format("DD MMMM YYYY, HH:mm:ss")),l.a.createElement(v.a,{variant:"body2"},"Measurement: ",b," cm")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},f?l.a.createElement(y.a,{container:!0,justify:"center"},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Tagger:")),l.a.createElement(v.a,{variant:"body1",gutterBottom:!0},"".concat(f.tagger.first_name," ").concat(f.tagger.last_name))),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Timestamp:")),l.a.createElement(v.a,{variant:"body1",gutterBottom:!0},X()(f.ts).format("DD MMMM YYYY, HH:mm:ss"))),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(v.a,{variant:"body1"},l.a.createElement("strong",null,"Remarks:")),l.a.createElement(v.a,{variant:"body1"},f.remarks))):l.a.createElement(g.a,{label:"Remarks",value:x,onChange:e=>k(e.target.value),fullWidth:!0,required:!0,error:""===x,helperText:x?"":"Required"})))),l.a.createElement(ut.a,null,!f&&l.a.createElement(p.a,{variant:"contained",color:"secondary",size:"small",onClick:()=>{!function(e,t){const a="".concat(ee.b,"/api/surficial/save_unreliable_marker_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save unreliable data",a),t(a)}).catch(e=>{console.error(e)})}({data_id:E,tagger_id:h,remarks:x},e=>{const n=e.status,l=e.message;let r;!0===n?(c(!0),a(Object(u.a)(Object(u.a)({},t),{},{is_open:!1})),r="success",k("")):r="error",C(l,{variant:r,autoHideDuration:5e3,action:D})})},disabled:""===x},"Save"),l.a.createElement(p.a,{color:"primary",onClick:(A="is_open",I=!1,e=>{a(Object(u.a)(Object(u.a)({},t),{},{[A]:I}))})},"Cancel")));var A,I}function Gc(e){const t=e.setIsOpenClickModal,a=e.open,n=e.chosenPoint,r=e.setEditModal,c=e.setShowTrending,i=e.setGenerateTrending,o=e.setSurficialDataTagModal,s=n.ts,m=n.measurement,d=n.name,p=n.unreliable_data,b=()=>{t(!1)},g=e=>t=>{b(),o(Object(u.a)(Object(u.a)({},n),{},{is_open:!0,type:e}))};return l.a.createElement(lt.a,{onClose:b,"aria-labelledby":"simple-dialog-title",open:a},l.a.createElement(rt.a,{id:"simple-dialog-title"},"Point options"),l.a.createElement(ct.a,null,l.a.createElement("div",{align:"center"},l.a.createElement(v.a,{variant:"subtitle1",style:{fontWeight:"bold"}},"Marker ",d),l.a.createElement(v.a,{variant:"body2"},"Timestamp: ",X()(s).format("DD MMMM YYYY, HH:mm:ss")),l.a.createElement(v.a,{variant:"body2"},"Measurement: ",m," cm"))),l.a.createElement(kn.a,null,l.a.createElement(Cn.a,{button:!0,onClick:()=>{b(),r(Object(u.a)(Object(u.a)({},n),{},{is_open:!0}))}},l.a.createElement(Dn.a,null,l.a.createElement(vr.a,null)),l.a.createElement(wn.a,{primary:"Edit/Delete data"})),l.a.createElement(Cn.a,{button:!0,onClick:()=>{b(),c(!0),i(!0)}},l.a.createElement(Dn.a,null,l.a.createElement(yc.a,null)),l.a.createElement(wn.a,{primary:"Generate trending chart"})),!1===p?l.a.createElement(Cn.a,{button:!0,onClick:g("tag")},l.a.createElement(Dn.a,null,l.a.createElement(vc.a,null)),l.a.createElement(wn.a,{primary:"Tag data as unreliable"})):l.a.createElement(Cn.a,{button:!0,onClick:g("show")},l.a.createElement(Dn.a,null,l.a.createElement(Ll.a,null)),l.a.createElement(wn.a,{primary:"Show unreliable tag info"}))))}function qc(e){const t=e.width,a=e.url,r=e.selectedMarker,c=e.surficialData,i=e.setIsOpenAddEventModal,m=e.setAddNewMarker,d=Object(n.useState)(null),u=Object(o.a)(d,2),b=u[0],g=u[1],E=()=>{g(null)},f=Object(Se.b)(t,"sm")&&c.length<=5;return l.a.createElement(n.Fragment,null,l.a.createElement(_c.a,{variant:"contained",color:"primary",size:"small","aria-label":"Site markers button group",style:{marginRight:6}},l.a.createElement(p.a,{disabled:!0,style:{color:"#000000"}},"Marker"),f?c.map(e=>{const t=e.marker_name,n=e.marker_id;return l.a.createElement(p.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n},t)}):l.a.createElement(p.a,{color:"primary",variant:"contained",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{g(e.currentTarget)},endIcon:l.a.createElement(Oc.a,null)},r?r.marker_name:"Select"),l.a.createElement(Ke.a,{title:"Add a new marker",onClick:()=>{m(!0),i(!0)},arrow:!0},l.a.createElement(p.a,null,l.a.createElement(xc.a,null)))),l.a.createElement(H.a,{id:"simple-menu",anchorEl:b,keepMounted:!0,open:Boolean(b),onClose:E},c.map(e=>{const t=e.marker_name,n=e.marker_id;return l.a.createElement(B.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n,onClick:E},t)})))}Ec()(bc.a);var Vc=Object(pt.a)()((function(e){const t=e.width,a=e.location.pathname,r=e.match,c=r.url,i=r.params.site_code,s=e.fullScreen,d=e.disableBack,b=e.disableMarkerList,g=e.saveSVG,E=e.input,f=e.currentUser,_=e.isEndOfShift,v=Object(n.useState)({label:"3 months",unit:"months",duration:3}),O=Object(o.a)(v,2),x=O[0],j=O[1],k=x.unit,S=x.duration;let C,w="";if("undefined"!==typeof E){const e=E.ts_end;w=e,C=X()(e)}else{const e=X()();w=e.format("YYYY-MM-DD HH:mm:ss"),C=e}const D="undefined"!==typeof d&&d,A="undefined"!==typeof b&&b,I="undefined"!==typeof g&&g,M="undefined"!==typeof _&&_,T=oe(C,S,k),N=l.a.useRef(null),Y={start:T,end:w},R=Object(n.useState)([]),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(n.useState)(null),F=Object(o.a)(L,2),U=F[0],z=F[1],W=Object(n.useState)(!1),G=Object(o.a)(W,2),q=G[0],V=G[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],$=Object(n.useState)(!0),te=Object(o.a)($,2),ne=te[0],le=te[1],re=Object(n.useState)(!1),ce=Object(o.a)(re,2),ie=ce[0],se=ce[1],me=Object(n.useState)(!1),de=Object(o.a)(me,2),ue=de[0],pe=de[1],be=Object(n.useState)(!1),ge=Object(o.a)(be,2),Ee=ge[0],fe=ge[1],he=Object(n.useState)(!1),_e=Object(o.a)(he,2),ye=_e[0],ve=_e[1],Oe=Object(n.useState)(!1),xe=Object(o.a)(Oe,2),je=xe[0],ke=xe[1],Ce={data_id:null,mo_id:null,name:null,ts:null,measurement:0},we=Object(n.useState)(Object(u.a)({},Ce)),De=Object(o.a)(we,2),Ae=De[0],Ie=De[1],Me=Object(n.useState)(Object(u.a)(Object(u.a)({},Ce),{},{is_open:!1})),Te=Object(o.a)(Me,2),Ne=Te[0],Ye=Te[1],Re=Object(n.useState)(Object(u.a)(Object(u.a)({},Ce),{},{is_open:!1})),He=Object(o.a)(Re,2),Be=He[0],Pe=He[1];Object(n.useEffect)(()=>{le(!0)},[x]),Object(n.useEffect)(()=>{const e=N.current;if((null!==e||ne)&&e.chart.showLoading(),ne){!function(e,t,a=!1){const n=e.site_code,l=e.start,r=e.end;let c="".concat(ee.b,"/api/surficial/get_surficial_plot_data/")+"".concat(n,"/").concat(l,"/").concat(r);a&&(c+="?is_end_of_shift=true"),ae.a.get(c).then(e=>{const a=e.data;console.log("Surficial Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(Object(u.a)({site_code:i},Y),t=>{if(P(t),null!==e){e.chart.hideLoading(),I&&J(!0)}},M),le(!1)}},[ne]),Object(n.useEffect)(()=>{if(!q&&0!==B.length){const e=[];B.forEach(({marker_history:t})=>{t.forEach(({marker_name:t})=>{t&&e.push(t.marker_name)})}),V(e)}},[q,B]),Object(n.useEffect)(()=>{if(0!==B.length){const e=Object(m.f)(a,{path:"".concat(c,"/:marker_name"),exact:!0});if(e){const t=e.isExact,a=e.params.marker_name;if(t){const e=B.find(e=>e.marker_name===a);"undefined"!==typeof e&&z(e)}}}},[a,B]),Object(n.useEffect)(()=>{const e=N.current.chart.getSVGForExport();if(K){Dc({user_id:f.user_id,site_code:i,chart_type:"surficial",svg:e},e=>{})}},[K]),Object(n.useEffect)(()=>{const e=N.current.chart;U&&(e.series.forEach(e=>{const t=U.marker_name===e.name;e.setVisible(t,!1)}),e.redraw(),e.reflow())},[U]);const Le=function(e,t){return l.a.createElement(uc.a,{highcharts:bc.a,options:e,ref:t})}(function(e,t,a,n,l,r){const c=e.site_code,i=e.timestamps,o=i.start,s=i.end,m=X()(o,"YYYY-MM-DD HH:mm:ss"),d=X()(s,"YYYY-MM-DD HH:mm:ss"),u=Object(Se.b)(a,"sm")?"1rem":"0.90rem";let p="As of: <b>".concat(X()(d).format("D MMM YYYY, HH:mm"),"</b>");r||(p+="<br/><i>Note: Click data points to access several options.</i>");let b=m;if((r||"None"===o)&&t.length>0){const e=t.reduce((e,t)=>{const a=e.data,n=t.data;return 0===a.length?t:0===n.length||a[0].x<n[0].x?e:t});b=e.data.length>0?X()(e.data[0].x):X()()}return t.forEach(e=>{e.turboThreshold=1e5;e.data.forEach(e=>{const t=e.unreliable_data;if(0!==Object.keys(t).length){const t={symbol:"triangle-down",radius:8,fillColor:"#FFFF00",lineColor:"#000000",lineWidth:1};e.marker=t}else e.unreliable_data=!1})}),{title:{text:"<b>Surficial Data History Chart of ".concat(c.toUpperCase(),"</b>"),style:{fontSize:u},margin:36,y:18},time:{timezoneOffset:-480},series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:24,spacingRight:24},subtitle:{text:p,style:{fontSize:"0.75rem"}},legend:{labelFormatter(){const e=this.userOptions,t=e.marker_name;return 0===e.in_use?"".concat(t," (Defunct)"):t}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},xAxis:{min:Date.parse(b),max:Date.parse(d),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0},dashStyle:"ShortDash"},series:{marker:{radius:3},cursor:"pointer",point:{events:{click(){if(!r){const e=this.data_id,t=this.x,a=this.y,r=this.mo_id,c=this.series.name,i=this.unreliable_data,o={data_id:e,name:c,mo_id:r,ts:X()(t),measurement:a,unreliable_data:i};l(o),n(!0)}}}}}},loading:{showDuration:100,hideDuration:1e3},credits:{enabled:!1}}}({site_code:i,timestamps:Y},B,t,fe,Ie,M),N);return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},l.a.createElement(y.a,{container:!0,item:!0,xs:12,style:{marginBottom:16}},!D&&l.a.createElement(y.a,{item:!0,xs:1,sm:3},l.a.createElement(Rc,e)),l.a.createElement(y.a,{item:!0,container:!0,xs:!0,justify:"flex-end"},!A&&B.length>0&&l.a.createElement(qc,Object.assign({},e,{width:t,url:c,selectedMarker:U,surficialData:B,setIsOpenAddEventModal:ve,setAddNewMarker:ke})),l.a.createElement("div",null,l.a.createElement(Pc,{selectedRangeInfo:x,setSelectedRangeInfo:j})))),l.a.createElement(y.a,{item:!0,xs:12,md:U?7:12,lg:U?8:12},l.a.createElement(h.a,{elevation:2},Le)),l.a.createElement(m.b,{path:"".concat(c,"/:marker_name"),render:e=>{const t=e.match.params.marker_name;return U?l.a.createElement(y.a,{item:!0,xs:12,md:5,lg:4},l.a.createElement(Uc,{markerInfo:U,markerName:t}),l.a.createElement(y.a,{container:!0,justify:"flex-end",style:{marginTop:12}},l.a.createElement(p.a,{variant:"contained",color:"primary",startIcon:l.a.createElement(xc.a,null),onClick:()=>{ke(!1),ve(!0)}},"Add New Event"))):""}}),ie&&l.a.createElement(Tc,{siteCode:i,setShowTrending:se,generateTrending:ue,setGenerateTrending:pe,chosenPoint:Ae})),l.a.createElement(Gc,{open:Ee,setIsOpenClickModal:fe,chosenPoint:Ae,setEditModal:Ye,setShowTrending:se,setGenerateTrending:pe,setSurficialDataTagModal:Pe}),l.a.createElement(zc,{chosenPoint:Ae,editModal:Ne,setEditModal:Ye,fullScreen:s,siteCode:i,setRedrawChart:le}),l.a.createElement(Wc,{chosenPoint:Ae,surficialDataTagModal:Be,setSurficialDataTagModal:Pe,fullScreen:s,siteCode:i,setRedrawChart:le}),l.a.createElement(Fc,Object.assign({},e,{siteCode:i,open:ye,setIsOpen:ve,selectedMarker:U,setRedrawChart:le,historicalMarkers:q,addNewMarker:je})))}));var Qc=function(e){const t=e.isOpen,a=e.closeModalFn,r=e.taggingData,c=e.onTagSuccess,s=Object(j.a)();let m={ts_start:null,ts_end:null};null!==r&&(m=Object(u.a)({},r));const d=Object(n.useState)(!1),b=Object(o.a)(d,2),E=b[0],f=b[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),O=_[0],x=_[1],k=Object(n.useState)(""),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)(!0),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(i.b)(),N=T.enqueueSnackbar,Y=T.closeSnackbar;Object(n.useEffect)(()=>{M(""===O)},[O]);const R=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{Y(e)}},"Dismiss"),H=()=>{a()};return l.a.createElement(lt.a,{fullWidth:!0,open:t,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Tag invalid rainfall data"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Fill in the required fields then submit. Note: DO NOT TAG ALREADY TAGGED POINTS."),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"Start Timestamp"),l.a.createElement(v.a,{variant:"body1",align:"center"},l.a.createElement("strong",null,m.ts_start))),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"End Timestamp"),l.a.createElement(v.a,{variant:"body1",align:"center"},l.a.createElement("strong",null,E?"Indefinite":m.ts_end))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(mt.a,{value:"isIndefinite",control:l.a.createElement(Lt.a,{color:"primary",checked:E,onClick:e=>f(e.target.checked)}),label:l.a.createElement("div",null,"Set end timestamp as indefinite\xa0",l.a.createElement(Ke.a,{title:"Checking this will show data from start timestamp to latest timestamp and all incoming data as invalid. A script will provide the end timestamp of the invalidated range."},l.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Aa,{div_id:"observed-data",label:"Observed Data",list:[{id:-1,label:"Actual rainfall data/observation is lower than recorded"},{id:0,label:"No rainfall observed; Actual data is zero"},{id:1,label:"Actual rainfall data/observation is higher than recorded"}],mapping:{id:"id",label:"label"},required:!0,value:O,error:""===O,changeHandler:e=>x(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{label:"Remarks",fullWidth:!0,multiline:!0,rowsMax:"3",value:C,onChange:e=>w(e.target.value)})))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{color:"primary",onClick:()=>{const e=Object(Fr.cloneDeep)(r);delete e.chart;const t=Object(u.a)(Object(u.a)({tagger_id:s.user_id},e),{},{observed_data:parseInt(O,10),remarks:C||null});E&&(t.ts_end=null),console.log("Submitting invalid tag",t),function(e,t){const a="".concat(ee.b,"/api/rainfall/tag_invalid_data");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save tag information",a),t(a)}).catch(e=>{console.error(e)})}(t,e=>{const t=e.status,a=e.message;"success"===t&&(H(),c()),N(a,{variant:t,autoHideDuration:3e3,action:R})})},disabled:I},"Submit"),l.a.createElement(p.a,{onClick:H,color:"primary"},"Cancel")))};window.moment=J,Ec()(bc.a);const Zc={set:{"24h":[],"72h":[],rain:[],null_ranges:[],max_rval:0,max_72h:0,gauge_name:"loading",distance:0,data_source:"loading",threshold_value:0,rain_id:null},series_data:[],max_rval_data:[]},Kc={"-1":"Actual is lower than recorded",0:"No rainfall/Data is zero",1:"Actual is higher than recorded"},Jc={"24h":"rgba(73, 105, 252, 0.9)","72h":"rgba(239, 69, 50, 0.9)",rain:"rgba(0, 0, 0, 0.9)"};function Xc(e){const t=e.null_ranges,a=e.invalid_data,n=[],l=[];Object.keys(Jc).forEach(t=>{const r=Jc[t];let c=e[t];"rain"===t&&(c=function(e,t){const a=t.length;let n=0;return e.map(e=>{const l=Object(o.a)(e,2),r=l[0],c={x:r,y:l[1]};if(a>0&&n<a){const e=t[n],a=e.ts_start,l=e.ts_end,i=J.unix(r/1e3);i.isSameOrAfter(a)&&(i.isSameOrBefore(l)||null===l)&&(c.color="rgba(250, 96, 96)",c.is_invalid=!0,Object.assign(c,t[n])),i.isSame(l)&&(n+=1)}return c})}(c,a));const i={name:t,step:!0,data:c,color:r,id:t,fillOpacity:1,lineWidth:1,turboThreshold:1e5};"rain"!==t?n.push(i):l.push(i)});const r=t.map(({from:e,to:t})=>({from:e,to:t,color:"rgba(68, 170, 213, 0.3)"}));return{set:e,series_data:n,max_rval_data:l,null_processed:r}}function $c(e){const t=e.target,a=e.is_tagging_data,n=e.rain_gauge,l=e.rain_id,r=e.setTaggingData,c=t.series,i=t.resetZoomButton,o=t.is_tagging_data,s=t.rain_gauge,m=t.rain_id,d=t.tagging_sign,u=t.setTaggingData,p=s,b=m;"undefined"!==typeof n&&(t.rain_gauge=n,t.rain_id=l);const g=u;"undefined"!==typeof r&&(t.setTaggingData=r);const E="undefined"===typeof a?!("undefined"===typeof o)&&o:a;t.is_tagging_data=E;const f=()=>{t.reset_selection.destroy(),delete t.reset_selection},h=()=>{t.submit_selection.destroy(),delete t.submit_selection};if(t.submit_selection=t.renderer.button("Submit",70,65).attr({zIndex:3,r:5,id:"submit-selection",fill:bc.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",()=>{bc.a.fireEvent(t,"selectedpoints",{selected_points:t.getSelectedPoints(),rain_gauge:p,rain_id:b,is_submit:!0,setTaggingData:g}),f(),h(),ti(c)}),t.reset_selection=t.renderer.button("Reset",133,65).attr({zIndex:3,r:5,id:"reset-selection",fill:bc.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",()=>{f(),h(),ti(c)}),"undefined"!==typeof i&&(E?i.hide():i.show()),!E)return ti(c),f(),h(),delete t.setTaggingData,"undefined"!==typeof d&&(t.tagging_sign.destroy(),delete t.tagging_sign),!0;"undefined"===typeof d&&(t.tagging_sign=t.renderer.label("Tagging",30,20).attr({fill:bc.a.getOptions().colors[5],padding:10,r:5,zIndex:8}).css({color:"#FFFFFF"}).add());let _=t.getSelectedPoints();const y=_.map(e=>e.x),v=Math.min(...y),O=Math.max(...y);return"undefined"!==typeof e.xAxis&&(c.forEach(t=>{t.points.forEach(t=>{(t.x>=e.xAxis[0].min||t.x>=v)&&(t.x<=e.xAxis[0].max||t.x<=O)&&null!==t.y&&t.select(!0,!0)})}),_=t.getSelectedPoints(),_.length>0&&(t.reset_selection.add(),t.submit_selection.add())),bc.a.fireEvent(t,"selectedpoints",{selected_points:_,rain_gauge:p,rain_id:b}),!1}function ei(e){const t=e.selected_points,a=e.rain_gauge,n=e.rain_id,l=e.is_submit,r=e.setTaggingData,c=e.target,i=[];t.forEach(e=>{let t=new Date(e.x);t=J(t).format("YYYY-MM-DD HH:mm:ss"),!0!==i.includes(t)&&i.push(t)});const o={rain_gauge:a,ts_start:i[0],ts_end:i[i.length-1],rain_id:n,chart:c};l&&r(o)}function ti(e){e.forEach(e=>{e.points.forEach(e=>{e.select(!1,!1)})})}function ai(e,t,a,n,l){const r=e.set,c=e.max_rval_data,i=e.null_processed,o=r.distance,s=r.max_rval,m=r.gauge_name,d=r.rain_id,u=t.ts_start,p=t.ts_end,b=t.site_code;return{series:c,chart:{type:"column",zoomType:"x",panning:!0,events:{selection:$c,selectedpoints:ei},height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Instantaneous Rainfall Chart of ".concat(b.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source : <b>".concat(ri(o,m),"</b><br/>As of: <b>").concat(J(p).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(u),max:Date.parse(p),plotBands:i,type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:ci}},yAxis:{max:s,min:0,title:{text:"<b>Value (mm)</b>"}},tooltip:{shared:!0,crosshairs:!0,formatter(e){const t=this.points[0].point,a=t.x,n=t.y,l=t.is_invalid,r=t.tagger,c=t.remarks,i=t.observed_data;let o="".concat(J.unix(a/1e3).format("dddd, MMMM D, HH:mm"),"<br/>")+"- Rain: <b>".concat(n,"</b>");if(l){const e=r.first_name,t=r.last_name;o+="<br/>- Observed Data: <b>".concat(Kc[i],"</b><br/>")+"- Tagger: <b>".concat(e," ").concat(t,"</b><br/>")+"- Remarks: <b>".concat(c||"---","</b>")}return o}},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},exporting:{menuItemDefinitions:{tagInvalidData:{onclick(){bc.a.fireEvent(this,"selection",{is_tagging_data:!a,rain_gauge:m,rain_id:d,setTaggingData:l}),n(!a)},text:a?"Exit tagging":"Tag invalid data"}},buttons:{contextButton:{menuItems:["tagInvalidData","viewFullscreen","printChart","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG"]}}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}function ni(e,t){const a=e.set,n=e.series_data,l=a.distance,r=a.max_72h,c=a.threshold_value,i=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Cumulative Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source: <b>".concat(ri(l,i),"</b><br/>As of: <b>").concat(J(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:ci}},yAxis:{title:{text:"<b>Value (mm)</b>"},max:Math.max(0,r-parseFloat(c))+parseFloat(c),min:0,plotBands:[{value:Math.round(10*parseFloat(c/2))/10,color:Jc["24h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"24-hr threshold (".concat(c/2,")")}},{value:c,color:Jc["72h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"72-hr threshold (".concat(c,")")}}]},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}var li=function(e){const t=e.match.params,a=t.rain_gauge,r=t.site_code,c=e.input,i=e.disableBack,s=e.currentUser,m=e.saveSVG,d="undefined"!==typeof a?1:4,p=Object(n.useState)([]),b=Object(o.a)(p,2),g=b[0],E=b[1],f=Object(n.useState)([]),_=Object(o.a)(f,2),v=_[0],O=_[1],x=Object(n.useState)({label:"3 days",unit:"days",duration:3}),j=Object(o.a)(x,2),k=j[0],S=j[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),D=w[0],A=w[1],I=Object(n.useRef)([...Array(d)].map(()=>({instantaneous:Object(n.createRef)(),cumulative:Object(n.createRef)()}))),M=Object(n.useState)(!1),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)([]),H=Object(o.a)(R,2),B=H[0],P=H[1],L="undefined"!==typeof i&&i,F="undefined"!==typeof m&&m;let U,z="",W="";if("undefined"!==typeof c){const e=c.ts_end;z=e,U=J(e),W=r}else{const e=J();z=e.format("YYYY-MM-DD HH:mm:ss"),U=e,W=a.substr(0,3)}const G=k.unit,q=oe(U,k.duration,G),V={days_diff:U.diff(J(q,"YYYY-MM-DD HH:mm:ss"),"days"),ts_start:q,ts_end:z,site_code:W},Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],X=Z[1],$=Object(n.useState)(null),te=Object(o.a)($,2),ne=te[0],le=te[1],re=Object(n.useState)(!1),ce=Object(o.a)(re,2),ie=ce[0],se=ce[1],me={cumulative:ni(Zc,V),instantaneous:ai(Zc,V,K,X,le)},de=()=>{O([]),function(e,t){const a=e.site_code,n=e.ts_end,l=e.days_diff,r="".concat(ee.b,"/api/rainfall/get_rainfall_plot_data/").concat(a,"/").concat(n,"/").concat(l);ae.a.get(r).then(e=>{const a=e.data;console.log("Rainfall Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(V,e=>{let t=e;"undefined"!==typeof a&&(t=e.filter(e=>e.gauge_name==="rain_".concat(a))),E(t)})};Object(n.useEffect)(()=>{de()},[k]),Object(n.useEffect)(()=>{D&&(de(),A(!1))},[D]),Object(n.useEffect)(()=>{const e=[];g.forEach(t=>{const a=Xc(t);e.push(a)}),e.length>0&&O(e)},[g]);const ue=Object(n.useState)([]),pe=Object(o.a)(ue,2),be=pe[0],ge=pe[1];Object(n.useEffect)(()=>{const e=[];v.forEach(t=>{const a=ai(t,V,K,X,le),n=ni(t,V);e.push({instantaneous:a,cumulative:n})}),ge(e),e.length>0&&F&&Y(!0)},[v,K]),Object(n.useEffect)(()=>{K&&se(!0)},[ne]),Object(n.useEffect)(()=>{if(N){const e=[];I.current.forEach(t=>{const a=t.instantaneous,n=t.cumulative,l=a.current.chart,r=n.current.chart.getSVGForExport(),c=l.getSVGForExport();e.push({c:r,i:c})}),P(e)}},[N]);const Ee=Object(n.useRef)(null);return Object(n.useEffect)(()=>{if(B.length>0){const e=Ee.current.outerHTML;Dc({user_id:s.user_id,site_code:r,chart_type:"rainfall",svg:e},e=>{})}},[B]),l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},!L&&l.a.createElement("div",null,l.a.createElement(Rc,e)),l.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},l.a.createElement(Pc,{selectedRangeInfo:k,setSelectedRangeInfo:S,disableAll:!0}))),l.a.createElement("div",{style:{marginTop:16}},l.a.createElement(y.a,{container:!0,spacing:4},I.current.map((e,t)=>{let a=Object(u.a)({},me);return be.length>0&&(a=be[t]),l.a.createElement(n.Fragment,{key:t},l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,options:a.instantaneous,ref:e.instantaneous}))),l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,options:a.cumulative,ref:e.cumulative}))))}))),l.a.createElement(Qc,{isOpen:ie,closeModalFn:()=>se(!1),taggingData:ne,onTagSuccess:()=>{bc.a.fireEvent(ne.chart,"selection",{is_tagging_data:!1}),X(!1),A(!0)}}),F&&l.a.createElement(Me.a,{xsUp:!0,implementation:"css"},l.a.createElement("svg",{width:1200,height:1600,viewBox:"0 0 1200 1600",ref:Ee},B.map((e,t)=>{const a=e.i,r=e.c;return l.a.createElement(n.Fragment,{key:t},l.a.createElement("svg",{x:0,y:400*t,dangerouslySetInnerHTML:{__html:a}}),l.a.createElement("svg",{x:600,y:400*t,dangerouslySetInnerHTML:{__html:r}}))}))))};function ri(e,t){const a=t.toUpperCase();return null===e?a:"".concat(a," (").concat(e," KM)")}function ci(e){const t=this.chart,a=bc.a.charts;"syncExtremes"!==e.trigger&&a.forEach(a=>{a!==t&&"undefined"!==typeof a&&a.xAxis[0].setExtremes&&a.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})})}var ii=a(429),oi=a.n(ii),si=a(599),mi=a(342),di=a.n(mi);function ui(e){const t=e.length,a=di.a.scale(["#f00","#0f0","#00f"]).mode("hsl").domain([0,t-1]),n=[...e];for(let l=0;l<t;l+=1)"Cumulative"!==e[l].name&&(n[l].color=a(l).name());return n}function pi(e,t,a,n){const l=t.subsurface_column,r=Math.floor(e.length/25),c="As of: <b>".concat(J().format("D MMM YYYY, HH:mm"),"</b><br>")+"Note: <b>Click a box to access node-level charts.</b><br>";return{series:[{name:"Node Health",borderColor:"#444444",borderWidth:.5,data:e,rowsize:10,dataLabels:{enabled:!0,style:{textShadow:"none"},formatter(){return"".concat(this.point.id)}},events:{click(e,l){!function(e,t,a){Ei.apply(this,arguments)}(e.point.id,t,e=>{n(e)}),a(!0)}}}],chart:{type:"heatmap",height:160+20*r,marginTop:70,marginBottom:40,resetZoomButton:{position:{x:0,y:-30}}},plotOptions:{series:{cursor:"pointer"}},title:{text:"<b>Node Health Summary of ".concat(l.toUpperCase(),"</b>"),style:{fontSize:"14px"}},subtitle:{text:c,style:{fontSize:"0.75rem"}},xAxis:{visible:!1,categories:[]},yAxis:{reversed:!1,categories:[],title:null,labels:{format:"&ensp;",useHTML:!0}},colorAxis:{stops:[[0,"#7cb5ec"],[.5,"#ffed49"],[1,"#ff1414"]],min:0,max:2},legend:{enabled:!1},tooltip:{formatter(){const e=this.point,t=e.id_date,a=e.flagger,n=e.status,l=e.comment,r=e.id;let c="Ok",i="";if("undefined"!==typeof n){switch(n){case 2:c="Use with Caution";break;case 3:c="Spacial Case";break;case 4:c="Not Ok";break;default:c="Ok"}i="Identification Date: <b>".concat(J(t).format("DD MMM YYYY"),"</b><br/>")+"Comment: <b>".concat(l,"</b><br/>Flagger: <b>").concat(a,"</b>")}return"Node ID: <b>".concat(r,"</b><br/>Status: <b>").concat(c,"</b><br/>").concat(i)}},credits:{enabled:!1}}}function bi(e,t){const a=[];return e.forEach(e=>{const n=e.series_name,l=e.data,r=[];l.forEach(e=>{const t=e.series;r.push(...function(e){const t=[];return e.forEach(e=>{const a={x:e.data[0],y:e.data[1],name:e.data[2]};e.name.includes("Raw")&&(e.visible=!1),t.push(Object(u.a)(Object(u.a)({},e),{},{name:e.name,data:a}))}),e.data=[...t],e}(t))}),a.push(function(e,t,a){const n=a.subsurface_column,l=a.ts_start,r=a.ts_end,c=a.node_id,i="battery"===e?1:3,o=e.slice(0,i).toUpperCase()+e.slice(i);return{series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400},title:{text:"<b>".concat(o," Plot of ").concat(n.toUpperCase(),"</b>"),style:{fontSize:"10px"},margin:20,y:16},subtitle:{text:"Source: <b>Node ".concat(c,"</b><br/>As of: <b>").concat(J(l).format("D MMM YYYY, HH:mm")," - ").concat(J(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"9px"}},xAxis:{min:Date.parse(l),max:Date.parse(r),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Value</b>"}},tooltip:{crosshairs:!0,shared:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{itemStyle:{fontSize:"10px"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},time:{timezoneOffset:-480},credits:{enabled:!1}}}(n,r,t))}),a}function gi(e){const t=e.show,a=e.setNodeLevelChart,r=e.data,c=e.setData,i=()=>{a(!1),c(null)};return l.a.createElement(lt.a,{open:t,onClose:i,maxWidth:"lg",fullWidth:!0},null!==r?l.a.createElement(n.Fragment,null,l.a.createElement(ct.a,null,l.a.createElement(y.a,{container:!0,spacing:1},r.map((e,t)=>l.a.createElement(y.a,{item:!0,xs:12,key:t},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,options:e,allowChartUpdate:!0,callback:e=>e.reflow()})))))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:i,color:"secondary",autoFocus:!0},"Close"))):l.a.createElement(yr.a,null))}function Ei(){return(Ei=Object(si.a)(oi.a.mark((function e(t,a,n){var l;return oi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:wc(l=Object(u.a)(Object(u.a)({},a),{},{node_id:t}),e=>{const t=bi(e,l);n(t)});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}mc()(bc.a),window.moment=J,Ec()(bc.a);var fi=function(e){const t=e.match.params.tsm_sensor,a=e.width,r=e.input,c=e.disableBack,i=e.saveSVG,s=e.currentUser,m=e.isEOS;let d,p="",b=t;const g=Object(n.useState)({label:"3 days",unit:"days",duration:3}),E=Object(o.a)(g,2),f=E[0],_=E[1],v=Object(n.useState)({label:"4 hours",hour_value:"4"}),O=Object(o.a)(v,2),x=O[0],j=O[1];if("undefined"!==typeof r){const e=r.ts_end,t=r.tsm_sensor;p=e,d=J(e),b=t}else{const e=J();p=e.format("YYYY-MM-DD HH:mm:ss"),d=e}const k=f.unit,S=oe(d,f.duration,k),C="undefined"!==typeof c&&c,w="undefined"!==typeof i&&i,D=Object(n.useState)([]),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useRef)([...Array(6)].map(()=>Object(n.createRef)())),N=Object(n.useState)(!1),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=x.hour_value,z={ts_end:p,ts_start:S,subsurface_column:b,hour_value:U,include_comms_health:!m},W=Object(Se.b)(a,"sm"),G={title:{text:"Loading"}},q=Object(n.useState)([{title:{text:"Loading"}}]),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(null),X=Object(o.a)(K,2),$=X[0],te=X[1],ne=Object(n.useState)(null),le=Object(o.a)(ne,2),re=le[0],ce=le[1],ie=Object(n.useState)(!1),se=Object(o.a)(ie,2),me=se[0],de=se[1],ue=Object(n.useState)(null),pe=Object(o.a)(ue,2),be=pe[0],ge=pe[1];Object(n.useEffect)(()=>{M([]),ce(null),function(e,t){const a=e.subsurface_column,n=e.ts_end,l=e.ts_start,r=e.hour_value,c=e.include_comms_health,i="".concat(ee.b,"/api/subsurface/get_subsurface_plot_data/")+"".concat(a,"/").concat(n,"/").concat(l,"/").concat(r)+"?include_comms_health=".concat(c);ae.a.get(i).then(e=>{const a=e.data;console.log("Subsurface Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(z,e=>{const t=[];e.forEach(({type:e,data:a})=>{const n=JSON.parse(JSON.stringify(a));let l=[];if("column_position"===e?l=function(e,t){const a=e.data,n=[];return a.forEach(({orientation:a,data:l})=>{const r=ui(l);r.forEach(e=>{e.turboThreshold=1e5});const c=Object(u.a)(Object(u.a)({},e),{},{data:r,orientation:a,type:t});n.push(c)}),n}(n,e):"displacement"===e?l=function(e,t){const a=[];return e.forEach((e,n)=>{const l=e.data,r=e.annotations;l[0].type="area";const c=ui(l);c.forEach(e=>{e.turboThreshold=1e5}),r.forEach(e=>{e.width=0,e.label.style={color:"gray"}});const i=Object(u.a)(Object(u.a)({},e),{},{data:c,annotations:r,type:t});a.push(i)}),a}(n,e):"velocity_alerts"===e&&(l=function(e,t){const a=e.velocity_alerts,n=e.timestamps_per_node,l=[],r=ui(n);return a.forEach(e=>{const a=e.orientation,n=e.data,c=[...r];Object.keys(n).forEach(e=>{const t="L2"===e?7:10,a="L2"===e?"#FFFF00":"#FF0000",l={data:n[e],type:"scatter",zIndex:5,name:e,marker:{symbol:"triangle",radius:t,fillColor:a,lineColor:"#000000",lineWidth:2}};c.push(l)});const i={data:c,type:t,orientation:a};l.push(i)}),l}(n,e)),"comms_health"===e){const e=function(e,t){const a=t.subsurface_column,n=t.ts_start,l=t.ts_end;return{series:e.data,chart:{type:"column",height:300,resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Communication Health Chart of ".concat(a.toUpperCase(),"</b>"),style:{fontSize:"14px"},margin:20,y:16},subtitle:{text:"Range: <b>".concat(J(n).format("D MMM YYYY, HH:mm")," - ").concat(J(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"12px"}},xAxis:{min:1,title:{text:"<b>Node number</b>"},allowDecimals:!1},yAxis:{min:0,max:100,title:{text:"<b>Health Percentage (%)</b>"}},tooltip:{crosshairs:!0,shared:!0,headerFormat:"Node {point.x}<br/>"},legend:{align:"right",verticalAlign:"middle",layout:"vertical"},credits:{enabled:!1}}}(a,z);ce(e)}else t.push(...l)}),M(t)})},[f,x]),Object(n.useEffect)(()=>{const e=[];I.forEach(t=>{const a=t.type;let n;"column_position"===a?n=function(e,t,a){const n=e.data,l=e.max_position,r=e.min_position,c=e.orientation,i=t.subsurface_column,o="across_slope"===c?"Across Slope":"Downslope";return{series:n,chart:{type:"scatter",zoomType:"x",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Column Position Plot of ".concat(i.toUpperCase(),"</b>"),style:{fontSize:"1rem"}},plotOptions:{series:{lineWidth:2,states:{hover:{enabled:!0,lineWidth:5}},marker:{enabled:!0,radius:3,lineColor:null}}},tooltip:{formatter(){return"Timestamp: <b>".concat(J(this.series.name).format("dddd, MMM D, HH:mm"),"</b><br>Depth: <b>").concat(this.y,"</b><br>Displacement: <b>").concat(this.x,"</b>")}},xAxis:{min:r,max:l+.02,gridLineWidth:1,title:{text:"<b>Horizontal displacement, ".concat(o," (m)</b>")}},yAxis:{title:{text:"<b>Depth (m)</b>"}},credits:{enabled:!1},legend:{enabled:!0,align:a?"right":"center",layout:a?"vertical":"horizontal",verticalAlign:a?"middle":"bottom",labelFormatter(){return"".concat(J(this.name).format("MM/DD, HH:mm"))}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,z,W):"displacement"===a?n=function(e,t){const a=e.orientation,n=e.data,l=e.annotations,r=t.subsurface_column,c=t.ts_end;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Displacement Plot, ".concat("across_slope"===a?"Across Slope":"Downslope"," of ").concat(r.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(J(c).format("D MMM YYYY, HH:mm"),"</b><br><br><b>Note: </b> (+/-) consistently increasing/decreasing trend"),style:{fontSize:"0.6rem"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{plotBands:l,title:{text:"<b>Relative Displacement (mm)</b>"}},tooltip:{header:"{point.x:%Y-%m-%d}: {point.y:.2f}"},plotOptions:{spline:{marker:{enabled:!0}}},credits:{enabled:!1},legend:{enabled:!1},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,z):"velocity_alerts"===a&&(n=function(e,t){const a=e.data,n=e.orientation,l=t.subsurface_column,r=t.ts_end,c="across_slope"===n?"Across Slope":"Downslope",i=a.map(e=>e.name).filter(e=>"number"===typeof e);return i.unshift(0),{series:a,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Velocity Alerts Plot, ".concat(c," of ").concat(l.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(J(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.6rem"}},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Time</b>"}},legend:{enabled:!1},yAxis:{categories:i,reversed:!0,title:{text:"<b>Nodes</b>"},labels:{formatter(){return this.value}}},tooltip:{formatter(){return"<b>".concat(J(this.x).format("DD MMM YYYY, HH:mm"),"</b>")}},plotOptions:{line:{marker:{enabled:!0,radius:2}}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,z)),e.push(n)}),Z(e),e.length>0&&w&&H(!0)},[I]),Object(n.useEffect)(()=>{!function(e,t){const a=e.subsurface_column,n="".concat(ee.b,"/api/subsurface/get_subsurface_node_health/").concat(a);ae.a.get(n).then(e=>{const a=e.data;console.log("Subsurface Node Health Data",a),t(a)}).catch(e=>{console.error(e)})}(z,e=>{const t=pi(function(e,t){const a=[];return e.forEach((e,t)=>{const n=e.id,l=e.status;let r="";2===l?r="#f9ff40":3===l?r="#ff8400":4===l&&(r="#ff6961");const c=Object(u.a)(Object(u.a)({name:t+1},e),{},{value:0,id:n+1,color:r});a.push(c)}),a}(e),z,de,e=>{ge(e)});te(t)})},[]),Object(n.useEffect)(()=>{if(R){const e=[];T.current.forEach(t=>{const a=t.current;if(null!==a){const t=a.chart.getSVGForExport();e.push(t)}}),F(e)}},[R,T]);const Ee=Object(n.useRef)(null);return Object(n.useEffect)(()=>{if(L.length>0){const e=Ee.current.outerHTML;Dc({user_id:s.user_id,tsm_sensor:b,site_code:r.site_code,chart_type:"subsurface",svg:e},e=>{})}},[L]),l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},!C&&l.a.createElement(y.a,{item:!0,sm:!0},l.a.createElement(Rc,e)),l.a.createElement(Pc,{isSubsurface:!0,selectedRangeInfo:f,setSelectedRangeInfo:_,selectedHourInterval:x,setSelectedHourInterval:j})),l.a.createElement("div",{style:{marginTop:16}},l.a.createElement(y.a,{container:!0,spacing:4},$&&l.a.createElement(y.a,{item:!0,xs:12,md:12},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,allowChartUpdate:!0,options:$}))),0===Q.length&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,md:6,key:1},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,options:G}))),l.a.createElement(y.a,{item:!0,xs:12,md:6,key:2},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,options:G})))),re&&l.a.createElement(y.a,{item:!0,xs:12,md:12},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,allowChartUpdate:!0,options:re}))),Q.map((e,t)=>{const a=T.current[t];return l.a.createElement(y.a,{item:!0,xs:12,md:6,key:t},l.a.createElement(h.a,null,l.a.createElement(uc.a,{highcharts:bc.a,allowChartUpdate:!0,options:e,ref:a})))}))),w&&l.a.createElement(Me.a,{xsUp:!0,implementation:"css"},l.a.createElement("svg",{width:1200,height:2400,viewBox:"0 0 1200 2400",ref:Ee},L.map((e,t)=>{const a=t%2===1?0:600,r=800*Math.floor(t/2);return l.a.createElement(n.Fragment,{key:t},l.a.createElement("svg",{x:a,y:r,dangerouslySetInnerHTML:{__html:e}}))}))),l.a.createElement(gi,{show:me,setNodeLevelChart:de,data:be,setData:ge}))};var hi=function(e){const t=e.match.params.site_code,a=e.location,n=a.site,r=a.ts_end,c=a.to_include;let i=r,o=a.subsurface_columns,s=Object(u.a)({},c);"undefined"===typeof n&&(i=X()(),o=[],s={rainfall:!0,surficial:!0});const m={site_code:t,ts_end:i.format("YYYY-MM-DD HH:mm:ss")};return l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Rc,e)),s.rainfall&&l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},l.a.createElement(li,Object.assign({},e,{input:m,disableBack:!0}))),s.surficial&&l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},l.a.createElement(Vc,Object.assign({},e,{input:m,disableBack:!0}))),o.map(t=>{const a=Object(u.a)(Object(u.a)({},m),{},{tsm_sensor:t});return l.a.createElement(y.a,{key:t,item:!0,xs:12},l.a.createElement(fi,Object.assign({},e,{input:a,disableBack:!0})))}))};var _i=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.clickHandler,c=e.isMobile,i=e.url,m=Object(n.useState)({value:null,data:{site_code:null}}),d=Object(o.a)(m,2),b=d[0],g=d[1],E=Object(n.useState)(X()()),f=Object(o.a)(E,2),h=f[0],_=f[1],O=Object(n.useState)({rainfall:!0,surficial:!0,subsurface:{}}),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=(e,t=null)=>a=>{const n=a.target.checked;let l=n;if(null!==t){const e=j.subsurface;e[t]=n,l=e}k(Object(u.a)(Object(u.a)({},j),{},{[e]:l}))};Object(n.useEffect)(()=>()=>{_(X()())},[a]),Object(n.useEffect)(()=>{const e=b.data.site_code;null!==e&&function(e,t){const a="".concat(ee.b,"/api/subsurface/get_site_subsurface_columns/").concat(e);ae.a.get(a).then(a=>{const n=a.data;console.log("Subsurface Columns of ".concat(e.toUpperCase()),n),t(n)}).catch(e=>{console.error(e)})}(e,e=>{D([]);const t={};e.forEach(e=>{const a=null===e.date_deactivated;t[e.logger.logger_name]=a}),k(Object(u.a)(Object(u.a)({},j),{},{subsurface:t})),D(e)})},[b.data.site_code]);const I=b.data,M=[];return Object.keys(j.subsurface).forEach(e=>{j.subsurface[e]&&M.push(e)}),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Consolidate charts per site"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Fill in the following."),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ua,{value:b,changeHandler:e=>g(e)})),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:h,onChange:e=>_(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})))),l.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:18}},l.a.createElement(ot.a,{component:"fieldset"},l.a.createElement(Ea.a,{component:"legend"},"Charts to Show"),l.a.createElement(fa.a,{"aria-label":"position",row:!0},l.a.createElement(mt.a,{value:"rainfall",control:l.a.createElement(Lt.a,{color:"primary",onClick:A("rainfall"),checked:j.rainfall}),label:"Rainfall"}),l.a.createElement(mt.a,{value:"surficial",control:l.a.createElement(Lt.a,{color:"primary",onClick:A("surficial"),checked:j.surficial}),label:"Surficial"})))),l.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:8}},l.a.createElement(ot.a,{component:"fieldset"},l.a.createElement(Ea.a,{component:"legend"},"Subsurface Columns"),l.a.createElement(fa.a,{"aria-label":"position",row:!0},w.map(e=>{const t=e.date_deactivated,a=e.logger.logger_name,n=null===t?"":" (Deactivated)";return l.a.createElement(mt.a,{key:a,value:a,control:l.a.createElement(Lt.a,{color:"primary",onClick:A("subsurface",a),checked:j.subsurface[a]}),label:a.toUpperCase()+n})}),0===w.length&&l.a.createElement(v.a,{variant:"body1"},"No site selected")))),!c&&l.a.createElement("div",{style:{height:120}})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{component:s.b,to:{pathname:"".concat(i,"/consolidated/").concat(I.site_code),ts_end:h,site:I,to_include:j,subsurface_columns:M},color:"primary",onClick:r,disabled:null===b.value},"View"),l.a.createElement(p.a,{onClick:r},"Cancel")))}));var yi=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.clickHandler,c=e.setReloadEqEvent,s=Object(n.useState)(null),m=Object(o.a)(s,2),d=m[0],u=m[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),f=E[0],h=E[1],_=Object(n.useState)(0),v=Object(o.a)(_,2),O=v[0],x=v[1],k=Object(n.useState)(0),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)(X()()),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useState)(!0),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(i.b)(),B=H.enqueueSnackbar,P=H.closeSnackbar,L=Object(j.a)(),F=L.first_name,U=L.last_name,z=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{P(e)}},"Dismiss");Object(n.useEffect)(()=>M(X()()),[a]),Object(n.useEffect)(()=>{R(!(f>0&&O>0&&C>0&&d>=0&&d<=10))},[f,d,C,O]);const W=()=>{const e="".concat(F," ").concat(U).split(" ");let t="";e.forEach(e=>{t+=e.charAt(0)});!function(e,t){const a="".concat(ee.b,"/api/analysis/insert_earthquake_event");ae.a.post(a,e).then(e=>{t(e)}).catch(e=>{console.error(e)})}({magnitude:d,depth:f,long:O,lat:C,timestamp:I.format("YYYY-MM-DD HH:mm"),issued_by:t},e=>{200===e.status?(B("Success saving earthquake event",{variant:"success",autoHideDuration:7e3,action:z}),c(!0)):B("Error saving earthquake event",{variant:"error",autoHideDuration:7e3,action:z})}),r(!1)},G=(d>10||d<=0)&&null!==d,q=f<=0&&null!==d;return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Insert Earthquake Event"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Fill in the following."),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:I,onChange:e=>M(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{component:"fieldset",fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Magnitude",onChange:e=>u(e.target.value),type:"number",InputProps:{inputProps:{max:10,min:1}},fullWidth:!0,helperText:G?"Insert magnitude from 0.1 to 10":"",error:G}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{component:"fieldset",fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Depth (km)",defaultValue:"",onChange:e=>h(e.target.value),type:"number",fullWidth:!0,helperText:q?"Positive numbers only":"",error:q}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{component:"fieldset",fullWidth:!0},l.a.createElement(g.a,{type:"number",required:!0,label:"Latitude",defaultValue:"",onChange:e=>w(e.target.value)}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{component:"fieldset",fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Longitude",type:"number",defaultValue:"",onChange:e=>x(e.target.value)}))))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{color:"primary",onClick:()=>W(),disabled:Y},"Submit"),l.a.createElement(p.a,{onClick:r,color:"secondary"},"Cancel")))})),vi=a(57),Oi=a.n(vi),xi=(a(574),a(1167)),ji=a(1209),ki=a(1168),Si=a(1169),Ci=a(1210),wi=a(1170),Di=a(1171),Ai=a(600),Ii=a.n(Ai),Mi=a(601),Ti=a.n(Mi),Ni=a(602),Yi=a.n(Ni);const Ri=Oi.a.icon({iconUrl:Ii.a,shadowUrl:Ti.a,iconRetinaUrl:Yi.a,iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],shadowAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});var Hi=function(e){const t=e.eqEvents;let a=[12.8797,121.774],r=5;if(e.zoomIn){const e=t[0];a=[e.latitude,e.longitude],r=7}const c=Object(n.useRef)(),i=1===t.length,s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],u=m[1];Object(n.useEffect)(()=>{i&&u(!0)},[t]),Object(n.useEffect)(()=>{d&&(null!==c&&c.current.leafletElement.openPopup(),u(!1))},[d]);const p=/\.0*$|(?<=\.[0-9]{0,2147483646})0*$/;return l.a.createElement(xi.a,{style:{height:465},center:a,zoom:r},l.a.createElement(ji.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((e,t)=>{const a=e.latitude,r=e.longitude,o=e.magnitude,s=e.depth,m=e.critical_distance,d=e.eq_id,u=e.processed,b=[a,r],g=null===m?0:parseFloat(m);return l.a.createElement(n.Fragment,{key:d},l.a.createElement(ki.a,{center:b,fillColor:"blue",radius:1e3*g}),l.a.createElement(Si.a,{icon:Ri,position:b,ref:i?c:Object(n.createRef)()},l.a.createElement(Ci.a,null,"Magnitude: ",l.a.createElement("strong",null,o.replace(p,""))," ",l.a.createElement("br",null),"Depth: ",l.a.createElement("strong",null,s.replace(p,""))," ",l.a.createElement("br",null),"Critical Distance: ",l.a.createElement("strong",null,g," km")," ",l.a.createElement("br",null),"Processed: ",l.a.createElement("strong",null,u?"Yes":"No"))))}),l.a.createElement(wi.a,{style:{zIndex:550}},zn.map(e=>l.a.createElement(Di.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},l.a.createElement(Ci.a,null,l.a.createElement("strong",null,e.site_code.toUpperCase())," ",l.a.createElement("br",null),ne(e,!1))))))};const Bi=Object(hl.a)({overrides:{MUIDataTableBodyCell:{root:{whiteSpace:"nowrap"}}}}),Pi=[{name:"Timestamp"},{name:"Magnitude"},{name:"Issuer"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}}],Li=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}},{name:"Sites",options:{filter:!1}}];var Fi=function(e){const t=e.eqEvents,a=e.eqAlerts,n=e.eqAlertsPagination,r=e.setEqAlTblPage,c=l.a.useState(0),i=Object(o.a)(c,2),s=i[0],m=i[1],d=l.a.useState([]),p=Object(o.a)(d,2),b=p[0],g=p[1],E=l.a.useState([]),f=Object(o.a)(E,2),h=f[0],_=f[1];l.a.useEffect(()=>{g([...t]);const e=t.map(e=>[X()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.issuer.toUpperCase(),e.eq_id]);_([...e])},[t]);const O=(e,t)=>{const a=t.filter(t=>t.eq_id===e);g([...a])},x=l.a.useState([]),j=Object(o.a)(x,2),k=j[0],S=j[1];l.a.useEffect(()=>{const e=a.map(e=>{const t=e.eq_alerts.map(e=>e.site.site_code.toUpperCase());return[X()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id,t.join(", ")]});S([...e])},[a]);const C={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"standard",onRowClick(e,a,n){O(e[3],t)}},w={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",count:n.count,rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",serverSide:!0,onChangePage:e=>{const t=e*n.limit;r(Object(u.a)(Object(u.a)({},n),{},{offset:t}))},onRowClick(e,t,n){O(e[2],a)}};return l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(Hi,{eqEvents:b,zoomIn:1===b.length})),l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(M.a,{position:"static"},l.a.createElement(ye.a,{value:s,onChange:(e,t)=>m(t),variant:"fullWidth"},l.a.createElement(ve.a,{label:"EQ Events"}),l.a.createElement(ve.a,{label:"EQ Alerts"}))),0===s&&l.a.createElement(_l.a,{theme:Bi},l.a.createElement(fl.a,{title:"Latest Earthquake Events",columns:Pi,options:C,data:h,style:{height:465}})),1===s&&l.a.createElement(_l.a,{theme:Bi},l.a.createElement(fl.a,{title:l.a.createElement(v.a,{variant:"body1"},"Earthquake Alerts"),columns:Li,options:w,data:k}))))};function Ui(e){return X()(e).format("D MMMM YYYY, HH:mm")}function zi(e){const t=e.first_name,a=e.last_name;return"".concat(t," ").concat(a)}function Wi(e){const t=e.moms_data,a=e.match.params.instance_id,n=t.find(e=>e.instance_id===parseInt(a,10));let r=[],c="";if("undefined"!==typeof n){r=n.moms;const e=n.feature.feature_type,t=n.feature_name;c="".concat(e," - ").concat(t)}const i=function(e){return e.map(e=>{const t=e.observance_ts,a=e.narrative,n=e.reporter,l=e.validator,r=e.op_trigger,c=e.remarks,i=a.narrative,o=a.timestamp;return[Ui(t),i,Ui(o),zi(n),zi(l),c,r]})}(r);return l.a.createElement(h.a,{style:{marginTop:16}},l.a.createElement(fl.a,{title:l.a.createElement(v.a,{variant:"h6"},"Manifestation of Movement Reports ",l.a.createElement("span",{style:{fontSize:"small"}},c.toUpperCase())),columns:["Observance Timestamp","Narrative","Report Timestamp","Reporter","Validator","Remarks","Alert Level"],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard"},data:i}))}var Gi=function(e){const t=e.history,a=e.match,r=a.url,c=a.params.site_code,i=Object(n.useState)([]),s=Object(o.a)(i,2),d=s[0],u=s[1],p=Object(n.useState)([]),b=Object(o.a)(p,2),g=b[0],E=b[1];Object(n.useEffect)(()=>{!function(e,t){const a="".concat(ee.b,"/api/manifestations_of_movement/get_moms_instances/").concat(e);ae.a.get(a).then(a=>{const n=a.data;console.log("MOMs Instances of ".concat(e.toUpperCase()),n),t(n)}).catch(e=>{console.error(e)})}(c,e=>{const t=e.map(e=>{const t=e.feature.feature_type,a=e.feature_name,n=e.moms,l=e.instance_id,r=e.location,c=t.charAt(0).toUpperCase()+t.slice(1),i=n[0];let o=[];if("undefined"!==typeof i){const e=i.observance_ts,t=i.op_trigger;o=[c,a,r,Ui(e),t,l]}return o}).filter(e=>e.length>0).sort((e,t)=>t[4]-e[4]);E(t),u(e)})},[]);const f=Object(n.useState)(!1),_=Object(o.a)(f,2),y=_[0],v=_[1],O=e=>()=>v(e);return l.a.createElement(n.Fragment,null,l.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},l.a.createElement(Rc,e),l.a.createElement(ul,{clickHandler:O(!0)})),l.a.createElement(h.a,{style:{marginTop:16}},l.a.createElement(fl.a,{title:"Manifestation of Movement Features of ".concat(c.toUpperCase()),columns:["Type",{name:"Name",options:{filter:!1}},{name:"Location",options:{filter:!1}},{name:"Last Observance Timestamp",options:{filter:!1}},"Alert Level",{name:"data",options:{display:!1,viewColumns:!1,filter:!1}}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard",onRowClick(e,a,n){const l=e[5];t.push("".concat(r,"/").concat(l))}},data:g})),l.a.createElement(dl,Object.assign({},e,{isOpen:y,closeHandler:O(!1)})),l.a.createElement(m.b,{path:"".concat(r,"/:instance_id"),render:e=>l.a.createElement(Wi,Object.assign({},e,{moms_data:d}))}))};let qi;mc()(oc.a);const Vi=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})}),Qi=()=>l.a.createElement(Qe.a,{height:600,width:400,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},l.a.createElement("rect",{x:"0",y:"0",rx:"0",ry:"0",width:"400",height:"600"}));function Zi(e,t){return l.a.createElement("span",null,l.a.createElement(p.a,{"aria-label":"Insert Earthquake Event",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:t(!0),startIcon:l.a.createElement(rc.a,null)},"Insert Earthquake Event"),l.a.createElement(p.a,{"aria-label":"Consolidate by site",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:e(!0),startIcon:l.a.createElement(cc.a,null)},"Consolidate by site"))}function Ki(e,t){const a=[];return e&&0!==Object.keys(e).length&&e.xAxis[0]&&e.series[0].points.forEach(e=>{a.push(function(e,t){const a=t.data,n=t.type,c=t.dataLabel;return l.a.createElement("div",{key:a},Object(r.createPortal)(l.a.createElement(s.b,{to:"".concat(e,"/").concat(n,"/").concat(a),style:{fontSize:c.options.style.fontSize,position:"absolute",fontFamily:"Lucida Grande, Lucida Sans Unicode, Arial Helvetica, sans-serif",color:"#000000"}},a.toUpperCase()),c.div))}(t,e))}),a}function Ji(e,t,a){const n=t.charAt(0).toUpperCase()+t.slice(1),l="<b>".concat(n," Data Availability</b>");let r=50,c=60,i="Timestamp: <b>".concat(qi.format("D MMM YYYY, HH:mm"),"</b>");switch(t){case"surficial":i+="<br/>Note: Data presence within four hours<br/>until next release for event sites<br/>Data presence from 6AM to 12NN for <br/>routine and extended sites<br/><b>*Sites without markers</b>";break;case"subsurface":i+="<br/>Note: Data presence of raw data (not yet filtered)",r=95;break;case"loggers":r=95,c=100}e&&(r+=c);return{chart:{type:"heatmap",height:700,spacingTop:12,spacingRight:18},title:{text:l,style:{fontSize:"1rem"},y:20},subtitle:{text:i,style:{fontSize:"0.70rem"}},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},colorAxis:{stops:[[0,"#cccccc"],[1,"#7cb5ec"]],min:0,max:1},tooltip:{outside:!0,formatter(){const e=this.point,t=e.label,a=e.type,n=e.value,l=e.event_type,r=e.ts_last_data,c=e.ts_updated,i=e.diff_days,o=n?"With":"No";let s;switch(a){case"rainfall":s="Rain gauge";break;case"surficial":s="Site";break;case"subsurface":s="Sensor";break;case"loggers":s="Logger"}let m="".concat(s,": <b>").concat(t,"</b><br/>")+"Presence: <b>".concat(o," data</b><br/>")+"Last data timestamp: <b>".concat(X()(r).format("D MMM YYYY, HH:mm"),"</b><br/>");return m+="surficial"!==a?"<br/>Last update timestamp: <b>".concat(X()(c).format("D MMM YYYY, HH:mm"),"</b><br/>")+"Days since last data: <b>".concat(i,"</b><br/>"):"Event type: <b>".concat(l,"</b>"),m}},credits:{enabled:!1},series:[{name:"",borderWidth:1,borderColor:"#444444",data:function(e,t,a){const n=[];let l=0;return e.forEach((e,a)=>{const r=e.last_data,c=e.ts_updated,i=e.diff_days,o=e.event_type;let s,m;const d=e.presence;"surficial"===t?(s=e.site_code,m=s,e.has_surficial_markers||(s+="*")):"rainfall"===t?(s=e.rain_gauge.gauge_name,m=s):"subsurface"===t?(s=e.tsm_sensor.logger.logger_name,m=s):(s=e.logger.logger_name,m=s);const u={x:a%5,y:5-l,value:d,label:s.toUpperCase(),data:m,type:t,ts_last_data:r,ts_updated:c,diff_days:i,event_type:o};n.push(u);a%5===4&&(l+=1)}),n}(a,t),dataLabels:{enabled:!0,useHTML:!0,color:"#000000",display:"none",style:{fontWeight:100},formatter(){return this.point.label}}}]}}var Xi=Object(Se.a)()((function(e){const t=e.width,a=e.location,r=e.match,c=r.path,i=r.url,d=Vi(),p=Object(Se.b)(t,"sm");qi=X()();const b=Object(n.useState)(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],_=Object(n.useState)(!1),v=Object(o.a)(_,2),O=v[0],x=v[1],j=e=>()=>f(e),k=e=>()=>x(e),S=Object(n.useState)([]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(null),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)(null),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(null),z=Object(o.a)(U,2),W=z[0],G=z[1],q=Object(n.useState)(null),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)([]),J=Object(o.a)(K,2),$=J[0],te=J[1],le=Object(n.useState)(null),re=Object(o.a)(le,2),ce=re[0],ie=re[1],oe=Object(n.useState)(null),se=Object(o.a)(oe,2),me=se[0],de=se[1],ue=Object(n.useState)([]),pe=Object(o.a)(ue,2),be=pe[0],ge=pe[1],Ee=Object(n.useState)(null),fe=Object(o.a)(Ee,2),he=fe[0],_e=fe[1],ye=Object(n.useState)({}),ve=Object(o.a)(ye,2),Oe=ve[0],xe=ve[1],je=Object(n.useState)(null),ke=Object(o.a)(je,2),Ce=ke[0],we=ke[1],De=e=>t=>{xe(a=>Object(u.a)(Object(u.a)({},a),{},{[e]:t}))};Object(n.useEffect)(()=>{Cc("surficial",e=>{F(e)}),Cc("tsm",e=>{D(e)}),Cc("rain_gauges",e=>{te(e)}),Cc("loggers",e=>{ge(e)})},[]),Object(n.useEffect)(()=>{if(L.length>0){const e=Ji(!p,"surficial",L);G(e)}},[L,p]),Object(n.useEffect)(()=>{if(w.length>0){const e=Ji(!p,"subsurface",w);T(e)}},[w,p]),Object(n.useEffect)(()=>{if($.length>0){const e=Ji(!p,"rainfall",$);ie(e)}},[$,p]),Object(n.useEffect)(()=>{if(be.length>0){const e=Ji(!p,"loggers",be);_e(e)}},[be,p]),Object(n.useEffect)(()=>{const e=Ki(Oe.rainfall,i);de(e)},[Oe.rainfall,i]),Object(n.useEffect)(()=>{const e=Ki(Oe.surficial,i);Z(e)},[Oe.surficial,i]),Object(n.useEffect)(()=>{const e=Ki(Oe.subsurface,i);H(e)},[Oe.subsurface,i]);const Ae=Object(n.useContext)(sa).setIsReconnecting;Object(n.useEffect)(()=>{var e;return ht(Ae),e=e=>{const t=e.rainfall_summary,a=e.ts,n=function(e,t){const a=e.site_codes,n=e.list_1d,l=e.list_3d,r=null===t?"---":X()(t).format("D MMM YYYY, HH:mm");return{chart:{type:"column"},title:{text:"<b>Cumulative Rainfall Data vs Threshold Plot of Dynaslope Sites</b>",style:{fontSize:"1rem"},y:20},subtitle:{text:"As of: <b>".concat(r,"</b><br>Note: Percentage capped at 100%")},xAxis:{categories:a,title:{text:"<b>Sites</b>"}},yAxis:{min:0,max:100,title:{text:"<b>Threshold Ratio (%)</b>"}},tooltip:{shared:!0,useHTML:!0,formatter(){const e=this.x,t=this.points,a=t[0].point.data_source.replace(/_/g," ");let n="<b>".concat(e," (").concat(a.toUpperCase(),")</b><br>");return t.forEach(e=>{n+="".concat(e.point.data_value,"<br>"),n+="- Percentage: <b>".concat(e.point.y.toFixed(2),"%</b><br>")}),n}},plotOptions:{column:{grouping:!1,shadow:!1}},series:[{name:"Three-day Cumulative Data",data:l,pointPadding:0,color:"#FF0000"},{name:"One-day Cumulative Data",data:n,pointPadding:.2}],credits:{enabled:!1}}}(function(e){const t=[],a=[],n=[];return e.forEach(e=>{const l=e.site_code,r=e["1D cml"],c=e["3D cml"],i=e["half of 2yr max"],o=e["2yr max"],s=e.DataSource,m=r?"".concat(r," mm"):"0 mm",d=c?"".concat(c," mm"):"0 mm",u={y:r/i*100,data_value:"<b><i>One Day Data</i></b><br>- Cumulative Data: <b>".concat(m,"</b><br>- Threshold: <b>").concat(i," mm</b>"),data_source:s},p={y:c/o*100,data_value:"<b><i>Three Day Data</i></b><br>- Cumulative Data: <b>".concat(d,"</b><br>- Threshold: <b>").concat(o," mm</b>"),data_source:s};t.push(u),a.push(p),n.push(l.toUpperCase())}),{list_1d:t,list_3d:a,site_codes:n}}(t),a);we(n)},ft(),Et.on("receive_rainfall_data",t=>{const a=JSON.parse(t);console.log("All Site Rainfall Data: ",a),e(a)}),function(){yt()}},[]);const Ie=Object(n.useState)([]),Me=Object(o.a)(Ie,2),Te=Me[0],Ne=Me[1];Object(n.useEffect)(()=>{const e=[];!function(e){const t="".concat(ee.b,"/api/manifestations_of_movement/get_latest_alerts");ae.a.get(t).then(t=>{const a=t.data;console.log("MOMs Alerts",a),e(a)}).catch(e=>{console.error(e)})}(t=>{t.forEach(t=>{const a=t.site_code,n=t.moms_alert,l={site_code:a,address:ne(t,!0,"start"),moms_alert:n};e.push(l)}),Ne(e)})},[i]);const Ye=[{name:"address",label:"Site",options:{filter:!1,customBodyRender:(e,{rowIndex:t})=>{const a=Te[t].site_code;return l.a.createElement(s.b,{to:"".concat(i,"/moms/").concat(a),style:{color:"black"}},e)}}},{name:"moms_alert",label:"Alert"}],Re=Object(n.useState)([]),He=Object(o.a)(Re,2),Be=He[0],Pe=He[1],Le=Object(n.useState)(!0),Fe=Object(o.a)(Le,2),Ue=Fe[0],We=Fe[1];Object(n.useEffect)(()=>{Ue&&(!function(e){const t="".concat(ee.b,"/api/analysis/get_earthquake_events");ae.a.get(t).then(t=>{const a=t.data;console.log("Earthquake Events",a),e(a)}).catch(e=>{console.error(e)})}(e=>{Pe(e)}),We(!1))},[Ue]);const Ge=l.a.useState([]),qe=Object(o.a)(Ge,2),Ve=qe[0],Qe=qe[1],Ze=l.a.useState({limit:5,offset:0,count:0}),Ke=Object(o.a)(Ze,2),Je=Ke[0],Xe=Ke[1],$e=l.a.useState(!0),et=Object(o.a)($e,2),tt=et[0],at=et[1];l.a.useEffect(()=>{!function(e,t){const a=e.limit,n=e.offset,l="".concat(ee.b,"/api/analysis/get_earthquake_alerts")+"?limit=".concat(a,"&offset=").concat(n);ae.a.get(l).then(e=>{const a=e.data;console.log("Earthquake Alerts",a),t(a)}).catch(e=>{console.error(e)})}(Je,e=>{const t=e.count,a=e.data;Qe([...a]),tt&&(at(!1),Xe(Object(u.a)(Object(u.a)({},Je),{},{count:t})))})},[Je,tt]);const nt=a.pathname===c;return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:d.pageContentMargin},l.a.createElement(ze,{title:"Analysis | Site Data Analytics",customButtons:!(!p||!nt)&&Zi(j,k)})),l.a.createElement("div",{className:d.pageContentMargin},l.a.createElement(m.d,{location:a},l.a.createElement(m.b,{exact:!0,path:i,render:e=>l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==W?l.a.createElement(h.a,{elevation:2},l.a.createElement(uc.a,{highcharts:oc.a,options:W,callback:De("surficial"),allowChartUpdate:!1}),Q):l.a.createElement(Qi,{style:{height:"100%"}})),l.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==ce?l.a.createElement(h.a,{elevation:2},l.a.createElement(uc.a,{highcharts:oc.a,options:ce,callback:De("rainfall"),allowChartUpdate:!1}),me):l.a.createElement(Qi,{style:{height:"100%"}})),l.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==M?l.a.createElement(h.a,{elevation:2},l.a.createElement(uc.a,{highcharts:oc.a,options:M,callback:De("subsurface"),allowChartUpdate:!1}),R):l.a.createElement(Qi,{style:{height:"100%"}})),l.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==he?l.a.createElement(h.a,{elevation:2},l.a.createElement(uc.a,{highcharts:oc.a,options:he,callback:De("loggers"),allowChartUpdate:!1})):l.a.createElement(Qi,{style:{height:"100%"}})),l.a.createElement(y.a,{item:!0,xs:12},null!==Ce?l.a.createElement(h.a,{elevation:2},l.a.createElement(uc.a,{highcharts:oc.a,options:Ce})):l.a.createElement("div",null,"Loading...")),l.a.createElement(y.a,{item:!0,xs:12,md:12,lg:7},l.a.createElement(h.a,{elevation:2},l.a.createElement(Fi,{eqEvents:Be,eqAlerts:Ve,eqAlertsPagination:Je,setEqAlTblPage:Xe}))),l.a.createElement(y.a,{item:!0,xs:12,md:12,lg:5},l.a.createElement(h.a,{elevation:2},l.a.createElement(fl.a,{title:"Latest MOMs Alert",columns:Ye,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:6,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard"},data:Te}))))}),l.a.createElement(m.b,{path:"".concat(i,"/surficial/:site_code"),render:e=>l.a.createElement(Vc,Object.assign({},e,{width:t}))}),l.a.createElement(m.b,{path:"".concat(i,"/rainfall/:rain_gauge"),render:e=>l.a.createElement(li,Object.assign({},e,{width:t,chartType:"rainfall"}))}),l.a.createElement(m.b,{path:"".concat(i,"/subsurface/:tsm_sensor"),render:e=>l.a.createElement(fi,Object.assign({},e,{width:t,chartType:"subsurface"}))}),l.a.createElement(m.b,{path:"".concat(i,"/moms/:site_code"),render:e=>l.a.createElement(Gi,Object.assign({},e,{width:t}))}),l.a.createElement(m.b,{path:"".concat(i,"/consolidated/:site_code"),render:e=>l.a.createElement(hi,Object.assign({},e,{width:t}))}))),l.a.createElement(_i,{isOpen:E,clickHandler:j(!1),url:i}),l.a.createElement(yi,{isOpen:O,clickHandler:k(!1),setReloadEqEvent:We}))})),$i=a(604),eo=a.n($i);function to(e,t,a,n){const l=t.site,r=t.start_ts,c=t.end_ts,i="Range: <b>".concat(X()(r).format("DD MMM YYYY, HH:mm")," - ").concat(X()(c).format("DD MMM YYYY, HH:mm"),"</b><br/>")+"Site: <b>".concat(l?l.label:"All","</b><br/>\n    <i>Note: Click on any alert triggers to show related monitoring events.</i>"),o=function(e){const t=["Alert 1","Alert 2","Alert 3"],a=e,n=[],l=[];let r,c;const i=a.length;let o;for(r=0;r<i;r+=1){const e=a[r],i=e.y,s=e.color,m=e.drilldown;n.push({name:t[r],y:i,color:s});const d=m.data,u=m.categories,p=m.trigger_events;for(o=d.length,c=0;c<o;c+=1)l.push({name:u[c],y:d[c],color:di()(s).brighten(.5*(c+1)).hex(),alert_events:p[c]})}return{alerts_data:n,trigger_count:l}}(e);return{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"<b>Monitoring Event Alerts Summary</b>",y:22},subtitle:{text:i,style:{fontSize:"0.75rem"}},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{center:["50%","50%"]}},series:[{name:"Alerts",data:o.alerts_data,size:"80%",tooltip:{pointFormat:"Count: <b>{point.y} ({point.percentage:.1f}%)</b>"},dataLabels:{formatter(){return this.y>5?this.point.name:null},color:"#ffffff",distance:-30}},{name:"Count",data:o.trigger_count,size:"80%",innerSize:"60%",dataLabels:{formatter(){return this.y>1?"<b>".concat(this.point.name,":</b> ").concat(this.y):null}},point:{events:{click(e){const t=e.point,l=t.alert_events,r=t.name;a({alert_events:l,name:r}),n.reflow()}}}}],loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var ao=function(e){const t=e.highcharts,a=e.data,r=e.colors,c=e.isLoading,i=e.input,s=e.setSelectedTrigger,m=Object(n.useState)(null),d=Object(o.a)(m,2),p=d[0],b=d[1];let g=[];null!==a&&(g=function(e,t){const a=[];return e.forEach((e,n)=>{const l=Object(u.a)(Object(u.a)({},e),{},{color:t[n]});a.push(l)}),a}(a,r));const E=Object(n.useState)(to(g,i,s,p)),f=Object(o.a)(E,2),h=f[0],_=f[1];return Object(n.useEffect)(()=>{null!==p&&(c?p.showLoading():p.hideLoading())},[p,c]),Object(n.useEffect)(()=>{let e=!1;null!==p&&null!==a&&(_(to(g,i,s,p)),0===a.length&&(e=!0),e?p.showNoData():p.hideNoData())},[p,a]),l.a.createElement(uc.a,{highcharts:t,options:h,callback:e=>b(e)})};function no(e,t){const a=t.site,n=t.year;return{chart:{type:"column"},title:{text:"<b>Monthly Monitoring Event Alerts</b>",y:22},subtitle:{text:"Year: <b>".concat(n,"</b><br/>")+"Site: <b>".concat(a?a.label:"All","</b>"),style:{fontSize:"0.75rem"}},series:e,xAxis:{categories:["January","February","March","April","May","June","July","August","September","October","November","December"]},yAxis:{min:0,title:{text:"<b>Number of heightened alerts</b>"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:oc.a.defaultOptions.title.style&&oc.a.defaultOptions.title.style.color||"gray"}}},legend:{backgroundColor:oc.a.defaultOptions.legend.backgroundColor||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,reversed:!0},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,formatter(){return 0===this.y?"":this.y}}}},loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var lo=function(e){const t=e.highcharts,a=e.data,r=e.colors,c=e.isLoading,i=e.input,s=Object(n.useState)(null),m=Object(o.a)(s,2),d=m[0],p=m[1];let b=[];null!==a&&(b=function(e,t){const a=[];return e.forEach((e,n)=>{const l=Object(u.a)(Object(u.a)({},e),{},{color:t[n]});a.push(l)}),a}(a,r),b.reverse());const g=Object(n.useState)(no(b,i)),E=Object(o.a)(g,2),f=E[0],h=E[1];return Object(n.useEffect)(()=>{null!==d&&(c?d.showLoading():d.hideLoading())},[d,c]),Object(n.useEffect)(()=>{let e=!1;null!==d&&null!==a&&(h(no(b,i)),0===a.length&&(e=!0),e?d.showNoData():d.hideNoData())},[d,a]),l.a.createElement(uc.a,{highcharts:t,options:f,callback:e=>p(e)})};var ro=function(e){const t=e.selectedTrigger,a=e.history,n=t.alert_events,r=t.name,c=n.map(e=>{const t=e.event_id,n=e.site,r=e.event_start,c=e.validity;return[l.a.createElement(p.a,{onClick:e=>a.push("/monitoring/events/".concat(t)),style:{color:"blue"}},l.a.createElement("u",null,t)),ne(n),X()(r).format("DD MMMM YYYY, HH:mm"),X()(c).format("DD MMMM YYYY, HH:mm")]});return l.a.createElement(fl.a,{title:'Monitoring Events with "'.concat(r,'" trigger'),columns:[{name:"Event ID"},{name:"Site"},{name:"Event Start"},{name:"Validity"}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"simple"},data:c})};window.Highcharts=bc.a,eo()(window.Highcharts);const co=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(u.a)(Object(u.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}}),card:{height:"auto"}})});function io(e,t){return""===t?"Required field":""}function oo(e,t){const a=t.type,n=t.field,l=t.value,r=e[n],c=l,i=io(0,l),o=so(c);switch(a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},r),{},{value:c,helper_text:i})});case"RESET":return Object(u.a)({},o);default:return Object(u.a)({},e)}}function so(e){const t={};return e&&Object.keys(e).forEach(a=>{const n=e[a]?e[a]:"",l=(t[a],io(0,n));t[a]={value:n,helper_text:l,required:!0}}),t}function mo(e){const t={};return Object.keys(e).forEach(a=>{t[a]=e[a].value}),t}var uo=function(e){const t=co(),a=[fe.a,fe.b,fe.c],r=Object(n.useState)({data:null,is_loading:!0}),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)({data:null,is_loading:!0}),d=Object(o.a)(m,2),u=d[0],b=d[1],g=X()(),f={site:"",start_ts:g.clone().subtract(1,"year"),end_ts:g},h={site:"",year:X()().format("YYYY")},_=Object(n.useReducer)(oo,f,so),O=Object(o.a)(_,2),x=O[0],j=O[1],k=Object(n.useReducer)(oo,h,so),S=Object(o.a)(k,2),C=S[0],w=S[1],D=function(e=5){const t=(new Date).getFullYear();return Array.from({length:e},(a,n)=>t-e+n+1)}(),A=Object(n.useState)(null),I=Object(o.a)(A,2),M=I[0],T=I[1],N=(e,t)=>j({type:"UPDATE",field:e,value:X()(t).format("YYYY-MM-DD HH:mm:ss")}),Y=(e,t,a=!1)=>{const n={data:t,is_loading:a};"pie"===e?s(n):"stacked"===e&&b(n)},R=e=>()=>{let t,a;"pie"===e?(a=i.data,t=x):"stacked"===e&&(a=u.data,t=C),Y(e,a,!0);const n=mo(t);n.site&&(n.site_id=n.site.value);Ic({chart_type:e,inputs:n},t=>{Y(e,t)})};return Object(n.useEffect)(()=>{[{chart_type:"pie",inputs:f},{chart_type:"stacked",inputs:h}].forEach(e=>{Ic(e,t=>{Y(e.chart_type,t)})})},[]),l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(ze,{title:"Analysis | Monitoring Alerts Analytics"}),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{className:t.card},l.a.createElement(q.a,null,l.a.createElement(v.a,{variant:"overline",display:"block",gutterBottom:!0},"Alerts Summary"),l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between"},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(ua,{value:x.site.value,changeHandler:e=>{j({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12,sm:3},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"Start Timestamp",value:x.start_ts.value,onChange:e=>N("start_ts",e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:3},l.a.createElement(Ut.b,{required:!0,autoOk:!0,label:"End Timestamp",value:x.end_ts.value,onChange:e=>N("end_ts",e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:12,align:"right"},l.a.createElement(p.a,{size:"small",color:"primary",variant:"contained",onClick:R("pie")},"Submit")))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{className:t.card},l.a.createElement(q.a,null,l.a.createElement(ao,{highcharts:bc.a,data:i.data,isLoading:i.is_loading,colors:a,input:mo(x),setSelectedTrigger:T})))),M&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{className:t.card},l.a.createElement(ro,Object.assign({},e,{selectedTrigger:M})))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{className:t.card},l.a.createElement(q.a,null,l.a.createElement(v.a,{variant:"overline",display:"block",gutterBottom:!0},"Monthly Alerts Per Year"),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,sm:8},l.a.createElement(ua,{value:C.site.value||"",changeHandler:e=>{w({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),l.a.createElement(y.a,{item:!0,xs:12,sm:4},l.a.createElement(ot.a,{required:!0,fullWidth:!0},l.a.createElement(wa.a,{id:"alert_level_label"},"Year"),l.a.createElement(Da.a,{labelId:"alert_level_label",id:"alert_level",value:C.year.value,onChange:e=>w({type:"UPDATE",field:"year",value:e.target.value}),error:Boolean(C.year.helper_text)},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"---")),D.map(e=>l.a.createElement(B.a,{value:e,key:e},e))),l.a.createElement(E.a,{error:!0},C.year.helper_text))),l.a.createElement(y.a,{item:!0,xs:12,align:"right"},l.a.createElement(p.a,{size:"small",color:"primary",onClick:R("stacked"),variant:"contained"},"Submit")))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{className:t.card},l.a.createElement(q.a,null,l.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(lo,{highcharts:bc.a,data:u.data,isLoading:u.is_loading,colors:a,input:mo(C)})))))))))},po=a(33),bo=a(1070);const go=Object(O.a)(e=>({list:{maxHeight:"60vh",overflowY:"auto",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}},searchBox:{marginBottom:e.spacing(3)},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}}));var Eo=l.a.memo((function(e){const t=e.selectedLogger,a=e.onLoggerClickFn,r=e.reloadList,c=e.loggers,i=e.setLoggers,s=e.setReloadList,m=go(),d=Object(n.useState)([]),u=Object(o.a)(d,2),p=u[0],b=u[1],g=Object(n.useState)(null),E=Object(o.a)(g,2),f=E[0],h=E[1];return Object(n.useEffect)(()=>{Ac(e=>{const t=e.loggers,n=e.rain_gauges;t.forEach(e=>{const t=e.logger_model.has_rain,a=e.logger_name;if(t){const t=n.find(e=>e.gauge_name===a);e.rain_gauge=t||null}}),i(t),b(t),t.length>0&&a(t[0])()})},[]),Object(n.useEffect)(()=>{r&&setTimeout(()=>{Ac(e=>{const t=e.loggers,a=e.rain_gauges;t.forEach(e=>{const t=e.logger_model.has_rain,n=e.logger_name;if(t){const t=a.find(e=>e.gauge_name===n);e.rain_gauge=t||null}}),i(t)}),s(!1)},1e3)},[r]),Object(n.useEffect)(()=>{if(null!==f){const e=p.filter(e=>{const t=e.logger_name;return new RegExp("".concat(f.toLowerCase()),"gi").test(t.toLocaleLowerCase())});i(e)}else i(c)},[f]),l.a.createElement("div",{className:m.sticky},l.a.createElement(Ia.a,{fullWidth:!0,margin:"dense",placeholder:"Search loggers...",onChange:e=>h(e.target.value),className:m.searchBox}),l.a.createElement(kn.a,{"aria-label":"list",className:m.list},c.map(e=>{const n=e.logger_name,r=e.logger_id,c=null!==t&&t.logger_id===r;return l.a.createElement(Cn.a,{button:!0,key:e.logger_id,onClick:a(e),selected:c},l.a.createElement(wn.a,{primary:n.toUpperCase()}))})))})),fo=a(1141),ho=a(96),_o=a.n(ho);const yo=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],vo=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Oo(e){const t=e.inputRef,a=e.mask,n=Object(Qt.a)(e,["inputRef","mask"]);return l.a.createElement(_o.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function xo(e){const t=e.rainGauge,a=e.saveUpdate,r=t.date_activated,c=t.date_deactivated,i=t.rain_id,s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],u=m[1],b={value:c,helper_text:null},g=Object(n.useState)(b),E=Object(o.a)(g,2),f=E[0],h=E[1];Object(n.useEffect)(()=>{h(b)},[t]);const _=f.value?X()(f.value).format("DD MMMM YYYY"):"---";return l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"RAIN GAUGE")),!d&&l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date activated:")," ",X()(r).format("DD MMMM YYYY")),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date deactivated:")," ",_)),d&&l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},l.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Deactivated",value:f.value||null,onChange:e=>(e=>{let t="";null===e?t="Required field":e.isValid()||(t="Enter a valid date"),h({value:e,helper_text:t})})(e),helperText:f.helper_text||"",error:Boolean(f.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0})))),l.a.createElement(fo.a,{style:{justifyContent:"flex-end"}},!d&&l.a.createElement(p.a,{color:"primary",onClick:()=>u(!0)},"Edit"),d&&l.a.createElement(n.Fragment,null,l.a.createElement(p.a,{color:"primary",onClick:()=>u(!1)},"Cancel"),l.a.createElement(p.a,{color:"secondary",onClick:()=>(()=>{u(!1);const e={date_deactivated:f.value.format("YYYY-MM-DD"),section:"rain",rain_id:i};a(e)})(),disabled:Boolean(f.helper_text)||null===f.helper_text},"Save"))))}function jo(e){const t=e.tsmSensor,a=e.saveUpdate,r=t.date_activated,c=t.date_deactivated,i=t.version,s=t.number_of_segments,m=t.segment_length,d=t.tsm_id,u=Object(n.useState)(!1),b=Object(o.a)(u,2),g=b[0],E=b[1],f={value:c,helper_text:null},h=Object(n.useState)(f),_=Object(o.a)(h,2),O=_[0],x=_[1];Object(n.useEffect)(()=>{x(f)},[t]);const j=O.value?X()(O.value).format("DD MMMM YYYY"):"---";return l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"TILT SENSOR")),!g&&l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:12,md:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Version:")," ",i),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,md:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"No. of segments:")," ",s),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,md:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Segment length:")," ",m),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date activated:")," ",X()(r).format("DD MMMM YYYY")),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date deactivated:")," ",j)),g&&l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},l.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Deactivated",value:O.value||null,onChange:e=>(e=>{let t="";null===e?t="Required field":e.isValid()||(t="Enter a valid date"),x({value:e,helper_text:t})})(e),helperText:O.helper_text||"",error:Boolean(O.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0})))),l.a.createElement(fo.a,{style:{justifyContent:"flex-end"}},!g&&l.a.createElement(p.a,{color:"primary",onClick:()=>E(!0)},"Edit"),g&&l.a.createElement(n.Fragment,null,l.a.createElement(p.a,{color:"primary",onClick:()=>E(!1)},"Cancel"),l.a.createElement(p.a,{color:"secondary",onClick:()=>(()=>{E(!1);const e={date_deactivated:O.value.format("YYYY-MM-DD"),section:"tilt",tsm_id:d};a(e)})(),disabled:Boolean(O.helper_text)||null===O.helper_text},"Save"))))}function ko(e){const t=e.tsmSensor,a=e.saveUpdate,n=t.version,r=t.accelerometers;return l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"ACCELEROMETERS")),r.map(e=>l.a.createElement(So,{row:e,version:n,key:e.accel_id,saveUpdate:a}))))}function So(e){const t=e.row,a=e.version,r=e.saveUpdate,c=t.node_id,i=t.accel_number,s=t.voltage_min,m=t.voltage_max,d=t.in_use,b=t.date_updated,f=t.status,h=t.accel_id,_=t.tsm_id,O={status:"",remarks:""},x=Object(n.useState)(!1),k=Object(o.a)(x,2),S=k[0],C=k[1],w=Object(n.useState)(Object(u.a)({in_use:Boolean(d),voltage_max:m,voltage_min:s,date_updated:b},O)),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(!1),T=Object(o.a)(M,2),N=T[0],Y=T[1];Object(n.useEffect)(()=>{I(Object(u.a)(Object(u.a)({},A),O))},[N]);const R=(e,t)=>{I(Object(u.a)(Object(u.a)({},A),{},{[e]:t}))},H=Object.keys(A).some(e=>""===A[e]),P=null!==A.date_updated?X()(A.date_updated).format("DD MMMM YYYY"):"---";return l.a.createElement(n.Fragment,{key:h},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,l.a.createElement("u",null,"Node ",c,1===a?"":", Accel ".concat(i)))),!S&&l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:2,variant:"body1",align:"center"},l.a.createElement("strong",null,"Active:")," ",A.in_use?"Yes":"No"),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:3,variant:"body1",align:"center"},l.a.createElement("strong",null,"Min Voltage:")," ",A.voltage_min),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:3,variant:"body1",align:"center"},l.a.createElement("strong",null,"Max Voltage:")," ",A.voltage_max),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Last Update:")," ",P),f.length>0&&l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"Latest Flag")),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Status:")," ",2===(L=f[0].status)?"Use with caution":3===L?"Special case":4===L?"Not OK":""),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Timestamp:")," ",X()(f[0].ts_flagged).format("DD MMMM YYYY")),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:12,md:12,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Flagger:")," ",f[0].flagger),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"body1",align:"center"},l.a.createElement("strong",null,"Remarks:")," ",f[0].remarks||"---"))),S&&l.a.createElement(n.Fragment,null,l.a.createElement(ot.a,{fullWidth:!0,component:y.a,item:!0,xs:12,sm:3,style:{justifyContent:"center",alignItems:"center"}},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:A.in_use,onChange:e=>R("in_use",e.target.checked),name:"isActive",color:"primary"}),label:"Active"})),l.a.createElement(y.a,{item:!0,xs:12,sm:3},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Min Voltage",type:"number",value:A.voltage_min,onChange:e=>R("voltage_min",e.target.value),helperText:A.voltage_min?"":"Required field",error:!A.voltage_min&&0!==A.voltage_min})),l.a.createElement(y.a,{item:!0,xs:12,sm:3},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Max Voltage",type:"number",value:A.voltage_max,onChange:e=>R("voltage_max",e.target.value),helperText:A.voltage_max?"":"Required field",error:!A.voltage_max&&0!==A.voltage_max})),l.a.createElement(y.a,{item:!0,xs:12,sm:3,align:"center"},l.a.createElement(p.a,{color:"primary",variant:"contained",onClick:()=>Y(!N)},N?"Cancel flag":"Add flag")),N&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,sm:3},l.a.createElement(ot.a,{required:!0,fullWidth:!0,error:!A.status},l.a.createElement(wa.a,null,"Status"),l.a.createElement(Da.a,{value:A.status,onChange:e=>R("status",e.target.value),error:!A.status},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"None")),l.a.createElement(B.a,{value:"2",key:"2"},"Use with caution"),l.a.createElement(B.a,{value:"3",key:"3"},"Special case"),l.a.createElement(B.a,{value:"4",key:"4"},"Not OK")),l.a.createElement(E.a,{error:!0},A.status?"":"Required field"))),l.a.createElement(y.a,{item:!0,xs:12,sm:9},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Remarks",value:A.remarks,onChange:e=>R("remarks",e.target.value),helperText:A.remarks?"":"Required field",error:!A.remarks})))),l.a.createElement(y.a,{item:!0,xs:12,align:"right"},!S&&l.a.createElement(p.a,{color:"primary",onClick:()=>C(!0)},"Edit"),S&&l.a.createElement(n.Fragment,null,l.a.createElement(p.a,{color:"primary",onClick:()=>C(!1)},"Cancel"),l.a.createElement(p.a,{color:"secondary",onClick:()=>(()=>{C(!1);const e=X()().format("YYYY-MM-DD"),t=Object(u.a)(Object(u.a)({},A),{},{section:"accelerometers",accel_id:h,node_id:c,tsm_id:_,has_new_status:N,flagger:Object(j.a)(),ts_updated:e});r(t)})(),disabled:H},"Save"))));var L}function Co(e){const t=e.selectedLogger,a=e.saveUpdate,r=t.date_activated,c=t.date_deactivated,i=t.latitude,s=t.longitude,m=t.logger_id,d=t.logger_mobile,b=d.sim_num,E=d.mobile_id,f=t.logger_model.logger_type,h={date_deactivated:{value:c,helper_text:"",required:!1},logger_number:{value:Object(ho.conformToMask)(b,vo).conformedValue,helper_text:"",required:!0},latitude:{value:i,helper_text:"",required:!0},longitude:{value:s,helper_text:"",required:!0}},_=Object(n.useState)(!1),O=Object(o.a)(_,2),x=O[0],j=O[1],k=Object(n.useState)(h),S=Object(o.a)(k,2),C=S[0],w=S[1];Object(n.useEffect)(()=>{w(h)},[t]);const D=(e,t)=>{const a=C[e];let n="";""===t&&Boolean(a.required)&&(n="Required field"),"date_deactivated"!==e||null===t||t.isValid()||(n="Enter a valid date"),"logger_number"===e&&t.includes("x")&&(n="Enter complete mobile number");const l=Object(u.a)(Object(u.a)({},C),{},{[e]:Object(u.a)(Object(u.a)({},a),{},{value:t,helper_text:n})});w(l)},A=Object(n.useState)(!1),I=Object(o.a)(A,2),M=I[0],T=I[1];Object(n.useEffect)(()=>T(Object.keys(C).some(e=>{const t=C[e],a=t.required,n=t.helper_text;return a&&""!==n||!a&&""!==n})),[C]);const N=C.date_deactivated.value?X()(C.date_deactivated.value).format("DD MMMM YYYY"):"---";return l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"LOGGER INFO")),!x&&l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date installed:")," ",X()(r).format("DD MMMM YYYY")),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Date deactivated:")," ",N),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Type:")," ",f.toUpperCase()),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Logger number:")," +",C.logger_number.value),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Latitude:")," ",C.latitude.value),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},l.a.createElement("strong",null,"Longitude:")," ",C.longitude.value)),x&&l.a.createElement(n.Fragment,null,l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:6,lg:3},l.a.createElement(Bl.b,{autoOk:!0,label:"Date Deactivated",value:C.date_deactivated.value||null,onChange:e=>D("date_deactivated",e),helperText:C.date_deactivated.helper_text||"",error:Boolean(C.date_deactivated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:6,lg:3},l.a.createElement(g.a,{required:!0,fullWidth:!0,label:"Logger Number",InputProps:{inputComponent:Oo,inputProps:{mask:yo}},InputLabelProps:{shrink:!0},value:C.logger_number.value,onChange:e=>D("logger_number",e.target.value),helperText:C.logger_number.helper_text||"",error:Boolean(C.logger_number.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,lg:3},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Latitude",type:"number",value:C.latitude.value,onChange:e=>D("latitude",e.target.value),helperText:C.latitude.helper_text||"",error:Boolean(C.latitude.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,lg:3},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Longitude",type:"number",value:C.longitude.value,onChange:e=>D("longitude",e.target.value),helperText:C.longitude.helper_text||"",error:Boolean(C.longitude.helper_text)})))),l.a.createElement(fo.a,{style:{justifyContent:"flex-end"}},!x&&l.a.createElement(p.a,{color:"primary",onClick:()=>j(!0)},"Edit"),x&&l.a.createElement(n.Fragment,null,l.a.createElement(p.a,{color:"primary",onClick:()=>j(!1)},"Cancel"),l.a.createElement(p.a,{color:"secondary",onClick:()=>(()=>{j(!1);const e={};Object.keys(C).forEach(t=>{const a=C[t].value;let n=a;X.a.isMoment(a)&&(n=a.format("YYYY-MM-DD")),"logger_number"===t&&(n=a.replace(/[()+-\s]/g,"")),e[t]=n}),e.section="loggers",e.mobile_id=E,e.logger_id=m,a(e)})(),disabled:M},"Save"))))}var wo=function(e){const t=e.selectedLogger,a=e.setReloadList,r=t.logger_name,c=t.logger_model,o=c.has_rain,s=c.has_tilt,m=t.tsm_sensor,d=t.rain_gauge,u=Object(i.b)(),b=u.enqueueSnackbar,g=u.closeSnackbar,E=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{g(e)}},"Dismiss"),f=e=>{e.has_rain=o,1===o&&(e.rain=d),a(!0),console.log(e),function(e,t){const a="".concat(ee.b,"/api/sensor_deployment/save_data_update");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save data update reponse",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const t=e.status,a=e.message;let n;n=!0===t?"success":"error",b(a,{variant:n,autoHideDuration:5e3,action:E})})};return l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"h6"},l.a.createElement("strong",null,r.toUpperCase())),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Co,{selectedLogger:t,saveUpdate:f})),1===o&&Boolean(d)&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(xo,{rainGauge:d,saveUpdate:f})),1===s&&Boolean(m)&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(jo,{tsmSensor:m,saveUpdate:f})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ko,{tsmSensor:m,saveUpdate:f}))))};let Do=null;function Ao(e,t){const a=t.type,n=t.field,l=t.value,r=e[n],c=l,i=l,o=r.required,s=Do(n,i,o);switch(a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},r),{},{value:c,helper_text:s})});default:return Object(u.a)({},e)}}var Io=function(e){const t=e.onTiltFormUpdate,a=e.initReducer,r=e.getHelperText,c=e.checkInputFields;Do=r;const i=Object(n.useState)([]),s=Object(o.a)(i,2),m=s[0],d=s[1],p=Object(n.useReducer)(Ao,{date_activated:null,version:"",segment_length:"",number_of_segment:""},a),b=Object(o.a)(p,2),E=b[0],f=b[1];return Object(n.useEffect)(()=>{const e=c(E),a=m.some(e=>null===e||""===e),n=e||a,l=function(e){const t=e=>Object.keys(e).reduce((a,n)=>{const l=Object(u.a)({},a),r=e[n].value;let c=r;return"undefined"===typeof r&&(c=t(e[n])),""===r&&(c=null),"site"===n&&(c=r.data),X.a.isMoment(r)&&(c=r.format("YYYY-MM-DD HH:mm:ss")),l[n]=c,l},{});return t(e)}(Object(u.a)(Object(u.a)({},E),{},{segment_list:{value:m}}));t(l,n)},[E,m]),l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"Tilt Sensor")),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:6,md:3},l.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:E.date_activated.value||null,onChange:e=>f({type:"UPDATE",field:"date_activated",value:e}),helperText:E.date_activated.helper_text||"",error:Boolean(E.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:6,md:2},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Version",type:"number",value:E.version.value,onChange:e=>f({type:"UPDATE",field:"version",value:e.target.value}),helperText:E.version.helper_text||"",error:Boolean(E.version.helper_text)}))),l.a.createElement(y.a,{item:!0,xs:6,md:3},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Segment Length",type:"number",value:E.segment_length.value,onChange:e=>f({type:"UPDATE",field:"segment_length",value:e.target.value}),helperText:E.segment_length.helper_text||"",error:Boolean(E.segment_length.helper_text)}))),l.a.createElement(y.a,{item:!0,xs:6,md:4},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Number of Segment",type:"number",value:E.number_of_segment.value,onChange:e=>(e=>{f({type:"UPDATE",field:"number_of_segment",value:e});const t=""!==e?parseInt(e,10):0,a=Array.from(Array(t),(e,t)=>null);d([...a])})(e.target.value),helperText:E.number_of_segment.helper_text||"",error:Boolean(E.number_of_segment.helper_text)}))),0!==m.length&&l.a.createElement(v.a,{variant:"overline",display:"block",component:y.a,item:!0,xs:12},"Segments"),0!==m.length&&m.map((e,t)=>l.a.createElement(y.a,{item:!0,xs:4,sm:3,lg:2,key:"segment_container_".concat(t+1)},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Segment ".concat(t+1),key:"segment_".concat(t+1),type:"number",placeholder:"Enter ID",InputLabelProps:{shrink:!0},value:e||"",onChange:e=>((e,t)=>{const a=[...m];a[t]=e,d(a)})(e.target.value,t),helperText:""===e?"Required field":"",error:Boolean(""===e)}))))))};const Mo=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function To(e){const t=e.inputRef,a=e.mask,n=Object(Qt.a)(e,["inputRef","mask"]);return l.a.createElement(_o.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function No(e,t,a){if(""===t&&a)return"Required field";if("logger_number"===e&&t.includes("x"))return"Enter complete mobile number";if(["date_installed","date_activated"].includes(e)&&null!==t&&!t.isValid())return"Enter a valid date";if(["installed_sensors","personnel"].includes(e)&&0===t.length)return!0;if(("version"===e||"segment_length"===e||"number_of_segment"===e)&&(0===t||"0"===t))return"Invalid value";if("segment_list"===e){if(Object.keys(t).some(e=>""===t[e].segment_value))return"Invalid segment value inserted"}return""}function Yo(e,t){const a=t.type,n=t.field,l=t.value;let r=e[n],c=l,i=l;if(["installed_sensors","personnel"].includes(n)){const e=l.name,t=l.checked,a=r.value;t?(a.push(e),c=a):c=a.filter(t=>t!==e),i=c}try{if("tilt"===n){const e=l.tilt_data,t=l.test_value;c=e,i=t}const t=l.sensor;if(e.installed_sensors.value.includes(t)){const a=l.data;c=a,i=a,r=e[t][n]}}catch(m){}let o=!1;try{o=r.required}catch(m){}const s=No(n,i,o);switch(a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},r),{},{value:c,helper_text:s})});case"ADD_ATTRIBUTE":return Object(u.a)(Object(u.a)({},e),{},{[n]:l});case"UPDATE_SENSOR":const t=l.sensor;return Object(u.a)(Object(u.a)({},e),{},{[t]:{[n]:Object(u.a)(Object(u.a)({},r),{},{value:c,helper_text:s})}});case"UPDATE_TILT":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},r),{},{value:c,helper_text:s})});case"DELETE_ATTRIBUTE":return delete e[n],e;case"RESET":const a=Ro(c);return Object(u.a)({},a);default:return Object(u.a)({},e)}}function Ro(e){const t={},a=["date_activated"];return Object.keys(e).forEach(n=>{const l=!a.includes(n);t[n]={value:e[n],helper_text:null,required:l}}),t}const Ho=["brain","kate","sky","jec","kennex","reyn","web","oscar","dan","arnel","troy"];var Bo=function(e){const t=e.setIsAddLogger,a=e.setReloadList,r={site:"",logger_name:"",date_installed:null,latitude:"",longitude:"",location_description:"",network:"",logger_number:"",logger_type:"",installed_sensors:[],personnel:[]},c=Object(n.useReducer)(Yo,r,Ro),s=Object(o.a)(c,2),m=s[0],d=s[1],b=Object(n.useState)(!0),f=Object(o.a)(b,2),h=f[0],_=f[1],O=Object(i.b)(),x=O.enqueueSnackbar,j=O.closeSnackbar,k=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{j(e)}},"Dismiss"),S=(e,t)=>m[e].value.includes(t),C=e=>t=>{const a=t.target,n=a.name,l=a.checked;if(d({type:"UPDATE",field:e,value:{name:n,checked:l}}),"installed_sensors"===e)if(l){let e=Ro({date_activated:null});"tilt"===n&&(e={required:!0,helper_text:null,value:null}),d({type:"ADD_ATTRIBUTE",field:n,value:e})}else d({type:"DELETE_ATTRIBUTE",field:n})},w=e=>Object.keys(e).some(t=>{const a=e[t],n=a.required,l=a.helper_text;return"undefined"===typeof n?w(e[t]):n&&(""!==l||null===l)||!n&&""!==l&&null!==l});return Object(n.useEffect)(()=>{const e=w(m);_(e)},[m]),l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"h6"},l.a.createElement("strong",null,"Logger Deployment Form")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(ua,{required:!0,value:m.site.value,changeHandler:e=>d({type:"UPDATE",field:"site",value:e})})),l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(g.a,{required:!0,fullWidth:!0,label:"Logger Name",value:m.logger_name.value,onChange:e=>d({type:"UPDATE",field:"logger_name",value:e.target.value}),helperText:m.logger_name.helper_text||"",error:Boolean(m.logger_name.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(g.a,{required:!0,fullWidth:!0,label:"Logger Number",InputProps:{inputComponent:To,inputProps:{mask:Mo}},InputLabelProps:{shrink:!0},value:m.logger_number.value,onChange:e=>d({type:"UPDATE",field:"logger_number",value:e.target.value}),helperText:m.logger_number.helper_text||"",error:Boolean(m.logger_number.helper_text)})),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Installed",value:m.date_installed.value||null,onChange:e=>d({type:"UPDATE",field:"date_installed",value:e}),helperText:m.date_installed.helper_text||"",error:Boolean(m.date_installed.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Latitude",type:"number",value:m.latitude.value,onChange:e=>d({type:"UPDATE",field:"latitude",value:e.target.value}),helperText:m.latitude.helper_text||"",error:Boolean(m.latitude.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,lg:4},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Longitude",type:"number",value:m.longitude.value,onChange:e=>d({type:"UPDATE",field:"longitude",value:e.target.value}),helperText:m.longitude.helper_text||"",error:Boolean(m.longitude.helper_text)})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:7,lg:9},l.a.createElement(g.a,{fullWidth:!0,required:!0,label:"Location Description",value:m.location_description.value,onChange:e=>d({type:"UPDATE",field:"location_description",value:e.target.value}),helperText:m.location_description.helper_text||"",error:Boolean(m.location_description.helper_text)})),l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:5,lg:3},l.a.createElement(ot.a,{required:!0,fullWidth:!0,error:Boolean(m.network.helper_text)},l.a.createElement(wa.a,{id:"network"},"Main Network of Location"),l.a.createElement(Da.a,{labelId:"network-select-label",id:"network-select-id",value:m.network.value,onChange:e=>d({type:"UPDATE",field:"network",value:e.target.value}),error:Boolean(m.network.helper_text)},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"None")),l.a.createElement(B.a,{value:"Globe",key:"globe"},"Globe"),l.a.createElement(B.a,{value:"Smart",key:"smart"},"Smart")),l.a.createElement(E.a,{error:!0},m.network.helper_text))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{style:{margin:"8px 0"}})),l.a.createElement(ot.a,{component:y.a,item:!0,xs:12,lg:6,container:!0,alignItems:"center"},l.a.createElement(Ea.a,{component:"legend",required:!0},"Logger Type"),l.a.createElement(st.a,{row:!0,"aria-label":"logger_type_group",name:"logger_type",value:m.logger_type.value,onChange:e=>d({type:"UPDATE",field:"logger_type",value:e.target.value}),style:{justifyContent:"center"}},l.a.createElement(mt.a,{value:"masterbox",control:l.a.createElement(dt.a,{color:"primary"}),label:"Master Box",key:"master_box"}),l.a.createElement(mt.a,{value:"arq",control:l.a.createElement(dt.a,{color:"primary"}),label:"ARQ",key:"arq"}),l.a.createElement(mt.a,{value:"router",control:l.a.createElement(dt.a,{color:"primary"}),label:"Router",key:"router"}),l.a.createElement(mt.a,{value:"gateway",control:l.a.createElement(dt.a,{color:"primary"}),label:"Gateway",key:"gateway"}))),l.a.createElement(ot.a,{component:y.a,item:!0,xs:12,lg:6,container:!0,alignItems:"center",error:Boolean(m.installed_sensors.helper_text)},l.a.createElement(Ea.a,{component:"legend",required:!0},"Installed Sensors"),l.a.createElement(fa.a,{row:!0,style:{justifyContent:"center"}},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{name:"rain",checked:S("installed_sensors","rain"),onChange:C("installed_sensors")}),label:"Rain"}),l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{name:"tilt",checked:S("installed_sensors","tilt"),onChange:C("installed_sensors")}),label:"Tilt"}),l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{name:"piezo",checked:S("installed_sensors","piezo"),onChange:C("installed_sensors")}),label:"Piezometer"}),l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{name:"soms",checked:S("installed_sensors","soms"),onChange:C("installed_sensors")}),label:"Soil Moisture"})),m.installed_sensors.helper_text&&l.a.createElement(E.a,null,"Select at least one")),l.a.createElement(ot.a,{component:y.a,item:!0,xs:12,container:!0,alignItems:"center",error:Boolean(m.personnel.helper_text)},l.a.createElement(Ea.a,{component:"legend",required:!0},"Personnel"),l.a.createElement(fa.a,{row:!0,style:{justifyContent:"center"}},Ho.map(e=>l.a.createElement(mt.a,{key:e,control:l.a.createElement(Lt.a,{name:e,checked:S("personnel",e),onChange:C("personnel")}),label:"".concat(le(e))}))),m.personnel.helper_text&&l.a.createElement(E.a,null,"Select at least one"))))),m.installed_sensors.value.includes("rain")&&l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"Rain Gauge")),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.rain.date_activated.value||null,onChange:e=>d({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"rain"}}),helperText:m.rain.date_activated.helper_text||"",error:Boolean(m.rain.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("piezo")&&l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"Piezometer")),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.piezo.date_activated.value||null,onChange:e=>d({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"piezo"}}),helperText:m.piezo.date_activated.helper_text||"",error:Boolean(m.piezo.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("soms")&&l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(G.a,{variant:"outlined"},l.a.createElement(q.a,{component:y.a,container:!0,spacing:2},l.a.createElement(v.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},l.a.createElement("strong",null,"Soil Moisture")),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.soms.date_activated.value||null,onChange:e=>d({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"soms"}}),helperText:m.soms.date_activated.helper_text||"",error:Boolean(m.soms.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("tilt")&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Io,{onTiltFormUpdate:(e,t)=>{d({type:"UPDATE_TILT",field:"tilt",value:{test_value:!t||"",tilt_data:e}})},initReducer:Ro,getHelperText:No,checkInputFields:w})),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end"},l.a.createElement(p.a,{color:"primary",onClick:e=>t(!1)},"Cancel"),l.a.createElement(p.a,{color:"primary",onClick:e=>d({type:"RESET",value:r})},"Clear"),l.a.createElement(p.a,{variant:"contained",color:"secondary",style:{marginRight:8},onClick:()=>{const e=function(e){const t=e=>Object.keys(e).reduce((a,n)=>{const l=Object(u.a)({},a),r=e[n].value;let c=r;return"undefined"===typeof r&&(c=t(e[n])),""===r&&(c=null),"logger_number"===n&&(c=r.replace(/[()+-\s]/g,"")),"site"===n&&(c=r.data),X.a.isMoment(r)&&(c=r.format("YYYY-MM-DD")),l[n]=c,l},{});return t(e)}(m);e.date_installed=X()(e.date_installed).format("YYYY-MM-DD");e.installed_sensors.includes("tilt")&&(e.tilt.date_activated=X()(e.tilt.date_activated).format("YYYY-MM-DD")),console.log(e),function(e,t){const a="".concat(ee.b,"/api/sensor_deployment/save_logger_deployment");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save deployment logs reponse",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const n=e.status,l=e.message;let r;n?(r="success",t(!1),a(!0)):r="error",x(l,{variant:r,autoHideDuration:5e3,action:k})})},disabled:h},"Submit")))};const Po=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:{overflowY:"auto",height:"calc(100vh - 250px)",[e.breakpoints.down("md")]:{height:"80vh"}},insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"},form_message_style:{color:"red",fontStyle:"italic"}})});function Lo(e){return l.a.createElement("span",null,l.a.createElement(p.a,{"aria-label":"Add logger",variant:"contained",color:"primary",size:"small",onClick:()=>e(!0),startIcon:l.a.createElement(Ht.a,null)},"Add logger"))}var Fo=function(e){const t=Po(),a=Object(po.a)(),r=Object(bo.a)(a.breakpoints.up("sm")),c=Object(n.useState)(!1),i=Object(o.a)(c,2),s=i[0],m=i[1],d=Object(n.useState)(null),u=Object(o.a)(d,2),p=u[0],b=u[1],g=Object(n.useState)(!1),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)([]),v=Object(o.a)(_,2),O=v[0],x=v[1];return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(ze,{title:"Analysis | Loggers and Sensors Form",className:t.sticky,customButtons:!!r&&Lo(m)}),l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:12,sm:3,lg:2},l.a.createElement(Eo,{selectedLogger:p,onLoggerClickFn:e=>()=>{b(e),console.log("Selected logger",e)},reloadList:f,loggers:O,setLoggers:x,setReloadList:h})),l.a.createElement(y.a,{item:!0,xs:12,sm:9,lg:10},!s&&null!==p&&l.a.createElement(wo,{selectedLogger:p,setReloadList:h}),s&&l.a.createElement(Bo,{setIsAddLogger:m,setReloadList:h})))))},Uo=a(1187),zo=a(1188),Wo=a(1146),Go=a(1206),qo=a(1177),Vo=a(1178),Qo=a(1179),Zo=a(1180),Ko=a(120),Jo=a.n(Ko),Xo=a(1174);var $o=function(e){const t=e.onClose,a=e.open,n=e.isUnregistered,r=e.setBlockModal,c=e.setSaveContactModal;return l.a.createElement(lt.a,{onClose:()=>{t()},"aria-labelledby":"simple-dialog-title",open:a},l.a.createElement(rt.a,{id:"simple-dialog-title"},"Message options"),l.a.createElement(kn.a,null,n&&l.a.createElement(Cn.a,{button:!0,onClick:()=>{t(),c(!0)}},l.a.createElement(Dn.a,null,l.a.createElement(Fl.a,null)),l.a.createElement(wn.a,{primary:"Save number"})),l.a.createElement(Cn.a,{button:!0,onClick:()=>{t(),r(!0)}},l.a.createElement(Dn.a,null,l.a.createElement(Xo.a,null)),l.a.createElement(wn.a,{primary:"Block number"}))))};var es=l.a.memo((function(e){const t=e.open,a=e.setBlockModal,r=e.mobileDetails,c=e.setOpenOptions,s=r.sim_num,m=r.mobile_id,d=Object(i.b)(),u=d.enqueueSnackbar,b=d.closeSnackbar,E=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{b(e)}},"Dismiss"),f=Object(n.useState)(""),h=Object(o.a)(f,2),_=h[0],y=h[1],v=Object(n.useState)(null),O=Object(o.a)(v,2),x=O[0],k=O[1],S=Object(j.a)().user_id;return l.a.createElement(lt.a,{open:t,onExited:()=>y(""),"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Block mobile number (+".concat(s,")")),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Provide the reason for blocking this mobile number from Chatterbox"),l.a.createElement(g.a,{autoFocus:!0,value:_,onChange:e=>{const t=e.target.value;y(t);let a="";""===t&&(a="This is a required field"),k(a)},margin:"dense",id:"reason",label:"Reason",multiline:!0,fullWidth:!0,required:!0,placeholder:"Enter reason",inputProps:{maxLength:500},error:""===_,helperText:x})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:()=>a(!1),color:"primary"},"Cancel"),l.a.createElement(p.a,{onClick:()=>{if(""===_)k("This is a required field");else{a(!1);const e={mobile_id:m,reporter_id:S,reason:_};console.log(e),function(e,t){const a="".concat(ee.b,"/api/contacts/save_block_number");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save blocked contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const t=e.status,a=e.message;console.log(e),u(a,t?{variant:"success",autoHideDuration:4e3,action:E}:{variant:"error",autoHideDuration:3e3,action:E})}),c(!1)}},color:"secondary"},"Block")))})),ts=a(1175),as=a(1176);const ns={0:["LEWC"],1:["LGU","NGO"],2:["LGU","NGO","PNP"],3:["LGU","NGO","PNP"],4:["NGO","OCD","PHIVOLCS","DOST"],5:["NGO","OCD","PHIVOLCS","DOST","MGB"]},ls=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],rs=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function cs(e,t){let a=[];if("municipality"===t){a=[...e.map(({municipality:e,province:t})=>({id:e,label:"".concat(e,", ").concat(t)}))]}else if(["province","region"].includes(t)){a=[...[...new Set(e.map(e=>e[t]).sort())].map(e=>({id:e,label:e}))]}return a}function is(e){const t=e.inputRef,a=e.mask,n=Object(Qt.a)(e,["inputRef","mask"]);return l.a.createElement(_o.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function os(e,t){const a=[];return"mobile"===t?e.forEach((e,t)=>{const n=e.mobile_number;n.sim_num=n.sim_num.replace(/[()+-\s]/g,""),a.push(e)}):e.forEach((e,t)=>{delete e.mobile_id;void 0===e.landline_id&&(e.landline_id=0),e.landline_num=e.landline_num.replace(/[()+-\s]/g,""),a.push(e)}),a}function ss(e,t){const a=t.type,n=t.category,l=t.payload,r=[...e];let c={status:1,has_delete:!0};switch("email"===n?c="":"mobile"===n?c=Object(u.a)(Object(u.a)({},c),{},{mobile_number:{sim_num:"",mobile_id:0}}):"landline"===n&&(c=Object(u.a)(Object(u.a)({},c),{},{landline_num:""})),a){case"UPDATE":return"email"===n?r[l.key]=l.value:"mobile"===n&&"sim_num"===l.data?r[l.key].mobile_number[l.data]=l.value:r[l.key][l.data]=l.value,[...r];case"ADD":return[...r,c];case"DELETE":return r.splice(l.key,1),[...r]}return[]}function ms(e){return ns[e].map(e=>({id:e.toLowerCase(),label:e}))}var ds=l.a.memo((function(e){const t=e.setContactForm,a=e.chosenContact,r=e.isEditMode,c=e.setContactFormForEdit,s=e.handleClose,m=e.isFromChatterbox,d=e.setSnackbarKey;let b=[{mobile_number:{sim_num:"",mobile_id:0},status:1}],E=[],f=[],h=0,_="",O=[],x="",j="",k=!0,S=!0,C=0,w={first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0};if(r||m){const e=a.mobile_numbers,t=a.ewi_recipient,n=a.ewi_restriction,l=a.landline_numbers,r=a.emails,c=a.first_name,i=a.last_name,o=a.middle_name,s=a.nickname,m=a.user_id,d=a.organizations,u=a.status;if(w={first_name:c,last_name:i,middle_name:o,nickname:s,user_id:m},0!==d.length){const e=d[0].organization,t=e.scope,a=e.name,n=d[0].site;h=t,_=a,O=ms(t);const l=function(e,t){const a=t.municipality,n=t.province,l=t.region,r=t.site_id;let c="",i="";return 0===e||1===e?(c={value:r},i=""):2===e?(c="",i=a):3===e?(c="",i=n):4===e&&(c="",i=l),{site:c,location:i}}(t,n);x=l.site,j=l.location}if(null!==n&&0!==n.length){C=n.alert_level}b=e.map((e,t)=>{const a=JSON.parse(JSON.stringify(e)),n=a.mobile_number.sim_num;var l;return a.mobile_number.sim_num=(l=n,Object(ho.conformToMask)(l,rs).conformedValue),a}),E=l,f=r,S=1===t,k=1===u}const D=Object(n.useContext)(sa).sites,A=[{id:0,label:"Community"},{id:1,label:"Barangay"},{id:2,label:"Municipal",select_label:"Municipality",list:cs(D,"municipality")},{id:3,label:"Provincial",select_label:"Province",list:cs(D,"province")},{id:4,label:"Regional",select_label:"Region",list:cs(D,"region")},{id:5,label:"National"}],I=Object(n.useState)(w),M=Object(o.a)(I,2),T=M[0],N=M[1],R=Object(n.useState)(h),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(n.useState)(x),F=Object(o.a)(L,2),U=F[0],z=F[1],W=Object(n.useState)(j),G=Object(o.a)(W,2),q=G[0],Q=G[1],Z=Object(n.useState)(O),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(_),te=Object(o.a)($,2),ne=te[0],le=te[1],re=Object(n.useReducer)(ss,b),ce=Object(o.a)(re,2),ie=ce[0],oe=ce[1],se=Object(n.useReducer)(ss,E),me=Object(o.a)(se,2),de=me[0],ue=me[1],pe=Object(n.useReducer)(ss,f),be=Object(o.a)(pe,2),ge=be[0],Ee=be[1],fe=Object(n.useState)(S),he=Object(o.a)(fe,2),_e=he[0],ye=he[1],ve=Object(n.useState)(k),Oe=Object(o.a)(ve,2),xe=Oe[0],je=Oe[1],ke=Object(i.b)(),Se=ke.enqueueSnackbar,Ce=ke.closeSnackbar,we=Object(n.useState)(C),De=Object(o.a)(we,2),Ae=De[0],Ie=De[1],Te=Object(n.useState)(!1),Ne=Object(o.a)(Te,2),Ye=Ne[0],Re=Ne[1],He=()=>(m&&s(),r?c(!1):t(!1)),Be=e=>t=>{N(Object(u.a)(Object(u.a)({},T),{},{[e]:t.target.value}))},Pe=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{Ce(e)}},"Dismiss");Object(n.useEffect)(()=>{if(""!==B){const e=ms(B);X(e),r||(z(""),Q(""),le(""))}},[B]),Object(n.useEffect)(()=>{let e=!0;e=function(e,t,a){const n=e.first_name,l=e.last_name,r=a.scope,c=a.site,i=a.office,o=a.location,s=t.mobile_nums,m=t.landline_nums;let d=!1,u=!1,p=!1,b=null;return s.forEach((e,t)=>{const a=e.mobile_number.sim_num;!1===d&&(d=""===a||a.includes("x"))}),0!==m.length&&m.forEach((e,t)=>{const a=e.landline_num;!1===p&&(p=""===a||a.includes("x"))}),0===r||1===r?u=""===c||""===i:2===r||3===r||4===r?u=""===o||""===i:5===r&&(u=""===o),b=""===n||""===l||!0===d||!0===u||!0===p,b}(T,{mobile_nums:ie,landline_nums:de},{scope:B,site:U,office:ne,location:q}),Re(e)},[T,ie,de,B,U,ne,q]);const Le=()=>{const e=os(ie,"mobile"),t=os(de,"landline"),a=_e?1:0,n=xe?1:0;!function(e,t){const a="".concat(ee.b,"/api/contacts/save_contact");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}({user:Object(u.a)(Object(u.a)({},T),{},{emails:ge,ewi_recipient:a,restriction:Ae,status:n}),affiliation:{site:U,location:q,scope:B,office:ne},contact_numbers:{mobile_numbers:e,landline_numbers:t}},e=>{const t=e.status,a=e.message;let n;!0===t?(He(),(()=>{if(!m){const e=Se("Updating contacts list...",{variant:"warning",persist:!0});d(e)}})(),n="success"):n="error",Se(a,{variant:n,autoHideDuration:5e3,action:Pe})})};return l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},!m&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"-webkit-center"}},l.a.createElement(Go.a,null,l.a.createElement(ts.a,null))),l.a.createElement(y.a,{item:!0,xs:9},l.a.createElement(v.a,{variant:"h5",align:"center"},"Contact Form")),l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(Y.a,{edge:"start",onClick:He},l.a.createElement(Rt.a,null))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Personal Details")),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"First Name",value:T.first_name,onChange:Be("first_name"),margin:"dense",required:!0,error:""===T.first_name})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Last Name",value:T.last_name,onChange:Be("last_name"),margin:"dense",required:!0,error:""===T.last_name})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Middle Name",value:T.middle_name||"",onChange:Be("middle_name"),margin:"dense"})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Nickname",value:T.nickname||"",onChange:Be("nickname"),margin:"dense"})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Affiliation")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Aa,{div_id:"scope",label:"Scope",changeHandler:e=>P(e.target.value),value:B,list:A,mapping:{id:"id",label:"label"},required:!0,error:""===B})),[0,1].includes(B)&&l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ua,{value:U,changeHandler:e=>z(e)})),[2,3,4].includes(B)&&l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(Aa,{div_id:"location",label:A[B].select_label,changeHandler:e=>Q(e.target.value),value:q,list:A[B].list,mapping:{id:"id",label:"label"},required:!0,error:""===q})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(Aa,{div_id:"office",label:"Office",changeHandler:e=>le(e.target.value),value:ne,list:J,mapping:{id:"id",label:"label"},required:!0,error:""===ne})),l.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},l.a.createElement(ot.a,null,l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:xe,onChange:e=>je(e.target.checked),value:"checkedA",color:"primary"}),label:"Active"}))),l.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},l.a.createElement(ot.a,null,l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:_e,onChange:e=>ye(e.target.checked),value:"checkedB",color:"primary"}),label:"EWI Recipient"}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Aa,{div_id:"ewi_restriction",label:"Ewi Restriction",changeHandler:e=>Ie(e.target.value),value:Ae,list:[{id:0,label:"No restrictions"},{id:1,label:"Do not send on Alert 1"},{id:2,label:"Do not send on Alert 2 and below"}],mapping:{id:"id",label:"label"},required:!0,error:""===Ae})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Contact Information")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},"Mobile")),ie.map((e,t)=>{const a=e.mobile_number.sim_num,r=e.status,c="undefined"!==typeof e.has_delete;let i=!0;return i=""===a||a.includes("x"),l.a.createElement(n.Fragment,{key:t},l.a.createElement(y.a,{item:!0,xs:7},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{label:"Mobile Number",value:a,onChange:e=>oe({type:"UPDATE",payload:{data:"sim_num",value:e.target.value,key:t},category:"mobile"}),InputProps:{inputComponent:is,inputProps:{mask:ls}},required:!0,error:i}))),l.a.createElement(y.a,{item:!0,xs:3,style:{textAlign:"center"}},l.a.createElement(mt.a,{style:{margin:0},control:l.a.createElement(Lt.a,{checked:Boolean(r),onChange:e=>oe({type:"UPDATE",payload:{data:"status",value:e.target.checked?1:0,key:t},category:"mobile"}),color:"primary"}),label:"Active"})),0!==t&&c?l.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},l.a.createElement(Y.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>oe({type:"DELETE",payload:{key:t}})},l.a.createElement(Or.a,null))):l.a.createElement(Me.a,null,l.a.createElement(y.a,{item:!0,xs:2})))}),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:l.a.createElement(as.a,null),onClick:()=>oe({type:"ADD",category:"mobile"})},"Add number")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},"Landline")),0===de.length&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No landline number saved")),de.map((e,t)=>{const a=e.landline_num;let r=!0;return r=""===a||a.includes("x"),l.a.createElement(n.Fragment,{key:t},l.a.createElement(y.a,{item:!0,xs:10},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{label:"Landline Number",value:a,onChange:e=>ue({type:"UPDATE",payload:{data:"landline_num",value:e.target.value,key:t},category:"landline"}),InputProps:{inputComponent:is,inputProps:{mask:[/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/]}},required:!0,error:r}))),l.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},l.a.createElement(Y.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>ue({type:"DELETE",payload:{key:t}})},l.a.createElement(Or.a,null))))}),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:l.a.createElement(as.a,null),onClick:()=>ue({type:"ADD",category:"landline"})},"Add number")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},"Email")),0===ge.length&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),ge.map((e,t)=>l.a.createElement(n.Fragment,{key:t},l.a.createElement(y.a,{item:!0,xs:10},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{label:"Email",value:e.email,onChange:e=>Ee({type:"UPDATE",payload:{value:e.target.value,key:t},category:"email"})}))),l.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},l.a.createElement(Y.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>Ee({type:"DELETE",payload:{key:t}})},l.a.createElement(Or.a,null))))),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:l.a.createElement(as.a,null),onClick:()=>Ee({type:"ADD",category:"email"})},"Add email")),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"16px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{color:"secondary",variant:"contained",style:{marginRight:6},onClick:()=>Le(),disabled:Ye},"Save"),l.a.createElement(p.a,{variant:"contained",onClick:He},"Cancel")))}));let us;function ps(){"undefined"!==typeof us&&null!==us||(us=gt()("".concat(ee.b,"/communications"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function bs(e,t){ps(),"chatterbox"===t?(us.emit("get_latest_messages"),us.emit("get_all_mobile_numbers"),us.emit("get_all_contacts")):"contacts"===t&&us.emit("get_all_contacts"),us.on("reconnecting",()=>{e(!0)}),us.on("reconnect",()=>{e(!1)}),us.on("reconnect_failed",()=>{console.log("failed")})}function gs(e){ps(),us.on("receive_all_contacts",t=>{console.log("All Contacts",t),e(t)})}function Es(){us.removeListener("receive_all_contacts")}const fs=Object(n.createContext)(),hs={sites:[],orgs:[],only_ewi_recipients:!1,include_inactive_numbers:!1,ts_start:null,ts_end:null,string_search:"",tag_search:{value:""},mobile_number_search:"",name_search:""};function _s(e,t){const a=t.type,n=t.value;switch(a){case"UPDATE_SITES":{let t=n;return null===t&&(t=[]),Object(u.a)(Object(u.a)({},e),{},{sites:t})}case"UPDATE_ORGS":{let t=n;return null===t&&(t=[]),Object(u.a)(Object(u.a)({},e),{},{orgs:t})}case"UPDATE_ONLY_EWI_RECIPIENTS":return Object(u.a)(Object(u.a)({},e),{},{only_ewi_recipients:n});case"UPDATE_INCLUDE_INACTIVE_NUMBERS":return Object(u.a)(Object(u.a)({},e),{},{include_inactive_numbers:n});case"UPDATE_TS_START":return Object(u.a)(Object(u.a)({},e),{},{ts_start:n});case"UPDATE_TS_END":return Object(u.a)(Object(u.a)({},e),{},{ts_end:n});case"UPDATE_STRING_SEARCH":return Object(u.a)(Object(u.a)({},e),{},{string_search:n});case"UPDATE_TAG_SEARCH":{let t=n;return null===t&&(t={value:""}),Object(u.a)(Object(u.a)({},e),{},{tag_search:t})}case"UPDATE_MOBILE_NUMBER_SEARCH":return Object(u.a)(Object(u.a)({},e),{},{mobile_number_search:n});case"UPDATE_NAME_SEARCH":{let t=n;return null===t&&(t=""),Object(u.a)(Object(u.a)({},e),{},{name_search:t})}case"UPDATE_ALL_DATA":return Object(u.a)({},n);case"RESET":return Object(u.a)({},hs);default:return Object(u.a)({},e)}}function ys({children:e}){const t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],c=a[1],i=Object(n.useReducer)(_s,hs),s=Object(o.a)(i,2),m=s[0],d=s[1];Object(n.useEffect)(()=>(gs(e=>c(e)),()=>{Es()}),[]);const u={contacts:r,search_state:m,search_dispatch:d};return l.a.createElement(fs.Provider,{value:u},e)}var vs=l.a.memo((function(e){const t=e.open,a=e.setSaveContactModal,r=e.mobileDetails,c=r.sim_num,s=r.mobile_id,m={emails:[],ewi_recipient:[],ewi_restriction:[],landline_numbers:[],first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0,organizations:[],status:0,mobile_numbers:[{mobile_number:{sim_num:c,mobile_id:s},priority:0,status:1}]},d=Object(n.useContext)(fs).contacts,u=Object(n.useState)("existing"),b=Object(o.a)(u,2),g=b[0],E=b[1],f=Object(n.useState)(!0),h=Object(o.a)(f,2),_=h[0],v=h[1],O=Object(n.useState)(null),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(n.useState)(!0),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(i.b)().enqueueSnackbar,I=d.map(e=>{const t=e.user_id,a=e.first_name,n=e.last_name;return{label:"".concat(a," ").concat(n),value:t,data:e}}),M=()=>{a(!1)};return l.a.createElement(lt.a,{open:t,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Save mobile number (+".concat(c,")")),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Choose whether to add number to an existing contact or fill-out a new contact form."),l.a.createElement(ot.a,{component:"fieldset",style:{display:"flex",marginBottom:16}},l.a.createElement(st.a,{"aria-label":"save-number-options",name:"save-number-options",row:!0,style:{justifyContent:"space-around"},value:g,onChange:e=>E(e.target.value)},l.a.createElement(mt.a,{value:"existing",control:l.a.createElement(dt.a,null),label:"Add to existing contact"}),l.a.createElement(mt.a,{value:"new",control:l.a.createElement(dt.a,null),label:"Create new contact"}))),"existing"===g&&l.a.createElement(y.a,{container:!0,spacing:2,style:{marginBottom:200}},l.a.createElement(y.a,{item:!0,xs:8},l.a.createElement(oa,{label:"Contact Person",options:I,value:j,changeHandler:e=>k(e),placeholder:"Type name of contact person",openMenuOnClick:!1,renderDropdownIndicator:!1,isClearable:!0})),l.a.createElement(y.a,{item:!0,xs:4},l.a.createElement(Ke.a,{title:"Inactive numbers will not receive EWI if a contact is an EWI recipient.",arrow:!0},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:w,onChange:e=>D(e.target.checked),name:"is_active",color:"primary"}),label:"Set as active"})))),"new"===g&&l.a.createElement(ds,{setContactForm:e=>{v(!1)},chosenContact:m,isEditMode:_,setContactFormForEdit:e=>{v(e)},handleClose:M,isFromChatterbox:!0})),"existing"===g&&l.a.createElement(ut.a,null,l.a.createElement(p.a,{variant:"text",onClick:()=>{!function(e,t){const a="".concat(ee.b,"/api/contacts/attach_mobile_number_to_existing_user");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}({user_id:j.value,mobile_id:s,status:w?1:0},e=>{const t=e.status,a=e.message;let n;!0===t?(M(),n="success"):n="error",A(a,{variant:n,autoHideDuration:4e3})})},color:"secondary"},"Save"),l.a.createElement(p.a,{variant:"text",onClick:M,color:"primary"},"Cancel")))}));const Os=Object(O.a)(e=>({inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}));function xs(e,t){const a=[];let n=[];return e.forEach(t=>{const l=t.user,r=t.status,c=l.first_name,i=l.last_name,o=l.organizations,s="".concat(c," ").concat(i),m=re(o);1===e.length&&(n=[...m]);let d=s,u=null;m.length>0&&(d="".concat(m[0].toUpperCase(),": ").concat(m.slice(1).join(", ")),u=m[0]),a.push({sender:s,org:d,level:u,inactive:!r})}),{sender_arr:a,orgs_arr:n}}function js(e,t){const a=t.sms_msg,n=t.ts,r=t.source,c=t.send_status,i=t.ts_sent,o=function(e){const t=X()(e);return t.isSame(X()(),"day")?t.format("HH:mm"):t.format("MMM D")}(n);return l.a.createElement(y.a,{container:!0,justify:"space-between",spacing:0},l.a.createElement(y.a,{item:!0,xs:1,style:{flexBasis:0,marginRight:6}},"inbox"===r?l.a.createElement(qo.a,{fontSize:"small"}):l.a.createElement(Q.a,{fontSize:"small"})),l.a.createElement(y.a,{item:!0,xs:!0,className:e.overflowEllipsis},a),l.a.createElement(y.a,{item:!0,style:{marginRight:8},className:e.noFlexGrow},o),l.a.createElement(y.a,{item:!0,style:{paddingTop:2,marginRight:8}},(0===c||null===c&&null!==i)&&l.a.createElement(Vo.a,{className:e.sentIcon}),c>0&&c<=5&&l.a.createElement(ha.a,{color:"primary",className:e.sentIcon}),(-1===c||c>5)&&l.a.createElement(Qo.a,{color:"error",className:e.sentIcon})))}var ks=function(e){const t=e.messagesArr,a=e.hidden,r=Os(),c=Object(u.a)(Object(u.a)({},e),{},{classes:r}),i=l.a.useState(!1),m=Object(o.a)(i,2),d=m[0],p=m[1],b=l.a.useState(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],_=l.a.useState(!1),O=Object(o.a)(_,2),x=O[0],j=O[1],k=l.a.useState(!1),S=Object(o.a)(k,2),C=S[0],w=S[1],D=l.a.useState({}),A=Object(o.a)(D,2),I=A[0],M=A[1],T=(e,t)=>{f(e),M(t),p(!0)};return l.a.createElement(n.Fragment,null,0===t.length?l.a.createElement(h.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?r.hidden:""},l.a.createElement("div",null,"No conversations")):l.a.createElement(kn.a,{dense:!0,className:a?r.hidden:""},t.map((e,t)=>function(e,t,a,r){const c=e.messages,i=e.mobile_details,m=t.classes,d=t.url,p=t.width,b=t.async,g=t.is_desktop,E=t.searchFilters,f=i.mobile_id,h=i.sim_num,_=i.users,O=ie(h);let x=[{sender:O,org:O,inactive:!1}],j=[];const k=0===_.length;if(!k){const e=xs(_),t=e.sender_arr,a=e.orgs_arr;x=t,j=a}let S=null;if("undefined"!==typeof E&&(S=Object(u.a)({},E),c.length>0)){const e=Object(o.a)(c,1)[0],t=e.is_per_convo,a=e.ts;t&&(S.ts_end=a)}const C=E?"No conversations":"No conversation yet",w=l.a.createElement(Zo.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return l.a.createElement(s.b,{to:{pathname:"".concat(d,"/").concat(f),state:{async:b,search_filters:S,test:"data"}},key:"".concat(r,"-").concat(f),className:m.link},l.a.createElement(Cn.a,{alignItems:"center",button:!0},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,{alt:"User",src:Jo.a,className:m.bigAvatar})),l.a.createElement(wn.a,{primary:l.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:!0,className:m.noFlexGrow},l.a.createElement(v.a,{variant:"body1",className:m.overflowEllipsis,component:"div",style:{display:"flex",alignItems:"center"}},x.map((e,t)=>l.a.createElement(n.Fragment,{key:"".concat(e.sender,"-").concat(f)},x.length>1&&e.inactive&&w,l.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<x.length-1&&","))))),j.map((e,t)=>{const a=0===t?"secondary":"primary";return l.a.createElement(y.a,{key:t,item:!0,xs:!0,className:m.noFlexGrow},l.a.createElement(Kt.a,{color:a,size:"small",label:e}))}),l.a.createElement(y.a,{item:!0,xs:6,sm:!0,container:!0,justify:Object(Se.c)("sm",p)?"flex-end":"flex-start",alignItems:"center"},1===x.length&&x[0].inactive&&w,l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},O)),l.a.createElement(y.a,{item:!0,xs:!0,style:{textAlign:"right",flexGrow:g?0:1,flexBasis:"auto"}},l.a.createElement(Y.a,{size:"small",onClick:e=>{e.preventDefault(),a(k,i)}},l.a.createElement(Pt.a,null)))),primaryTypographyProps:{className:m.overflowEllipsis},secondary:c.length>0?js(m,c[0]):l.a.createElement("div",{style:{textAlign:"center"}},C),secondaryTypographyProps:{component:"div"}})))}(e,c,T,t))),l.a.createElement($o,{open:d,onClose:e=>{p(!1)},isUnregistered:E,setBlockModal:j,setSaveContactModal:w}),l.a.createElement(es,{open:x,setBlockModal:j,mobileDetails:I,setOpenOptions:p}),l.a.createElement(vs,{open:C,setSaveContactModal:w,mobileDetails:I,setOpenOptions:p}))},Ss=a(1183),Cs=a(1184),ws=a(1181),Ds=a(1182);const As=Object(O.a)(e=>Object(fe.d)(e));var Is=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.closeHandler,c=e.tagOption,i=e.isMobile,s=e.tagObject,m=e.mobileDetails,d=e.message,u=As(),b=function(e){const t=Object(n.useState)([]),a=Object(o.a)(t,2),l=a[0],r=a[1],c=ae.a.CancelToken.source();return Object(n.useEffect)(()=>{const t="".concat(ee.b,"/api/chatterbox/get_message_tag_options/sms").concat(e,"_users");ae.a.get(t,{cancelToken:c.token}).then(({data:e})=>{const t=e.map(e=>({value:e.tag_id,label:e.tag}));r(t)}).catch(e=>{console.log(e)})},[e]),l}(c),g=Object(n.useState)(null),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)([]),y=Object(o.a)(_,2),v=y[0],O=y[1],x=Object(n.useState)(!1),k=Object(o.a)(x,2),S=k[0],C=k[1],w=Object(n.useState)(!1),D=Object(o.a)(w,2),A=D[0],I=D[1],M=Object(n.useState)(null),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(""),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(n.useState)(""),F=Object(o.a)(L,2),U=F[0],z=F[1],W=m.users.length>0;Object(n.useEffect)(()=>{let e=!1,t=!1;null!==f&&(e=f.some(e=>"#AlertFYI"===e.label),t=f.some(e=>"#Permission"===e.label),e?t=!1:t&&(e=!1)),C(e),I(t)},[f]);const G=Object(n.useState)(!1),q=Object(o.a)(G,2),V=q[0],Q=q[1];return Object(n.useEffect)(()=>{let e=!1;W?(S&&(null!==N&&""!==B||(e=!0)),A&&(null!==N&&""!==U||(e=!0))):e=!0,Q(e)},[S,N,B,A,U]),Object(n.useEffect)(()=>{const e=s.tags.map(e=>({value:e.tag_id,label:e.tag.tag}));h(e),O(e)},[s]),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Chatterbox Message Tagging"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Attach or remove tags to a message."),l.a.createElement(it.a,{className:u.dyna_error},"NOTE: You must manually remove any site logs created (if any) by a tag when removing a tag to a message."),l.a.createElement("div",{style:{margin:"24px 0"}},l.a.createElement(oa,{label:"Tags",options:b,value:f,changeHandler:e=>h(e),placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),S&&l.a.createElement(n.Fragment,null,l.a.createElement(it.a,{color:"textPrimary"},"Alert FYI"),l.a.createElement(ua,{value:N,changeHandler:e=>Y(e),isMulti:!0,required:!0}),l.a.createElement(Ea.a,{component:"legend",style:{marginTop:24}},"Purpose"),l.a.createElement(st.a,{"aria-label":"fyi-purpose",name:"fyi-purpose",row:!0,style:{justifyContent:"space-around"},value:B,onChange:e=>P(e.target.value)},l.a.createElement(mt.a,{value:"alert raising",control:l.a.createElement(dt.a,null),label:"Alert raising"}),l.a.createElement(mt.a,{value:"alert lowering",control:l.a.createElement(dt.a,null),label:"Alert lowering"}))),A&&l.a.createElement(n.Fragment,null,l.a.createElement(it.a,{color:"textPrimary"},"Permission"),l.a.createElement(ua,{value:N,changeHandler:e=>Y(e),isMulti:!0,required:!0}),l.a.createElement(Ea.a,{component:"legend",style:{marginTop:24}},"Purpose"),l.a.createElement(st.a,{"aria-label":"permission-purpose",name:"permission-purpose",row:!0,style:{justifyContent:"space-around"},value:U,onChange:e=>z(e.target.value)},l.a.createElement(mt.a,{value:"alert raising",control:l.a.createElement(dt.a,null),label:"Alert raising"}),l.a.createElement(mt.a,{value:"alert lowering",control:l.a.createElement(dt.a,null),label:"Alert lowering"}),l.a.createElement(mt.a,{value:"alert 3 raising",control:l.a.createElement(dt.a,null),label:"Alert 3 raising"}),l.a.createElement(mt.a,{value:"on demand alert",control:l.a.createElement(dt.a,null),label:"On demand alert"}))),!i&&l.a.createElement("div",{style:{height:240}})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{color:"primary",onClick:()=>{const e=s.id,t=s.source,a=s.ts;let n=null,l=[];W&&!S?(m.users.forEach(e=>{e.user.organizations.forEach(e=>{const t=e.site.site_id;!l.includes(t)&&l.push(t)})}),n=function(e){const t=e.sim_num,a=e.users;let n=t;if(a.length>0){const e=xs(a).sender_arr,t=[];e.forEach(e=>{const a=e.sender,n=e.level;if(!e.inactive){const e=null!==n?"".concat(n," "):"";t.push("".concat(e).concat(a))}}),t.length>0&&(n=t.join(", ")),t.length>1&&(n+="(shared number)")}return n}(m)):S&&(l=N.map(e=>e.value));const c="inbox"===t?"inbox_id":"outbox_id";let i=[];if(v.length>0&&(i=null===f?[...v]:v.filter(e=>!f.some(t=>t.value===e.value))),i.length>0){const a=i.map(e=>e.value),n={tag_type:"sms".concat(t,"_user_tags"),tag_details:{[c]:e,delete_tag_id_list:a}};console.log("delete_payload",n),o=n,u=e=>{console.log("untag response",e)},se("".concat(ee.b,"/api/general_data_tag/handle_delete_tags"),o,u)}var o,u;let p=[];var b;if(null!==f&&(p=f.filter((b=0,e=>e!==v[b]||!++b))),p.length>null){const r=p.map(e=>e.value);let i=d;S?i=B:A&&(i=U);const o={tag_type:"sms".concat(t,"_user_tags"),contact_person:n,message:i,tag_details:{user_id:Object(j.a)().user_id,[c]:e,tag_id_list:r,site_id_list:l,ts:X()().format("YYYY-MM-DD HH:mm:ss"),ts_message:a}};console.log("PAYLOAD",o),console.log(f),function(e,t){se("".concat(ee.b,"/api/general_data_tag/handle_update_insert_tags"),e,t)}(o,e=>{console.log("tag response",e)})}r()},disabled:V},"Submit"),l.a.createElement(p.a,{onClick:r},"Cancel")))}));const Ms=Object(O.a)(e=>({root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"},chatItemSent:{justifyContent:"flex-end"},chatBubble:{flexGrow:0,maxWidth:"65%",[e.breakpoints.down("xs")]:{maxWidth:"75%"},[e.breakpoints.up("md")]:{maxWidth:"50%"},paddingLeft:"12px !important",paddingRight:12,paddingTop:12,paddingBottom:6,border:"solid 1px rgba(215, 215, 215, 1)",backgroundColor:"rgba(245, 245, 245, 1)"},chatBubbleReceived:{marginLeft:14,"&:before":{content:"''",left:69,right:"auto",top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:71.5,right:"auto",top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatBubbleSent:{marginRight:14,"&:before":{content:"''",left:"auto",right:69,top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:"auto",right:71.5,top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatMessage:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",fontSize:"0.75rem",lineHeight:"1.25em"},timestampArea:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:12},timestamp:{fontSize:"0.65rem"},tagButton:{padding:0,zIndex:1},sentIcon:{fontSize:"1rem"}}));const Ts=Object(O.a)(e=>{return{arrow:{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}},popper:(t=e.palette.common.black,{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(t," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(t," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(t," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(t)}}}),tooltip:{position:"relative",backgroundColor:e.palette.common.black},tooltipPlacementLeft:{margin:"0 8px"},tooltipPlacementRight:{margin:"0 8px"},tooltipPlacementTop:{margin:"8px 0"},tooltipPlacementBottom:{margin:"8px 0"}};var t});function Ns(e){const t=Ts(),a=t.arrow,n=Object(Qt.a)(t,["arrow"]),r=l.a.useState(null),c=Object(o.a)(r,2),i=c[0],s=c[1],m=e.title;return l.a.createElement(Ke.a,Object.assign({classes:n,PopperProps:{popperOptions:{modifiers:{arrow:{enabled:Boolean(i),element:i}}}}},e,{title:l.a.createElement(l.a.Fragment,null,m,l.a.createElement("span",{className:a,ref:s}))}))}var Ys=function(e){const t=e.message_list,a=e.mobileDetails,r=e.searchFilters,c=e.setScrollToBottom,i=Ms(),s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],u=m[1],b=Object(n.useState)(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),y=_[0],O=_[1],j={id:"",source:"",tags:[]},k=Object(n.useState)(j),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)(1),A=Object(o.a)(D,2),I=A[0],M=A[1],T=Object(n.useState)([]),N=Object(o.a)(T,2),R=N[0],H=N[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1];Object(n.useEffect)(()=>{const e=t.slice(0).reverse();u(e),H(e),c(!0)},[t,c]);const U=(e,t=j,a)=>()=>{w(t),f(e),O(a)},z=e=>{const t=e.convo_id,a=d.map(e=>(e.convo_id===t&&(e.send_status=0),e));u(a),function(e,t){const a="".concat(ee.b,"/api/chatterbox/resend_message/").concat(e);ae.a.get(a).then(e=>{const a=e.data;console.log("Resend message",a),"undefined"!==typeof t&&t(a)}).catch(e=>{console.error(e)})}(t)},W=r?"No conversations":"No conversation yet";return l.a.createElement(n.Fragment,null,0===t.length&&l.a.createElement(v.a,{variant:"subtitle1",align:"center",style:{marginTop:8}},W),R.length>=20&&l.a.createElement(p.a,{color:"primary",size:"small",fullWidth:!0,onClick:()=>{const e=a.mobile_id;F(!0),function(e,t,a){const n="".concat(ee.b,"/api/chatterbox/load_more_messages/").concat(e,"/").concat(t);ae.a.get(n).then(e=>{const t=e.data;console.log("Additional loaded messages",t),a(t)}).catch(e=>{console.error(e)})}(e,I,e=>{F(!1),H(e);const t=e.slice(0).reverse();u(t.concat(d))}),M(I+1)},endIcon:L&&l.a.createElement(x.a,{size:"1.5rem"})},l.a.createElement("strong",null,"Load",L&&"ing"," more messages...")),l.a.createElement(kn.a,{className:i.root},d.map(e=>function(e,t,a,r){const c=t.convo_id,i=t.source,s=t.sms_msg,m=t.ts,d=t.ts_sent,u=t.send_status,p=t.tags,b={tags:p,source:i,id:t["".concat(i,"_id")],ts:m},g="outbox"===i,E=X()(m).format("M/D/YYYY HH:mm:ss"),f=l.a.createElement(Wo.a,{style:{textAlign:"-webkit-center"}},l.a.createElement(Go.a,{alt:"Remy Sharp",src:Jo.a})),h=p.length>0,_=h?l.a.createElement(ws.a,{fontSize:"small",color:"primary"}):l.a.createElement(Ds.a,{fontSize:"small",color:"primary"}),y=p.map(e=>e.tag.tag).join(", ");let O=[f,l.a.createElement(wn.a,{className:"".concat(e.chatBubble," ").concat(g?e.chatBubbleSent:e.chatBubbleReceived),primary:l.a.createElement(v.a,{component:"span",className:e.chatMessage,variant:"body2",color:"textPrimary"},l.a.createElement("span",{style:{paddingRight:6,zIndex:1}},s),l.a.createElement(Ns,{disableFocusListener:!0,disableHoverListener:!h,title:y},l.a.createElement(Y.a,{className:e.tagButton,onClick:a(!0,b,s)},_))),secondary:l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:e.timestamp,style:{paddingRight:g?6:0}},E),u>=0&&u<5&&null!==u&&l.a.createElement(Ns,{disableFocusListener:!0,title:"SENDING"},l.a.createElement(Vo.a,{className:e.sentIcon})),5===u&&l.a.createElement(Ns,{disableFocusListener:!0,title:"SENT: ".concat(X()(d).format("M/D/YYYY HH:mm:ss"))},l.a.createElement(ha.a,{color:"primary",className:e.sentIcon})),(-1===u||u>5)&&l.a.createElement(n.Fragment,null,l.a.createElement(Ns,{disableFocusListener:!0,title:"UNSENT"},l.a.createElement(Qo.a,{color:"error",className:e.sentIcon})),l.a.createElement(Ns,{disableFocusListener:!0,title:"Resend"},l.a.createElement(Ul.a,{color:"action",className:e.sentIcon,onClick:()=>r(t)})))),secondaryTypographyProps:{component:"div",className:e.timestampArea}})];g&&(O=O.reverse());const x=O,j=Object(o.a)(x,2),k=j[0],S=j[1];return l.a.createElement(Cn.a,{alignItems:"flex-start",className:g?e.chatItemSent:"",key:c},k,S)}(i,e,U,z))),l.a.createElement(Is,{isOpen:E,closeHandler:U(!1),tagOption:C.source,tagObject:C,mobileDetails:a,message:y}))};const Rs=Object(O.a)(e=>{const t=Object(fe.d)(e);return{regularContainer:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(u.a)({},t.pageContentMargin),divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),sticky:{position:"sticky",top:56,[e.breakpoints.up("sm")]:{top:63},[e.breakpoints.up("md")]:{top:118},backgroundColor:"white",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",zIndex:3},chatHead:{paddingLeft:8,[e.breakpoints.up("md")]:{paddingLeft:0},display:"flex",alignItems:"center"},backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40},noFlexGrow:{flexGrow:0}}}),Hs=()=>l.a.createElement(Qe.a,{height:70,width:800,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 800 70",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},l.a.createElement("rect",{x:"69",y:"7",rx:"4",ry:"4",width:"663",height:"19"}),l.a.createElement("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"293",height:"14"}),l.a.createElement("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"201",height:"6"}),l.a.createElement("circle",{cx:"30",cy:"30",r:"30"})),Bs=e=>l.a.createElement(Qe.a,{height:160,width:446,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"3 0 446 160",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},l.a.createElement("circle",{cx:"19",cy:"25",r:"16"}),l.a.createElement("rect",{x:"40",y:"12",rx:"5",ry:"5",width:"220",height:"10"}),l.a.createElement("rect",{x:"40",y:"29",rx:"5",ry:"5",width:"220",height:"10"}),l.a.createElement("circle",{cx:"420",cy:"71",r:"16"}),l.a.createElement("rect",{x:"179",y:"76",rx:"5",ry:"5",width:"220",height:"10"}),l.a.createElement("rect",{x:"179",y:"58",rx:"5",ry:"5",width:"220",height:"10"}),l.a.createElement("circle",{cx:"21",cy:"117",r:"16"}),l.a.createElement("rect",{x:"45",y:"104",rx:"5",ry:"5",width:"220",height:"10"}),l.a.createElement("rect",{x:"45",y:"122",rx:"5",ry:"5",width:"220",height:"10"}));function Ps(e){const t=e.mobile_details,a=e.classes,r=e.saveNumberModal,c=e.searchFilters,i=t.users,s=ie(t.sim_num),m=Object(n.useState)(null),d=Object(o.a)(m,2),u=d[0],p=d[1];let b=[{sender:s,org:s,inactive:!1}],g=[];const E=0===i.length;if(!E){const e=xs(i),t=e.sender_arr,a=e.orgs_arr;b=t,g=a}const f=l.a.createElement(Zo.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return l.a.createElement(y.a,{container:!0,alignItems:"center"},l.a.createElement("div",{style:{marginRight:12}},l.a.createElement(Go.a,{alt:"User",src:Jo.a,className:a.bigAvatar})),l.a.createElement("div",null,l.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:!0},l.a.createElement(v.a,{variant:"body1",component:"div",style:{display:"flex",alignItems:"center"}},b.map((e,t)=>l.a.createElement(n.Fragment,{key:e.sender},b.length>1&&e.inactive&&f,l.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<b.length-1&&","))))),g.map((e,t)=>{const n=0===t?"secondary":"primary";return l.a.createElement(y.a,{key:t,item:!0,xs:!0,className:a.noFlexGrow},l.a.createElement(Kt.a,{color:n,size:"small",label:e}))})),!E&&l.a.createElement(y.a,{container:!0,alignItems:"center"},1===b.length&&b[0].inactive&&f,l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},s))),l.a.createElement(_.a,{ml:1,flex:"display"},c&&l.a.createElement(Ke.a,{title:"Filters enabled",arrow:!0},l.a.createElement(Ss.a,{color:"primary"}))),E&&l.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},l.a.createElement(Y.a,{size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{p(e.currentTarget)}},l.a.createElement(Pt.a,null)),l.a.createElement(H.a,{id:"simple-menu",anchorEl:u,getContentAnchorEl:null,keepMounted:!0,open:Boolean(u),onClose:()=>{p(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},l.a.createElement(B.a,{style:{fontSize:12},key:"save_unknown",onClick:()=>{p(null),r()}},"Save unknown number"))))}const Ls=e=>t=>{t.preventDefault(),e.goBack()};var Fs=function(e){const t=e.history,a=e.match.params.mobile_id,r=e.location.state,c=e.socket;let s=null;if("undefined"!==typeof r){const e=r.search_filters;s=e}const m=Rs(),d=Object(j.a)(),u=Object(i.b)(),b=u.enqueueSnackbar,g=u.closeSnackbar,E=Object(n.useState)(!1),f=Object(o.a)(E,2),h=f[0],_=f[1],y=Object(n.useState)({message_list:null,mobile_details:{}}),v=Object(o.a)(y,2),O=v[0],x=v[1],k=Object(n.useState)(""),S=Object(o.a)(k,2),C=S[0],w=S[1];Object(n.useEffect)(()=>{var e;return"undefined"!==typeof c&&(c.emit("join_mobile_id_room",{mobile_id:a,search_filters:s}),e=e=>{const t=e.mobile_details,a=e.messages;x({mobile_details:t,message_list:a})},ps(),us.on("receive_mobile_id_room_update",t=>{console.log("Mobile ID Room Update",t),e(t)})),()=>{"undefined"!==typeof c&&(c.emit("leave_mobile_id_room",a),us.removeListener("receive_mobile_id_room_update"))}},[c,a,s]);const D=O.mobile_details,A=O.message_list,I=e=>l.a.createElement(p.a,{color:"primary",onClick:()=>{g(e)}},"Dismiss"),M=Object(n.useRef)(null),T=Object(n.useState)(!1),N=Object(o.a)(T,2),R=N[0],H=N[1];return Object(n.useEffect)(()=>{M.current.scrollIntoView()},[R]),l.a.createElement(n.Fragment,null,null==A?l.a.createElement("div",{className:m.regularContainer,style:{paddingLeft:16,paddingBottom:0}},l.a.createElement(Hs,null)):l.a.createElement("div",{className:"".concat(m.regularContainer," ").concat(m.sticky)},l.a.createElement("div",{className:m.chatHead},l.a.createElement(Y.a,{"aria-label":"Back",color:"primary",className:m.backButton,onClick:Ls(t)},l.a.createElement(Cs.a,{className:m.backIcon})),l.a.createElement(Ps,{mobile_details:D,classes:m,saveNumberModal:()=>{_(!0)},searchFilters:s}))),l.a.createElement("div",{className:m.regularContainer},null===A?l.a.createElement("div",{style:{padding:"0 16px"}},l.a.createElement(Bs,{style:{height:"100%"}})):l.a.createElement(Ys,{message_list:A,searchFilters:s,mobileDetails:D,setScrollToBottom:H})),null!==A&&l.a.createElement(n.Fragment,null,l.a.createElement(V.a,{className:m.divider}),l.a.createElement("div",{className:m.chatInputContainer},l.a.createElement(ga,{value:C,disableSend:""===C,setComposedMessage:w,messageChangeHandler:e=>w(e.target.value),sendButtonClickHandler:()=>{const e=D.mobile_id,t=D.gsm_id;Wt({sms_msg:"".concat(C," - ").concat(d.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:[{mobile_id:e,gsm_id:t}]},e=>{e.status?(b("EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:I}),w("")):b(e.message,{variant:"error",autoHideDuration:7e3,action:I})},()=>{b("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:I})})}}))),l.a.createElement("div",{style:{float:"left",clear:"both"},ref:M}),l.a.createElement(vs,{open:h,setSaveContactModal:_,mobileDetails:D}))};const Us=Object(O.a)(e=>({dialogContent:{"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}}}));var zs=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,r=e.recipientsList,c=Us();return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},l.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},l.a.createElement("span",null,"Send a Message"),l.a.createElement(Y.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},l.a.createElement(Rt.a,null)))),l.a.createElement(ct.a,{className:c.dialogContent},l.a.createElement(it.a,null,"Choose your recipients and compose a message, then send it."),l.a.createElement("div",{style:{marginTop:20}},l.a.createElement(xa,{isMobile:t,textboxValue:"",recipientsList:r,modalStateHandler:a}))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),Ws=a(1077),Gs=a(626),qs=a(345),Vs=a.n(qs),Qs=a(605);var Zs=Object(Qs.a)(Object(d.a)(e=>({fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:1}})),Object(Se.a)())((function(e){const t=e.classes,a=e.clickHandler,n=e.width;return l.a.createElement(Ws.a,{in:!0,unmountOnExit:!0,style:{transitionDelay:"100ms"}},l.a.createElement(Gs.a,{color:"secondary","aria-label":"Add",className:t.fab,size:Object(Se.c)("md",n)?"large":"medium",onClick:a},l.a.createElement(Vs.a,null)))}));var Ks=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,r=e.setSearchResultsToEmpty,c=e.modalState,i=e.url,m=e.tagList,d=e.recipientsList,u=Object(n.useContext)(sa).organizations,b=Object(n.useContext)(fs),E=b.search_state,f=b.search_dispatch,h=E.sites,_=E.orgs,O=E.only_ewi_recipients,x=E.include_inactive_numbers,j=E.ts_start,k=E.ts_end,S=E.string_search,C=E.tag_search,w=E.mobile_number_search,D=E.name_search,A=Object(n.useState)([]),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1];Object(n.useEffect)(()=>{const e=u.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}});T(e)},[u]);const B=Object(n.useState)(!0),P=Object(o.a)(B,2),L=P[0],F=P[1],U=h.length>0||_.length>0,z=[j,k].every(e=>null===e),W=[j,k].every(e=>null!==e)||z;return Object(n.useEffect)(()=>{let e=!0;U?W&&(e=!1):W&&!z&&(e=!1),(w||D||S||C.label)&&(e=!1),F(e)},[h,_,j,k,w,D,S,C,z,W,U]),Object(n.useEffect)(()=>{if("undefined"!==typeof d){const e=d.map(e=>{const t=e.label,a=e.mobile_id,n=e.org,l=e.sim_num;let r=t;""!==n&&(r="".concat(t," (").concat(n,")")),r+=" - ".concat(l);return{label:r,chipLabel:"".concat(t," - ").concat(l),value:a,sim_num:l,data:e}});H(e)}},[d]),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:c,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},"Search Chatterbox"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Fill in at least one field from any of the filters. NOTE: the broader the search filters, the longer the query might run."),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(v.a,{variant:"subtitle1",component:y.a,item:!0,xs:12},"CONTACT FILTERS"),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ua,{value:h,changeHandler:e=>f({type:"UPDATE_SITES",value:e}),isMulti:!0,disabled:Boolean(w||D)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(oa,{label:"Organization(s)",options:M,value:_,changeHandler:e=>f({type:"UPDATE_ORGS",value:e}),placeholder:"Select organization(s)",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0,isDisabled:Boolean(w||D)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(oa,{label:"Saved Contact",options:R,value:D,changeHandler:e=>f({type:"UPDATE_NAME_SEARCH",value:e}),placeholder:"Select contact",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0,isDisabled:Boolean(U||w)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{id:"mobile-number-filter",label:"Mobile Number",type:"number",value:w,onChange:e=>f({type:"UPDATE_MOBILE_NUMBER_SEARCH",value:e.target.value}),placeholder:"Start number entry with 639 or enter last four digits",InputLabelProps:{shrink:!0},disabled:Boolean(U||D)}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(v.a,{variant:"subtitle1",component:y.a,item:!0,xs:12},"MESSAGE FILTERS"),l.a.createElement(v.a,{variant:"subtitle2",component:y.a,item:!0,xs:12},"Note: Date filters required for tag and string search."),l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(Ut.b,{autoOk:!0,label:"Start Date/Time",value:j,onChange:e=>f({type:"UPDATE_TS_START",value:e}),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null===j&&null!==k,helperText:null===j&&null!==k&&"Both date/time must have values"})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(Ut.b,{autoOk:!0,label:"End Date/Time",value:k,onChange:e=>f({type:"UPDATE_TS_END",value:e}),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null!==j&&null===k,helperText:null!==j&&null===k&&"Both date/time must have values"}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{id:"string-filter",label:"String",value:S,onChange:e=>f({type:"UPDATE_STRING_SEARCH",value:e.target.value}),placeholder:"Enter string",InputLabelProps:{shrink:!0},disabled:z}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(oa,{label:"Tags",options:m,value:C,changeHandler:e=>f({type:"UPDATE_TAG_SEARCH",value:e}),placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isDisabled:z,isClearable:!0})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),!L&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:O,onChange:e=>f({type:"UPDATE_ONLY_EWI_RECIPIENTS",value:e.target.checked}),name:"onlyEWIRecipients"}),label:"Only EWI recipients"})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:x,onChange:e=>f({type:"UPDATE_INCLUDE_INACTIVE_NUMBERS",value:e.target.checked}),name:"includeInactiveNumbers"}),label:"Include inactive numbers"}))))),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:a},"Cancel"),l.a.createElement(p.a,{onClick:()=>f({type:"RESET"})},"RESET"),l.a.createElement(p.a,{onClick:()=>{a(),r()},color:"secondary",disabled:L,component:s.b,to:{pathname:"".concat(i,"/search_results"),state:{sites:h,organizations:_,only_ewi_recipients:O,include_inactive_numbers:x,ts_start:j?X()(j).format("YYYY-MM-DD HH:mm:ss"):j,ts_end:k?X()(k).format("YYYY-MM-DD HH:mm:ss"):k,string_search:S,tag_search:C,mobile_number_search:w,name_search:D}}},"Search")))})),Js=a(1185),Xs=a(1186);const $s=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{regularContainer:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(u.a)({},t.pageContentMargin),divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40}})}),em=e=>t=>{t.preventDefault(),e.goBack()};function tm(e){const t=e.width,a=e.history;return Object(Se.b)(t,"sm")?l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:em(a),startIcon:l.a.createElement(Nc.a,null)},"Back to conversation list"):l.a.createElement(Y.a,{variant:"contained",color:"primary",size:"small",onClick:em(a)},l.a.createElement(Nc.a,null))}var am=function(e){const t=e.location,a=e.socket,r=e.width,c=e.url,i=e.is_desktop,s=e.searchResults,m=e.setSearchResults,d=e.ListLoader,u=$s(),b=t.state,g=b.sites,E=b.organizations,f=b.only_ewi_recipients,h=b.include_inactive_numbers,O=b.ts_start,x=b.ts_end,j=b.string_search,k=b.tag_search,S=b.mobile_number_search,C=b.name_search,w=Object(n.useState)(!1),D=Object(o.a)(w,2),A=D[0],I=D[1],M=null===g&&null===E,T=""!==j||""!==k.value,N=Object(n.useState)(0),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1];return Object(n.useEffect)(()=>{const e=0===s.length;if(!M&&e||L){I(!0);const e={site_ids:g.map(e=>e.value),org_ids:E.map(e=>e.value),only_ewi_recipients:f,include_inactive_numbers:h,ts_start:O,ts_end:x,string_search:j,tag_search:k,mobile_number_search:S,name_search:C,updated_offset:R};"undefined"!==typeof a&&(a.emit("get_search_results",e),t=e=>{I(!1),m(e),F(!1)},us.on("receive_search_results",e=>{console.log("Chatterbox Search Results",e),t(e)}))}var t;return()=>{"undefined"!==typeof a&&us.removeListener("receive_search_results")}},[a,g,E,O,x,R,L]),l.a.createElement("div",{className:u.pageContentMargin},l.a.createElement(ze,{title:"Communications | Chatterbox"}),l.a.createElement(y.a,{container:!0},l.a.createElement("div",null,l.a.createElement(tm,e)),l.a.createElement(Me.a,{smDown:!0},l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:12}})),l.a.createElement(v.a,{component:y.a,item:!0,xs:!0,variant:"h5"},"Search Results"),l.a.createElement(Me.a,{smUp:!0},l.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:8}}))),l.a.createElement(_.a,{display:"flex",flexWrap:"wrap"},0!==g.length&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Site(s):")," ",g.map(e=>e.data.site_code.toUpperCase()).join(", "))),0!==E.length&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Organizations(s):")," ",E.map(e=>e.label).join(", "))),O&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Start Date/Time: "),O)),x&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"End Date/Time: "),x)),j&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"String: "),j)),k.label&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Tag: "),k.label)),S&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Mobile Number: "),S)),0!==C.length&&l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Has name search"))),l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Only EWI Recipients:")," ",le(f.toString()))),l.a.createElement(_.a,{mr:2},l.a.createElement(v.a,{variant:"subtitle2"},l.a.createElement("strong",null,"Include Inactive Numbers:")," ",le(h.toString())))),l.a.createElement(V.a,{style:{marginTop:12}}),T&&!A&&l.a.createElement(_.a,{display:"flex",flexDirection:"row-reverse"},s.length>=20&&l.a.createElement(p.a,{size:"small",style:{margin:10},onClick:()=>{H(R+20),F(!0)},variant:"contained",color:"primary",endIcon:l.a.createElement(Js.a,null)},"Next"),R>0&&l.a.createElement(p.a,{size:"small",style:{margin:10},onClick:()=>{if(R>0){H(R-20),F(!0)}},variant:"contained",color:"primary",startIcon:l.a.createElement(Xs.a,null)},"Previous")),M&&l.a.createElement(v.a,{variant:"h6",align:"center"},l.a.createElement("strong",null,"No search input")),A?l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(d,null)):s.length>0?l.a.createElement(ks,{width:r,url:c,messagesArr:s,searchFilters:{ts_start:O,ts_end:x},hidden:!1,is_desktop:i}):l.a.createElement(v.a,{variant:"h6",align:"center",style:{paddingTop:"5em"}},l.a.createElement("strong",null,"No results found")))};const nm=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16}})}),lm=()=>l.a.createElement(Qe.a,{speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 600 400",style:{width:"100%"}},l.a.createElement("circle",{cx:"47",cy:"48",r:"26"}),l.a.createElement("rect",{x:"90",y:"36",rx:"0",ry:"0",width:"489",height:"29"}),l.a.createElement("circle",{cx:"47",cy:"108",r:"26"}),l.a.createElement("rect",{x:"90",y:"96",rx:"0",ry:"0",width:"489",height:"29"}),l.a.createElement("circle",{cx:"49",cy:"168",r:"26"}),l.a.createElement("rect",{x:"90",y:"156",rx:"0",ry:"0",width:"489",height:"29"}),l.a.createElement("circle",{cx:"49",cy:"228",r:"26"}),l.a.createElement("rect",{x:"90",y:"216",rx:"0",ry:"0",width:"489",height:"29"}),l.a.createElement("circle",{cx:"49",cy:"288",r:"26"}),l.a.createElement("rect",{x:"90",y:"276",rx:"0",ry:"0",width:"489",height:"29"}),l.a.createElement("circle",{cx:"49",cy:"348",r:"26"}),l.a.createElement("rect",{x:"90",y:"336",rx:"0",ry:"0",width:"489",height:"29"}));function rm(e){const t=e.modalState,a=e.modalStateHandler;return l.a.createElement(lt.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:t},l.a.createElement(rt.a,{id:"simple-dialog-title"},"Chatterbox Information"),l.a.createElement(ct.a,null,l.a.createElement(v.a,{variant:"h6",gutterBottom:!0,align:"center"},"Inbox"),l.a.createElement(v.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Inbox tab contains the list of our contacts who recently sent a message to our server. The first contact in the list is the most recent message sender, and so on.",l.a.createElement("br",null),l.a.createElement("br",null),"\u2003\u2003Unlike a regular message list on a messaging app, outbound messages to our contacts do not affect the order of the list nor the appearance of a contact on the list (because our server sends a lot of messages, especially when routine, that incoming messages might get unnoticed)."),l.a.createElement(V.a,{style:{margin:"8px 0"}}),l.a.createElement(v.a,{variant:"h6",gutterBottom:!0,align:"center"},"Unsent"),l.a.createElement(v.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Unsent tab displays conversation threads which contains unsent messages within one day span. Unsent messages refer to messages in the process of sending or messages with failed sending attempt.")))}var cm=Object(Se.a)()((function(e){const t=e.location,a=e.match.url,r=e.width,c=nm(),i=Object(n.useState)(0),s=Object(o.a)(i,2),d=s[0],u=s[1],b=Object(n.useState)(!1),g=Object(o.a)(b,2),E=g[0],f=g[1],h=Object(n.useState)(!1),_=Object(o.a)(h,2),y=_[0],v=_[1],O=Object(n.useState)({inbox:null,unsent:null}),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(n.useState)([{label:"Inbox",href:"inbox"},{label:"Unsent",href:"unsent"}]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)([]),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)([]),H=Object(o.a)(N,2),B=H[0],P=H[1],L=Object(n.useState)([]),F=Object(o.a)(L,2),U=F[0],z=F[1],W=Object(n.useState)(!1),G=Object(o.a)(W,2),q=G[0],V=G[1],Q=(e,t)=>()=>{"send"===e?f(t):"search"===e?v(t):"info"===e&&V(t)},Z=Object(n.useContext)(sa).setIsReconnecting;Object(n.useEffect)(()=>{bs(Z,"chatterbox")},[Z]),Object(n.useEffect)(()=>{var e;return e=e=>{k(e);const t=e.unsent.length;let a="Unsent";t>0&&(a=l.a.createElement(R.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:t,overlap:"rectangle"},"Unsent")),D(e=>[...e.slice(0,1),{label:a,href:"unsent"}])},ps(),us.on("receive_latest_messages",t=>{console.log("Latest messages",t),e(t)}),()=>{us.removeListener("receive_latest_messages")}},[]),Object(n.useEffect)(()=>{var e;return e=e=>{P(e)},ps(),us.on("receive_all_mobile_numbers",t=>{console.log("All Saved Mobile Numbers",t),e(t)}),()=>{us.removeListener("receive_all_mobile_numbers")}},[]),Object(n.useEffect)(()=>{!function(e){const t="".concat(ee.b,"/api/chatterbox/get_all_tags");ae.a.get(t).then(t=>{const a=t.data;console.log("All Tags",a),"undefined"!==typeof e&&e(a)}).catch(e=>{console.error(e)})}(e=>{const t=e.map(e=>({value:e.tag_id,label:e.tag,source:e.source}));z(t)})},[]);const K=Object(Se.c)("md",r),J=l.a.createElement("span",null,l.a.createElement(Y.a,{color:"primary","aria-label":"Chatterbox info",onClick:Q("info",!0)},l.a.createElement(Ll.a,{fontSize:"large"})),l.a.createElement(p.a,{"aria-label":"Compose message",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:Q("send",!0),startIcon:l.a.createElement(Uo.a,null)},"Compose"),l.a.createElement(p.a,{"aria-label":"Search messages",variant:"contained",color:"primary",size:"small",onClick:Q("search",!0),startIcon:l.a.createElement(zo.a,null)},"Search"));return l.a.createElement(ys,null,l.a.createElement(m.d,{location:t},l.a.createElement(m.b,{exact:!0,path:a,render:e=>l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:c.pageContentMargin},l.a.createElement(ze,{title:"Communications | Chatterbox",customButtons:!!K&&J})),l.a.createElement("div",{className:c.tabBar},l.a.createElement(Ve,{chosenTab:d,onSelect:e=>u(e),tabsArray:w})),l.a.createElement("div",{className:"".concat(c.tabBar," ").concat(c.tabBarContent)},null===j.inbox?l.a.createElement(lm,null):l.a.createElement(ks,{width:r,url:a,messagesArr:j.inbox,hidden:0!==d,is_desktop:K}),1===d&&(null===j.unsent?l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(lm,null)):l.a.createElement(ks,{width:r,url:a,messagesArr:j.unsent,hidden:1!==d,is_desktop:K}))),!K&&l.a.createElement(Zs,{clickHandler:Q("send",!0)}),l.a.createElement(zs,{modalStateHandler:Q("send",!1),modalState:E,recipientsList:B}),l.a.createElement(Ks,{modalStateHandler:Q("search",!1),modalState:y,setSearchResultsToEmpty:()=>T([]),url:a,recipientsList:B,tagList:U}),l.a.createElement(rm,{modalStateHandler:Q("info",!1),modalState:q}))}),l.a.createElement(m.b,{path:"".concat(a,"/search_results"),render:e=>l.a.createElement(am,Object.assign({},e,{messageCollection:j,socket:us,url:a,width:r,is_desktop:K,searchResults:M,setSearchResults:T,ListLoader:lm}))}),l.a.createElement(m.b,{path:"".concat(a,"/:mobile_id"),render:e=>l.a.createElement(Fs,Object.assign({},e,{messageCollection:j,socket:us}))})))})),im=a(1147),om=a(1075),sm=a(433),mm=a(1189),dm=a(1192),um=a(1193),pm=a(1194),bm=a(1195),gm=a(1196),Em=a(1197),fm=a(1198),hm=a(1199);const _m=l.a.memo(e=>{const t=e.classes,a=e.row,n=e.index,r=e.onContactClickFn,c=a.user_id,i=a.first_name,o=a.last_name,s=a.organizations,m=re(s),d=ce(s);return l.a.createElement(Cn.a,{button:!0,onClick:r(a,n),key:c},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(ts.a,null))),l.a.createElement(wn.a,{primary:l.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},l.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},l.a.createElement(v.a,{variant:"body1",style:{marginRight:8}},"".concat(o,", ").concat(i))),m.map((e,a)=>{const n=0===a,r=n?"secondary":"primary";return n&&d?l.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},l.a.createElement(Ke.a,{arrow:!0,disableFocusListener:!0,title:"Contact Priority",placement:"top"},l.a.createElement(Kt.a,{color:r,size:"small",label:e,icon:l.a.createElement(mm.a,{style:{color:"gold"}})}))):l.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},l.a.createElement(Kt.a,{color:r,size:"small",label:e}))}))}))});var ym=function(e){const t=e.contacts,a=e.onContactClickFn,n=e.classes;return l.a.createElement(kn.a,{dense:!0,style:{paddingTop:0}},t.map((e,t)=>l.a.createElement(_m,{row:e,index:t,onContactClickFn:a,classes:n,key:"list-".concat(t)})))};var vm=l.a.memo((function(e){const t=e.blocked_numbers,a=e.onBlockContactClickFn;return 0===t.length?l.a.createElement("div",null,"No blocked contact"):l.a.createElement(kn.a,{dense:!0,style:{paddingTop:0}},t.map(e=>{const t=e.mobile_number,n=t.mobile_id,r=t.sim_num;return l.a.createElement(Cn.a,{button:!0,onClick:a(e),key:n},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(Xo.a,null))),l.a.createElement(wn.a,{primary:l.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},l.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},l.a.createElement(v.a,{variant:"body1",style:{marginRight:8}},"+".concat(r))))}))}))}));function Om(e){const t=e.row,a=t.network,r=t.prefixes;return l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{variant:"h5",style:{marginBottom:12}},a),l.a.createElement(h.a,{style:{padding:"24px 16px"}},l.a.createElement(y.a,{container:!0,spacing:3},r.map(e=>l.a.createElement(v.a,{variant:"body1",component:y.a,item:!0,xs:2,align:"center",key:e},e)))))}var xm=l.a.memo((function(e){const t=function(e){const t=[],a=[];return e.forEach(e=>{const n=e.prefix,l=e.network_id,r="0".concat(n);1===l?a.push(r):t.push(r)}),[{network:"Globe",prefixes:a},{network:"Smart",prefixes:t}]}(e.sim_prefixes);return l.a.createElement(n.Fragment,null,t.map(e=>l.a.createElement(n.Fragment,{key:e.network},l.a.createElement(Om,{row:e}),l.a.createElement("div",{style:{marginBottom:24}}))))})),jm=a(1190),km=a(1191);const Sm=Object(O.a)(e=>({root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},title:{fontSize:14},pos:{marginBottom:12}}));function Cm(e,t){let a="";0===e?a="community":1===e?a="barangay":2===e?a="municipal":3===e?a="provincial":4===e?a="regional":5===e&&(a="national");return{header:"".concat(le(a)," ").concat(t.toUpperCase()),offices:"".concat(a,"_").concat(t)}}function wm(e){const t=e.checkbox_data,a=e.updatePrimary,r=e.contact_per_org,c=e.setContactsPerOrg,i=e.contacts_key,s=e.classes,m=Object(n.useState)(0),d=Object(o.a)(m,2),u=d[0],b=d[1],g=[];Object(n.useEffect)(()=>{let e=!1;if(t.find(e=>1===e.primary_contact)&&!1===e){e=!0;const a=t.find(e=>1===e.primary_contact).user_org_id.toString();b(a)}},[]);return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,key:"contact_radio_button"},l.a.createElement(ot.a,{component:"fieldset",style:{display:"flex"}},l.a.createElement(Ea.a,{component:"legend",style:{textAlign:"center",marginBottom:8}},"Choose primary contact."),l.a.createElement(st.a,{"aria-label":"choose_primary_contact",name:"choose_primary_contact",value:u,onChange:e=>{b(e.target.value)},row:!0,style:{justifyContent:"space-around"}},t.map((e,t)=>{const a=e.contact_person,n=e.user_org_id,r=a.first_name,c=a.last_name;return l.a.createElement(mt.a,{value:n.toString(),control:l.a.createElement(dt.a,{color:"primary"}),label:"".concat(r," ").concat(c),key:"contact_radio_button_".concat(t+1)})})))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},l.a.createElement(p.a,{variant:"contained",color:"secondary",size:"small",className:s.button,style:{marginRight:8},startIcon:l.a.createElement(jm.a,null),onClick:()=>{a();const e=parseInt(u,10);t.forEach((t,a)=>{let n=0;e===t.user_org_id&&(n=1),t.primary_contact=n,g.push(t)}),r[i]=g,c(r),function(e,t=null){const a="".concat(ee.b,"/api/contacts/save_primary_contact");ae.a.post(a,e).then(e=>{const a=e.data;console.log("Save updated primary contact",a),null!==t&&t(a)}).catch(e=>{console.error(e)})}(g,e=>{var t;t="update_all_contacts",ps(),us.emit(t)})}},"Save"),l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",className:s.button,startIcon:l.a.createElement(km.a,null),onClick:()=>a()},"Back")))}function Dm(e){const t=e.siteData,a=e.classes,r=e.isUpdatePrimary,c=e.setIsUpdatePrimary,i=Object(n.useState)([]),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)({}),b=Object(o.a)(u,2),g=b[0],E=b[1],f=Object(n.useState)([]),h=Object(o.a)(f,2),_=h[0],O=h[1],x=Object(n.useState)([]),j=Object(o.a)(x,2),k=j[0],S=j[1];Object(n.useEffect)(()=>{c(!1);const e={},a=[];t.forEach((t,n)=>{const l=t.org_name,r=Cm(t.scope,l).offices;void 0===e[r]?(e[r]=[t],a.push(r)):e[r].push(t)}),E(e),d(a)},[t]);const C=e=>{c(!r),void 0!==e&&(O(g[e]),S(e))};return r?l.a.createElement(wm,{checkbox_data:_,updatePrimary:C,contact_per_org:g,setContactsPerOrg:E,contacts_key:k,classes:a}):m.map((e,t)=>{const n=g[e][0],r=Cm(n.scope,n.org_name).header,c=g[e].find(e=>1===e.primary_contact);let i="No primary contact set";if("undefined"!==typeof c){const e=c.contact_person,t=e.first_name,a=e.last_name;i="".concat(t," ").concat(a)}return l.a.createElement(y.a,{item:!0,xs:12,sm:6,lg:4,align:"center",key:"contact_per_org_".concat(t+1)},l.a.createElement(G.a,{className:a.root,key:"contact_per_org_card_".concat(t+1)},l.a.createElement(q.a,{key:"contact_per_org_content_".concat(t+1)},l.a.createElement(v.a,{variant:"subtitle2"},r),l.a.createElement(v.a,{variant:"body1"},i)),l.a.createElement(fo.a,{disableSpacing:!0},l.a.createElement(y.a,{container:!0,justify:"flex-end"},l.a.createElement(p.a,{size:"small",color:"primary",onClick:()=>C(e)},"Update")))))})}var Am=l.a.memo((function(e){const t=e.siteLabel,a=e.siteID,r=e.siteData,c=Object(n.useState)(!1),i=Object(o.a)(c,2),s=i[0],m=i[1],d=Sm();return l.a.createElement(n.Fragment,{key:"site_ID".concat(a+1)},l.a.createElement(Te.a,null,l.a.createElement(Ne.a,{expandIcon:l.a.createElement(el.a,null)},l.a.createElement(v.a,{variant:"body1"},t)),l.a.createElement(V.a,null),l.a.createElement(Ye.a,{className:d.details},l.a.createElement(y.a,{container:!0,spacing:3,style:{marginTop:6}},l.a.createElement(Dm,{siteData:r,classes:d,isUpdatePrimary:s,setIsUpdatePrimary:m}))),l.a.createElement(V.a,null)))}),(function(e,t){return e.siteData.length===t.siteData.length}));var Im=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.modalState,r=e.modalStateHandler,c=e.isMobile,i=e.contactsArray,s=e.classes,m=e.setChosenContact,d=Object(n.useContext)(sa).organizations,u=Object(n.useState)([]),b=Object(o.a)(u,2),g=b[0],E=b[1];Object(n.useEffect)(()=>{const e=d.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}});E(e)},[d]);const f=Object(n.useState)(null),h=Object(o.a)(f,2),_=h[0],y=h[1],v=Object(n.useState)(null),O=Object(o.a)(v,2),x=O[0],j=O[1],k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],w=S[1],D=l.a.useCallback(e=>()=>{m(e),A()},[]),A=()=>{r()};return Object(n.useEffect)(()=>{let e=[];if(null!==x){const t=x.map(e=>e.value);e=i.filter(e=>{const a=e.organizations;let n=null;return 0!==a.length&&(n=a[0].organization.org_id),t.includes(n)})}if(null!==_){const t=_.map(e=>e.data.site_code);let a=i;0!==e.length&&(a=e),e=[],a.forEach(a=>{a.organizations.every(n=>{const l=n.site.site_code;return!t.includes(l)||(e.push(a),!1)})})}e.length>0?w(e):w(null)},[x,_]),l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?qt:Vt},l.a.createElement(rt.a,{id:"form-dialog-title"},l.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},l.a.createElement("span",null,"Search contacts"),l.a.createElement(Y.a,{color:"inherit",onClick:r,"aria-label":"Close",style:{padding:0}},l.a.createElement(Rt.a,null)))),l.a.createElement(ct.a,{style:{overflowY:"auto"}},l.a.createElement(it.a,null,"Fill in the following"),l.a.createElement("div",{style:{margin:"24px 0"}},l.a.createElement(ua,{value:_,changeHandler:e=>y(e),isMulti:!0})),l.a.createElement("div",{style:{margin:"24px 0"}},l.a.createElement(oa,{label:"Organizations",options:g,value:x,changeHandler:(I="organizations",e=>{"sites"===I?y(e):"organizations"===I&&j(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),null!==C?l.a.createElement(ym,Object.assign({},e,{contacts:C,classes:s,onContactClickFn:D})):null,!c&&l.a.createElement("div",{style:{height:240}})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:r},"Close")));var I}));const Mm=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:{overflowY:"auto",height:"calc(100vh - 250px)",[e.breakpoints.down("md")]:{height:"80vh"}},insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"}})}),Tm=e=>l.a.createElement(Qe.a,Object.assign({speed:2,width:700,height:350,viewBox:"0 0 700 350"},e),l.a.createElement("rect",{x:"4",y:"8",rx:"3",ry:"3",width:"8",height:"317"}),l.a.createElement("rect",{x:"7",y:"317",rx:"3",ry:"3",width:"669",height:"8"}),l.a.createElement("rect",{x:"669",y:"9",rx:"3",ry:"3",width:"7",height:"313"}),l.a.createElement("rect",{x:"5",y:"8",rx:"3",ry:"3",width:"669",height:"7"}),l.a.createElement("rect",{x:"114",y:"52",rx:"6",ry:"6",width:"483",height:"15"}),l.a.createElement("circle",{cx:"77",cy:"60",r:"15"}),l.a.createElement("rect",{x:"116",y:"105",rx:"6",ry:"6",width:"420",height:"15"}),l.a.createElement("circle",{cx:"78",cy:"113",r:"15"}),l.a.createElement("rect",{x:"115",y:"158",rx:"6",ry:"6",width:"483",height:"15"}),l.a.createElement("circle",{cx:"78",cy:"166",r:"15"}),l.a.createElement("rect",{x:"117",y:"211",rx:"6",ry:"6",width:"444",height:"15"}),l.a.createElement("circle",{cx:"79",cy:"219",r:"15"}),l.a.createElement("rect",{x:"117",y:"263",rx:"6",ry:"6",width:"483",height:"15"}),l.a.createElement("circle",{cx:"80",cy:"271",r:"15"}));function Nm(e){const t=e.contact,a=e.chosenContact,r=e.setSlideOpen,c=e.classes,i=e.setContactFormForEdit,o=e.siteOrgs,s=e.isContactPriority,m=o.sites,d=o.org,u=a.status,b=a.emails,g=a.ewi_recipient,E=a.landline_numbers,f=a.mobile_numbers,h=a.ewi_restriction;return l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:2},l.a.createElement(Go.a,null,l.a.createElement(ts.a,null))),l.a.createElement(y.a,{item:!0,xs:7},l.a.createElement(v.a,{variant:"h5",align:"center"},t)),l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(Me.a,{smDown:!0,lgUp:!0},l.a.createElement(Y.a,{onClick:()=>r(!1)},l.a.createElement(Rt.a,null)))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center",paragraph:!0},"Affiliation")),null!==d?l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},l.a.createElement(Ke.a,{arrow:!0,disableFocusListener:!0,disableHoverListener:!s,title:"Contact Priority",placement:"top"},l.a.createElement(Kt.a,{color:"secondary",label:l.a.createElement(v.a,{variant:"body1"},d.toUpperCase()),icon:s?l.a.createElement(mm.a,{style:{color:"gold"}}):null}))),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},m.map(e=>{const t=e.site_code,a=ne(e,!1);return l.a.createElement(Ke.a,{key:t,title:a,"aria-label":a},l.a.createElement(Kt.a,{color:"primary",label:l.a.createElement(v.a,{variant:"body2"},t.toUpperCase())}))}))):l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center",paragraph:!0},"No affiliations saved")),l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},l.a.createElement("strong",null,"Status"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",align:"center"},0===u?"Inactive":"Active")),l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},l.a.createElement("strong",null,"EWI Recipient"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",align:"center"},0===g?"No":"Yes")),h&&l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},l.a.createElement("strong",null,"EWI Restriction"))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",align:"center"},"Do not send on Alert ",h.alert_level," ",h.alert_level>1&&"and below"))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Contact Information")),l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Mobile")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(kn.a,{dense:!0},0===f.length?l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No mobile numbers saved")):f.map(e=>l.a.createElement(Cn.a,{key:e.mobile_number.mobile_id},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(tt.a,null))),l.a.createElement(wn.a,{primary:"+".concat(e.mobile_number.sim_num)}),l.a.createElement(im.a,null,l.a.createElement(wn.a,{secondary:"Status: ".concat(0===e.status?"Inactive":"Active")})))))),l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Landline")),l.a.createElement(y.a,{item:!0,xs:12},0===E.length?l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No landline numbers saved")):l.a.createElement(kn.a,{dense:!0},E.map(e=>l.a.createElement(Cn.a,{key:e.landline_id},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(dm.a,null))),l.a.createElement(wn.a,{primary:"+".concat(e.landline_num)}))))),l.a.createElement(y.a,{item:!0,xs:12,className:c.insetDivider},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Email")),l.a.createElement(y.a,{item:!0,xs:12},0===b.length?l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No email addresses saved")):l.a.createElement(kn.a,{dense:!0},b.map(e=>l.a.createElement(Cn.a,{key:e.email_id},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(um.a,null))),l.a.createElement(wn.a,{primary:"+".concat(e.email)}))))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:l.a.createElement(vr.a,null),onClick:()=>i(!0)},"Edit")))}function Ym(e){const t=e.chosenContact,a=e.setSlideOpen;if(0===t.length)return l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:7},l.a.createElement(v.a,{variant:"caption",display:"block"},"No initial blocked contact")));const n=t.mobile_number,r=t.reporter,c=t.ts,i=t.reason,o=n.sim_num,s=n.users,m=r.first_name,d=r.last_name;let u="No contact details";s.length>0&&(u=s.map(e=>"".concat(e.user.last_name,", ").concat(e.user.first_name)).join(" | "));const b=X()(c).format("MMMM D, YYYY, HH:mm:ss");return l.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(Go.a,null,l.a.createElement(pm.a,null))),l.a.createElement(y.a,{item:!0,xs:7},l.a.createElement(v.a,{variant:"h5",align:"center"},"+".concat(o))),l.a.createElement(y.a,{item:!0,xs:1},l.a.createElement(Me.a,{smDown:!0,lgUp:!0},l.a.createElement(Y.a,{onClick:()=>a(!1)},l.a.createElement(Rt.a,null)))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Details")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},u)),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Reason")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",align:"center"},l.a.createElement("i",null,i))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",align:"center"},b)),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6",align:"center"},"Reporter")),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body1",align:"center"},"".concat(d,", ").concat(m))),l.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},l.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:l.a.createElement(bm.a,null),disabled:!0},"Unblock (soon)")))}const Rm=({search_str:e,setSearchStr:t,inputProps:a})=>l.a.createElement(g.a,{margin:"dense",hiddenLabel:!0,fullWidth:!0,variant:"outlined",placeholder:"Type contact name",InputProps:a,value:e,onChange:e=>t(e.target.value)});var Hm=function(e){const t=Mm(),a=Object(n.useState)([]),r=Object(o.a)(a,2),c=r[0],s=r[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],p=d[1],b=Object(n.useState)({}),g=Object(o.a)(b,2),E=g[0],f=g[1],_=Object(n.useState)(0),O=Object(o.a)(_,2),x=O[0],j=O[1],k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],w=S[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),I=A[0],N=A[1],R=Object(n.useState)(!1),H=Object(o.a)(R,2),B=H[0],F=H[1],U=Object(n.useState)(""),z=Object(o.a)(U,2),W=z[0],G=z[1],q=Object(n.useState)([]),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)([]),J=Object(o.a)(K,2),X=J[0],$=J[1],te=Object(n.useState)([]),le=Object(o.a)(te,2),ie=le[0],oe=le[1],se=Object(n.useState)([]),me=Object(o.a)(se,2),de=me[0],ue=me[1],pe=Object(n.useState)("active_numbers"),be=Object(o.a)(pe,2),ge=be[0],Ee=be[1],fe=Object(n.useState)(null),he=Object(o.a)(fe,2),_e=he[0],ye=he[1],ve=Object(n.useState)(!1),Oe=Object(o.a)(ve,2),xe=Oe[0],je=Oe[1],ke=l.a.useCallback((e,t)=>()=>{f(e),j(t),w(!0)},[]),Se=l.a.useCallback(e=>()=>{$(e),w(!0)},[]),Ce=e=>{w(e),N(e),F(!1)},we=e=>{F(e),N(e)},De=e=>{Ee(e)},Ae=Object(i.b)(),Ie=Ae.enqueueSnackbar,Te=Ae.closeSnackbar,Ne=Object(n.useContext)(sa),Ye=Ne.setIsReconnecting,Re=Ne.sites,He=Object(n.useState)(!1),Be=Object(o.a)(He,2),Pe=Be[0],Le=Be[1];Object(n.useEffect)(()=>(bs(Ye,"contacts"),gs(e=>{s(e);let t={};e.length>0&&(t=e[x]),f(t),p(e),Le(!0),null!==_e&&(Te(_e),ye(null),Ie("Loading contacts list successful!",{variant:"success",autoHideDuration:5e3}))}),()=>Es()),[x,_e]),Object(n.useEffect)(()=>{const e=W.length;if(e>2){const e=c.filter(e=>{const t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(W),"gi").test(n)});p(e)}else 0===e&&p(c)},[W]),Object(n.useEffect)(()=>{!function(e){const t="".concat(ee.b,"/api/contacts/get_blocked_numbers");ae.a.get(t).then(t=>{const a=t.data;e(a)}).catch(e=>{console.error(e)})}(e=>{const t=e.status,a=e.blocked_numbers;t&&(Z(a),0!==a.length&&$(a[0]))}),function(e){const t="".concat(ee.b,"/api/contacts/sim_prefix");ae.a.get(t).then(t=>{const a=t.data;e(a)}).catch(e=>{console.error(e)})}(e=>{const t=e.status,a=e.prefixes;t&&oe(a)})},[]),Object(n.useEffect)(()=>{Pe&&(!function(e){const t="".concat(ee.b,"/api/contacts/get_contact_prioritization");ae.a.get(t).then(t=>{const a=t.data;console.log("All Sites Stakeholders",a),e(a)}).catch(e=>{console.error(e)})}(e=>{ue(e)}),Le(!1))},[Pe]);let Fe="",Ue=null,We=!1;if(E.hasOwnProperty("user_id")){const e=E.first_name,t=E.last_name,a=E.organizations;Fe="".concat(e," ").concat(t),Ue=re(a,!0),We=ce(a)}const Ge=()=>I?l.a.createElement(ds,{setContactForm:Ce,chosenContact:E,setSnackbarKey:ye,isEditMode:B,setContactFormForEdit:we,isFromChatterbox:!1}):""!==Fe?l.a.createElement(Nm,{contact:Fe,chosenContact:E,setSlideOpen:w,classes:t,setContactFormForEdit:we,siteOrgs:Ue,isContactPriority:We}):void 0,qe=l.a.createElement(Rm,{search_str:W,setSearchStr:G,inputProps:{endAdornment:l.a.createElement(om.a,{position:"end"},l.a.createElement(Y.a,{"aria-controls":"sortContacts","aria-haspopup":"true",onClick:e=>{je(!xe)},color:"primary"},l.a.createElement(gm.a,null)))}});return l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(ze,{title:"Communications | Contacts"}),l.a.createElement(y.a,{container:!0,spacing:4},l.a.createElement(Me.a,{mdUp:!0},l.a.createElement(y.a,{item:!0,xs:12,className:t.sticky,style:{paddingBottom:0}},qe)),l.a.createElement(Me.a,{smDown:!0},l.a.createElement(y.a,{item:!0,md:4,lg:3},l.a.createElement("div",{className:t.sticky},qe,l.a.createElement(kn.a,{component:"nav","aria-label":"main"},l.a.createElement(Cn.a,{button:!0,onClick:()=>De("active_numbers"),selected:"active_numbers"===ge},l.a.createElement(Dn.a,null,l.a.createElement(Em.a,null)),l.a.createElement(wn.a,{primary:"Active Contacts"})),l.a.createElement(sm.a,{in:"active_numbers"===ge,timeout:"auto",unmountOnExit:!0},l.a.createElement(kn.a,{component:"div",disablePadding:!0},l.a.createElement(Cn.a,{button:!0,onClick:()=>Ce(!0),className:t.nested},l.a.createElement(Dn.a,null,l.a.createElement(bm.a,null)),l.a.createElement(wn.a,{primary:"Add Contact"})))),l.a.createElement(Cn.a,{button:!0,onClick:()=>De("blocked_numbers"),selected:"blocked_numbers"===ge},l.a.createElement(Dn.a,null,l.a.createElement(Xo.a,null)),l.a.createElement(wn.a,{primary:"Blocked Contacts"})),l.a.createElement(Cn.a,{button:!0,onClick:()=>De("contact_prioritization"),selected:"contact_prioritization"===ge},l.a.createElement(Dn.a,null,l.a.createElement(fm.a,null)),l.a.createElement(wn.a,{primary:"Contact Prioritization"})),l.a.createElement(Cn.a,{button:!0,onClick:()=>De("sim_prefixes"),selected:"sim_prefixes"===ge},l.a.createElement(Dn.a,null,l.a.createElement(hm.a,null)),l.a.createElement(wn.a,{primary:"SIM Prefixes"})))))),l.a.createElement(y.a,{item:!0,xs:12,md:8,lg:9},0===c.length?l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(Tm,null)):l.a.createElement(n.Fragment,null,l.a.createElement(Me.a,{xsUp:"active_numbers"!==ge,implementation:"css"},l.a.createElement(y.a,{container:!0,spacing:4},l.a.createElement(y.a,{item:!0,xs:12,lg:7},l.a.createElement(ym,{classes:t,contacts:u,onContactClickFn:ke})),l.a.createElement(Me.a,{mdDown:!0},l.a.createElement(y.a,{item:!0,lg:5},""!==Fe&&l.a.createElement(h.a,{elevation:1,style:{padding:16,zIndex:2},className:"".concat(t.sticky," ").concat(t.overflow),variant:"outlined"},Ge())),l.a.createElement(L.a,{open:I,style:{zIndex:1}})),l.a.createElement(Me.a,{smDown:!0,lgUp:!0},l.a.createElement(P.a,{direction:"left",in:C,mountOnEnter:!0,unmountOnExit:!0},l.a.createElement(h.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},Ge())),l.a.createElement(L.a,{open:C,style:{zIndex:1}})),l.a.createElement(Me.a,{mdUp:!0},l.a.createElement(lt.a,{fullScreen:!0,open:C,TransitionComponent:qt},l.a.createElement(M.a,{style:{position:"relative"}},l.a.createElement(T.a,null,l.a.createElement(Y.a,{edge:"start",color:"inherit",onClick:()=>Ce(!1),"aria-label":"close"},l.a.createElement(Rt.a,null)))),l.a.createElement(h.a,{elevation:0,style:{padding:16}},Ge()))))),l.a.createElement(Me.a,{xsUp:"blocked_numbers"!==ge,implementation:"css"},l.a.createElement(y.a,{container:!0,spacing:4},l.a.createElement(y.a,{item:!0,xs:12,lg:7},l.a.createElement(vm,{blocked_numbers:Q,onBlockContactClickFn:Se})),l.a.createElement(Me.a,{mdDown:!0},l.a.createElement(y.a,{item:!0,lg:5},l.a.createElement(h.a,{elevation:1,style:{padding:16,zIndex:2},className:t.sticky,variant:"outlined"},l.a.createElement(Ym,{chosenContact:X,setSlideOpen:w})))),l.a.createElement(Me.a,{smDown:!0,lgUp:!0},l.a.createElement(P.a,{direction:"left",in:C,mountOnEnter:!0,unmountOnExit:!0},l.a.createElement(h.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},l.a.createElement(Ym,{chosenContact:X,setSlideOpen:w}))),l.a.createElement(L.a,{open:C,style:{zIndex:1}})),l.a.createElement(Me.a,{mdUp:!0},l.a.createElement(lt.a,{fullScreen:!0,open:C,TransitionComponent:qt},l.a.createElement(M.a,{style:{position:"relative"}},l.a.createElement(T.a,null,l.a.createElement(Y.a,{edge:"start",color:"inherit",onClick:()=>Ce(!1),"aria-label":"close"},l.a.createElement(Rt.a,null)))),l.a.createElement(h.a,{elevation:0,style:{padding:16}},l.a.createElement(Ym,{chosenContact:X,setSlideOpen:w})))))),l.a.createElement(Me.a,{xsUp:"contact_prioritization"!==ge,implementation:"css"},l.a.createElement(v.a,{variant:"body1",style:{marginBottom:12}},l.a.createElement("strong",null,l.a.createElement("i",null,"Note: Contact priority can only be chosen from stakeholders that are currently active and EWI recipients."))),0!==de.length&&Re.map((e,t)=>{const a=e.site_id,n=e.site_code,r=ne(e,!0,"start"),c=de[n];return l.a.createElement(Am,{siteLabel:r,siteID:a,siteData:c,key:t})})),l.a.createElement(Me.a,{xsUp:"sim_prefixes"!==ge,implementation:"css"},l.a.createElement(xm,{sim_prefixes:ie}))))),l.a.createElement(Im,{modalStateHandler:(Ve=!1,()=>{je(Ve)}),modalState:xe,contactsArray:u,classes:t,chosenContact:E,setChosenContact:f}));var Ve},Bm=a(202),Pm=a(199),Lm=a(1148),Fm=a(420),Um=a.n(Fm);const zm=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},insetDivider:{padding:"8px 70px !important"}})}),Wm={to:[],cc:[],bcc:[]};var Gm=function(e){const t=zm(),a=(e.siteId,Object(n.useState)(Wm)),r=Object(o.a)(a,2),c=r[0],i=r[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],b=m[1],E=Object(n.useState)({}),f=Object(o.a)(E,2),h=f[0],_=f[1],v=Object(n.useState)(""),O=Object(o.a)(v,2),x=O[0],j=O[1],k=Object(n.useState)(""),S=Object(o.a)(k,2),C=S[0],w=S[1],D=(e,t)=>{const a=c[e].push(t);i(Object(u.a)(Object(u.a)({},c),a))},A=(e,t,a)=>{const n=c[e].splice(c[e].indexOf(t),1);i(Object(u.a)(Object(u.a)({},c),n))};return l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(ze,{title:"Communications | MailBox"}),l.a.createElement(y.a,{container:!0,spacing:4,alignItems:"center"},l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:"sending_options"},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(kt.a,{label:"To",value:c.to,onAdd:e=>D("to",e),onDelete:(e,t)=>A("to",e),fullWidth:!0,required:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(g.a,{label:"Subject",value:x,onChange:e=>j(e.target.value),margin:"dense",fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(kt.a,{label:"Cc",value:c.cc,onAdd:e=>D("cc",e),onDelete:(e,t)=>A("cc",e),fullWidth:!0})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(kt.a,{label:"Bcc",value:c.bcc,onAdd:e=>D("bcc",e),onDelete:(e,t)=>A("bcc",e),fullWidth:!0}))),l.a.createElement(y.a,{item:!0,xs:12,key:"message_body"},l.a.createElement(Gl.a,{theme:"snow",value:C,onChange:w})),l.a.createElement(y.a,{item:!0,xs:12,key:"buttons"},l.a.createElement(p.a,{color:"secondary",onClick:()=>{const e={recipients:[...c.to,...c.cc,...c.bcc],subject:x,mail_body:C};console.log("payload",e),function(e,t){const a="".concat(ee.b,"/api/mailbox/send_email");console.log(e),ae.a.post(a,e).then(e=>{const a=e.data;console.log("Send email response",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{console.log("AXIOS Response",e);e.status?(_({text:"Email sent!",color:Bm.a[600]}),i(Wm),j(""),w("")):_({text:"Email sent!",color:Pm.a[600]}),b(!0)})}},"SEND"),l.a.createElement(p.a,{color:"primary",onClick:()=>{i({to:[],cc:[],bcc:[]}),j(""),w("")}},"Discard/Reset"))),l.a.createElement(Lm.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:d,autoHideDuration:6e3,onClose:e=>b(!1),ContentProps:{"aria-describedby":"message-id"},message:l.a.createElement("span",{id:"message-id"},h.text),action:[l.a.createElement(Y.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:e=>b(!1)},l.a.createElement(Um.a,null))],style:{backgroundColor:h.color}}))},qm=a(577),Vm=a(1200);const Qm=Object(O.a)(e=>{const t=Object(fe.d)(e);return Object(u.a)(Object(u.a)({},t),{},{customPaper:{padding:8,marginTop:20,textAlign:"center"},bigAvatar:{margin:10,width:40,height:40}})}),Zm=Object(d.a)(e=>({badge:{right:14,top:48,padding:"0 4px"}}))(R.a);var Km=function(e){const t=Qm(),a=e.siteCode,r=Object(n.useState)(null),c=Object(o.a)(r,2),i=c[0],s=c[1];return Object(n.useEffect)(()=>{var e,r;e=a,r=e=>{console.log(e);const a=function(e,t){const a=[],r=[];return Object.keys(t).forEach(e=>{let t=r;/lewc|lgu/i.test(e)&&(t=a),t.push(e)}),a.concat(r).map((a,r,c)=>{const i=t[a].map((t,a)=>{const n=t.last_name,r=t.first_name,c=t.salutation,i=t.status,o=t.primary_contact,s=c||"";let m="Active",d=l.a.createElement(ha.a,{style:{color:"green"}});Boolean(o)&&i?(m="Contact Priority",d=l.a.createElement(Vm.a,{style:{color:"gold"}})):i||(m="Inactive",d=l.a.createElement(_a.a,{style:{color:"gray"}}));const u=l.a.createElement(Ke.a,{arrow:!0,title:m,placement:"top",enterTouchDelay:200},d);return l.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,lg:3,justify:"center",alignItems:"center",container:!0,spacing:1,key:"staff_".concat(a+1)},l.a.createElement(Zm,{badgeContent:u},l.a.createElement(Go.a,{alt:"Stakeholder",src:Jo.a,className:e.bigAvatar})),l.a.createElement(v.a,{variant:"subtitle1",color:i?"textPrimary":"textSecondary"},"".concat(s," ").concat(r," ").concat(n)))});return l.a.createElement(n.Fragment,{key:"fragment_".concat(r+1)},l.a.createElement(y.a,{item:!0,xs:12,key:"org_label_".concat(r+1)},l.a.createElement(v.a,{variant:"subtitle1"},l.a.createElement("strong",null,a.toUpperCase()))),l.a.createElement(y.a,{item:!0,xs:12,justify:"space-evenly",alignItems:"center",container:!0,spacing:1,key:"staff_list_".concat(r+1)},i),c.length>r+1&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,{style:{margin:"16px 0"}})))})}(t,e);s(a)},ae.a.get("".concat(ee.b,"/api/users/get_community_orgs_by_site/").concat(e)).then(e=>{const t=e.data;r(t)})},[]),l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"h6",color:"textPrimary",gutterBottom:!0},l.a.createElement("strong",null,"Site Stakeholders"))),l.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1,justify:"center"},null===i?"Loading...":0!==i.length?i:"No site stakeholders"))};const Jm=e=>t=>{t.preventDefault(),e.push("/community/site_info"),e.replace("/community/site_info")};var Xm=function(e){const t=e.width,a=e.history;return Object(Se.b)(t,"sm")?l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:Jm(a)},l.a.createElement(Nc.a,{style:{fontSize:16}})," Back"):l.a.createElement(Y.a,{variant:"contained",color:"primary",size:"small",onClick:Jm(a),style:{marginLeft:6}},l.a.createElement(Nc.a,null))};const $m=["I","II","III","IV-A","IV-B","V","VI","VII","VIII","IX","X","XI","XII","XIII","CAR","NCR","BARMM"];function ed(e,t){const a=e[t-1],n=[],l=[];Object.keys(a).forEach(e=>{"d"!==a[e]&&"w"!==a[e]||("d"===a[e]?n.push(e):l.push(e))}),de(n),de(l);return[{key:"dry",list:n},{key:"wet",list:l}]}function td(e,t){const a=t.type,n=t.field,l=t.value,r=e[n],c=function(e,t){return""===t?"Required field":"site_code"===e&&t.length<3?"Site code must be three-lettered keyword":""}(n,l);let i=l;switch(["purok","sitio","households"].includes(n)&&(i=l||null),"season"===n&&(i=parseInt(l,10)),a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},r),{},{value:i,helper_text:c})});default:return Object(u.a)({},e)}}function ad(e){const t={},a=["sitio","purok","active","site_id"];return Object.keys(e).forEach(n=>{t[n]={value:e[n],helper_text:null,required:!a.includes(n)}}),t}var nd=function(e){const t=e.siteInformation,a=e.setSiteInformationData,r=e.seasons,c=e.setIsDisabled,i=Object(n.useReducer)(td,t,ad),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)([]),p=Object(o.a)(u,2),b=p[0],E=p[1];return Object(n.useEffect)(()=>{const e=Object.keys(m).some(e=>{const t=m[e],a=t.required,n=t.helper_text;return a&&""!==n&&null!==n});c(e),a(function(e){const t={};return Object.keys(e).forEach(a=>{t[a]=e[a].value}),t}(m))},[m]),Object(n.useEffect)(()=>{if(null!==m.season.value){const e=ed(r,m.season.value);E(e)}},[m.season.value]),l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(g.a,{label:"Site code",fullWidth:!0,required:!0,inputProps:{maxLength:3},value:m.site_code.value.toUpperCase(),onChange:e=>d({type:"UPDATE",field:"site_code",value:e.target.value}),helperText:m.site_code.helper_text||"",error:Boolean(m.site_code.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Purok",fullWidth:!0,placeholder:"Enter purok if available",InputLabelProps:{shrink:!0},value:m.purok.value||"",onChange:e=>d({type:"UPDATE",field:"purok",value:e.target.value})})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Sitio",fullWidth:!0,placeholder:"Enter sitio if available",InputLabelProps:{shrink:!0},value:m.sitio.value||"",onChange:e=>d({type:"UPDATE",field:"sitio",value:e.target.value})})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Barangay",fullWidth:!0,required:!0,value:m.barangay.value,onChange:e=>d({type:"UPDATE",field:"barangay",value:e.target.value}),helperText:m.barangay.helper_text||"",error:Boolean(m.barangay.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Municipality",fullWidth:!0,required:!0,value:m.municipality.value,onChange:e=>d({type:"UPDATE",field:"municipality",value:e.target.value}),helperText:m.municipality.helper_text||"",error:Boolean(m.municipality.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"Province",fullWidth:!0,required:!0,value:m.province.value,onChange:e=>d({type:"UPDATE",field:"province",value:e.target.value}),helperText:m.province.helper_text||"",error:Boolean(m.province.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{required:!0,fullWidth:!0,error:Boolean(m.region.helper_text)},l.a.createElement(wa.a,{id:"region"},"Region"),l.a.createElement(Da.a,{labelId:"region-select-label",id:"region-select-id",required:!0,value:m.region.value,onChange:e=>d({type:"UPDATE",field:"region",value:e.target.value})},l.a.createElement(B.a,{value:""},l.a.createElement("em",null,"None")),$m.map((e,t)=>l.a.createElement(B.a,{value:e,key:t},e))))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(g.a,{label:"PSGC",fullWidth:!0,type:"number",required:!0,value:m.psgc.value,onChange:e=>d({type:"UPDATE",field:"psgc",value:e.target.value}),helperText:m.psgc.helper_text||"",error:Boolean(m.psgc.helper_text)})),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(g.a,{label:"Elements at Risk",fullWidth:!0,required:!0,value:m.households.value||"",onChange:e=>d({type:"UPDATE",field:"households",value:e.target.value}),helperText:m.households.helper_text||"",error:Boolean(m.households.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,container:!0,justify:"center",alignItems:"center"},l.a.createElement(ot.a,null,l.a.createElement(mt.a,{control:l.a.createElement(Lt.a,{checked:m.active.value,onChange:e=>d({type:"UPDATE",field:"active",value:e.target.checked}),value:"checkedA",color:"primary"}),label:"Active site"}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{component:"fieldset",required:!0,error:Boolean(m.season.helper_text)},l.a.createElement(Ea.a,{component:"legend"},"Season"),l.a.createElement(st.a,{row:!0,"aria-label":"season_group",name:"season",value:m.season.value.toString(),onChange:e=>{const t=e.target.value;d({type:"UPDATE",field:"season",value:t});const a=ed(r,t);E(a)}},r.map((e,t)=>{const a=e.season_group_id;return l.a.createElement(mt.a,{value:a.toString(),control:l.a.createElement(dt.a,{color:"primary"}),label:"Season  ".concat(a),key:"season_".concat(a)})})))),l.a.createElement(y.a,{item:!0,container:!0,xs:12},b.map(e=>{const t=e.key,a=e.list;return l.a.createElement(y.a,{item:!0,xs:6,key:t},l.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary",align:"center"},le(t)),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary",align:"center"},a.map(e=>le(e)).join(", ")))})))};var ld=Object(pt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,r=e.seasons,c=e.editButtonAction,s=e.siteInformation,m=(Object(n.useContext)(sa).setRefreshSites,Object(n.useState)(null)),d=Object(o.a)(m,2),u=d[0],b=d[1],g=Object(n.useState)(!0),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(i.b)(),y=(_.enqueueSnackbar,_.closeSnackbar,()=>{c(!1)});return l.a.createElement(lt.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},l.a.createElement(rt.a,{id:"form-dialog-title"},"Edit site information"),l.a.createElement(ct.a,null,l.a.createElement(it.a,null,"Update necessary fields of site information form then save."),l.a.createElement(nd,{siteInformation:s,setSiteInformationData:b,seasons:r,setIsDisabled:h})),l.a.createElement(ut.a,null,l.a.createElement(p.a,{onClick:y,color:"primary"},"Cancel"),l.a.createElement(p.a,{color:"primary",onClick:()=>{!function(e,t){const a="".concat(ee.b,"/api/sites/save_site_information");ae.a.post(a,e).then(e=>{const t=e.data;console.log("Save site info data reponse",t)}).catch(e=>{console.error(e)})}(u)},disabled:f},"Save")))}));const rd=Object(O.a)(e=>{const t=Object(qm.a)(e);return Object(fe.d)(t)}),cd=()=>l.a.createElement(Qe.a,{height:125,width:380,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},l.a.createElement("rect",{x:"129",y:"20",rx:"3",ry:"3",width:"123",height:"44"}),l.a.createElement("rect",{x:"18",y:"80",rx:"3",ry:"3",width:"350",height:"22"}));var id=function(e){const t=e.width,a=e.siteInformation,r=(rd(),Object(n.useState)(null)),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],b=d[1],g=Object(n.useState)([]),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)([]),O=Object(o.a)(_,2),x=O[0],j=O[1],k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],w=S[1];Object(n.useEffect)(()=>{"undefined"!==typeof a&&s(a)},[a]),Object(n.useEffect)(()=>{var e;null!==i&&(e=e=>{h(e)},ae.a.get("".concat(ee.b,"/api/sites/get_seasons")).then(t=>{const a=t.data;e(a)}).catch(e=>{console.log(e)}),function(e,t){ae.a.get("".concat(ee.b,"/api/sites/get_site_season/").concat(e)).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}(i.site_code,e=>{const t=e.season_months,a=t.routine_schedules,n=[],l=[];a.forEach(e=>{const t=X()().isoWeekday(e.iso_week_day).format("dddd");"d"===e.season_type?n.push(t):l.push(t)});j([{key:"dry",list:n},{key:"wet",list:l}]),delete t.routine_schedules,delete t.season_group_id;const r=[],c=[];Object.keys(t).forEach(e=>{"d"===t[e]?r.push(e):c.push(e)}),de(r),de(c);b([{key:"dry",list:r},{key:"wet",list:c}])}))},[i]);const D=()=>{w(!C)};return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},l.a.createElement(y.a,{item:!0,xs:!0},l.a.createElement(Xm,Object.assign({},e,{width:t}))),l.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"flex-end"},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:D,startIcon:l.a.createElement(vr.a,null)},"Edit Info"))),l.a.createElement(y.a,{container:!0,spacing:2},null!==i?l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"h4"},i.site_code.toUpperCase()),l.a.createElement(v.a,{variant:"h5",color:"textSecondary"},ne(i,!1))),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(G.a,{raised:!0},l.a.createElement(q.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"h6",color:"textPrimary"},l.a.createElement("strong",null,"Geographic Information"))),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Region"),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},i.region)),l.a.createElement(y.a,{item:!0,xs:!0,sm:9,md:8,lg:!0,align:"center"},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Philippine Standard Geographic Code"),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},i.psgc)),l.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary"},"Seasons")),u.length>0&&u.map(e=>{const t=e.key,a=e.list;return l.a.createElement(y.a,{item:!0,xs:6,key:t},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},le(t)),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>le(e)).join(", ")))})))))),l.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,alignItems:"center"},l.a.createElement(G.a,{raised:!0,style:{width:"100%"}},l.a.createElement(q.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"h6",color:"textPrimary"},l.a.createElement("strong",null,"Monitoring Information"))),l.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary"},"Routine Schedules")),x.length>0&&x.map(e=>{const t=e.key,a=e.list;return l.a.createElement(y.a,{item:!0,xs:6,key:t},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},le(t)),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>le(e)).join(", ")))})),l.a.createElement(y.a,{item:!0,xs:!0,align:"center"},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Current Alert Level"),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},"---")))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(G.a,{raised:!0},l.a.createElement(q.a,null,l.a.createElement(y.a,{container:!0,spacing:1},l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(v.a,{variant:"h6",color:"textPrimary"},l.a.createElement("strong",null,"Site Status"))),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Active"),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},i.active?"Yes":"No")),l.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},l.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Elements at Risk"),l.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},i.households||"---")))))),l.a.createElement(y.a,{item:!0,xs:12,align:"center"},l.a.createElement(G.a,{raised:!0,style:{width:"100%"}},l.a.createElement(q.a,null,l.a.createElement(Km,{siteCode:i.site_code}))))):l.a.createElement(y.a,{item:!0,xs:!0,style:{width:"100%"}},l.a.createElement(cd,null))),l.a.createElement(ld,{isOpen:C,siteInformation:a,editButtonAction:D,seasons:f}))};var od=function(e){const t=e.siteMapData,a=e.hoveredSite,r=e.url,c=[12.8797,121.774],i=Object(n.useRef)(t.map(()=>Object(n.createRef)()));return Object(n.useEffect)(()=>{if(null!==a){const e=t.findIndex(e=>e.site_code===a),n=i.current[e].current;null!==n&&n.leafletElement.openPopup()}},[a]),l.a.createElement(xi.a,{style:{height:"75vh"},center:c,zoom:5,scrollWheelZoom:"center"},l.a.createElement(ji.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((e,t)=>{const a=e.site_code;return l.a.createElement(Di.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0,ref:i.current[t]},l.a.createElement(Ci.a,null,l.a.createElement(s.b,{to:"".concat(r,"/").concat(a),style:{color:"black"}},l.a.createElement("strong",null,a.toUpperCase())," ",l.a.createElement("br",null),ne(e,!1))))}))};const sd=Object(O.a)(e=>{const t=Object(fe.d)(e),a=118+.06*(window.innerHeight-118);return Object(u.a)(Object(u.a)({},t),{},{sticky:{position:"sticky",top:a,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}})}),md=()=>l.a.createElement(Qe.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},l.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"561",height:"700"}));function dd(e){const t=e.sitesPerRegion,a=e.url,n=e.setHoveredSite,r=Object.keys(t).sort();return l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.map(e=>{const r="inactive"!==e?e.toUpperCase():"Inactive Sites";return l.a.createElement(y.a,{container:!0,justify:"center",key:e,style:{margin:"8px 0"}},l.a.createElement(v.a,{variant:"h6",component:y.a,item:!0,xs:12,align:"center",style:{marginBottom:4}},["I","V","X"].includes(r.charAt(0))&&"inactive"!==e?"Region ".concat(r):r),t[e].map(e=>l.a.createElement(v.a,{variant:"body2",component:y.a,item:!0,xs:12,align:"center",key:e.site_code},l.a.createElement(s.b,{to:"".concat(a,"/").concat(e.site_code),style:{color:"black"},onFocus:t=>n(e.site_code),onMouseOver:t=>n(e.site_code)},ne(e,!0,"start")))))}))}var ud=Object(Se.a)()((function(e){const t=sd(),a=e.width,r=e.location,c=e.match.url,i=Object(n.useContext)(sa).all_sites_including_inactive,s=Object(n.useState)(null),d=Object(o.a)(s,2),p=d[0],b=d[1],g=Object(n.useState)(null),E=Object(o.a)(g,2),f=E[0],h=E[1],_=Object(n.useState)(null),O=Object(o.a)(_,2),x=O[0],j=O[1];return Object(n.useEffect)(()=>{if(i.length>0){const e=[],t={};i.forEach(a=>{let n=a.region;a.active||(n="inactive"),t[n]||(t[n]=[]),t[n].push(a),e.push(Object(u.a)(Object(u.a)({},a),{},{url:"".concat(c,"/").concat(a.site_code)}))}),h(e),j(t)}},[i]),l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(ze,{title:"Community | Site Information"})),l.a.createElement("div",{className:t.pageContentMargin},l.a.createElement(m.d,{location:r},l.a.createElement(m.b,{exact:!0,path:c,render:e=>l.a.createElement(y.a,{container:!0,spacing:3,justify:"space-evenly"},l.a.createElement(y.a,{item:!0,xs:12,sm:6},null===f?l.a.createElement(md,null):l.a.createElement("div",{className:t.sticky},l.a.createElement(od,{siteMapData:f,width:a,url:c,hoveredSite:p}))),l.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center"},l.a.createElement(v.a,{variant:"h5",component:y.a,item:!0,xs:12,align:"center",gutterBottom:!0},l.a.createElement("strong",null,"Dynaslope Project Sites")),null===x?"Loading":l.a.createElement(dd,{sitesPerRegion:x,url:c,setHoveredSite:b})))}),l.a.createElement(m.b,{path:"".concat(c,"/:site_code"),render:e=>{const t=e.match.params.site_code,n=i.filter(e=>e.site_code===t).pop();return l.a.createElement(id,Object.assign({},e,{width:a,siteInformation:n}))}}))))}));const pd=Object(O.a)(e=>({list:{maxHeight:"60vh",overflowY:"auto",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}},searchBox:{marginBottom:e.spacing(3)},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}}));var bd=function(e){const t=e.users,a=e.onMemberClickFn,r=e.selectedUserDetails,c=pd(),i=Object(n.useState)(null),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)(null),p=Object(o.a)(u,2),b=p[0],g=p[1];return Object(n.useEffect)(()=>{d(t)},[t]),Object(n.useEffect)(()=>{if(null!==b){const e=t.filter(e=>{const t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(b.toLowerCase()),"gi").test(n.toLocaleLowerCase())});d(e)}else d(t)},[b]),l.a.createElement("div",{className:c.sticky},l.a.createElement(Ia.a,{fullWidth:!0,margin:"dense",placeholder:"Search Dynaslope staff...",onChange:e=>g(e.target.value),className:c.searchBox}),l.a.createElement(kn.a,{"aria-label":"list",className:c.list},null!==m&&m.map(e=>{const t="".concat(e.last_name,", ").concat(e.first_name),n=null!==r&&r.user_id===e.user_id;return l.a.createElement(Cn.a,{button:!0,key:e.user_id,onClick:a(e),selected:n},l.a.createElement(wn.a,{primary:t}))})))},gd=a(1142),Ed=a(1201),fd=a(1202),hd=a(1203),_d=a(607),yd=a.n(_d);var vd=a(608),Od=a.n(vd);const xd=Object(O.a)(e=>({root:{maxWidth:"100%",flexGrow:1},container:{maxWidth:"50%"},media:{objectPosition:"top"},avatar:{width:150,height:150,[e.breakpoints.down("md")]:{width:100,height:100},backgroundColor:"#f2f2f2"},avatarContainer:{marginTop:-72,marginBottom:e.spacing(1)},editButton:{backgroundColor:"#f2f2f2","&:hover":{backgroundColor:"#f2f2f2"}},nickname:{marginBottom:e.spacing(2)},listBody:{paddingLeft:e.spacing(7),paddingRight:e.spacing(11),textAlign:"center"},link:{textDecoration:"none",color:"black"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"}}));function jd(e){const t=e.inputRef,a=e.mask,n=Object(Qt.a)(e,["inputRef","mask"]);return l.a.createElement(_o.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}const kd=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],Sd=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Cd(e,t,a){return""===t&&a?"Required field":"sim_num"!==e||t.match(/^[a-z0-9]+$/i)?"birthday"!==e||null===t||t.isValid()?"":"Enter a valid date":"Enter complete mobile number"}function wd(e,t){const a=t.type,n=t.field,l=t.value,r=t.key,c=t.category;let i=null,o=null,s=null,m=null;const d=e.field_with_error;if("ADD"===a){let t={};"mobile_numbers"===c?(m=[...e.mobile_numbers],t=Ad({status:1,mobile_number:{sim_num:"",mobile_id:0}})):"emails"===c&&(m=[...e.emails],t=Dd({email:"",email_id:0})),m.push(t),d.add("".concat(c,".").concat(m.length-1))}else if("DELETE"===a){"mobile_numbers"===c?m=[...e.mobile_numbers]:"emails"===c&&(m=[...e.emails]),m.splice(r,1);d.forEach(e=>{e.includes("".concat(c,".").concat(r))&&d.delete(e)})}else{i=e[n];let t=n;if(o=l,["middle_name","sex"].includes(n)&&(o=l||null),"sim_num"===n&&(o=l.replace(/[()+-\s]/g,"")),"undefined"===typeof c&&(s=Cd(n,o,i.required)),m=[],["status","sim_num"].includes(n)){m=[...e.mobile_numbers];let a={};if("status"===n)i=m[r][n],a=m[r];else{i=m[r].mobile_number[n],a=m[r].mobile_number}s=Cd(n,o,i.required);const l=Object(u.a)(Object(u.a)({},i),{},{value:o,helper_text:s});a[n]=l,t="mobile_numbers.".concat(r)}if("email"===n){m=[...e.emails];const a=m[r];i=a[n],s=Cd(n,o,i.required);const l=Object(u.a)(Object(u.a)({},i),{},{value:o,helper_text:s});a[n]=l,t="emails.".concat(r)}"undefined"!==typeof c&&(d.has(t)&&d.delete(t),t+=".".concat(n)),s?d.add(t):d.delete(t)}switch(a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},i),{},{value:o,helper_text:s}),field_with_error:d});case"UPDATE_MOBILE":return Object(u.a)(Object(u.a)({},e),{},{mobile_numbers:m,field_with_error:d});case"UPDATE_EMAIL":return Object(u.a)(Object(u.a)({},e),{},{emails:m,field_with_error:d});case"ADD":return Object(u.a)(Object(u.a)({},e),{},{[c]:m,field_with_error:d});case"DELETE":return Object(u.a)(Object(u.a)({},e),{},{[c]:m,field_with_error:d});default:return Object(u.a)({},e)}}function Dd(e){return Object(u.a)(Object(u.a)({},e),{},{email:{value:e.email,helper_text:null,required:!0}})}function Ad(e){const t=e.mobile_number;return Object(u.a)(Object(u.a)({},e),{},{status:{value:e.status,helper_text:null,required:!1},mobile_number:Object(u.a)(Object(u.a)({},t),{},{sim_num:{value:t.sim_num,helper_text:null,required:!0}})})}function Id(e){const t={},a=["middle_name","sex","birthday"];return Object.keys(e).forEach(n=>{let l={value:e[n],helper_text:null,required:!a.includes(n)};"mobile_numbers"===n&&(l=e[n].map(e=>Ad(e))),"emails"===n&&(l=e[n].map(e=>Dd(e))),t[n]=l}),t.field_with_error=new Set,t}function Md(e){return Object(ho.conformToMask)(e,Sd).conformedValue}function Td(e){const t=e.classes,a=e.selectedUserDetails,r=e.setIsEdit,c=Object(n.useReducer)(wd,a,Id),s=Object(o.a)(c,2),m=s[0],d=s[1],b=Object(n.useContext)(sa).setRefreshUser,E=Object(i.b)().enqueueSnackbar;return l.a.createElement(n.Fragment,null,l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,style:{marginTop:8}},l.a.createElement(y.a,{item:!0,xs:6,sm:3},l.a.createElement(g.a,{label:"First Name",required:!0,value:m.first_name.value||"",onChange:e=>d({type:"UPDATE",field:"first_name",value:e.target.value}),helperText:m.first_name.helper_text||"",error:Boolean(m.first_name.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,sm:3},l.a.createElement(g.a,{label:"Last Name",required:!0,value:m.last_name.value||"",onChange:e=>d({type:"UPDATE",field:"last_name",value:e.target.value}),helperText:m.last_name.helper_text||"",error:Boolean(m.last_name.helper_text)})),l.a.createElement(y.a,{item:!0,xs:6,sm:3},l.a.createElement(g.a,{label:"Middle Name",value:m.middle_name.value||"",onChange:e=>d({type:"UPDATE",field:"middle_name",value:e.target.value})})),l.a.createElement(y.a,{item:!0,xs:6,sm:3},l.a.createElement(g.a,{label:"Nickname",required:!0,value:m.nickname.value||"",onChange:e=>d({type:"UPDATE",field:"nickname",value:e.target.value}),helperText:m.nickname.helper_text||"",error:Boolean(m.nickname.helper_text),disabled:!0})),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(Bl.b,{autoOk:!0,label:"Birthday",value:m.birthday.value||null,onChange:e=>d({type:"UPDATE",field:"birthday",value:e}),helperText:m.birthday.helper_text||"",error:Boolean(m.birthday.helper_text),ampm:!1,placeholder:"01/01/2000",format:"MM/DD/YYYY",mask:"__/__/____",clearable:!0,disableFuture:!0}))),l.a.createElement(y.a,{item:!0,xs:6},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(wa.a,{id:"sex-label"},"Sex"),l.a.createElement(Da.a,{labelId:"sex-label",id:"sex-select",value:m.sex.value||"",onChange:e=>d({type:"UPDATE",field:"sex",value:e.target.value})},l.a.createElement(B.a,{value:""},"---"),l.a.createElement(B.a,{value:"M"},"Male"),l.a.createElement(B.a,{value:"F"},"Female")))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(V.a,null)),l.a.createElement(y.a,{item:!0,xs:12,lg:6,container:!0,spacing:1},l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"h6",align:"center"},"Contact Numbers"),m.mobile_numbers.map((e,t)=>{const a=e.mobile_number,n=a.sim_num,r=a.mobile_id,c=e.status,i=0!==r;return l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:t},l.a.createElement(y.a,{item:!0,xs:7},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{label:"Mobile Number",required:!0,value:Md(n.value),onChange:e=>d({type:"UPDATE_MOBILE",field:"sim_num",value:e.target.value,key:t,category:"mobile_numbers"}),InputProps:{inputComponent:jd,inputProps:{mask:kd}},helperText:n.helper_text||"",error:Boolean(n.helper_text)}))),l.a.createElement(y.a,{item:!0,xs:i?5:3,container:!0,justify:"center"},l.a.createElement(mt.a,{style:{margin:0},control:l.a.createElement(Lt.a,{checked:Boolean(c.value),onChange:e=>d({type:"UPDATE_MOBILE",field:"status",value:e.target.checked?1:0,key:t,category:"mobile_numbers"}),color:"primary"}),label:"Active"})),!i&&l.a.createElement(y.a,{item:!0,xs:2,container:!0,justify:"center"},l.a.createElement(Y.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>d({type:"DELETE",key:t,category:"mobile_numbers"})},l.a.createElement(Or.a,null))))}),l.a.createElement(y.a,{item:!0,xs:12,className:t.alignRight},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:l.a.createElement(as.a,null),onClick:()=>d({type:"ADD",category:"mobile_numbers"})},"Add number"))),l.a.createElement(y.a,{item:!0,xs:12,lg:6,container:!0,spacing:1},l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"h6",align:"center"},"Emails"),0===m.emails.length&&l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),m.emails.map((e,t)=>{const a=e.email,n=0!==e.email_id;return l.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:t},l.a.createElement(y.a,{item:!0,xs:n?12:10},l.a.createElement(ot.a,{fullWidth:!0},l.a.createElement(g.a,{required:!0,label:"Email Address",value:a.value,onChange:e=>d({type:"UPDATE_EMAIL",field:"email",value:e.target.value,key:t,category:"emails"}),helperText:a.helper_text||"",error:Boolean(a.helper_text)}))),!n&&l.a.createElement(y.a,{item:!0,xs:2,container:!0,justify:"center"},l.a.createElement(Y.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>d({type:"DELETE",key:t,category:"emails"})},l.a.createElement(Or.a,null))))}),l.a.createElement(y.a,{item:!0,xs:12,className:t.alignRight},l.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:l.a.createElement(as.a,null),onClick:()=>d({type:"ADD",category:"emails"})},"Add email"))),l.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end",style:{marginTop:8}},l.a.createElement(p.a,{color:"secondary",variant:"contained",style:{marginRight:6},disabled:m.field_with_error.size>0,onClick:()=>{const e=function(e){const t={},a=Object(Fr.cloneDeep)(e);return delete a.field_with_error,Object.keys(a).forEach(e=>{let n=null;if("mobile_numbers"===e)n=a[e].map(e=>{const t=e.mobile_number,a=e.status;return Object(u.a)(Object(u.a)({},e),{},{status:a.value,mobile_number:Object(u.a)(Object(u.a)({},t),{},{sim_num:t.sim_num.value})})});else if("emails"===e)n=a[e].map(e=>Object(u.a)(Object(u.a)({},e),{},{email:e.email.value}));else if("birthday"===e){const t=a[e].value;n="string"===typeof t?t:t.format("YYYY-MM-DD")}else n=a[e].value;t[e]=n}),t}(m);console.log("Final",e),function(e,t){const a="".concat(ee.b,"/api/users/update_user_info");ae.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const t=e.status,a=e.message;E(a,{variant:t,autoHideDuration:5e3}),"success"===t&&(r(!1),b(!0))})}},"Save"),l.a.createElement(p.a,{color:"primary",variant:"contained",onClick:()=>r(!1)},"Cancel"))))}function Nd(e){const t=e.classes,a=e.selectedUserDetails,r=a.first_name,c=a.last_name,i=a.middle_name,o=a.nickname,s=a.birthday,m=a.sex,d=a.mobile_numbers,u=a.emails,p=["","NA",null].includes(i)?"":"".concat(i,"."),b=null===s?"---":X()(s).format("MMMM DD, YYYY");let g="---";null!==m&&(g="F"===m.toUpperCase()?"Female":"Male");const E=e=>{if(!e.match(/[()+-\s]/g)){return new yd.a("(+000) 00-000-0000").apply(e)}return e};return l.a.createElement(n.Fragment,null,l.a.createElement(v.a,{component:y.a,item:!0,xs:12,gutterBottom:!0,variant:"h5"},"".concat(r," ").concat(p," ").concat(c)),l.a.createElement(v.a,{component:y.a,item:!0,xs:12,variant:"body2",color:"textSecondary",gutterBottom:!0,className:t.nickname},o),l.a.createElement(y.a,{item:!0,xs:12,container:!0,style:{marginBottom:16}},l.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},l.a.createElement(Ed.a,{style:{paddingRight:8}}),l.a.createElement(v.a,{variant:"h6"},b)),l.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},l.a.createElement(fd.a,{style:{paddingRight:8}}),l.a.createElement(v.a,{variant:"h6"},g))),l.a.createElement(y.a,{item:!0,xs:12,lg:6},l.a.createElement(v.a,{variant:"h6"},"Contact Numbers"),l.a.createElement(kn.a,{dense:!0},0===d.length?l.a.createElement(Cn.a,{className:t.listBody},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(tt.a,null))),l.a.createElement(wn.a,{primary:"No mobile numbers saved"})):d.map(e=>l.a.createElement(Cn.a,{className:t.listBody,key:e.mobile_number.mobile_id},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(tt.a,null))),l.a.createElement(wn.a,{primary:E(e.mobile_number.sim_num),secondary:"Status: ".concat(0===e.status?"Inactive":"Active")}))))),l.a.createElement(y.a,{item:!0,xs:12,lg:6},l.a.createElement(v.a,{variant:"h6"},"Emails"),l.a.createElement(kn.a,{dense:!0},0===u.length?l.a.createElement(Cn.a,{className:t.listBody},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(um.a,null))),l.a.createElement(wn.a,{primary:"No email addresses saved"})):u.map(e=>l.a.createElement(Cn.a,{className:t.listBody,key:e.email_id},l.a.createElement(Wo.a,null,l.a.createElement(Go.a,null,l.a.createElement(um.a,null))),l.a.createElement(wn.a,{primary:e.email}))))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(v.a,{variant:"h6"},"Monitoring Shifts"),l.a.createElement(pr,{nickname:o})))}var Yd=function(e){const t=e.selectedUserDetails,a=e.isUser,r=e.url,c=xd(),i=Object(n.useState)(!1),m=Object(o.a)(i,2),d=m[0],u=m[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],E=b[1],f=()=>{u(!0),E(!1)},h=()=>l.a.createElement(n.Fragment,null,l.a.createElement(Y.a,{className:c.editButton,onClick:()=>E(!0)},l.a.createElement(vr.a,{color:"primary"})),l.a.createElement(lt.a,{onClose:()=>E(!1),"aria-labelledby":"simple-dialog-title",open:g},l.a.createElement(rt.a,{id:"simple-dialog-title"},"Profile options"),l.a.createElement(kn.a,null,l.a.createElement(Cn.a,{button:!0,onClick:f},l.a.createElement(Dn.a,null,l.a.createElement(vr.a,null)),l.a.createElement(wn.a,{primary:"Edit info"})),l.a.createElement(s.b,{to:"".concat(r,"/credentials"),className:c.link},l.a.createElement(Cn.a,{button:!0},l.a.createElement(Dn.a,null,l.a.createElement(hd.a,null)),l.a.createElement(wn.a,{primary:"Update credentials"}))))));return l.a.createElement(n.Fragment,null,l.a.createElement(gd.a,{component:"img",height:"200",className:c.media,image:Od.a,title:"Dynaslope Header Pic"}),l.a.createElement(q.a,{className:c.alignCenter},l.a.createElement(y.a,{container:!0,justify:"center"},l.a.createElement(y.a,{container:!0,item:!0,xs:12,className:c.avatarContainer,justify:"center"},l.a.createElement(R.a,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:a&&!d&&l.a.createElement(h,null)},l.a.createElement(Go.a,{className:c.avatar,src:Jo.a}))),d?l.a.createElement(Td,{classes:c,selectedUserDetails:t,setIsEdit:u}):l.a.createElement(Nd,{classes:c,selectedUserDetails:t}))))};const Rd=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(fe.d)(e)),{},{schedIcon:{width:50,height:50,display:"flex"},margin:{margin:e.spacing(1)},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1}})),Hd=l.a.forwardRef((e,t)=>l.a.createElement(P.a,Object.assign({direction:"up",ref:t},e)));var Bd=function(e){const t=e.match.url,a=Rd(),r=Object(n.useContext)(sa).users,c=Object(j.a)(),i=Object(n.useState)(null),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)(null),p=Object(o.a)(u,2),b=p[0],g=p[1],E=Object(n.useState)(!0),f=Object(o.a)(E,2),h=f[0],_=f[1],v=Object(n.useState)(!1),O=Object(o.a)(v,2),x=O[0],k=O[1],S=Object(n.useState)(!1),C=Object(o.a)(S,2),w=C[0],D=C[1];Object(n.useEffect)(()=>{d(r)},[r]),Object(n.useEffect)(()=>{if("undefined"!==typeof m&&null!==m){const e=m.filter(e=>{if(e.user_id===c.user_id)return e});g(e[0])}},[m]),Object(n.useEffect)(()=>{"undefined"!==typeof b&&null!==b&&(b.user_id===c.user_id?k(!0):k(!1),b.teams.forEach(e=>{D("web-admin"===e.team.team_name)}))},[b]);const A=()=>{_(!1)};return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(ze,{title:"Dynaslope | Staff Profiles"})),l.a.createElement("div",{className:a.pageContentMargin},l.a.createElement(y.a,{container:!0,justify:"center",spacing:2},null!==m&&l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(bd,{users:m,onMemberClickFn:e=>()=>{g(e),_(!0)},isWebAdmin:w,isUser:x,selectedUserDetails:b})),null!==b&&l.a.createElement(n.Fragment,null,l.a.createElement(Me.a,{smDown:!0},l.a.createElement(y.a,{item:!0,xs:12,md:8},"undefined"!==typeof b&&l.a.createElement(G.a,null,l.a.createElement(Yd,{currentUser:c,selectedUserDetails:b,isUser:x,isAdmin:w,url:t})))),l.a.createElement(Me.a,{mdUp:!0},l.a.createElement(lt.a,{fullScreen:!0,open:h,onClose:A,TransitionComponent:Hd},l.a.createElement(M.a,{className:a.appBar},l.a.createElement(T.a,{style:{justifyContent:"flex-end"}},l.a.createElement(Y.a,{edge:"end",color:"inherit",onClick:A,"aria-label":"close"},l.a.createElement(Rt.a,null)))),"undefined"!==typeof b&&l.a.createElement(Yd,{currentUser:c,selectedUserDetails:b,isUser:x,isAdmin:w,url:t})))))))},Pd=a(610),Ld=a.n(Pd),Fd=a(1143),Ud=a(611),zd=a.n(Ud),Wd=a(612),Gd=a.n(Wd),qd=a(609),Vd=a.n(qd);const Qd=Object(O.a)(e=>({paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},avatar_success:{margin:e.spacing(1),backgroundColor:"green"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},form_display:{display:"block"},form_hide:{display:"none"}}));function Zd(e){const t=e.history,a=Qd(),r=Object(n.useState)(""),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)(""),d=Object(o.a)(m,2),u=d[0],b=d[1],E=Object(n.useState)(""),f=Object(o.a)(E,2),h=f[0],_=f[1],y=Object(n.useState)(""),O=Object(o.a)(y,2),x=O[0],k=O[1],S=Object(n.useState)(""),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(!0),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)(!1),R=Object(o.a)(N,2),H=R[0],B=R[1],P=Object(n.useState)("error"),L=Object(o.a)(P,2),F=L[0],U=L[1],z=Object(n.useState)("Update login credentials"),W=Object(o.a)(z,2),G=W[0],q=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(j.a)().user_id;Object(n.useEffect)(()=>{h.length>5||x.length>5?h===x?(s("Enter your old password below"),T(!1),U("primary")):(s("Passwords did not matched"),T(!0),U("error")):(s("Password too short"),U("error")),0!==h.length&&0!==x.length||s("")},[h,x]);const X=()=>{t.push("/profile")};return l.a.createElement(Fd.a,{component:"main",maxWidth:"xs"},l.a.createElement("div",{className:a.paper},l.a.createElement(Go.a,{className:Z?a.avatar_success:a.avatar},Z?l.a.createElement(Vd.a,null):l.a.createElement(Ld.a,null)),l.a.createElement(v.a,{component:"h1"},G),l.a.createElement("div",{className:Z?a.form_hide:a.form_display},l.a.createElement(g.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"New username (leave empty if no changes)",name:"Username",onChange:e=>b(e.target.value)}),l.a.createElement(g.a,{variant:"outlined",margin:"normal",fullWidth:!0,type:H?"text":"password",label:"New password",id:"password1",onChange:e=>_(e.target.value),InputProps:{endAdornment:l.a.createElement(om.a,{position:"end"},l.a.createElement(Y.a,{"aria-label":"toggle password visibility",onClick:()=>B(!H)},H?l.a.createElement(zd.a,null):l.a.createElement(Gd.a,null)))}}),l.a.createElement(g.a,{variant:"outlined",margin:"normal",type:"password",fullWidth:!0,id:"password2",label:"Confirm new password",onChange:e=>k(e.target.value)}),l.a.createElement(v.a,{variant:"body2",color:F},i),l.a.createElement(g.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"currentpassword",label:"Current password",type:"password",id:"password",autoComplete:"current-password",disabled:M,onChange:e=>D(e.target.value)})),l.a.createElement(p.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:a.submit,disabled:M,onClick:Z?X:()=>{!function(e,t){const a="".concat(ee.b,"/api/users/update_account");ae.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({user_id:J,username:u,new_password:h,old_password:w},e=>{"success"===e?(q("Account update success"),K(!0)):(K(!1),s("Invalid old password"),U("error"))})}},Z?"go to profile":"save changes"),!Z&&l.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:X},"Cancel")))}var Kd=a(614),Jd=a.n(Kd),Xd=a(613),$d=a.n(Xd),eu=a(421),tu=a.n(eu),au=a(616),nu=a.n(au),lu=a(615),ru=a.n(lu);const cu=Object(O.a)(e=>({paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.primary.main,padding:5},successIcon:{margin:e.spacing(1),width:70,height:70,color:"green",backgroundColor:"white"},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)},hide:{display:"none"},flex:{display:"flex"}}));function iu(e){const t=e.inputRef,a=e.mask,n=Object(Qt.a)(e,["inputRef","mask"]);return l.a.createElement(_o.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}const ou=[{value:"Mr.",label:"Mr."},{value:"Ms.",label:"Ms."},{value:"Mrs.",label:"Mrs."}];function su(){const e=cu(),t=Object(n.useContext)(sa).setRefreshUser,a=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],r=Object(n.useState)(""),c=Object(o.a)(r,2),i=c[0],s=c[1],m=Object(n.useState)(""),d=Object(o.a)(m,2),u=d[0],b=d[1],E=Object(n.useState)(""),f=Object(o.a)(E,2),h=f[0],_=f[1],O=Object(n.useState)(""),x=Object(o.a)(O,2),j=x[0],k=x[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),w=C[0],D=C[1],A=Object(n.useState)(""),I=Object(o.a)(A,2),M=I[0],T=I[1],N=Object(n.useState)([]),R=Object(o.a)(N,2),H=R[0],B=R[1],P=Object(n.useState)(""),L=Object(o.a)(P,2),F=L[0],U=L[1],z=Object(n.useState)(""),W=Object(o.a)(z,2),G=W[0],q=W[1],Q=Object(n.useState)(""),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],$=Object(n.useState)(!1),te=Object(o.a)($,2),ne=te[0],le=te[1],re=Object(n.useState)(null),ce=Object(o.a)(re,2),ie=ce[0],oe=ce[1],se=Object(n.useState)("m"),me=Object(o.a)(se,2),de=me[0],ue=me[1],pe=Object(n.useState)("Mr."),be=Object(o.a)(pe,2),ge=be[0],Ee=be[1],fe=Object(n.useState)(!0),he=Object(o.a)(fe,2),_e=he[0],ye=he[1];Object(n.useEffect)(()=>{ye(""===G||""===K)},[G,K]);const ve=()=>{const e=H.map(e=>e.replace(/[()+-\s]/g,"")),a=[];e.forEach(e=>{const t={mobile_number:{mobile_id:0,sim_num:e},status:1};a.push(t)});!function(e,t){const a="".concat(ee.b,"/api/users/create_dynaslope_user");ae.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({user_id:0,first_name:i,middle_name:u,last_name:h,nickname:j,salutation:ge,birthday:ie,sex:de,emails:w,mobile_numbers:""!==e?a:[],landline_numbers:[],ewi_recipient:0,status:1,username:G,password:K},e=>{e.status&&(le(!0),t(!0))})};return l.a.createElement(Fd.a,{component:"main",maxWidth:"xs"},l.a.createElement("div",{className:e.paper},l.a.createElement(Go.a,{className:ne?e.successIcon:e.avatar},ne?l.a.createElement($d.a,{className:e.successIcon}):l.a.createElement(Jd.a,null)),l.a.createElement(v.a,{component:"h1",variant:"h5"},ne?"New user was created!":" Create Dynaslope User"),l.a.createElement("div",{className:ne?e.hide:e.form},l.a.createElement(y.a,{container:!0,spacing:2},l.a.createElement(y.a,{item:!0,xs:12,md:3},l.a.createElement(g.a,{variant:"outlined",value:ge,fullWidth:!0,select:!0,onChange:e=>Ee(e.target.value),SelectProps:{native:!0}},ou.map(e=>l.a.createElement("option",{key:e.value,value:e.value},e.label)))),l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(g.a,{variant:"outlined",value:i,label:"First Name",fullWidth:!0,onChange:e=>s(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12,sm:5},l.a.createElement(g.a,{variant:"outlined",value:u,label:"Middle Name",fullWidth:!0,onChange:e=>b(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(g.a,{variant:"outlined",value:h,label:"Last Name",fullWidth:!0,onChange:e=>_(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12,sm:6},l.a.createElement(g.a,{variant:"outlined",value:j,fullWidth:!0,label:"Nickame",onChange:e=>k(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12,md:4},l.a.createElement(g.a,{variant:"outlined",value:de,fullWidth:!0,select:!0,onChange:e=>ue(e.target.value),SelectProps:{native:!0}},l.a.createElement("option",{value:"m"},"Male"),l.a.createElement("option",{value:"f"},"Female"))),l.a.createElement(y.a,{item:!0,xs:12,md:8},l.a.createElement(Ft.a,{utils:zt.a},l.a.createElement(Bl.b,{disableToolbar:!0,variant:"dialog",format:"yyyy-MM-DD",margin:"normal",label:"Birth Date",value:ie,onChange:e=>(e=>{const t=X()(e).format("yyy-MM-DD");oe(t)})(e),KeyboardButtonProps:{"aria-label":"change date"},placeholder:"YYYY-MM-DD",fullWidth:!0,style:{marginTop:0},disableFuture:!0,maxDate:X()().subtract(15,"years")}))),H.length>0&&H.map((t,n)=>l.a.createElement(y.a,{item:!0,xs:12,key:t,className:e.flex},l.a.createElement(g.a,{variant:"outlined",value:t,fullWidth:!0,label:"Phone",InputProps:{inputComponent:iu,inputProps:{mask:a}}}),l.a.createElement(Ke.a,{title:"remove from list"},l.a.createElement(Y.a,{variant:"contained",style:{margin:2,color:"red"},onClick:e=>(e=>{const t=H;t.splice(e,1),B([...t])})(n)},l.a.createElement(ru.a,null))))),l.a.createElement(y.a,{item:!0,xs:12,className:e.flex},l.a.createElement(g.a,{variant:"outlined",value:F,fullWidth:!0,onChange:e=>U(e.target.value),placeholder:"Mobile Number",InputProps:{inputComponent:iu,inputProps:{mask:a}}}),l.a.createElement(Ke.a,{title:"add to list"},l.a.createElement(Y.a,{color:"primary",variant:"contained",style:{margin:2},onClick:e=>(()=>{if(F.length>0){const e=H;e.push(F),B([...e]),U("")}})()},l.a.createElement(nu.a,null)))),l.a.createElement(V.a,null),w.length>0&&w.map((e,t)=>l.a.createElement(y.a,{item:!0,xs:12,key:e},l.a.createElement(Ia.a,{fullWidth:!0,value:e,onChange:e=>T(e.target.value),endAdornment:l.a.createElement(om.a,{position:"end"},l.a.createElement(Ke.a,{title:"Remove email from list"},l.a.createElement(Y.a,{onClick:e=>(e=>{const t=w;t.splice(e,1),D([...t])})(t)},l.a.createElement(tu.a,null))))}))),l.a.createElement(y.a,{item:!0,xs:12},l.a.createElement(Ia.a,{fullWidth:!0,placeholder:w.length>0?"Add another email":"Email",value:M,onChange:e=>T(e.target.value),endAdornment:l.a.createElement(om.a,{position:"end"},l.a.createElement(Ke.a,{title:"add email to list"},l.a.createElement(Y.a,{color:"primary",onClick:e=>(()=>{if(M.length>0){const e=w;e.push(M),D([...e]),T("")}})()},l.a.createElement(Vs.a,null))))})),l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(g.a,{variant:"outlined",value:G,fullWidth:!0,label:"username",type:"text",onChange:e=>q(e.target.value)})),l.a.createElement(y.a,{item:!0,xs:12,md:6},l.a.createElement(g.a,{variant:"outlined",value:K,fullWidth:!0,label:"Password",type:"password",onChange:e=>J(e.target.value)})))),l.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",className:e.submit,onClick:ne?e=>{window.location.href=ee.c}:e=>ve(),disabled:!ne&&_e},ne?"Dashboard":"Create"),ne&&l.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:e=>(s(""),b(""),_(""),k(""),ue(""),oe(null),Ee(""),q(""),J(""),D([]),B([]),ye(!0),void le(!1))},"Create another account")))}var mu=function(e){const t=e.location,a=e.match.url;return l.a.createElement(m.d,{location:t},l.a.createElement(m.b,{exact:!0,path:a,component:gl}),l.a.createElement(m.b,{path:"".concat(a,"monitoring/events"),component:Rl}),l.a.createElement(m.b,{path:"".concat(a,"monitoring/shifts_and_reports"),component:_r}),l.a.createElement(m.b,{path:"".concat(a,"monitoring/issues_and_reminders"),component:Br}),l.a.createElement(m.b,{path:"".concat(a,"monitoring/logs"),component:Mr}),l.a.createElement(m.b,{path:"".concat(a,"monitoring/qa"),component:lc}),l.a.createElement(m.b,{path:"".concat(a,"monitoring"),render:()=>l.a.createElement("h3",null," Not yet created")}),l.a.createElement(m.b,{path:"".concat(a,"analysis/sites"),component:Xi}),l.a.createElement(m.b,{path:"".concat(a,"analysis/alerts"),component:uo}),l.a.createElement(m.b,{path:"".concat(a,"analysis/forms/loggers_and_sensors"),component:Fo}),l.a.createElement(m.b,{path:"".concat(a,"analysis"),render:()=>l.a.createElement("h3",null," Not yet created")}),l.a.createElement(m.b,{path:"".concat(a,"communication/chatterbox"),component:cm}),l.a.createElement(m.b,{path:"".concat(a,"communication/contacts"),component:Hm}),l.a.createElement(m.b,{path:"".concat(a,"communication/mailbox"),component:Gm}),l.a.createElement(m.b,{path:"".concat(a,"communication"),render:()=>l.a.createElement("h3",null,"Sorry. We could not find what you are looking for.")}),l.a.createElement(m.b,{path:"".concat(a,"community/site_info"),component:ud}),l.a.createElement(m.b,{path:"".concat(a,"profile/credentials"),component:Zd}),l.a.createElement(m.b,{path:"".concat(a,"profile/create"),component:su}),l.a.createElement(m.b,{path:"".concat(a,"profile"),component:Bd}),l.a.createElement(m.b,{render:()=>l.a.createElement("h3",null," Not found")}))};var du=function(e){const t=e.match.params,a=t.site_code,r=t.ts_end,c=t.chart_type,s=t.tsm_sensor,m=Object(n.useState)(""),d=Object(o.a)(m,2),u=d[0],p=d[1],b=Object(n.useState)(""),g=Object(o.a)(b,2),E=g[0],f=g[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),y=_[0],v=_[1],x=Object(i.b)().enqueueSnackbar,k=Object(j.a)(),S=Object(O.a)(e=>Object(fe.d)(e))();Object(n.useEffect)(()=>{x("Please wait for the charts to load before closing the page. If loading took long enough, please wait for about a minute and check your connection before trying again. If loading problem persist, contact the developers.",{variant:"warning",autoHideDuration:1e4,style:{whiteSpace:"pre-line"},anchorOrigin:{vertical:"top",horizontal:"center"}});const t={site_code:a,ts_end:r};let n;"rainfall"===c?(n=l.a.createElement(li,Object.assign({},e,{input:t,currentUser:k,disableBack:!0,saveSVG:!0})),p(n)):"surficial"===c?(n=l.a.createElement(Vc,Object.assign({},e,{input:t,currentUser:k,disableBack:!0,disableMarkerList:!0,isEndOfShift:!0,saveSVG:!0})),f(n)):"subsurface"===c&&(t.tsm_sensor=s,n=l.a.createElement(fi,Object.assign({},e,{input:t,currentUser:k,disableBack:!0,saveSVG:!0,isEOS:!0})),v(n))},[]);const C=le(c);return l.a.createElement(n.Fragment,null,l.a.createElement("div",{className:S.pageContentMargin},l.a.createElement(ze,{title:"Chart Rendering | ".concat(a.toUpperCase()," | ").concat(C)})),l.a.createElement("div",{className:S.pageContentMargin},u,E,y))};var uu=Object(d.a)(e=>({app:{height:"100%",minHeight:"85vh",display:"flex",flexDirection:"column",justifyContent:"space-between"},body:{marginTop:60,[e.breakpoints.up("sm")]:{marginTop:70},[e.breakpoints.up("md")]:{marginTop:124}}}))((function(e){const t=e.classes;Object(n.useEffect)(()=>{document.title="MIA 3.0 - Dynaslope Monitoring and Information Application"},[]);const a=Object(n.useState)(!1),r=Object(o.a)(a,2),c=r[0],i=r[1],d=e=>()=>{i(e)},u=Object(n.useState)(null),p=Object(o.a)(u,2),b=p[0],g=p[1],E=Object(n.useRef)(!1);Object(n.useEffect)(()=>(Object(j.b)(e=>{g(e),e&&(E.current=setInterval(j.e,ee.a))}),()=>clearInterval(E.current)),[]);const f=()=>{g(!0),E.current=setInterval(j.e,ee.a)},h=()=>{g(!1),clearInterval(E.current)};return l.a.createElement(s.a,null,l.a.createElement(m.d,null,l.a.createElement(m.b,{path:"/bulletin/:release_id",component:Nt}),l.a.createElement(m.b,{path:"/chart_rendering/:site_code/:ts_end/:chart_type/:tsm_sensor?",component:du}),l.a.createElement(m.b,{exact:!0,path:"/login",render:e=>null===b?l.a.createElement("div",null,"Loading..."):b?l.a.createElement(m.a,{to:"/"}):l.a.createElement(I,Object.assign({},e,{onLogin:f}))}),l.a.createElement(m.b,{path:"/",render:e=>null===b?l.a.createElement("div",null,"Loading..."):b?l.a.createElement(ma,null,l.a.createElement(Ba,null,l.a.createElement(we.b,null,l.a.createElement(pe,null,l.a.createElement(_e,Object.assign({},e,{drawerHandler:d,onLogout:h})),l.a.createElement(Ie,Object.assign({},e,{drawerHandler:d,drawer:c,onLogout:h}))),l.a.createElement("div",{className:t.app},l.a.createElement("div",{className:t.body},l.a.createElement(mu,e))),l.a.createElement(N,null)))):l.a.createElement(m.a,{to:"/login"})})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function pu(){}console.log=pu,console.warn=pu,console.error=pu,c.a.render(l.a.createElement(i.a,{maxSnack:3,anchorOrigin:{vertical:"bottom",horizontal:"right"}},l.a.createElement(uu,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},120:function(e,t){e.exports="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAgMAAAACc8MQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURcXFxf///+np6dbW1sCaIHAAAAnDSURBVHja7d0xbuw2FEBRNW7UaGtu1LDR1tiwcTNbU6NmGgcJEqQIkPx4SOq9uffuQAcg+Uj/by+LmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ5e77+fW1/1H5+vo+BYB9/Z/f/nflcQpAafvH1/9lIAD58zEEcIDtuf9r5VuAt+7Z9v/q6xQAuf8hdkI6wHfbf613nYrpAM/9lyunAOjvf08BOMCvnYBvfBbSAba2/98eArC//70E8AA/+f59rwIgZ6B3nIboAD/8/vcRoAP8+PvfRYAOsO0vdAjAnILfaR7GA7z2/W8wD9MBni9+f/qTkA6w7S93CEDeAtNvg3SAZ4fvT70N0gG2vUuHAOQtMPU2SAd4dvr+tNsgHWDrtQKyPovgAbqtgKxrgA6w7R07BMjX1RNgPwVAr4CMawAP0PoC5LsQ0QHWzt+/FwHYKyDdGqADbN2/P9lBiAe4+gPkmobpAANWQK41gAcYsQJSrQE6wNaGADwEAD6I53wcxwOMWQGJ7kN0gHXQ96d5FMEDXKMAsoxCdIBt2PcnuQ/hAdZxAEUA8hiUZhSiAwzcA3PsgniAayRAhlEID9CGAlQBwGNQjlEIDzB2D0ywC+IB2mCAKgB4EM4wDOMBRu+B4XdBPEAbDlAFQO+B0XdBPMA6HqAIwD4Fg5+DeIA2AaAKgN4DY++CeIAZe2DoXRAP0KYAVAHAV6HY1yE8wDoHoAjAPgUDn4N4gDYJoAoggADgOSjuJIQHWGcBFAHYc1DYSQgP0KYBVAHQp2DUc1AAAeAA6zyAIgB7Dgo6CeEB2kSAKoAAAoDnoJiTEB5gnQlQBBBAAPIkHHIWFkAAOECbClAFCNfU798/BUDfhSLehvAA61yAIoAAAsTqYy7ALgD7LhTwNoQHaJMBqgACCAC+DQe8DwsgABtgmw1wCCCAAOD3kHgvIgIIAAeY/SIW7k1MAAHgANd0gFMAAQQQQADsq3i4d3EBBBBAAAEEEEAALMD074/201EBBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAAMgD8bFEAAAQQQQAABBKACXNMB/P8CAggggABx8v8OCyAAG8DfISKAAGwAf5eYAAKwAfydogIIAAfwd4sLIAAbYParqH9jJBqAf2eIDuDfGhNAADaAf3OUDuDfHcYD+LfH6QBzb0OnAAIIQJ6F403CAgiAB5h6GzoECNjMWbgKIIAA6Fn4FIA9CUWcgwSYOQkdAgggAHoSqgKE7GLPQQLMm4RizkECzDsHDwGC1tinoAAC4AEu9hwkwKxJKOocJMCsSegQIGyNfQoKMOkcPAVgn4NxT0EB5uyCVYCFvQueArB3wdB7oAATrkOHAKFr7FNQgAnn4CkAexcMvgcKMHwXrAIs7F3wFCB4g69DZRGAvQtWARb2LngKEL4NPQgLMHgXrAIkaEWPQQIM3QUPAVJ0kccgAUbugjn2QAHGjUJVgCQ9B62AU4AkbWPWwGMRIEsXeQwSYNR96FgEYK+BUwD2Gki1AgQYcB+qAqSq+6NIWQRgr4EqQLI29CEoQPdp+BSAvQYSrgABej6Ol1OAjGug3yz0WARAr4GcK0CAfheiugiQsw08BQnQbxtMuwUK0GkbrIsAC3kbPBYBMvdEb4ECdNgG6yJA7l58FnksAqQXAJ+BArx6EqY/AwV4TeBNvl+Anwq8zfcL8MN5uC4CvEfbD5fA4xTgPb6/wY9BOsDzhftweQhAvgq9x4MIHGD7evVZ/OsUgPsimv8spAP0+aeSiQXoAL3+rWxaATpAv38snVSADtDzd+mkFKAD9P1lSgkF6AC9f5tWOgE6QP9fp5ZMgA4w4vfppRLAA1z7gA4BKE/h+Z/I6QCDvj+PAB1g4B9YOAWADkGphiE8wNA/t1cE4J6BWU5COsDgv7ka/9/P0gG20X95O/pJiAe49uEdAnDPwPgnIR1g/BYYfBvEA0z5/sg3IjrAc5/UQwDwFhh4G8QDXPu0DgGITyHRn0XoAPO2wKDbIB7guU/tIUC0FbBP7hQAOwXFnIXoAOs+vSoA8DEs7sMYHeC539BDAOhFKOCFCA9wywqItAboAPesgEBrAA9w0wqIswboANt+W6cAyLeQaK8idIAbV0CMNYAHuO4EOARgr4AIawAPcN0LcAgAvQqHuRLjAZ77zT0EQK+A29cAHuD2FXD3GsADtPsBigA3tu4BqgKgV8C9a4AOEGIF3LkG8ABXDIBDAOZ76P0vo3iAZxSAhwDgMejOUYgOsO5hqgKgV8Bda4AOsO2BOgXA3oTuuw/hAVokgCIAeQy6ZxTCA1yxAA4ByGPQHaMQHmCNBlAFAI9Bd4xCdIBwe+DsXRAPcMUDOARA74Gzd0E6wLoHrAqA3gPn7oJ4gBYRoAjA3gNn7oJ4gCsmwCEAeg+cuQvSAYLugfN2QTzAFRXgEAC9B87bBekAYffAWbsgHuCKC3AIgN4DZ+2CdIBtD9wpAPoUnHMO4gFaZIAiAHsPnLEL4gHW2ABVAPBVaM51CA/QYgMUAdin4PhzEA+wRgeoAqD3wPG7IB0g/B44ehfEA6zxAaoA4KvQ+OsQHqDFBygCsE/BsecgHmDNAFAFQJ+CY89BPEDLAFAEYJ+CI89BPMCaA6AKgD4FR56DeICWA6AIwD4Fx52DeIA1C0AVAH0KjjsH8QAtC0ARQAAByHPQqEkID7DmAagCoOegUZMQHqDlASgCsE/BMecgHmDNBFAFEEAA8Bw0ZhLCA7RMAEUA9hw0YhLCA6y5AKoAAggAnoNGTEJ4gJYLoAjAnoP6T0ICCAAHWLMBVAHQc1D/SQgP0LIBFAEEEIA8B/WehPAAaz6AKoAAAoAn4d6zMB6g5QMoAgggAHkS7jsL4wHWjABVAAEEAE/CfWdhAQSAA7SMAEWAfu0pE4B9F+p5G8IDrDkBqgACCACehHvOwgIIAAdoOQGKAAIIQL4L9bsNCSAAHGDNClAFEEAA8F2o321IAAHgAC0rQBFAAAG4Pxz/PQHYt+Fe92EBBIADrHkBqgACCPB6H3kBPgVAv4f0ehERQAA4QMsLUAQQQADyi1inNzE6wJYZ4BRAAAHA7yF9XkQEEEAAAdAAH5kBPgVAv4j1eRMTQAABBEADtMwARQABBBBAAO7PRbr8ZEQAAdgAW26AUwABBBBAAOzPRXr8ZEQAAQQQQAABwAAfuQE+BRBAAAEEwP50vMfPxwUQQAABBBAADNByAxQBBBBAAAH+pd8AoDH47zbOd5EAAAAASUVORK5CYII="},147:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}));var n=a(2),l=a(0),r=a.n(l),c=a(81);const i=Object(l.createContext)(),o=({children:e})=>{const t=Object(l.useState)(null),a=Object(n.a)(t,2),o=a[0],s=a[1];Object(l.useEffect)(()=>{Object(c.b)(),Object(c.e)(e=>s(e))},[]);const m={server_time:o};return r.a.createElement(i.Provider,{value:m},e)}},204:function(e,t,a){e.exports=a.p+"static/media/phivolcs-dynaslope-logo.de612ba1.png"},22:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return d}));var n=a(15),l=a.n(n),r=a(10);function c(e,t){const a="".concat(r.b,"/api/refresh_session");l.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}function i(e){const t=JSON.parse(localStorage.getItem("data"));if(null!==t){const a=t.tokens,n=a.access_token,i=a.refresh_token;!function(e,t){const a="".concat(r.b,"/api/check_session");l.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(n,a=>{const n=a.is_logged_in;n&&c(i,e=>{t.tokens.access_token=e.access_token,localStorage.setItem("data",JSON.stringify(t))}),e(n)})}else e(!1)}function o(){const e=JSON.parse(localStorage.getItem("data"));c(e.tokens.refresh_token,t=>{e.tokens.access_token=t.access_token,localStorage.setItem("data",JSON.stringify(e))})}function s(e,t,a){!function(e,t){const a="".concat(r.b,"/api/login");l.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const n=e.ok,l=e.message,r=e.data;n?(localStorage.setItem("data",JSON.stringify(r)),t(r)):a(l)})}function m(e){localStorage.clear(),e()}function d(){return JSON.parse(localStorage.getItem("data")).user}},24:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return r}));const n="#FCEE27",l="#F8991D",r="#991B1E";t.d=e=>({dynaslopeLogo:{height:60},phivolcsLogo:{height:70,marginTop:8},phivolcsDynaslopeLogo:{height:62},pageContentMargin:{margin:"0 16px",[e.breakpoints.up("md")]:{margin:"0 64px"},[e.breakpoints.up("lg")]:{margin:"0 100px"}},paperContainer:{width:"100%",overflowX:"auto"},sectionHeadContainer:{margin:"20px 0"},sectionHead:{fontSize:"1.5rem",[e.breakpoints.down("xs")]:{fontSize:"1.2rem"}},extended:{backgroundColor:"green"},alert0:{backgroundColor:"#EEEEEE"},alert1:{backgroundColor:"#FCEE27"},alert2:{backgroundColor:"#F8991D","& *":{color:"white !important"}},alert3:{backgroundColor:"#991B1E","& *":{color:"white !important"}},dyna_error:{color:"#FE0000"}})},584:function(e,t,a){e.exports=a.p+"static/media/login-bg-img.6bf92800.jpg"},587:function(e,t,a){"use strict";(function(e){var n=a(2),l=a(3),r=a(0),c=a.n(r),i=a(37),o=a(74),s=a(1081),m=a(328),d=a(47),u=a(621),p=a(351),b=a(171),g=a(624),E=a(168),f=a(1067),h=a(433),_=a(1065),y=a(1066),v=a(1068),O=a(1069),x=a(7),j=a.n(x),k=a(204),S=a.n(k),C=a(24),w=a(22),D=a(147);const A=Object(o.a)(e=>Object(l.a)(Object(l.a)({},Object(C.d)(e)),{},{list:{width:300,maxWidth:360},nested:{paddingLeft:e.spacing(3)},nestedText:{fontSize:"0.9rem"},drawerHeader:{height:220,display:"block",alignItems:"center",textAlign:"center",padding:16},logo:{height:105},titleBlock:{display:"block",margin:"0 4px"},projectTitle:{fontWeight:600},link:{textDecoration:"none"}}));t.a=function(t){const a=t.drawerHandler,l=t.drawer,o=t.navigationLabels,x=t.history,k=t.onLogout,C=A(),I=Object(r.useState)({}),M=Object(n.a)(I,2),T=M[0],N=M[1],Y=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent),R=Object(w.a)().nickname,H=Object(r.useContext)(D.a).server_time;return c.a.createElement(s.a,{open:l,onClose:a(!1),onOpen:a(!0),disableBackdropTransition:!Y,disableDiscovery:Y},c.a.createElement("div",{tabIndex:0,role:"button",onKeyDown:a(!1)},c.a.createElement("div",{className:C.list},c.a.createElement(m.a,{className:C.drawerHeader},c.a.createElement("img",{src:S.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(C.phivolcsDynaslopeLogo," ").concat(C.logo)}),c.a.createElement(d.a,{variant:"h5",className:C.projectTitle},"MIA 3.0"),c.a.createElement(d.a,{variant:"subtitle2",className:C.projectSubtitle},"Monitoring and Information Application"),c.a.createElement(d.a,{variant:"subtitle1",style:{marginTop:6,fontWeight:600}},"Hello ",R,"!"),c.a.createElement(d.a,{variant:"button"},H?j()(H).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time...")),c.a.createElement(u.a,null),c.a.createElement(p.a,{component:"nav"},c.a.createElement(b.a,{button:!0,onClick:()=>{x.push("/profile")}},c.a.createElement(g.a,null,c.a.createElement(_.a,null)),c.a.createElement(E.a,{primary:"Profile"})),c.a.createElement(b.a,{button:!0,onClick:()=>{Object(w.d)(()=>{k(),x.push("/login")})}},c.a.createElement(g.a,null,c.a.createElement(y.a,null)),c.a.createElement(E.a,{primary:"Logout"}))),c.a.createElement(u.a,null),c.a.createElement(p.a,{component:"nav",subheader:c.a.createElement(f.a,{component:"div"},"Directory")},o.map(({key:e,main:t,sub:n})=>c.a.createElement(r.Fragment,{key:e},c.a.createElement(b.a,{button:!0,onClick:()=>(e=>{const t="undefined"!==typeof T[e]&&T[e];N(a=>({[e]:!t}))})(e)},c.a.createElement(E.a,{primary:t}),T[e]?c.a.createElement(v.a,null):c.a.createElement(O.a,null)),c.a.createElement(h.a,{in:T[e],timeout:"auto",unmountOnExit:!0},c.a.createElement(p.a,{component:"div",disablePadding:!0},n.map((e,t)=>{const n=e.label,l=e.link,r=e.soon,o=e.divider;if("undefined"!==typeof r){const e=c.a.createElement("span",null,n,c.a.createElement(d.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON"));return c.a.createElement(b.a,{key:n,button:!0,className:C.nested,disabled:!0},c.a.createElement(E.a,{primaryTypographyProps:{className:C.nestedText},primary:e}))}return"undefined"!==typeof o?c.a.createElement(b.a,{key:t,divider:!0,button:!1,style:{paddingTop:0,marginBottom:8}}):c.a.createElement(i.b,{to:l,key:n,className:C.link},c.a.createElement(b.a,{button:!0,className:C.nested,onClick:a(!1)},c.a.createElement(E.a,{primaryTypographyProps:{className:C.nestedText},primary:n})))})))))))))}}).call(this,a(217))},589:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-head.234377b7.png"},590:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-footer.131de212.png"},608:function(e,t,a){e.exports=a.p+"static/media/dyna_wall.d9a91c1f.jpg"},631:function(e,t,a){e.exports=a(1055)},636:function(e,t,a){},81:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"e",(function(){return m})),a.d(t,"d",(function(){return u})),a.d(t,"a",(function(){return d})),a.d(t,"g",(function(){return p})),a.d(t,"c",(function(){return b})),a.d(t,"f",(function(){return g}));var n=a(205),l=a.n(n),r=a(10),c=a(22);let i;function o(){"undefined"!==typeof i&&null!==i||(i=l()("".concat(r.b,"/misc"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function s(){o(),i.emit("get_server_time")}function m(e){i.on("receive_server_time",t=>{e(t)})}function d(){o(),i.emit("get_monitoring_shifts")}function u(e){i.on("receive_monitoring_shifts",t=>{const a=JSON.parse(t);console.log("Monitoring Shifts:",a),e(a)}),i.on("reconnect",()=>{i.emit("get_monitoring_shifts")})}function p(){i.removeListener("receive_monitoring_shifts")}function b(){const e=Object(c.a)().user_id;o(),i.emit("get_user_notifications",e)}function g(e){i.on("receive_user_notifications",t=>{console.log("Notifications:",t),e(t)}),i.on("reconnect",()=>{const e=Object(c.a)().user_id;i.emit("get_user_notifications",e)})}}},[[631,1,2]]]);
//# sourceMappingURL=main.46cc310e.chunk.js.map