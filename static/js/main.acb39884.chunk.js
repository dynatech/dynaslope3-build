(this["webpackJsonpmia-3.0"]=this["webpackJsonpmia-3.0"]||[]).push([[0],{104:function(e,t){e.exports="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAgMAAAACc8MQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURcXFxf///+np6dbW1sCaIHAAAAnDSURBVHja7d0xbuw2FEBRNW7UaGtu1LDR1tiwcTNbU6NmGgcJEqQIkPx4SOq9uffuQAcg+Uj/by+LmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ5e77+fW1/1H5+vo+BYB9/Z/f/nflcQpAafvH1/9lIAD58zEEcIDtuf9r5VuAt+7Z9v/q6xQAuf8hdkI6wHfbf613nYrpAM/9lyunAOjvf08BOMCvnYBvfBbSAba2/98eArC//70E8AA/+f59rwIgZ6B3nIboAD/8/vcRoAP8+PvfRYAOsO0vdAjAnILfaR7GA7z2/W8wD9MBni9+f/qTkA6w7S93CEDeAtNvg3SAZ4fvT70N0gG2vUuHAOQtMPU2SAd4dvr+tNsgHWDrtQKyPovgAbqtgKxrgA6w7R07BMjX1RNgPwVAr4CMawAP0PoC5LsQ0QHWzt+/FwHYKyDdGqADbN2/P9lBiAe4+gPkmobpAANWQK41gAcYsQJSrQE6wNaGADwEAD6I53wcxwOMWQGJ7kN0gHXQ96d5FMEDXKMAsoxCdIBt2PcnuQ/hAdZxAEUA8hiUZhSiAwzcA3PsgniAayRAhlEID9CGAlQBwGNQjlEIDzB2D0ywC+IB2mCAKgB4EM4wDOMBRu+B4XdBPEAbDlAFQO+B0XdBPMA6HqAIwD4Fg5+DeIA2AaAKgN4DY++CeIAZe2DoXRAP0KYAVAHAV6HY1yE8wDoHoAjAPgUDn4N4gDYJoAoggADgOSjuJIQHWGcBFAHYc1DYSQgP0KYBVAHQp2DUc1AAAeAA6zyAIgB7Dgo6CeEB2kSAKoAAAoDnoJiTEB5gnQlQBBBAAPIkHHIWFkAAOECbClAFCNfU798/BUDfhSLehvAA61yAIoAAAsTqYy7ALgD7LhTwNoQHaJMBqgACCAC+DQe8DwsgABtgmw1wCCCAAOD3kHgvIgIIAAeY/SIW7k1MAAHgANd0gFMAAQQQQADsq3i4d3EBBBBAAAEEEEAALMD074/201EBBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAAMgD8bFEAAAQQQQAABBKACXNMB/P8CAggggABx8v8OCyAAG8DfISKAAGwAf5eYAAKwAfydogIIAAfwd4sLIAAbYParqH9jJBqAf2eIDuDfGhNAADaAf3OUDuDfHcYD+LfH6QBzb0OnAAIIQJ6F403CAgiAB5h6GzoECNjMWbgKIIAA6Fn4FIA9CUWcgwSYOQkdAgggAHoSqgKE7GLPQQLMm4RizkECzDsHDwGC1tinoAAC4AEu9hwkwKxJKOocJMCsSegQIGyNfQoKMOkcPAVgn4NxT0EB5uyCVYCFvQueArB3wdB7oAATrkOHAKFr7FNQgAnn4CkAexcMvgcKMHwXrAIs7F3wFCB4g69DZRGAvQtWARb2LngKEL4NPQgLMHgXrAIkaEWPQQIM3QUPAVJ0kccgAUbugjn2QAHGjUJVgCQ9B62AU4AkbWPWwGMRIEsXeQwSYNR96FgEYK+BUwD2Gki1AgQYcB+qAqSq+6NIWQRgr4EqQLI29CEoQPdp+BSAvQYSrgABej6Ol1OAjGug3yz0WARAr4GcK0CAfheiugiQsw08BQnQbxtMuwUK0GkbrIsAC3kbPBYBMvdEb4ECdNgG6yJA7l58FnksAqQXAJ+BArx6EqY/AwV4TeBNvl+Anwq8zfcL8MN5uC4CvEfbD5fA4xTgPb6/wY9BOsDzhftweQhAvgq9x4MIHGD7evVZ/OsUgPsimv8spAP0+aeSiQXoAL3+rWxaATpAv38snVSADtDzd+mkFKAD9P1lSgkF6AC9f5tWOgE6QP9fp5ZMgA4w4vfppRLAA1z7gA4BKE/h+Z/I6QCDvj+PAB1g4B9YOAWADkGphiE8wNA/t1cE4J6BWU5COsDgv7ka/9/P0gG20X95O/pJiAe49uEdAnDPwPgnIR1g/BYYfBvEA0z5/sg3IjrAc5/UQwDwFhh4G8QDXPu0DgGITyHRn0XoAPO2wKDbIB7guU/tIUC0FbBP7hQAOwXFnIXoAOs+vSoA8DEs7sMYHeC539BDAOhFKOCFCA9wywqItAboAPesgEBrAA9w0wqIswboANt+W6cAyLeQaK8idIAbV0CMNYAHuO4EOARgr4AIawAPcN0LcAgAvQqHuRLjAZ77zT0EQK+A29cAHuD2FXD3GsADtPsBigA3tu4BqgKgV8C9a4AOEGIF3LkG8ABXDIBDAOZ76P0vo3iAZxSAhwDgMejOUYgOsO5hqgKgV8Bda4AOsO2BOgXA3oTuuw/hAVokgCIAeQy6ZxTCA1yxAA4ByGPQHaMQHmCNBlAFAI9Bd4xCdIBwe+DsXRAPcMUDOARA74Gzd0E6wLoHrAqA3gPn7oJ4gBYRoAjA3gNn7oJ4gCsmwCEAeg+cuQvSAYLugfN2QTzAFRXgEAC9B87bBekAYffAWbsgHuCKC3AIgN4DZ+2CdIBtD9wpAPoUnHMO4gFaZIAiAHsPnLEL4gHW2ABVAPBVaM51CA/QYgMUAdin4PhzEA+wRgeoAqD3wPG7IB0g/B44ehfEA6zxAaoA4KvQ+OsQHqDFBygCsE/BsecgHmDNAFAFQJ+CY89BPEDLAFAEYJ+CI89BPMCaA6AKgD4FR56DeICWA6AIwD4Fx52DeIA1C0AVAH0KjjsH8QAtC0ARQAAByHPQqEkID7DmAagCoOegUZMQHqDlASgCsE/BMecgHmDNBFAFEEAA8Bw0ZhLCA7RMAEUA9hw0YhLCA6y5AKoAAggAnoNGTEJ4gJYLoAjAnoP6T0ICCAAHWLMBVAHQc1D/SQgP0LIBFAEEEIA8B/WehPAAaz6AKoAAAoAn4d6zMB6g5QMoAgggAHkS7jsL4wHWjABVAAEEAE/CfWdhAQSAA7SMAEWAfu0pE4B9F+p5G8IDrDkBqgACCACehHvOwgIIAAdoOQGKAAIIQL4L9bsNCSAAHGDNClAFEEAA8F2o321IAAHgAC0rQBFAAAG4Pxz/PQHYt+Fe92EBBIADrHkBqgACCPB6H3kBPgVAv4f0ehERQAA4QMsLUAQQQADyi1inNzE6wJYZ4BRAAAHA7yF9XkQEEEAAAdAAH5kBPgVAv4j1eRMTQAABBEADtMwARQABBBBAAO7PRbr8ZEQAAdgAW26AUwABBBBAAOzPRXr8ZEQAAQQQQAABwAAfuQE+BRBAAAEEwP50vMfPxwUQQAABBBAADNByAxQBBBBAAAH+pd8AoDH47zbOd5EAAAAASUVORK5CYII="},11:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return l}));var n="http://192.168.150.110:5000",r="http://192.168.150.110",l=15e5},130:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return o}));var n=a(2),r=a(0),l=a.n(r),i=a(94),c=Object(r.createContext)(),o=function(e){var t=e.children,a=Object(r.useState)(null),o=Object(n.a)(a,2),s=o[0],m=o[1];Object(r.useEffect)((function(){Object(i.b)(),Object(i.d)((function(e){return m(e)}))}),[]);var u={server_time:s};return l.a.createElement(c.Provider,{value:u},t)}},186:function(e,t,a){e.exports=a.p+"static/media/phivolcs-dynaslope-logo.de612ba1.png"},22:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return u}));var n=a(17),r=a.n(n),l=a(11);function i(e,t){var a="".concat(l.b,"/api/refresh_session");r.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}function c(e){var t=JSON.parse(localStorage.getItem("data"));if(null!==t){var a=t.tokens,n=a.access_token,c=a.refresh_token;!function(e,t){var a="".concat(l.b,"/api/check_session");r.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}(n,(function(a){var n=a.is_logged_in;n&&i(c,(function(e){t.tokens.access_token=e.access_token,localStorage.setItem("data",JSON.stringify(t))})),e(n)}))}else e(!1)}function o(){var e=JSON.parse(localStorage.getItem("data"));i(e.tokens.refresh_token,(function(t){e.tokens.access_token=t.access_token,localStorage.setItem("data",JSON.stringify(e))}))}function s(e,t,a){!function(e,t){var a="".concat(l.b,"/api/login");r.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var n=e.ok,r=e.message,l=e.data;n?(localStorage.setItem("data",JSON.stringify(l)),t(l)):a(r)}))}function m(e){localStorage.clear(),e()}function u(){return JSON.parse(localStorage.getItem("data")).user}},24:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return l}));var n="#FCEE27",r="#F8991D",l="#991B1E";t.d=function(e){return{dynaslopeLogo:{height:60},phivolcsLogo:{height:70,marginTop:8},phivolcsDynaslopeLogo:{height:62},pageContentMargin:{margin:"0 16px",[e.breakpoints.up("md")]:{margin:"0 64px"},[e.breakpoints.up("lg")]:{margin:"0 100px"}},paperContainer:{width:"100%",overflowX:"auto"},sectionHeadContainer:{margin:"20px 0"},sectionHead:{fontSize:"1.5rem",[e.breakpoints.down("xs")]:{fontSize:"1.2rem"}},extended:{backgroundColor:"green"},alert0:{backgroundColor:"#EEEEEE"},alert1:{backgroundColor:"#FCEE27"},alert2:{backgroundColor:"#F8991D","& *":{color:"white !important"}},alert3:{backgroundColor:"#991B1E","& *":{color:"white !important"}},dyna_error:{color:"#FE0000"}}}},497:function(e,t,a){e.exports=a.p+"static/media/login-bg-img.6bf92800.jpg"},500:function(e,t,a){"use strict";(function(e){var n=a(2),r=a(3),l=a(0),i=a.n(l),c=a(34),o=a(64),s=a(775),m=a(294),u=a(43),d=a(536),p=a(317),b=a(234),f=a(537),g=a(194),E=a(762),v=a(382),h=a(760),_=a(761),y=a(763),O=a(764),j=a(8),x=a.n(j),S=a(186),k=a.n(S),C=a(24),w=a(22),A=a(130),D=Object(o.a)((function(e){return Object(r.a)(Object(r.a)({},Object(C.d)(e)),{},{list:{width:300,maxWidth:360},nested:{paddingLeft:e.spacing(3)},nestedText:{fontSize:"0.9rem"},drawerHeader:{height:220,display:"block",alignItems:"center",textAlign:"center",padding:16},logo:{height:105},titleBlock:{display:"block",margin:"0 4px"},projectTitle:{fontWeight:600},link:{textDecoration:"none"}})}));t.a=function(t){var a=t.drawerHandler,r=t.drawer,o=t.navigationLabels,j=t.history,S=t.onLogout,C=D(),I=Object(l.useState)({}),M=Object(n.a)(I,2),N=M[0],T=M[1],H=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent),R=Object(w.a)().nickname,Y=Object(l.useContext)(A.a).server_time;return i.a.createElement(s.a,{open:r,onClose:a(!1),onOpen:a(!0),disableBackdropTransition:!H,disableDiscovery:H},i.a.createElement("div",{tabIndex:0,role:"button",onKeyDown:a(!1)},i.a.createElement("div",{className:C.list},i.a.createElement(m.a,{className:C.drawerHeader},i.a.createElement("img",{src:k.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(C.phivolcsDynaslopeLogo," ").concat(C.logo)}),i.a.createElement(u.a,{variant:"h5",className:C.projectTitle},"MIA 3.0"),i.a.createElement(u.a,{variant:"subtitle2",className:C.projectSubtitle},"Monitoring and Information Application"),i.a.createElement(u.a,{variant:"subtitle1",style:{marginTop:6,fontWeight:600}},"Hello ",R,"!"),i.a.createElement(u.a,{variant:"button"},Y?x()(Y).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time...")),i.a.createElement(d.a,null),i.a.createElement(p.a,{component:"nav"},i.a.createElement(b.a,{button:!0,onClick:function(){j.push("/profile")}},i.a.createElement(f.a,null,i.a.createElement(h.a,null)),i.a.createElement(g.a,{primary:"Profile"})),i.a.createElement(b.a,{button:!0,onClick:function(){Object(w.d)((function(){S(),j.push("/login")}))}},i.a.createElement(f.a,null,i.a.createElement(_.a,null)),i.a.createElement(g.a,{primary:"Logout"}))),i.a.createElement(d.a,null),i.a.createElement(p.a,{component:"nav",subheader:i.a.createElement(E.a,{component:"div"},"Directory")},o.map((function(e){var t=e.key,n=e.main,r=e.sub;return i.a.createElement(l.Fragment,{key:t},i.a.createElement(b.a,{button:!0,onClick:function(){return function(e){var t="undefined"!==typeof N[e]&&N[e];T((function(a){return{[e]:!t}}))}(t)}},i.a.createElement(g.a,{primary:n}),N[t]?i.a.createElement(y.a,null):i.a.createElement(O.a,null)),i.a.createElement(v.a,{in:N[t],timeout:"auto",unmountOnExit:!0},i.a.createElement(p.a,{component:"div",disablePadding:!0},r.map((function(e){var t=e.label,n=e.link;return i.a.createElement(c.b,{to:n,key:t,className:C.link},i.a.createElement(b.a,{button:!0,className:C.nested,onClick:a(!1)},i.a.createElement(g.a,{primaryTypographyProps:{className:C.nestedText},primary:t})))})))))}))))))}}).call(this,a(201))},502:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-head.234377b7.png"},503:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-footer.131de212.png"},522:function(e,t,a){e.exports=a.p+"static/media/dyna_wall.d9a91c1f.jpg"},544:function(e,t,a){e.exports=a(747)},549:function(e,t,a){},599:function(e,t){},747:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(20),i=a.n(l),c=(a(549),a(26)),o=a(2),s=a(34),m=a(50),u=a(7),d=a(3),p=a(142),b=a(781),f=a(287),g=a(361),E=a(780),v=a(96),h=a(342),_=a(316),y=a(43),O=a(64),j=a(783),x=a(22),S=a(186),k=a.n(S),C=a(497),w=a.n(C);function A(){return r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",r.a.createElement(E.a,{color:"inherit",href:"https://material-ui.com/"},"Project Dynaslope")," ",(new Date).getFullYear(),".")}var D=Object(O.a)((function(e){return{root:{height:"100vh"},image:{backgroundImage:"url(".concat(w.a,")"),backgroundSize:"cover",backgroundPosition:"center"},paperContainer:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{margin:e.spacing(0,4),display:"flex",flexDirection:"column",alignItems:"center",paddingBottom:e.spacing(5),[e.breakpoints.up("lg")]:{paddingBottom:e.spacing(9)}},phivolcsDynaslopeLogo:{margin:e.spacing(1),height:200,[e.breakpoints.between("sm","md")]:{height:164},[e.breakpoints.only("xs")]:{height:140}},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},title:{margin:e.spacing(2,0),[e.breakpoints.down("sm")]:{fontSize:"1.25rem"},[e.breakpoints.only("xs")]:{margin:e.spacing(0,0)}},passwordField:{margin:e.spacing(0,0,3,0),[e.breakpoints.only("xs")]:{margin:e.spacing(0,0,1,0)}},buttonChild:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"}}}));function I(e){var t=D(),a=Object(n.useState)({username:"",password:""}),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)({username:!1,password:!1}),m=Object(o.a)(s,2),u=m[0],E=m[1],O=Object(n.useState)(""),S=Object(o.a)(O,2),C=S[0],w=S[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),N=M[0],T=M[1],H=e.history,R=e.onLogin,Y=function(){Object.entries(i).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];""===n&&z(a,n)})),Object.values(u).includes(!0)?w("Fill up all required fields"):(T(!0),Object(x.c)(i,(function(){T(!1),R(),H.push("/")}),(function(e){T(!1),w(e)})))},B=i.username,P=i.password,L=function(e){return function(t){var a=t.target.value;c(Object(d.a)(Object(d.a)({},i),{},{[e]:a})),w(""),z(e,a)}},F=function(e){return function(t){z(e,i[e])}},z=function(e,t){E(Object(d.a)(Object(d.a)({},u),{},{[e]:""===t}))};return r.a.createElement(_.a,{container:!0,component:"main",className:t.root},r.a.createElement(b.a,null),r.a.createElement(_.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),r.a.createElement(_.a,{item:!0,xs:12,sm:8,md:5,component:v.a,elevation:6,square:!0,className:t.paperContainer},r.a.createElement("div",{className:t.paper},r.a.createElement("img",{src:k.a,alt:"PHIVOLCS-Dynaslope Logo",className:t.phivolcsDynaslopeLogo}),r.a.createElement(y.a,{component:"h1",variant:"h5",align:"center",className:t.title},r.a.createElement("strong",null,"MONITORING AND INFORMATION APPLICATION (MIA 3.0)")),r.a.createElement("div",{className:t.form},r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:B,onChange:L("username"),onFocus:F("username"),error:u.username}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:P,onChange:L("password"),onKeyPress:function(e){"Enter"===e.key&&Y()},onFocus:F("password"),error:u.password,className:t.passwordField}),""!==C&&r.a.createElement(g.a,{error:!0,focused:!0},C),r.a.createElement(p.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:Y,disabled:N},N?r.a.createElement("div",{className:t.buttonChild},r.a.createElement("span",{style:{marginRight:6}},"Signing In... "),r.a.createElement(j.a,{color:"secondary",size:20})):r.a.createElement("span",null,"Sign In")),r.a.createElement(h.a,{mt:5},r.a.createElement(A,null))))))}var M=a(784),N=a(294);var T=Object(u.a)((function(e){return{footer:{display:"flex",padding:"2% 0",flexDirection:"column",marginTop:40,justifyContent:"center",alignItems:"center",textAlign:"center",[e.breakpoints.down("sm")]:{marginTop:30},zIndex:0},footerText:{fontSize:"0.5rem",[e.breakpoints.up("sm")]:{fontSize:"0.85rem"}}}}))((function(e){var t=e.classes;return r.a.createElement(M.a,{position:"static",className:t.footer},r.a.createElement(N.a,null,r.a.createElement(y.a,{variant:"subtitle2",color:"inherit",className:t.footerText},"4F PHIVOLCS Building, C. P. Garcia Avenue, UP Campus, Diliman, Quezon City 1101 ",r.a.createElement("br",null),"Tel. no. (02) 8426-1468 loc. 401 & 403 | dynaslope.phivolcs@gmail.com ",r.a.createElement("br",null),"www.facebook.com/dynaslopecommunity")))})),H=a(193),R=a(499),Y=a(430),B=a(785),P=a(760),L=a(761),F=a(24),z=Object(O.a)((function(e){return Object(d.a)(Object(d.a)({},Object(F.d)(e)),{},{root:{width:"100%"},grow:{flexGrow:1},menuButton:{display:"flex",marginLeft:-12,marginRight:0,[e.breakpoints.up("md")]:{display:"none"}},projectTitle:{display:"block",fontWeight:900},titleBlock:{display:"block",margin:"0 4px",alignItems:"center",textAlign:"center",justifyContent:"center"},projectSubtitle:{display:"none",fontSize:"0.7rem",marginTop:-3,[e.breakpoints.up("md")]:{display:"block"}},logo:{marginRight:12,[e.breakpoints.down("sm")]:{marginRight:0}},sectionDesktop:{display:"none",[e.breakpoints.up("md")]:{display:"flex",padding:"4px 0"}},list:{width:250},menu:{marginTop:40},icon:{paddingRight:e.spacing(2)}})}));var U=function(e){var t=e.drawerHandler,a=e.history,l=e.onLogout,i=Object(n.useState)(null),c=Object(o.a)(i,2),s=c[0],m=c[1],u=z(),d=function(){m(null)},b=Object(x.a)().first_name;return r.a.createElement("div",{className:u.root},r.a.createElement(M.a,{position:"fixed",color:"primary"},r.a.createElement(N.a,null,r.a.createElement(H.a,{onClick:t(!0),className:u.menuButton,color:"inherit","aria-label":"Open drawer"},r.a.createElement(B.a,null)),r.a.createElement("img",{src:k.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(u.phivolcsDynaslopeLogo," ").concat(u.logo," ").concat(u.sectionDesktop)}),r.a.createElement("div",{className:u.titleBlock},r.a.createElement(y.a,{className:u.projectTitle,variant:"h4",color:"inherit",noWrap:!0},"MIA 3.0"),r.a.createElement(y.a,{variant:"caption",className:u.projectSubtitle,color:"inherit"},"Monitoring and Information Application")),r.a.createElement("div",{className:u.grow}),r.a.createElement("div",{className:u.sectionDesktop},r.a.createElement(p.a,{"aria-owns":"menu-list-grow","aria-haspopup":"true",onClick:function(e){m(e.currentTarget)},color:"inherit",startIcon:r.a.createElement(P.a,null)},r.a.createElement("strong",null,b))))),r.a.createElement(R.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:d,className:u.menu},r.a.createElement(Y.a,{onClick:function(){a.push("/profile"),d()}},r.a.createElement(P.a,{className:u.icon})," Profile"),r.a.createElement(Y.a,{onClick:function(){Object(x.d)((function(){l(),a.push("/login")}))}},r.a.createElement(L.a,{className:u.icon})," Logout")))},W=a(773),G=a(538),q=a(766),V=a(222),Q=a(752),Z=a(758),K=a(176),J=a(8),X=a.n(J),$=a(500),ee=a(130),te=Object(O.a)((function(e){return{navBar:{display:"none",[e.breakpoints.up("md")]:{display:"block"}},appBar:{top:70},popper:{zIndex:500,marginTop:2},list:{width:250},link:{textDecoration:"none",color:"blue"}}})),ae=[{key:"monitoring",main:"Monitoring",sub:[{label:"Dashboard",link:"/"},{label:"Events Table",link:"/monitoring/events"},{label:"Shifts and Reports",link:"/monitoring/shifts_and_reports"},{label:"Issues and Reminders",link:"/monitoring/issues_and_reminders"},{label:"Site Logs",link:"/monitoring/logs"},{label:"Quality Assurance",link:"/monitoring/qa"}]},{key:"analysis",main:"Analysis",sub:[{label:"Site Data Analytics",link:"/analysis/sites"},{label:"Communications Analytics",link:"/analysis/communications",soon:!0},{label:"Monitoring Alerts Analytics",link:"/analysis/alerts"}]},{key:"communication",main:"Communication",sub:[{label:"Chatterbox",link:"/communication/chatterbox"},{label:"Contacts",link:"/communication/contacts"},{label:"Mailbox",link:"/communication/mailbox"}]},{key:"community",main:"Community",sub:[{label:"Site Information",link:"/community/site_info"},{label:"Stakeholders' Concerns",link:"/community/concerns",soon:!0},{label:"Community Feedback",link:"/community/feedback",soon:!0}]},{key:"knowledge",main:"Knowledge Management",sub:[{label:"Protocols",link:"/knowlegde/protocols",soon:!0},{label:"Papers",link:"/knowledge/papers",soon:!0}]}];var ne=r.a.memo(Object(K.a)()((function(e){var t=e.width,a=e.drawerHandler,l=e.drawer,i=e.history,c=e.onLogout,m=te(),u=window.location.pathname.split("/")[1],d=ae.findIndex((function(e){return e.key===u})),p=Object(n.useState)(-1===d?0:d),b=Object(o.a)(p,2),f=b[0],g=b[1],E=Object(n.useState)(null),h=Object(o.a)(E,2),O=h[0],j=h[1],x=Object(n.useState)(null),S=Object(o.a)(x,2),k=S[0],C=S[1],w=Object(n.useState)(!1),A=Object(o.a)(w,2),D=A[0],I=A[1],N=Object(n.useState)(null),T=Object(o.a)(N,2),H=T[0],R=T[1],B=Object(n.useContext)(ee.a).server_time,P=ae[f===O&&null!==k?k:f].sub;Object(n.useEffect)((function(){C(f)}),[f]);var L=function(e){var t=f;I(!0),R(e.currentTarget),j(t)},F=function(e){H.contains(e.target)||(I(!1),setTimeout((function(){return g(O)}),100))},z=function(e){I(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:m.navBar},r.a.createElement(M.a,{position:"fixed",color:"default",className:m.appBar},r.a.createElement(_.a,{container:!0,spacing:0,alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:10},r.a.createElement(W.a,{value:f,onChange:function(e,t){g(t)},indicatorColor:"primary",textColor:"primary",variant:Object(K.c)("md",t)?"standard":"scrollable",scrollButtons:"on",centered:Object(K.c)("md",t)},ae.map((function(e){var t=e.main,a=e.key;return r.a.createElement(G.a,{key:a,label:t,"aria-owns":D?"monitoring-menu":null,"aria-haspopup":"true",onClick:L})})))),r.a.createElement(_.a,{item:!0,xs:2,align:"center"},r.a.createElement(y.a,{variant:"button"},B?X()(B).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time..."))))),r.a.createElement(q.a,{className:m.popper,open:D,anchorEl:H,transition:!0,disablePortal:!0},(function(e){var t=e.TransitionProps,a=e.placement;return r.a.createElement(V.a,Object.assign({},t,{id:"monitoring-menu",style:{transformOrigin:"bottom"===a?"center top":"center bottom"}}),r.a.createElement(v.a,null,r.a.createElement(Q.a,{onClickAway:F},r.a.createElement(Z.a,null,P.map((function(e){var t=e.label,a=e.link,n="undefined"!==typeof e.soon;return n?r.a.createElement(Y.a,{key:t,onClick:z,disabled:n},t,n&&r.a.createElement(y.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")):r.a.createElement(s.b,{to:a,key:t,className:m.link},r.a.createElement(Y.a,{onClick:z},t))}))))))})),r.a.createElement($.a,{drawer:l,drawerHandler:a,navigationLabels:ae,history:i,onLogout:c}))}))),re=a(893),le=a(800),ie=a(801),ce=a(536),oe=a(802),se=a(826),me=a(825),ue=a(805),de=a(764),pe=a(827),be=a(896),fe=a(828);var ge=Object(u.a)((function(e){return{pageTitleContainer:{margin:"24px 0 18px",[e.breakpoints.down("sm")]:{margin:"10px 0 10px"}},pageTitle:{fontSize:"0.85rem"},hasCustomButtons:{display:"flex",alignItems:"baseline",justifyContent:"space-between",paddingTop:12,paddingBottom:12}}}))((function(e){var t=e.title,a=e.classes,n=e.customButtons,l=void 0!==n&&n,i=a.pageTitleContainer;return l&&(i+=" ".concat(a.hasCustomButtons)),r.a.createElement("div",{className:i},r.a.createElement(y.a,{variant:"overline",className:a.pageTitle},t),n)})),Ee=a(786),ve=function(e){e.preventDefault()};function he(e){return r.a.createElement(G.a,Object.assign({component:"a",onClick:ve},e))}var _e,ye=Object(u.a)((function(e){return{root:{flexGrow:1}}}))((function(e){var t=e.chosenTab,a=e.onSelect,n=e.tabsArray,l=e.classes;return r.a.createElement(Ee.a,null,r.a.createElement(M.a,{position:"static",color:"default",className:l.root},r.a.createElement(W.a,{variant:"fullWidth",value:t,onChange:function(e,t){a(t)}},n.map((function(e){var t=e.label,a=e.href;return r.a.createElement(he,{label:t,href:a,key:a})})))))})),Oe=a(56),je=a(803),xe=a(368),Se=a(804),ke=a(806),Ce=a(807),we=a(808),Ae=a(809),De=a(810),Ie=a(811),Me=a(767),Ne=a(788),Te=a(768),He=a(789),Re=a(359),Ye=a(446),Be=a(447),Pe=a(892),Le=a(769),Fe=a(790),ze=a(187),Ue=a.n(ze),We=a(11);function Ge(){"undefined"!==typeof _e&&null!==_e||(_e=Ue()("".concat(We.b,"/monitoring"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function qe(e){Ge(),_e.on("reconnecting",(function(){e(!0)})),_e.on("reconnect",(function(){e(!1)})),_e.on("reconnect_failed",(function(){console.log("failed")}))}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Ge(),console.log("Payload: { key: data }",e,t);var a={data:t,key:e};_e.send(a)}function Qe(){_e.close(),_e=null}function Ze(e){Ge(),_e.on("receive_alerts_from_db",(function(t){var a=JSON.parse(t);console.log("Alerts from DB: ",a),e(a)}))}var Ke=Object(Fe.a)()((function(e){var t=e.isShowing,a=e.hide,l=e.data,c=e.isValidating,s=l.site,m=l.trigger_id,u=l.ts_updated,d=Object(n.useState)(""),b=Object(o.a)(d,2),g=b[0],E=b[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(x.a)();O.user_id;function j(){a(),E(""),y("")}var S=""===g;return t?i.a.createPortal(r.a.createElement(n.Fragment,null,r.a.createElement(Me.a,{open:!0,onClose:j,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Validate Trigger"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Select whether trigger is valid or invalid. Also, provide remarks."),r.a.createElement(Re.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(Ye.a,{"aria-label":"trigger_validity",name:"trig_validity_1",row:!0,style:{justifyContent:"space-around"},value:g,onChange:function(e){var t=Number.parseInt(e.target.value,10);E(t)}},r.a.createElement(Be.a,{value:1,control:r.a.createElement(Pe.a,null),label:"Valid"}),!c&&r.a.createElement(Be.a,{value:0,control:r.a.createElement(Pe.a,null),label:"Validating"}),r.a.createElement(Be.a,{value:-1,control:r.a.createElement(Pe.a,null),label:"Invalid"}))),r.a.createElement(f.a,{autoFocus:!0,margin:"dense",id:"remarks",label:"Remarks",onChange:function(e){y(e.target.value)},value:_,fullWidth:!0})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:j,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:function(e){!function(e,t,a,n,r,l){Ve("validate_trigger",{site_code:e,alert_status:n,trigger_id:t,trigger_ts:a,remarks:r,user_id:l})}(s,m,u,g,_,O.user_id),a(),E(""),y("")},color:"primary",disabled:S},"Confirm")))),document.body):null})),Je=function(){var e=Object(n.useState)(!1),t=Object(o.a)(e,2),a=t[0],r=t[1];return{isShowing:a,toggle:function(){r(!a)}}},Xe=a(14),$e=a(195),et=a.n($e),tt=a(502),at=a.n(tt),nt=a(503),rt=a.n(nt),lt=a(17),it=a.n(lt);function ct(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"end",n=e.purok,r=e.sitio,l=e.barangay,i=e.municipality,c=e.province,o=e.site_code,s="";if(null!==r&&""!==r&&(s="Sitio ".concat(r,", ")),null!==n&&""!==n&&(s+="Purok ".concat(n,", ")),s+="Brgy. ".concat(l,", ").concat(i,", ").concat(c),t){var m=o.toUpperCase();"end"===a?s+=" (".concat(m,")"):s="".concat(m," (").concat(s,")")}return s}function ot(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};if(t){var n=e.split(" "),r=n.map((function(e){return a(e)}));return r.join(" ")}return a(e)}function st(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null,n=e.map((function(e){var n=e.site,r=e.org_name;return a=r.toUpperCase(),t?n:n.site_code.toUpperCase()}));return t?{sites:n,org:a}:(a&&n.unshift(a),n)}function mt(e){var t=!1;return e.length>0&&(t=Boolean(e[0].primary_contact)),t}function ut(e){return"0"===e[0]||e.match(/[a-z]/i)?e:"+".concat(e)}function dt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"days";if("all"===a)return"None";var n="YYYY-MM-DD HH:mm:ss",r=e.clone().subtract(t,a).format(n);return r}function pt(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;it.a.post(e,t).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e),null!==n&&n(e)}))}function bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;it.a.get(e).then((function(e){var a=e.data;null!==t&&t(a)})).catch((function(e){console.log(e)}))}function ft(e){var t=["january","february","march","april","may","june","july","august","september","october","november","december"];e.sort((function(e,a){return t.indexOf(e)-t.indexOf(a)}))}function gt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.offsetHeight,n=getComputedStyle(e),r=n.marginBottom,l=n.marginTop,i=parseFloat(r)+parseFloat(l);return t?i:a+i}function Et(e){var t=e.classes;return r.a.createElement("div",{id:"letter-head",className:t.letterHeadContainer},r.a.createElement("img",{src:at.a,alt:"PHIVOLCS Letter Head",className:t.phivolcsLetterHead}))}function vt(e){var t=e.classes;return r.a.createElement("div",{id:"letter-foot",className:"".concat(t.letterHeadContainer," ").concat(t.letterFooterContainer)},r.a.createElement("img",{src:rt.a,alt:"PHIVOLCS Letter Footer",className:t.phivolcsLetterHead}))}function ht(e){var t=e.classes,a=e.bulletinDetail,l=e.isMD,i=a.bulletin_control_code,c=a.site_address,o=a.data_ts,s=a.alert_description_group,m=a.recommended_response;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{variant:"body2",align:"center",className:t.title},r.a.createElement("strong",null,"DYNASLOPE LANDSLIDE ALERT LEVEL INFORMATION: ",i)),r.a.createElement(y.a,{variant:"body2",component:"div",className:t.mainInfo},r.a.createElement(_.a,{container:!0,spacing:l?2:1},r.a.createElement(_.a,{item:!0,xs:4},"Location:"),r.a.createElement(_.a,{item:!0,xs:8},r.a.createElement("strong",null,c)),r.a.createElement(_.a,{item:!0,xs:4},"Date/Time:"),r.a.createElement(_.a,{item:!0,xs:8},r.a.createElement("strong",null,o)),r.a.createElement(_.a,{item:!0,xs:4},"Alert Level Released:"),r.a.createElement(_.a,{item:!0,xs:8},r.a.createElement("strong",null,s)),r.a.createElement(_.a,{item:!0,xs:4},"Recommended Response:"),r.a.createElement(_.a,{item:!0,xs:8},r.a.createElement("strong",null,m)))))}var _t=Object(K.a)()((function(e){var t=e.releaseId,a=e.width,l=function(e){return Object(O.a)((function(t){return"undefined"===typeof e?{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"28px 44px",[t.breakpoints.only("md")]:{padding:"58.3324px 91.6652px"},[t.breakpoints.up("lg")]:{padding:"116.6648px 183.3304px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"33.3328px"},[t.breakpoints.up("lg")]:{marginTop:"66.6656px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{padding:"0 44px",height:629,maxHeight:629,overflowY:"hidden",[t.breakpoints.only("md")]:{padding:"0 91.6652px",height:1310.3957,maxHeight:1310.3957},[t.breakpoints.up("lg")]:{padding:"0 183.3304px",height:2620.7914,maxHeight:2620.7914}},title:{marginBottom:16,fontSize:"0.8rem",[t.breakpoints.only("md")]:{marginBottom:33.3328,fontSize:"1.6664rem"},[t.breakpoints.up("lg")]:{marginBottom:66.6656,fontSize:"3.47111rem"}},mainInfo:{border:"0.5px solid black",padding:"8px 12px",fontSize:"0.65rem",letterSpacing:0,marginBottom:12,[t.breakpoints.only("md")]:{padding:"16.6664px 24.9996px",fontSize:"1.354145rem",marginBottom:24.9996},[t.breakpoints.up("lg")]:{padding:"33.3328px 49.9992px",fontSize:"2.70829rem",marginBottom:49.9992}},sectionHeader:{fontSize:"0.7rem",[t.breakpoints.only("md")]:{fontSize:"1.45831rem"},[t.breakpoints.up("lg")]:{fontSize:"2.91662rem"}},sectionDetails:{fontSize:"0.65rem",[t.breakpoints.only("md")]:{fontSize:"1.354145rem"},[t.breakpoints.up("lg")]:{fontSize:"2.70829rem"}},indent:{marginLeft:24,[t.breakpoints.only("md")]:{marginLeft:49.9992},[t.breakpoints.up("lg")]:{marginLeft:99.9984}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}:{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"7px 11px",[t.breakpoints.only("md")]:{padding:"20px 22.9163px"},[t.breakpoints.up("lg")]:{padding:"29.1662px 45.8326px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"8.3332px"},[t.breakpoints.up("lg")]:{marginTop:"16.6664px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{overflowY:"hidden",padding:"0 11px",height:"100%",maxHeight:"100%",[t.breakpoints.only("md")]:{padding:"0 22.9163px",height:"100%",maxHeight:"100%"},[t.breakpoints.up("lg")]:{padding:"0 45.8326px",height:"100%",maxHeight:"100%"}},title:{marginBottom:4,fontSize:"0.65625rem",[t.breakpoints.only("md")]:{marginBottom:16,fontSize:"1.45rem"},[t.breakpoints.up("lg")]:{marginBottom:33.3328,fontSize:"1.367163rem"}},mainInfo:{border:"0.5px solid black",letterSpacing:0,padding:"2px 3px",fontSize:"0.4875rem",marginBottom:3,[t.breakpoints.only("md")]:{padding:"10px 16px",fontSize:"1rem",marginBottom:12},[t.breakpoints.up("lg")]:{padding:"8.3332px 12.4998px",fontSize:"1.01560875rem",marginBottom:12.4998}},sectionHeader:{fontSize:"0.525rem",[t.breakpoints.only("md")]:{fontSize:"1.2rem"},[t.breakpoints.up("lg")]:{fontSize:"1.0937325rem"}},sectionDetails:{fontSize:"0.4875rem",[t.breakpoints.only("md")]:{fontSize:"1rem"},[t.breakpoints.up("lg")]:{fontSize:"1.01560875rem"}},indent:{marginLeft:6,[t.breakpoints.only("md")]:{marginLeft:12.4998},[t.breakpoints.up("lg")]:{marginLeft:24.9996}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}}))}(t)(),i=Object(n.useState)([]),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Object(n.useState)(!1),p=Object(o.a)(u,2),b=p[0],f=p[1],g=Object(n.useState)(!1),E=Object(o.a)(g,2),v=E[0],h=E[1],x=Object(n.useRef)(null),S=Object(n.useState)({site:{},alert_level:0,bulletin_control_code:"",site_address:"",alert_description_group:"",recommended_response:"",community_response:"",lewc_lgu_response:"",households_at_risk:"",has_ground_trigger:!1,ground_movement_details:"",prepared_triggers:[],no_data_triggers:[],publishers:"",next_ewi_release_ts:""}),k=Object(o.a)(S,2),C=k[0],w=k[1],A=C.alert_level,D=C.community_response,I=C.households_at_risk,M=C.lewc_lgu_response,N=C.prepared_triggers,T=C.has_ground_trigger,H=C.site.barangay,R=C.no_data_triggers,Y=C.publishers,B=C.next_ewi_release_ts,P=C.ground_movement_details,L=Object(K.c)("md",a);Object(n.useEffect)((function(){var a=t;"undefined"===typeof t&&(a=e.match.params.release_id);!function(e,t){var a="".concat(We.b,"/api/monitoring/create_bulletin/").concat(e);it.a.get(a).then((function(e){var a=e.data;console.log("Bulletin details",a),t(a)})).catch((function(e){console.log(e)}))}(a,(function(e){var t=ct(e.site,!1),a=Object(d.a)(Object(d.a)({},e),{},{site_address:t});f(!0),w(a)}))}),[]),Object(n.useEffect)((function(){if(null!==x.current){var e=x.current,t=Array.from(e.children),a=0;t.forEach((function(e,t){if("subcontent"!==e.id)a+=gt(e);else{a+=gt(e,!0);var n=Array.from(e.children),r=[];n.forEach((function(e){var t=gt(e);a+t<1310.3957?a+=t:(a+=t,r.push(e.children[0]),e.setAttribute("style","display: none"))})),m(r)}})),""!==C.site_address&&h(!0)}}),[C,x]);var F=!1;return r.a.createElement(n.Fragment,null,b?r.a.createElement(n.Fragment,null,r.a.createElement("div",{id:"bulletin-root",className:l.root},r.a.createElement(Et,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:x},r.a.createElement(ht,{classes:l,bulletinDetail:C,isMD:L}),r.a.createElement(_.a,{container:!0,spacing:L?2:1,id:"subcontent"},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"AREA SITUATION"),":"))),N.map((function(e,t,a){var i=e.is_ground,c=e.trigger_source,o="";!F&&i&&(o=r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),F=!0);var s=!1;(0===t||a[t-1].trigger_source!==c)&&(s=!0);var m="";if(s){var u=c.toUpperCase();m=r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:"".concat(l.sectionHeader," ").concat(i?l.indent:"")},r.a.createElement("strong",null,i?r.a.createElement("u",null,r.a.createElement("i",null,u)):u)))}var d="";return R.includes(c)&&(d=r.a.createElement(_.a,{item:!0,xs:12,style:{paddingTop:"0 !important"}},r.a.createElement(y.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},"Currently, no data available."))),r.a.createElement(n.Fragment,{key:"key-".concat(t+1)},o,m,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent),dangerouslySetInnerHTML:{__html:e.description}})),d)})),(!T||0===A)&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},P))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"ELEMENTS AT RISK"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},I)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"OTHER RECOMMENDATIONS"),":"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Landslide Early Warning Committee (LEWC):")," ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:M}}))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Community:")," ",D)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"NOTE:")," This bulletin contains the official Alert Level and Recommended Response of the Dynaslope Project for Brgy. ",H," and will hold true until a new bulletin is released.")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{className:l.divider})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{component:"div",variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.releaseDetailsArea)},0===A?r.a.createElement("span",null):r.a.createElement("span",null,"Next bulletin on: ",r.a.createElement("strong",null,B)),r.a.createElement("span",null,"Released by: ",r.a.createElement("strong",null,Y)))))),r.a.createElement(vt,{classes:l})),s.length>0&&r.a.createElement("div",{id:"bulletin-root-2",className:l.root},r.a.createElement(Et,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:x},r.a.createElement(ht,{classes:l,bulletinDetail:C,isMD:L}),r.a.createElement(_.a,{container:!0,spacing:L?2:1,id:"excess-content"},s.map((function(e,t){var a=[];e.classList.forEach((function(e){if(e.includes("makeStyles")){var t=e.split("-")[1];a.push(l[t])}else a.push(e)}));var n=e.outerHTML.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,'"'.concat(a.join(" "),'"'));return r.a.createElement(_.a,{key:"key-".concat(t+1),item:!0,xs:12,dangerouslySetInnerHTML:{__html:n}})})))),r.a.createElement(vt,{classes:l})),v&&r.a.createElement("div",{id:"is-loaded"})):r.a.createElement(_.a,{item:!0,style:{textAlign:"center"}},r.a.createElement(j.a,{size:50}),r.a.createElement(y.a,null,"Loading Bulletin")))}));var yt=Object(Fe.a)()((function(e){var t=e.classes,a=e.fullScreen,l=e.isOpenBulletinModal,i=e.setIsOpenBulletinModal,s=e.releaseDetail,m=s.release_id,u=s.site_code,d=s.site_id,b=s.type,g=s.is_bulletin_sent,E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],y=v[1],O=Object(n.useState)([]),j=Object(o.a)(O,2),S=j[0],k=j[1],C=Object(n.useState)(""),w=Object(o.a)(C,2),A=w[0],D=w[1],I=Object(n.useState)(""),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)({}),R=Object(o.a)(H,2),Y=R[0],B=R[1],P=Object(c.b)(),L=P.enqueueSnackbar,F=P.closeSnackbar,z=Object(x.a)().user_id,U=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){F(e)}},"Dismiss")};Object(n.useEffect)((function(){"undefined"!==typeof m&&l&&function(e,t){bt("".concat(We.b,"/api/bulletin_email/get_bulletin_email_details/").concat(e),t)}(m,(function(e){var t=e.subject,a=e.recipients,n=e.mail_body,r=e.file_name,l=e.narrative_details;B(l),k(a),y(t),D(n),T(r)}))}),[l]);var W,G=function(){i(!1),B({}),k([]),y(""),D(""),T("")},q="";return"undefined"!==typeof u&&(q=u.toUpperCase()),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title",maxWidth:"md"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Early Warning Bulletin for ",q),r.a.createElement(Te.a,null,r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Mail Content",value:A,onChange:function(e){D(e.target.value)},placeholder:"Add mail content",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(et.a,{label:"To",value:S,onAdd:function(e){return function(e){var t=S;t.push(e),k(Object(Xe.a)(t))}(e)},onDelete:function(e,t){return function(e,t){S.splice(S.indexOf(e),1),k(Object(Xe.a)(S))}(e)},fullWidth:!0,required:!0})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{className:t.divider})),r.a.createElement(_.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(_t,{releaseId:m})))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:(W=m,function(){!function(e,t){bt("".concat(We.b,"/api/bulletin/download_bulletin/").concat(e),t)}(W,(function(e){console.log("LOG bulletin_download",e)}))}),color:"primary"},"Download"),r.a.createElement(p.a,{color:"secondary",onClick:function(){var e={subject:h,recipients:S,mail_body:A,release_id:m,file_name:N,alert_db_group:b,site_id:d,sender_id:z,narrative_details:Y},t=L("Sending EWI bulletin...",{variant:"warning",persist:!0});G(),function(e,t,a){pt("".concat(We.b,"/api/mailbox/send_bulletin_email"),e,t,a)}(e,(function(e){console.log("Sent bulletin email...",e);var a=e.status,n=e.message;F(t),L(n,{variant:a?"success":"error",autoHideDuration:7e3,action:U})}),(function(){F(t),L("Send bulletin failed. Ask the devs.",{variant:"error",autoHideDuration:7e3,action:U})}))},disabled:!1},g?"Sent already (Send again?)":"Send"),r.a.createElement(p.a,{onClick:G,color:"primary"},"Cancel")))}));var Ot=a(799),jt=a(798),xt=a(794),St=a(795),kt=a(489),Ct=a(44),wt=a(793),At=a(37);function Dt(e,t,a){var n="".concat(We.b,"/api/chatterbox/send_message");it.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}var It=a(533),Mt=a(535),Nt=Object(n.forwardRef)((function(e,t){return r.a.createElement(It.a,Object.assign({direction:"up"},e,{ref:t}))})),Tt=Object(n.forwardRef)((function(e,t){return r.a.createElement(Mt.a,Object.assign({},e,{ref:t}))})),Ht=a(105),Rt=a(531),Yt=a(491),Bt=a(504),Pt=a.n(Bt),Lt=a(366);function Ft(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(y.a,Object.assign({color:"textSecondary",className:t.classes.noOptionsMessage},a),n)}function zt(e){var t=e.inputRef,a=Object(Ht.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}function Ut(e){var t=e.selectProps,a=e.innerRef,n=e.children,l=e.innerProps;return r.a.createElement(f.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:zt,inputProps:Object(d.a)({className:t.classes.input,inputRef:a,children:n},l)}},t.textFieldProps))}function Wt(e){var t=e.innerRef,a=e.isFocused,n=e.isSelected,l=e.innerProps,i=e.children,c=e.data.color;return r.a.createElement(Y.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400,color:c}},l),i)}function Gt(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(y.a,Object.assign({color:"textSecondary",className:t.classes.placeholder},a),n)}function qt(e){var t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)}function Vt(e){var t=e.children,a=e.selectProps,n=e.isFocused,l=e.data,i=e.removeProps,c=l.chipLabel,o="undefined"!==typeof c?c:t;return r.a.createElement(Yt.a,{tabIndex:-1,label:o,className:"".concat(a.classes.chip," ").concat({[a.classes.chipFocused]:n}),onDelete:i.onClick,deleteIcon:r.a.createElement(Pt.a,i)})}function Qt(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(v.a,Object.assign({square:!0,className:t.classes.paper},a),n)}var Zt=Object(u.a)((function(e){return{root:{flexGrow:1},input:{display:"flex",padding:0,height:"auto"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object(Lt.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:2,marginTop:e.spacing(1),left:0,right:0},divider:{height:e.spacing(2)}}}),{withTheme:!0})((function(e){var t=e.classes,a=e.changeHandler,n=e.options,l=e.value,i=e.label,c=e.placeholder,o=e.renderDropdownIndicator,s=e.openMenuOnClick,m=e.isMulti,u=e.isDisabled,p=e.isClearable,b=e.hasAlternativeChipLabel,f={input:function(e){return Object(d.a)(Object(d.a)({},e),{},{color:"blue","& input":{font:"inherit"}})},menuPortal:function(e){return Object(d.a)(Object(d.a)({},e),{},{zIndex:9999})}},g={Control:Ut,Menu:Qt,MultiValue:Vt,NoOptionsMessage:Ft,Option:Wt,Placeholder:Gt,ValueContainer:qt},E=void 0===s||s,v=void 0!==m&&m,h=void 0!==u&&u,_=void 0!==p&&p;return!1===(void 0===o||o)&&(g.DropdownIndicator=function(){return null},g.IndicatorSeparator=function(){return null}),r.a.createElement("div",{className:t.root},r.a.createElement(Ee.a,null,r.a.createElement(Rt.a,{classes:t,styles:f,textFieldProps:{label:i,InputLabelProps:{shrink:!0}},menuPortalTarget:document.body,options:n,components:g,value:l,onChange:a,placeholder:c,isMulti:v,openMenuOnFocus:!1,openMenuOnClick:E,isDisabled:h,isClearable:_,hasAlternativeChipLabel:b})))}));var Kt=Object(n.createContext)(),Jt=function(e){var t=e.children,a=Object(n.useState)(!0),l=Object(o.a)(a,2),i=l[0],s=l[1],m=Object(n.useState)(!0),u=Object(o.a)(m,2),d=u[0],p=u[1],b=Object(n.useState)([]),f=Object(o.a)(b,2),g=f[0],E=f[1],v=Object(n.useState)([]),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)([]),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1];Object(n.useEffect)((function(){var e;d&&(e=function(e){var t=e.filter((function(e){return e.active}));y(t),S(e),p(!1)},bt("".concat(We.b,"/api/sites/get_sites_data?include_inactive=true"),e))}),[d]),Object(n.useEffect)((function(){var e;i&&(e=function(e){E(e),s(!1)},bt("".concat(We.b,"/api/users/get_dynaslope_users/true/true"),e))}),[i]),Object(n.useEffect)((function(){var e;e=function(e){A(e)},bt("".concat(We.b,"/api/users/get_organizations"),e)}),[]);var T=Object(c.b)(),H=T.enqueueSnackbar,R=T.closeSnackbar,Y=Object(n.useState)(null),B=Object(o.a)(Y,2),P=B[0],L=B[1];Object(n.useEffect)((function(){if(null!==M)if(!0===M){var e=H("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});L(e)}else R(P),H("Reconnection successful...",{variant:"success",autoHideDuration:5e3})}),[M]);var F={users:g,sites:_,all_sites_including_inactive:x,organizations:w,is_reconnecting:M,setIsReconnecting:N,setRefreshUser:s,setRefreshSites:p};return r.a.createElement(Kt.Provider,{value:F},t)};function Xt(e,t,a){return e.map((function(e){var n=e.site_code,r=e.site_id,l=n.toUpperCase();t&&(l=ct(e,!0,"start"));var i="black",c=null;if("undefined"!==typeof a&&null!==a){var o=a.latest,s=a.extended,m=a.overdue,u=[].concat(Object(Xe.a)(o),Object(Xe.a)(m)),d=n.toLowerCase(),p=u.findIndex((function(e){return e.event.site.site_code===d})),b=s.findIndex((function(e){return e.event.site.site_code===d}));p>-1&&(i="red",c=u[p].event.event_id),b>-1&&(i="green",c=s[b].event.event_id)}return{value:r,label:l,data:e,color:i,event_id:c}}))}var $t=function(e){var t=e.value,a=e.changeHandler,l=e.isMulti,i=e.renderDropdownIndicator,c=e.includeAddressOnOptions,o=e.returnSiteDataCallback,s=e.isFromSiteLogs,m=e.disabled,u=e.customPlaceholder,d=e.isClearable,p=Object(n.useContext)(Kt).sites,b=Xt(p,"undefined"===typeof c||c,s),f="undefined"!==typeof l&&l,g=f?"Select site(s)":"Select site";g=u||g;var E="undefined"!==typeof i&&i,v="undefined"!==typeof d&&d,h=t;if(""!==t&&null!==t){var _=t.label,y=t.value;if("undefined"!==typeof o&&o){var O=p.find((function(e){return e.site_id===y}));"undefined"!==typeof O&&o(O)}"undefined"!==typeof _||f||(h=b[y-1])}return r.a.createElement(Zt,{label:l?"Site(s)":"Site",options:b,value:h,changeHandler:a,placeholder:g,renderDropdownIndicator:E,openMenuOnClick:!0,isMulti:f,isDisabled:Boolean(m),isClearable:v})},ea=Object(O.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}}));var ta=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.inputFieldLength,i=e.clickHandler,s=e.setComposedMessage,m=e.maxCharacters,u=ea(),d=Object(n.useState)(X()().format("YYYY-MM-DD HH:mm:ss")),b=Object(o.a)(d,2),f=b[0],g=b[1],E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],y=v[1],O=Object(n.useState)(!0),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(c.b)(),C=k.enqueueSnackbar,w=k.closeSnackbar,A=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){w(e)}},"Dismiss")},D=function(){var e=function(e){var t=[];return e.forEach((function(e,a){var n=e.data,r=n.site_code,l=n.barangay,i=n.municipality,c=n.province,o="Brgy. ".concat(l,", ").concat(i,", ").concat(c);t.push({site_code:r,site_info:o})})),t}(h),t=x,a=X()(f).format("LLL");!function(e,t){var a="".concat(We.b,"/api/rainfall/get_all_site_rainfall_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Get rain information data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({is_express:t,site_details:e,date_time:f,as_of:a},(function(e){var t=e.status,a=e.message,n=e.ewi;s(n.slice(0,l));var r=a,c="error";!0===t&&(i(),c="success",n.length>l&&(c="warning",r="Rainfall information message is trimmed down because of length restrictions (max characters: ".concat(m,")"))),C(r,{variant:c,autoHideDuration:3e3,action:A})}))},I=Object(n.useState)(!0),M=Object(o.a)(I,2),N=M[0],T=M[1];return Object(n.useEffect)((function(){T(null===f||null===h)}),[f,h]),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Load Rainfall Information"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Fill-up the form with needed data."),r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(_.a,{item:!0,xs:12,className:u.inputGridContainer},r.a.createElement($t,{value:h,changeHandler:function(e){y(e)},isMulti:!0})),r.a.createElement(_.a,{item:!0,xs:6,className:u.inputGridContainer},r.a.createElement(xe.a,{title:"Example tooltip",placement:"top",interactive:!0},r.a.createElement(Re.a,null,r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:x,onChange:function(e){return S(e.target.checked)},value:"checkedB",color:"primary"}),label:"Express data in percentage"})))),r.a.createElement(_.a,{item:!0,xs:6,className:u.inputGridContainer},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Data timestamp",value:f,onChange:function(e){return g(X()(e).format("YYYY-MM-DD HH:mm:ss"))},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0}))))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{color:"primary",onClick:function(){return D()},disabled:N},"Select"),r.a.createElement(p.a,{onClick:i},"Cancel")))}));var aa=function(e){var t=e.limitRows,a=e.value,l=e.disableSend,i=e.messageChangeHandler,c=e.sendButtonClickHandler,s=e.setComposedMessage,m=e.disableTemplateLoader,u=void 0===t||t,d=Object(n.useState)(!1),p=Object(o.a)(d,2),b=p[0],g=p[1],E=function(e){return function(){return g(e)}},v=Object(x.a)().nickname,h=" - ".concat(v," from PHIVOLCS-DYNASLOPE"),O=a.length+h.length;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",style:{paddingTop:16}},r.a.createElement(_.a,{item:!0,xs:10,sm:11},r.a.createElement(f.a,{id:"message_textbox",label:"Message",multiline:!0,rows:"4",rowsMax:u?4:10,fullWidth:!0,margin:"dense",variant:"filled",inputProps:{maxLength:1e3},value:a,onChange:i}),r.a.createElement(y.a,{variant:"caption",align:"right",component:"div"},r.a.createElement("strong",null,"Character count (including signature): ",O,"/",1e3))),r.a.createElement(_.a,{item:!0,xs:1,container:!0,direction:"column"},r.a.createElement(H.a,{color:"primary","aria-label":"Send message",onClick:c,disabled:l},r.a.createElement(xt.a,null)),!m&&r.a.createElement(H.a,{color:"primary","aria-label":"More options",onClick:E(!0)},r.a.createElement(St.a,null)))),r.a.createElement(ta,{isOpen:b,setComposedMessage:s,clickHandler:E(!1),maxCharacters:1e3,inputFieldLength:1e3-h.length}))},na=a(756),ra=a(365),la=a(796),ia=a(797);var ca=Object(u.a)((function(e){return{checkboxes:{paddingTop:4,paddingBottom:4}}}))((function(e){var t=e.classes,a=(e.label,e.changeHandler),l=e.choices,i=e.checkboxStyle;return r.a.createElement(n.Fragment,null,l.map((function(e,n){var l=e.state,c=e.value,o=e.label,s=e.is_disabled;return r.a.createElement(Be.a,{key:n,control:r.a.createElement(kt.a,{checked:l,onChange:a(c),value:c,disabled:"undefined"!==typeof s&&s,className:t.checkboxes}),label:o,className:i})})))})),oa=Object(O.a)((function(e){return{formControl:{width:"-webkit-fill-available",marginTop:8,"&:first-child":{marginTop:12}},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxSites:{flex:"1 1 25%",[e.breakpoints.down("xs")]:{"&:last-child":{flexBasis:"58.5%"}},[e.breakpoints.up("sm")]:{flexBasis:"17%"},[e.breakpoints.up("md")]:{flexBasis:"9%"}},checkboxOrganizations:{flex:"1 1 45%",[e.breakpoints.up("sm")]:{flexBasis:"17%","&:last-child":{flexBasis:"77%"}},[e.breakpoints.up("md")]:{flexBasis:"9%","&:last-child":{flexBasis:"45%"}}},checkboxGroup:{flexDirection:"row",paddingTop:6},buttons:{[e.breakpoints.down("xs")]:{padding:"12px 6px"}}}}));var sa=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setRecipients,c=oa(),s=Object(n.useContext)(Kt),m=s.sites,u=s.organizations,b=m.map((function(e){return{label:e.site_code.toUpperCase(),value:e.site_id,state:!1}})),f=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{label:t+e.name.toUpperCase(),value:e.org_id,state:!1}})),g=Object(n.useState)(!1),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(n.useState)(b),y=Object(o.a)(_,2),O=y[0],j=y[1],x=Object(n.useState)(f),S=Object(o.a)(x,2),k=S[0],C=S[1],w={handleCheckAll:function(e,t){return function(){var a,n;"sites"===e?(a=O,n=j):"organizations"===e&&(a=k,n=C);var r=a.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{state:t})}));n(Object(Xe.a)(r))}},handleChange:function(e){return function(t){return function(a){var n=a.target.checked;if("only_ewi_recipient"===e)h(n);else{var r,l;"sites"===e?(r=O,l=j):"organizations"===e&&(r=k,l=C);var i=r.findIndex((function(e){return e.value===t}));r[i].state=n,l(Object(Xe.a)(r))}}}}};return r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt,maxWidth:"md"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Select recipients"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Choose your preferred sites and offices as message recipients."),r.a.createElement(Re.a,{className:c.formControl},r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:v,onChange:function(e){return h(e.target.checked)},value:"only_ewi_recipients",className:c.checkboxes}),label:"Only EWI Recipients"})),[{state_list:k,group:"Organizations",list:u},{state_list:O,group:"Sites",list:m}].map((function(e){return function(e,t,a){var n=t.state_list,l=t.group,i=t.list,c=a.handleCheckAll,o=a.handleChange,s=l.toLowerCase();return r.a.createElement(Re.a,{component:"fieldset",className:e.formControl,key:l},r.a.createElement(na.a,{component:"legend",className:e.formLabel},r.a.createElement("span",null,l),r.a.createElement("span",null,[{label:"Check all",component:r.a.createElement(la.a,null),bool:!0},{label:"Uncheck all",component:r.a.createElement(ia.a,null),bool:!1}].map((function(t){return r.a.createElement(H.a,{"aria-label":t.label,color:"primary",className:e.buttons,onClick:c(s,t.bool),key:t.label},t.component)})))),r.a.createElement(ra.a,{className:e.checkboxGroup},r.a.createElement(ca,{choices:i.map((function(e){return function(e,t,a){var n;"Sites"===t?n="site_id":"Organizations"===t&&(n="org_id");return a.filter((function(t){return t.value===e[n]})).pop()}(e,l,n)})),changeHandler:o(s),checkboxStyle:e["checkbox".concat(l)]})))}(c,e,w)}))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:function(){var e=[],t=[];O.forEach((function(t){t.state&&e.push(t.value)})),k.forEach((function(e){e.state&&t.push(e.value)})),function(e,t){var a="".concat(We.b,"/api/contacts/get_recipients_option");it.a.post(a,e).then((function(e){var a=e.data;console.log("Selected recipients",a),t(a)})).catch((function(e){console.error(e)}))}({site_ids:e,org_ids:t,only_ewi_recipients:v},(function(e){var t=e.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,l=t;return""!==n&&(l="".concat(t," (").concat(n,")")),{label:l+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));i(t)})),l()},color:"primary"},"Select"),r.a.createElement(p.a,{onClick:l},"Cancel"))))}));var ma=function(e){var t=e.textboxValue,a=e.disableQuickSelect,l=e.releaseId,i=e.siteCode,s=e.fromEWIModal,m=e.modalStateHandler,u=e.updateSentStatusObj,b=e.recipientsList,f=Object(c.b)(),g=f.enqueueSnackbar,E=f.closeSnackbar,v=Object(x.a)(),h=Object(n.useState)([]),y=Object(o.a)(h,2),O=y[0],S=y[1],k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(!1),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(t),R=Object(o.a)(T,2),Y=R[0],B=R[1],P="undefined"!==typeof a&&a,L="undefined"!==typeof s&&s,F=Object(n.useState)(!1),z=Object(o.a)(F,2),U=z[0],W=z[1];Object(n.useEffect)((function(){"undefined"!==typeof i&&(W(!0),function(e,t){var a="".concat(We.b,"/api/contacts/get_contacts_per_site/").concat(e);it.a.get(a).then((function(e){var a=e.data;console.log(e),console.log(a),t(a)})).catch((function(e){console.error(e)}))}(i,(function(e){var t=[],a=[],n=u.type,r=u.public_alert_symbol.alert_level,l=u.highest_event_alert_level;e.forEach((function(e){if(e.mobile_numbers.length>0){var i,c=e.user_id,o=e.last_name,s=e.first_name,m=e.organizations,u=e.ewi_recipient,d=e.ewi_restriction,p=m[0].organization,b=p.name,f=p.scope,g=b.toUpperCase();if("lgu"===b)1===f&&(i="B"),2===f&&(i="M"),3===f&&(i="P"),g=i+g;var E={label:"".concat(o,", ").concat(s," (").concat(g,")"),value:c,data:e};if(t.push(E),1===u){var v=!0;if("extended"===n)v=!1,("lewc"===b||f<3&&"lgu"===b)&&(v=!0);else if(null!==d){var h=d.alert_level;(0!==r&&r<=h||0===r&&l<=h)&&(v=!1)}v&&a.push(E)}}})),A(t),S(a),W(!1)})))}),[i]),Object(n.useEffect)((function(){if("undefined"!==typeof b){W(!0);var e=b.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,l=t;return""!==n&&(l="".concat(t," (").concat(n,")")),{label:l+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));A(e),S([]),W(!1)}}),[b]);var G=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){E(e)}},"Dismiss")},q=null===O||0===O.length,V=""===Y||"undefined"===typeof Y;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,justify:"space-around",alignItems:"flex-end"},U&&r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(j.a,{size:20})),r.a.createElement(_.a,{item:!0,xs:!0},r.a.createElement(Zt,{label:"Recipients",options:w,value:O,changeHandler:function(e){return S(e)},placeholder:"Select recipients",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0})),!P&&r.a.createElement(_.a,{item:!0,style:{textAlign:"right"}},r.a.createElement(H.a,{"aria-label":"Quick select option",onClick:function(e){return N(!0)}},r.a.createElement(jt.a,null)))),r.a.createElement(sa,{isOpen:M,closeHandler:function(e){return N(!1)},setRecipients:S}),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(aa,{limitRows:!1,value:Y,disableSend:q||V,sendButtonClickHandler:function(){var e=[];L?O.forEach((function(t){var a=t.data;a.mobile_numbers.forEach((function(t){return e.push({mobile_id:t.mobile_number.mobile_id,gsm_id:t.mobile_number.gsm_id,data:a})}))})):O.forEach((function(t){var a=t.data,n=a.mobile_id,r=a.gsm_id;e.push({mobile_id:n,gsm_id:r})}));var t={sms_msg:"".concat(Y," - ").concat(v.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:e,is_ewi:L};if(L){var a=u.site_id,n=u.type;t=Object(d.a)(Object(d.a)({},t),{},{release_id:l,user_id:v.user_id,site_id:a,alert_db_group:n})}var r=g("Sending EWI message...",{variant:"warning",persist:!0});m(),Dt(t,(function(e){E(r);var t,a=e.message;e.status?(t="success",a="EWI SMS sent!"):t="error",g(a,{variant:t,autoHideDuration:7e3,action:G})}),(function(){g("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:G})}))},messageChangeHandler:function(e){return B(e.target.value)},setComposedMessage:B,disableTemplateLoader:L})))};var ua=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.textboxValue,i=e.releaseDetail,c=i.release_id,o=i.site_code;return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Early Warning Information"),r.a.createElement(H.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Te.a,{style:{overflowY:"auto"}},r.a.createElement(He.a,null,"Early warning information recipients for this site is already pre-loaded. Add additional site-related contacts if necessary. Use Chatterbox for non-site-related contacts."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(ma,{isMobile:t,textboxValue:l,disableQuickSelect:!0,releaseId:c,siteCode:o,fromEWIModal:!0,updateSentStatusObj:i,modalStateHandler:a}))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),da=Object(O.a)((function(e){return Object(F.d)(e)}));function pa(e){var t=e.is_loading_recipients,a=e.textboxValue,l=e.sendHandler;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,justify:"space-around",alignItems:"flex-end"},t&&r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(j.a,{size:20}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(aa,{limitRows:!1,value:a,disableSend:!1,sendButtonClickHandler:l,messageChangeHandler:function(){return console.log("tried msg change")}})))}var ba=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.textboxValue,i=e.siteList,o=da(),s=Object(c.b)(),m=s.enqueueSnackbar,u=s.closeSnackbar,d=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){u(e)}},"Dismiss")};return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Routine Early Warning Information"),r.a.createElement(H.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Te.a,{style:{overflowY:"hidden"}},r.a.createElement(He.a,null,"Early warning information recipients for this site is already pre-loaded. Recipients are LEWC, Barangay, and Municipal LGUs per site. If you need to add a new recipient, add a new community contact via chatterbox."),r.a.createElement(He.a,{className:o.dyna_error},"NOTE: Ensure first that alerts for ALL sites under routine monitoring has been released before sending routine EWI SMS. Sending routine EWI in multiple batches will result in message duplication on our stakeholders."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(pa,{isMobile:t,textboxValue:l,disableQuickSelect:!0,sendHandler:function(){var e=Object(x.a)(),t=e.user_id,n=e.nickname,r={site_list:i,user_id:t,nickname:n};a(),function(e,t,a){var n="".concat(We.b,"/api/chatterbox/send_routine_ewi_sms");it.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}(r,(function(e){if(console.log(e),e.status)m("Routine EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:d});else{var t=e.site_ids.map((function(e){return e.toUpperCase()}));m("Some problems occurred sending EWI SMS to ".concat(t.join(", ")),{variant:"error",persist:!0,action:d})}}),(function(e){console.log("error_response",e),m("Error sending routine EWI SMS...",{variant:"error",autoHideDuration:7e3,action:d})}))},fromEWIModal:!0,updateSentStatusObj:"",modalStateHandler:a}))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),fa=a(360),ga=a(373);var Ea=Object(u.a)((function(e){return{formControl:{minWidth:120}}}))((function(e){var t=e.classes,a=e.list,l=e.mapping,i=e.label,c=e.div_id,o=e.changeHandler,s=e.value,m=e.css,u=e.error,d=e.required,p=e.disabled,b="undefined"!==typeof d&&d,f="undefined"!==typeof u&&u;return r.a.createElement(n.Fragment,null,r.a.createElement(Re.a,{required:b,error:f,className:"".concat(t.formControl," ").concat(m),fullWidth:!0},r.a.createElement(fa.a,{htmlFor:c},i),r.a.createElement(ga.a,{value:s,onChange:o,name:c,inputProps:{id:c},disabled:p},r.a.createElement(Y.a,{value:""},r.a.createElement("em",null,"---")),a.map((function(e,t){return r.a.createElement(Y.a,{value:e[l.id],key:t},e[l.label])})))))})),va=a(133),ha=a(134),_a=a(137),ya=a(136),Oa=a(372),ja=function(e){Object(_a.a)(a,e);var t=Object(ya.a)(a);function a(){var e;Object(va.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={labelWidth:0},e}return Object(ha.a)(a,[{key:"componentDidMount",value:function(){this.setState({labelWidth:i.a.findDOMNode(this.InputLabelRef).offsetWidth})}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.list,l=t.mapping,i=t.label,c=t.div_id,o=t.changeHandler,s=t.value,m=t.css,u=this.state.labelWidth;return r.a.createElement(Re.a,{required:!0,variant:"outlined",className:"".concat(a.formControl," ").concat(m)},r.a.createElement(fa.a,{ref:function(t){e.InputLabelRef=t},htmlFor:c},i),r.a.createElement(ga.a,{value:s,onChange:o,name:c,input:r.a.createElement(Oa.a,{labelWidth:u,id:c}),fullWidth:!0},r.a.createElement(Y.a,{value:""},r.a.createElement("em",null,"---")),n.map((function(e,t){return r.a.createElement(Y.a,{value:e[l.id],key:t},e[l.label])}))))}}]),a}(n.Component),xa=Object(u.a)((function(e){return{formControl:{minWidth:120}}}))(ja),Sa={id:"user_id",label:"name"};function ka(e){return e.map((function(e){var t=e.user_id,a=e.first_name,n=e.last_name;return{user_id:t,name:"".concat(n,", ").concat(a)}}))}var Ca=function(e){var t=e.variant,a=e.label,l=e.div_id,i=e.changeHandler,c=e.value,s=e.css,m=e.disabled,u=e.returnFullNameCallback,d=e.isCommunityStaff,p=Object(n.useState)([]),b=Object(o.a)(p,2),f=b[0],g=b[1],E=Object(n.useContext)(Kt).users;if(Object(n.useEffect)((function(){var t=it.a.CancelToken.source();if(d){var a=e.site_code,n="".concat(We.b,"/api/users/get_community_users_by_site/").concat(a);it.a.get(n,{cancelToken:t.token}).then((function(e){var t=ka(e.data);g(t)})).catch((function(e){console.log(e)}))}else{var r=ka(E);g(r)}return function(){t.cancel()}}),[E]),"undefined"!==typeof u&&u){var v=f.find((function(e){return e.user_id===c}));"undefined"!==typeof v&&u(v.name)}return r.a.createElement(n.Fragment,null,"standard"===t&&r.a.createElement(Ea,{label:a,div_id:l,changeHandler:i,value:0===f.length?"":c,list:f,mapping:Sa,css:s,disabled:m}),"outlined"===t&&r.a.createElement(xa,{label:a,div_id:l,changeHandler:i,value:0===f.length?"":c,list:f,mapping:Sa,css:s}))},wa=Object(n.createContext)(),Aa=function(e){var t=e.children,a=Object(n.useState)(""),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)("---"),m=Object(o.a)(s,2),u=m[0],d=m[1];return r.a.createElement(wa.Provider,{value:{reporter_id_ct:i,setReporterIdCt:c,ct_full_name:u,setCTFullName:d}},t)},Da=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{root:{width:"100%"},sectionHead:Object(d.a)(Object(d.a)({},t.sectionHead),{},{marginBottom:24}),AccordionSummaryContent:{justifyContent:"space-between"},invalidCandidate:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)"},validCandidate:{background:"linear-gradient(315deg, #00b712 0%, #5aff15 74%)"},partialInvalidCandidate:{background:"linear-gradient(315deg, #bbf0f3 0%, #f6d285 74%)"},inputWidth:{width:"50%"}})}));function Ia(e){return X()(e).format("DD MMMM YYYY, HH:mm")}var Ma=function(){return r.a.createElement(Oe.a,{height:60,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}))};function Na(e){var t=e.alertData,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.index,o=e.releaseFormOpenHandler,s=e.isShowingValidation,m=e.toggleValidation,u=e.validationDetails,d=Object(n.useContext)(Kt).sites,b="",f="",g="",E=[],v=!1,h=t.general_status,O=t.is_release_time,j=t.unresolved_moms_list,x=[],S=[],k=[],C=t.validity_status,w="valid";if("undefined"!==typeof C&&(w=C),"routine"===h){var A=t.data_ts,D=t.public_alert_symbol,I=t.overdue_routine_list,M=t.routine_details;b="ROUTINE RELEASE",f=Ia(A),g=D,k=I,M.forEach((function(e){"ND"===e.internal_alert_level&&null!==d&&e.site_id_list.forEach((function(e){var t=d.filter((function(t){return t.site_id===e}));S.push(t[0])})),"A0"===e.internal_alert_level&&null!==d&&e.site_id_list.forEach((function(e){var t=d.filter((function(t){return t.site_id===e}));x.push(t[0])}))}))}else{var N=t.site_code,T=t.release_details,H=t.internal_alert_level,R=t.trigger_list_arr,Y=T.data_ts;b=N,f=Ia(Y),g=H,v="No new triggers"!==(E="undefined"===typeof R?[]:R)&&E.length>0}b=b.toUpperCase();var B=h.toUpperCase(),P=a.alert0;return"invalid"===w?P=a.alert3:"partially valid"===w&&(P=a.alert2),r.a.createElement(le.a,{key:"panel-".concat(c+1),expanded:l==="panel".concat(c),onChange:i("panel".concat(c))},r.a.createElement(ie.a,{"aria-controls":"panel".concat(c,"bh-content"),id:"panel".concat(c,"bh-header"),classes:{content:a.AccordionSummaryContent,root:P}},[b,f,w.toUpperCase(),B].map((function(e,t){return r.a.createElement(y.a,{key:"candidate-column-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(ce.a,{style:{marginBottom:12}}),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},f)),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Internal Alert:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},g))),r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},"ROUTINE"===B?r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:2,justify:"space-between"},r.a.createElement(_.a,{item:!0,container:!0,xs:12,md:12},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6"},r.a.createElement("strong",null,"A0"))),x.length>0?x.map((function(e){return r.a.createElement(_.a,{item:!0,md:1,xs:2,key:e.site_code,style:{padding:3}},r.a.createElement(y.a,{variant:"body1"},e.site_code.toUpperCase()))})):r.a.createElement(y.a,{variant:"subtitle2"},"None")),r.a.createElement(_.a,{item:!0,container:!0,xs:12,md:12,alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6"},r.a.createElement("strong",null,"ND"))),S.length>0&&"undefined"!==typeof S?S.map((function(e){return r.a.createElement(_.a,{item:!0,md:1,xs:2,key:e.site_id,style:{padding:3}},r.a.createElement(y.a,{variant:"body1"},e.site_code.toUpperCase()))})):r.a.createElement(y.a,{variant:"subtitle2"},"None")),r.a.createElement(_.a,{item:!0,container:!0,xs:12,md:12},k.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:a.routineSitesContainer},r.a.createElement(y.a,{variant:"h6"},r.a.createElement("strong",null,"Overdue"))),k.map((function(e){return r.a.createElement(_.a,{item:!0,md:1,xs:2,key:e.site_code,style:{justifyItems:"center",padding:3}},r.a.createElement(y.a,{variant:"body1"},e.site_code.toUpperCase()))}))))):r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(_.a,{item:!0,xs:12,md:12},r.a.createElement(y.a,{variant:"subtitle2",color:"textPrimary"},"TRIGGERS")),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},v?E.map((function(e,t){var a=e.ts_updated,l=e.alert,i=(e.tech_info,e.trigger_id),c=e.trigger_type,o=Ia(a),d="Valid",f=!1,g=!1;try{var v=e.validating_status;0===v?(d="Validating",g=!0,f=!0):null===v?(d="---",f=!0):1===v&&(f=!1)}catch(O){}try{e.invalid&&(d="Invalid")}catch(O){}var h=["surficial","rainfall","subsurface"].includes(c)&&f;return r.a.createElement(n.Fragment,{key:"trigger-".concat(c,"-").concat(l)},r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Trigger"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},l)),r.a.createElement(_.a,{item:!0,xs:4,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(_.a,{item:!0,xs:!0,align:h?"flex-start":"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Status:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},d)),h&&r.a.createElement(_.a,{item:!0,xs:!0,justify:"flex-end",container:!0},r.a.createElement(p.a,{onClick:m(!0,{site:b,trigger_id:i,ts_updated:a}),variant:"contained",color:"secondary",size:"small","aria-label":"Validate trigger"},"Validate")),r.a.createElement(Ke,{isShowing:s,data:u,hide:m(!1,{}),isValidating:g}),E.length>t+1&&r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)))})):r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"No new triggers")))))),"undefined"!==typeof j&&j.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle2",color:"textPrimary"},"UNRESOLVED MOMS LIST")),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},j.map((function(e,t){var a=e.moms_instance,l=e.observance_ts,i=e.op_trigger,c=a.feature.feature_type,o=a.feature_name,s="".concat(ot(c)," ").concat(o.toUpperCase()),m=Ia(l);return r.a.createElement(n.Fragment,{key:e.moms_id},r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Feature"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(_.a,{item:!0,xs:4,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Last Report"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Alert Level"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},i)),j.length>t+1&&r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)))}))))))),r.a.createElement(ce.a,null),r.a.createElement(je.a,null,r.a.createElement(p.a,{color:"secondary",size:"small","aria-label":"Release candidate alert",startIcon:r.a.createElement(Se.a,null),onClick:o(t,h),disabled:!O},"Release")))}function Ta(e){var t=e.siteAlert,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.smsHandler,o=e.bulletinHandler,s=e.keyName,m=e.type,u=e.history,d=t.event,b=t.internal_alert_level,f=t.releases,g=t.day,E=t.sent_statuses,v=t.public_alert_symbol,h=t.is_onset_release,O=t.prescribed_release_time,j=t.has_alert_release_today,x=t.highest_event_alert_level,S=v.alert_level,k=Object(n.useContext)(ee.a).server_time,C=E.is_sms_sent,w=E.is_bulletin_sent,A=d.validity,D=d.site,I=d.event_start,M=d.event_id,N=D.site_code,T=D.site_id,H=N.toUpperCase(),R=Ia(I),Y=Ia(A),B=f[0],P=B.release_id,L=B.data_ts,F=B.release_time,z=L;h||(z=X()(L).add(30,"minutes")),z=Ia(z);var U=[H,b];if("extended"===m){var W="";j||(W=r.a.createElement(xe.a,{arrow:!0,title:"Don't forget to release today's site alert for extended monitoring!"},r.a.createElement(ue.a,{fontSize:"small",style:{marginLeft:8},className:a.dyna_error})));var G=r.a.createElement("span",{style:{display:"flex",alignItems:"center"}},"Day ",g,W);U.push(G)}else U.push(z,F);var q=C?r.a.createElement(ke.a,null):"",V=w?r.a.createElement(ke.a,null):"",Q=null!==k&&X()(k).isBefore(O)&&!h;Q&&(q=r.a.createElement(Ce.a,null),V=r.a.createElement(Ce.a,null));var Z=function(e){var t=e.toLowerCase();return"bulletin"===t&&"extended"===m?"No need to send EWI bulletin on sites under extended monitoring":Q?"Wait for EWI sending time":E["is_".concat(t,"_sent")]?"EWI ".concat(e," sent!"):"Send EWI ".concat(e)};return r.a.createElement(le.a,{expanded:l===s,onChange:i(s)},r.a.createElement(ie.a,{"aria-controls":"".concat(s,"bh-content"),id:"".concat(s,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a["alert".concat(S)]}},U.map((function(e,t){return r.a.createElement(y.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(ce.a,{style:{marginBottom:12}}),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Start:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},R)),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Validity:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},Y))),r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle2",color:"textPrimary"},"LATEST RELEASE")),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},[["Internal Alert",b],["Data Timestamp",Ia(L)],["Release Time",F]].map((function(e,t){return r.a.createElement(_.a,{key:e[0],item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},e[0]),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},e[1]))}))))),r.a.createElement(ce.a,null),r.a.createElement(je.a,null,r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(we.a,null),onClick:function(){return u.push("/monitoring/events/".concat(M))},align:"left"},"Timeline"),r.a.createElement(xe.a,{arrow:!0,title:Z("SMS")},r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ae.a,null),onClick:c({release_id:P,site_code:N,site_id:T,type:m,public_alert_symbol:v,highest_event_alert_level:x}),endIcon:q,className:Q&&a.dyna_error},"EWI SMS")),r.a.createElement(xe.a,{arrow:!0,title:Z("Bulletin")},r.a.createElement("span",null,r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(De.a,null),onClick:o({release_id:P,site_code:N,site_id:T,type:m,is_bulletin_sent:w}),endIcon:V,className:Q?a.dyna_error:"",disabled:"extended"===m},"Bulletin")))))}function Ha(e){var t=e.siteAlert,a=e.classes,n=e.expanded,l=e.handleExpansion,i=e.smsHandler,c=e.keyName,o=t.released_sites,s=o[0].data_ts;return s=Ia(s),r.a.createElement(le.a,{expanded:n===c,onChange:l(c)},r.a.createElement(ie.a,{"aria-controls":"".concat(c,"bh-content"),id:"".concat(c,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a.alert0}},["ROUTINE",s].map((function(e,t){return r.a.createElement(y.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(ce.a,{style:{marginBottom:12}}),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(y.a,{component:"span",variant:"body1",color:"textPrimary"},s))),r.a.createElement(_.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle2",color:"textPrimary"},"ROUTINE SITES")),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},o.map((function(e,t){return r.a.createElement(_.a,{key:"site-".concat(e.site_code),item:!0,xs:2,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},e.site_code.toUpperCase()))}))))),r.a.createElement(ce.a,null),r.a.createElement(je.a,null,r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ae.a,null),onClick:i(o)},"EWI SMS")))}var Ra=function(e){var t=e.candidateAlertsData,a=e.alertsFromDbData,l=e.releaseFormOpenHandler,i=e.history,c=Da(),s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),f=b[0],g=b[1],E=Object(n.useState)({}),v=Object(o.a)(E,2),h=v[0],O=v[1],j=Je(),x=j.isShowing,S=j.toggle,k=Je(),C=k.isShowing,w=k.toggle,A=Object(n.useState)({}),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=r.a.useContext(wa),B=Y.reporter_id_ct,P=Y.setReporterIdCt,L=Y.setCTFullName,F=Object(n.useState)({}),z=Object(o.a)(F,2),U=z[0],W=z[1],G=function(e){return function(t,a){d(!!a&&e)}},q=Object(n.useState)(""),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=function(e){return function(t){M(e),function(e,t){var a="".concat(We.b,"/api/chatterbox/get_ewi_message/").concat(e);it.a.get(a).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(e.release_id,(function(e){Z(e),S()}))}},J=function(e,t){return function(){O(t),g(e)}},X=function(e){return function(t){M(e),R(!0)}},$=[],ee=[],te=[],ae=[];return null!==a&&($=a.latest,ee=a.extended,te=a.overdue,ae=a.routine),r.a.createElement("div",{className:c.root},r.a.createElement(_.a,{container:!0,className:c.sectionHeadContainer},r.a.createElement(_.a,{item:!0,xs:12,align:"right",style:{marginBottom:22}},r.a.createElement(Ca,{variant:"standard",label:"Monitoring Partner",div_id:"reporter_id_ct",changeHandler:function(e){return P(e.target.value)},value:B,css:c.inputWidth,returnFullNameCallback:function(e){return L(e)}})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{className:c.sectionHead,variant:"h5"},"Candidate Alerts")),r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:22}},null===t?r.a.createElement(Ma,null):0!==t.length?t.map((function(e,a){return r.a.createElement(Na,{key:"exp-".concat(a+1),classes:c,alertData:e,expanded:u,handleExpansion:G,releaseFormOpenHandler:l,index:a,isShowingValidation:f,toggleValidation:J,validationDetails:h,candidateAlertsData:t})})):r.a.createElement(y.a,{variant:"body1",align:"center"},"No candidate alerts")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{className:c.sectionHead,variant:"h5"},"Event Monitoring")),r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Ma,null):$.length>0?$.map((function(e,t){return r.a.createElement(Ta,{key:"latest-".concat(t+1),keyName:"latest-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:G,smsHandler:K,bulletinHandler:X,type:"latest",history:i})})):r.a.createElement(y.a,{variant:"body1",align:"center"},"No active alerts on database")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{className:c.sectionHead,variant:"h5",component:_.a,container:!0,alignItems:"center"},"Overdue Event Monitoring",r.a.createElement(xe.a,{title:"This section shows all monitoring events that are beyond their validities. Possible causes of not updated validity: no latest release, wrong internal alert to extend validity (for cases like ND).",style:{marginLeft:8},arrow:!0},r.a.createElement(Ie.a,{color:"primary"})))),r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Ma,null):te.length>0?te.map((function(e,t){return r.a.createElement(Ta,{key:"overdue-alert-".concat(t+1),keyName:"overdue-alert-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:G,smsHandler:K,index:t,bulletinHandler:X,type:"overdue",history:i})})):r.a.createElement(y.a,{variant:"body1",align:"center"},"No sites with monitoring events beyond their validity")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{className:c.sectionHead,variant:"h5"},"Extended Monitoring")),r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Ma,null):ee.length>0?ee.map((function(e,t){return r.a.createElement(Ta,{key:"db-alert-".concat(t+1),keyName:"db-alert-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:G,smsHandler:K,index:t,bulletinHandler:X,type:"extended",history:i})})):r.a.createElement(y.a,{variant:"body1",align:"center"},"No sites under extended monitoring")),null===a?r.a.createElement(Ma,null):"undefined"!==typeof ae.released_sites&&ae.released_sites.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{className:c.sectionHead,variant:"h5"},"Routine Monitoring")),r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:22}},r.a.createElement(Ha,{key:"routine-alert-panel",keyName:"routine-alert-panel",classes:c,siteAlert:ae,expanded:u,handleExpansion:G,smsHandler:function(e){return function(){!function(e,t){var a="".concat(We.b,"/api/chatterbox/get_routine_ewi_template");it.a.get(a).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(0,(function(t){W(e),Z(t),w()}))}},index:0,bulletinHandler:X,type:"routine",history:i}))),r.a.createElement(yt,{classes:c,isOpenBulletinModal:H,setIsOpenBulletinModal:R,releaseDetail:I})),r.a.createElement(ua,{modalStateHandler:S,modalState:x,textboxValue:Q,releaseDetail:I}),r.a.createElement(ba,{modalStateHandler:w,modalState:C,textboxValue:Q,siteList:U}))},Ya=a(812),Ba=a(813),Pa=a(814);function La(e){return X()(e).format("D MMMM YYYY, H:mm")}var Fa=function(){return r.a.createElement(Oe.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"8",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"0",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"8",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"140",rx:"0",ry:"0",width:"206",height:"116"}))};var za=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],u=s[1],d=function(e){return function(t){i(!0),u(e)}},b=function(){i(!1)},f="",g=e.generatedAlertsData,E=Object(n.useContext)(Kt).sites;return null!==g&&g.length>0&&(f=function(e,t,a,l){var i=e.site_code,c=e.ts,o=e.internal_alert,s=e.validity,m=e.current_trigger_alerts,u=e.event_triggers,d=function(e,t){for(var a=null,n=0;n<t.length;n+=1)if(t[n].site_code===e){a=t[n];break}return a}(i,l),b=La(c),f=ct(d),g=[],E=null;return m.forEach((function(e){var t=e.type,a=e.details;if("subsurface"===t)E=a.trigger_details;else{var n=a.alert_level,l=a.alert_symbol,i="rainfall"===t&&n>0?" (".concat(a.rain_gauge,")"):"";g.push(r.a.createElement(_.a,{item:!0,xs:12,sm:!0,key:t},r.a.createElement(y.a,{variant:"body1",color:"textSecondary",align:"center"},t.charAt(0).toUpperCase()+t.slice(1)," Alert"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary",align:"center"},l,r.a.createElement(y.a,{component:"span",variant:"body2",color:"textPrimary",align:"center"},i))))}})),r.a.createElement(Me.a,{fullWidth:!0,open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(Ne.a,{id:"alert-dialog-title"},r.a.createElement("div",null,f),r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},b)),r.a.createElement(Te.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Internal Alert Level"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},o)),""!==s&&r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"Validity"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},La(s))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"OPERATIONAL ALERT STATUS"))),g.map((function(e){return e})),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body2",color:"textPrimary"},"Subsurface Column Status")),E.length>0?E.map((function(e){var t=e.alert_symbol,a=e.tsm_name,n=e.ts;return r.a.createElement(_.a,{item:!0,xs:12,sm:!0,key:a,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},a.toUpperCase()),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},La(n)),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},t))})):r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textSecondary"},"No subsurface sensors available")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),u.length>0&&r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"EVENT TRIGGERS"))),u.map((function(e){var t=e.ts_updated,a=e.alert,l=e.tech_info,i=e.invalid,c=e.invalid_details,o=La(t);return r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,key:a},r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"Trigger | ",a))),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},l)),"undefined"!==typeof i&&!0===i&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"INVALIDATED ALERT"))),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},"".concat(c.user.first_name," ").concat(c.user.last_name))),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},La(c.ts_ack))),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},c.remarks))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)))})))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:a,color:"primary",autoFocus:!0},"Close")))}(g[m],l,b,E)),r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:2},null===g?r.a.createElement(Fa,null):g.map((function(e,t){return function(e,t,a,n){var l=e.ts,i=e.site_code,c=e.internal_alert,o=La(l);return r.a.createElement(_.a,{item:!0,xs:6,sm:4,lg:3,key:t},r.a.createElement(Ya.a,{className:"alert-card"},r.a.createElement(Ba.a,{onClick:a(t)},r.a.createElement(Pa.a,{style:{paddingBottom:16}},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",gutterBottom:!0},o),r.a.createElement("div",{style:{display:"flex",alignItems:"baseline",alignContent:"flex-end",justifyContent:"space-between"}},r.a.createElement(y.a,{variant:"h5",component:"h2"},i.toUpperCase()),r.a.createElement(y.a,{className:"card-internal-alert",color:"textSecondary"},c))))))}(e,t,d)})),f))},Ua=a(815),Wa=a(816),Ga=a(817),qa=a(818),Va=a(819);var Qa=Object(u.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxes:{paddingTop:4,paddingBottom:4},checkboxesGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}}))((function(e){var t=e.classes,a=e.switchState,l=e.switchHandler,i=e.switchValue,c=e.label,o=e.changeHandler,s=(e.setTriggersState,e.choices);return r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,c),r.a.createElement(Ua.a,{checked:a,onChange:l,value:i})),a?r.a.createElement(n.Fragment,null,r.a.createElement(ra.a,{className:t.checkboxesGroup},s.map((function(e,a){var n=e.state,l=e.value,i=e.label,c=n.status,s=n.disabled;return r.a.createElement(Be.a,{key:a,control:r.a.createElement(kt.a,{checked:c,onChange:o(l),value:l,className:t.checkboxes,disabled:s}),label:i})}))),r.a.createElement(g.a,null,"Add required if required")):r.a.createElement("div",null))})),Za=function(e,t){return function(a,n){return function(r){var l="timestamp"===a?r:r.target.value,i=parseInt(n.charAt(1),10);e({action:"UPDATE_DETAILS",trigger_type:t,value:{alert_level:i,[a]:l}})}}},Ka=function(e,t){return function(a){var n=a.target.checked;if(e({action:"TOGGLE_SWITCH",trigger_type:t,value:n}),["on_demand","earthquake"].includes(t)){var r,l=null;"on_demand"===t?(r={reason:"",reporterId:""},l=12):"earthquake"===t&&(r={magnitude:"",longitude:"",latitude:""},l=11),e({action:n?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:Object(d.a)({alert_level:1,timestamp:null,tech_info:"",internal_sym_id:l},r)})}}},Ja=function(e,t){return function(a){return function(n){var r=n.target.checked,l=null;"surficial"===t?2===a?l=6:3===a&&(l=4):"subsurface"===t&&(2===a?l=3:3===a&&(l=1)),e({action:r?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:{alert_level:a,status:r,disabled:!1,timestamp:null,tech_info:"",internal_sym_id:l}})}}},Xa=function(e,t){return function(a){var n=a.target.value;e({action:"REMOVE_TRIGGER",trigger_type:t,value:"clear_all"}),e({action:"ADD_TRIGGER",trigger_type:t,value:{alert_level:parseInt(n,10),timestamp:null,tech_info:"",internal_sym_id:8}})}},$a=function(e,t,a){return function(n){var r=n.target.value;t({action:"UPDATE_DETAILS",trigger_type:a,value:{alert_level:1,[e]:r}})}};var en=Object(u.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.changeHandler,l=e.labelFor,i=e.trigger_timestamp,c=e.tech_info;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Trigger Timestamp (".concat(l,")"),value:i,onChange:a("timestamp",l),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,label:"Technical Information (".concat(l,")"),multiline:!0,rowsMax:"2",placeholder:'Enter technical info for "'.concat(l,'" trigger'),value:c,onChange:a("tech_info",l),fullWidth:!0})))}));var tn=Object(u.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.subsurface,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach((function(e){var t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(d.a)(Object(d.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0}));var u=m.trigger_2,p=m.trigger_3,b=m.trigger_nd,f=[{state:u,value:2,label:"Release trigger (s2)"},{state:p,value:3,label:"Release trigger (S3)"}],g=i.filter((function(e){return"subsurface"===e.trigger_source}));if(g.length>0){var E=g.pop();f.push({state:b,value:"nd",label:"No data ([s/S]0)"}),-1===E.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(Qa,{label:"Subsurface",switchState:o,switchHandler:Ka(l,"subsurface"),switchValue:"subsurface_switch",choices:f,changeHandler:Ja(l,"subsurface")})),u.status&&o?r.a.createElement(en,{labelFor:"s2",trigger_timestamp:u.timestamp,tech_info:u.tech_info,changeHandler:Za(l,"subsurface")}):r.a.createElement("div",null),p.status&&o?r.a.createElement(en,{labelFor:"S3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:Za(l,"subsurface")}):r.a.createElement("div",null))}));var an=Object(u.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.surficial,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach((function(e){var t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(d.a)(Object(d.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0}));var u=m.trigger_2,p=m.trigger_3,b=m.trigger_nd,f=[{state:u,value:2,label:"Release trigger (g2)"},{state:p,value:3,label:"Release trigger (G3)"}],g=i.filter((function(e){return"surficial"===e.trigger_source}));if(g.length>0){var E=g.pop();f.push({state:b,value:"nd",label:"No data ([g/G]0)"}),-1===E.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(Qa,{label:"Surficial",switchState:o,switchHandler:Ka(l,"surficial"),switchValue:"surficial_switch",choices:f,changeHandler:Ja(l,"surficial")})),u.status?r.a.createElement(en,{labelFor:"g2",trigger_timestamp:u.timestamp,tech_info:u.tech_info,changeHandler:Za(l,"surficial")}):r.a.createElement("div",null),p.status?r.a.createElement(en,{labelFor:"G3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:Za(l,"surficial")}):r.a.createElement("div",null))}));Object(O.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}));var nn=Object(u.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},radios:{paddingTop:4,paddingBottom:4},radioGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}}))((function(e){var t=e.classes,a=e.id,l=e.label,i=e.changeHandler,c=e.radioValue,o=e.choices,s=e.switchState,m=e.switchValue,u=e.switchHandler;return r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,l),r.a.createElement(Ua.a,{checked:s,onChange:u,value:m})),s?r.a.createElement(n.Fragment,null,r.a.createElement(Ye.a,{className:t.radioGroup,"aria-label":l,name:a,value:c,onChange:i},o.map((function(e,a){var n=e.value,l=e.label;return r.a.createElement(Be.a,{key:a,value:n,control:r.a.createElement(Pe.a,{className:t.radios}),label:l})}))),r.a.createElement(g.a,null,"Add required if required")):r.a.createElement("div",null))}));var rn=Object(u.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.rainfall,o=c.switchState,s=c.triggers,m={alert_level:""};0!==s.length&&s.forEach((function(e){m=Object(d.a)(Object(d.a)({},e),{},{alert_level:"".concat(e.alert_level)})}));var u=[{value:"1",label:"Release new trigger"}],p=i.filter((function(e){return"rainfall"===e.trigger_source}));if(p.length>0){p.pop();u.push({value:"-1",label:"No data (R0)"},{value:"-2",label:"Intermediate threshold (rx)"})}return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(nn,{label:"Rainfall",id:"rainfall",switchState:o,switchHandler:Ka(l,"rainfall"),switchValue:"rainfall_switch",radioValue:m.alert_level,choices:u,changeHandler:Xa(l,"rainfall")})),"1"===m.alert_level&&o?r.a.createElement(en,{labelFor:"R1",trigger_timestamp:m.timestamp,tech_info:m.tech_info,changeHandler:Za(l,"rainfall")}):r.a.createElement("div",null))}));var ln=Object(u.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=a.earthquake,c=i.switchState,o=i.triggers,s={timestamp:null,tech_info:"",magnitude:null,latitude:null,longitude:null};0!==o.length&&(s=Object(d.a)({},o[0]));var m=s,u=m.timestamp,p=m.tech_info,b=m.magnitude,g=m.latitude,E=m.longitude;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"Earthquake"),r.a.createElement(Ua.a,{checked:c,onChange:Ka(l,"earthquake"),value:"switch_earthquake"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(en,{labelFor:"e1",trigger_timestamp:u,tech_info:p,changeHandler:Za(l,"earthquake")}),r.a.createElement(_.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"magnitude",label:"Magnitude",value:b,onChange:$a("magnitude",l,"earthquake"),type:"number"})),r.a.createElement(_.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"latitude",label:"Latitude",value:g,onChange:$a("latitude",l,"earthquake"),type:"number"})),r.a.createElement(_.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"longitude",label:"Longitude",value:E,onChange:$a("longitude",l,"earthquake"),type:"number"}))):r.a.createElement("div",null))})),cn=[{user_id:1,name:"MLGU Something"},{user_id:2,name:"LEWC Chenes"},{user_id:3,name:"BLGU Chos"}];var on=Object(u.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=a.on_demand,c=i.switchState,o=i.triggers,s={timestamp:null,tech_info:"",reason:"",reporterId:""};0!==o.length&&(s=Object(d.a)({},o[0]));var m=s,u=m.timestamp,p=m.tech_info,b=m.reason,g=m.reporterId;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"On Demand"),r.a.createElement(Ua.a,{checked:c,onChange:Ka(l,"on_demand"),value:"switch_on_demand"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(en,{labelFor:"d1",trigger_timestamp:u,tech_info:p,changeHandler:Za(l,"on_demand")}),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"reason",label:"Reason",value:b,onChange:$a("reason",l,"on_demand"),placeholder:"Enter reason of on-demand request",multiline:!0,rowsMax:2,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Ea,{label:"Reporter",div_id:"reporter_id",changeHandler:$a("reporterId",l,"on_demand"),value:g,list:cn,mapping:{id:"user_id",label:"name"}}))):r.a.createElement("div",null))}));var sn=Object(O.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}}));function mn(e){var t=e.setModalTitle,a=e.generalData,l=e.classes,i=e.handleEventChange,c=e.handleDateTime,o=e.setGeneralData,s=e.isUpdatingRelease,m=e.changeState,u=a.siteId,p=a.dataTimestamp,b=a.releaseTime,f=a.reporterIdMt,g=a.reporterIdCt;Object(n.useEffect)((function(){t("Provide information to the following fields.")}),[]);return r.a.createElement(n.Fragment,null,s&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",color:"secondary"},"You chose a data timestamp that has been released. You are allowed to update release details but changes on triggers and alert level cannot be accepted. For those kind of changes, please contact the Software Infra Devs. Thank you."))),r.a.createElement(_.a,{item:!0,xs:12,className:l.inputGridContainer},r.a.createElement($t,{value:u,changeHandler:function(e){return function(e){var t=e.label,n=e.data;o(Object(d.a)(Object(d.a)({},a),{},{siteId:e,address:t,siteCode:n.site_code})),m("siteId",e)}(e)}})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Data timestamp",value:p,onChange:c("dataTimestamp"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(Wa.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:b,onChange:c("releaseTime"),clearable:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(Ca,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",changeHandler:i("reporterIdMt"),value:f,disabled:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(Ca,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",changeHandler:i("reporterIdCt"),value:g})))}function un(e){var t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.setModalTitle,c=e.hasNoGroundData,o=e.setHasNoGroundData,s=e.triggersReleased,m=e.alert_level,u=e.setAlert0,d=e.isAlert0,p=a.subsurface.switchState,b=a.surficial.switchState,f=a.moms.switchState;return Object(n.useEffect)((function(){i("Toggle ON all the triggers to be included in the internal alert computation, otherwise toggle them OFF. Fill in the required fields for each selected trigger.")}),[]),r.a.createElement(n.Fragment,null,0!==m&&r.a.createElement(_.a,{item:!0,xs:12,className:d?t.groupGridContainer:""},r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"Lower to Alert 0"),r.a.createElement(Ua.a,{checked:d,onChange:function(e){return u(e.target.checked)},value:"has_no_ground_data"})))),!p&&!b&&!f&&m<=1&&r.a.createElement(_.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Re.a,{component:"fieldset",className:t.formControl},r.a.createElement(na.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"No Ground Data (ND)"),r.a.createElement(Ua.a,{checked:c,onChange:function(e){return o(e.target.checked)},value:"has_no_ground_data"})))),!1===d&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",color:"secondary"},"Ground-Related Triggers")),r.a.createElement(tn,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(an,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(_.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(y.a,{variant:"h6",color:"secondary"},"Secondary Triggers")),r.a.createElement(rn,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(ln,{triggersState:a,setTriggersState:l}),r.a.createElement(on,{triggersState:a,setTriggersState:l})))}function dn(e){var t=e.classes,a=e.handleEventChange,l=e.generalData,i=e.internalAlertLevel,c=e.setModalTitle,s=e.mtFullName,m=e.ctFullName,u=e.ewiPayload,d=e.isAlertRecomputing,p=l.siteId,b=l.dataTimestamp,g=l.releaseTime,E=l.comments,v=Object(n.useState)(null),h=Object(o.a)(v,2),O=h[0],x=h[1];Object(n.useEffect)((function(){c("Review release summary. Add comment if necessary.");var e=[];"undefined"!==typeof u.trigger_list_arr&&(e=u.trigger_list_arr);var t=r.a.createElement(y.a,{variant:"body2",color:"textPrimary",align:"center"},"No triggers included in this release.");e.length>0&&(t=e.map((function(e,t){var a=e.ts_updated,l=e.alert_level,i=e.trigger_type,c=e.tech_info,o=i.charAt(0).toUpperCase()+i.slice(1),s=X()(a).format("DD MMMM YYYY, HH:mm");return r.a.createElement(n.Fragment,{key:"".concat(t+1)},r.a.createElement(_.a,{item:!0,xs:6,align:"center"},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Trigger"),r.a.createElement(y.a,{variant:"body2",color:"textPrimary"},"".concat(o," Alert ").concat(l))),r.a.createElement(_.a,{item:!0,xs:6,align:"center"},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(y.a,{variant:"body2",color:"textPrimary"},s)),r.a.createElement(_.a,{item:!0,xs:12,align:"center",style:{paddingBottom:20}},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Tech info"),r.a.createElement(y.a,{variant:"caption",color:"textPrimary"},c)))}))),x(t)}),[u]);var S=X()(b).format("DD MMMM YYYY, HH:mm"),k=X()(g).format("HH:mm");return r.a.createElement(n.Fragment,null,d?r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(j.a,null)):r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Site"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},p.label)),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Internal Alert"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},i)),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Data Timestamp"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},S)),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"Release Time"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},k)),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"MT Personnel"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary"},"CT Personnel"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{className:t.divider})),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"button",color:"textSecondary"},"Triggers")),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,align:"center"},O)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{className:t.divider})),r.a.createElement(_.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(f.a,{label:"Comments",multiline:!0,rowsMax:"2",placeholder:"Enter additional comments necessary",value:E,onChange:a("comments"),fullWidth:!0}))))}var pn=function(e){var t=e.activeStep,a=e.generalData,l=e.setGeneralData,i=e.setInternalAlertLevel,c=e.internalAlertLevel,s=e.setPublicAlertLevel,m=e.isUpdatingRelease,u=e.currentTriggersStatus,p=e.setDBSavedTriggers,b=e.siteCurrentAlertLevel,f=e.setSiteCurrentAlertLevel,g=sn(),E=Object(d.a)({classes:g},e),v=Object(x.a)(),h=v.first_name,O=v.last_name,j="".concat(O,", ").concat(h),S=r.a.useContext(wa).ct_full_name,k=Object(n.useState)(Object(Xe.a)(u)),C=Object(o.a)(k,2),w=C[0],A=C[1],D=function(e,t){"siteId"===e?function(e,t){var a=e.site_id,n="".concat(We.b,"/api/monitoring/get_site_alert_details");bt(n+="?site_id=".concat(a),t)}({site_id:t.value},(function(e){console.log(e);var t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_sources,r=e.alert_level;A(n),p(n),s(a),i(t),f(r)})):l(Object(d.a)(Object(d.a)({},a),{},{[e]:t}))},I=function(e){return function(t){D(e,t)}},M=function(e){return function(t){var a=t.target.value;D(e,a)}},N=["What are the release details?","List the triggers.","Add Comments and Review Release Summary"];return r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},function(e){switch(e){case 0:return r.a.createElement(mn,Object.assign({},E,{handleDateTime:I,handleEventChange:M,isUpdatingRelease:m,changeState:D}));case 1:return r.a.createElement(un,Object.assign({},E,{triggersReleased:w,alert_level:b}));case 2:return r.a.createElement(dn,Object.assign({},E,{mtFullName:j,ctFullName:S,internalAlertLevel:c,handleEventChange:M}));case 3:return r.a.createElement(y.a,{variant:"body1"},"Early warning information released! Please wait for the dashboard to update or check the site event timeline to confirm if EWI is released.");default:return"Uknown stepIndex"}}(t),r.a.createElement("div",{className:g.root},r.a.createElement(y.a,{className:g.instructions}),r.a.createElement(Ga.a,{activeStep:t,alternativeLabel:!0},N.map((function(e){return r.a.createElement(qa.a,{key:e},r.a.createElement(Va.a,null))}))))))},bn=Object(O.a)((function(e){return{inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}}}}));function fn(e,t){var a=t.rainfall,n=!1;return a.switchState&&a.triggers.forEach((function(e){e.alert_level<0&&(n=!0)})),e||n}var gn={subsurface:{switchState:!1,triggers:[]},surficial:{switchState:!1,triggers:[]},moms:{switchState:!1,triggers:[]},rainfall:{switchState:!1,triggers:[]},earthquake:{switchState:!1,triggers:[]},on_demand:{switchState:!1,triggers:[]}};function En(e,t){var a=t.action,n=t.trigger_type,r=t.value,l={},i=[];if("RESET_STATE"!==a){var c=e[n];i=(l=Object(d.a)({},c)).triggers}switch(a){case"TOGGLE_SWITCH":return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{switchState:r})});case"ADD_TRIGGER":return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{triggers:[].concat(Object(Xe.a)(i),[r])})});case"REMOVE_TRIGGER":var o;return o="clear_all"===r?[]:i.filter((function(e){return e.alert_level!==r.alert_level})),Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{triggers:o})});case"UPDATE_DETAILS":var s=i.map((function(e){return e.alert_level===r.alert_level?Object(d.a)(Object(d.a)({},e),r):e}));return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{triggers:s})});case"RESET_STATE":return Object(d.a)({},gn);default:return e}}var vn=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=e.setIsOpenRoutineModal,u=bn(),b=Object(x.a)().user_id,f=Object(n.useState)({}),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(n.useState)(0),y=Object(o.a)(h,2),O=y[0],j=y[1],S=Object(n.useState)(!0),k=Object(o.a)(S,2),C=k[0],w=k[1],A=[1,2,3],D=Object(n.useState)(""),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(""),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)(""),P=Object(o.a)(B,2),L=P[0],F=P[1],z=r.a.useContext(wa).reporter_id_ct,U={dataTimestamp:null,releaseTime:X()(),siteId:{},siteCode:"",address:"",reporterIdCt:z,reporterIdMt:b,comments:"",publicAlertSymbol:"",publicAlertLevel:"",triggerListStr:""},W=Object(n.useState)(Object(d.a)({},U)),G=Object(o.a)(W,2),q=G[0],V=G[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(0),re=Object(o.a)(ne,2),le=re[0],ie=re[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),se=oe[0],me=oe[1],ue=Object(n.useReducer)(En,Object(d.a)({},gn)),de=Object(o.a)(ue,2),pe=de[0],be=de[1],fe=Object(n.useState)([]),ge=Object(o.a)(fe,2),Ee=ge[0],ve=ge[1],he=Object(n.useState)([]),_e=Object(o.a)(he,2),ye=_e[0],Oe=_e[1],je=Object(c.b)().enqueueSnackbar;Object(n.useEffect)((function(){var e,t,a,n=q.dataTimestamp,r=q.siteCode;if("object"===typeof n&&X.a.isMoment(n)){var l=X()(n).format("YYYY-MM-DD HH:mm:00");e=r,t=l,a=function(e){Object.entries(e).length>1&&ae(!0)},bt("".concat(We.b,"/api/monitoring/get_monitoring_releases_by_data_ts/").concat(e,"/").concat(t),a)}}),[q.dataTimestamp]),Object(n.useEffect)((function(){if(null!==i&&"routine"!==i.general_status){var e=i.site_id,t=i.site_code,a=i.public_alert_level,n=i.public_alert_symbol,r=i.release_details,l=i.trigger_list_arr,c=i.has_ground_data,o=i.non_triggering_moms,s=i.internal_alert_level,m=i.current_triggers_status,u=i.saved_event_triggers,p=i.to_extend_validity,f=r.data_ts,g=r.trigger_list_str;N(s);var h=[];l.forEach((function(e){if(!0!==e.invalid&&h.push(e),"moms"===e.trigger_type){var t=e.moms_list;e.moms_id_list=t.map((function(e){return e.moms_id}))}}));var _=null;if(o.length>0)_={moms_id_list:o.map((function(e){return e.moms_id}))};v(Object(d.a)(Object(d.a)({},E),{},{site_id:e,site_code:t,public_alert_level:a,public_alert_symbol:n,release_details:{data_ts:f,trigger_list_str:g,release_time:X()().format("HH:mm:00")},publisher_details:{publisher_mt_id:b,publisher_ct_id:z},trigger_list_arr:h,non_triggering_moms:_,to_extend_validity:p})),J(!c);var y=Object(d.a)(Object(d.a)({},q),{},{reporterIdCt:z,dataTimestamp:X()(f),siteId:{value:e,label:t.toUpperCase()},siteCode:t,triggerListStr:g,publicAlertSymbol:n,publicAlertLevel:a,nonTriggeringMoms:o});V(Object(d.a)({},y)),be({action:"RESET_STATE"}),"undefined"!==typeof u&&ve(u);var O=[];l.forEach((function(e){var t=e.trigger_type,a=e.alert_level,n=e.ts_updated,r=e.internal_sym_id,l=e.tech_info,i=e.alert;if("undefined"===typeof e.invalid){var c={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};be(c);var o={alert:i,alert_level:a,internal_sym_id:r,tech_info:l,disabled:!1,status:!0,timestamp:X()(n)};if("moms"===t){var s=e.moms_list;o.moms_list=s,o.moms_id_list=s.map((function(e){return e.moms_id}))}if(be(c={action:"ADD_TRIGGER",trigger_type:t,value:o}),t in["on demand","earthquake"]){var m=null;switch(t){case"on demand":m={action:"UPDATE_TRIGGER",trigger_type:t,value:{od_details:{request_ts:"",narrative:""}}};break;case"earthquake":m={action:"UPDATE_TRIGGER",trigger_type:t,value:{eq_details:{magnitude:"",latitude:"",longitude:""}}}}null!=m&&be(m)}}else O.push(t)})),Oe(m),m.forEach((function(e){var t=e.trigger_source,a=e.alert_level;if(!O.includes(t)){var n=a;-1===a&&"rainfall"!==t&&(n="nd");var r=!0;a<=1&&["surficial","subsurface"].includes(t)&&(r=!1);var l={action:"TOGGLE_SWITCH",trigger_type:t,value:r};be(l),be(l={action:"ADD_TRIGGER",trigger_type:t,value:{status:!0,disabled:!1,alert_level:n,timestamp:null,tech_info:""}})}})),j(2)}else V(Object(d.a)({},U)),be({action:"RESET_STATE"}),ve([]),Oe([]),N(""),j(0)}),[i,z]);var xe=Object(n.useState)(!1),Se=Object(o.a)(xe,2),ke=Se[0],Ce=Se[1];Object(n.useEffect)((function(){if(w(!0),0===O){var e=q.siteId,t=q.dataTimestamp,a=q.releaseTime,n=q.reporterIdCt,r=q.reporterIdMt;w(""===e||null===t||null===a||""===n||""===r)}else if(1===O){for(var l=Object.keys(pe),i=!1,c=0;c<l.length;c+=1){var o=pe[l[c]],s=o.switchState,m=o.triggers;if(s){var u=m.length;if(0===u)i=!0;else for(var d=0;d<u;d+=1)if([1,2,3].includes(m[d].alert_level)){if("on_demand"===l[c]){var p=m[d],b=p.reason,f=p.reporterId,g=p.tech_info,E=p.timestamp;""!==g&&""!==E&&""!==b&&""!==f||(i=!0)}else if("earthquake"===l[c]){var v=m[d],h=v.tech_info,_=v.timestamp,y=v.magnitude,j=v.longitude,x=v.latitude;""!==h&&""!==_&&""!==y&&""!==j&&""!==x||(i=!0)}else{var S=m[d],k=S.tech_info,C=S.timestamp;""!==k&&null!==C||(i=!0)}break}}}w(i)}else if(2===O){w(""===z||ke)}}),[q,pe,O,z,ke]),Object(n.useEffect)((function(){var e=pe.subsurface,t=pe.surficial;(e.switchState||t.switchState)&&J(!1)}),[pe.subsurface,pe.surficial]);var we=function(){l(),j(0),s(null),V(Object(d.a)({},U)),v({}),me(!1),J(!1)};return r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Alert Release Form"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,L),r.a.createElement(pn,{activeStep:O,isUpdatingRelease:te,triggersState:pe,setTriggersState:be,generalData:q,setGeneralData:V,internalAlertLevel:M,setInternalAlertLevel:N,publicAlertLevel:R,setPublicAlertLevel:Y,setModalTitle:F,ewiPayload:E,hasNoGroundData:K,setHasNoGroundData:J,currentTriggersStatus:ye,setDBSavedTriggers:ve,siteCurrentAlertLevel:le,setSiteCurrentAlertLevel:ie,isAlert0:se,setAlert0:me,isAlertRecomputing:ke})),r.a.createElement(Le.a,null,O===A.length?r.a.createElement("div",null,r.a.createElement(p.a,{onClick:we,color:"primary"},"Okay")):r.a.createElement(_.a,{container:!0,spacing:1,justify:"space-between"},r.a.createElement(_.a,{item:!0,xs:!0,style:{display:null===i?"flex":"none"}},r.a.createElement(p.a,{onClick:m,className:u.backButton},"Release Routine")),r.a.createElement(_.a,{item:!0,xs:!0,align:"right"},r.a.createElement(p.a,{onClick:we,color:"primary"},"Cancel"),r.a.createElement(p.a,{disabled:0===O,onClick:function(){j((function(e){return e-1}))},className:u.backButton},"Back"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){j((function(e){return e+1}));var e=q.siteId,t=q.siteCode,a=q.publicAlertSymbol,n=q.dataTimestamp,r=q.releaseTime,l=q.reporterIdMt,i=q.reporterIdCt,c=q.comments,o=q.triggerListStr,s=[],m={};if(0===O)v(Object(d.a)(Object(d.a)({},E),{},{site_id:e.value,site_code:t,public_alert_level:R,public_alert_symbol:a,release_details:{data_ts:X()(n).format("YYYY-MM-DD HH:mm:00"),trigger_list_str:o,release_time:X()(r).format("HH:mm:00")},publisher_details:{publisher_mt_id:l,publisher_ct_id:i},non_triggering_moms:[]}));else if(1===O){var u={latest_trigger_list:s=function(e){var t=[];return Object.keys(e).forEach((function(a){if(e[a].switchState){var n=e[a].triggers,r="on_demand"===a?"on demand":a;n.forEach((function(e){var n=e.timestamp,l=e.alert_level,i=e.internal_sym_id,c=e.tech_info,o=null;null!==n&&(o=n.format("YYYY-MM-DD HH:mm:00"));var s,m=l;switch("nd"===l?m=-1:"rx"===l&&(m=-2),a){case"moms":s={moms_id_list:e.moms_id_list};break;case"on_demand":s={od_details:{request_ts:o,narrative:e.reason,reporter_id:e.reporterId}};break;case"earthquake":var u=e.magnitude,p=e.latitude,b=e.longitude;s={eq_details:{magnitude:parseFloat(u),latitude:parseFloat(p),longitude:parseFloat(b)}};break;default:s={}}var f=Object(d.a)(Object(d.a)({},s),{},{alert_level:m,internal_sym_id:i,tech_info:c,trigger_type:r,ts_updated:o});t.push(f)}))}})),t}(pe),current_trigger_list:Ee,has_no_ground_data:K,is_alert_0:se};console.log("JSON data for alert generation recomputation",u),Ce(!0);var p=s.filter((function(e){return e.alert_level>0}));!function(e,t){pt("".concat(We.b,"/api/monitoring/create_release_details"),e,t)}(u,(function(e){var t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_list_str,r=e.public_alert_symbol;Y(a),N(t),v(Object(d.a)(Object(d.a)({},E),{},{public_alert_level:a,public_alert_symbol:r,internal_alert_level:t,release_details:Object(d.a)(Object(d.a)({},E.release_details),{},{trigger_list_str:n}),trigger_list_arr:p,to_extend_validity:fn(K,pe)})),Ce(!1)}))}else if(O===A.length-1){F(""),(m=E).release_details.comments=c;var b=je("Inserting EWI release...",{variant:"warning",persist:!0});m.snackbar_key=b,v(m),console.log("Submitting data...",E),Ve("insert_ewi",E)}},disabled:C},O===A.length-1?"Submit":"Next"))))))})),hn=a(317),_n=a(820),yn=a(234),On=a(194),jn=a(537),xn=Object(O.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{margin:"auto"},cardHeader:{padding:e.spacing(1,2)},list:{width:200,height:230,backgroundColor:e.palette.background.paper,overflow:"auto"},button:{margin:e.spacing(.5,0)}}}));function Sn(e,t){return e.filter((function(e){return!t.some((function(t){return t.value===e.value}))}))}function kn(e,t){return e.filter((function(e){return t.some((function(t){return t.value===e.value}))}))}var Cn=function(e){var t=e.routineData,a=e.setRoutineData,l=e.a0SiteList,i=e.setA0SiteList,c=e.NDSiteList,s=e.setNDSiteList,m=e.dataTimestamp,u=e.setDataTimestamp,b=xn(),f=r.a.useContext(wa).reporter_id_ct,g=Object(n.useState)(null),E=Object(o.a)(g,2),v=E[0],h=E[1];Object(n.useEffect)((function(){h(t.release_time)}),[t]);var y=t.reporter_id_mt,O=function(e){return function(n){var r=Object(d.a)(Object(d.a)({},t),{},{[e]:n});a(r),"data_ts"===e&&u(X()(n).format("YYYY-MM-DD HH:mm:00"))}},j=r.a.useState([]),x=Object(o.a)(j,2),S=x[0],k=x[1],C=kn(S,l.site_id_list),w=kn(S,c.site_id_list),A=function(e,t){return function(){var a=S.findIndex((function(t){return t.value===e})),n=Object(Xe.a)(S);if(-1===a){var r=t.find((function(t){return t.value===e}));n.push(r)}else n.splice(a,1);k(n)}},D=function(e){return kn(S,e).length},I=function(e){return function(){var t,a;D(e)===e.length?k(Sn(S,e)):k((t=S,a=e,[].concat(Object(Xe.a)(t),Object(Xe.a)(Sn(a,t)))))}},M=function(e,t){var a=t.site_id_list;return r.a.createElement(Ya.a,null,r.a.createElement(_n.a,{className:b.cardHeader,avatar:r.a.createElement(kt.a,{onClick:I(a),checked:D(a)===a.length&&0!==a.length,indeterminate:D(a)!==a.length&&0!==D(a),disabled:0===a.length,inputProps:{"aria-label":"all site_id_list selected"}}),title:e}),r.a.createElement(ce.a,null),r.a.createElement(hn.a,{className:b.list,dense:!0,component:"div",role:"list"},a.map((function(e){var t=e.value,n=e.label,l="transfer-list-all-item-".concat(t,"-label");return r.a.createElement(yn.a,{key:t,role:"listitem",button:!0,onClick:A(t,a)},r.a.createElement(jn.a,null,r.a.createElement(kt.a,{checked:S.some((function(e){return e.value===t})),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":l}})),r.a.createElement(On.a,{id:l,primary:n}))})),r.a.createElement(yn.a,null)))};return r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Data timestamp",value:m,onChange:O("data_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,error:null===m})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},r.a.createElement(Wa.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:v,onChange:O("release_time"),clearable:!0})),r.a.createElement(_.a,{container:!0,spacing:2,justify:"center",alignItems:"center",className:b.root},r.a.createElement(_.a,{item:!0},M("A0 Sites",l)),r.a.createElement(_.a,{item:!0},r.a.createElement(_.a,{container:!0,direction:"column",alignItems:"center"},r.a.createElement(p.a,{variant:"outlined",size:"small",className:b.button,onClick:function(){s(Object(d.a)(Object(d.a)({},c),{},{site_id_list:c.site_id_list.concat(C)})),i(Object(d.a)(Object(d.a)({},l),{},{site_id_list:Sn(l.site_id_list,C)})),k(Sn(S,C))},disabled:0===C.length,"aria-label":"move selected NDSiteList"},">"),r.a.createElement(p.a,{variant:"outlined",size:"small",className:b.button,onClick:function(){i(Object(d.a)(Object(d.a)({},l),{},{site_id_list:l.site_id_list.concat(w)})),s(Object(d.a)(Object(d.a)({},c),{},{site_id_list:Sn(c.site_id_list,w)})),k(Sn(S,w))},disabled:0===w.length,"aria-label":"move selected a0SiteList"},"<"))),r.a.createElement(_.a,{item:!0},M("ND Sites",c))),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},r.a.createElement(Ca,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:y,disabled:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:b.inputGridContainer},r.a.createElement(Ca,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:f,disabled:!0}))))};function wn(e){var t=[];return e.length>0&&(t=e.map((function(e){var t=e.site_code;return{state:!0,value:e.site_id,label:t.toUpperCase(),is_disabled:!1}}))),t.sort((function(e,t){return e.site_id>t.site_id}))}var An=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=Object(x.a)().user_id,u=r.a.useContext(wa).reporter_id_ct,b=Object(n.useContext)(Kt).sites,f=Object(n.useState)({}),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(c.b)().enqueueSnackbar,_={public_alert_symbol:"A0",public_alert_level:0,data_ts:null,release_time:X()(),general_status:"routine",reporter_id_ct:u,reporter_id_mt:m,non_triggering_moms:{}},y=Object(n.useState)(Object(d.a)({},_)),O=Object(o.a)(y,2),j=O[0],S=O[1],k=Object(n.useState)(Object(d.a)({},{site_id_list:[],internal_alert_level:"A0",trigger_list_str:null})),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(Object(d.a)({},{site_id_list:[],internal_alert_level:"ND",trigger_list_str:null})),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)([]),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)(null),P=Object(o.a)(B,2),L=P[0],F=P[1],z=0===w.site_id_list.length&&0===M.site_id_list.length||""===u;return Object(n.useEffect)((function(){S(Object(d.a)({},_));var e=wn(b);Y(e)}),[b]),Object(n.useEffect)((function(){var e,t;null===i&&(null!==L?(e=L,t=function(e){var t=wn(e.unreleased_sites);A(Object(d.a)(Object(d.a)({},w),{},{site_id_list:t}))},bt("".concat(We.b,"/api/monitoring/get_unreleased_routine_sites/").concat(e),t)):(A(Object(d.a)(Object(d.a)({},w),{},{site_id_list:[]})),N(Object(d.a)(Object(d.a)({},M),{},{site_id_list:[]}))))}),[L,i]),Object(n.useEffect)((function(){if("undefined"!==typeof i&&null!==i&&"routine"===i.general_status){var e=Object(d.a)({},i);delete e.routine_details;var t=Object(d.a)(Object(d.a)({},_),e);S(t),F(e.data_ts),Object(d.a)({},i).routine_details.forEach((function(e){var t=e.site_id_list,a=e.internal_alert_level,n=R.filter((function(e){return t.includes(e.value)})),r=Object(d.a)(Object(d.a)({},e),{},{site_id_list:n});"A0"===a?A(r):N(r)})),v(Object(d.a)({},E))}}),[i,R]),r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Routine Release Form"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Transfer site codes to their respective list if needed. Put sites with ground data on A0 Sites list while put sites without ground data on ND Sites."),r.a.createElement(Cn,{routineData:j,setRoutineData:S,a0SiteList:w,setA0SiteList:A,NDSiteList:M,setNDSiteList:N,dataTimestamp:L,setDataTimestamp:F})),r.a.createElement(Le.a,null,r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:function(){l(),s(null),F(null)},color:"primary"},"Cancel"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){var e=X()(j.data_ts).format("YYYY-MM-DD HH:mm:00"),t=X()(j.release_time).format("HH:mm:ss"),a=h("Inserting Routine EWI release...",{variant:"warning",persist:!0}),n=Object(d.a)(Object(d.a)({},j),{},{data_timestamp:e,release_time:t,reporter_id_ct:u,routine_details:[Object(d.a)({},w),Object(d.a)({},M)],snackbar_key:a});console.log("Submitting data...",n),Ve("insert_ewi",n),l()},disabled:z},"Submit"))))))})),Dn=a(821),In=a(822),Mn=a(823),Nn=a(376),Tn=a.n(Nn);function Hn(e){var t=e,a=e.ts_posted,n=e.ts_expiration,r=e.site_id_list,l=[];return null!==r&&r.forEach((function(e){var t=e.value;l.push(t)})),t.user_id=Object(x.a)().user_id,t.ts_posted=X()(a).format("YYYY-MM-DD HH:mm:ss"),"Invalid date"!==n&&(t.ts_expiration=X()(n).format("YYYY-MM-DD HH:mm:ss")),t.site_id_list=l,t}function Rn(e,t){!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;it.a.post(t,e).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e)}))}(Hn(e),"".concat(We.b,"/api/issues_and_reminders/write_issue_reminder_to_db"),t)}var Yn=[{active:!0,barangay:"Agbatuan",municipality:"Dumarao",province:"Capiz",psgc:61904001,purok:null,region:"VI",season:1,site_code:"agb",site_id:1,sitio:null,latitude:11.28137,longitude:122.8311},{active:!0,barangay:"Poblacion",municipality:"Bakun",province:"Benguet",psgc:141103009,purok:null,region:"CAR",season:2,site_code:"bak",site_id:2,sitio:null,latitude:16.7907,longitude:120.6616},{active:!0,barangay:"Banlasan",municipality:"Calape",province:"Bohol",psgc:71210003,purok:null,region:"VI",season:1,site_code:"ban",site_id:3,sitio:null,latitude:9.888559,longitude:123.9488},{active:!0,barangay:"Baras",municipality:"Tarangnan",province:"Samar",psgc:86020008,purok:null,region:"VIII",season:1,site_code:"bar",site_id:4,sitio:null,latitude:11.90208,longitude:124.6566},{active:!0,barangay:"Bayabas",municipality:"Labo",province:"Camarines Norte",psgc:51606009,purok:null,region:"V",season:1,site_code:"bay",site_id:5,sitio:null,latitude:14.18797,longitude:122.4675},{active:!0,barangay:"Boloc",municipality:"Tubungan",province:"Iloilo",psgc:63046016,purok:null,region:"VI",season:2,site_code:"blc",site_id:6,sitio:null,latitude:10.82665,longitude:122.3108},{active:!0,barangay:"Bolodbolod",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412004,purok:"3 & 4",region:"VIII",season:1,site_code:"bol",site_id:7,sitio:null,latitude:10.30199,longitude:125.1279},{active:!0,barangay:"Bato",municipality:"Sibonga",province:"Cebu",psgc:72246007,purok:null,region:"VI",season:1,site_code:"bto",site_id:8,sitio:null,latitude:10.01379,longitude:123.5776},{active:!0,barangay:"San Carlos",municipality:"Dapa",province:"Surigao del Norte",psgc:166707025,purok:null,region:"XIII",season:1,site_code:"car",site_id:9,sitio:null,latitude:9.719629,longitude:125.9737},{active:!0,barangay:"Cudog",municipality:"Lagawe",province:"Ifugao",psgc:142704010,purok:null,region:"CAR",season:2,site_code:"cud",site_id:10,sitio:"Natuwolan at Wadwad",latitude:16.80931,longitude:121.1047},{active:!0,barangay:"Dadong",municipality:"Tarragona",province:"Davao Oriental",psgc:112511003,purok:null,region:"XI",season:1,site_code:"dad",site_id:11,sitio:"Sagasa",latitude:7.13731,longitude:126.4509},{active:!0,barangay:"Gaas",municipality:"Balamban",province:"Cebu",psgc:72208014,purok:null,region:"VII",season:1,site_code:"gaa",site_id:12,sitio:null,latitude:10.42352,longitude:123.7851},{active:!0,barangay:"Gamut",municipality:"Tago",province:"Surigao del Sur",psgc:166818012,purok:null,region:"XIII",season:1,site_code:"gam",site_id:13,sitio:null,latitude:9.0101,longitude:126.1676},{active:!0,barangay:"1 & 2",municipality:"Hinabangan",province:"Samar",psgc:86008012,purok:null,region:"VIII",season:1,site_code:"hin",site_id:14,sitio:null,latitude:11.70064,longitude:125.0691},{active:!0,barangay:"Humayhumay",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611013,purok:null,region:"VII",season:1,site_code:"hum",site_id:15,sitio:null,latitude:10.18392,longitude:123.2503},{active:!0,barangay:"Imelda",municipality:"Tarangnan",province:"Samar",psgc:86020024,purok:null,region:"VIII",season:1,site_code:"ime",site_id:16,sitio:null,latitude:11.90383,longitude:124.7526},{active:!0,barangay:"Immuli",municipality:"Pidigan",province:"Abra",psgc:140118005,purok:null,region:"CAR",season:2,site_code:"imu",site_id:17,sitio:null,latitude:17.52308,longitude:120.6046},{active:!0,barangay:"Inabasan",municipality:"Maasin",province:"Iloilo",psgc:63029025,purok:null,region:"VI",season:2,site_code:"ina",site_id:18,sitio:"Sambag",latitude:10.86991,longitude:122.4362},{active:!0,barangay:"Poblacion 1",municipality:"San Jorge",province:"Samar",psgc:86025024,purok:null,region:"VIII",season:1,site_code:"jor",site_id:19,sitio:null,latitude:11.97779,longitude:124.8249},{active:!0,barangay:"Ambuklao",municipality:"Bokod",province:"Benguet",psgc:141104001,purok:null,region:"CAR",season:2,site_code:"lab",site_id:20,sitio:"Labey",latitude:16.47032,longitude:120.7054},{active:!0,barangay:"Laygayon",municipality:"Pinabacdao",province:"Samar",psgc:86013013,purok:null,region:"VIII",season:1,site_code:"lay",site_id:21,sitio:null,latitude:11.5127,longitude:125.0257},{active:!0,barangay:"Lipanto",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412016,purok:"1",region:"VIII",season:1,site_code:"lip",site_id:22,sitio:null,latitude:10.22767,longitude:125.1266},{active:!0,barangay:"Looc",municipality:"Villanueva",province:"Misamis Oriental",psgc:104326011,purok:null,region:"X",season:1,site_code:"loo",site_id:23,sitio:null,latitude:8.597964,longitude:124.7775},{active:!0,barangay:"Lipata",municipality:"Paranas",province:"Samar",psgc:86022016,purok:null,region:"VIII",season:1,site_code:"lpa",site_id:24,sitio:null,latitude:11.78625,longitude:125.0196},{active:!0,barangay:"Literon",municipality:"Calbiga",province:"Samar",psgc:86004017,purok:null,region:"VIII",season:1,site_code:"lte",site_id:25,sitio:null,latitude:11.59037,longitude:125.0903},{active:!0,barangay:"Lunas",municipality:"Maasin City",province:"Southern Leyte",psgc:86407034,purok:null,region:"VIII",season:1,site_code:"lun",site_id:26,sitio:"Caianuhan",latitude:10.25819,longitude:124.877},{active:!0,barangay:"Magsaysay",municipality:"Kibawe",province:"Bukidnon",psgc:101308016,purok:"1, 2 & 3",region:"X",season:1,site_code:"mag",site_id:27,sitio:null,latitude:7.51923,longitude:125.0598},{active:!0,barangay:"Ambassador",municipality:"Tublay",province:"Benguet",psgc:141114001,purok:null,region:"CAR",season:2,site_code:"mam",site_id:28,sitio:"Mamuyod",latitude:16.4883,longitude:120.689},{active:!0,barangay:"Marirong",municipality:"Leon",province:"Iloilo",psgc:63028059,purok:null,region:"VI",season:2,site_code:"mar",site_id:29,sitio:null,latitude:10.827459,longitude:122.321555},{active:!0,barangay:"Mac-Arthur",municipality:"Esperanza",province:"Agusan del Sur",psgc:160303010,purok:null,region:"XIII",season:1,site_code:"mca",site_id:30,sitio:null,latitude:8.58543,longitude:125.741},{active:!0,barangay:"Manghulyawon",municipality:"La Libertad",province:"Negros Oriental",psgc:184613013,purok:null,region:"VII",season:1,site_code:"mng",site_id:31,sitio:"Dao",latitude:10.04793,longitude:123.2062},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msl",site_id:32,sitio:"Lower Mesolong",latitude:7.629616,longitude:125.5445},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msu",site_id:33,sitio:"Upper Mesolong",latitude:7.628743,longitude:125.5403},{active:!0,barangay:"Nagyubuyuban",municipality:"San Fernando City",province:"La Union",psgc:13314034,purok:"5",region:"I",season:2,site_code:"nag",site_id:34,sitio:null,latitude:16.62678,longitude:120.4176},{active:!0,barangay:"Nurcia",municipality:"Lanuza",province:"Surigao del Sur",psgc:166810011,purok:null,region:"XIII",season:1,site_code:"nur",site_id:35,sitio:null,latitude:9.269702,longitude:126.1384},{active:!0,barangay:"Oslao",municipality:"San Francisco",province:"Surigao del Norte",psgc:166719010,purok:null,region:"XIII",season:1,site_code:"osl",site_id:36,sitio:null,latitude:9.75719,longitude:125.4014},{active:!0,barangay:"Parasanon",municipality:"Pinabacdao",province:"Samar",psgc:86013022,purok:null,region:"VIII",season:1,site_code:"par",site_id:37,sitio:null,latitude:11.51487,longitude:125.0255},{active:!0,barangay:"Pepe",municipality:"Leon",province:"Iloilo",psgc:63028070,purok:null,region:"VI",season:2,site_code:"pep",site_id:38,sitio:"Bangi",latitude:10.78788,longitude:122.3336},{active:!0,barangay:"Pinagkamaligan",municipality:"Calauag",province:"Quezon",psgc:45607060,purok:null,region:"IVB",season:1,site_code:"pin",site_id:39,sitio:null,latitude:13.9536,longitude:122.2855},{active:!0,barangay:"Planas",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611027,purok:null,region:"VII",season:1,site_code:"pla",site_id:40,sitio:"Mambog",latitude:10.15984,longitude:123.2459},{active:!0,barangay:"Pange",municipality:"Matnog",province:"Sorsogon",psgc:56212032,purok:null,region:"V",season:1,site_code:"png",site_id:41,sitio:null,latitude:12.63063,longitude:124.0183},{active:!0,barangay:"Puguis",municipality:"La Trinidad",province:"Benguet",psgc:141110013,purok:null,region:"CAR",season:2,site_code:"pug",site_id:42,sitio:"Longlong",latitude:16.44655,longitude:120.5706},{active:!0,barangay:"Antadao",municipality:"Sagada",province:"Mt. Province",psgc:144409005,purok:null,region:"CAR",season:2,site_code:"sag",site_id:43,sitio:null,latitude:17.08263,longitude:120.9248},{active:!0,barangay:"Sibajay",municipality:"Boston",province:"Davao Oriental",psgc:112503006,purok:null,region:"XI",season:1,site_code:"sib",site_id:44,sitio:null,latitude:7.82567,longitude:126.3834},{active:!0,barangay:"Amgaleyguey",municipality:"Buguias",province:"Benguet",psgc:141105002,purok:null,region:"CAR",season:2,site_code:"sin",site_id:45,sitio:"Sinipsip",latitude:16.7234,longitude:120.7815},{active:!0,barangay:"Sumalsag",municipality:"Malitbog",province:"Bukidnon",psgc:101313011,purok:null,region:"X",season:1,site_code:"sum",site_id:46,sitio:null,latitude:8.54511,longitude:124.8597},{active:!0,barangay:"Talahid",municipality:"Almeria",province:"Biliran",psgc:87801012,purok:null,region:"VIII",season:1,site_code:"tal",site_id:47,sitio:null,latitude:11.63742,longitude:124.3665},{active:!0,barangay:"Taga",municipality:"Pinukpuk",province:"Kalinga",psgc:143209022,purok:null,region:"CAR",season:2,site_code:"tga",site_id:48,sitio:null,latitude:17.57347,longitude:121.3834},{active:!0,barangay:"Tue",municipality:"Tadian",province:"Mt. Province",psgc:144410019,purok:null,region:"CAR",season:2,site_code:"tue",site_id:49,sitio:null,latitude:16.97229,longitude:120.8286},{active:!0,barangay:"Umingan",municipality:"Alimodian",province:"Iloilo",psgc:63002053,purok:null,region:"VI",season:2,site_code:"umi",site_id:50,sitio:null,latitude:10.90807,longitude:122.3278}],Bn=Xt(Yn),Pn=Object(O.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},justify:{display:"flex",justifyContent:"space-evenly"}}}));var Ln=function(e){var t=e.issueReminderData,a=e.setIssueReminderData,l=e.fullScreen,i=e.toResolve,c=Pn(),s=t.iar_id,m=t.detail,u=t.ts_expiration,p=t.resolution,b=t.is_event_entry,g=t.site_id_list,E=Object(n.useState)("general"),v=Object(o.a)(E,2),h=v[0],y=v[1],O=Object(n.useState)(h),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)(x),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(!1),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(!1),H=Object(o.a)(T,2),R=H[0],Y=H[1];Object(n.useEffect)((function(){if(N(b),""!==s&&"undefined"!==typeof s){var e=g.map((function(e){return Bn.filter((function(t){return t.value===e})).pop()}));a(Object(d.a)(Object(d.a)({},t),{},{site_id_list:e}))}null!==g&&"undefined"!==typeof g&&g.length>0&&(y("site"),S("site"),A("site")),null===u&&Y(!0)}),[]);var B,P=function(e){return function(n){var r=n.target.value;a(Object(d.a)(Object(d.a)({},t),{},{[e]:r}))}},L=function(e){var n=e.target,r=n.value,l=n.checked;switch(r){case"is_event_entry":N(l),l||Y(!1),a(Object(d.a)(Object(d.a)({},t),{},{is_event_entry:l}));break;case"is_persistent":Y(l),a(Object(d.a)(Object(d.a)({},t),{},{is_persistent:l}))}};return r.a.createElement(Ct.a,{utils:At.a},i?r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Resolution",value:p||"",onChange:P("resolution"),placeholder:"Enter resolution",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))):r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ye.a,{"aria-label":"position",name:"position",value:x,onChange:function(e){var t=e.target.value;S(t),A(t)},row:!0,className:l?"":c.justify},r.a.createElement(Be.a,{value:"general",control:r.a.createElement(Pe.a,{color:"primary"}),label:"General issue/reminder",labelPlacement:"end"}),r.a.createElement(Be.a,{value:"site",control:r.a.createElement(Pe.a,{color:"primary"}),label:"Site-specific issue/reminder",labelPlacement:"end"}))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{style:{marginBottom:8}})),"site"===w&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement($t,{value:g,changeHandler:function(e){return a(Object(d.a)(Object(d.a)({},t),{},{site_id_list:e}))},isMulti:!0,includeAddressOnOptions:!1})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Be.a,{key:"is_event_entry",control:r.a.createElement(kt.a,{checked:M,onChange:L,value:"is_event_entry",className:c.checkboxes}),label:r.a.createElement("div",null,"Related to current monitoring event ",r.a.createElement(xe.a,{title:"Checking this will make the issue/reminder expire at the end of site(s) current monitoring event validity"},r.a.createElement("strong",null,"[?]"))),className:"primary"}))),(w||!M)&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,md:6,container:!0,justify:"center"},r.a.createElement(Be.a,{key:"is_persistent",control:r.a.createElement(kt.a,{checked:R,onChange:L,value:"is_persistent",className:c.checkboxes}),label:"Persistent reminder",className:"primary"})),R?r.a.createElement(_.a,{item:!0,md:6}):r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(wt.b,{autoOk:!0,label:"Issue/Reminder Expiration",value:u,onChange:(B="ts_expiration",function(e){a(Object(d.a)(Object(d.a)({},t),{},{[B]:e}))}),ampm:!1,format:"YYYY-MM-DD HH:mm:ss",mask:"____-__-__ __:__:__",clearable:!0}))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{style:{margin:"8px 0"}})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Details",value:m,onChange:P("detail"),placeholder:"Enter detail",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))))},Fn={detail:"",iar_id:"",site_id_list:null,user_id:"",postings:"",resolution:null,resolved_by:null,ts_resolved:null,ts_posted:X()().format("YYYY-MM-DD HH:mm:ss"),ts_expiration:null,is_event_entry:!1,is_persistent:!1};var zn=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setIsIandRUpdateNeeded,c=e.chosenIssueReminder,s=e.isIandRUpdateNeeded,m=e.toResolve,u=e.setToRefresh,b=e.toRefresh,f=Object(n.useState)({}),g=Object(o.a)(f,2),E=g[0],v=g[1];Object(n.useEffect)((function(){if(s){var e=c,t=c.postings.map((function(e){return e.site_id})),a=[];c.postings.forEach((function(e){var t=e.event;null!==t&&a.push(t)})),e.site_id_list=t,e.is_event_entry=a.length>0,v(e)}else v(Fn)}),[a,c]);var h=function(){i(!1),l(!1)};return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Issues and Reminder Form"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Provide information to the following fields."),r.a.createElement(Ln,{issueReminderData:E,setIssueReminderData:v,fullScreen:t,toResolve:m})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:h,color:"primary"},"Cancel"),r.a.createElement(p.a,{color:"secondary",onClick:function(){var e=E.resolution,t=X()().format("YYYY-MM-DD HH:mm:ss"),a=Object(d.a)(Object(d.a)({},E),{},{ts_posted:t});if(""!==e&&null!==e){var n=Object(x.a)().user_id;a=Object(d.a)(Object(d.a)({},E),{},{ts_resolved:t,resolved_by:n})}Rn(a,(function(e){e&&"undefined"!==typeof b&&u(!b)})),h()},disabled:!1},"Submit")))})),Un=Object(O.a)((function(e){return{inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},gridList:{height:"100vh",margin:"0 !important",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"},position:"sticky",top:148,padding:8},hasNoIssues:{display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"},icon:{color:"rgba(255, 255, 255, 0.54)"},previewText:{padding:"12px",fontSize:"14px"},tile:{border:"0.5px solid #b2b2b2",padding:"0 !important",marginBottom:6,"&:last-of-type":{marginBottom:0}},tileBar:{background:"#7f7f7f",height:"50px !important"}}}));function Wn(e){var t=e.isCardModalOpen,a=e.chosenIssueReminder,n=e.setCardModalOpen,l=e.setIsOpenIssueReminderModal,i=e.setToResolve,c=e.setIsIandRUpdateNeeded,o=a.site_list,s=a.ts_posted,m=a.detail,u=a.issue_reporter,d=u.first_name,b=u.last_name,f=Gn(o,!1),g=X()(s).format("DD MMMM YYYY, HH:mm");return r.a.createElement(Me.a,{open:t,maxWidth:"sm"},r.a.createElement(Ne.a,{style:{paddingBottom:8}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Tn.a,{style:{paddingRight:8}})," ",f)),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,g),r.a.createElement(He.a,{style:{textIndent:40},align:"justify"},m),r.a.createElement(He.a,{align:"right",style:{marginBottom:0}},"".concat(d," ").concat(b))),r.a.createElement(Le.a,{disableSpacing:!0},r.a.createElement(p.a,{onClick:function(){n(!1),i(!1),l(!0),c(!0)},color:"primary"},"Edit"),r.a.createElement(p.a,{onClick:function(){n(!1),i(!0),l(!0),c(!0)},color:"secondary"},"Resolve"),r.a.createElement(p.a,{onClick:function(){return n(!1)},color:"primary",autoFocus:!0},"Close")))}function Gn(e,t){var a=t?"GENERAL":"General";return 0!==e.length&&(a=e.join(", ")),a}var qn=function(e){var t=e.isOpenIssueReminderModal,a=e.setIsOpenIssueReminderModal,l=e.isIandRUpdateNeeded,i=e.setIsIandRUpdateNeeded,c=Un(),s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],p=m[1],b=Object(n.useState)(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],v=Object(n.useState)({site_list:[],site_id_list:null,ts_posted:null,detail:"",issue_reporter:{first_name:"",last_name:""}}),h=Object(o.a)(v,2),_=h[0],O=h[1],j=Object(n.useState)(!1),x=Object(o.a)(j,2),S=x[0],k=x[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],D=w[1];Object(n.useEffect)((function(){var e;e=function(e){E(!1);var t=r.a.createElement(y.a,{component:"div",style:{fontStyle:"italic",width:"auto",height:0}},"No active issues");if(0!==e.length){var a=function(e){return e.map((function(e,t){var a=[],n=[],r=[],l=null===e.ts_expiration;e.postings.forEach((function(e){var t=e.event_id,l=e.site_id,i=e.site;null!==l&&(a.push(l),n.push(i.site_code.toUpperCase()),r.push(t))}));var i=0!==r.length;return Object(d.a)(Object(d.a)({},e),{},{site_id_list:a,site_list:n,site_events_list:r,is_event_entry:i,is_persistent:l})}))}(e);t=function(e,t,a){return t.map((function(t,n){var l=t.site_list,i=t.detail,c=t.issue_reporter,o=Gn(l);return r.a.createElement(Dn.a,{key:"test ".concat(n+1),cols:2,className:e.tile},r.a.createElement(y.a,{className:e.previewText},i),r.a.createElement(In.a,{className:e.tileBar,title:o,subtitle:"".concat(c.first_name," ").concat(c.last_name),actionIcon:r.a.createElement(xe.a,{title:"Expand card"},r.a.createElement(H.a,{"aria-label":"Expand",className:e.icon,onClick:a(t)},r.a.createElement(Tn.a,null)))}))}))}(c,a,I),E(!0)}p(t)},Ge(),_e.on("receive_issues_and_reminders",(function(t){var a=JSON.parse(t);e(a)}))}),[c]);var I=function(e){return function(t){O(e),k(!0)}};return r.a.createElement(n.Fragment,null,r.a.createElement(Mn.a,{component:"div",cellHeight:"auto",className:"".concat(c.gridList," ").concat(!g&&c.hasNoIssues)},u),r.a.createElement(Wn,{isCardModalOpen:S,setCardModalOpen:k,chosenIssueReminder:_,setToResolve:D,setIsOpenIssueReminderModal:a,setIsIandRUpdateNeeded:i}),r.a.createElement(zn,{isOpen:t,isIandRUpdateNeeded:l,chosenIssueReminder:_,setIsIandRUpdateNeeded:i,toResolve:A,closeHandler:function(){a(!1)}}))},Vn=a(118),Qn=a.n(Vn),Zn=a(506),Kn=a.n(Zn),Jn=Object(O.a)((function(e){return{summary:{minHeight:24},summaryContent:{marginBottom:6,marginTop:6},icon:{paddingTop:6,paddingBottom:6},details:{paddingTop:16}}}));var Xn=function(e){var t=e.shiftData,a=Jn(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],m=i[1];return Object(n.useEffect)((function(){if(null!==t||"undefined"!==t){var e=t.filter((function(e){return X()(e.ts)>X()().subtract({hours:12})?e:null})).slice(0,3);m(e)}}),[t]),r.a.createElement(le.a,{defaultExpanded:!1},r.a.createElement(ie.a,{expandIcon:r.a.createElement(Qn.a,null),"aria-controls":"panel1c-content",id:"panel1c-header",className:a.summary,IconButtonProps:{className:a.icon},classes:{content:a.summaryContent}},r.a.createElement(_.a,{container:!0,justify:"space-between",alignItems:"baseline"},r.a.createElement(_.a,{item:!0,xs:!0},r.a.createElement(y.a,{variant:"caption"},r.a.createElement("strong",null,"MONITORING SHIFT"))),c.length>0&&r.a.createElement(_.a,{item:!0,xs:!0,container:!0,justify:"space-evenly"},r.a.createElement(y.a,{variant:"overline"},"MT - ",c[0].iompmt),r.a.createElement(y.a,{variant:"overline"},"CT - ",c[0].iompct)))),r.a.createElement(ce.a,null),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,justify:"space-evenly",className:a.details},c.length>0&&c.map((function(e){return r.a.createElement(_.a,{item:!0,xs:6,sm:4,key:e.ts},r.a.createElement(y.a,{variant:"subtitle2",align:"center"},r.a.createElement("strong",null,function(e){var t=X()(),a=X()(e),n=X()(e).add(12,"hours");return t>a&&a<=n?"Current":t.add(12,"hours")>a?"Next":t.add(24,"hours")>a?a.format("MMMM D, A (ddd)"):null}(e.ts))),r.a.createElement(y.a,{variant:"body2",align:"center"},e.iompmt," (MT)"),r.a.createElement(y.a,{variant:"body2",align:"center",gutterBottom:!0},e.iompct," (CT)"))})))),r.a.createElement(ce.a,null),r.a.createElement(je.a,null,r.a.createElement(s.b,{to:"monitoring/shifts_and_reports/shifts",style:{textDecoration:"none"}},r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Kn.a,null)},"Go to Calendar"))))},$n=a(94),er=a(824);function tr(e){var t=e.momsEntry,a=e.updateField,n=e.isAddingNewInstance,l=e.setIsNoneEntrySelected,i=e.location,c=e.site_code,o=t.moms,s=t.options,m=o.feature_type,u=null!==m&&"None"===m.label;return l(u),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Zt,{label:"Feature Type",options:s.feature_type,value:o.feature_type,changeHandler:a("feature_type"),placeholder:"Select feature type",renderDropdownIndicator:!0,openMenuOnClick:!0})),!u&&r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(xe.a,{title:"Feature names are auto-generated. To add new MOMs feature name, choose (Add new instance)",placement:"top",interactive:!0},r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Zt,{label:"Feature Name",options:s.feature_name.options,isDisabled:s.feature_name.disabled,value:o.feature_name,changeHandler:a("feature_name"),placeholder:s.feature_name.disabled?"Disabled":"Select feature name",renderDropdownIndicator:!0,openMenuOnClick:!0}))),n&&r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Location",multiline:!0,rowsMax:"2",placeholder:"Enter location of new instance",value:i,onChange:a("location"),fullWidth:!0,InputLabelProps:{shrink:!0}}))),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Zt,{label:"Alert Level",options:s.alert_level.options,isDisabled:s.alert_level.disabled,value:o.alert_level,changeHandler:a("alert_level"),placeholder:s.alert_level.disabled?"Disabled":"Select alert level",renderDropdownIndicator:!0,openMenuOnClick:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Observance Timestamp",value:o.observance_ts,onChange:a("observance_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Narrative",multiline:!0,rowsMax:"2",placeholder:"Enter report narrative",value:o.narrative,onChange:a("narrative"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Ca,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:a("reporter"),value:o.reporter,isCommunityStaff:"true",site_code:c})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Remarks",multiline:!0,rowsMax:"2",placeholder:"Enter expert's remarks",value:o.remarks,onChange:a("remarks"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Ca,{variant:"standard",label:"Validator",div_id:"validator",changeHandler:a("validator"),value:o.validator})))}var ar=function(e){var t=e.momsEntries,a=e.setMomsEntries,l=e.selectSite,i=e.site,c=e.setSite,s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],b=Object(n.useState)(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],v=function(e){return function(t){return function(n){var r="";if("feature_name"===t&&("(Add new instance)"===n.label?d(!0):d(!1)),["feature_type","feature_name","alert_level","observance_ts"].includes(t))r=n;else if(["narrative","remarks","reporter","validator","location"].includes(t)){r=n.target.value}a({action:"UPDATE_DETAILS",key:e,attribute:t,value:r})}}},h=function(e){return function(){return a({action:"DELETE_INSTANCE",key:e})}};return r.a.createElement(n.Fragment,null,l&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement($t,{value:i,changeHandler:function(e){return c(e)}})),null!==i&&r.a.createElement(n.Fragment,null,r.a.createElement(Ct.a,{utils:At.a},t.map((function(e,a){var l=0===a,c=t.length===a+1;return r.a.createElement(n.Fragment,{key:"moms_".concat(a)},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:l?12:0}},r.a.createElement(y.a,{variant:"subtitle2"},"Entry Number ",a+1),!l&&r.a.createElement(H.a,{"aria-label":"delete",color:"primary",onClick:h(a)},r.a.createElement(er.a,null))),r.a.createElement(tr,{momsEntry:e,updateField:v(a),isAddingNewInstance:u,setIsNoneEntrySelected:E,site_code:i.data.site_code}),!c&&r.a.createElement(ce.a,{style:{margin:"24px 0 12px"},variant:"middle"}))}))),!g&&r.a.createElement("div",{style:{margin:"16px 0",textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:function(){return a({action:"ADD_INSTANCE"})}},"Add MOMs Observation"))))},nr={moms:{feature_type:null,feature_name:null,alert_level:null,observance_ts:null,narrative:"",reporter:"",remarks:"",validator:"",location:""},options:{feature_type:[],feature_name:{options:[],disabled:!0},alert_level:{options:[],disabled:!0}}};function rr(e,t){var a=t.action,n=t.key,r=t.attribute,l=t.value,i=JSON.parse(JSON.stringify(e));switch(a){case"OVERWRITE":return Object(Xe.a)(l);case"ADD_INSTANCE":return[].concat(Object(Xe.a)(e),[JSON.parse(JSON.stringify(nr))]);case"DELETE_INSTANCE":return i.splice(n,1),Object(Xe.a)(i);case"UPDATE_DETAILS":if(i[n].moms[r]=l,"feature_type"===r){var c=l.instances,o=l.alerts,s=c.map((function(e){return{value:e.instance_id,label:ot(e.feature_name)}}));s.push({value:0,label:"(Add new instance)"});var m=o.map((function(e){var t=e.feature_alert_id,a=e.alert_level,n=e.description;return{value:l,feature_alert_id:t,label:a,description:n}})),u=i[n],p=u.moms,b=u.options;i[n].options=Object(d.a)(Object(d.a)({},b),{},{feature_name:{options:s,disabled:!1},alert_level:{options:m,disabled:!1}}),i[n].moms=Object(d.a)(Object(d.a)({},p),{},{feature_name:null,alert_level:null})}return Object(Xe.a)(i);default:return e}}var lr=Object(O.a)((function(e){return{form_message_style:{color:"red",fontStyle:"italic"}}}));var ir=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.match,s=lr(),m=Object(n.useContext)(Kt).sites,u=Object(n.useState)(null),b=Object(o.a)(u,2),f=b[0],g=b[1],E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],O=v[1],j=Object(n.useState)(!0),S=Object(o.a)(j,2),k=S[0],C=S[1],w=Object(n.useReducer)(rr,[]),A=Object(o.a)(w,2),D=A[0],I=A[1],M=Object(n.useState)(!1),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)(""),Y=Object(o.a)(R,2),B=Y[0],P=Y[1];Object(n.useEffect)((function(){if("undefined"!==typeof i){var e=i.params.site_code;C(!1),O(e)}}),[i]),Object(n.useEffect)((function(){var e=m.find((function(e){return e.site_code===h}));e&&g({value:e.site_id,data:e})}),[m,h]);var L=Object(c.b)(),F=L.enqueueSnackbar,z=L.closeSnackbar,U=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){z(e)}},"Dismiss")},W=Object(n.useState)([]),G=Object(o.a)(W,2),q=G[0],V=G[1];return Object(n.useEffect)((function(){null!==f&&function(e,t){var a="".concat(We.b,"/api/manifestations_of_movement/get_moms_features/").concat(e);it.a.get(a).then((function(e){var a=e.data;console.log("MOMs Features",a),t(a)})).catch((function(e){console.error(e)}))}(f.data.site_code,(function(e){var t=e.map((function(e){var t=e.feature_id,a=e.feature_type,n=e.instances,r=e.alerts;return{value:t,label:ot(a),instances:n,alerts:r}}));V(Object(d.a)(Object(d.a)({},q),{},{feature_type:t}));var a=nr;a.options.feature_type=t,I({action:"OVERWRITE",value:[a]})}))}),[f]),Object(n.useEffect)((function(){var e=function(e){var t,a=!1,n=!1,r=new Set,l=[],i=[],c="";return e.forEach((function(e,t){var c=e.moms,o=c.alert_level,s=c.feature_type,m=c.narrative,u=c.observance_ts,d=c.remarks,p=c.reporter,b=c.validator,f=c.feature_name,g=c.location,E=X()(u).format("YYYY-MM-DD HH:mm:00");null!==s&&(9===s.value&&(f="value"));if(null!==f){var v=f.value;l.includes(v)?!1===a&&(a=!0):l.push(v),0===v?void 0===g&&(g=""):g="value"}!0!==a&&"Invalid date"===E||(i.includes(E)?!1===n&&(n=!0):i.push(E)),null===s&&r.add("feature type"),null===f&&r.add("feature name"),""===g&&r.add("location"),null===o&&r.add("alert level"),null===u&&r.add("observance timestamp"),""===m&&r.add("narrative"),""===p&&r.add("reporter"),""===d&&r.add("remarks"),""===b&&r.add("validator")})),r=Object(Xe.a)(r),!1===a&&(n=!1),0!==r.length||!0===n?(t=!0,c="Please input ".concat(r.join(", ")," form(s). "),n&&(c+="Duplicate observance time for the same feature instance.")):t=!1,{button_state:t,form_messsage:c}}(D),t=e.button_state,a=e.form_messsage;H(t),P(a)}),[D]),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Insert Manifestation of Movement Form"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Provide manifestation of movement (MOMs) details to save information in our database."),r.a.createElement(ar,{momsEntries:D,setMomsEntries:I,site:f,setSite:g,selectSite:k})),r.a.createElement(Le.a,null,r.a.createElement(_.a,{container:!0,spacing:2,justify:"center",alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:12,sm:8,align:"center"},r.a.createElement(y.a,{variant:"caption",className:s.form_message_style,gutterBottom:!0},B)),r.a.createElement(_.a,{item:!0,xs:12,sm:4,align:"right"},r.a.createElement(p.a,{onClick:l,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:function(){console.log("moms_entries",D);var e=D.map((function(e,t){var a=e.moms,n=a.alert_level,r=a.feature_name,l=a.feature_type,i=a.narrative,c=a.observance_ts,o=a.remarks,s=a.reporter,m=a.validator,u=a.location,d=X()(c).format("YYYY-MM-DD HH:mm:ss"),p=Object(x.a)(),b=l.label,f="None",g=null;if("None"!==b){var E=r.value,v=r.label;f="(Add new instance)"===v?null:v,g=E}return{alert_level:n.label,instance_id:g,feature_name:f,feature_type:b,report_narrative:i,observance_ts:d,remarks:o,reporter_id:s,validator_id:m,location:u,iomp:p.user_id}})),t=f.data.site_code,a={moms_list:e,site_code:t};console.log("PAYLOAD",a),l(),function(e,t,a){var n="".concat(We.b,"/api/manifestations_of_movement/write_monitoring_moms_to_db");console.log("moms_list",e),it.a.post(n,e).then((function(e){var a=e.data;null!==t&&(console.log("Moms Insert result",a),t(a))})).catch((function(e){console.log(e),null!==a&&a(e)}))}(a,(function(e){var a="MOMs input success!",n="success";e.status?Ve("run_alert_generation",{site_code:t}):(a=e.message,n="error");F(a,{variant:n,autoHideDuration:7e3,action:U})}),(function(){F("Error MOMS input...",{variant:"error",autoHideDuration:7e3,action:U})}))},color:"primary",disabled:T},"Submit")))))}));function cr(e){var t=e.clickHandler;return r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:t,startIcon:r.a.createElement(me.a,null)},"Insert MOMs")}var or=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{tabBar:Object(d.a)({},t.pageContentMargin),tabBarContent:{marginTop:30},speedDial:{position:"fixed","&.MuiSpeedDial-directionUp":{bottom:e.spacing(2),right:e.spacing(2)}}})})),sr=[{label:"Monitoring Tables",href:"monitoring-tables"},{label:"Generated Alerts",href:"generated-alerts"}];var mr=Object(K.a)()((function(e){var t=e.width,a=e.history,l=or(),i=Object(n.useState)(0),s=Object(o.a)(i,2),m=s[0],u=s[1],d=Object(n.useState)(null),b=Object(o.a)(d,2),f=b[0],g=b[1],E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],O=v[1],j=Object(n.useState)(null),x=Object(o.a)(j,2),S=x[0],k=x[1],C=Object(n.useState)(null),w=Object(o.a)(C,2),A=w[0],D=w[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)(!1),R=Object(o.a)(H,2),Y=R[0],B=R[1],P=Object(n.useState)(null),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)(!1),W=Object(o.a)(U,2),G=W[0],q=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],J=Q[1],X=Object(n.useState)(!1),$=Object(o.a)(X,2),ee=$[0],te=$[1],ae=function(e){return function(){return te(e)}},ne=Object(n.useContext)(Kt).setIsReconnecting,Ee=Object(c.b)(),ve=Ee.enqueueSnackbar,he=Ee.closeSnackbar;Object(n.useEffect)((function(){var e;return qe(ne),e=function(e){return g(e)},Ge(),_e.on("receive_generated_alerts",(function(t){var a=JSON.parse(t);console.log("Generated alerts: ",a),e(a)})),function(e){Ge(),_e.on("receive_candidate_alerts",(function(t){var a=JSON.parse(t);console.log("Candidate alerts: ",a),e(a)}))}((function(e){return k(e)})),Ze((function(e){return D(e)})),Object($n.c)((function(e){return O(e)})),Object($n.a)(),function(e){Ge(),_e.on("receive_ewi_insert_response",(function(t){var a=JSON.parse(t);e(a)}))}((function(e){var t=e.snackbar_key,a=e.message,n=e.status;he(t),ve(a,{variant:n?"success":"error",autoHideDuration:7e3})})),function(){Qe(),Object($n.e)()}}),[]);var Oe,je=function(e,t){return function(){"is_open_release_modal"===e?T(t):"is_open_issues_modal"===e?(J(!t),q(t)):"is_routine_modal_open"===e&&B(t)}},xe=function(e,t){return function(){z(e),"routine"===t?je("is_routine_modal_open",!0)():je("is_open_release_modal",!0)()}},Se=Object(K.c)("md",t),ke=Object(n.useState)(!1),Ce=Object(o.a)(ke,2),we=Ce[0],Ae=Ce[1],De=[{icon:r.a.createElement(se.a,null),name:"Release alert",action:xe(null)},{icon:r.a.createElement(me.a,null),name:"Insert MOMs",action:ae(!0)},{icon:r.a.createElement(ue.a,null),name:"Add issue/reminder",action:je("is_open_issues_modal",!0)}],Ie=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Add issue/reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:je("is_open_issues_modal",!0),startIcon:r.a.createElement(ue.a,null)},"Add issue/reminder"),r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(cr,{clickHandler:ae(!0)})),r.a.createElement(p.a,{"aria-label":"Release alert",variant:"contained",color:"primary",size:"small",onClick:xe(null),startIcon:r.a.createElement(se.a,null)},"Release Alert"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:l.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Dashboard",customButtons:!!Se&&Ie})),r.a.createElement("div",{className:l.tabBar},r.a.createElement(_.a,{container:!0,spacing:3},r.a.createElement(_.a,{item:!0,xs:12,md:3},r.a.createElement(re.a,{smDown:!0},r.a.createElement(qn,{isOpenIssueReminderModal:G,setIsOpenIssueReminderModal:q,isIandRUpdateNeeded:Z,setIsIandRUpdateNeeded:J})),r.a.createElement(re.a,{mdUp:!0},r.a.createElement(le.a,{defaultExpanded:!1},r.a.createElement(ie.a,{expandIcon:r.a.createElement(de.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},r.a.createElement(_.a,{container:!0,justify:"space-between",alignItems:"baseline"},r.a.createElement(y.a,{variant:"caption"},r.a.createElement("strong",null,"ISSUES AND REMINDERS")))),r.a.createElement(ce.a,null),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,justify:"space-evenly",className:l.details},r.a.createElement(qn,{isOpenIssueReminderModal:G,setIsOpenIssueReminderModal:q,isIandRUpdateNeeded:Z,setIsIandRUpdateNeeded:J})))))),r.a.createElement(_.a,{item:!0,xs:12,md:9},r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(Xn,{shiftData:h})),r.a.createElement(ye,{chosenTab:m,onSelect:function(e){u(e)},tabsArray:sr}),r.a.createElement("div",{className:l.tabBarContent},0===m&&r.a.createElement(Ra,{width:t,candidateAlertsData:S,alertsFromDbData:A,releaseFormOpenHandler:xe,history:a}),1===m&&r.a.createElement(za,{generatedAlertsData:f}))))),!Se&&r.a.createElement(pe.a,{ariaLabel:"SpeedDial example",className:l.speedDial,FabProps:{color:"secondary"},icon:r.a.createElement(be.a,null),onClose:function(){return Ae(!1)},onOpen:function(){return Ae(!0)},open:we},De.map((function(e){return r.a.createElement(fe.a,{key:e.name,icon:e.icon,tooltipTitle:e.name,onClick:e.action})}))),r.a.createElement(vn,{isOpen:N,closeHandler:je("is_open_release_modal",!1),setChosenCandidateAlert:z,chosenCandidateAlert:F,alertsFromDbData:A,setIsOpenRoutineModal:(Oe=null,function(){z(Oe),je("is_open_release_modal",!1)(),je("is_routine_modal_open",!0)()})}),r.a.createElement(An,{isOpen:Y,closeHandler:je("is_routine_modal_open",!1),chosenCandidateAlert:F,setChosenCandidateAlert:z}),r.a.createElement(ir,{isOpen:ee,closeHandler:ae(!1)}))})),ur=a(54),dr=a.n(ur),pr=a(177),br=a(792),fr=a(233),gr=a(834),Er=a(838),vr=Object(O.a)((function(e){return{timeline:{margin:"0 auto",lineColor:"#DDDDDD",paddingTop:24}}}));function hr(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.moms_details,l=n.moms_instance,i=l.feature.feature_type,c=l.feature_name,o=n.op_trigger,s=n.validator,m=s.first_name,u=s.last_name,d=n.reporter,p=d.first_name,b=d.last_name,f=n.narrative.narrative,g=n.remarks,E=n.moms_id,v=a?"Non-triggering ":"",h=r.a.createElement("ul",{key:E},r.a.createElement("li",null,v,"Feature: ",ot(i)," ",c," (",t+o,")"),r.a.createElement("ul",null,r.a.createElement("li",null,"Narrative: ",f),r.a.createElement("li",null,"Reporter: ","".concat(p," ").concat(b)),r.a.createElement("li",null,"Remarks: ",g),r.a.createElement("li",null,"Validator: ","".concat(m," ").concat(u))));return h}function _r(e,t,a,l){var i=[],c=0;return e.forEach((function(e){c+=1;var o=e.item_timestamp,s=e.item_data,m=e.item_type,u=null,d=X()(o).format("DD MMMM YYYY, hh:mm A");if("narrative"===m)u=r.a.createElement(fr.TimelineItem,{key:c,dateText:d,style:{color:"#969696"},dateComponent:r.a.createElement("div",{style:{display:"block",float:"right",padding:"10px",marginRight:38,background:"rgb(150, 150, 150)",color:"#fff"}},d)},r.a.createElement(y.a,{variant:"body2",component:"div"},s.narrative));else if("release"===m){var b=s.release_time,f=s.data_ts,g=s.release_publishers,E=s.triggers,v=s.is_onset,h=s.internal_alert_level,O=s.moms_releases,j=s.release_id,x=s.comments,S=e.release_type,k=function(e){var t="#F8991D";return"end_of_validity"===e?t="#00B200":"overdue"===e?t="#FA4413":"extended"===e?t="#00B200":"routine"===e&&(t="#59081E"),t}(S),C=function(e){var t="EARLY WARNING INFORMATION";return"end_of_validity"===e?t="END OF MONITORING":"overdue"===e?t="OVERDUE":"extended"===e?t="EXTENDED MONITORING":"routine"===e&&(t="ROUTINE MONITORING"),t}(S),w=X()(f);v||(w=w.add(30,"minutes")),w=w.format("MMMM Do YYYY, h:mm A");var A="",D="";g.forEach((function(e){var t=e.role,a=e.user_details,n=a.first_name,r=a.last_name;"mt"===t&&(A="".concat(n," ").concat(r)),"ct"===t&&(D="".concat(n," ").concat(r))})),u=r.a.createElement(fr.TimelineItem,{key:c,dateText:d,style:{color:k},dateInnerStyle:{background:k,lineHeight:"48px",textAlign:"center"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(gr.a,{style:{color:k,height:45,width:"auto",paddingRight:8}},r.a.createElement(De.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(y.a,{variant:"caption",component:"div",style:{color:k}},r.a.createElement("strong",null,C)),r.a.createElement(y.a,{variant:"h6",component:"div",style:{color:k,lineHeight:1.2}},r.a.createElement("strong",null,w)))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(y.a,{variant:"body2",style:{color:k}},"Release Time: ",r.a.createElement("strong",null,b)),r.a.createElement(y.a,{variant:"body2",style:{color:k}},"Internal Alert Level: ",r.a.createElement("strong",null,h))),E.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",component:"div",style:{color:k}},r.a.createElement("strong",null,function(e){return r.a.createElement("ul",null,e.map((function(e){var t=e.ts,a=e.info,l=e.internal_sym,i=l.trigger_symbol,c=i.alert_symbol,o=i.trigger_hierarchy.trigger_source,s=l.alert_symbol,m=e.trigger_id,u="moms"===o?"Manifestation of Movement":ot(o),d=r.a.createElement("li",null,"".concat(u," (").concat(c,") alert triggered on ").concat(X()(t).format("MMMM Do YYYY, hh:mm A"))),p=r.a.createElement("ul",null,r.a.createElement("li",null,a)),b=[];if("moms"===o)e.trigger_misc.moms_releases.forEach((function(e){var t=hr(e,s);b.push(t)}));else if("on demand"===o){var f=e.trigger_misc.on_demand.narrative.narrative;b.push(r.a.createElement("ul",{key:"od"},r.a.createElement("li",null,"Reason:"),r.a.createElement("ul",null,r.a.createElement("li",null,f))))}return r.a.createElement(n.Fragment,{key:m},d,p,b.map((function(e){return e})))})))}(E))))),O.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",component:"div",style:{color:k}},r.a.createElement("strong",null,O.map((function(e){return hr(e,"m",!0)})))))),""!==x&&null!==x&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(y.a,{variant:"body2",style:{color:k}},"Comments: ",r.a.createElement("strong",null,x)))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"space-between",alignItems:"center"},r.a.createElement(y.a,{variant:"body2",style:{color:k}},A," | ",D),r.a.createElement(p.a,{"aria-label":"Show bulletin",variant:"text",color:"primary",size:"small",onClick:t({release_id:j,site_code:a,site_id:l})},"Bulletin"))))}else if("eos"===m){u=r.a.createElement(fr.TimelineItem,{key:c,dateText:d,style:{color:"#3f51b5"},dateInnerStyle:{background:"#3f51b5",lineHeight:"48px"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(gr.a,{style:{color:"#3f51b5",height:45,width:"auto",paddingRight:8}},r.a.createElement(Er.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(y.a,{variant:"caption",component:"div",style:{color:"#3f51b5"}},r.a.createElement("strong",null,"END-OF-SHIFT-ANALYSIS")),r.a.createElement(y.a,{variant:"h6",component:"div",style:{color:"#3f51b5",lineHeight:1.2}},r.a.createElement("strong",null,X()(o).format("MMMM Do YYYY, h:mm A"))))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",style:{color:"#3f51b5"},dangerouslySetInnerHTML:{__html:s}}))))}i.push(u)})),i}var yr=function(e){var t=e.match.params.event_id,a=vr(),l=Object(n.useState)({event_id:t,site_code:"---",site_id:1,validity:X()(),event_start:X()(),site_address:"",status:1}),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),p=u[0],b=u[1],f=Object(n.useState)({}),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(n.useState)(!1),O=Object(o.a)(h,2),j=O[0],x=O[1];Object(n.useEffect)((function(){!function(e,t){var a=e.event_id,n="".concat(We.b,"/api/monitoring/get_event_timeline_data/").concat(a);it.a.get(n).then((function(e){var a=e.data;console.log("Event details",a),t(a)})).catch((function(e){console.error("Problem in getEventTimelineEntries Axios request"),console.error(e)}))}({event_id:t},(function(e){var t=e.event_details,a=e.timeline_items;Object.keys(t).length>0&&(s(t),b(a))}))}),[]);var S=1===c.status?"ROUTINE":"EVENT",k=X()(c.event_start).format("MMMM Do YYYY, hh:mm A"),C="PRESENT";return null!==c.validity&&(C=X()(c.validity).format("MMMM Do YYYY, hh:mm A")),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,S," MONITORING TIMELINE")),r.a.createElement(y.a,{variant:"h4",align:"center"},c.site_address," (",c.site_code.toUpperCase(),")"),r.a.createElement(y.a,{variant:"subtitle1",align:"center"},"".concat(k," to ").concat(C))),r.a.createElement(fr.Timeline,{className:a.timeline,lineColor:"#DDDDDD"},_r(p,(function(e){return function(t){console.log(e);var a=Object(d.a)(Object(d.a)({},e),{},{type:null});v(a),x(!0)}}),c.site_code,c.site_id)),r.a.createElement(yt,{classes:a,isOpenBulletinModal:j,setIsOpenBulletinModal:x,releaseDetail:E}))},Or=a(189),jr=a.n(Or),xr=a(147),Sr=a.n(xr),kr=function(e){Object(_a.a)(a,e);var t=Object(ya.a)(a);function a(){var e;Object(va.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleTextChange=function(t){var a=e.props,n=a.options,r=a.onSearch,l=n.onSearchChange;l&&l(t.target.value),r(t.target.value)},e.onKeyDown=function(t){var a=e.props,n=a.onHide,r=a.onSearchClick;27===t.keyCode?n():13===t.keyCode&&r()},e}return Object(ha.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,l=t.onHide,i=t.searchText,c=t.onSearchClick;return r.a.createElement(V.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(f.a,{placeholder:"Search events using YYYY-MM-DD format...",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:i||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(H.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(jr.a,null)),r.a.createElement(H.a,{className:a.clearIcon,onClick:l},r.a.createElement(Sr.a,null))))}}]),a}(r.a.Component),Cr=Object(u.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(kr),wr=[],Ar=Object(O.a)((function(e){return Object(d.a)(Object(d.a)({},Object(F.d)(e)),{},{eventTable:{minWidth:"900px"}})}));var Dr=Object(pr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Ir=Object(K.a)()((function(e){var t=e.width,a=e.location,l=e.match.url,i=Ar(),c=Object(n.useState)([["Loading Data..."]]),u=Object(o.a)(c,2),p=u[0],b=u[1],f=Object(n.useState)(0),g=Object(o.a)(f,2),E=g[0],h=g[1],_=Object(n.useState)(10),O=Object(o.a)(_,2),x=O[0],S=O[1],k=Object(n.useState)(1),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(!1),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)({}),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],z=Object(n.useState)([]),U=Object(o.a)(z,2),W=U[0],G=U[1],q=Object(n.useState)(""),V=Object(o.a)(q,2),Q=V[0],Z=V[1],J=Object(n.useState)(!1),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=Object(n.useContext)(Kt).sites;Object(n.useEffect)((function(){var e={};ae.forEach((function(t){var a=ct(t,!0,"start"),n=t.site_code.toUpperCase();wr.push(n),e[n]={site_id:t.site_id,address:a}})),Y(e)}),[ae]),Object(n.useEffect)((function(){N(!0),function(e,t){var a=e.limit,n=e.offset,r=e.include_count,l=e.filters,i=e.search_str,c="".concat(We.b,"/api/monitoring/get_monitoring_events?filter_type=complete&offset=").concat(n,"&limit=").concat(a);r&&(c+="&include_count=true"),l.length>0&&(c+=l.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("")),""!==i&&(c+="&search=".concat(i)),it.a.get(c).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}({include_count:!0,limit:E*x+x,offset:E*x,filters:L,search_str:Q},(function(e){var t=e.events,a=e.count,n=function(e,t){return e.map((function(e,a){var n=e.event_id,r=e.site_code,l=e.entry_type,i=e.event_start,c=e.validity,o=e.public_alert,s=null,m="ROUTINE";""!==i&&null!==i&&(s=X()(i).format("D MMMM YYYY, HH:mm")),""!==c&&null!==c&&(m=X()(c).format("D MMMM YYYY, HH:mm"));var u="";Object.keys(t).length&&(u=t[r.toUpperCase()].address);return[n,u,l,o,s,m]}))}(t,R);b(n),A(a),N(!1)}))}),[E,x,L,Q,l,R]);var ne={textLabels:{body:{noMatch:"No data"}},filterType:"multiselect",responsive:Object(K.c)(t,"xs")?"standard":"simple",searchText:Q,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:x,count:w,page:E,filter:!0,selectableRows:"none",print:!1,download:!1,serverSide:!0,onTableChange:function(e,t){if("changePage"===e){var a=t.page;h(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==x&&S(n)}else"resetFilters"===e?(G({}),F([])):"onSearchOpen"===e&&te(!0)},onSearchChange:function(e){console.log("Searching for ".concat(e))},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){var r=null;if(0!==e.length){n=!1;var l=re[t].name;if("site_name"===l){var i=[],c=[];e.forEach((function(e){i.push(R[e].site_id),c.push(e)})),a.push({name:"site_ids",data:i}),r=c}else if("entry_type"===l){var o,s=[],m=[];e.forEach((function(e){"EVENT"===e?o=2:"ROUTINE"===e&&(o=1),s.push(e),m.push(o)})),a.push({name:"entry_types",data:m}),r=s}G(Object(d.a)(Object(d.a)({},W),{},{[l]:r}))}})),n&&G({}),F(a)},customSearchRender:function(e,t,a,n){var l=e||"";ee&&(l=Q,te(!1));return r.a.createElement(Cr,{searchText:e,onSearch:t,onHide:function(){a(),te(!1)},options:n,onSearchClick:function(){return Z(l)}})}},re=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:function(e,t){t.rowIndex;return"Loading Data..."===e?e:function(e,t){return r.a.createElement(s.b,{to:"".concat(e,"/").concat(t)},t)}(l,e)}}},{name:"site_name",label:"Site",options:{filter:!0,filterList:"undefined"===typeof W.site_name?[]:W.site_name,filterOptions:{names:wr}}},{name:"entry_type",label:"Entry Type",options:{filter:!0,filterList:"undefined"===typeof W.entry_type?[]:W.entry_type,filterOptions:{names:["ROUTINE","EVENT"]},sort:!1}},{name:"public_alert",label:"Last Alert Level",options:{filter:!0,sort:!0}},{name:"ts_start",label:"Event Start",options:{filter:!1,sort:!1}},{name:"ts_end",label:"Event End",options:{filter:!1,sort:!1}}];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Events"})),r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(m.d,{location:a},r.a.createElement(m.b,{exact:!0,path:l,render:function(e){return r.a.createElement(v.a,{className:i.paperContainer},r.a.createElement(br.a,{theme:Dr},r.a.createElement(dr.a,{title:r.a.createElement(y.a,{variant:"h5",component:"div"},"Monitoring Events Table",M&&r.a.createElement(j.a,{size:24,style:{marginLeft:15,position:"relative",top:4}})),data:p,columns:re,options:ne})))}}),r.a.createElement(m.b,{path:"".concat(l,"/:event_id"),render:function(e){return r.a.createElement(yr,Object.assign({},e,{width:t}))}}))))})),Mr=a(846),Nr=a(845),Tr=a(839),Hr=a(840),Rr=a(841),Yr=a(842),Br=a(843),Pr=a(228),Lr=a.n(Pr),Fr=(a(486),{toolbar:[["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],["clean"]],clipboard:{matchVisual:!1}}),zr=["bold","italic","underline","strike","blockquote","list","bullet","indent","link"],Ur=Object(O.a)((function(e){return{root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}}}}));function Wr(e){return Object.keys(e).filter((function(t){return!0===e[t]}))}function Gr(e){var t=e.shiftSummary,a=e.dataAnalysis,n=e.shiftNarratives,r=t.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),l=a.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),i=n.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>");return"<p>".concat(r,"</p><br/><p>").concat(l,"</p><br/><p>").concat(i,"</p>")}var qr=function(e){var t=e.data,a=e.shiftStartTs,l=e.currentUser,i=Ur(),s=t.site_code,m=t.eos_head,u=t.shift_start_info,b=t.shift_end_info,f=t.data_analysis,g=t.narratives,E=t.event_id,h=t.validity,O="".concat(m,"<br/>").concat(u,"<br/><br/>").concat(b),x=Object(n.useState)(O),S=Object(o.a)(x,2),k=S[0],C=S[1],w=Object(n.useState)(f),A=Object(o.a)(w,2),D=A[0],I=A[1],M=Object(n.useState)(f.length),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)(g),Y=Object(o.a)(R,2),B=Y[0],P=Y[1],L=Object(c.b)(),F=L.enqueueSnackbar,z=L.closeSnackbar,U=Object(n.useState)([]),W=Object(o.a)(U,2),G=W[0],q=W[1],V={rainfall:!1,surficial:!1},Q=[["rainfall","Rainfall",!1]],Z=t.has_markers,K=t.has_surficial_data,J=t.subsurface_columns,$="Surficial",ee=!1;Z?K||($+=" (No data)",ee=!0):($+=" (No markers)",ee=!0),Q.push(["surficial",$,ee]),J.forEach((function(e){var t=e.logger.logger_name,a="subsurface_".concat(t),n="Subsurface - ".concat(t.toUpperCase());V[a]=!1;var r=!e.has_data;r&&(n+=" (No data)"),Q.push([a,n,r])}));var te=Object(n.useState)(V),ae=Object(o.a)(te,2),ne=ae[0],re=ae[1],se=Q.map((function(e){return{state:ne[e[0]],value:e[0],label:e[1],is_disabled:e[2]}})),me=Object(n.useState)(!1),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(null),fe=Object(o.a)(be,2),ge=fe[0],Ee=fe[1],ve=Object(n.useState)(null),he=Object(o.a)(ve,2),_e=he[0],ye=he[1];Object(n.useEffect)((function(){if(de){null!==ge&&clearTimeout(ge),ye("typing");var e=setTimeout((function(){ye("saving");var e=setTimeout((function(){var e,t;e={shift_ts:a,event_id:E,dataAnalysis:D},t=function(e){console.log("response",e),ye("saved"),pe(!1)},pt("".concat(We.b,"/api/end_of_shift/save_eos_data_analysis"),e,t)}),3e3);Ee(e)}),3e3);Ee(e)}}),[D]);var Oe=X()(a).add(12,"hours"),Se=X()(h),ke=Se.isBefore(Oe)?Se.subtract(30,"minutes").format("YYYY-MM-DD HH:mm:ss"):X()(Oe).format("YYYY-MM-DD HH:mm:ss"),Ce=window.location,we=Ce.host,Ae=Ce.protocol,De="".concat(Ae,"//").concat(we,"/chart_rendering/").concat(s,"/").concat(ke),Ie=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){z(e)}},"Dismiss")},Me=function(e){return function(){var t=G;t.pop(t[e]),q(Object(Xe.a)(t))}},Ne=[{label:"Shift Summary",value:k,key:"shift_summary",updateFn:C},{label:"Data Analysis",value:D,key:"data_analysis",updateFn:I}],Te=T>3e3;return r.a.createElement(le.a,null,r.a.createElement(ie.a,{expandIcon:r.a.createElement(Qn.a,null)},r.a.createElement("div",{className:i.column},r.a.createElement(y.a,{variant:"body1"},s.toUpperCase())),r.a.createElement("div",{className:i.column},r.a.createElement(y.a,{variant:"body1"},"Shift Report"))),r.a.createElement(ce.a,null),r.a.createElement(oe.a,{className:i.details},r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,style:{marginTop:12}},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Charts"))),r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,justify:"space-around"},r.a.createElement(ca,{label:"Data Sources",changeHandler:function(e){return function(t){var a=t.target.checked;if(re(Object(d.a)(Object(d.a)({},ne),{},{[e]:a})),a){var n=e;["surficial","rainfall"].includes(e)||(n=e.replace("_","/")),window.open("".concat(De,"/").concat(n),"_blank")}}},choices:se,checkboxStyle:"primary"})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Attachments"))),r.a.createElement(_.a,{item:!0,xs:12,container:!0},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(v.a,{square:!0,style:{padding:"8px 12px",marginBottom:12,background:"gainsboro",border:"4px solid #CCCCCC"}},G.length>0?G.map((function(e,t){return r.a.createElement(Yt.a,{key:t,label:e.name,onDelete:Me(t),color:"primary"})})):r.a.createElement(y.a,{variant:"body2"},r.a.createElement("i",null,"None")))),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"flex-end"},r.a.createElement("input",{className:i.input,style:{display:"none"},multiple:!0,type:"file",onChange:function(e){for(var t=e.target.files,a=0;a<t.length;a+=1)G.push(t.item(a));q(Object(Xe.a)(G))},id:"raised-button-file"}),r.a.createElement("label",{htmlFor:"raised-button-file"},r.a.createElement(p.a,{startIcon:r.a.createElement(Tr.a,null),variant:"contained",component:"span",color:"primary",size:"small"},G.length>0?"Add more":"Attach File")))),Ne.map((function(e){var t=e.label,a=e.value,l=e.key,i=e.updateFn;return r.a.createElement(n.Fragment,{key:l},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,t))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Lr.a,{onChange:function(e){"Data Analysis"===t&&(H(e.length),null!==ge?pe(!0):Ee(1)),i(e)},defaultValue:a,modules:Fr,formats:zr})),"Data Analysis"===t&&r.a.createElement(_.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",style:{color:Te?"red":"black"}},r.a.createElement(xe.a,{title:"Content of text area is formatted on the background using HTML. HTML elements are included in the character count.",placement:"top",interactive:!0,arrow:!0},r.a.createElement("div",null,r.a.createElement(Hr.a,{color:"primary",fontSize:"small"}),"\xa0")),r.a.createElement(y.a,{variant:"caption"},r.a.createElement("strong",null,"Character count (including HTML): ",T,"/3000")),null!==_e&&r.a.createElement(y.a,{variant:"caption",component:"div",style:{marginLeft:24,display:"flex",alignItems:"center",color:["typing","saving"].includes(_e)?"orange":"green"}},r.a.createElement("div",{style:{marginRight:6}},r.a.createElement("strong",null,_e.toUpperCase())),["typing","saving"].includes(_e)?r.a.createElement(j.a,{size:20}):r.a.createElement(la.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Shift Narratives ")),r.a.createElement(y.a,{variant:"body2"},r.a.createElement("i",null,"NOTE: It is recommended NOT to add narratives via this text box. Use Site Logs Form instead then click Refresh."))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Lr.a,{onChange:function(e){return P(e)},value:B,defaultValue:B,modules:Fr,formats:zr,bounds:".app"})))),r.a.createElement(ce.a,null),r.a.createElement(je.a,null,r.a.createElement(p.a,{size:"small",onClick:function(){var e,t,a=Wr(ne),n={site_code:s,user_id:l.user_id,charts:a,file_name:"".concat(s,"_chart.pdf")};e=n,t=function(e){var t=e.message,a=e.file_response,n=a.file_path,r=a.message;console.log("response",r),"success"===t?F("Charts Saved! Path: ".concat(n),{variant:"success",autoHideDuration:7e3,action:Ie}):F("Error saving charts...",{variant:"error",autoHideDuration:7e3,action:Ie})},pt("".concat(We.b,"/api/end_of_shift/download_eos_charts"),e,t)},startIcon:r.a.createElement(Rr.a,null)},"Download Charts"),r.a.createElement(p.a,{size:"small",startIcon:r.a.createElement(Yr.a,null),onClick:function(){!function(e,t){var a=e.shift_ts,n=e.event_id,r="".concat(We.b,"/api/end_of_shift/get_narrative/").concat(a,"/").concat(n);it.a.get(r).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}({shift_ts:a,event_id:E},(function(e){console.log(e),P(e)}))}},"Refresh Narratives"),r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Br.a,null),onClick:function(){var e=F("Sending End-of-Shift Report...",{variant:"warning",persist:!0}),t=new FormData,n=X()(ke).add(30,"minutes").format("YYYY-MM-DD HH:mm:ss");Wr(ne).forEach((function(e){return t.append("charts",e)})),G.forEach((function(e){t.append("attached_files",e)}));var r,i,c,o={shift_ts:a,event_id:E,data_analysis:D,file_name_ts:n,mail_body:Gr({shiftSummary:k,dataAnalysis:D,shiftNarratives:B}),site_code:s,user_id:l.user_id};for(var m in o)o.hasOwnProperty(m)&&t.append(m,o[m]);r=t,i=function(t){z(e),console.log(t);var a="Error sending End-of-Shift Report...",n="error";"Success"===t&&(a="End-of-Shift Report Sent!",n="success"),F(a,{variant:n,autoHideDuration:7e3,action:Ie})},c=function(){z(e),F("Error sending End-of-Shift Report...",{variant:"error",autoHideDuration:7e3,action:Ie})},pt("".concat(We.b,"/api/mailbox/send_eos_email"),r,i,c)},disabled:Te},"Send")))},Vr=a(844);function Qr(e){var t=e.selectedSites,a=e.setSelectedSites,n=e.site_code,r=e.checkAll,l=t;if(l.includes(n)){if(!r){var i=l.indexOf(n);l.splice(i,1)}}else l.push(n);a(Object(Xe.a)(l))}var Zr=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.eosData,c=e.setSelectedEosData,s=e.setModalOpen,m=e.setEosData,u=Object(n.useState)([]),d=Object(o.a)(u,2),b=d[0],f=d[1],g=Object(n.useState)(!0),E=Object(o.a)(g,2),v=E[0],O=E[1],x=function(e){return function(t){Qr({selectedSites:b,setSelectedSites:f,site_code:e})}},S=null!==i&&0===i.length;return r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Generate End-of-Shift Report"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Select sites to create end-of-shift report."),null===i&&r.a.createElement(h.a,{display:"flex",justifyContent:"center"},r.a.createElement(j.a,null)),!0===S&&r.a.createElement(y.a,{variant:"subtitle1",align:"center"},"No active sites."),null!==i&&r.a.createElement(_.a,{container:!0,alignItems:"baseline"},r.a.createElement(H.a,{onClick:function(){i.forEach((function(e){var t=e.site_code;Qr({selectedSites:b,setSelectedSites:f,site_code:t,checkAll:v})})),O(!v)},style:{marginRight:6},"aria-label":"Select all"},r.a.createElement(Vr.a,null)),i.map((function(e){var t=e.site_code,a=e.event_id,n=b.includes(t),l=t.toUpperCase();return r.a.createElement(Re.a,{key:a},r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{key:a,onChange:x(t),value:t,color:"primary",checked:n}),label:l}))})))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:function(){l(),m(null)},color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:function(){var e=i.filter((function(e){return b.includes(e.site_code)}));c(e),s(!1)},color:"primary"},"Submit"))))})),Kr=Object(O.a)((function(e){return{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},AccordionsGroup:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"24px 0"},marginTop:16},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},hidden:{display:"none !important"}}})),Jr=function(){return r.a.createElement(Oe.a,{height:150,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}))};function Xr(e,t){var a=e.label,n=e.value;e.id;return r.a.createElement(Nr.b,{required:!0,autoOk:!0,label:a,value:n,onChange:t,ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,variant:"dialog",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}function $r(e,t,a){var n="am"===t?"07:30:00":"19:30:00",r=X()(e).format("YYYY-MM-DD ".concat(n));return function(e,t){var a=e.shift_start,n="".concat(We.b,"/api/end_of_shift/get_end_of_shift_reports/").concat(a);it.a.get(n).then((function(e){var a=e.data;console.log("EOS Data",a),t(a)})).catch((function(e){console.error("Problem in Axios request"),console.error(e)}))}({shift_start:r},(function(e){a(e)})),r}function el(e){var t=e.isStart,a="No event report to generate";return"undefined"!==t&&t&&(a="Generate end-of-shift reports here"),r.a.createElement(v.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var tl=Object(K.a)()((function(e){var t,a,l=e.width,i=e.hidden,c=Kr(),s=X()(),m=s.hour(),u=Object(n.useState)(s.format("YYYY-MM-DD")),d=Object(o.a)(u,2),b=d[0],f=d[1],g=Object(n.useState)(m>=10&&m<=22?"am":"pm"),E=Object(o.a)(g,2),h=E[0],y=E[1],O=Object(n.useState)(!1),j=Object(o.a)(O,2),S=j[0],k=(j[1],Object(n.useState)(null)),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(null),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1],z=Object(x.a)(),U=function(e){f(e)},W=function(){return M.map((function(e,t){return r.a.createElement(qr,{data:e,key:t,shiftStartTs:R,currentUser:z})}))};return r.a.createElement("div",{className:i?c.hidden:""},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:4,style:{display:i?"none !important":""}},[{label:"Shift Start",value:b,id:"start_ts"}].map((function(e){var t=e.id;return r.a.createElement(_.a,{item:!0,xs:12,sm:!0,key:t,className:c.inputGridContainer},Xr(e,U))})),r.a.createElement(_.a,{item:!0,xs:12,sm:!0},r.a.createElement(Ea,{div_id:"shift_time",label:"Shift Time",changeHandler:function(e){return y(e.target.value)},value:h,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,className:"".concat(c.inputGridContainer," ").concat(c.buttonGrid)},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(K.b)("sm",l)?"small":"medium",onClick:(a="site_list",function(e){if("generate_report"===a)F(!1);else{F(!0);var t=$r(b,h,A);Y(t)}})},"Generate ",r.a.createElement(Mr.a,{className:c.button}))))),r.a.createElement("div",{className:c.AccordionsGroup},null===M&&!S&&r.a.createElement(el,{isStart:!0}),S?r.a.createElement(Jr,null):r.a.createElement(v.a,null,null!==M&&(M.length>0?r.a.createElement(W,null):r.a.createElement(el,null)))),r.a.createElement(Zr,{isOpen:L,closeHandler:(t=!1,function(){return F(t)}),eosData:w,setSelectedEosData:N,setModalOpen:F,setEosData:A}))})),al=a(847),nl=a(508),rl=a.n(nl),ll=a(292),il=a(380);a(745);function cl(e){var t=e.event,a=Object(n.useState)(null),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Boolean(i),m=s?"simple-popover":void 0;return r.a.createElement("div",{style:{width:"inherit"}},r.a.createElement("div",{"aria-describedby":m,onClick:function(e){c(e.currentTarget)},role:"button",tabIndex:"0"},t.title),r.a.createElement(ll.a,{id:m,open:s,anchorEl:i,onClose:function(){c(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(y.a,{variant:"body1",style:{padding:8}},t.title)))}var ol=r.a.memo((function(e){var t=e.nickname,a="undefined"!==typeof t,l=Object(il.b)(X.a),i=Object(n.useState)([]),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Object(n.useState)([]),d=Object(o.a)(u,2),p=d[0],b=d[1],f=Object(n.useState)([]),g=Object(o.a)(f,2),E=g[0],v=g[1];Object(n.useEffect)((function(){return Object($n.c)((function(e){return m(e)})),Object($n.a)(),function(){Object($n.e)()}}),[]),Object(n.useEffect)((function(){null===s&&"undefined"===s||b(s)}),[s]),Object(n.useEffect)((function(){var e=p.flatMap((function(e){var n=X()(e.ts),r=X()(e.ts),l=n.hours()>19?"PM":"AM",i=r.add(12,"hours");if("PM"===l&&(i=n.set({h:23,m:59})),!a)return[{title:"".concat(e.iompmt," (MT - ").concat(l,")"),start:n,end:i},{title:"".concat(e.iompct," (CT - ").concat(l,")"),start:n,end:i}];var c=null;return e.iompmt===t&&(c="".concat(t," (MT")),e.iompct===t&&(c="".concat(t," (CT")),c?[{title:"".concat(c," - ").concat(l,")"),start:n,end:i}]:void 0}));v(e)}),[p,t]);var h=X()();return r.a.createElement("div",{style:{height:a?300:850,width:"-webkit-fill-available"}},r.a.createElement(y.a,{variant:"subtitle2",align:"center"},r.a.createElement("i",null,"Note: The border color of the bordered box specifies the current monitoring shift.")),r.a.createElement(il.a,{events:E,localizer:l,defaultDate:new Date,eventPropGetter:function(e,t,a){var n="#E5DE44",r="black";return X()(t).hours()>19&&(n="#053752",r="white"),{className:"",style:{color:r,borderRadius:5,border:"none",fontSize:12,backgroundColor:n}}},defaultView:"month",dayPropGetter:function(e){var t=h.hours(),a=X()(e),n=h.clone().subtract(1,"day"),r=t<8&&n.isSame(a,"day"),l=t>=8&&a.isSame(h,"day");return r||l?{className:"current-shift",style:{border:"dashed 5px ".concat(t>=8&&t<20?"#E5DE44":"#053752")}}:{}},views:["month"],components:{event:cl},popup:!0}))})),sl=Object(O.a)((function(e){var t=Object(F.d)(e);return{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},divider:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),selects:{width:"auto",[e.breakpoints.up("md")]:{width:"-webkit-fill-available"}},link:{textDecoration:"none"},valueFont:{color:"black",textDecoration:"none"},hidden:{display:"none !important"}}}));function ml(e,t){return t.map((function(t,a){var n=t.date,l=t.data,i=t.ampm,c=t.mt,o=t.ct,m=rl.a.toWords(l.length),u="".concat(ot(m)," (").concat(l.length,")"),d=l.map((function(t,a){var n=t.general_status,l=t.site_code,i=t.public_alert_level,c=t.event_id,o=t.internal_alert,m=function(e,t,a){return r.a.createElement(s.b,{className:e.link,to:"/monitoring/events/".concat(t),target:"_blank"},a.toUpperCase())}(e,c,l);return r.a.createElement(_.a,{container:!0,justify:"space-evenly",direction:"column",item:!0,xs:4,key:"site_alert_".concat(a+1)},r.a.createElement(y.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},m)),r.a.createElement(y.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},"Alert ",i," (",o,")")),r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center"},"Monitoring status: ",r.a.createElement("span",{className:e.valueFont},ot(n))))}));return r.a.createElement(le.a,{key:"monitoring_date_".concat(a+1)},r.a.createElement(ie.a,{expandIcon:r.a.createElement(Qn.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(_.a,{container:!0},r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{color:"textSecondary",align:"center"},"Shift Date: ",r.a.createElement("span",{className:e.valueFont},X()(n).format("MMMM D, YYYY")))),r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{color:"textSecondary",align:"center"},"Sites Monitored: ",r.a.createElement("span",{className:e.valueFont},u))),r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{color:"textSecondary",align:"center"},"Shift Schedule: ",r.a.createElement("span",{className:e.valueFont},i))))),r.a.createElement(ce.a,null),r.a.createElement(oe.a,null,r.a.createElement(_.a,{container:!0,spacing:2,className:e.def_padding},r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{variant:"body1",color:"textSecondary",align:"center"},"Shift Schedule"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary",align:"center"},i)),r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{variant:"body1",color:"textSecondary",align:"center"},"MT Personnel"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary",align:"center"},c)),r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(y.a,{variant:"body1",color:"textSecondary",align:"center"},"CT Personnel"),r.a.createElement(y.a,{variant:"body1",color:"textPrimary",align:"center"},o)),r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20}},r.a.createElement(ce.a,null)),d)),r.a.createElement(ce.a,null))}))}var ul=Object(K.a)()((function(e){var t=e.hidden,a=e.width,l=e.defaultCalendarOpen,i=sl(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),b=Object(o.a)(d,2),f=b[0],g=b[1],E=Object(n.useState)(""),h=Object(o.a)(E,2),O=h[0],j=h[1],x=Object(n.useState)({}),S=Object(o.a)(x,2),k=S[0],C=S[1],w=Object(n.useState)(""),A=Object(o.a)(w,2),D=A[0],I=A[1];Object(n.useEffect)((function(){C({ts_start:X()(m).format("YYYY-MM-DD HH:mm:ss"),ts_end:X()(f).format("YYYY-MM-DD HH:mm:ss"),user_id:O})}),[m,f,O]);var M,N=function(e){return function(t){switch(e){case"ts_start":u(t);break;case"ts_end":g(t)}}};return r.a.createElement("div",{className:t?i.hidden:""},r.a.createElement(le.a,{defaultExpanded:l},r.a.createElement(ie.a,{expandIcon:r.a.createElement(Qn.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},r.a.createElement(y.a,{variant:"body1",component:_.a,container:!0},r.a.createElement(al.a,{style:{marginRight:8}})," ",r.a.createElement("div",null,r.a.createElement("strong",null,"MONITORING SHIFTS CALENDAR")))),r.a.createElement(ce.a,null),r.a.createElement(oe.a,null,r.a.createElement(ol,null))),r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(v.a,{component:_.a,container:!0,spacing:2,style:{marginTop:16,marginBottom:16,padding:8},alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6"},r.a.createElement("strong",null,"MONITORING SHIFT CHECKER")),r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("i",null,"Note: The checker currently shows event and extended releases only. Routine releases are NOT yet reflected."))),r.a.createElement(_.a,{container:!0,spacing:2,item:!0,xs:12,sm:10},[{label:"Start Timestamp",value:m,id:"ts_start"},{label:"End Timestamp",value:f,id:"ts_end"}].map((function(e){return r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:4,key:e.id},function(e,t){var a=e.label,n=e.value,l=e.id;return r.a.createElement(wt.a,{required:!0,autoOk:!0,label:a,value:n,onChange:t(l),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,inputVariant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,N))})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:4},r.a.createElement(Ca,{label:"Staff Name",div_id:"user_id",changeHandler:(M="user_id",function(e){var t=e.target.value;switch(M){case"user_id":j(t)}}),value:O,css:i.selects,variant:"outlined"}))),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,container:!0,justify:"center"},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(K.b)("sm",a)?"small":"medium",onClick:function(){var e,t;e=k,t=function(e){var t=ml(i,e);I(r.a.createElement(y.a,{style:{fontStyle:"italic"}},"No shift data")),t.length>0&&I(t)},pt("".concat(We.b,"/api/shift_checker/get_shift_data"),e,t)},endIcon:r.a.createElement(Mr.a,null)},"Generate"))),r.a.createElement(_.a,{item:!0,sm:12},D)))})),dl=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{tabBar:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})})),pl=[{label:"End-of-Shift Report Generator",href:"report_generator"},{label:"Monitoring Shifts",href:"shifts"}];Object(n.createContext)();var bl=function(e){var t=e.history,a=e.match.url,l=e.location.pathname,i=Object(n.useState)(0),c=Object(o.a)(i,2),s=c[0],u=c[1],d=dl(),p=Object(n.useState)(!1),b=Object(o.a)(p,2),f=b[0],g=b[1];return Object(n.useEffect)((function(){var e=Object(m.f)(l,{path:"".concat(a,"/:tab"),exact:!0});if(e){var t=e.params.tab,n=pl.findIndex((function(e){return e.href===t}));u(n),1===n&&g(!0)}}),[a]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Shifts & Reports"})),r.a.createElement("div",{className:d.tabBar},r.a.createElement(ye,{chosenTab:s,onSelect:function(e){u(e),t.push("".concat(a,"/").concat(pl[e].href))},tabsArray:pl})),r.a.createElement("div",{className:"".concat(d.pageContentMargin," ").concat(d.tabBarContent)},r.a.createElement(tl,{hidden:0!==s}),r.a.createElement(ul,{hidden:1!==s,defaultCalendarOpen:f})))},fl=a(835),gl=a(848),El=a(849),vl=function(e){Object(_a.a)(a,e);var t=Object(ya.a)(a);function a(){var e;Object(va.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleTextChange=function(t){var a=e.props.options.onSearchChange;a&&a(t.target.value),e.props.onSearch(t.target.value)},e.onKeyDown=function(t){27===t.keyCode?e.props.onHide():13===t.keyCode&&e.props.onSearchClick()},e}return Object(ha.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,l=t.onHide,i=t.searchText,c=t.onSearchClick;return r.a.createElement(V.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(f.a,{placeholder:"Type words to search narrative column",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:i||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(H.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(jr.a,null)),r.a.createElement(H.a,{className:a.clearIcon,onClick:l},r.a.createElement(Sr.a,null))))}}]),a}(r.a.Component),hl=Object(u.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(vl);function _l(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;it.a.post(t,e).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e)}))}var yl=Object(O.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}}));var Ol=function(e){var t=yl(),a=e.narrativeData,n=e.setNarrativeData,l=e.siteList,i=e.setSiteList,c=e.isFromSiteLogs,o=e.callAck,s=e.setCallAck,m=e.callAckHashtag,u=e.toUseCurrentInstance,p=e.setToUseCurrentInstance,b=a.narrative,g=a.timestamp,E=a.user_id,v=a.narrative_id,h=function(e){return function(t){n(Object(d.a)(Object(d.a)({},a),{},{[e]:t}))}},O=function(e){return function(t){var r=t.target.value;n(Object(d.a)(Object(d.a)({},a),{},{[e]:r}))}};return r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(_.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement($t,{value:l,changeHandler:function(e){i(e)},isMulti:!0,isFromSiteLogs:c,disabled:Boolean(v)})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Nr.a,{required:!0,autoOk:!0,label:"Date",value:g,onChange:h("timestamp"),ampm:!1,placeholder:"2020-01-01",format:"YYYY-MM-DD",mask:"____-__-__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Wa.b,{required:!0,autoOk:!0,label:"Time",value:g,onChange:h("timestamp"),ampm:!1,placeholder:"00:00",format:"HH:mm",mask:"__:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Ca,{variant:"standard",label:"Reporter",div_id:"user_id",changeHandler:O("user_id"),value:E,disabled:!0})),r.a.createElement(_.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Be.a,{value:"callAck",control:r.a.createElement(kt.a,{color:"primary",checked:u,onClick:function(e){return p(e.target.checked)}}),label:r.a.createElement("div",null,"Associate site log to current monitoring instance\xa0",r.a.createElement(xe.a,{title:"Unchecking this will associate the log on the montoring event where the log's timestamp falls through."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Be.a,{value:"callAck",control:r.a.createElement(kt.a,{color:"primary",checked:o,onClick:function(e){var t=e.target.checked;s(t);var r=b,l=" ".concat(m);t?(b.length+l.length>1e3&&r.substring(0,1e3-l.length),r+=l):r=b.replace(l,""),n(Object(d.a)(Object(d.a)({},a),{},{narrative:r}))}}),label:r.a.createElement("div",null,"Early Warning Information (EWI) acknowledgement call\xa0",r.a.createElement(xe.a,{title:"Tick this if the log to enter is a call that acknowledges an EWI. This will add #EWIResponseCall on the narrative."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),r.a.createElement(_.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"standard-multiline-static",label:"Narrative",value:b,onChange:O("narrative"),placeholder:"Enter narrative",multiline:!0,rows:"4",rowsMax:4,fullWidth:!0,inputProps:{maxLength:1e3},variant:"filled"}),r.a.createElement(y.a,{component:_.a,container:!0,justify:"flex-end",variant:"caption"},"Characters: ",b.length,"/1000"))))};var jl=Object(Fe.a)()((function(e){var t,a=e.fullScreen,l=e.isOpen,i=e.closeHandler,s=e.setIsUpdateNeeded,m=e.chosenNarrative,u=e.isEditMode,d=e.isFromSiteLogs,b=e.setSort,f=e.resetInput,g=Object(c.b)(),E=g.enqueueSnackbar,v=g.closeSnackbar,h=Object(x.a)(),_={narrative_id:null,timestamp:X()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:h.user_id,event_id:null,type_id:1},y=Object(n.useState)(null),O=Object(o.a)(y,2),j=O[0],S=O[1],k=Object(n.useState)(_),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(!0),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useContext)(Kt).sites,H=(t=!0,T.map((function(e){var a=e.site_code,n=e.site_id,r=a.toUpperCase();return t&&(r=ct(e,!0,"start")),{value:n,label:r,data:e}}))),R=Object(n.useState)(!1),Y=Object(o.a)(R,2),B=Y[0],P=Y[1],L=Object(n.useState)(!0),F=Object(o.a)(L,2),z=F[0],U=F[1];Object(n.useEffect)((function(){var e="";if(0!==Object.keys(m).length){var t=m.id,a=m.narrative,n=m.timestamp,r=m.site_id,l=m.user_id,i=m.event_id,c=m.type_id,o=H.filter((function(e){return e.value===r}));delete o.data,o.event_id=i,S(Object(Xe.a)(o)),A({narrative_id:t,timestamp:n,narrative:a,user_id:l,event_id:i,type_id:c}),e=a}P(e.includes("#EWIResponseCall"))}),[m]),Object(n.useEffect)((function(){var e=""===w.narrative||null===j;N(e)}),[w,j]);var W=function(){A({narrative_id:null,narrative:"",user_id:h.user_id,event_id:"",type_id:1}),S(j),P(!1),U(!0)},G=function(){A({narrative_id:null,timestamp:X()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:h.user_id,event_id:"",type_id:1}),S(null),U(!0)},q=function(){i(),G()};return r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Site Logs Form"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Note: Only monitoring-related narratives can be entered in this form. Please use other forms dedicated to its purposes."),r.a.createElement(Ol,{narrativeData:w,setNarrativeData:A,siteList:j,setSiteList:S,isFromSiteLogs:d,callAck:B,setCallAck:P,callAckHashtag:"#EWIResponseCall",toUseCurrentInstance:z,setToUseCurrentInstance:U})),r.a.createElement(Le.a,null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:q,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:G},"Reset"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){N(!0);var e,t=E("Inserting site log...",{variant:"warning",persist:!0}),a=j.map((function(e){var t=e.value,a=e.event_id||null;return z||(a=null),{site_id:t,event_id:a}}));w.site_list=a,w.timestamp=X()(w.timestamp).format("YYYY-MM-DD HH:mm:ss"),w.user_id=h.user_id,console.log(w),e=function(e){console.log("ret",e),W(),v(t),E("Site log inserted successfully!",{variant:"success",autoHideDuration:3e3}),b({order_by:"id",order:"desc"}),f(),s(!0),u&&q()},_l(w,"".concat(We.b,"/api/narratives/write_narratives_to_db"),e)},disabled:M},u?"Save Edits":"Save & Add More")))))}));var xl=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,n=e.closeHandler,l=e.chosenNarrative,i=e.setIsUpdateNeeded,c=l.id,o=l.narrative;return r.a.createElement("div",null,r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Site Logs Delete"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Are you sure you want to delete this narrative?"),r.a.createElement(He.a,{align:"center"},'"'.concat(o,'"'))),r.a.createElement(Le.a,null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:n,color:"primary"},"Cancel"),r.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){var e;n(),e=function(e){console.log("ret",e),i(!0)},_l({narrative_id:c},"".concat(We.b,"/api/narratives/delete_narratives_from_db"),e)},disabled:!1},"Confirm")))))})),Sl=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(d.a)(Object(d.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}})})})),kl=Object(pr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Cl=Object(K.a)()((function(e){var t=e.width,a=Sl(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(0),u=Object(o.a)(m,2),b=u[0],f=u[1],g=Object(n.useState)(10),E=Object(o.a)(g,2),h=E[0],_=E[1],y=Object(n.useState)(0),O=Object(o.a)(y,2),j=O[0],x=O[1],S=Object(n.useState)([]),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)([]),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(n.useState)(""),T=Object(o.a)(N,2),R=T[0],B=T[1],P=Object(n.useState)({order_by:"timestamp",order:"desc"}),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)(!0),W=Object(o.a)(U,2),G=W[0],q=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],J=Q[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(!1),re=Object(o.a)(ne,2),le=re[0],ie=re[1],ce=Object(n.useState)({}),oe=Object(o.a)(ce,2),me=oe[0],de=oe[1],pe=Object(n.useState)(!0),be=Object(o.a)(pe,2),fe=be[0],Ee=be[1],ve=Object(n.useState)(null),he=Object(o.a)(ve,2),_e=he[0],ye=he[1],Oe=Object(n.useContext)(Kt).setIsReconnecting,je=Object(n.useContext)(Kt).sites,xe=[],Se={};je.forEach((function(e){var t=e.site_code.toUpperCase();xe.push(t),Se[t]=e.site_id})),Object(n.useEffect)((function(){return qe(Oe),Ze((function(e){return ye(e)})),function(){Qe()}}),[]),Object(n.useEffect)((function(){fe&&(q(!0),function(e,t){var a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.order_by,o=e.order,s="".concat(We.b,"/api/narratives/get_narratives?limit=").concat(n,"&offset=").concat(r);s+="&order_by=".concat(c,"&order=").concat(o),a&&(s+="&include_count=true"),0!==l.length&&(s+=l.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("")),""!==i&&(s+="&search=".concat(i)),it.a.get(s).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(Object(d.a)({include_count:!0,limit:h,offset:b*h,filters:C,search_str:R},F),(function(e){var t=e.narratives,a=e.count,n=t.map((function(e){var t=e.narrative,a=e.user_details,n=e.site_id,r=e.user_id,l=e.id,i=e.type_id,c=e.event_id,o=e.timestamp,s="---";if(null!==a){var m=a.last_name,u=a.first_name;s="".concat(u," ").concat(m)}return{narrative:t,user_details:s,site_name:ct(e.site,!0,"start"),timestamp:o,type:e.type_id,actions:"---",site_id:n,user_id:r,id:l,type_id:i,event_id:c}}));s(n),x(a),q(!1)})),Ee(!1))}),[b,h,C,R,F,fe]);var ke=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f(0),e||w([]),B("")},Ce=function(e,t){return function(){"is_narrative_modal_open"===e?(J(!Z),ie(!1),de({})):"is_open_delete_modal"===e&&ae(!te)}},we={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(K.c)(t,"xs")?"standard":"simple",serverSide:!0,searchText:R,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:h,count:j,page:b,onTableChange(e,t){if("changePage"===e){var a=t.page;f(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==h&&_(n)}else"resetFilters"===e&&(M({}),w([]));["changePage","changeRowsPerPage","resetFilters"].includes(e)&&Ee(!0)},onColumnSortChange(e,t){z({order_by:e,order:"ascending"===t?"asc":"desc"}),Ee(!0)},onFilterChange(e,t){var a=[],n=!0;t.forEach((function(e,t){if(0!==e.length){n=!1;var r=Ae[t].name;if("site_name"===r){var l=[],i=[];e.forEach((function(e){l.push(Se[e]),i.push(e)})),a.push({name:"site_ids",data:l}),M(Object(d.a)(Object(d.a)({},I),{},{[r]:i}))}}})),n&&M({}),w(a),Ee(!0)},customSearchRender:function(e,t,a,n){var l=e||"";return r.a.createElement(hl,{searchText:e,onSearch:t,onHide:function(){a(),B(""),Ee(!0)},options:n,onSearchClick:function(){ke(!0),B(l),Ee(!0)}})}},Ae=[{name:"id",label:"Log ID",options:{filter:!1,display:!1,sort:!0}},{name:"timestamp",label:"Timestamp",options:{filter:!1,sort:!0,sortDirection:"timestamp"===F.order_by?F.order:"none",customBodyRender:function(e){return X()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"site_name",label:"Site",options:{display:"true",filter:!0,filterType:"custom",filterList:"undefined"===typeof I.site_name?[]:I.site_name,filterOptions:{fullWidth:!0,logic:(e,t)=>!!t.length&&!t.includes(e),display(e,t,n,l){var i=_e.latest,c=_e.extended,o=_e.overdue,s=[].concat(Object(Xe.a)(i),Object(Xe.a)(o));return r.a.createElement(Re.a,null,r.a.createElement(fa.a,null,"Site"),r.a.createElement(ga.a,{multiple:!0,value:e[n],renderValue:function(e){return e.join(", ")},onChange:function(a){e[n]=a.target.value,t(e[n],n,l)}},xe.map((function(t){var l=t.toLowerCase(),i=s.find((function(e){return e.event.site.site_code===l})),o=c.find((function(e){return e.event.site.site_code===l})),m=a.alert0;i&&(m=a.alert3),o&&(m=a.extended);var u=i||o?r.a.createElement(jn.a,null,r.a.createElement(ue.a,null)):"";return r.a.createElement(Y.a,{key:t,value:t,className:m},r.a.createElement(kt.a,{color:"primary",checked:e[n].indexOf(t)>-1}),r.a.createElement(On.a,{primary:t}),u)}))))}},sort:!1}},{name:"narrative",label:"Narrative",options:{filter:!1,sort:!1}},{name:"type",label:"Type",options:{filter:!0}},{name:"user_details",label:"Reporter",options:{filter:!1}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:function(e,t){var a=t.rowIndex;return function(e,t){var a=t.setChosenNarrative,n=t.setIsOpenNarrativeModal,l=t.setIsOpenDeleteModal,i=t.setIsEditMode;return r.a.createElement("span",null,r.a.createElement(H.a,{tooltip:"Edit",style:{float:"left"},onClick:function(t){a(e),n(!0),i(!0)}},r.a.createElement(gl.a,{style:{fontSize:20}})),r.a.createElement(H.a,{tooltip:"Delete",style:{float:"left"},onClick:function(t){a(e),l(!0)}},r.a.createElement(El.a,{style:{fontSize:20}})))}(c[a],{setChosenNarrative:de,setIsOpenNarrativeModal:J,isOpenNarrativeModal:Z,setIsOpenDeleteModal:ae,isOpenDeleteModal:te,setIsEditMode:ie,isEditMode:le})}}}],De=Object(K.c)("md",t),Ie=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Write a site log",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:Ce("is_narrative_modal_open")},r.a.createElement(se.a,{style:{paddingRight:4,fontSize:20}}),"Write a Site Log"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Site Logs",customButtons:!!De&&Ie})),r.a.createElement(Me.a,{open:G,fullWidth:!0},r.a.createElement(Te.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(fl.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(v.a,{className:a.paperContainer},r.a.createElement(br.a,{theme:kl},r.a.createElement(dr.a,{title:"Site Logs",data:c,columns:Ae,options:we})))),r.a.createElement(jl,{isOpen:Z,closeHandler:Ce("is_narrative_modal_open"),setIsUpdateNeeded:Ee,chosenNarrative:me,isFromSiteLogs:_e,isEditMode:le,setSort:z,resetInput:ke}),r.a.createElement(xl,{isOpen:te,closeHandler:Ce("is_open_delete_modal"),chosenNarrative:me,setIsUpdateNeeded:Ee}))})),wl=function(e){Object(_a.a)(a,e);var t=Object(ya.a)(a);function a(){var e;Object(va.a)(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).handleTextChange=function(t){var a=e.props.options.onSearchChange;a&&a(t.target.value),e.props.onSearch(t.target.value)},e.onKeyDown=function(t){27===t.keyCode?e.props.onHide():13===t.keyCode&&e.props.onSearchClick()},e}return Object(ha.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,l=t.onHide,i=t.searchText,c=t.onSearchClick;return r.a.createElement(V.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(f.a,{placeholder:"Type words to search details column",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:i||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(H.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(jr.a,null)),r.a.createElement(H.a,{className:a.clearIcon,onClick:l},r.a.createElement(Sr.a,null))))}}]),a}(r.a.Component),Al=Object(u.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(wl),Dl={},Il=Object(O.a)((function(e){return Object(d.a)(Object(d.a)({},Object(F.d)(e)),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8}})})),Ml=Object(pr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Nl=Object(K.a)()((function(e){var t=e.width,a=Il(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(0),u=Object(o.a)(m,2),b=u[0],f=u[1],g=Object(n.useState)(5),E=Object(o.a)(g,2),h=E[0],_=E[1],y=Object(n.useState)(0),O=Object(o.a)(y,2),j=O[0],x=O[1],S=Object(n.useState)([]),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)([]),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(n.useState)(""),T=Object(o.a)(N,2),R=T[0],Y=T[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1],z=Object(n.useState)(!0),U=Object(o.a)(z,2),W=U[0],G=U[1],q=Object(n.useState)(!1),V=Object(o.a)(q,2),Q=V[0],Z=V[1],J=Object(n.useState)({}),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=Object(n.useState)(!1),ne=Object(o.a)(ae,2),re=ne[0],le=ne[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],me=ce[1],ue=Object(n.useState)(!0),de=Object(o.a)(ue,2),pe=de[0],be=de[1];Object(n.useEffect)((function(){G(!0),function(e,t){var a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.include_expired,o="".concat(We.b,"/api/issues_and_reminders/get_issues_and_reminders");if(o+="?include_expired=".concat(c),null!==n||null!==r){if(o+="&limit=".concat(n,"&offset=").concat(r),a&&(o+="&include_count=true"),0!==l.length)o+=l.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("");""!==i&&(o+="&search=".concat(i))}it.a.get(o).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}({include_count:!0,limit:h,offset:b*h,filters:C,search_str:R,include_expired:!0},(function(e){var t=e.issues_and_reminders,a=e.count;s(t),x(a),G(!1)}))}),[b,h,C,R,pe]);var fe=function(e,t){return function(){"is_issue_reminder_modal_open"===e&&(Z(t),le(!1))}},Ee={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(K.c)(t,"xs")?"standard":"simple",serverSide:!0,rowsPerPageOptions:[5,10,15],rowsPerPage:h,count:j,page:b,onTableChange(e,t){if("changePage"===e){var a=t.page;f(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==h&&_(n)}else"resetFilters"===e?(M({}),w([])):"onSearchOpen"===e&&F(!0)},onFilterChange(e,t){var a=[],n=!0;t.forEach((function(e,t){if(0!==e.length){n=!1;var r=ve[t].name;if("site_name"===r){var l=[],i=[];e.forEach((function(e){l.push(Dl[e]),i.push(e)})),a.push({name:"site_ids",data:l}),M(Object(d.a)(Object(d.a)({},I),{},{[r]:i}))}}})),n&&M({}),w(a)},customSearchRender:function(e,t,a,n){var l=e||"";L&&(l=R,F(!1));return r.a.createElement(Al,{searchText:e,onSearch:t,onHide:function(){a(),F(!1)},options:n,onSearchClick:function(){return Y(l)}})}},ve=[{name:"ts_posted",label:"Date Posted",options:{filter:!1,customBodyRender:function(e){return X()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"detail",label:"Details",options:{filter:!1}},{name:"reporter",label:"Reporter",options:{filter:!0,customBodyRender:function(e,t){var a=t.rowIndex,n=c[a];return"".concat(n.issue_reporter.first_name," ").concat(n.issue_reporter.last_name)}}},{name:"ts_expiration",label:"Posted Until",options:{filter:!1,sort:!1,customBodyRender:function(e){return null===e?"-":X()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"resolved_by",label:"Resolved By",options:{filter:!1,customBodyRender:function(e){return null===e?"-":e}}},{name:"resolution",label:"Resolution",options:{filter:!1,customBodyRender:function(e){return null===e?"-":e}}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=c[a],l=n.ts_expiration,i=n.resolution;return X()(l).isAfter(X()())||null!==i?"Finished":function(e,t){var a=t.setChosenIssueReminder,n=t.setIsOpenIssueReminderModal,l=t.setToResolve,i=t.setIsIandRUpdateNeeded,c=e.ts_resolved,o=e.ts_expiration,s=X()().isBefore(o)||null===o,m=null===c&&(s||null===o);return r.a.createElement("span",null,s&&r.a.createElement(H.a,{tooltip:"Edit",style:{float:"left"},onClick:function(t){a(e),n(!0),i(!0),l(!1)}},r.a.createElement(gl.a,{style:{fontSize:20}})),m&&r.a.createElement(H.a,{tooltip:"Delete",style:{float:"left"},onClick:function(t){a(e),n(!0),i(!0),l(!0)}},r.a.createElement(El.a,{style:{fontSize:20}})),!s&&!m&&"Finished")}(n,{setChosenIssueReminder:te,setIsOpenIssueReminderModal:Z,isOpenIssueReminderModal:Q,setToResolve:me,setIsIandRUpdateNeeded:le})}}}],he=Object(K.c)("md",t),_e=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Post an Issue or reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:fe("is_issue_reminder_modal_open",!0)},r.a.createElement(se.a,{style:{paddingRight:4,fontSize:20}}),"Post an Issue / Reminder"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Issues and Reminders",customButtons:!!he&&_e})),r.a.createElement(Me.a,{open:W,fullWidth:!0},r.a.createElement(Te.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(fl.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(v.a,{className:a.paperContainer},r.a.createElement(br.a,{theme:Ml},r.a.createElement(dr.a,{title:"Issues and Reminders",data:c,columns:ve,options:Ee})))),r.a.createElement(zn,{isOpen:Q,closeHandler:fe("is_issue_reminder_modal_open",!1),isIandRUpdateNeeded:re,setIsIandRUpdateNeeded:le,chosenIssueReminder:ee,toResolve:oe,setToRefresh:be,toRefresh:pe}))})),Tl=a(511),Hl=a.n(Tl),Rl=a(116),Yl=a.n(Rl),Bl=Object(pr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Pl=Object(K.a)()((function(e){var t=e.width,a=e.isLoading,l=e.columns,i=e.type,c=e.datas,s=e.shift_start_ts,m=Object(n.useState)(c),u=Object(o.a)(m,2),p=u[0],b=u[1],f=Object(n.useState)([]),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Yl()(p).groupBy("site_name").map((function(e,t){return t})).value().length;Object(n.useEffect)((function(){l.map((function(e,t){switch(e.name){case"ewi_sms":e.options=Object(d.a)(Object(d.a)({},e.options),{},{customBodyRender:function(e,t){var a=t.tableData,n=t.rowIndex,l=X()(a[n].ts_limit_start),c=X()(e);h>5?l.add(h,"minutes"):l.add(5,"minutes"),"Lowering"===i&&l.add(15,"minutes");var o=c>l;return r.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"Routine"!==i:e.options=Object(d.a)(Object(d.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,c=X()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),o=X()(n[l].ts_limit_start).add(10,"minutes"),s=X()(e);h>5&&(o=c.add(2*h,"minutes")),"Lowering"===i&&o.add(15,"minutes");var m=s>o;return r.a.createElement("span",{style:{color:m?"red":""}},e)}});break;case"rainfall_info":e.options=Object(d.a)(Object(d.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,i=X()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),c=X()(i).add(15,"minutes"),o=X()(e)>c;return r.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"ground_measurement":e.options=Object(d.a)(Object(d.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,i=X()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),c=X()(i).subtract(2.5,"hours"),o=X()(i).subtract(2,"hours"),s=X()(e),m=!!(s>=c&&s<=o);return r.a.createElement("span",{style:{color:m?"red":""}},e)}})}})),v(l)}),[l,c]);var _={textLabels:{body:{noMatch:"No ".concat(i," event(s)")}},responsive:Object(K.c)(t,"xs")?"standard":"vertical",filter:!0,selectableRows:"none",print:!0,download:!0,downloadOptions:{filename:"".concat(i,"_releases_").concat(s,".csv"),separator:";"},filterType:"dropdown",onTableChange:function(e,t){"resetFilters"===e&&b(c),"propsUpdate"===e&&b(c)}};return r.a.createElement("div",null,r.a.createElement(br.a,{theme:Bl},r.a.createElement(dr.a,{title:r.a.createElement("div",null,r.a.createElement(y.a,{variant:"h5",component:"div"},i," releases",a&&r.a.createElement(j.a,{size:24,style:{marginLeft:15,position:"relative",top:4}}))),data:p,columns:E,options:_})))})),Ll=Object(O.a)((function(e){return{root:{width:"100%"}}}));function Fl(e){var t=Ll(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Pl,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Event",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}var zl=Object(O.a)((function(e){return{root:{width:"100%"}}}));function Ul(e){var t=zl(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Pl,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Lowering",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}var Wl=Object(O.a)((function(e){return{root:{width:"100%"}}}));function Gl(e){var t=Wl(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Pl,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Extended",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}var ql=Object(O.a)((function(e){return{root:{width:"100%"}}}));function Vl(e){var t=ql(),a=e.releasesData,n=e.isLoading,l=e.shift_start_ts;return r.a.createElement("div",{className:t.root},r.a.createElement(Pl,{isLoading:n,tableTitle:"QA for Routine Monitoring",type:"Routine",shift_start_ts:l,datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}var Ql=Object(O.a)((function(e){return{root:{width:"100%"}}}));function Zl(e){var t=Ql(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Pl,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Raising",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}var Kl=Object(O.a)((function(e){return Object(d.a)(Object(d.a)({},Object(F.d)(e)),{},{root:{display:"flex",flexGrow:1},content:{flexGrow:1,padding:e.spacing(3),overFlowY:"auto"}})}));function Jl(e){var t=e.isStart,a="No available data for QA";return"undefined"!==t&&t&&(a="Select shift to generate data for QA"),r.a.createElement(v.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var Xl=function(e){var t=e.selectedTab,a=e.eventData,n=e.loweringData,l=e.extendedData,i=e.routineData,c=e.raisingData;return[r.a.createElement(Fl,Object.assign({releasesData:a},e)),r.a.createElement(Ul,Object.assign({releasesData:n},e)),r.a.createElement(Gl,Object.assign({releasesData:l},e)),r.a.createElement(Vl,Object.assign({releasesData:i},e)),r.a.createElement(Zl,Object.assign({releasesData:c},e))][t]};function $l(){var e=Kl(),t=Object(n.useState)(0),a=Object(o.a)(t,2),l=a[0],i=a[1],c=X()(),s=c.hour(),m=Object(n.useState)(c.format("YYYY-MM-DD")),u=Object(o.a)(m,2),d=u[0],b=u[1],f=Object(n.useState)(s>=10&&s<=22?"am":"pm"),E=Object(o.a)(f,2),v=E[0],h=E[1],y=Object(n.useState)(!1),O=Object(o.a)(y,2),x=O[0],S=O[1],k=Object(n.useState)(null),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)([]),H=Object(o.a)(T,2),R=H[0],B=H[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)([]),W=Object(o.a)(U,2),G=W[0],q=W[1],V=Object(n.useState)([]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=function(e){b(e)};return Object(n.useEffect)((function(){null!==w&&(w.raising.length>0&&te(w.raising),w.event.length>0&&B(w.event),w.routine.length>0&&z(w.routine),w.extended.length>0&&q(w.extended),w.lowering.length>0&&K(w.lowering),S(!1))}),[w]),Object(n.useEffect)((function(){var e=[R.length,Z.length,G.length,F.length,ee.length];i(e.indexOf(Math.max.apply(Math,e)))}),[R,F,Z,G,ee]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.pageContentMargin},r.a.createElement(ge,{title:"Alert Monitoring | Quality Assurance"})),r.a.createElement("div",{className:e.pageContentMargin},r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:2,item:!0,xs:12,style:{marginBottom:8}},[{label:"Shift Start",value:d,id:"start_ts"}].map((function(t){var a=t.id;return r.a.createElement(_.a,{item:!0,xs:12,sm:!0,key:a,className:e.inputGridContainer},Xr(t,ae))})),r.a.createElement(_.a,{item:!0,xs:12,sm:!0},r.a.createElement(Ea,{div_id:"shift_time",label:"Shift Time",changeHandler:function(e){return h(e.target.value)},value:v,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"right"},r.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){S(!0);var e=function(e,t){var a=e.shift_time,n=e.start_ts,r="am"===a?"08:00:00":"20:00:00",l=X()(n).format("YYYY-MM-DD ".concat(r)),i="".concat(We.b,"/api/monitoring/get_monitoring_releases_for_qa/").concat(l);return it.a.get(i).then((function(e){var a=e.data;console.log("Releases",a),t(a)})).catch((function(e){console.error("Problem in Axios request"),console.error(e)})),l}({start_ts:d,shift_time:v},A);N(e)},endIcon:r.a.createElement(Hl.a,{className:e.button})},"Generate")))),null!==w&&0!==w.length?r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,sm:!0,container:!0,justify:"flex-end"},r.a.createElement(Re.a,null,r.a.createElement(ga.a,{value:l,onChange:function(e){return i(e.target.value)},style:{width:200},autoFocus:!0},r.a.createElement(Y.a,{value:0},"Event (".concat(R.length,")")),r.a.createElement(Y.a,{value:4},"Raising (".concat(ee.length,")")),r.a.createElement(Y.a,{value:1},"Lowering (".concat(Z.length,")")),r.a.createElement(Y.a,{value:2},"Extended (".concat(G.length,")")),r.a.createElement(Y.a,{value:3},"Routine (".concat(F.length,")"))),r.a.createElement(g.a,null,"Select monitoring type to display"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Xl,{routineData:F,eventData:R,loweringData:Z,extendedData:G,raisingData:ee,isLoading:x,shift_start_ts:M,selectedTab:l}))):r.a.createElement(_.a,{item:!0,xs:12,align:"center"},x?r.a.createElement(j.a,null):null!==M&&null!==w&&0===w.length?r.a.createElement(Jl,null):r.a.createElement(Jl,{isStart:!0})))))}var ei=a(861),ti=a(862),ai=a(97),ni=a.n(ai),ri=a(307),li=a.n(ri),ii=a(46),ci=a.n(ii),oi=a(29),si=a.n(oi),mi=a(190),ui=a.n(mi),di=a(454),pi=a(453),bi=a(830),fi=a(853),gi=a(854),Ei=a(852),vi=a(855),hi=a(512),_i=a.n(hi),yi=a(850);function Oi(e,t){var a="".concat(We.b,"/api/analysis/get_latest_data_presence/").concat(e);it.a.get(a).then((function(a){var n=a.data;console.log("Data Presence: ".concat(e),n),t(n)})).catch((function(e){console.error(e)}))}function ji(e,t){var a=e.subsurface_column,n=e.ts_end,r=e.ts_start,l=e.node_id;console.log("node level input",e);var i="".concat(We.b,"/api/subsurface/get_subsurface_node_level/").concat(a,"/").concat(n,"/").concat(r,"/").concat(l);it.a.get(i).then((function(e){var a=e.data;console.log("Subsurface Node Level Data",a),t(a)})).catch((function(e){console.error(e)}))}function xi(e,t){var a="".concat(We.b,"/api/analysis/save_chart_svg");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save SVG",a),t(a)})).catch((function(e){console.error(e)}))}function Si(e,t){var a="".concat(We.b,"/api/monitoring/get_monitoring_analytics_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Monitoring analytics data",a),t(a)})).catch((function(e){console.error(e)}))}function ki(e,t){var a=[];return t.forEach((function(t){var n,r=t.dataset_name,l=function(e){var t=e.dataset_name,a=e.dataset;return"velocity_acceleration"===t?a.forEach((function(e,t){var n=e.name;"Trend Line"===n?a[t]=Object(d.a)(Object(d.a)({},a[t]),{},{type:"spline"}):"Threshold Interval"===n?a[t]=Object(d.a)(Object(d.a)({},a[t]),{},{type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,color:"#FFEB32"}):"Last Data Point"===n&&(a[t]=Object(d.a)(Object(d.a)({},a[t]),{},{marker:{symbol:"asterisk",lineColor:"#ff9e32",lineWidth:4}}))})):"displacement_interpolation"===t?a.forEach((function(e,t){var n=e.name;"Surficial Data"===n?a[t].type="scatter":"Interpolation"===n&&(a[t]=Object(d.a)(Object(d.a)({},a[t]),{},{marker:{enabled:!0,radius:0}}))})):"velocity_acceleration_time"===t&&a.forEach((function(e,t){var n=e.name;"Velocity"===n?a[t].yAxis=0:"Acceleration"===n&&(a[t].yAxis=1)})),a}(t);if("velocity_acceleration"===r)n=function(e,t){var a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity Acceleration Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(X()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{title:{text:"<b>Velocity (cm/day)</b>"}},yAxis:{title:{text:"<b>Acceleration (cm/day^2)</b>"}},tooltip:{headerFormat:"",shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1}}}(l,e);else if("displacement_interpolation"===r)n=function(e,t){var a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"spline",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Displacement Interpolation Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(X()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},tooltip:{crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}},scatter:{tooltip:{pointFormat:"Date/Time: <b>{point.x:%A, %e %b, %H:%M:%S}</b><br>Displacement: <b>{point.y:.2f}</b>"}}},credits:{enabled:!1}}}(l,e);else if("velocity_acceleration_time"===r){var i=l.findIndex((function(e){return"Timestamps"===e.name})),c=JSON.parse(JSON.stringify(l)),s=c.splice(i,1);n=function(e,t,a){var n=a.site_code,r=a.marker_name,l=a.ts;return{series:e,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity & Acceleration vs Time Chart of ".concat(n.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(r,"</b><br/>Timestamp: <b>").concat(X()(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{categories:t,type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},labels:{formatter(){return X()(this.value).format("D MMM")}},title:{text:"<b>Time (Days)</b>"}},yAxis:[{title:{text:"<b>Velocity (cm/day)</b>",style:{color:si.a.getOptions().colors[1]}}},{title:{text:"<b>Acceleration (cm/days^2)</b>",style:{color:si.a.getOptions().colors[0]}},labels:{style:{color:si.a.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!1}}},credits:{enabled:!1}}}(c,Object(o.a)(s,1)[0].data,e)}a.push(n)})),a}_i()(si.a),si.a.SVGRenderer.prototype.symbols.asterisk=function(e,t,a,n){return["M",e-3,t-3,"L",e+a+3,t+n+3,"M",e+a+3,t-3,"L",e-3,t+n+3,"M",e-4,t+n/2,"L",e+a+4,t+n/2,"M",e+a/2,t-4,"L",e+a/2,t+n+4,"z"]},si.a.VMLRenderer&&(si.a.VMLRenderer.prototype.symbols.asterisk=si.a.SVGRenderer.prototype.symbols.asterisk);var Ci=function(e){var t=e.siteCode,a=e.generateTrending,l=e.setShowTrending,i=e.setGenerateTrending,c=e.chosenPoint,s=r.a.useRef(null),m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],b=u[1],f=Object(n.useState)([]),g=Object(o.a)(f,2),E=g[0],h=g[1],y=Object(n.useState)(!1),O=Object(o.a)(y,2),j=O[0],x=O[1],S=c.ts,k=c.name,C={site_code:t,ts:X()(S).format("YYYY-MM-DD HH:ss:mm"),marker_name:k};return Object(n.useEffect)((function(){a&&(x(!0),function(e,t){var a=e.site_code,n=e.marker_name,r=e.ts,l="".concat(We.b,"/api/surficial/get_surficial_marker_trending_data/")+"".concat(a,"/").concat(n,"/").concat(r);it.a.get(l).then((function(e){var a=e.data;console.log("Surficial Marker Trending Data",a),t(a)})).catch((function(e){console.error(e)}))}(C,(function(e){var t=e.has_trend,a=e.trending_data,n=t?Object(Xe.a)(a):[];b(n),i(!1),x(!1)})))}),[a]),Object(n.useEffect)((function(){if(0!==d.length){var e=function(e,t,a){return ki(e,t).map((function(e){return r.a.createElement(ci.a,{highcharts:si.a,options:e,ref:a})}))}(C,d,s);h(e)}}),[d]),r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),j?r.a.createElement(_.a,{item:!0,xs:12,style:{marginTop:16}},r.a.createElement(fl.a,{variant:"query",style:{height:8}})):r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",onClick:function(){return l(!1)},color:"primary",size:"small",endIcon:r.a.createElement(yi.a,null)},"Hide")),r.a.createElement(_.a,{container:!0,item:!0,xs:12,justify:"center",spacing:1},0!==d.length?E.map((function(e,t){return r.a.createElement(_.a,{item:!0,xs:12,sm:6,key:t},r.a.createElement(v.a,null,e))})):r.a.createElement(v.a,{component:_.a,container:!0,item:!0,alignItems:"center",justify:"center",style:{height:"20vh",padding:60,background:"gainsboro",border:"4px solid #CCCCCC"}},"Selected data has no trend."))))},wi=a(851),Ai=function(e){return function(t){t.preventDefault(),e.push("/analysis/sites"),e.replace("/analysis/sites")}};var Di=function(e){var t=e.width,a=e.history;return Object(K.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:Ai(a)},r.a.createElement(wi.a,{style:{fontSize:16}})," Back to site list"):r.a.createElement(H.a,{variant:"contained",color:"primary",size:"small",onClick:Ai(a),style:{marginLeft:6}},r.a.createElement(wi.a,null))},Ii=[{label:"3 days",unit:"days",duration:3},{label:"7 days",unit:"days",duration:7},{label:"10 days",unit:"days",duration:10},{label:"2 weeks",unit:"weeks",duration:2},{label:"1 month",unit:"months",duration:1},{label:"3 months",unit:"months",duration:3},{label:"6 months",unit:"months",duration:6},{label:"1 year",unit:"years",duration:1},{label:"All",unit:"all",duration:0}],Mi=[{label:"4 hours",hour_value:4},{label:"8 hours",hour_value:8},{label:"12 hours",hour_value:12},{label:"1 day",hour_value:24}];var Ni=function(e){var t=e.isSubsurface,a=e.selectedRangeInfo,l=e.setSelectedRangeInfo,i=e.selectedHourInterval,c=e.setSelectedHourInterval,s=e.disableAll,m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],b=u[1],f=Object(n.useState)(null),g=Object(o.a)(f,2),E=g[0],v=g[1],h="undefined"!==typeof s&&s,_="undefined"!==typeof t&&t,y="";if(i){var O=i.label;y=O}var j=function(e){v(e.currentTarget)},x=function(){v(null)};return r.a.createElement("div",null,_&&r.a.createElement(n.Fragment,null,r.a.createElement(xe.a,{title:"Select time interval",arrow:!0},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:j,style:{marginRight:6},endIcon:r.a.createElement(Ei.a,null)},y)),r.a.createElement(R.a,{id:"simple-menu",anchorEl:E,keepMounted:!0,open:Boolean(E),onClose:x},Mi.map((function(e,t){var a=e.label;return r.a.createElement(Y.a,{key:"hour_interval_".concat(t),onClick:function(){return c(e),void v(null)}},a)})))),r.a.createElement(xe.a,{title:"Select date range",arrow:!0},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){b(e.currentTarget)},style:{marginRight:_?8:0},endIcon:r.a.createElement(Ei.a,null)},a.label)),r.a.createElement(R.a,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:function(){b(null)}},Ii.map((function(e,t){var a=e.label;return"all"===e.unit&&h?null:r.a.createElement(Y.a,{key:"date_range_".concat(t),onClick:function(){return l(e),void b(null)}},a)}))))};function Ti(e,t){return r.a.createElement(p.a,{color:"primary",onClick:function(){e(t)}},"Dismiss")}function Hi(e){var t=e.fullScreen,a=e.open,l=e.setIsOpen,i=e.selectedMarker,s=e.historicalMarkers,m=e.addNewMarker,u=e.siteCode,d=e.setRedrawChart,b=e.history,g=e.match.url,E=null,v=null;if(null!==i){var h=i.marker_id,O=i.marker_name;E=h,v=O}var j=Object(c.b)(),x=j.enqueueSnackbar,S=j.closeSnackbar,k=Object(n.useState)(""),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(""),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)(""),P=Object(o.a)(B,2),L=P[0],F=P[1],z=function(){l(!1),N(null),Y(""),q(null),A(""),F("")},U=Object(n.useState)(null),W=Object(o.a)(U,2),G=W[0],q=W[1],V=function(){""===R&&q("Required field")};Object(n.useEffect)((function(){""!==R?/[^a-zA-Z]/.test(R)?q("Enter alphabet characters only."):s.includes(R)?q("Marker name already exists."):q(null):q("")}),[R]);var Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1];return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},m?"Add new marker":"Add event to Marker ".concat(v)),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,m?"Choose a new marker name then submit.":"Choose a marker event then answer the corresponding field(s)."),r.a.createElement(Re.a,{component:"fieldset",style:{display:"flex"}},!m&&r.a.createElement(Ye.a,{"aria-label":"marker_event",name:"marker_event",row:!0,style:{justifyContent:"space-around"},value:w,onChange:function(e){A(e.target.value),N(null),Y(""),q(null),F("")}},r.a.createElement(Be.a,{value:"reposition",control:r.a.createElement(Pe.a,null),label:"Reposition"}),r.a.createElement(Be.a,{value:"rename",control:r.a.createElement(Pe.a,null),label:"Rename"}),r.a.createElement(Be.a,{value:"decommission",control:r.a.createElement(Pe.a,null),label:"Decommission"})),r.a.createElement(_.a,{container:!0,spacing:2,style:{marginTop:8}},""!==w&&r.a.createElement(_.a,{item:!0,xs:12,sm:!0},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Timestamp",value:M,onChange:function(e){return N(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),("rename"===w||m)&&r.a.createElement(_.a,{item:!0,xs:12,sm:!0},r.a.createElement(f.a,{error:Boolean(G),label:"New Marker Name",value:R,onChange:function(e){return Y(e.target.value.toUpperCase())},onBlur:V,type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:1},placeholder:"Input a letter",helperText:G||""})),(""!==w||m)&&r.a.createElement(_.a,{item:!0,xs:12,sm:12},r.a.createElement(f.a,{label:"Remarks",value:L,onChange:function(e){return F(e.target.value)},onBlur:V,type:"text",multiline:!0,rowsMax:3,fullWidth:!0,inputProps:{maxLength:1500},placeholder:"Input remarks"})))),K&&r.a.createElement(_.a,{container:!0,spacing:2,style:{marginTop:12}},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},"Are you sure submitting this data?")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)))),r.a.createElement(Le.a,null,K&&r.a.createElement(p.a,{onClick:function(){return J(!1)}},"Go Back"),r.a.createElement(p.a,{variant:K?"contained":"text",color:"secondary",onClick:function(){var e=!0;if(("reposition"!==w||m)&&(e=!1,K?(e=!0,J(!1)):J(!0)),e){z();var t=m?"add":w,a=m?X()():M;!function(e,t){var a="".concat(We.b,"/api/surficial/insert_marker_event");it.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}({site_code:u,event:t,marker_id:E,ts:X()(a).format("YYYY-MM-DD HH:mm:ss"),marker_name:R,remarks:""===L?null:L},(function(e){var a=e.status,n="Error inserting new marker event...";m&&(n="Error creating new marker..."),"success"===a&&(n="Inserting new marker event successful!",m&&(n="Creating new marker successful!"),d(!0),["add","rename"].includes(t)&&b.push("".concat(g,"/").concat(R))),x(n,{variant:a,autoHideDuration:7e3,action:function(e){return Ti(S,e)}})}))}}},"Submit"),!K&&r.a.createElement(p.a,{onClick:z},"Cancel")))}function Ri(e){var t=e.markerInfo,a=e.markerName,n=[{name:"ts",label:"Timestamp",options:{filter:!1,customBodyRender:e=>X()(e).format("D MMMM YYYY, HH:mm"),sort:!0}},{name:"event",label:"Event"},{name:"m_name",label:"Name",options:{filter:!1}},{name:"remarks",label:"Remarks",options:{filter:!1,display:!1}}],l={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",expandableRows:!0,expandableRowsHeader:!1,expandableRowsOnClick:!0,renderExpandableRow:function(e,t){var a=e.length+1,n=e[3];return r.a.createElement(di.a,null,r.a.createElement(pi.a,{colSpan:a,align:"justify"},r.a.createElement("strong",null,"Remarks:")," ",n))},rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",customSort:(e,t,a)=>e.sort((function(e,n){return 0===t?(X()(e.data[t]).isAfter(n.data[t])?-1:1)*("desc"===a?1:-1):(e.data[t]<n.data[t]?-1:1)*("desc"===a?1:-1)}))},i=[];return t&&(i=t.marker_history.map((function(e){var t=e.ts,a=e.event,n=e.marker_name,r=e.remarks,l=n?n.marker_name:"---";return{event:ot(a),m_name:l,ts:t,remarks:r||"None"}}))),r.a.createElement(dr.a,{title:"Marker ".concat(a," History"),columns:n,options:l,data:i})}function Yi(e){var t=e.editModal,a=e.fullScreen,l=e.setEditModal,i=e.siteCode,s=e.setRedrawChart,m=e.chosenPoint,u=t.is_open,b=t.ts,g=t.name,E=t.measurement,v=t.mo_id,h=t.data_id,O=m.ts,j=m.measurement,x=Object(c.b)(),S=x.enqueueSnackbar,k=x.closeSnackbar,C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],D=w[1],I=Object(n.useState)("one"),M=Object(o.a)(I,2),N=M[0],T=M[1];Object(n.useEffect)((function(){D(!1)}),[u]);var H=function(e,a){return function(n){var r=a;"ts"===e?r=n:"measurement"===e&&(r=n.target.value),l(Object(d.a)(Object(d.a)({},t),{},{[e]:r}))}};return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:a,open:u,"aria-labelledby":"form-dialog-title",TransitionComponent:a?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Update surficial data"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Carefully edit the necessary fields or delete entries if needed."),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"subtitle1",style:{fontWeight:"bold"}},i.toUpperCase()," - Marker ",g),r.a.createElement(y.a,{variant:"body2"},"Timestamp: ",X()(O).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(y.a,{variant:"body2"},"Measurement: ",j," cm")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"EDIT")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Change marker data measurement",value:E,onChange:H("measurement"),type:"number",fullWidth:!0,required:!0})),r.a.createElement(_.a,{item:!0,xs:12},"Change observation timestamp (applies to the rest of the points)"),r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Observation Timestamp",value:X()(b),onChange:H("ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:function(){var e={};O!==b&&(e=Object(d.a)(Object(d.a)({},e),{},{mo_id:v,ts:X()(b).format("YYYY-MM-DD HH:mm:ss")})),j!==E&&(e=Object(d.a)(Object(d.a)({},e),{},{data_id:h,measurement:E})),l(Object(d.a)(Object(d.a)({},t),{},{is_open:!1})),0!==Object.keys(e).length&&function(e,t){var a="".concat(We.b,"/api/surficial/update_surficial_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Update Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t="Error updating surficial data...",a="error";"success"===e.status&&(t="Surficial data update successful!",a="success",s(!0)),S(t,{variant:a,autoHideDuration:7e3,action:function(e){return Ti(k,e)}})}))}},"Update Data")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"DELETE")),r.a.createElement(_.a,{item:!0,xs:12},"Be careful on deleting marker data. Delete only IF REALLY NEEDED."),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Re.a,{component:"fieldset"},r.a.createElement(Ye.a,{"aria-label":"gender",name:"gender1",value:N,onChange:function(e){return T(e.target.value)}},r.a.createElement(Be.a,{value:"one",control:r.a.createElement(Pe.a,null),label:"Delete measurement of this marker only"}),r.a.createElement(Be.a,{value:"all",control:r.a.createElement(Pe.a,null),label:"Delete all measurements from given marker observation"})))),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:function(){return D(!0)}},"Delete Data")),A&&r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(bi.a,{variant:"contained",size:"small",color:"secondary","aria-label":"small contained button group"},r.a.createElement(p.a,{disabled:!0},"Are you sure?"),r.a.createElement(p.a,{onClick:function(){var e=t.data_id,a=t.mo_id,n=e;"all"===N&&(n=a);var r={quantity:N,id:n};l(Object(d.a)(Object(d.a)({},t),{},{is_open:!1})),function(e,t){var a="".concat(We.b,"/api/surficial/delete_surficial_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Delete Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(r,(function(e){var t="Error deleting surficial data...",a="error";"success"===e.status&&(t="Surficial data delete successful!",a="success",s(!0)),S(t,{variant:a,autoHideDuration:7e3,action:function(e){return Ti(k,e)}})}))}},"Yes"),r.a.createElement(p.a,{onClick:function(){return D(!1)}},"No"))))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:H("is_open",!1)},"Cancel")))}function Bi(e){var t,a,l=e.surficialDataTagModal,i=e.setSurficialDataTagModal,s=e.siteCode,m=e.setRedrawChart,u=l.is_open,b=l.ts,g=l.name,E=l.measurement,v=l.data_id,h=l.unreliable_data,O=Object(x.a)().user_id,j=Object(n.useState)(""),S=Object(o.a)(j,2),k=S[0],C=S[1],w=Object(c.b)(),A=w.enqueueSnackbar,D=w.closeSnackbar,I=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){D(e)}},"Dismiss")};return r.a.createElement(Me.a,{open:u,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},h?"Unreliable data tag information":"Tag unreliable data"),r.a.createElement(Te.a,null,r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"subtitle1",style:{fontWeight:"bold"}},s.toUpperCase()," - Marker ",g),r.a.createElement(y.a,{variant:"body2"},"Timestamp: ",X()(b).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(y.a,{variant:"body2"},"Measurement: ",E," cm")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},h?r.a.createElement(_.a,{container:!0,justify:"center"},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Tagger:")),r.a.createElement(y.a,{variant:"body1",gutterBottom:!0},"".concat(h.tagger.first_name," ").concat(h.tagger.last_name))),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Timestamp:")),r.a.createElement(y.a,{variant:"body1",gutterBottom:!0},X()(h.ts).format("DD MMMM YYYY, HH:mm:ss"))),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"body1"},r.a.createElement("strong",null,"Remarks:")),r.a.createElement(y.a,{variant:"body1"},h.remarks))):r.a.createElement(f.a,{label:"Remarks",value:k,onChange:function(e){return C(e.target.value)},fullWidth:!0,required:!0,error:""===k,helperText:k?"":"Required"})))),r.a.createElement(Le.a,null,!h&&r.a.createElement(p.a,{variant:"contained",color:"secondary",size:"small",onClick:function(){!function(e,t){var a="".concat(We.b,"/api/surficial/save_unreliable_marker_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save unreliable data",a),t(a)})).catch((function(e){console.error(e)}))}({data_id:v,tagger_id:O,remarks:k},(function(e){var t,a=e.status,n=e.message;!0===a?(m(!0),i(Object(d.a)(Object(d.a)({},l),{},{is_open:!1})),t="success",C("")):t="error",A(n,{variant:t,autoHideDuration:5e3,action:I})}))},disabled:""===k},"Save"),r.a.createElement(p.a,{color:"primary",onClick:(t="is_open",a=!1,function(e){i(Object(d.a)(Object(d.a)({},l),{},{[t]:a}))})},"Cancel")))}function Pi(e){var t=e.setIsOpenClickModal,a=e.open,n=e.chosenPoint,l=e.setEditModal,i=e.setShowTrending,c=e.setGenerateTrending,o=e.setSurficialDataTagModal,s=n.ts,m=n.measurement,u=n.name,p=n.unreliable_data,b=function(){t(!1)},f=function(e){return function(t){b(),o(Object(d.a)(Object(d.a)({},n),{},{is_open:!0,type:e}))}};return r.a.createElement(Me.a,{onClose:b,"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(Ne.a,{id:"simple-dialog-title"},"Point options"),r.a.createElement(Te.a,null,r.a.createElement("div",{align:"center"},r.a.createElement(y.a,{variant:"subtitle1",style:{fontWeight:"bold"}},"Marker ",u),r.a.createElement(y.a,{variant:"body2"},"Timestamp: ",X()(s).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(y.a,{variant:"body2"},"Measurement: ",m," cm"))),r.a.createElement(hn.a,null,r.a.createElement(yn.a,{button:!0,onClick:function(){b(),l(Object(d.a)(Object(d.a)({},n),{},{is_open:!0}))}},r.a.createElement(jn.a,null,r.a.createElement(gl.a,null)),r.a.createElement(On.a,{primary:"Edit/Delete data"})),r.a.createElement(yn.a,{button:!0,onClick:function(){b(),i(!0),c(!0)}},r.a.createElement(jn.a,null,r.a.createElement(fi.a,null)),r.a.createElement(On.a,{primary:"Generate trending chart"})),!1===p?r.a.createElement(yn.a,{button:!0,onClick:f("tag")},r.a.createElement(jn.a,null,r.a.createElement(gi.a,null)),r.a.createElement(On.a,{primary:"Tag data as unreliable"})):r.a.createElement(yn.a,{button:!0,onClick:f("show")},r.a.createElement(jn.a,null,r.a.createElement(Hr.a,null)),r.a.createElement(On.a,{primary:"Show unreliable tag info"}))))}function Li(e){var t=e.width,a=e.url,l=e.selectedMarker,i=e.surficialData,c=e.setIsOpenAddEventModal,m=e.setAddNewMarker,u=Object(n.useState)(null),d=Object(o.a)(u,2),b=d[0],f=d[1],g=function(){f(null)},E=Object(K.b)(t,"sm")&&i.length<=5;return r.a.createElement(n.Fragment,null,r.a.createElement(bi.a,{variant:"contained",color:"primary",size:"small","aria-label":"Site markers button group",style:{marginRight:6}},r.a.createElement(p.a,{disabled:!0,style:{color:"#000000"}},"Marker"),E?i.map((function(e){var t=e.marker_name,n=e.marker_id;return r.a.createElement(p.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n},t)})):r.a.createElement(p.a,{color:"primary",variant:"contained",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){f(e.currentTarget)},endIcon:r.a.createElement(Ei.a,null)},l?l.marker_name:"Select"),r.a.createElement(xe.a,{title:"Add a new marker",onClick:function(){m(!0),c(!0)},arrow:!0},r.a.createElement(p.a,null,r.a.createElement(vi.a,null)))),r.a.createElement(R.a,{id:"simple-menu",anchorEl:b,keepMounted:!0,open:Boolean(b),onClose:g},i.map((function(e){var t=e.marker_name,n=e.marker_id;return r.a.createElement(Y.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n,onClick:g},t)}))))}ui()(si.a);var Fi=Object(Fe.a)()((function(e){var t,a=e.width,l=e.location.pathname,i=e.match,c=i.url,s=i.params.site_code,u=e.fullScreen,b=e.disableBack,f=e.disableMarkerList,g=e.saveSVG,E=e.input,h=e.currentUser,y=e.isEndOfShift,O=Object(n.useState)({label:"3 months",unit:"months",duration:3}),j=Object(o.a)(O,2),x=j[0],S=j[1],k=x.unit,C=x.duration,w="";if("undefined"!==typeof E){var A=E.ts_end;w=A,t=X()(A)}else{var D=X()();w=D.format("YYYY-MM-DD HH:mm:ss"),t=D}var I="undefined"!==typeof b&&b,M="undefined"!==typeof f&&f,N="undefined"!==typeof g&&g,T="undefined"!==typeof y&&y,H=dt(t,C,k),R=r.a.useRef(null),Y={start:H,end:w},B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],z=Object(n.useState)(null),U=Object(o.a)(z,2),W=U[0],G=U[1],q=Object(n.useState)(!1),V=Object(o.a)(q,2),Q=V[0],Z=V[1],J=Object(n.useState)(!1),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=Object(n.useState)(!0),ne=Object(o.a)(ae,2),re=ne[0],le=ne[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=Object(n.useState)(!1),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(!1),fe=Object(o.a)(be,2),ge=fe[0],Ee=fe[1],ve=Object(n.useState)(!1),he=Object(o.a)(ve,2),_e=he[0],ye=he[1],Oe=Object(n.useState)(!1),je=Object(o.a)(Oe,2),xe=je[0],Se=je[1],ke={data_id:null,mo_id:null,name:null,ts:null,measurement:0},Ce=Object(n.useState)(Object(d.a)({},ke)),we=Object(o.a)(Ce,2),Ae=we[0],De=we[1],Ie=Object(n.useState)(Object(d.a)(Object(d.a)({},ke),{},{is_open:!1})),Me=Object(o.a)(Ie,2),Ne=Me[0],Te=Me[1],He=Object(n.useState)(Object(d.a)(Object(d.a)({},ke),{},{is_open:!1})),Re=Object(o.a)(He,2),Ye=Re[0],Be=Re[1];Object(n.useEffect)((function(){le(!0)}),[x]),Object(n.useEffect)((function(){var e=R.current;((null!==e||re)&&e.chart.showLoading(),re)&&(!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.site_code,r=e.start,l=e.end,i="".concat(We.b,"/api/surficial/get_surficial_plot_data/")+"".concat(n,"/").concat(r,"/").concat(l);a&&(i+="?is_end_of_shift=true"),it.a.get(i).then((function(e){var a=e.data;console.log("Surficial Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(Object(d.a)({site_code:s},Y),(function(t){(F(t),null!==e)&&(e.chart.hideLoading(),N&&te(!0))}),T),le(!1))}),[re]),Object(n.useEffect)((function(){if(!Q&&0!==L.length){var e=[];L.forEach((function(t){t.marker_history.forEach((function(t){var a=t.marker_name;a&&e.push(a.marker_name)}))})),Z(e)}}),[Q,L]),Object(n.useEffect)((function(){if(0!==L.length){var e=Object(m.f)(l,{path:"".concat(c,"/:marker_name"),exact:!0});if(e){var t=e.isExact,a=e.params.marker_name;if(t){var n=L.find((function(e){return e.marker_name===a}));"undefined"!==typeof n&&G(n)}}}}),[l,L]),Object(n.useEffect)((function(){var e=R.current.chart.getSVGForExport();ee&&xi({user_id:h.user_id,site_code:s,chart_type:"surficial",svg:e},(function(e){}))}),[ee]),Object(n.useEffect)((function(){var e=R.current.chart;W&&(e.series.forEach((function(e){var t=W.marker_name===e.name;e.setVisible(t,!1)})),e.redraw(),e.reflow())}),[W]);var Pe=function(e,t){return r.a.createElement(ci.a,{highcharts:si.a,options:e,ref:t})}(function(e,t,a,n,r,l){var i=e.site_code,c=e.timestamps,o=c.start,s=c.end,m=X()(o,"YYYY-MM-DD HH:mm:ss"),u=X()(s,"YYYY-MM-DD HH:mm:ss"),d=Object(K.b)(a,"sm")?"1rem":"0.90rem",p="As of: <b>".concat(X()(u).format("D MMM YYYY, HH:mm"),"</b>");l||(p+="<br/><i>Note: Click data points to access several options.</i>");var b=m;if((l||"None"===o)&&t.length>0){var f=t.reduce((function(e,t){var a=e.data,n=t.data;return 0===a.length?t:0===n.length||a[0].x<n[0].x?e:t}));b=f.data.length>0?X()(f.data[0].x):X()()}return t.forEach((function(e){e.turboThreshold=1e5,e.data.forEach((function(e){var t=e.unreliable_data;if(0!==Object.keys(t).length){e.marker={symbol:"triangle-down",radius:8,fillColor:"#FFFF00",lineColor:"#000000",lineWidth:1}}else e.unreliable_data=!1}))})),{title:{text:"<b>Surficial Data History Chart of ".concat(i.toUpperCase(),"</b>"),style:{fontSize:d},margin:36,y:18},time:{timezoneOffset:-480},series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:24,spacingRight:24},subtitle:{text:p,style:{fontSize:"0.75rem"}},legend:{labelFormatter(){var e=this.userOptions,t=e.marker_name;return 0===e.in_use?"".concat(t," (Defunct)"):t}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},xAxis:{min:Date.parse(b),max:Date.parse(u),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0},dashStyle:"ShortDash"},series:{marker:{radius:3},cursor:"pointer",point:{events:{click(){if(!l){var e=this.data_id,t=this.x,a=this.y,i=this.mo_id,c=this.series.name,o=this.unreliable_data,s={data_id:e,name:c,mo_id:i,ts:X()(t),measurement:a,unreliable_data:o};r(s),n(!0)}}}}}},loading:{showDuration:100,hideDuration:1e3},credits:{enabled:!1}}}({site_code:s,timestamps:Y},L,a,Ee,De,T),R);return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(_.a,{container:!0,item:!0,xs:12,style:{marginBottom:16}},!I&&r.a.createElement(_.a,{item:!0,xs:1,sm:3},r.a.createElement(Di,e)),r.a.createElement(_.a,{item:!0,container:!0,xs:!0,justify:"flex-end"},!M&&L.length>0&&r.a.createElement(Li,Object.assign({},e,{width:a,url:c,selectedMarker:W,surficialData:L,setIsOpenAddEventModal:ye,setAddNewMarker:Se})),r.a.createElement("div",null,r.a.createElement(Ni,{selectedRangeInfo:x,setSelectedRangeInfo:S})))),r.a.createElement(_.a,{item:!0,xs:12,md:W?7:12,lg:W?8:12},r.a.createElement(v.a,{elevation:2},Pe)),r.a.createElement(m.b,{path:"".concat(c,"/:marker_name"),render:function(e){var t=e.match.params.marker_name;return W?r.a.createElement(_.a,{item:!0,xs:12,md:5,lg:4},r.a.createElement(Ri,{markerInfo:W,markerName:t}),r.a.createElement(_.a,{container:!0,justify:"flex-end",style:{marginTop:12}},r.a.createElement(p.a,{variant:"contained",color:"primary",startIcon:r.a.createElement(vi.a,null),onClick:function(){Se(!1),ye(!0)}},"Add New Event"))):""}}),oe&&r.a.createElement(Ci,{siteCode:s,setShowTrending:se,generateTrending:de,setGenerateTrending:pe,chosenPoint:Ae})),r.a.createElement(Pi,{open:ge,setIsOpenClickModal:Ee,chosenPoint:Ae,setEditModal:Te,setShowTrending:se,setGenerateTrending:pe,setSurficialDataTagModal:Be}),r.a.createElement(Yi,{chosenPoint:Ae,editModal:Ne,setEditModal:Te,fullScreen:u,siteCode:s,setRedrawChart:le}),r.a.createElement(Bi,{chosenPoint:Ae,surficialDataTagModal:Ye,setSurficialDataTagModal:Be,fullScreen:u,siteCode:s,setRedrawChart:le}),r.a.createElement(Hi,Object.assign({},e,{siteCode:s,open:_e,setIsOpen:ye,selectedMarker:W,setRedrawChart:le,historicalMarkers:Q,addNewMarker:xe})))}));var zi=function(e){var t=e.isOpen,a=e.closeModalFn,l=e.taggingData,i=e.onTagSuccess,s=Object(x.a)(),m={ts_start:null,ts_end:null};null!==l&&(m=Object(d.a)({},l));var u=Object(n.useState)(!1),b=Object(o.a)(u,2),g=b[0],E=b[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),O=h[0],j=h[1],S=Object(n.useState)(""),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)(!0),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(c.b)(),T=N.enqueueSnackbar,H=N.closeSnackbar;Object(n.useEffect)((function(){M(""===O)}),[O]);var R=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){H(e)}},"Dismiss")},Y=function(){a()};return r.a.createElement(Me.a,{fullWidth:!0,open:t,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Tag invalid rainfall data"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Fill in the required fields then submit. Note: DO NOT TAG ALREADY TAGGED POINTS."),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center"},"Start Timestamp"),r.a.createElement(y.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,m.ts_start))),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center"},"End Timestamp"),r.a.createElement(y.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,g?"Indefinite":m.ts_end))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Be.a,{value:"isIndefinite",control:r.a.createElement(kt.a,{color:"primary",checked:g,onClick:function(e){return E(e.target.checked)}}),label:r.a.createElement("div",null,"Set end timestamp as indefinite\xa0",r.a.createElement(xe.a,{title:"Checking this will show data from start timestamp to latest timestamp and all incoming data as invalid. A script will provide the end timestamp of the invalidated range."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ea,{div_id:"observed-data",label:"Observed Data",list:[{id:-1,label:"Actual rainfall data/observation is lower than recorded"},{id:0,label:"No rainfall observed; Actual data is zero"},{id:1,label:"Actual rainfall data/observation is higher than recorded"}],mapping:{id:"id",label:"label"},required:!0,value:O,error:""===O,changeHandler:function(e){return j(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Remarks",fullWidth:!0,multiline:!0,rowsMax:"3",value:C,onChange:function(e){return w(e.target.value)}})))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{color:"primary",onClick:function(){var e=Object(Rl.cloneDeep)(l);delete e.chart;var t=Object(d.a)(Object(d.a)({tagger_id:s.user_id},e),{},{observed_data:parseInt(O,10),remarks:C||null});g&&(t.ts_end=null),console.log("Submitting invalid tag",t),function(e,t){var a="".concat(We.b,"/api/rainfall/tag_invalid_data");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save tag information",a),t(a)})).catch((function(e){console.error(e)}))}(t,(function(e){var t=e.status,a=e.message;"success"===t&&(Y(),i()),T(a,{variant:t,autoHideDuration:3e3,action:R})}))},disabled:I},"Submit"),r.a.createElement(p.a,{onClick:Y,color:"primary"},"Cancel")))};window.moment=J,ui()(si.a);var Ui={set:{"24h":[],"72h":[],rain:[],null_ranges:[],max_rval:0,max_72h:0,gauge_name:"loading",distance:0,data_source:"loading",threshold_value:0,rain_id:null},series_data:[],max_rval_data:[]},Wi={"-1":"Actual is lower than recorded",0:"No rainfall/Data is zero",1:"Actual is higher than recorded"},Gi={"24h":"rgba(73, 105, 252, 0.9)","72h":"rgba(239, 69, 50, 0.9)",rain:"rgba(0, 0, 0, 0.9)"};function qi(e){var t=e.null_ranges,a=e.invalid_data,n=[],r=[];Object.keys(Gi).forEach((function(t){var l=Gi[t],i=e[t];"rain"===t&&(i=function(e,t){var a=t.length,n=0;return e.map((function(e){var r=Object(o.a)(e,2),l=r[0],i={x:l,y:r[1]};if(a>0&&n<a){var c=t[n],s=c.ts_start,m=c.ts_end,u=J.unix(l/1e3);u.isSameOrAfter(s)&&(u.isSameOrBefore(m)||null===m)&&(i.color="rgba(250, 96, 96)",i.is_invalid=!0,Object.assign(i,t[n])),u.isSame(m)&&(n+=1)}return i}))}(i,a));var c={name:t,step:!0,data:i,color:l,id:t,fillOpacity:1,lineWidth:1,turboThreshold:1e5};"rain"!==t?n.push(c):r.push(c)}));var l=t.map((function(e){return{from:e.from,to:e.to,color:"rgba(68, 170, 213, 0.3)"}}));return{set:e,series_data:n,max_rval_data:r,null_processed:l}}function Vi(e){var t=e.target,a=e.is_tagging_data,n=e.rain_gauge,r=e.rain_id,l=e.setTaggingData,i=t.series,c=t.resetZoomButton,o=t.is_tagging_data,s=t.rain_gauge,m=t.rain_id,u=t.tagging_sign,d=t.setTaggingData,p=s,b=m;"undefined"!==typeof n&&(t.rain_gauge=n,t.rain_id=r);var f=d;"undefined"!==typeof l&&(t.setTaggingData=l);var g="undefined"===typeof a?!("undefined"===typeof o)&&o:a;t.is_tagging_data=g;var E=function(){t.reset_selection.destroy(),delete t.reset_selection},v=function(){t.submit_selection.destroy(),delete t.submit_selection};if(t.submit_selection=t.renderer.button("Submit",70,65).attr({zIndex:3,r:5,id:"submit-selection",fill:si.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",(function(){si.a.fireEvent(t,"selectedpoints",{selected_points:t.getSelectedPoints(),rain_gauge:p,rain_id:b,is_submit:!0,setTaggingData:f}),E(),v(),Zi(i)})),t.reset_selection=t.renderer.button("Reset",133,65).attr({zIndex:3,r:5,id:"reset-selection",fill:si.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",(function(){E(),v(),Zi(i)})),"undefined"!==typeof c&&(g?c.hide():c.show()),!g)return Zi(i),E(),v(),delete t.setTaggingData,"undefined"!==typeof u&&(t.tagging_sign.destroy(),delete t.tagging_sign),!0;"undefined"===typeof u&&(t.tagging_sign=t.renderer.label("Tagging",30,20).attr({fill:si.a.getOptions().colors[5],padding:10,r:5,zIndex:8}).css({color:"#FFFFFF"}).add());var h=t.getSelectedPoints(),_=h.map((function(e){return e.x})),y=Math.min.apply(Math,Object(Xe.a)(_)),O=Math.max.apply(Math,Object(Xe.a)(_));return"undefined"!==typeof e.xAxis&&(i.forEach((function(t){t.points.forEach((function(t){(t.x>=e.xAxis[0].min||t.x>=y)&&(t.x<=e.xAxis[0].max||t.x<=O)&&null!==t.y&&t.select(!0,!0)}))})),(h=t.getSelectedPoints()).length>0&&(t.reset_selection.add(),t.submit_selection.add())),si.a.fireEvent(t,"selectedpoints",{selected_points:h,rain_gauge:p,rain_id:b}),!1}function Qi(e){var t=e.selected_points,a=e.rain_gauge,n=e.rain_id,r=e.is_submit,l=e.setTaggingData,i=e.target,c=[];t.forEach((function(e){var t=new Date(e.x);t=J(t).format("YYYY-MM-DD HH:mm:ss"),!0!==c.includes(t)&&c.push(t)}));var o={rain_gauge:a,ts_start:c[0],ts_end:c[c.length-1],rain_id:n,chart:i};r&&l(o)}function Zi(e){e.forEach((function(e){e.points.forEach((function(e){e.select(!1,!1)}))}))}function Ki(e,t,a,n,r){var l=e.set,i=e.max_rval_data,c=e.null_processed,o=l.distance,s=l.max_rval,m=l.gauge_name,u=l.rain_id,d=t.ts_start,p=t.ts_end,b=t.site_code;return{series:i,chart:{type:"column",zoomType:"x",panning:!0,events:{selection:Vi,selectedpoints:Qi},height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Instantaneous Rainfall Chart of ".concat(b.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source : <b>".concat($i(o,m),"</b><br/>As of: <b>").concat(J(p).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(d),max:Date.parse(p),plotBands:c,type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:ec}},yAxis:{max:s,min:0,title:{text:"<b>Value (mm)</b>"}},tooltip:{shared:!0,crosshairs:!0,formatter(e){var t=this.points[0].point,a=t.x,n=t.y,r=t.is_invalid,l=t.tagger,i=t.remarks,c=t.observed_data,o="".concat(J.unix(a/1e3).format("dddd, MMMM D, HH:mm"),"<br/>")+"- Rain: <b>".concat(n,"</b>");if(r){var s=l.first_name,m=l.last_name;o+="<br/>- Observed Data: <b>".concat(Wi[c],"</b><br/>")+"- Tagger: <b>".concat(s," ").concat(m,"</b><br/>")+"- Remarks: <b>".concat(i||"---","</b>")}return o}},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},exporting:{menuItemDefinitions:{tagInvalidData:{onclick(){si.a.fireEvent(this,"selection",{is_tagging_data:!a,rain_gauge:m,rain_id:u,setTaggingData:r}),n(!a)},text:a?"Exit tagging":"Tag invalid data"}},buttons:{contextButton:{menuItems:["tagInvalidData","viewFullscreen","printChart","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG"]}}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}function Ji(e,t){var a=e.set,n=e.series_data,r=a.distance,l=a.max_72h,i=a.threshold_value,c=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Cumulative Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source: <b>".concat($i(r,c),"</b><br/>As of: <b>").concat(J(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:ec}},yAxis:{title:{text:"<b>Value (mm)</b>"},max:Math.max(0,l-parseFloat(i))+parseFloat(i),min:0,plotBands:[{value:Math.round(10*parseFloat(i/2))/10,color:Gi["24h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"24-hr threshold (".concat(i/2,")")}},{value:i,color:Gi["72h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"72-hr threshold (".concat(i,")")}}]},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}var Xi=function(e){var t,a=e.match.params,l=a.rain_gauge,i=a.site_code,c=e.input,s=e.disableBack,m=e.currentUser,u=e.saveSVG,p="undefined"!==typeof l?1:4,b=Object(n.useState)([]),f=Object(o.a)(b,2),g=f[0],E=f[1],h=Object(n.useState)([]),y=Object(o.a)(h,2),O=y[0],j=y[1],x=Object(n.useState)({label:"3 days",unit:"days",duration:3}),S=Object(o.a)(x,2),k=S[0],C=S[1],w=Object(n.useState)(!1),A=Object(o.a)(w,2),D=A[0],I=A[1],M=Object(n.useRef)(Object(Xe.a)(Array(p)).map((function(){return{instantaneous:Object(n.createRef)(),cumulative:Object(n.createRef)()}}))),N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)([]),B=Object(o.a)(Y,2),P=B[0],L=B[1],F="undefined"!==typeof s&&s,z="undefined"!==typeof u&&u,U="",W="";if("undefined"!==typeof c){var G=c.ts_end;U=G,t=J(G),W=i}else{var q=J();U=q.format("YYYY-MM-DD HH:mm:ss"),t=q,W=l.substr(0,3)}var V=k.unit,Q=dt(t,k.duration,V),Z={days_diff:t.diff(J(Q,"YYYY-MM-DD HH:mm:ss"),"days"),ts_start:Q,ts_end:U,site_code:W},K=Object(n.useState)(!1),X=Object(o.a)(K,2),$=X[0],ee=X[1],te=Object(n.useState)(null),ae=Object(o.a)(te,2),ne=ae[0],le=ae[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me={cumulative:Ji(Ui,Z),instantaneous:Ki(Ui,Z,$,ee,le)},ue=function(){j([]),function(e,t){var a=e.site_code,n=e.ts_end,r=e.days_diff,l="".concat(We.b,"/api/rainfall/get_rainfall_plot_data/").concat(a,"/").concat(n,"/").concat(r);it.a.get(l).then((function(e){var a=e.data;console.log("Rainfall Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(Z,(function(e){var t=e;"undefined"!==typeof l&&(t=e.filter((function(e){return e.gauge_name==="rain_".concat(l)}))),E(t)}))};Object(n.useEffect)((function(){ue()}),[k]),Object(n.useEffect)((function(){D&&(ue(),I(!1))}),[D]),Object(n.useEffect)((function(){var e=[];g.forEach((function(t){var a=qi(t);e.push(a)})),e.length>0&&j(e)}),[g]);var de=Object(n.useState)([]),pe=Object(o.a)(de,2),be=pe[0],fe=pe[1];Object(n.useEffect)((function(){var e=[];O.forEach((function(t){var a=Ki(t,Z,$,ee,le),n=Ji(t,Z);e.push({instantaneous:a,cumulative:n})})),fe(e),e.length>0&&z&&R(!0)}),[O,$]),Object(n.useEffect)((function(){$&&se(!0)}),[ne]),Object(n.useEffect)((function(){if(H){var e=[];M.current.forEach((function(t){var a=t.instantaneous,n=t.cumulative,r=a.current.chart,l=n.current.chart.getSVGForExport(),i=r.getSVGForExport();e.push({c:l,i:i})})),L(e)}}),[H]);var ge=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(P.length>0){var e=ge.current.outerHTML;xi({user_id:m.user_id,site_code:i,chart_type:"rainfall",svg:e},(function(e){}))}}),[P]),r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},!F&&r.a.createElement("div",null,r.a.createElement(Di,e)),r.a.createElement(_.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},r.a.createElement(Ni,{selectedRangeInfo:k,setSelectedRangeInfo:C,disableAll:!0}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(_.a,{container:!0,spacing:4},M.current.map((function(e,t){var a=Object(d.a)({},me);return be.length>0&&(a=be[t]),r.a.createElement(n.Fragment,{key:t},r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,options:a.instantaneous,ref:e.instantaneous}))),r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,options:a.cumulative,ref:e.cumulative}))))})))),r.a.createElement(zi,{isOpen:oe,closeModalFn:function(){return se(!1)},taggingData:ne,onTagSuccess:function(){si.a.fireEvent(ne.chart,"selection",{is_tagging_data:!1}),ee(!1),I(!0)}}),z&&r.a.createElement(re.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:1600,viewBox:"0 0 1200 1600",ref:ge},P.map((function(e,t){var a=e.i,l=e.c;return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:0,y:400*t,dangerouslySetInnerHTML:{__html:a}}),r.a.createElement("svg",{x:600,y:400*t,dangerouslySetInnerHTML:{__html:l}}))})))))};function $i(e,t){var a=t.toUpperCase();return null===e?a:"".concat(a," (").concat(e," KM)")}function ec(e){var t=this.chart,a=si.a.charts;"syncExtremes"!==e.trigger&&a.forEach((function(a){a!==t&&"undefined"!==typeof a&&a.xAxis[0].setExtremes&&a.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})}))}var tc=a(378),ac=a.n(tc),nc=a(513),rc=a(308),lc=a.n(rc);function ic(e){for(var t=e.length,a=lc.a.scale(["#f00","#0f0","#00f"]).mode("hsl").domain([0,t-1]),n=Object(Xe.a)(e),r=0;r<t;r+=1)"Cumulative"!==e[r].name&&(n[r].color=a(r).name());return n}function cc(e,t,a,n){var r=t.subsurface_column,l=Math.floor(e.length/25),i="As of: <b>".concat(J().format("D MMM YYYY, HH:mm"),"</b><br>")+"Note: <b>Click a box to access node-level charts.</b><br>";return{series:[{name:"Node Health",borderColor:"#444444",borderWidth:.5,data:e,rowsize:10,dataLabels:{enabled:!0,style:{textShadow:"none"},formatter(){return"".concat(this.point.id)}},events:{click(e,r){!function(e,t,a){mc.apply(this,arguments)}(e.point.id,t,(function(e){n(e)})),a(!0)}}}],chart:{type:"heatmap",height:160+20*l,marginTop:70,marginBottom:40,resetZoomButton:{position:{x:0,y:-30}}},plotOptions:{series:{cursor:"pointer"}},title:{text:"<b>Node Health Summary of ".concat(r.toUpperCase(),"</b>"),style:{fontSize:"14px"}},subtitle:{text:i,style:{fontSize:"0.75rem"}},xAxis:{visible:!1,categories:[]},yAxis:{reversed:!1,categories:[],title:null,labels:{format:"&ensp;",useHTML:!0}},colorAxis:{stops:[[0,"#7cb5ec"],[.5,"#ffed49"],[1,"#ff1414"]],min:0,max:2},legend:{enabled:!1},tooltip:{formatter(){var e=this.point,t=e.id_date,a=e.flagger,n=e.status,r=e.comment,l=e.id,i="Ok",c="";if("undefined"!==typeof n){switch(n){case 2:i="Use with Caution";break;case 3:i="Spacial Case";break;case 4:i="Not Ok";break;default:i="Ok"}c="Identification Date: <b>".concat(J(t).format("DD MMM YYYY"),"</b><br/>")+"Comment: <b>".concat(r,"</b><br/>Flagger: <b>").concat(a,"</b>")}return"Node ID: <b>".concat(l,"</b><br/>Status: <b>").concat(i,"</b><br/>").concat(c)}},credits:{enabled:!1}}}function oc(e,t){var a=[];return e.forEach((function(e){var n=e.series_name,r=e.data,l=[];r.forEach((function(e){var t=e.series;l.push.apply(l,Object(Xe.a)(function(e){var t=[];return e.forEach((function(e){var a={x:e.data[0],y:e.data[1],name:e.data[2]};e.name.includes("Raw")&&(e.visible=!1),t.push(Object(d.a)(Object(d.a)({},e),{},{name:e.name,data:a}))})),e.data=[].concat(t),e}(t)))})),a.push(function(e,t,a){var n=a.subsurface_column,r=a.ts_start,l=a.ts_end,i=a.node_id,c="battery"===e?1:3,o=e.slice(0,c).toUpperCase()+e.slice(c);return{series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400},title:{text:"<b>".concat(o," Plot of ").concat(n.toUpperCase(),"</b>"),style:{fontSize:"10px"},margin:20,y:16},subtitle:{text:"Source: <b>Node ".concat(i,"</b><br/>As of: <b>").concat(J(r).format("D MMM YYYY, HH:mm")," - ").concat(J(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"9px"}},xAxis:{min:Date.parse(r),max:Date.parse(l),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Value</b>"}},tooltip:{crosshairs:!0,shared:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{itemStyle:{fontSize:"10px"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},time:{timezoneOffset:-480},credits:{enabled:!1}}}(n,l,t))})),a}function sc(e){var t=e.show,a=e.setNodeLevelChart,l=e.data,i=e.setData,c=function(){a(!1),i(null)};return r.a.createElement(Me.a,{open:t,onClose:c,maxWidth:"lg",fullWidth:!0},null!==l?r.a.createElement(n.Fragment,null,r.a.createElement(Te.a,null,r.a.createElement(_.a,{container:!0,spacing:1},l.map((function(e,t){return r.a.createElement(_.a,{item:!0,xs:12,key:t},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,options:e,allowChartUpdate:!0,callback:function(e){return e.reflow()}})))})))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:c,color:"secondary",autoFocus:!0},"Close"))):r.a.createElement(fl.a,null))}function mc(){return(mc=Object(nc.a)(ac.a.mark((function e(t,a,n){var r;return ac.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ji(r=Object(d.a)(Object(d.a)({},a),{},{node_id:t}),(function(e){var t=oc(e,r);n(t)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}li()(si.a),window.moment=J,ui()(si.a);var uc=function(e){var t,a=e.match.params.tsm_sensor,l=e.width,i=e.input,c=e.disableBack,s=e.saveSVG,m=e.currentUser,u=e.isEOS,p="",b=a,f=Object(n.useState)({label:"3 days",unit:"days",duration:3}),g=Object(o.a)(f,2),E=g[0],h=g[1],y=Object(n.useState)({label:"4 hours",hour_value:"4"}),O=Object(o.a)(y,2),j=O[0],x=O[1];if("undefined"!==typeof i){var S=i.ts_end,k=i.tsm_sensor;p=S,t=J(S),b=k}else{var C=J();p=C.format("YYYY-MM-DD HH:mm:ss"),t=C}var w=E.unit,A=dt(t,E.duration,w),D="undefined"!==typeof c&&c,I="undefined"!==typeof s&&s,M=Object(n.useState)([]),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useRef)(Object(Xe.a)(Array(6)).map((function(){return Object(n.createRef)()}))),Y=Object(n.useState)(!1),B=Object(o.a)(Y,2),P=B[0],L=B[1],F=Object(n.useState)([]),z=Object(o.a)(F,2),U=z[0],W=z[1],G=j.hour_value,q={ts_end:p,ts_start:A,subsurface_column:b,hour_value:G,include_comms_health:!u},V=Object(K.b)(l,"sm"),Q={title:{text:"Loading"}},Z=Object(n.useState)([{title:{text:"Loading"}}]),X=Object(o.a)(Z,2),$=X[0],ee=X[1],te=Object(n.useState)(null),ae=Object(o.a)(te,2),ne=ae[0],le=ae[1],ie=Object(n.useState)(null),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=Object(n.useState)(!1),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(null),fe=Object(o.a)(be,2),ge=fe[0],Ee=fe[1];Object(n.useEffect)((function(){H([]),se(null),function(e,t){var a=e.subsurface_column,n=e.ts_end,r=e.ts_start,l=e.hour_value,i=e.include_comms_health,c="".concat(We.b,"/api/subsurface/get_subsurface_plot_data/")+"".concat(a,"/").concat(n,"/").concat(r,"/").concat(l)+"?include_comms_health=".concat(i);it.a.get(c).then((function(e){var a=e.data;console.log("Subsurface Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(q,(function(e){var t=[];e.forEach((function(e){var a=e.type,n=e.data,r=JSON.parse(JSON.stringify(n)),l=[];if("column_position"===a?l=function(e,t){var a=e.data,n=[];return a.forEach((function(a){var r=a.orientation,l=ic(a.data);l.forEach((function(e){e.turboThreshold=1e5}));var i=Object(d.a)(Object(d.a)({},e),{},{data:l,orientation:r,type:t});n.push(i)})),n}(r,a):"displacement"===a?l=function(e,t){var a=[];return e.forEach((function(e,n){var r=e.data,l=e.annotations;r[0].type="area";var i=ic(r);i.forEach((function(e){e.turboThreshold=1e5})),l.forEach((function(e){e.width=0,e.label.style={color:"gray"}}));var c=Object(d.a)(Object(d.a)({},e),{},{data:i,annotations:l,type:t});a.push(c)})),a}(r,a):"velocity_alerts"===a&&(l=function(e,t){var a=e.velocity_alerts,n=e.timestamps_per_node,r=[],l=ic(n);return a.forEach((function(e){var a=e.orientation,n=e.data,i=Object(Xe.a)(l);Object.keys(n).forEach((function(e){var t="L2"===e?7:10,a="L2"===e?"#FFFF00":"#FF0000",r={data:n[e],type:"scatter",zIndex:5,name:e,marker:{symbol:"triangle",radius:t,fillColor:a,lineColor:"#000000",lineWidth:2}};i.push(r)}));var c={data:i,type:t,orientation:a};r.push(c)})),r}(r,a)),"comms_health"===a){var i=function(e,t){var a=t.subsurface_column,n=t.ts_start,r=t.ts_end;return{series:e.data,chart:{type:"column",height:300,resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Communication Health Chart of ".concat(a.toUpperCase(),"</b>"),style:{fontSize:"14px"},margin:20,y:16},subtitle:{text:"Range: <b>".concat(J(n).format("D MMM YYYY, HH:mm")," - ").concat(J(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"12px"}},xAxis:{min:1,title:{text:"<b>Node number</b>"},allowDecimals:!1},yAxis:{min:0,max:100,title:{text:"<b>Health Percentage (%)</b>"}},tooltip:{crosshairs:!0,shared:!0,headerFormat:"Node {point.x}<br/>"},legend:{align:"right",verticalAlign:"middle",layout:"vertical"},credits:{enabled:!1}}}(n,q);se(i)}else t.push.apply(t,Object(Xe.a)(l))})),H(t)}))}),[E,j]),Object(n.useEffect)((function(){var e=[];T.forEach((function(t){var a,n=t.type;"column_position"===n?a=function(e,t,a){var n=e.data,r=e.max_position,l=e.min_position,i=e.orientation,c=t.subsurface_column,o="across_slope"===i?"Across Slope":"Downslope";return{series:n,chart:{type:"scatter",zoomType:"x",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Column Position Plot of ".concat(c.toUpperCase(),"</b>"),style:{fontSize:"1rem"}},plotOptions:{series:{lineWidth:2,states:{hover:{enabled:!0,lineWidth:5}},marker:{enabled:!0,radius:3,lineColor:null}}},tooltip:{formatter(){return"Timestamp: <b>".concat(J(this.series.name).format("dddd, MMM D, HH:mm"),"</b><br>Depth: <b>").concat(this.y,"</b><br>Displacement: <b>").concat(this.x,"</b>")}},xAxis:{min:l,max:r+.02,gridLineWidth:1,title:{text:"<b>Horizontal displacement, ".concat(o," (m)</b>")}},yAxis:{title:{text:"<b>Depth (m)</b>"}},credits:{enabled:!1},legend:{enabled:!0,align:a?"right":"center",layout:a?"vertical":"horizontal",verticalAlign:a?"middle":"bottom",labelFormatter(){return"".concat(J(this.name).format("MM/DD, HH:mm"))}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q,V):"displacement"===n?a=function(e,t){var a=e.orientation,n=e.data,r=e.annotations,l=t.subsurface_column,i=t.ts_end;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Displacement Plot, ".concat("across_slope"===a?"Across Slope":"Downslope"," of ").concat(l.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(J(i).format("D MMM YYYY, HH:mm"),"</b><br><br><b>Note: </b> (+/-) consistently increasing/decreasing trend"),style:{fontSize:"0.6rem"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{plotBands:r,title:{text:"<b>Relative Displacement (mm)</b>"}},tooltip:{header:"{point.x:%Y-%m-%d}: {point.y:.2f}"},plotOptions:{spline:{marker:{enabled:!0}}},credits:{enabled:!1},legend:{enabled:!1},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q):"velocity_alerts"===n&&(a=function(e,t){var a=e.data,n=e.orientation,r=t.subsurface_column,l=t.ts_end,i="across_slope"===n?"Across Slope":"Downslope",c=a.map((function(e){return e.name})).filter((function(e){return"number"===typeof e}));return c.unshift(0),{series:a,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Velocity Alerts Plot, ".concat(i," of ").concat(r.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(J(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.6rem"}},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Time</b>"}},legend:{enabled:!1},yAxis:{categories:c,reversed:!0,title:{text:"<b>Nodes</b>"},labels:{formatter(){return this.value}}},tooltip:{formatter(){return"<b>".concat(J(this.x).format("DD MMM YYYY, HH:mm"),"</b>")}},plotOptions:{line:{marker:{enabled:!0,radius:2}}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q)),e.push(a)})),ee(e),e.length>0&&I&&L(!0)}),[T]),Object(n.useEffect)((function(){!function(e,t){var a=e.subsurface_column,n="".concat(We.b,"/api/subsurface/get_subsurface_node_health/").concat(a);it.a.get(n).then((function(e){var a=e.data;console.log("Subsurface Node Health Data",a),t(a)})).catch((function(e){console.error(e)}))}(q,(function(e){var t=cc(function(e,t){var a=[];return e.forEach((function(e,t){var n=e.id,r=e.status,l="";2===r?l="#f9ff40":3===r?l="#ff8400":4===r&&(l="#ff6961");var i=Object(d.a)(Object(d.a)({name:t+1},e),{},{value:0,id:n+1,color:l});a.push(i)})),a}(e),q,pe,(function(e){Ee(e)}));le(t)}))}),[]),Object(n.useEffect)((function(){if(P){var e=[];R.current.forEach((function(t){var a=t.current;if(null!==a){var n=a.chart.getSVGForExport();e.push(n)}})),W(e)}}),[P,R]);var ve=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(U.length>0){var e=ve.current.outerHTML;xi({user_id:m.user_id,tsm_sensor:b,site_code:i.site_code,chart_type:"subsurface",svg:e},(function(e){}))}}),[U]),r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:1,justify:"space-between"},!D&&r.a.createElement(_.a,{item:!0,sm:!0},r.a.createElement(Di,e)),r.a.createElement(Ni,{isSubsurface:!0,selectedRangeInfo:E,setSelectedRangeInfo:h,selectedHourInterval:j,setSelectedHourInterval:x})),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(_.a,{container:!0,spacing:4},ne&&r.a.createElement(_.a,{item:!0,xs:12,md:12},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,allowChartUpdate:!0,options:ne}))),0===$.length&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,md:6,key:1},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,options:Q}))),r.a.createElement(_.a,{item:!0,xs:12,md:6,key:2},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,options:Q})))),oe&&r.a.createElement(_.a,{item:!0,xs:12,md:12},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,allowChartUpdate:!0,options:oe}))),$.map((function(e,t){var a=R.current[t];return r.a.createElement(_.a,{item:!0,xs:12,md:6,key:t},r.a.createElement(v.a,null,r.a.createElement(ci.a,{highcharts:si.a,allowChartUpdate:!0,options:e,ref:a})))})))),I&&r.a.createElement(re.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:2400,viewBox:"0 0 1200 2400",ref:ve},U.map((function(e,t){var a=t%2===1?0:600,l=800*Math.floor(t/2);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:a,y:l,dangerouslySetInnerHTML:{__html:e}}))})))),r.a.createElement(sc,{show:de,setNodeLevelChart:pe,data:ge,setData:Ee}))};var dc=function(e){var t=e.match.params.site_code,a=e.location,n=a.site,l=a.ts_end,i=a.to_include,c=l,o=a.subsurface_columns,s=Object(d.a)({},i);"undefined"===typeof n&&(c=X()(),o=[],s={rainfall:!0,surficial:!0});var m={site_code:t,ts_end:c.format("YYYY-MM-DD HH:mm:ss")};return r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Di,e)),s.rainfall&&r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(Xi,Object.assign({},e,{input:m,disableBack:!0}))),s.surficial&&r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(Fi,Object.assign({},e,{input:m,disableBack:!0}))),o.map((function(t){var a=Object(d.a)(Object(d.a)({},m),{},{tsm_sensor:t});return r.a.createElement(_.a,{key:t,item:!0,xs:12},r.a.createElement(uc,Object.assign({},e,{input:a,disableBack:!0})))})))};var pc=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.isMobile,c=e.url,m=Object(n.useState)({value:null,data:{site_code:null}}),u=Object(o.a)(m,2),b=u[0],f=u[1],g=Object(n.useState)(X()()),E=Object(o.a)(g,2),v=E[0],h=E[1],O=Object(n.useState)({rainfall:!0,surficial:!0,subsurface:{}}),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(a){var n=a.target.checked,r=n;if(null!==t){var l=x.subsurface;l[t]=n,r=l}S(Object(d.a)(Object(d.a)({},x),{},{[e]:r}))}};Object(n.useEffect)((function(){return function(){h(X()())}}),[a]),Object(n.useEffect)((function(){var e=b.data.site_code;null!==e&&function(e,t){var a="".concat(We.b,"/api/subsurface/get_site_subsurface_columns/").concat(e);it.a.get(a).then((function(a){var n=a.data;console.log("Subsurface Columns of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(e,(function(e){A([]);var t={};e.forEach((function(e){var a=null===e.date_deactivated;t[e.logger.logger_name]=a})),S(Object(d.a)(Object(d.a)({},x),{},{subsurface:t})),A(e)}))}),[b.data.site_code]);var I=b.data,M=[];return Object.keys(x.subsurface).forEach((function(e){x.subsurface[e]&&M.push(e)})),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Consolidate charts per site"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Fill in the following."),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement($t,{value:b,changeHandler:function(e){return f(e)}})),r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:v,onChange:function(e){return h(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})))),r.a.createElement(_.a,{item:!0,xs:12,style:{marginTop:18}},r.a.createElement(Re.a,{component:"fieldset"},r.a.createElement(na.a,{component:"legend"},"Charts to Show"),r.a.createElement(ra.a,{"aria-label":"position",row:!0},r.a.createElement(Be.a,{value:"rainfall",control:r.a.createElement(kt.a,{color:"primary",onClick:D("rainfall"),checked:x.rainfall}),label:"Rainfall"}),r.a.createElement(Be.a,{value:"surficial",control:r.a.createElement(kt.a,{color:"primary",onClick:D("surficial"),checked:x.surficial}),label:"Surficial"})))),r.a.createElement(_.a,{item:!0,xs:12,style:{marginTop:8}},r.a.createElement(Re.a,{component:"fieldset"},r.a.createElement(na.a,{component:"legend"},"Subsurface Columns"),r.a.createElement(ra.a,{"aria-label":"position",row:!0},w.map((function(e){var t=e.date_deactivated,a=e.logger.logger_name,n=null===t?"":" (Deactivated)";return r.a.createElement(Be.a,{key:a,value:a,control:r.a.createElement(kt.a,{color:"primary",onClick:D("subsurface",a),checked:x.subsurface[a]}),label:a.toUpperCase()+n})})),0===w.length&&r.a.createElement(y.a,{variant:"body1"},"No site selected")))),!i&&r.a.createElement("div",{style:{height:120}})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{component:s.b,to:{pathname:"".concat(c,"/consolidated/").concat(I.site_code),ts_end:v,site:I,to_include:x,subsurface_columns:M},color:"primary",onClick:l,disabled:null===b.value},"View"),r.a.createElement(p.a,{onClick:l},"Cancel")))}));var bc=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.setReloadEqEvent,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1],b=Object(n.useState)(null),g=Object(o.a)(b,2),E=g[0],v=g[1],h=Object(n.useState)(0),y=Object(o.a)(h,2),O=y[0],j=y[1],S=Object(n.useState)(0),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)(X()()),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(n.useState)(!0),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(c.b)(),B=Y.enqueueSnackbar,P=Y.closeSnackbar,L=Object(x.a)(),F=L.first_name,z=L.last_name,U=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){P(e)}},"Dismiss")};Object(n.useEffect)((function(){return M(X()())}),[a]),Object(n.useEffect)((function(){R(!(E>0&&O>0&&C>0&&u>=0&&u<=10))}),[E,u,C,O]);var W=function(){var e="".concat(F," ").concat(z).split(" "),t="";e.forEach((function(e){t+=e.charAt(0)})),function(e,t){var a="".concat(We.b,"/api/analysis/insert_earthquake_event");it.a.post(a,e).then((function(e){t(e)})).catch((function(e){console.error(e)}))}({magnitude:u,depth:E,long:O,lat:C,timestamp:I.format("YYYY-MM-DD HH:mm"),issued_by:t},(function(e){200===e.status?(B("Success saving earthquake event",{variant:"success",autoHideDuration:7e3,action:U}),i(!0)):B("Error saving earthquake event",{variant:"error",autoHideDuration:7e3,action:U})})),l(!1)},G=(u>10||u<=0)&&null!==u,q=E<=0&&null!==u;return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Insert Earthquake Event"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Fill in the following."),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:I,onChange:function(e){return M(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Magnitude",onChange:function(e){return d(e.target.value)},type:"number",InputProps:{inputProps:{max:10,min:1}},fullWidth:!0,helperText:G?"Insert magnitude from 0.1 to 10":"",error:G}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Depth (km)",defaultValue:"",onChange:function(e){return v(e.target.value)},type:"number",fullWidth:!0,helperText:q?"Positive numbers only":"",error:q}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{type:"number",required:!0,label:"Latitude",defaultValue:"",onChange:function(e){return w(e.target.value)}}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Longitude",type:"number",defaultValue:"",onChange:function(e){return j(e.target.value)}}))))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{color:"primary",onClick:function(){return W()},disabled:H},"Submit"),r.a.createElement(p.a,{onClick:l,color:"secondary"},"Cancel")))})),fc=a(51),gc=a.n(fc),Ec=(a(487),a(856)),vc=a(897),hc=a(857),_c=a(858),yc=a(898),Oc=a(859),jc=a(860),xc=a(514),Sc=a.n(xc),kc=a(515),Cc=a.n(kc),wc=a(516),Ac=a.n(wc),Dc=gc.a.icon({iconUrl:Sc.a,shadowUrl:Cc.a,iconRetinaUrl:Ac.a,iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],shadowAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});var Ic=function(e){var t=e.eqEvents,a=[12.8797,121.774],l=5;if(e.zoomIn){var i=t[0];a=[i.latitude,i.longitude],l=7}var c=Object(n.useRef)(),s=1===t.length,m=Object(n.useState)(!1),u=Object(o.a)(m,2),d=u[0],p=u[1];Object(n.useEffect)((function(){s&&p(!0)}),[t]),Object(n.useEffect)((function(){d&&(null!==c&&c.current.leafletElement.openPopup(),p(!1))}),[d]);var b=/\.0*$|(?<=\.[0-9]{0,2147483646})0*$/;return r.a.createElement(Ec.a,{style:{height:465},center:a,zoom:l},r.a.createElement(vc.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((function(e,t){var a=e.latitude,l=e.longitude,i=e.magnitude,o=e.depth,m=e.critical_distance,u=e.eq_id,d=e.processed,p=[a,l],f=null===m?0:parseFloat(m);return r.a.createElement(n.Fragment,{key:u},r.a.createElement(hc.a,{center:p,fillColor:"blue",radius:1e3*f}),r.a.createElement(_c.a,{icon:Dc,position:p,ref:s?c:Object(n.createRef)()},r.a.createElement(yc.a,null,"Magnitude: ",r.a.createElement("strong",null,i.replace(b,""))," ",r.a.createElement("br",null),"Depth: ",r.a.createElement("strong",null,o.replace(b,""))," ",r.a.createElement("br",null),"Critical Distance: ",r.a.createElement("strong",null,f," km")," ",r.a.createElement("br",null),"Processed: ",r.a.createElement("strong",null,d?"Yes":"No"))))})),r.a.createElement(Oc.a,{style:{zIndex:550}},Yn.map((function(e){return r.a.createElement(jc.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},r.a.createElement(yc.a,null,r.a.createElement("strong",null,e.site_code.toUpperCase())," ",r.a.createElement("br",null),ct(e,!1)))}))))},Mc=Object(pr.a)({overrides:{MUIDataTableBodyCell:{root:{whiteSpace:"nowrap"}}}}),Nc=[{name:"Timestamp"},{name:"Magnitude"},{name:"Issuer"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}}],Tc=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}},{name:"Sites",options:{filter:!1}}];var Hc=function(e){var t=e.eqEvents,a=e.eqAlerts,n=e.eqAlertsPagination,l=e.setEqAlTblPage,i=r.a.useState(0),c=Object(o.a)(i,2),s=c[0],m=c[1],u=r.a.useState([]),p=Object(o.a)(u,2),b=p[0],f=p[1],g=r.a.useState([]),E=Object(o.a)(g,2),v=E[0],h=E[1];r.a.useEffect((function(){f(Object(Xe.a)(t));var e=t.map((function(e){return[X()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.issuer.toUpperCase(),e.eq_id]}));h(Object(Xe.a)(e))}),[t]);var O=function(e,t){var a=t.filter((function(t){return t.eq_id===e}));f(Object(Xe.a)(a))},j=r.a.useState([]),x=Object(o.a)(j,2),S=x[0],k=x[1];r.a.useEffect((function(){var e=a.map((function(e){var t=e.eq_alerts.map((function(e){return e.site.site_code.toUpperCase()}));return[X()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id,t.join(", ")]}));k(Object(Xe.a)(e))}),[a]);var C={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"standard",onRowClick(e,a,n){O(e[3],t)}},w={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",count:n.count,rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",serverSide:!0,onChangePage:function(e){var t=e*n.limit;l(Object(d.a)(Object(d.a)({},n),{},{offset:t}))},onRowClick(e,t,n){O(e[2],a)}};return r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(Ic,{eqEvents:b,zoomIn:1===b.length})),r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(M.a,{position:"static"},r.a.createElement(W.a,{value:s,onChange:function(e,t){return m(t)},variant:"fullWidth"},r.a.createElement(G.a,{label:"EQ Events"}),r.a.createElement(G.a,{label:"EQ Alerts"}))),0===s&&r.a.createElement(br.a,{theme:Mc},r.a.createElement(dr.a,{title:"Latest Earthquake Events",columns:Nc,options:C,data:v,style:{height:465}})),1===s&&r.a.createElement(br.a,{theme:Mc},r.a.createElement(dr.a,{title:r.a.createElement(y.a,{variant:"body1"},"Earthquake Alerts"),columns:Tc,options:w,data:S}))))};function Rc(e){return X()(e).format("D MMMM YYYY, HH:mm")}function Yc(e){var t=e.first_name,a=e.last_name;return"".concat(t," ").concat(a)}function Bc(e){var t=e.moms_data,a=e.match.params.instance_id,n=t.find((function(e){return e.instance_id===parseInt(a,10)})),l=[],i="";if("undefined"!==typeof n){l=n.moms;var c=n.feature.feature_type,o=n.feature_name;i="".concat(c," - ").concat(o)}var s=function(e){return e.map((function(e){var t=e.observance_ts,a=e.narrative,n=e.reporter,r=e.validator,l=e.op_trigger,i=e.remarks,c=a.narrative,o=a.timestamp;return[Rc(t),c,Rc(o),Yc(n),Yc(r),i,l]}))}(l);return r.a.createElement(v.a,{style:{marginTop:16}},r.a.createElement(dr.a,{title:r.a.createElement(y.a,{variant:"h6"},"Manifestation of Movement Reports ",r.a.createElement("span",{style:{fontSize:"small"}},i.toUpperCase())),columns:["Observance Timestamp","Narrative","Report Timestamp","Reporter","Validator","Remarks","Alert Level"],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard"},data:s}))}var Pc,Lc=function(e){var t=e.history,a=e.match,l=a.url,i=a.params.site_code,c=Object(n.useState)([]),s=Object(o.a)(c,2),u=s[0],d=s[1],p=Object(n.useState)([]),b=Object(o.a)(p,2),f=b[0],g=b[1];Object(n.useEffect)((function(){!function(e,t){var a="".concat(We.b,"/api/manifestations_of_movement/get_moms_instances/").concat(e);it.a.get(a).then((function(a){var n=a.data;console.log("MOMs Instances of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(i,(function(e){var t=e.map((function(e){var t=e.feature.feature_type,a=e.feature_name,n=e.moms,r=e.instance_id,l=e.location,i=t.charAt(0).toUpperCase()+t.slice(1),c=n[0],o=[];if("undefined"!==typeof c){var s=c.observance_ts,m=c.op_trigger;o=[i,a,l,Rc(s),m,r]}return o})).filter((function(e){return e.length>0})).sort((function(e,t){return t[4]-e[4]}));g(t),d(e)}))}),[]);var E=Object(n.useState)(!1),h=Object(o.a)(E,2),_=h[0],y=h[1],O=function(e){return function(){return y(e)}};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(Di,e),r.a.createElement(cr,{clickHandler:O(!0)})),r.a.createElement(v.a,{style:{marginTop:16}},r.a.createElement(dr.a,{title:"Manifestation of Movement Features of ".concat(i.toUpperCase()),columns:["Type",{name:"Name",options:{filter:!1}},{name:"Location",options:{filter:!1}},{name:"Last Observance Timestamp",options:{filter:!1}},"Alert Level",{name:"data",options:{display:!1,viewColumns:!1,filter:!1}}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard",onRowClick(e,a,n){var r=e[5];t.push("".concat(l,"/").concat(r))}},data:f})),r.a.createElement(ir,Object.assign({},e,{isOpen:_,closeHandler:O(!1)})),r.a.createElement(m.b,{path:"".concat(l,"/:instance_id"),render:function(e){return r.a.createElement(Bc,Object.assign({},e,{moms_data:u}))}}))};li()(ni.a);var Fc=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{tabBar:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})})),zc=function(){return r.a.createElement(Oe.a,{height:600,width:400,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},r.a.createElement("rect",{x:"0",y:"0",rx:"0",ry:"0",width:"400",height:"600"}))};function Uc(e,t){return r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Insert Earthquake Event",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:t(!0),startIcon:r.a.createElement(ei.a,null)},"Insert Earthquake Event"),r.a.createElement(p.a,{"aria-label":"Consolidate by site",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:e(!0),startIcon:r.a.createElement(ti.a,null)},"Consolidate by site"))}function Wc(e,t){var a=[];return e&&0!==Object.keys(e).length&&e.xAxis[0]&&e.series[0].points.forEach((function(e){a.push(function(e,t){var a=t.data,n=t.type,i=t.dataLabel;return r.a.createElement("div",{key:a},Object(l.createPortal)(r.a.createElement(s.b,{to:"".concat(e,"/").concat(n,"/").concat(a),style:{fontSize:i.options.style.fontSize,position:"absolute",fontFamily:"Lucida Grande, Lucida Sans Unicode, Arial Helvetica, sans-serif",color:"#000000"}},a.toUpperCase()),i.div))}(t,e))})),a}function Gc(e,t,a){var n=t.charAt(0).toUpperCase()+t.slice(1),r="<b>".concat(n," Data Availability</b>"),l=60,i="Timestamp: <b>".concat(Pc.format("D MMM YYYY, HH:mm"),"</b>");switch(t){case"surficial":i+="<br/>Note: Data presence within four hours<br/>until next release for event sites<br/>Data presence from 6AM to 12NN for <br/>routine and extended sites<br/><b>*Sites without markers</b>";break;case"subsurface":i+="<br/>Note: Data presence of raw data (not yet filtered)",95;break;case"loggers":95,l=100}return e&&l,{chart:{type:"heatmap",height:700,spacingTop:12,spacingRight:18},title:{text:r,style:{fontSize:"1rem"},y:20},subtitle:{text:i,style:{fontSize:"0.70rem"}},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},colorAxis:{stops:[[0,"#cccccc"],[1,"#7cb5ec"]],min:0,max:1},tooltip:{outside:!0,formatter(){var e,t=this.point,a=t.label,n=t.type,r=t.value,l=t.event_type,i=t.ts_last_data,c=t.ts_updated,o=t.diff_days,s=r?"With":"No";switch(n){case"rainfall":e="Rain gauge";break;case"surficial":e="Site";break;case"subsurface":e="Sensor";break;case"loggers":e="Logger"}var m="".concat(e,": <b>").concat(a,"</b><br/>")+"Presence: <b>".concat(s," data</b><br/>")+"Last data timestamp: <b>".concat(X()(i).format("D MMM YYYY, HH:mm"),"</b><br/>");return m+="surficial"!==n?"<br/>Last update timestamp: <b>".concat(X()(c).format("D MMM YYYY, HH:mm"),"</b><br/>")+"Days since last data: <b>".concat(o,"</b><br/>"):"Event type: <b>".concat(l,"</b>")}},credits:{enabled:!1},series:[{name:"",borderWidth:1,borderColor:"#444444",data:function(e,t,a){var n=[],r=0;return e.forEach((function(e,a){var l,i,c=e.last_data,o=e.ts_updated,s=e.diff_days,m=e.event_type,u=e.presence;"surficial"===t?(i=l=e.site_code,e.has_surficial_markers||(l+="*")):i=l="rainfall"===t?e.rain_gauge.gauge_name:"subsurface"===t?e.tsm_sensor.logger.logger_name:e.logger.logger_name;var d={x:a%5,y:5-r,value:u,label:l.toUpperCase(),data:i,type:t,ts_last_data:c,ts_updated:o,diff_days:s,event_type:m};n.push(d),a%5===4&&(r+=1)})),n}(a,t),dataLabels:{enabled:!0,useHTML:!0,color:"#000000",display:"none",style:{fontWeight:100},formatter(){return this.point.label}}}]}}var qc=Object(K.a)()((function(e){var t=e.width,a=e.location,l=e.match,i=l.path,c=l.url,u=Fc(),p=Object(K.b)(t,"sm");Pc=X()();var b=Object(n.useState)(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],h=Object(n.useState)(!1),y=Object(o.a)(h,2),O=y[0],j=y[1],x=function(e){return function(){return E(e)}},S=function(e){return function(){return j(e)}},k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(null),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],z=Object(n.useState)(null),U=Object(o.a)(z,2),W=U[0],G=U[1],q=Object(n.useState)(null),V=Object(o.a)(q,2),Q=V[0],Z=V[1],J=Object(n.useState)([]),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=Object(n.useState)(null),ne=Object(o.a)(ae,2),re=ne[0],le=ne[1],ie=Object(n.useState)(null),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=Object(n.useState)([]),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(null),fe=Object(o.a)(be,2),Ee=fe[0],ve=fe[1],he=Object(n.useState)({}),ye=Object(o.a)(he,2),Oe=ye[0],je=ye[1],xe=Object(n.useState)(null),Se=Object(o.a)(xe,2),ke=Se[0],Ce=Se[1],we=function(e){return function(t){je((function(a){return Object(d.a)(Object(d.a)({},a),{},{[e]:t})}))}};Object(n.useEffect)((function(){Oi("surficial",(function(e){F(e)})),Oi("tsm",(function(e){A(e)})),Oi("rain_gauges",(function(e){te(e)})),Oi("loggers",(function(e){pe(e)}))}),[]),Object(n.useEffect)((function(){if(L.length>0){var e=Gc(!p,"surficial",L);G(e)}}),[L,p]),Object(n.useEffect)((function(){if(w.length>0){var e=Gc(!p,"subsurface",w);N(e)}}),[w,p]),Object(n.useEffect)((function(){if(ee.length>0){var e=Gc(!p,"rainfall",ee);le(e)}}),[ee,p]),Object(n.useEffect)((function(){if(de.length>0){var e=Gc(!p,"loggers",de);ve(e)}}),[de,p]),Object(n.useEffect)((function(){var e=Wc(Oe.rainfall,c);se(e)}),[Oe.rainfall,c]),Object(n.useEffect)((function(){var e=Wc(Oe.surficial,c);Z(e)}),[Oe.surficial,c]),Object(n.useEffect)((function(){var e=Wc(Oe.subsurface,c);Y(e)}),[Oe.subsurface,c]);var Ae=Object(n.useContext)(Kt).setIsReconnecting;Object(n.useEffect)((function(){var e;return qe(Ae),e=function(e){var t=e.rainfall_summary,a=e.ts,n=function(e,t){var a=e.site_codes,n=e.list_1d,r=e.list_3d,l=null===t?"---":X()(t).format("D MMM YYYY, HH:mm");return{chart:{type:"column"},title:{text:"<b>Cumulative Rainfall Data vs Threshold Plot of Dynaslope Sites</b>",style:{fontSize:"1rem"},y:20},subtitle:{text:"As of: <b>".concat(l,"</b><br>Note: Percentage capped at 100%")},xAxis:{categories:a,title:{text:"<b>Sites</b>"}},yAxis:{min:0,max:100,title:{text:"<b>Threshold Ratio (%)</b>"}},tooltip:{shared:!0,useHTML:!0,formatter(){var e=this.x,t=this.points,a=t[0].point.data_source.replace(/_/g," "),n="<b>".concat(e," (").concat(a.toUpperCase(),")</b><br>");return t.forEach((function(e){n+="".concat(e.point.data_value,"<br>"),n+="- Percentage: <b>".concat(e.point.y.toFixed(2),"%</b><br>")})),n}},plotOptions:{column:{grouping:!1,shadow:!1}},series:[{name:"Three-day Cumulative Data",data:r,pointPadding:0,color:"#FF0000"},{name:"One-day Cumulative Data",data:n,pointPadding:.2}],credits:{enabled:!1}}}(function(e){var t=[],a=[],n=[];return e.forEach((function(e){var r=e.site_code,l=e["1D cml"],i=e["3D cml"],c=e["half of 2yr max"],o=e["2yr max"],s=e.DataSource,m=l?"".concat(l," mm"):"0 mm",u=i?"".concat(i," mm"):"0 mm",d={y:l/c*100,data_value:"<b><i>One Day Data</i></b><br>- Cumulative Data: <b>".concat(m,"</b><br>- Threshold: <b>").concat(c," mm</b>"),data_source:s},p={y:i/o*100,data_value:"<b><i>Three Day Data</i></b><br>- Cumulative Data: <b>".concat(u,"</b><br>- Threshold: <b>").concat(o," mm</b>"),data_source:s};t.push(d),a.push(p),n.push(r.toUpperCase())})),{list_1d:t,list_3d:a,site_codes:n}}(t),a);Ce(n)},Ge(),_e.on("receive_rainfall_data",(function(t){var a=JSON.parse(t);console.log("All Site Rainfall Data: ",a),e(a)})),function(){Qe()}}),[]);var De=Object(n.useState)([]),Ie=Object(o.a)(De,2),Me=Ie[0],Ne=Ie[1];Object(n.useEffect)((function(){var e=[];!function(e){var t="".concat(We.b,"/api/manifestations_of_movement/get_latest_alerts");it.a.get(t).then((function(t){var a=t.data;console.log("MOMs Alerts",a),e(a)})).catch((function(e){console.error(e)}))}((function(t){t.forEach((function(t){var a=t.site_code,n=t.moms_alert,r={site_code:a,address:ct(t,!0,"start"),moms_alert:n};e.push(r)})),Ne(e)}))}),[c]);var Te=[{name:"address",label:"Site",options:{filter:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=Me[a].site_code;return r.a.createElement(s.b,{to:"".concat(c,"/moms/").concat(n),style:{color:"black"}},e)}}},{name:"moms_alert",label:"Alert"}],He=Object(n.useState)([]),Re=Object(o.a)(He,2),Ye=Re[0],Be=Re[1],Pe=Object(n.useState)(!0),Le=Object(o.a)(Pe,2),Fe=Le[0],ze=Le[1];Object(n.useEffect)((function(){Fe&&(!function(e){var t="".concat(We.b,"/api/analysis/get_earthquake_events");it.a.get(t).then((function(t){var a=t.data;console.log("Earthquake Events",a),e(a)})).catch((function(e){console.error(e)}))}((function(e){Be(e)})),ze(!1))}),[Fe]);var Ue=r.a.useState([]),Ve=Object(o.a)(Ue,2),Ze=Ve[0],Ke=Ve[1],Je=r.a.useState({limit:5,offset:0,count:0}),$e=Object(o.a)(Je,2),et=$e[0],tt=$e[1],at=r.a.useState(!0),nt=Object(o.a)(at,2),rt=nt[0],lt=nt[1];r.a.useEffect((function(){!function(e,t){var a=e.limit,n=e.offset,r="".concat(We.b,"/api/analysis/get_earthquake_alerts")+"?limit=".concat(a,"&offset=").concat(n);it.a.get(r).then((function(e){var a=e.data;console.log("Earthquake Alerts",a),t(a)})).catch((function(e){console.error(e)}))}(et,(function(e){var t=e.count,a=e.data;Ke(Object(Xe.a)(a)),rt&&(lt(!1),tt(Object(d.a)(Object(d.a)({},et),{},{count:t})))}))}),[et,rt]);var ot=a.pathname===i;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:u.pageContentMargin},r.a.createElement(ge,{title:"Analysis | Site Data Analytics",customButtons:!(!p||!ot)&&Uc(x,S)})),r.a.createElement("div",{className:u.pageContentMargin},r.a.createElement(m.d,{location:a},r.a.createElement(m.b,{exact:!0,path:c,render:function(e){return r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,md:6,lg:3},null!==W?r.a.createElement(v.a,{elevation:2},r.a.createElement(ci.a,{highcharts:ni.a,options:W,callback:we("surficial"),allowChartUpdate:!1}),Q):r.a.createElement(zc,{style:{height:"100%"}})),r.a.createElement(_.a,{item:!0,xs:12,md:6,lg:3},null!==re?r.a.createElement(v.a,{elevation:2},r.a.createElement(ci.a,{highcharts:ni.a,options:re,callback:we("rainfall"),allowChartUpdate:!1}),oe):r.a.createElement(zc,{style:{height:"100%"}})),r.a.createElement(_.a,{item:!0,xs:12,md:6,lg:3},null!==M?r.a.createElement(v.a,{elevation:2},r.a.createElement(ci.a,{highcharts:ni.a,options:M,callback:we("subsurface"),allowChartUpdate:!1}),R):r.a.createElement(zc,{style:{height:"100%"}})),r.a.createElement(_.a,{item:!0,xs:12,md:6,lg:3},null!==Ee?r.a.createElement(v.a,{elevation:2},r.a.createElement(ci.a,{highcharts:ni.a,options:Ee,callback:we("loggers"),allowChartUpdate:!1})):r.a.createElement(zc,{style:{height:"100%"}})),r.a.createElement(_.a,{item:!0,xs:12},null!==ke?r.a.createElement(v.a,{elevation:2},r.a.createElement(ci.a,{highcharts:ni.a,options:ke})):r.a.createElement("div",null,"Loading...")),r.a.createElement(_.a,{item:!0,xs:12,md:12,lg:7},r.a.createElement(v.a,{elevation:2},r.a.createElement(Hc,{eqEvents:Ye,eqAlerts:Ze,eqAlertsPagination:et,setEqAlTblPage:tt}))),r.a.createElement(_.a,{item:!0,xs:12,md:12,lg:5},r.a.createElement(v.a,{elevation:2},r.a.createElement(dr.a,{title:"Latest MOMs Alert",columns:Te,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:6,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard"},data:Me}))))}}),r.a.createElement(m.b,{path:"".concat(c,"/surficial/:site_code"),render:function(e){return r.a.createElement(Fi,Object.assign({},e,{width:t}))}}),r.a.createElement(m.b,{path:"".concat(c,"/rainfall/:rain_gauge"),render:function(e){return r.a.createElement(Xi,Object.assign({},e,{width:t,chartType:"rainfall"}))}}),r.a.createElement(m.b,{path:"".concat(c,"/subsurface/:tsm_sensor"),render:function(e){return r.a.createElement(uc,Object.assign({},e,{width:t,chartType:"subsurface"}))}}),r.a.createElement(m.b,{path:"".concat(c,"/moms/:site_code"),render:function(e){return r.a.createElement(Lc,Object.assign({},e,{width:t}))}}),r.a.createElement(m.b,{path:"".concat(c,"/consolidated/:site_code"),render:function(e){return r.a.createElement(dc,Object.assign({},e,{width:t}))}}))),r.a.createElement(pc,{isOpen:g,clickHandler:x(!1),url:c}),r.a.createElement(bc,{isOpen:O,clickHandler:S(!1),setReloadEqEvent:ze}))})),Vc=a(518),Qc=a.n(Vc);function Zc(e,t,a,n){var r=t.site,l=t.start_ts,i=t.end_ts,c="Range: <b>".concat(X()(l).format("DD MMM YYYY, HH:mm")," - ").concat(X()(i).format("DD MMM YYYY, HH:mm"),"</b><br/>")+"Site: <b>".concat(r?r.label:"All","</b><br/>\n    <i>Note: Click on any alert triggers to show related monitoring events.</i>"),o=function(e){var t,a,n,r=["Alert 1","Alert 2","Alert 3"],l=e,i=[],c=[],o=l.length;for(t=0;t<o;t+=1){var s=l[t],m=s.y,u=s.color,d=s.drilldown;i.push({name:r[t],y:m,color:u});var p=d.data,b=d.categories,f=d.trigger_events;for(n=p.length,a=0;a<n;a+=1)c.push({name:b[a],y:p[a],color:lc()(u).brighten(.5*(a+1)).hex(),alert_events:f[a]})}return{alerts_data:i,trigger_count:c}}(e);return{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"<b>Monitoring Event Alerts Summary</b>",y:22},subtitle:{text:c,style:{fontSize:"0.75rem"}},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{center:["50%","50%"]}},series:[{name:"Alerts",data:o.alerts_data,size:"80%",tooltip:{pointFormat:"Count: <b>{point.y} ({point.percentage:.1f}%)</b>"},dataLabels:{formatter(){return this.y>5?this.point.name:null},color:"#ffffff",distance:-30}},{name:"Count",data:o.trigger_count,size:"80%",innerSize:"60%",dataLabels:{formatter(){return this.y>1?"<b>".concat(this.point.name,":</b> ").concat(this.y):null}},point:{events:{click(e){var t=e.point,r=t.alert_events,l=t.name;a({alert_events:r,name:l}),n.reflow()}}}}],loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var Kc=function(e){var t=e.highcharts,a=e.data,l=e.colors,i=e.isLoading,c=e.input,s=e.setSelectedTrigger,m=Object(n.useState)(null),u=Object(o.a)(m,2),p=u[0],b=u[1],f=[];null!==a&&(f=function(e,t){var a=[];return e.forEach((function(e,n){var r=Object(d.a)(Object(d.a)({},e),{},{color:t[n]});a.push(r)})),a}(a,l));var g=Object(n.useState)(Zc(f,c,s,p)),E=Object(o.a)(g,2),v=E[0],h=E[1];return Object(n.useEffect)((function(){null!==p&&(i?p.showLoading():p.hideLoading())}),[p,i]),Object(n.useEffect)((function(){var e=!1;null!==p&&null!==a&&(h(Zc(f,c,s,p)),0===a.length&&(e=!0),e?p.showNoData():p.hideNoData())}),[p,a]),r.a.createElement(ci.a,{highcharts:t,options:v,callback:function(e){return b(e)}})};function Jc(e,t){var a=t.site,n=t.year;return{chart:{type:"column"},title:{text:"<b>Monthly Monitoring Event Alerts</b>",y:22},subtitle:{text:"Year: <b>".concat(n,"</b><br/>")+"Site: <b>".concat(a?a.label:"All","</b>"),style:{fontSize:"0.75rem"}},series:e,xAxis:{categories:["January","February","March","April","May","June","July","August","September","October","November","December"]},yAxis:{min:0,title:{text:"<b>Number of heightened alerts</b>"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:ni.a.defaultOptions.title.style&&ni.a.defaultOptions.title.style.color||"gray"}}},legend:{backgroundColor:ni.a.defaultOptions.legend.backgroundColor||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,reversed:!0},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,formatter(){return 0===this.y?"":this.y}}}},loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var Xc=function(e){var t=e.highcharts,a=e.data,l=e.colors,i=e.isLoading,c=e.input,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],p=m[1],b=[];null!==a&&(b=function(e,t){var a=[];return e.forEach((function(e,n){var r=Object(d.a)(Object(d.a)({},e),{},{color:t[n]});a.push(r)})),a}(a,l)).reverse();var f=Object(n.useState)(Jc(b,c)),g=Object(o.a)(f,2),E=g[0],v=g[1];return Object(n.useEffect)((function(){null!==u&&(i?u.showLoading():u.hideLoading())}),[u,i]),Object(n.useEffect)((function(){var e=!1;null!==u&&null!==a&&(v(Jc(b,c)),0===a.length&&(e=!0),e?u.showNoData():u.hideNoData())}),[u,a]),r.a.createElement(ci.a,{highcharts:t,options:E,callback:function(e){return p(e)}})};var $c=function(e){var t=e.selectedTrigger,a=e.history,n=t.alert_events,l=t.name,i=n.map((function(e){var t=e.event_id,n=e.site,l=e.event_start,i=e.validity;return[r.a.createElement(p.a,{onClick:function(e){return a.push("/monitoring/events/".concat(t))},style:{color:"blue"}},r.a.createElement("u",null,t)),ct(n),X()(l).format("DD MMMM YYYY, HH:mm"),X()(i).format("DD MMMM YYYY, HH:mm")]}));return r.a.createElement(dr.a,{title:'Monitoring Events with "'.concat(l,'" trigger'),columns:[{name:"Event ID"},{name:"Site"},{name:"Event Start"},{name:"Validity"}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"simple"},data:i})};window.Highcharts=si.a,Qc()(window.Highcharts);var eo=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(d.a)(Object(d.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}}),card:{height:"auto"}})}));function to(e,t){return""===t?"Required field":""}function ao(e,t){var a=t.type,n=t.field,r=t.value,l=e[n],i=r,c=to(0,r),o=no(i);switch(a){case"UPDATE":return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{value:i,helper_text:c})});case"RESET":return Object(d.a)({},o);default:return Object(d.a)({},e)}}function no(e){var t={};return e&&Object.keys(e).forEach((function(a){var n=e[a]?e[a]:"",r=(t[a],to(0,n));t[a]={value:n,helper_text:r,required:!0}})),t}function ro(e){var t={};return Object.keys(e).forEach((function(a){t[a]=e[a].value})),t}var lo=function(e){var t=eo(),a=[F.a,F.b,F.c],l=Object(n.useState)({data:null,is_loading:!0}),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)({data:null,is_loading:!0}),u=Object(o.a)(m,2),d=u[0],b=u[1],f=X()(),E={site:"",start_ts:f.clone().subtract(1,"year"),end_ts:f},v={site:"",year:X()().format("YYYY")},h=Object(n.useReducer)(ao,E,no),O=Object(o.a)(h,2),j=O[0],x=O[1],S=Object(n.useReducer)(ao,v,no),k=Object(o.a)(S,2),C=k[0],w=k[1],A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=(new Date).getFullYear();return Array.from({length:e},(function(a,n){return t-e+n+1}))}(),D=Object(n.useState)(null),I=Object(o.a)(D,2),M=I[0],N=I[1],T=function(e,t){return x({type:"UPDATE",field:e,value:X()(t).format("YYYY-MM-DD HH:mm:ss")})},H=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={data:t,is_loading:a};"pie"===e?s(n):"stacked"===e&&b(n)},R=function(e){return function(){var t,a;"pie"===e?(a=c.data,t=j):"stacked"===e&&(a=d.data,t=C),H(e,a,!0);var n=ro(t);n.site&&(n.site_id=n.site.value),Si({chart_type:e,inputs:n},(function(t){H(e,t)}))}};return Object(n.useEffect)((function(){[{chart_type:"pie",inputs:E},{chart_type:"stacked",inputs:v}].forEach((function(e){Si(e,(function(t){H(e.chart_type,t)}))}))}),[]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ge,{title:"Analysis | Monitoring Alerts Analytics"}),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{className:t.card},r.a.createElement(Pa.a,null,r.a.createElement(y.a,{variant:"overline",display:"block",gutterBottom:!0},"Alerts Summary"),r.a.createElement(_.a,{container:!0,spacing:2,justify:"space-between"},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement($t,{value:j.site.value,changeHandler:function(e){x({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{item:!0,xs:12,sm:3},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"Start Timestamp",value:j.start_ts.value,onChange:function(e){return T("start_ts",e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:3},r.a.createElement(wt.b,{required:!0,autoOk:!0,label:"End Timestamp",value:j.end_ts.value,onChange:function(e){return T("end_ts",e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(_.a,{item:!0,xs:12,align:"right"},r.a.createElement(p.a,{size:"small",color:"primary",variant:"contained",onClick:R("pie")},"Submit")))))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{className:t.card},r.a.createElement(Pa.a,null,r.a.createElement(Kc,{highcharts:si.a,data:c.data,isLoading:c.is_loading,colors:a,input:ro(j),setSelectedTrigger:N})))),M&&r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{className:t.card},r.a.createElement($c,Object.assign({},e,{selectedTrigger:M})))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{className:t.card},r.a.createElement(Pa.a,null,r.a.createElement(y.a,{variant:"overline",display:"block",gutterBottom:!0},"Monthly Alerts Per Year"),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,sm:8},r.a.createElement($t,{value:C.site.value||"",changeHandler:function(e){w({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),r.a.createElement(_.a,{item:!0,xs:12,sm:4},r.a.createElement(Re.a,{required:!0,fullWidth:!0},r.a.createElement(fa.a,{id:"alert_level_label"},"Year"),r.a.createElement(ga.a,{labelId:"alert_level_label",id:"alert_level",value:C.year.value,onChange:function(e){return w({type:"UPDATE",field:"year",value:e.target.value})},error:Boolean(C.year.helper_text)},r.a.createElement(Y.a,{value:""},r.a.createElement("em",null,"---")),A.map((function(e){return r.a.createElement(Y.a,{value:e,key:e},e)}))),r.a.createElement(g.a,{error:!0},C.year.helper_text))),r.a.createElement(_.a,{item:!0,xs:12,align:"right"},r.a.createElement(p.a,{size:"small",color:"primary",onClick:R("stacked"),variant:"contained"},"Submit")))))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{className:t.card},r.a.createElement(Pa.a,null,r.a.createElement(_.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Xc,{highcharts:si.a,data:d.data,isLoading:d.is_loading,colors:a,input:ro(C)})))))))))},io=a(829),co=a(875),oo=a(876),so=a(836),mo=a(894),uo=a(866),po=a(867),bo=a(868),fo=a(869),go=a(870),Eo=a(104),vo=a.n(Eo),ho=a(863);var _o=function(e){var t=e.onClose,a=e.open,n=e.isUnregistered,l=e.setBlockModal,i=e.setSaveContactModal;return r.a.createElement(Me.a,{onClose:function(){t()},"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(Ne.a,{id:"simple-dialog-title"},"Message options"),r.a.createElement(hn.a,null,n&&r.a.createElement(yn.a,{button:!0,onClick:function(){t(),i(!0)}},r.a.createElement(jn.a,null,r.a.createElement(Rr.a,null)),r.a.createElement(On.a,{primary:"Save number"})),r.a.createElement(yn.a,{button:!0,onClick:function(){t(),l(!0)}},r.a.createElement(jn.a,null,r.a.createElement(ho.a,null)),r.a.createElement(On.a,{primary:"Block number"}))))};var yo=r.a.memo((function(e){var t=e.open,a=e.setBlockModal,l=e.mobileDetails,i=e.setOpenOptions,s=l.sim_num,m=l.mobile_id,u=Object(c.b)(),d=u.enqueueSnackbar,b=u.closeSnackbar,g=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){b(e)}},"Dismiss")},E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useState)(null),O=Object(o.a)(y,2),j=O[0],S=O[1],k=Object(x.a)().user_id;return r.a.createElement(Me.a,{open:t,onExited:function(){return _("")},"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Block mobile number (+".concat(s,")")),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Provide the reason for blocking this mobile number from Chatterbox"),r.a.createElement(f.a,{autoFocus:!0,value:h,onChange:function(e){var t=e.target.value;_(t);var a="";""===t&&(a="This is a required field"),S(a)},margin:"dense",id:"reason",label:"Reason",multiline:!0,fullWidth:!0,required:!0,placeholder:"Enter reason",inputProps:{maxLength:500},error:""===h,helperText:j})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:function(){return a(!1)},color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:function(){if(""===h)S("This is a required field");else{a(!1);var e={mobile_id:m,reporter_id:k,reason:h};console.log(e),function(e,t){var a="".concat(We.b,"/api/contacts/save_block_number");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save blocked contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t=e.status,a=e.message;console.log(e),d(a,t?{variant:"success",autoHideDuration:4e3,action:g}:{variant:"error",autoHideDuration:3e3,action:g})})),i(!1)}},color:"secondary"},"Block")))})),Oo=a(864),jo=a(865),xo=a(140),So=a.n(xo),ko={0:["LEWC"],1:["LGU","NGO"],2:["LGU","NGO","PNP"],3:["LGU","NGO","PNP"],4:["NGO","OCD","PHIVOLCS","DOST"],5:["NGO","OCD","PHIVOLCS","DOST","MGB"]},Co=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],wo=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Ao(e,t){var a=[];if("municipality"===t){var n=e.map((function(e){var t=e.municipality,a=e.province;return{id:t,label:"".concat(t,", ").concat(a)}}));a=Object(Xe.a)(n)}else if(["province","region"].includes(t)){var r=Object(Xe.a)(new Set(e.map((function(e){return e[t]})).sort())).map((function(e){return{id:e,label:e}}));a=Object(Xe.a)(r)}return a}function Do(e){var t=e.inputRef,a=e.mask,n=Object(Ht.a)(e,["inputRef","mask"]);return r.a.createElement(So.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function Io(e,t){var a=[];return"mobile"===t?e.forEach((function(e,t){var n=e.mobile_number;n.sim_num=n.sim_num.replace(/[()+-\s]/g,""),a.push(e)})):e.forEach((function(e,t){delete e.mobile_id,void 0===e.landline_id&&(e.landline_id=0),e.landline_num=e.landline_num.replace(/[()+-\s]/g,""),a.push(e)})),a}function Mo(e,t){var a=t.type,n=t.category,r=t.payload,l=Object(Xe.a)(e),i={status:1,has_delete:!0};switch("email"===n?i="":"mobile"===n?i=Object(d.a)(Object(d.a)({},i),{},{mobile_number:{sim_num:"",mobile_id:0}}):"landline"===n&&(i=Object(d.a)(Object(d.a)({},i),{},{landline_num:""})),a){case"UPDATE":return"email"===n?l[r.key]=r.value:"mobile"===n&&"sim_num"===r.data?l[r.key].mobile_number[r.data]=r.value:l[r.key][r.data]=r.value,Object(Xe.a)(l);case"ADD":return[].concat(Object(Xe.a)(l),[i]);case"DELETE":return l.splice(r.key,1),Object(Xe.a)(l)}return[]}function No(e){return ko[e].map((function(e){return{id:e.toLowerCase(),label:e}}))}var To=r.a.memo((function(e){var t=e.setContactForm,a=e.chosenContact,l=e.isEditMode,i=e.setContactFormForEdit,s=e.handleClose,m=e.isFromChatterbox,u=e.setSnackbarKey,b=[{mobile_number:{sim_num:"",mobile_id:0},status:1}],g=[],E=[],v=0,h="",O=[],j="",x="",S=!0,k=!0,C=0,w={first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0};if(l||m){var A=a.mobile_numbers,D=a.ewi_recipient,I=a.ewi_restriction,M=a.landline_numbers,N=a.emails,T=a.first_name,R=a.last_name,Y=a.middle_name,B=a.nickname,P=a.user_id,L=a.organizations,F=a.status;if(w={first_name:T,last_name:R,middle_name:Y,nickname:B,user_id:P},0!==L.length){var z=L[0].organization,U=z.scope,W=z.name,G=L[0].site;v=U,h=W,O=No(U);var q=function(e,t){var a=t.municipality,n=t.province,r=t.region,l=t.site_id,i="",c="";return 0===e||1===e?(i={value:l},c=""):2===e?(i="",c=a):3===e?(i="",c=n):4===e&&(i="",c=r),{site:i,location:c}}(U,G);j=q.site,x=q.location}if(null!==I)if(0!==I.length)C=I.alert_level;b=A.map((function(e,t){var a,n=JSON.parse(JSON.stringify(e)),r=n.mobile_number.sim_num;return n.mobile_number.sim_num=(a=r,Object(xo.conformToMask)(a,wo).conformedValue),n})),g=M,E=N,k=1===D,S=1===F}var V=Object(n.useContext)(Kt).sites,Q=[{id:0,label:"Community"},{id:1,label:"Barangay"},{id:2,label:"Municipal",select_label:"Municipality",list:Ao(V,"municipality")},{id:3,label:"Provincial",select_label:"Province",list:Ao(V,"province")},{id:4,label:"Regional",select_label:"Region",list:Ao(V,"region")},{id:5,label:"National"}],Z=Object(n.useState)(w),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(v),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(j),le=Object(o.a)(ne,2),ie=le[0],oe=le[1],se=Object(n.useState)(x),me=Object(o.a)(se,2),ue=me[0],de=me[1],pe=Object(n.useState)(O),be=Object(o.a)(pe,2),fe=be[0],ge=be[1],Ee=Object(n.useState)(h),ve=Object(o.a)(Ee,2),he=ve[0],_e=ve[1],ye=Object(n.useReducer)(Mo,b),Oe=Object(o.a)(ye,2),je=Oe[0],xe=Oe[1],Se=Object(n.useReducer)(Mo,g),ke=Object(o.a)(Se,2),Ce=ke[0],we=ke[1],Ae=Object(n.useReducer)(Mo,E),De=Object(o.a)(Ae,2),Ie=De[0],Me=De[1],Ne=Object(n.useState)(k),Te=Object(o.a)(Ne,2),He=Te[0],Ye=Te[1],Pe=Object(n.useState)(S),Le=Object(o.a)(Pe,2),Fe=Le[0],ze=Le[1],Ue=Object(c.b)(),Ge=Ue.enqueueSnackbar,qe=Ue.closeSnackbar,Ve=Object(n.useState)(C),Qe=Object(o.a)(Ve,2),Ze=Qe[0],Ke=Qe[1],Je=Object(n.useState)(!1),Xe=Object(o.a)(Je,2),$e=Xe[0],et=Xe[1],tt=function(){return m&&s(),l?i(!1):t(!1)},at=function(e){return function(t){X(Object(d.a)(Object(d.a)({},J),{},{[e]:t.target.value}))}},nt=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){qe(e)}},"Dismiss")};Object(n.useEffect)((function(){if(""!==te){var e=No(te);ge(e),l||(oe(""),de(""),_e(""))}}),[te]),Object(n.useEffect)((function(){var e;e=function(e,t,a){var n=e.first_name,r=e.last_name,l=a.scope,i=a.site,c=a.office,o=a.location,s=t.mobile_nums,m=t.landline_nums,u=!1,d=!1,p=!1;return s.forEach((function(e,t){var a=e.mobile_number.sim_num;!1===u&&(u=""===a||a.includes("x"))})),0!==m.length&&m.forEach((function(e,t){var a=e.landline_num;!1===p&&(p=""===a||a.includes("x"))})),0===l||1===l?d=""===i||""===c:2===l||3===l||4===l?d=""===o||""===c:5===l&&(d=""===o),""===n||""===r||!0===u||!0===d||!0===p}(J,{mobile_nums:je,landline_nums:Ce},{scope:te,site:ie,office:he,location:ue}),et(e)}),[J,je,Ce,te,ie,he,ue]);var rt=function(){var e=Io(je,"mobile"),t=Io(Ce,"landline"),a=He?1:0,n=Fe?1:0;!function(e,t){var a="".concat(We.b,"/api/contacts/save_contact");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({user:Object(d.a)(Object(d.a)({},J),{},{emails:Ie,ewi_recipient:a,restriction:Ze,status:n}),affiliation:{site:ie,location:ue,scope:te,office:he},contact_numbers:{mobile_numbers:e,landline_numbers:t}},(function(e){var t,a=e.status,n=e.message;!0===a?(tt(),function(){if(!m){var e=Ge("Updating contacts list...",{variant:"warning",persist:!0});u(e)}}(),t="success"):t="error",Ge(n,{variant:t,autoHideDuration:5e3,action:nt})}))};return r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},!m&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:2,style:{textAlign:"-webkit-center"}},r.a.createElement(mo.a,null,r.a.createElement(Oo.a,null))),r.a.createElement(_.a,{item:!0,xs:9},r.a.createElement(y.a,{variant:"h5",align:"center"},"Contact Form")),r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(H.a,{edge:"start",onClick:tt},r.a.createElement(Ot.a,null))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Personal Details")),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"First Name",value:J.first_name,onChange:at("first_name"),margin:"dense",required:!0,error:""===J.first_name})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Last Name",value:J.last_name,onChange:at("last_name"),margin:"dense",required:!0,error:""===J.last_name})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Middle Name",value:J.middle_name||"",onChange:at("middle_name"),margin:"dense"})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Nickname",value:J.nickname||"",onChange:at("nickname"),margin:"dense"})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Affiliation")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ea,{div_id:"scope",label:"Scope",changeHandler:function(e){return ae(e.target.value)},value:te,list:Q,mapping:{id:"id",label:"label"},required:!0,error:""===te})),[0,1].includes(te)&&r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement($t,{value:ie,changeHandler:function(e){return oe(e)}})),[2,3,4].includes(te)&&r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Ea,{div_id:"location",label:Q[te].select_label,changeHandler:function(e){return de(e.target.value)},value:ue,list:Q[te].list,mapping:{id:"id",label:"label"},required:!0,error:""===ue})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Ea,{div_id:"office",label:"Office",changeHandler:function(e){return _e(e.target.value)},value:he,list:fe,mapping:{id:"id",label:"label"},required:!0,error:""===he})),r.a.createElement(_.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Re.a,null,r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:Fe,onChange:function(e){return ze(e.target.checked)},value:"checkedA",color:"primary"}),label:"Active"}))),r.a.createElement(_.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Re.a,null,r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:He,onChange:function(e){return Ye(e.target.checked)},value:"checkedB",color:"primary"}),label:"EWI Recipient"}))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ea,{div_id:"ewi_restriction",label:"Ewi Restriction",changeHandler:function(e){return Ke(e.target.value)},value:Ze,list:[{id:0,label:"No restrictions"},{id:1,label:"Do not send on Alert 1"},{id:2,label:"Do not send on Alert 2 and below"}],mapping:{id:"id",label:"label"},required:!0,error:""===Ze})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},"Mobile")),je.map((function(e,t){var a=e.mobile_number.sim_num,l=e.status,i="undefined"!==typeof e.has_delete,c=!0;return c=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(_.a,{item:!0,xs:7},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Mobile Number",value:a,onChange:function(e){return xe({type:"UPDATE",payload:{data:"sim_num",value:e.target.value,key:t},category:"mobile"})},InputProps:{inputComponent:Do,inputProps:{mask:Co}},required:!0,error:c}))),r.a.createElement(_.a,{item:!0,xs:3,style:{textAlign:"center"}},r.a.createElement(Be.a,{style:{margin:0},control:r.a.createElement(kt.a,{checked:Boolean(l),onChange:function(e){return xe({type:"UPDATE",payload:{data:"status",value:e.target.checked?1:0,key:t},category:"mobile"})},color:"primary"}),label:"Active"})),0!==t&&i?r.a.createElement(_.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(H.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return xe({type:"DELETE",payload:{key:t}})}},r.a.createElement(El.a,null))):r.a.createElement(re.a,null,r.a.createElement(_.a,{item:!0,xs:2})))})),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(jo.a,null),onClick:function(){return xe({type:"ADD",category:"mobile"})}},"Add number")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},"Landline")),0===Ce.length&&r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No landline number saved")),Ce.map((function(e,t){var a=e.landline_num,l=!0;return l=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(_.a,{item:!0,xs:10},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Landline Number",value:a,onChange:function(e){return we({type:"UPDATE",payload:{data:"landline_num",value:e.target.value,key:t},category:"landline"})},InputProps:{inputComponent:Do,inputProps:{mask:[/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/]}},required:!0,error:l}))),r.a.createElement(_.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(H.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return we({type:"DELETE",payload:{key:t}})}},r.a.createElement(El.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(jo.a,null),onClick:function(){return we({type:"ADD",category:"landline"})}},"Add number")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},"Email")),0===Ie.length&&r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),Ie.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(_.a,{item:!0,xs:10},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Email",value:e.email,onChange:function(e){return Me({type:"UPDATE",payload:{value:e.target.value,key:t},category:"email"})}}))),r.a.createElement(_.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(H.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return Me({type:"DELETE",payload:{key:t}})}},r.a.createElement(El.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(jo.a,null),onClick:function(){return Me({type:"ADD",category:"email"})}},"Add email")),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"16px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",style:{marginRight:6},onClick:function(){return rt()},disabled:$e},"Save"),r.a.createElement(p.a,{variant:"contained",onClick:tt},"Cancel")))}));var Ho=r.a.memo((function(e){var t=e.open,a=e.setSaveContactModal,l=e.mobileDetails,i=l.sim_num,s=l.mobile_id,m={emails:[],ewi_recipient:[],ewi_restriction:[],landline_numbers:[],first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0,organizations:[],status:0,mobile_numbers:[{mobile_number:{sim_num:i,mobile_id:s},priority:0,status:1}]},u=Object(n.useContext)(xs).contacts,d=Object(n.useState)("existing"),b=Object(o.a)(d,2),f=b[0],g=b[1],E=Object(n.useState)(!0),v=Object(o.a)(E,2),h=v[0],y=v[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)(!0),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(c.b)().enqueueSnackbar,I=u.map((function(e){var t=e.user_id,a=e.first_name,n=e.last_name;return{label:"".concat(a," ").concat(n),value:t,data:e}})),M=function(){a(!1)};return r.a.createElement(Me.a,{open:t,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Save mobile number (+".concat(i,")")),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Choose whether to add number to an existing contact or fill-out a new contact form."),r.a.createElement(Re.a,{component:"fieldset",style:{display:"flex",marginBottom:16}},r.a.createElement(Ye.a,{"aria-label":"save-number-options",name:"save-number-options",row:!0,style:{justifyContent:"space-around"},value:f,onChange:function(e){return g(e.target.value)}},r.a.createElement(Be.a,{value:"existing",control:r.a.createElement(Pe.a,null),label:"Add to existing contact"}),r.a.createElement(Be.a,{value:"new",control:r.a.createElement(Pe.a,null),label:"Create new contact"}))),"existing"===f&&r.a.createElement(_.a,{container:!0,spacing:2,style:{marginBottom:200}},r.a.createElement(_.a,{item:!0,xs:8},r.a.createElement(Zt,{label:"Contact Person",options:I,value:x,changeHandler:function(e){return S(e)},placeholder:"Type name of contact person",openMenuOnClick:!1,renderDropdownIndicator:!1,isClearable:!0})),r.a.createElement(_.a,{item:!0,xs:4},r.a.createElement(xe.a,{title:"Inactive numbers will not receive EWI if a contact is an EWI recipient.",arrow:!0},r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:w,onChange:function(e){return A(e.target.checked)},name:"is_active",color:"primary"}),label:"Set as active"})))),"new"===f&&r.a.createElement(To,{setContactForm:function(e){y(!1)},chosenContact:m,isEditMode:h,setContactFormForEdit:function(e){y(e)},handleClose:M,isFromChatterbox:!0})),"existing"===f&&r.a.createElement(Le.a,null,r.a.createElement(p.a,{variant:"text",onClick:function(){!function(e,t){var a="".concat(We.b,"/api/contacts/attach_mobile_number_to_existing_user");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({user_id:x.value,mobile_id:s,status:w?1:0},(function(e){var t,a=e.status,n=e.message;!0===a?(M(),t="success"):t="error",D(n,{variant:t,autoHideDuration:4e3})}))},color:"secondary"},"Save"),r.a.createElement(p.a,{variant:"text",onClick:M,color:"primary"},"Cancel")))})),Ro=Object(O.a)((function(e){return{inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}}));function Yo(e){var t=[],a=[];return e.forEach((function(n){var r=n.user,l=n.status,i=r.first_name,c=r.last_name,o=r.organizations,s="".concat(i," ").concat(c),m=st(o);1===e.length&&(a=Object(Xe.a)(m));var u=s,d=null;m.length>0&&(u="".concat(m[0].toUpperCase(),": ").concat(m.slice(1).join(", ")),d=m[0]),t.push({sender:s,org:u,level:d,inactive:!l})})),{sender_arr:t,orgs_arr:a}}function Bo(e,t){var a=t.sms_msg,n=t.ts,l=t.source,i=t.send_status,c=t.ts_sent,o=function(e){var t=X()(e);return t.isSame(X()(),"day")?t.format("HH:mm"):t.format("MMM D")}(n);return r.a.createElement(_.a,{container:!0,justify:"space-between",spacing:0},r.a.createElement(_.a,{item:!0,xs:1,style:{flexBasis:0,marginRight:6}},"inbox"===l?r.a.createElement(uo.a,{fontSize:"small"}):r.a.createElement(po.a,{fontSize:"small"})),r.a.createElement(_.a,{item:!0,xs:!0,className:e.overflowEllipsis},a),r.a.createElement(_.a,{item:!0,style:{marginRight:8},className:e.noFlexGrow},o),r.a.createElement(_.a,{item:!0,style:{paddingTop:2,marginRight:8}},(0===i||null===i&&null!==c)&&r.a.createElement(bo.a,{className:e.sentIcon}),i>0&&i<=5&&r.a.createElement(la.a,{color:"primary",className:e.sentIcon}),(-1===i||i>5)&&r.a.createElement(fo.a,{color:"error",className:e.sentIcon})))}var Po=function(e){var t=e.messagesArr,a=e.hidden,l=Ro(),i=Object(d.a)(Object(d.a)({},e),{},{classes:l}),c=r.a.useState(!1),m=Object(o.a)(c,2),u=m[0],p=m[1],b=r.a.useState(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],h=r.a.useState(!1),O=Object(o.a)(h,2),j=O[0],x=O[1],S=r.a.useState(!1),k=Object(o.a)(S,2),C=k[0],w=k[1],A=r.a.useState({}),D=Object(o.a)(A,2),I=D[0],M=D[1],N=function(e,t){E(e),M(t),p(!0)};return r.a.createElement(n.Fragment,null,0===t.length?r.a.createElement(v.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?l.hidden:""},r.a.createElement("div",null,"No conversations")):r.a.createElement(hn.a,{dense:!0,className:a?l.hidden:""},t.map((function(e,t){return function(e,t,a,l){var i=e.messages,c=e.mobile_details,m=Object(o.a)(i,1)[0],u=t.classes,p=t.url,b=t.width,f=t.async,g=t.is_desktop,E=t.searchFilters,v=c.mobile_id,h=c.sim_num,O=c.users,j=ut(h),x=[{sender:j,org:j,inactive:!1}],S=[],k=0===O.length;if(!k){var C=Yo(O),w=C.sender_arr,A=C.orgs_arr;x=w,S=A}var D=null;"undefined"!==typeof E&&(D=Object(d.a)({},E));var I=E?"No conversations":"No conversation yet",M=r.a.createElement(go.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return r.a.createElement(s.b,{to:{pathname:"".concat(p,"/").concat(v),state:{async:f,search_filters:D}},key:"".concat(l,"-").concat(v),className:u.link},r.a.createElement(yn.a,{alignItems:"center",button:!0},r.a.createElement(so.a,null,r.a.createElement(mo.a,{alt:"User",src:vo.a,className:u.bigAvatar})),r.a.createElement(On.a,{primary:r.a.createElement(_.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:!0,className:u.noFlexGrow},r.a.createElement(y.a,{variant:"body1",className:u.overflowEllipsis,component:"div",style:{display:"flex",alignItems:"center"}},x.map((function(e,t){return r.a.createElement(n.Fragment,{key:"".concat(e.sender,"-").concat(v)},x.length>1&&e.inactive&&M,r.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<x.length-1&&","))})))),S.map((function(e,t){var a=0===t?"secondary":"primary";return r.a.createElement(_.a,{key:t,item:!0,xs:!0,className:u.noFlexGrow},r.a.createElement(Yt.a,{color:a,size:"small",label:e}))})),r.a.createElement(_.a,{item:!0,xs:6,sm:!0,container:!0,justify:Object(K.c)("sm",b)?"flex-end":"flex-start",alignItems:"center"},1===x.length&&x[0].inactive&&M,r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},j)),r.a.createElement(_.a,{item:!0,xs:!0,style:{textAlign:"right",flexGrow:g?0:1,flexBasis:"auto"}},r.a.createElement(H.a,{size:"small",onClick:function(e){e.preventDefault(),a(k,c)}},r.a.createElement(St.a,null)))),primaryTypographyProps:{className:u.overflowEllipsis},secondary:i.length>0?Bo(u,m):r.a.createElement("div",{style:{textAlign:"center"}},I),secondaryTypographyProps:{component:"div"}})))}(e,i,N,t)}))),r.a.createElement(_o,{open:u,onClose:function(e){p(!1)},isUnregistered:g,setBlockModal:x,setSaveContactModal:w}),r.a.createElement(yo,{open:j,setBlockModal:x,mobileDetails:I,setOpenOptions:p}),r.a.createElement(Ho,{open:C,setSaveContactModal:w,mobileDetails:I,setOpenOptions:p}))},Lo=a(873),Fo=a(874),zo=a(871),Uo=a(872);var Wo=Object(O.a)((function(e){return Object(F.d)(e)}));var Go=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.tagOption,c=e.isMobile,s=e.tagObject,m=e.mobileDetails,u=e.message,d=Wo(),b=function(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],l=a[1],i=it.a.CancelToken.source();return Object(n.useEffect)((function(){var t="".concat(We.b,"/api/chatterbox/get_message_tag_options/sms").concat(e,"_users");it.a.get(t,{cancelToken:i.token}).then((function(e){var t=e.data.map((function(e){return{value:e.tag_id,label:e.tag}}));l(t)})).catch((function(e){console.log(e)}))}),[e]),r}(i),f=Object(n.useState)(null),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(n.useState)([]),_=Object(o.a)(h,2),y=_[0],O=_[1],j=Object(n.useState)(!1),S=Object(o.a)(j,2),k=S[0],C=S[1],w=Object(n.useState)(null),A=Object(o.a)(w,2),D=A[0],I=A[1],M=Object(n.useState)(""),N=Object(o.a)(M,2),T=N[0],H=N[1],R=m.users.length>0;Object(n.useEffect)((function(){var e=!1;null!==E&&(e=E.some((function(e){return"#AlertFYI"===e.label}))),C(e)}),[E]);var Y=Object(n.useState)(!1),B=Object(o.a)(Y,2),P=B[0],L=B[1];return Object(n.useEffect)((function(){var e=!1;R?k&&(null!==D&&""!==T||(e=!0)):e=!0,L(e)}),[k,D,T]),Object(n.useEffect)((function(){var e=s.tags.map((function(e){return{value:e.tag_id,label:e.tag.tag}}));v(e),O(e)}),[s]),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Chatterbox Message Tagging"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Attach or remove tags to a message."),r.a.createElement(He.a,{className:d.dyna_error},"NOTE: You must manually remove any site logs created (if any) by a tag when removing a tag to a message."),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Zt,{label:"Tags",options:b,value:E,changeHandler:function(e){return v(e)},placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),k&&r.a.createElement(n.Fragment,null,r.a.createElement(He.a,{color:"textPrimary"},"Alert FYI"),r.a.createElement($t,{value:D,changeHandler:function(e){return I(e)},isMulti:!0,required:!0}),r.a.createElement(na.a,{component:"legend",style:{marginTop:24}},"Purpose"),r.a.createElement(Ye.a,{"aria-label":"fyi-purpose",name:"fyi-purpose",row:!0,style:{justifyContent:"space-around"},value:T,onChange:function(e){return H(e.target.value)}},r.a.createElement(Be.a,{value:"alert raising",control:r.a.createElement(Pe.a,null),label:"Alert raising"}),r.a.createElement(Be.a,{value:"alert lowering",control:r.a.createElement(Pe.a,null),label:"Alert lowering"}))),!c&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{color:"primary",onClick:function(){var e=s.id,t=s.source,a=s.ts,n=null,r=[];R&&!k?(m.users.forEach((function(e){e.user.organizations.forEach((function(e){var t=e.site.site_id;!r.includes(t)&&r.push(t)}))})),n=function(e){var t=e.sim_num,a=e.users,n=t;if(a.length>0){var r=Yo(a).sender_arr,l=[];r.forEach((function(e){var t=e.sender,a=e.level;if(!e.inactive){var n=null!==a?"".concat(a," "):"";l.push("".concat(n).concat(t))}})),l.length>0&&(n=l.join(", ")),l.length>1&&(n+="(shared number)")}return n}(m)):k&&(r=D.map((function(e){return e.value})));var i="inbox"===t?"inbox_id":"outbox_id",c=[];if(y.length>0&&(c=null===E?Object(Xe.a)(y):y.filter((function(e){return!E.some((function(t){return t.value===e.value}))}))),c.length>0){var o=c.map((function(e){return e.value})),d={tag_type:"sms".concat(t,"_user_tags"),tag_details:{[i]:e,delete_tag_id_list:o}};console.log("delete_payload",d),function(e,t){pt("".concat(We.b,"/api/general_data_tag/handle_delete_tags"),e,t)}(d,(function(e){console.log("untag response",e)}))}var p,b=[];if(null!==E&&(b=E.filter((p=0,function(e){return e!==y[p]||!++p}))),b.length>null){var f=b.map((function(e){return e.value})),g={tag_type:"sms".concat(t,"_user_tags"),contact_person:n,message:k?T:u,tag_details:{user_id:Object(x.a)().user_id,[i]:e,tag_id_list:f,site_id_list:r,ts:X()().format("YYYY-MM-DD HH:mm:ss"),ts_message:a}};console.log("PAYLOAD",g),function(e,t){pt("".concat(We.b,"/api/general_data_tag/handle_update_insert_tags"),e,t)}(g,(function(e){console.log("tag response",e)}))}l()},disabled:P},"Submit"),r.a.createElement(p.a,{onClick:l},"Cancel")))})),qo=Object(O.a)((function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"},chatItemSent:{justifyContent:"flex-end"},chatBubble:{flexGrow:0,maxWidth:"65%",[e.breakpoints.down("xs")]:{maxWidth:"75%"},[e.breakpoints.up("md")]:{maxWidth:"50%"},paddingLeft:"12px !important",paddingRight:12,paddingTop:12,paddingBottom:6,border:"solid 1px rgba(215, 215, 215, 1)",backgroundColor:"rgba(245, 245, 245, 1)"},chatBubbleReceived:{marginLeft:14,"&:before":{content:"''",left:69,right:"auto",top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:71.5,right:"auto",top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatBubbleSent:{marginRight:14,"&:before":{content:"''",left:"auto",right:69,top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:"auto",right:71.5,top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatMessage:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",fontSize:"0.75rem",lineHeight:"1.25em"},timestampArea:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:12},timestamp:{fontSize:"0.65rem"},tagButton:{padding:0,zIndex:1},sentIcon:{fontSize:"1rem"}}}));var Vo=Object(O.a)((function(e){return{arrow:{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}},popper:(t=e.palette.common.black,{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(t," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(t," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(t," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(t)}}}),tooltip:{position:"relative",backgroundColor:e.palette.common.black},tooltipPlacementLeft:{margin:"0 8px"},tooltipPlacementRight:{margin:"0 8px"},tooltipPlacementTop:{margin:"8px 0"},tooltipPlacementBottom:{margin:"8px 0"}};var t}));function Qo(e){var t=Vo(),a=t.arrow,n=Object(Ht.a)(t,["arrow"]),l=r.a.useState(null),i=Object(o.a)(l,2),c=i[0],s=i[1],m=e.title;return r.a.createElement(xe.a,Object.assign({classes:n,PopperProps:{popperOptions:{modifiers:{arrow:{enabled:Boolean(c),element:c}}}}},e,{title:r.a.createElement(r.a.Fragment,null,m,r.a.createElement("span",{className:a,ref:s}))}))}var Zo,Ko=function(e){var t=e.message_list,a=e.mobileDetails,l=e.searchFilters,i=e.setScrollToBottom,c=qo(),s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],b=Object(n.useState)(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],O=h[1],x={id:"",source:"",tags:[]},S=Object(n.useState)(x),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)(1),D=Object(o.a)(A,2),I=D[0],M=D[1],N=Object(n.useState)([]),T=Object(o.a)(N,2),R=T[0],Y=T[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1];Object(n.useEffect)((function(){var e=t.slice(0).reverse();d(e),Y(e),i(!0)}),[t]);var z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,a=arguments.length>2?arguments[2]:void 0;return function(){w(t),E(e),O(a)}},U=function(e){var t=e.convo_id,a=u.map((function(e){return e.convo_id===t&&(e.send_status=0),e}));d(a),function(e,t){var a="".concat(We.b,"/api/chatterbox/resend_message/").concat(e);it.a.get(a).then((function(e){var a=e.data;console.log("Resend message",a),"undefined"!==typeof t&&t(a)})).catch((function(e){console.error(e)}))}(t)},W=l?"No conversations":"No conversation yet";return r.a.createElement(n.Fragment,null,0===t.length&&r.a.createElement(y.a,{variant:"subtitle1",align:"center",style:{marginTop:8}},W),R.length>=20&&r.a.createElement(p.a,{color:"primary",size:"small",fullWidth:!0,onClick:function(){var e=a.mobile_id;F(!0),function(e,t,a){var n="".concat(We.b,"/api/chatterbox/load_more_messages/").concat(e,"/").concat(t);it.a.get(n).then((function(e){var t=e.data;console.log("Additional loaded messages",t),a(t)})).catch((function(e){console.error(e)}))}(e,I,(function(e){F(!1),Y(e);var t=e.slice(0).reverse();d(t.concat(u))})),M(I+1)},endIcon:L&&r.a.createElement(j.a,{size:"1.5rem"})},r.a.createElement("strong",null,"Load",L&&"ing"," more messages...")),r.a.createElement(hn.a,{className:c.root},u.map((function(e){return function(e,t,a,l){var i=t.convo_id,c=t.source,s=t.sms_msg,m=t.ts,u=t.ts_sent,d=t.send_status,p=t.tags,b={tags:p,source:c,id:t["".concat(c,"_id")],ts:m},f="outbox"===c,g=X()(m).format("M/D/YYYY HH:mm:ss"),E=r.a.createElement(so.a,{style:{textAlign:"-webkit-center"}},r.a.createElement(mo.a,{alt:"Remy Sharp",src:vo.a})),v=p.length>0,h=v?r.a.createElement(zo.a,{fontSize:"small",color:"primary"}):r.a.createElement(Uo.a,{fontSize:"small",color:"primary"}),_=p.map((function(e){return e.tag.tag})).join(", "),O=[E,r.a.createElement(On.a,{className:"".concat(e.chatBubble," ").concat(f?e.chatBubbleSent:e.chatBubbleReceived),primary:r.a.createElement(y.a,{component:"span",className:e.chatMessage,variant:"body2",color:"textPrimary"},r.a.createElement("span",{style:{paddingRight:6,zIndex:1}},s),r.a.createElement(Qo,{disableFocusListener:!0,disableHoverListener:!v,title:_},r.a.createElement(H.a,{className:e.tagButton,onClick:a(!0,b,s)},h))),secondary:r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.timestamp,style:{paddingRight:f?6:0}},g),d>=0&&d<5&&null!==d&&r.a.createElement(Qo,{disableFocusListener:!0,title:"SENDING"},r.a.createElement(bo.a,{className:e.sentIcon})),5===d&&r.a.createElement(Qo,{disableFocusListener:!0,title:"SENT: ".concat(X()(u).format("M/D/YYYY HH:mm:ss"))},r.a.createElement(la.a,{color:"primary",className:e.sentIcon})),(-1===d||d>5)&&r.a.createElement(n.Fragment,null,r.a.createElement(Qo,{disableFocusListener:!0,title:"UNSENT"},r.a.createElement(fo.a,{color:"error",className:e.sentIcon})),r.a.createElement(Qo,{disableFocusListener:!0,title:"Resend"},r.a.createElement(Yr.a,{color:"action",className:e.sentIcon,onClick:function(){return l(t)}})))),secondaryTypographyProps:{component:"div",className:e.timestampArea}})];f&&(O=O.reverse());var j=O,x=Object(o.a)(j,2),S=x[0],k=x[1];return r.a.createElement(yn.a,{alignItems:"flex-start",className:f?e.chatItemSent:"",key:i},S,k)}(c,e,z,U)}))),r.a.createElement(Go,{isOpen:g,closeHandler:z(!1),tagOption:C.source,tagObject:C,mobileDetails:a,message:_}))};function Jo(){"undefined"!==typeof Zo&&null!==Zo||(Zo=Ue()("".concat(We.b,"/communications"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function Xo(e,t){Jo(),"chatterbox"===t?(Zo.emit("get_latest_messages"),Zo.emit("get_all_mobile_numbers"),Zo.emit("get_all_contacts")):"contacts"===t&&Zo.emit("get_all_contacts"),Zo.on("reconnecting",(function(){e(!0)})),Zo.on("reconnect",(function(){e(!1)})),Zo.on("reconnect_failed",(function(){console.log("failed")}))}function $o(e){Jo(),Zo.on("receive_all_contacts",(function(t){console.log("All Contacts",t),e(t)}))}function es(){Zo.removeListener("receive_all_contacts")}var ts=Object(O.a)((function(e){var t=Object(F.d)(e);return{regularContainer:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(d.a)({},t.pageContentMargin),divider:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),sticky:{position:"sticky",top:56,[e.breakpoints.up("sm")]:{top:63},[e.breakpoints.up("md")]:{top:118},backgroundColor:"white",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",zIndex:3},chatHead:{paddingLeft:8,[e.breakpoints.up("md")]:{paddingLeft:0},display:"flex",alignItems:"center"},backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40},noFlexGrow:{flexGrow:0}}})),as=function(){return r.a.createElement(Oe.a,{height:70,width:800,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 800 70",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},r.a.createElement("rect",{x:"69",y:"7",rx:"4",ry:"4",width:"663",height:"19"}),r.a.createElement("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"293",height:"14"}),r.a.createElement("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"201",height:"6"}),r.a.createElement("circle",{cx:"30",cy:"30",r:"30"}))},ns=function(e){return r.a.createElement(Oe.a,{height:160,width:446,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"3 0 446 160",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},r.a.createElement("circle",{cx:"19",cy:"25",r:"16"}),r.a.createElement("rect",{x:"40",y:"12",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"40",y:"29",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"420",cy:"71",r:"16"}),r.a.createElement("rect",{x:"179",y:"76",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"179",y:"58",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"21",cy:"117",r:"16"}),r.a.createElement("rect",{x:"45",y:"104",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"45",y:"122",rx:"5",ry:"5",width:"220",height:"10"}))};function rs(e){var t=e.mobile_details,a=e.classes,l=e.saveNumberModal,i=e.searchFilters,c=t.users,s=ut(t.sim_num),m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],p=u[1],b=[{sender:s,org:s,inactive:!1}],f=[],g=0===c.length;if(!g){var E=Yo(c),v=E.sender_arr,O=E.orgs_arr;b=v,f=O}var j=r.a.createElement(go.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return r.a.createElement(_.a,{container:!0,alignItems:"center"},r.a.createElement("div",{style:{marginRight:12}},r.a.createElement(mo.a,{alt:"User",src:vo.a,className:a.bigAvatar})),r.a.createElement("div",null,r.a.createElement(_.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:!0},r.a.createElement(y.a,{variant:"body1",component:"div",style:{display:"flex",alignItems:"center"}},b.map((function(e,t){return r.a.createElement(n.Fragment,{key:e.sender},b.length>1&&e.inactive&&j,r.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<b.length-1&&","))})))),f.map((function(e,t){var n=0===t?"secondary":"primary";return r.a.createElement(_.a,{key:t,item:!0,xs:!0,className:a.noFlexGrow},r.a.createElement(Yt.a,{color:n,size:"small",label:e}))}))),!g&&r.a.createElement(_.a,{container:!0,alignItems:"center"},1===b.length&&b[0].inactive&&j,r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},s))),r.a.createElement(h.a,{ml:1,flex:"display"},i&&r.a.createElement(xe.a,{title:"Filters enabled",arrow:!0},r.a.createElement(Lo.a,{color:"primary"}))),g&&r.a.createElement(_.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},r.a.createElement(H.a,{size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){p(e.currentTarget)}},r.a.createElement(St.a,null)),r.a.createElement(R.a,{id:"simple-menu",anchorEl:d,getContentAnchorEl:null,keepMounted:!0,open:Boolean(d),onClose:function(){p(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(Y.a,{style:{fontSize:12},key:"save_unknown",onClick:function(){p(null),l()}},"Save unknown number"))))}var ls=function(e){return function(t){t.preventDefault(),e.goBack()}};var is=function(e){var t=e.history,a=e.match.params.mobile_id,l=e.location.state,i=l.async,s=l.search_filters,m=e.messageCollection,u=e.socket,d=ts(),b=Object(x.a)(),f=Object(c.b)(),g=f.enqueueSnackbar,E=f.closeSnackbar,v=Object(n.useState)(!1),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)({message_list:null,mobile_details:{}}),j=Object(o.a)(O,2),S=j[0],k=j[1],C=Object(n.useState)(""),w=Object(o.a)(C,2),A=w[0],D=w[1];Object(n.useEffect)((function(){var e;return i&&"undefined"!==typeof u&&(u.emit("join_mobile_id_room",{mobile_id:a,search_filters:s}),e=function(e){var t=e.mobile_details,a=e.messages;k({mobile_details:t,message_list:a})},Jo(),Zo.on("receive_mobile_id_room_update",(function(t){console.log("Mobile ID Room Update",t),e(t)}))),function(){i&&"undefined"!==typeof u&&(u.emit("leave_mobile_id_room",a),Zo.removeListener("receive_mobile_id_room_update"))}}),[u,a]);var I=S.mobile_details,M=S.message_list;if(!i&&null!==m.inbox){var N=Object(Xe.a)(m.inbox).filter((function(e){return e.mobile_details.mobile_id===parseInt(a,10)}));if(N.length>0){var T=N.pop(),R=T.mobile_details,Y=T.messages;I=R,M=Y}}var B=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){E(e)}},"Dismiss")},P=Object(n.useRef)(null),L=Object(n.useState)(!1),F=Object(o.a)(L,2),z=F[0],U=F[1];return Object(n.useEffect)((function(){P.current.scrollIntoView()}),[z]),r.a.createElement(n.Fragment,null,null==M?r.a.createElement("div",{className:d.regularContainer,style:{paddingLeft:16,paddingBottom:0}},r.a.createElement(as,null)):r.a.createElement("div",{className:"".concat(d.regularContainer," ").concat(d.sticky)},r.a.createElement("div",{className:d.chatHead},r.a.createElement(H.a,{"aria-label":"Back",color:"primary",className:d.backButton,onClick:ls(t)},r.a.createElement(Fo.a,{className:d.backIcon})),r.a.createElement(rs,{mobile_details:I,classes:d,saveNumberModal:function(){y(!0)},searchFilters:s}))),r.a.createElement("div",{className:d.regularContainer},null===M?r.a.createElement("div",{style:{padding:"0 16px"}},r.a.createElement(ns,{style:{height:"100%"}})):r.a.createElement(Ko,{message_list:M,searchFilters:s,mobileDetails:I,setScrollToBottom:U})),null!==M&&r.a.createElement(n.Fragment,null,r.a.createElement(ce.a,{className:d.divider}),r.a.createElement("div",{className:d.chatInputContainer},r.a.createElement(aa,{value:A,disableSend:""===A,setComposedMessage:D,messageChangeHandler:function(e){return D(e.target.value)},sendButtonClickHandler:function(){var e=I,t=e.mobile_id,a=e.gsm_id;Dt({sms_msg:"".concat(A," - ").concat(b.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:[{mobile_id:t,gsm_id:a}]},(function(e){e.status?(g("EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:B}),D("")):g(e.message,{variant:"error",autoHideDuration:7e3,action:B})}),(function(){g("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:B})}))}}))),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:P}),r.a.createElement(Ho,{open:_,setSaveContactModal:y,mobileDetails:I}))},cs=Object(O.a)((function(e){return{dialogContent:{"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}}}}));var os=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.recipientsList,i=cs();return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send a Message"),r.a.createElement(H.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Te.a,{className:i.dialogContent},r.a.createElement(He.a,null,"Choose your recipients and compose a message, then send it."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(ma,{isMobile:t,textboxValue:"",recipientsList:l,modalStateHandler:a}))),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),ss=a(772),ms=a(539),us=a(311),ds=a.n(us),ps=a(519);var bs=Object(ps.a)(Object(u.a)((function(e){return{fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:1}}})),Object(K.a)())((function(e){var t=e.classes,a=e.clickHandler,n=e.width;return r.a.createElement(ss.a,{in:!0,unmountOnExit:!0,style:{transitionDelay:"100ms"}},r.a.createElement(ms.a,{color:"secondary","aria-label":"Add",className:t.fab,size:Object(K.c)("md",n)?"large":"medium",onClick:a},r.a.createElement(ds.a,null)))})),fs=Object(O.a)((function(e){return{link:{textDecoration:"none"}}}));var gs=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,l=e.setSearchResultsToEmpty,i=e.modalState,c=e.url,m=e.isMobile,u=(fs(),Object(n.useContext)(Kt).organizations),d=Object(n.useState)([]),b=Object(o.a)(d,2),f=b[0],g=b[1];Object(n.useEffect)((function(){var e=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}}));g(e)}),[u]);var E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],O=v[1],j=Object(n.useState)([]),x=Object(o.a)(j,2),S=x[0],k=x[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],D=w[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)(null),R=Object(o.a)(H,2),Y=R[0],B=R[1],P=Object(n.useState)(null),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)(!0),W=Object(o.a)(U,2),G=W[0],q=W[1],V=h.length>0||S.length>0,Q=[Y,F].every((function(e){return null===e})),Z=[Y,F].every((function(e){return null!==e}))||Q;return Object(n.useEffect)((function(){var e=!0;V?Z&&(e=!1):Z&&!Q&&(e=!1),q(e)}),[h,S,Y,F]),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:i,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Search Chatterbox"),r.a.createElement(Te.a,{style:{overflowY:"hidden"}},r.a.createElement(He.a,null,"Fill in at least one field from any of the filters. NOTE: the broader the search filters, the longer the query might run."),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(y.a,{variant:"subtitle1",component:_.a,item:!0,xs:12},"CONTACT FILTERS"),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement($t,{value:h,changeHandler:function(e){return O(e||[])},isMulti:!0})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Zt,{label:"Organization(s)",options:f,value:S,changeHandler:function(e){return k(e||[])},placeholder:"Select organization(s)",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(y.a,{variant:"subtitle1",component:_.a,item:!0,xs:12},"MESSAGE FILTERS"),r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(wt.b,{autoOk:!0,label:"Start Date/Time",value:Y,onChange:function(e){return B(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null===Y&&null!==F,helperText:null===Y&&null!==F&&"Both date/time must have values"})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(wt.b,{autoOk:!0,label:"End Date/Time",value:F,onChange:function(e){return z(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null!==Y&&null===F,helperText:null!==Y&&null===F&&"Both date/time must have values"}))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),!G&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:A,onChange:function(e){return D(e.target.checked)},name:"onlyEWIRecipients"}),label:"Only EWI recipients"})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:N,onChange:function(e){return T(e.target.checked)},name:"includeInactiveNumbers"}),label:"Include inactive numbers"})))),!m&&r.a.createElement("div",{style:{height:100}})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:a},"Cancel"),r.a.createElement(p.a,{onClick:function(){a(),l()},color:"secondary",disabled:G,component:s.b,to:{pathname:"".concat(c,"/search_results"),state:{sites:h,organizations:S,only_ewi_recipients:A,include_inactive_numbers:N,ts_start:Y?X()(Y).format("YYYY-MM-DD HH:mm:ss"):Y,ts_end:F?X()(F).format("YYYY-MM-DD HH:mm:ss"):F}}},"Search")))})),Es=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{regularContainer:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(d.a)({},t.pageContentMargin),divider:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40}})})),vs=function(e){return function(t){t.preventDefault(),e.goBack()}};function hs(e){var t=e.width,a=e.history;return Object(K.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:vs(a),startIcon:r.a.createElement(wi.a,null)},"Back to conversation list"):r.a.createElement(H.a,{variant:"contained",color:"primary",size:"small",onClick:vs(a)},r.a.createElement(wi.a,null))}var _s=function(e){var t=e.location,a=e.socket,l=e.width,i=e.url,c=e.is_desktop,s=e.searchResults,m=e.setSearchResults,u=e.ListLoader,d=Es(),p=t.state,b=p.sites,f=p.organizations,g=p.only_ewi_recipients,E=p.include_inactive_numbers,v=p.ts_start,O=p.ts_end,j=Object(n.useState)(!1),x=Object(o.a)(j,2),S=x[0],k=x[1],C=null===b&&null===f;return Object(n.useEffect)((function(){var e,t=0===s.length;if(!C&&t){k(!0);var n={site_ids:b.map((function(e){return e.value})),org_ids:f.map((function(e){return e.value})),only_ewi_recipients:g,include_inactive_numbers:E,ts_start:v,ts_end:O};"undefined"!==typeof a&&(a.emit("get_search_results",n),e=function(e){k(!1),m(e)},Zo.on("receive_search_results",(function(t){console.log("Chatterbox Search Results",t),e(t)})))}return function(){"undefined"!==typeof a&&Zo.removeListener("receive_search_results")}}),[a,b,f,v,O]),r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(ge,{title:"Communications | Chatterbox"}),r.a.createElement(_.a,{container:!0},r.a.createElement("div",null,r.a.createElement(hs,e)),r.a.createElement(re.a,{smDown:!0},r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:12}})),r.a.createElement(y.a,{component:_.a,item:!0,xs:!0,variant:"h5"},"Search Results"),r.a.createElement(re.a,{smUp:!0},r.a.createElement(_.a,{item:!0,xs:12,style:{marginBottom:8}}))),r.a.createElement(h.a,{display:"flex",flexWrap:"wrap"},0!==b.length&&r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Site(s):")," ",b.map((function(e){return e.data.site_code.toUpperCase()})).join(", "))),0!==f.length&&r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Organizations(s):")," ",f.map((function(e){return e.label})).join(", "))),v&&r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Start Date/Time:"),v)),O&&r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"End Date/Time:"),O)),r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Only EWI Recipients:")," ",ot(g.toString()))),r.a.createElement(h.a,{mr:2},r.a.createElement(y.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Include Invalid Numbers:")," ",ot(E.toString())))),r.a.createElement(ce.a,{style:{marginTop:12}}),C&&r.a.createElement(y.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No search input")),S?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(u,null)):s.length>0?r.a.createElement(Po,{width:l,url:i,messagesArr:s,searchFilters:{ts_start:v,ts_end:O},async:!0,hidden:!1,is_desktop:c}):r.a.createElement(y.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No results found")))},ys=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{tabBar:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16}})})),Os=function(){return r.a.createElement(Oe.a,{speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 600 400",style:{width:"100%"}},r.a.createElement("circle",{cx:"47",cy:"48",r:"26"}),r.a.createElement("rect",{x:"90",y:"36",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"47",cy:"108",r:"26"}),r.a.createElement("rect",{x:"90",y:"96",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"168",r:"26"}),r.a.createElement("rect",{x:"90",y:"156",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"228",r:"26"}),r.a.createElement("rect",{x:"90",y:"216",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"288",r:"26"}),r.a.createElement("rect",{x:"90",y:"276",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"348",r:"26"}),r.a.createElement("rect",{x:"90",y:"336",rx:"0",ry:"0",width:"489",height:"29"}))};function js(e){var t=e.modalState,a=e.modalStateHandler;return r.a.createElement(Me.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:t},r.a.createElement(Ne.a,{id:"simple-dialog-title"},"Chatterbox Information"),r.a.createElement(Te.a,null,r.a.createElement(y.a,{variant:"h6",gutterBottom:!0,align:"center"},"Inbox"),r.a.createElement(y.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Inbox tab contains the list of our contacts who recently sent a message to our server. The first contact in the list is the most recent message sender, and so on.",r.a.createElement("br",null),r.a.createElement("br",null),"\u2003\u2003Unlike a regular message list on a messaging app, outbound messages to our contacts do not affect the order of the list nor the appearance of a contact on the list (because our server sends a lot of messages, especially when routine, that incoming messages might get unnoticed)."),r.a.createElement(ce.a,{style:{margin:"8px 0"}}),r.a.createElement(y.a,{variant:"h6",gutterBottom:!0,align:"center"},"Unsent"),r.a.createElement(y.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Unsent tab displays conversation threads which contains unsent messages within one day span. Unsent messages refer to messages in the process of sending or messages with failed sending attempt.")))}var xs=Object(n.createContext)();var Ss=Object(K.a)()((function(e){var t=e.location,a=e.match.url,l=e.width,i=ys(),c=Object(n.useState)(0),s=Object(o.a)(c,2),u=s[0],d=s[1],b=Object(n.useState)(!1),f=Object(o.a)(b,2),g=f[0],E=f[1],v=Object(n.useState)(!1),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)({inbox:null,unsent:null}),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)([{label:"Inbox",href:"inbox"},{label:"Unsent",href:"unsent"}]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)([]),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)([]),R=Object(o.a)(T,2),Y=R[0],B=R[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)(!1),W=Object(o.a)(U,2),G=W[0],q=W[1],V=function(e,t){return function(){"send"===e?E(t):"search"===e?y(t):"info"===e&&q(t)}},Q=Object(n.useContext)(Kt).setIsReconnecting;Object(n.useEffect)((function(){var e;return Xo(Q,"chatterbox"),e=function(e){S(e);var t=e.unsent.length,a="Unsent",n=w.findIndex((function(e){return e.href===a}));t>0&&(a=r.a.createElement(io.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:t,overlap:"rectangle"},"Unsent")),A((function(e){return[].concat(Object(Xe.a)(e.slice(0,n)),[{label:a,href:"unsent"}])}))},Jo(),Zo.on("receive_latest_messages",(function(t){console.log("Latest messages",t),e(t)})),function(e){Jo(),Zo.on("receive_all_mobile_numbers",(function(t){console.log("All Saved Mobile Numbers",t),e(t)}))}((function(e){B(e)})),$o((function(e){return z(e)})),function(){Zo.removeListener("receive_latest_messages"),Zo.removeListener("receive_all_mobile_numbers"),es()}}),[]);var Z=Object(K.c)("md",l),J=r.a.createElement("span",null,r.a.createElement(H.a,{color:"primary","aria-label":"Chatterbox info",onClick:V("info",!0)},r.a.createElement(Hr.a,{fontSize:"large"})),r.a.createElement(p.a,{"aria-label":"Compose message",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:V("send",!0),startIcon:r.a.createElement(co.a,null)},"Compose"),r.a.createElement(p.a,{"aria-label":"Search messages",variant:"contained",color:"primary",size:"small",onClick:V("search",!0),startIcon:r.a.createElement(oo.a,null)},"Search"));return r.a.createElement(m.d,{location:t},r.a.createElement(m.b,{exact:!0,path:a,render:function(e){return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(ge,{title:"Communications | Chatterbox",customButtons:!!Z&&J})),r.a.createElement("div",{className:i.tabBar},r.a.createElement(ye,{chosenTab:u,onSelect:function(e){return d(e)},tabsArray:w})),r.a.createElement("div",{className:"".concat(i.tabBar," ").concat(i.tabBarContent)},r.a.createElement(xs.Provider,{value:{contacts:F}},null===x.inbox?r.a.createElement(Os,null):r.a.createElement(Po,{width:l,url:a,messagesArr:x.inbox,async:!0,hidden:0!==u,is_desktop:Z}),1===u&&(null===x.unsent?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Os,null)):r.a.createElement(Po,{width:l,url:a,messagesArr:x.unsent,async:!0,hidden:1!==u,is_desktop:Z})))),!Z&&r.a.createElement(bs,{clickHandler:V("send",!0)}),r.a.createElement(os,{modalStateHandler:V("send",!1),modalState:g,recipientsList:Y}),r.a.createElement(gs,{modalStateHandler:V("search",!1),modalState:_,setSearchResultsToEmpty:function(){return N([])},url:a}),r.a.createElement(js,{modalStateHandler:V("info",!1),modalState:G}))}}),r.a.createElement(m.b,{path:"".concat(a,"/search_results"),render:function(e){return r.a.createElement(xs.Provider,{value:{contacts:F}},r.a.createElement(_s,Object.assign({},e,{messageCollection:x,socket:Zo,url:a,width:l,is_desktop:Z,searchResults:M,setSearchResults:N,ListLoader:Os})))}}),r.a.createElement(m.b,{path:"".concat(a,"/:mobile_id"),render:function(e){return r.a.createElement(xs.Provider,{value:{contacts:F}},r.a.createElement(is,Object.assign({},e,{messageCollection:x,socket:Zo})))}}))})),ks=a(837),Cs=a(770),ws=a(382),As=a(534),Ds=a(877),Is=a(880),Ms=a(881),Ns=a(882),Ts=a(883),Hs=a(884),Rs=a(885),Ys=a(886),Bs=a(887),Ps=r.a.memo((function(e){var t=e.classes,a=e.row,n=e.index,l=e.onContactClickFn,i=a.user_id,c=a.first_name,o=a.last_name,s=a.organizations,m=st(s),u=mt(s);return r.a.createElement(yn.a,{button:!0,onClick:l(a,n),key:i},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Oo.a,null))),r.a.createElement(On.a,{primary:r.a.createElement(_.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(_.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(y.a,{variant:"body1",style:{marginRight:8}},"".concat(o,", ").concat(c))),m.map((function(e,a){var n=0===a,l=n?"secondary":"primary";return n&&u?r.a.createElement(_.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(xe.a,{arrow:!0,disableFocusListener:!0,title:"Contact Priority",placement:"top"},r.a.createElement(Yt.a,{color:l,size:"small",label:e,icon:r.a.createElement(Ds.a,{style:{color:"gold"}})}))):r.a.createElement(_.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(Yt.a,{color:l,size:"small",label:e}))})))}))}));var Ls=function(e){var t=e.contacts,a=e.onContactClickFn,n=e.classes;return r.a.createElement(hn.a,{dense:!0,style:{paddingTop:0}},t.map((function(e,t){return r.a.createElement(Ps,{row:e,index:t,onContactClickFn:a,classes:n,key:"list-".concat(t)})})))};var Fs=r.a.memo((function(e){var t=e.blocked_numbers,a=e.onBlockContactClickFn;return 0===t.length?r.a.createElement("div",null,"No blocked contact"):r.a.createElement(hn.a,{dense:!0,style:{paddingTop:0}},t.map((function(e){var t=e.mobile_number,n=t.mobile_id,l=t.sim_num;return r.a.createElement(yn.a,{button:!0,onClick:a(e),key:n},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(ho.a,null))),r.a.createElement(On.a,{primary:r.a.createElement(_.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(_.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(y.a,{variant:"body1",style:{marginRight:8}},"+".concat(l))))}))})))}));function zs(e){var t=e.row,a=t.network,l=t.prefixes;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{variant:"h5",style:{marginBottom:12}},a),r.a.createElement(v.a,{style:{padding:"24px 16px"}},r.a.createElement(_.a,{container:!0,spacing:3},l.map((function(e){return r.a.createElement(y.a,{variant:"body1",component:_.a,item:!0,xs:2,align:"center",key:e},e)})))))}var Us=r.a.memo((function(e){var t=function(e){var t=[],a=[];return e.forEach((function(e){var n=e.prefix,r=e.network_id,l="0".concat(n);1===r?a.push(l):t.push(l)})),[{network:"Globe",prefixes:a},{network:"Smart",prefixes:t}]}(e.sim_prefixes);return r.a.createElement(n.Fragment,null,t.map((function(e){return r.a.createElement(n.Fragment,{key:e.network},r.a.createElement(zs,{row:e}),r.a.createElement("div",{style:{marginBottom:24}}))})))})),Ws=a(831),Gs=a(878),qs=a(879),Vs=Object(O.a)((function(e){return{root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},title:{fontSize:14},pos:{marginBottom:12}}}));function Qs(e,t){var a="";return 0===e?a="community":1===e?a="barangay":2===e?a="municipal":3===e?a="provincial":4===e?a="regional":5===e&&(a="national"),{header:"".concat(ot(a)," ").concat(t.toUpperCase()),offices:"".concat(a,"_").concat(t)}}function Zs(e){var t=e.checkbox_data,a=e.updatePrimary,l=e.contact_per_org,i=e.setContactsPerOrg,c=e.contacts_key,s=e.classes,m=Object(n.useState)(0),u=Object(o.a)(m,2),d=u[0],b=u[1],f=[];Object(n.useEffect)((function(){var e=!1;if(t.find((function(e){return 1===e.primary_contact}))&&!1===e){e=!0;var a=t.find((function(e){return 1===e.primary_contact})).user_org_id.toString();b(a)}}),[]);return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,key:"contact_radio_button"},r.a.createElement(Re.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(na.a,{component:"legend",style:{textAlign:"center",marginBottom:8}},"Choose primary contact."),r.a.createElement(Ye.a,{"aria-label":"choose_primary_contact",name:"choose_primary_contact",value:d,onChange:function(e){b(e.target.value)},row:!0,style:{justifyContent:"space-around"}},t.map((function(e,t){var a=e.contact_person,n=e.user_org_id,l=a.first_name,i=a.last_name;return r.a.createElement(Be.a,{value:n.toString(),control:r.a.createElement(Pe.a,{color:"primary"}),label:"".concat(l," ").concat(i),key:"contact_radio_button_".concat(t+1)})}))))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:"small",className:s.button,style:{marginRight:8},startIcon:r.a.createElement(Gs.a,null),onClick:function(){a();var e=parseInt(d,10);t.forEach((function(t,a){var n=0;e===t.user_org_id&&(n=1),t.primary_contact=n,f.push(t)})),l[c]=f,i(l),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a="".concat(We.b,"/api/contacts/save_primary_contact");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save updated primary contact",a),null!==t&&t(a)})).catch((function(e){console.error(e)}))}(f,(function(e){var t;t="update_all_contacts",Jo(),Zo.emit(t)}))}},"Save"),r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",className:s.button,startIcon:r.a.createElement(qs.a,null),onClick:function(){return a()}},"Back")))}function Ks(e){var t=e.siteData,a=e.classes,l=e.isUpdatePrimary,i=e.setIsUpdatePrimary,c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)({}),b=Object(o.a)(d,2),f=b[0],g=b[1],E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],O=v[1],j=Object(n.useState)([]),x=Object(o.a)(j,2),S=x[0],k=x[1];Object(n.useEffect)((function(){i(!1);var e={},a=[];t.forEach((function(t,n){var r=t.org_name,l=Qs(t.scope,r).offices;void 0===e[l]?(e[l]=[t],a.push(l)):e[l].push(t)})),g(e),u(a)}),[t]);var C=function(e){i(!l),void 0!==e&&(O(f[e]),k(e))};return l?r.a.createElement(Zs,{checkbox_data:h,updatePrimary:C,contact_per_org:f,setContactsPerOrg:g,contacts_key:S,classes:a}):m.map((function(e,t){var n=f[e][0],l=Qs(n.scope,n.org_name).header,i=f[e].find((function(e){return 1===e.primary_contact})),c="No primary contact set";if("undefined"!==typeof i){var o=i.contact_person,s=o.first_name,m=o.last_name;c="".concat(s," ").concat(m)}return r.a.createElement(_.a,{item:!0,xs:12,sm:6,lg:4,align:"center",key:"contact_per_org_".concat(t+1)},r.a.createElement(Ya.a,{className:a.root,key:"contact_per_org_card_".concat(t+1)},r.a.createElement(Pa.a,{key:"contact_per_org_content_".concat(t+1)},r.a.createElement(y.a,{variant:"subtitle2"},l),r.a.createElement(y.a,{variant:"body1"},c)),r.a.createElement(Ws.a,{disableSpacing:!0},r.a.createElement(_.a,{container:!0,justify:"flex-end"},r.a.createElement(p.a,{size:"small",color:"primary",onClick:function(){return C(e)}},"Update")))))}))}var Js=r.a.memo((function(e){var t=e.siteLabel,a=e.siteID,l=e.siteData,i=Object(n.useState)(!1),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Vs();return r.a.createElement(n.Fragment,{key:"site_ID".concat(a+1)},r.a.createElement(le.a,null,r.a.createElement(ie.a,{expandIcon:r.a.createElement(Qn.a,null)},r.a.createElement(y.a,{variant:"body1"},t)),r.a.createElement(ce.a,null),r.a.createElement(oe.a,{className:u.details},r.a.createElement(_.a,{container:!0,spacing:3,style:{marginTop:6}},r.a.createElement(Ks,{siteData:l,classes:u,isUpdatePrimary:s,setIsUpdatePrimary:m}))),r.a.createElement(ce.a,null)))}),(function(e,t){return e.siteData.length===t.siteData.length}));var Xs=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.modalState,l=e.modalStateHandler,i=e.isMobile,c=e.contactsArray,s=e.classes,m=e.setChosenContact,u=Object(n.useContext)(Kt).organizations,d=Object(n.useState)([]),b=Object(o.a)(d,2),f=b[0],g=b[1];Object(n.useEffect)((function(){var e=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}}));g(e)}),[u]);var E,v=Object(n.useState)(null),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=r.a.useCallback((function(e){return function(){m(e),I()}}),[]),I=function(){l()};return Object(n.useEffect)((function(){var e=[];if(null!==x){var t=x.map((function(e){return e.value}));e=c.filter((function(e){var a=e.organizations,n=null;return 0!==a.length&&(n=a[0].organization.org_id),t.includes(n)}))}if(null!==_){var a=_.map((function(e){return e.data.site_code})),n=c;0!==e.length&&(n=e),e=[],n.forEach((function(t){t.organizations.every((function(n){var r=n.site.site_code;return!a.includes(r)||(e.push(t),!1)}))}))}e.length>0?A(e):A(null)}),[x,_]),r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Nt:Tt},r.a.createElement(Ne.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search contacts"),r.a.createElement(H.a,{color:"inherit",onClick:l,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Te.a,{style:{overflowY:"auto"}},r.a.createElement(He.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement($t,{value:_,changeHandler:function(e){return y(e)},isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Zt,{label:"Organizations",options:f,value:x,changeHandler:(E="organizations",function(e){"sites"===E?y(e):"organizations"===E&&S(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),null!==w?r.a.createElement(Ls,Object.assign({},e,{contacts:w,classes:s,onContactClickFn:D})):null,!i&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:l},"Close")))})),$s=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{tabBar:Object(d.a)(Object(d.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:{overflowY:"auto",height:"calc(100vh - 250px)",[e.breakpoints.down("md")]:{height:"80vh"}},insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"}})})),em=function(e){return r.a.createElement(Oe.a,Object.assign({speed:2,width:700,height:350,viewBox:"0 0 700 350"},e),r.a.createElement("rect",{x:"4",y:"8",rx:"3",ry:"3",width:"8",height:"317"}),r.a.createElement("rect",{x:"7",y:"317",rx:"3",ry:"3",width:"669",height:"8"}),r.a.createElement("rect",{x:"669",y:"9",rx:"3",ry:"3",width:"7",height:"313"}),r.a.createElement("rect",{x:"5",y:"8",rx:"3",ry:"3",width:"669",height:"7"}),r.a.createElement("rect",{x:"114",y:"52",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"77",cy:"60",r:"15"}),r.a.createElement("rect",{x:"116",y:"105",rx:"6",ry:"6",width:"420",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"113",r:"15"}),r.a.createElement("rect",{x:"115",y:"158",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"166",r:"15"}),r.a.createElement("rect",{x:"117",y:"211",rx:"6",ry:"6",width:"444",height:"15"}),r.a.createElement("circle",{cx:"79",cy:"219",r:"15"}),r.a.createElement("rect",{x:"117",y:"263",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"80",cy:"271",r:"15"}))};function tm(e){var t=e.contact,a=e.chosenContact,l=e.setSlideOpen,i=e.classes,c=e.setContactFormForEdit,o=e.siteOrgs,s=e.isContactPriority,m=o.sites,u=o.org,d=a.status,b=a.emails,f=a.ewi_recipient,g=a.landline_numbers,E=a.mobile_numbers,v=a.ewi_restriction;return r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(_.a,{item:!0,xs:2},r.a.createElement(mo.a,null,r.a.createElement(Oo.a,null))),r.a.createElement(_.a,{item:!0,xs:7},r.a.createElement(y.a,{variant:"h5",align:"center"},t)),r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(re.a,{smDown:!0,lgUp:!0},r.a.createElement(H.a,{onClick:function(){return l(!1)}},r.a.createElement(Ot.a,null)))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center",paragraph:!0},"Affiliation")),null!==u?r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(xe.a,{arrow:!0,disableFocusListener:!0,disableHoverListener:!s,title:"Contact Priority",placement:"top"},r.a.createElement(Yt.a,{color:"secondary",label:r.a.createElement(y.a,{variant:"body1"},u.toUpperCase()),icon:s?r.a.createElement(Ds.a,{style:{color:"gold"}}):null}))),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"center"},m.map((function(e){var t=e.site_code,a=ct(e,!1);return r.a.createElement(xe.a,{key:t,title:a,"aria-label":a},r.a.createElement(Yt.a,{color:"primary",label:r.a.createElement(y.a,{variant:"body2"},t.toUpperCase())}))})))):r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{color:"textSecondary",variant:"body2",align:"center",paragraph:!0},"No affiliations saved")),r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"Status"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",align:"center"},0===d?"Inactive":"Active")),r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Recipient"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",align:"center"},0===f?"No":"Yes")),v&&r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Restriction"))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",align:"center"},"Do not send on Alert ",v.alert_level," ",v.alert_level>1&&"and below"))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle1",align:"center"},"Mobile")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(hn.a,{dense:!0},0===E.length?r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{color:"textSecondary",variant:"body2",align:"center"},"No mobile numbers saved")):E.map((function(e){return r.a.createElement(yn.a,{key:e.mobile_number.mobile_id},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ae.a,null))),r.a.createElement(On.a,{primary:"+".concat(e.mobile_number.sim_num)}),r.a.createElement(ks.a,null,r.a.createElement(On.a,{secondary:"Status: ".concat(0===e.status?"Inactive":"Active")})))})))),r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle1",align:"center"},"Landline")),r.a.createElement(_.a,{item:!0,xs:12},0===g.length?r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{color:"textSecondary",variant:"body2",align:"center"},"No landline numbers saved")):r.a.createElement(hn.a,{dense:!0},g.map((function(e){return r.a.createElement(yn.a,{key:e.landline_id},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Is.a,null))),r.a.createElement(On.a,{primary:"+".concat(e.landline_num)}))})))),r.a.createElement(_.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle1",align:"center"},"Email")),r.a.createElement(_.a,{item:!0,xs:12},0===b.length?r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{color:"textSecondary",variant:"body2",align:"center"},"No email addresses saved")):r.a.createElement(hn.a,{dense:!0},b.map((function(e){return r.a.createElement(yn.a,{key:e.email_id},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ms.a,null))),r.a.createElement(On.a,{primary:"+".concat(e.email)}))})))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(gl.a,null),onClick:function(){return c(!0)}},"Edit")))}function am(e){var t=e.chosenContact,a=e.setSlideOpen;if(0===t.length)return r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(_.a,{item:!0,xs:7},r.a.createElement(y.a,{variant:"caption",display:"block"},"No initial blocked contact")));var n=t.mobile_number,l=t.reporter,i=t.ts,c=t.reason,o=n.sim_num,s=n.users,m=l.first_name,u=l.last_name,d="No contact details";s.length>0&&(d=s.map((function(e){return"".concat(e.user.last_name,", ").concat(e.user.first_name)})).join(" | "));var b=X()(i).format("MMMM D, YYYY, HH:mm:ss");return r.a.createElement(_.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(mo.a,null,r.a.createElement(Ns.a,null))),r.a.createElement(_.a,{item:!0,xs:7},r.a.createElement(y.a,{variant:"h5",align:"center"},"+".concat(o))),r.a.createElement(_.a,{item:!0,xs:1},r.a.createElement(re.a,{smDown:!0,lgUp:!0},r.a.createElement(H.a,{onClick:function(){return a(!1)}},r.a.createElement(Ot.a,null)))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Details")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},d)),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Reason")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",align:"center"},r.a.createElement("i",null,c))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",align:"center"},b)),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6",align:"center"},"Reporter")),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body1",align:"center"},"".concat(u,", ").concat(m))),r.a.createElement(_.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(Ts.a,null),disabled:!0},"Unblock (soon)")))}var nm=function(e){var t=e.search_str,a=e.setSearchStr,n=e.inputProps;return r.a.createElement(f.a,{margin:"dense",hiddenLabel:!0,fullWidth:!0,variant:"outlined",placeholder:"Type contact name",InputProps:n,value:t,onChange:function(e){return a(e.target.value)}})};var rm=function(e){var t=$s(),a=Object(n.useState)([]),l=Object(o.a)(a,2),i=l[0],s=l[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],b=Object(n.useState)({}),f=Object(o.a)(b,2),g=f[0],E=f[1],h=Object(n.useState)(0),O=Object(o.a)(h,2),j=O[0],x=O[1],S=Object(n.useState)(!1),k=Object(o.a)(S,2),C=k[0],w=k[1],A=Object(n.useState)(!1),D=Object(o.a)(A,2),I=D[0],T=D[1],R=Object(n.useState)(!1),Y=Object(o.a)(R,2),B=Y[0],P=Y[1],L=Object(n.useState)(""),F=Object(o.a)(L,2),z=F[0],U=F[1],W=Object(n.useState)([]),G=Object(o.a)(W,2),q=G[0],V=G[1],Q=Object(n.useState)([]),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)([]),$=Object(o.a)(X,2),ee=$[0],te=$[1],ae=Object(n.useState)([]),ne=Object(o.a)(ae,2),le=ne[0],ie=ne[1],ce=Object(n.useState)("active_numbers"),oe=Object(o.a)(ce,2),se=oe[0],me=oe[1],ue=Object(n.useState)(null),de=Object(o.a)(ue,2),pe=de[0],be=de[1],fe=Object(n.useState)(!1),Ee=Object(o.a)(fe,2),ve=Ee[0],he=Ee[1],_e=r.a.useCallback((function(e,t){return function(){E(e),x(t),w(!0)}}),[]),ye=r.a.useCallback((function(e){return function(){J(e),w(!0)}}),[]),Oe=function(e){w(e),T(e),P(!1)},je=function(e){P(e),T(e)},xe=function(e){me(e)},Se=Object(c.b)(),ke=Se.enqueueSnackbar,Ce=Se.closeSnackbar,we=Object(n.useContext)(Kt),Ae=we.setIsReconnecting,De=we.sites,Ie=Object(n.useState)(!1),Ne=Object(o.a)(Ie,2),Te=Ne[0],He=Ne[1];Object(n.useEffect)((function(){return Xo(Ae,"contacts"),$o((function(e){s(e);var t={};e.length>0&&(t=e[j]),E(t),p(e),He(!0),null!==pe&&(Ce(pe),be(null),ke("Loading contacts list successful!",{variant:"success",autoHideDuration:5e3}))})),function(){return es()}}),[j,pe]),Object(n.useEffect)((function(){var e=z.length;if(e>2){var t=i.filter((function(e){var t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(z),"gi").test(n)}));p(t)}else 0===e&&p(i)}),[z]),Object(n.useEffect)((function(){!function(e){var t="".concat(We.b,"/api/contacts/get_blocked_numbers");it.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.blocked_numbers;t&&(V(a),0!==a.length&&J(a[0]))})),function(e){var t="".concat(We.b,"/api/contacts/sim_prefix");it.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.prefixes;t&&te(a)}))}),[]),Object(n.useEffect)((function(){Te&&(!function(e){var t="".concat(We.b,"/api/contacts/get_contact_prioritization");it.a.get(t).then((function(t){var a=t.data;console.log("All Sites Stakeholders",a),e(a)})).catch((function(e){console.error(e)}))}((function(e){ie(e)})),He(!1))}),[Te]);var Re="",Ye=null,Be=!1;if(g.hasOwnProperty("user_id")){var Pe=g.first_name,Le=g.last_name,Fe=g.organizations;Re="".concat(Pe," ").concat(Le),Ye=st(Fe,!0),Be=mt(Fe)}var ze,Ue=function(){return I?r.a.createElement(To,{setContactForm:Oe,chosenContact:g,setSnackbarKey:be,isEditMode:B,setContactFormForEdit:je,isFromChatterbox:!1}):""!==Re?r.a.createElement(tm,{contact:Re,chosenContact:g,setSlideOpen:w,classes:t,setContactFormForEdit:je,siteOrgs:Ye,isContactPriority:Be}):void 0},Ge=r.a.createElement(nm,{search_str:z,setSearchStr:U,inputProps:{endAdornment:r.a.createElement(Cs.a,{position:"end"},r.a.createElement(H.a,{"aria-controls":"sortContacts","aria-haspopup":"true",onClick:function(e){he(!ve)},color:"primary"},r.a.createElement(Hs.a,null)))}});return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ge,{title:"Communications | Contacts"}),r.a.createElement(_.a,{container:!0,spacing:4},r.a.createElement(re.a,{mdUp:!0},r.a.createElement(_.a,{item:!0,xs:12,className:t.sticky,style:{paddingBottom:0}},Ge)),r.a.createElement(re.a,{smDown:!0},r.a.createElement(_.a,{item:!0,md:4,lg:3},r.a.createElement("div",{className:t.sticky},Ge,r.a.createElement(hn.a,{component:"nav","aria-label":"main"},r.a.createElement(yn.a,{button:!0,onClick:function(){return xe("active_numbers")},selected:"active_numbers"===se},r.a.createElement(jn.a,null,r.a.createElement(Rs.a,null)),r.a.createElement(On.a,{primary:"Active Contacts"})),r.a.createElement(ws.a,{in:"active_numbers"===se,timeout:"auto",unmountOnExit:!0},r.a.createElement(hn.a,{component:"div",disablePadding:!0},r.a.createElement(yn.a,{button:!0,onClick:function(){return Oe(!0)},className:t.nested},r.a.createElement(jn.a,null,r.a.createElement(Ts.a,null)),r.a.createElement(On.a,{primary:"Add Contact"})))),r.a.createElement(yn.a,{button:!0,onClick:function(){return xe("blocked_numbers")},selected:"blocked_numbers"===se},r.a.createElement(jn.a,null,r.a.createElement(ho.a,null)),r.a.createElement(On.a,{primary:"Blocked Contacts"})),r.a.createElement(yn.a,{button:!0,onClick:function(){return xe("contact_prioritization")},selected:"contact_prioritization"===se},r.a.createElement(jn.a,null,r.a.createElement(Ys.a,null)),r.a.createElement(On.a,{primary:"Contact Prioritization"})),r.a.createElement(yn.a,{button:!0,onClick:function(){return xe("sim_prefixes")},selected:"sim_prefixes"===se},r.a.createElement(jn.a,null,r.a.createElement(Bs.a,null)),r.a.createElement(On.a,{primary:"SIM Prefixes"})))))),r.a.createElement(_.a,{item:!0,xs:12,md:8,lg:9},0===i.length?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(em,null)):r.a.createElement(n.Fragment,null,r.a.createElement(re.a,{xsUp:"active_numbers"!==se,implementation:"css"},r.a.createElement(_.a,{container:!0,spacing:4},r.a.createElement(_.a,{item:!0,xs:12,lg:7},r.a.createElement(Ls,{classes:t,contacts:d,onContactClickFn:_e})),r.a.createElement(re.a,{mdDown:!0},r.a.createElement(_.a,{item:!0,lg:5},""!==Re&&r.a.createElement(v.a,{elevation:1,style:{padding:16,zIndex:2},className:"".concat(t.sticky," ").concat(t.overflow),variant:"outlined"},Ue())),r.a.createElement(As.a,{open:I,style:{zIndex:1}})),r.a.createElement(re.a,{smDown:!0,lgUp:!0},r.a.createElement(It.a,{direction:"left",in:C,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(v.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},Ue())),r.a.createElement(As.a,{open:C,style:{zIndex:1}})),r.a.createElement(re.a,{mdUp:!0},r.a.createElement(Me.a,{fullScreen:!0,open:C,TransitionComponent:Nt},r.a.createElement(M.a,{style:{position:"relative"}},r.a.createElement(N.a,null,r.a.createElement(H.a,{edge:"start",color:"inherit",onClick:function(){return Oe(!1)},"aria-label":"close"},r.a.createElement(Ot.a,null)))),r.a.createElement(v.a,{elevation:0,style:{padding:16}},Ue()))))),r.a.createElement(re.a,{xsUp:"blocked_numbers"!==se,implementation:"css"},r.a.createElement(_.a,{container:!0,spacing:4},r.a.createElement(_.a,{item:!0,xs:12,lg:7},r.a.createElement(Fs,{blocked_numbers:q,onBlockContactClickFn:ye})),r.a.createElement(re.a,{mdDown:!0},r.a.createElement(_.a,{item:!0,lg:5},r.a.createElement(v.a,{elevation:1,style:{padding:16,zIndex:2},className:t.sticky,variant:"outlined"},r.a.createElement(am,{chosenContact:K,setSlideOpen:w})))),r.a.createElement(re.a,{smDown:!0,lgUp:!0},r.a.createElement(It.a,{direction:"left",in:C,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(v.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},r.a.createElement(am,{chosenContact:K,setSlideOpen:w}))),r.a.createElement(As.a,{open:C,style:{zIndex:1}})),r.a.createElement(re.a,{mdUp:!0},r.a.createElement(Me.a,{fullScreen:!0,open:C,TransitionComponent:Nt},r.a.createElement(M.a,{style:{position:"relative"}},r.a.createElement(N.a,null,r.a.createElement(H.a,{edge:"start",color:"inherit",onClick:function(){return Oe(!1)},"aria-label":"close"},r.a.createElement(Ot.a,null)))),r.a.createElement(v.a,{elevation:0,style:{padding:16}},r.a.createElement(am,{chosenContact:K,setSlideOpen:w})))))),r.a.createElement(re.a,{xsUp:"contact_prioritization"!==se,implementation:"css"},r.a.createElement(y.a,{variant:"body1",style:{marginBottom:12}},r.a.createElement("strong",null,r.a.createElement("i",null,"Note: Contact priority can only be chosen from stakeholders that are currently active and EWI recipients."))),0!==le.length&&De.map((function(e,t){var a=e.site_id,n=e.site_code,l=ct(e,!0,"start"),i=le[n];return r.a.createElement(Js,{siteLabel:l,siteID:a,siteData:i,key:t})}))),r.a.createElement(re.a,{xsUp:"sim_prefixes"!==se,implementation:"css"},r.a.createElement(Us,{sim_prefixes:ee}))))),r.a.createElement(Xs,{modalStateHandler:(ze=!1,function(){he(ze)}),modalState:ve,contactsArray:d,classes:t,chosenContact:g,setChosenContact:E}))},lm=a(185),im=a(182),cm=a(751),om=a(369),sm=a.n(om),mm=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},insetDivider:{padding:"8px 70px !important"}})})),um={to:[],cc:[],bcc:[]};var dm=function(e){var t=mm(),a=(e.siteId,Object(n.useState)(um)),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],b=m[1],g=Object(n.useState)({}),E=Object(o.a)(g,2),v=E[0],h=E[1],y=Object(n.useState)(""),O=Object(o.a)(y,2),j=O[0],x=O[1],S=Object(n.useState)(""),k=Object(o.a)(S,2),C=k[0],w=k[1],A=function(e,t){var a=i[e].push(t);c(Object(d.a)(Object(d.a)({},i),a))},D=function(e,t,a){var n=i[e].splice(i[e].indexOf(t),1);c(Object(d.a)(Object(d.a)({},i),n))};return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ge,{title:"Communications | MailBox"}),r.a.createElement(_.a,{container:!0,spacing:4,alignItems:"center"},r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,key:"sending_options"},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(et.a,{label:"To",value:i.to,onAdd:function(e){return A("to",e)},onDelete:function(e,t){return D("to",e)},fullWidth:!0,required:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{label:"Subject",value:j,onChange:function(e){return x(e.target.value)},margin:"dense",fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(et.a,{label:"Cc",value:i.cc,onAdd:function(e){return A("cc",e)},onDelete:function(e,t){return D("cc",e)},fullWidth:!0})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(et.a,{label:"Bcc",value:i.bcc,onAdd:function(e){return A("bcc",e)},onDelete:function(e,t){return D("bcc",e)},fullWidth:!0}))),r.a.createElement(_.a,{item:!0,xs:12,key:"message_body"},r.a.createElement(Lr.a,{theme:"snow",value:C,onChange:w})),r.a.createElement(_.a,{item:!0,xs:12,key:"buttons"},r.a.createElement(p.a,{color:"secondary",onClick:function(){var e=i.to,t=i.cc,a=i.bcc,n={recipients:[].concat(Object(Xe.a)(e),Object(Xe.a)(t),Object(Xe.a)(a)),subject:j,mail_body:C};console.log("payload",n),function(e,t){var a="".concat(We.b,"/api/mailbox/send_email");console.log(e),it.a.post(a,e).then((function(e){var a=e.data;console.log("Send email response",a),t(a)})).catch((function(e){console.error(e)}))}(n,(function(e){console.log("AXIOS Response",e),e.status?(h({text:"Email sent!",color:lm.a[600]}),c(um),x(""),w("")):h({text:"Email sent!",color:im.a[600]}),b(!0)}))}},"SEND"),r.a.createElement(p.a,{color:"primary",onClick:function(){c({to:[],cc:[],bcc:[]}),x(""),w("")}},"Discard/Reset"))),r.a.createElement(cm.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:u,autoHideDuration:6e3,onClose:function(e){return b(!1)},ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},v.text),action:[r.a.createElement(H.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:function(e){return b(!1)}},r.a.createElement(sm.a,null))],style:{backgroundColor:v.color}}))},pm=a(490),bm=a(888);var fm=Object(O.a)((function(e){var t=Object(F.d)(e);return Object(d.a)(Object(d.a)({},t),{},{customPaper:{padding:8,marginTop:20,textAlign:"center"},bigAvatar:{margin:10,width:40,height:40}})})),gm=Object(u.a)((function(e){return{badge:{right:14,top:48,padding:"0 4px"}}}))(io.a);var Em=function(e){var t=fm(),a=e.siteCode,l=Object(n.useState)(null),i=Object(o.a)(l,2),c=i[0],s=i[1];return Object(n.useEffect)((function(){var e,l;e=a,l=function(e){console.log(e);var a=function(e,t){var a=[],l=[];return Object.keys(t).forEach((function(e){var t=l;/lewc|lgu/i.test(e)&&(t=a),t.push(e)})),a.concat(l).map((function(a,l,i){var c=t[a].map((function(t,a){var n=t.last_name,l=t.first_name,i=t.salutation,c=t.status,o=t.primary_contact,s=i||"",m="Active",u=r.a.createElement(la.a,{style:{color:"green"}});Boolean(o)&&c?(m="Contact Priority",u=r.a.createElement(bm.a,{style:{color:"gold"}})):c||(m="Inactive",u=r.a.createElement(ia.a,{style:{color:"gray"}}));var d=r.a.createElement(xe.a,{arrow:!0,title:m,placement:"top",enterTouchDelay:200},u);return r.a.createElement(_.a,{item:!0,xs:12,sm:6,md:4,lg:3,justify:"center",alignItems:"center",container:!0,spacing:1,key:"staff_".concat(a+1)},r.a.createElement(gm,{badgeContent:d},r.a.createElement(mo.a,{alt:"Stakeholder",src:vo.a,className:e.bigAvatar})),r.a.createElement(y.a,{variant:"subtitle1",color:c?"textPrimary":"textSecondary"},"".concat(s," ").concat(l," ").concat(n)))}));return r.a.createElement(n.Fragment,{key:"fragment_".concat(l+1)},r.a.createElement(_.a,{item:!0,xs:12,key:"org_label_".concat(l+1)},r.a.createElement(y.a,{variant:"subtitle1"},r.a.createElement("strong",null,a.toUpperCase()))),r.a.createElement(_.a,{item:!0,xs:12,justify:"space-evenly",alignItems:"center",container:!0,spacing:1,key:"staff_list_".concat(l+1)},c),i.length>l+1&&r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,{style:{margin:"16px 0"}})))}))}(t,e);s(a)},it.a.get("".concat(We.b,"/api/users/get_community_orgs_by_site/").concat(e)).then((function(e){var t=e.data;l(t)}))}),[]),r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"h6",color:"textPrimary",gutterBottom:!0},r.a.createElement("strong",null,"Site Stakeholders"))),r.a.createElement(_.a,{item:!0,xs:12,align:"center",container:!0,spacing:1,justify:"center"},null===c?"Loading...":0!==c.length?c:"No site stakeholders"))},vm=function(e){return function(t){t.preventDefault(),e.push("/community/site_info"),e.replace("/community/site_info")}};var hm=function(e){var t=e.width,a=e.history;return Object(K.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:vm(a)},r.a.createElement(wi.a,{style:{fontSize:16}})," Back"):r.a.createElement(H.a,{variant:"contained",color:"primary",size:"small",onClick:vm(a),style:{marginLeft:6}},r.a.createElement(wi.a,null))},_m=["I","II","III","IV-A","IV-B","V","VI","VII","VIII","IX","X","XI","XII","XIII","CAR","NCR","BARMM"];function ym(e,t){var a=e[t-1],n=[],r=[];return Object.keys(a).forEach((function(e){"d"!==a[e]&&"w"!==a[e]||("d"===a[e]?n.push(e):r.push(e))})),ft(n),ft(r),[{key:"dry",list:n},{key:"wet",list:r}]}function Om(e,t){var a=t.type,n=t.field,r=t.value,l=e[n],i=function(e,t){return""===t?"Required field":"site_code"===e&&t.length<3?"Site code must be three-lettered keyword":""}(n,r),c=r;switch(["purok","sitio","households"].includes(n)&&(c=r||null),"season"===n&&(c=parseInt(r,10)),a){case"UPDATE":return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},l),{},{value:c,helper_text:i})});default:return Object(d.a)({},e)}}function jm(e){var t={},a=["sitio","purok","active","site_id"];return Object.keys(e).forEach((function(n){t[n]={value:e[n],helper_text:null,required:!a.includes(n)}})),t}var xm=function(e){var t=e.siteInformation,a=e.setSiteInformationData,l=e.seasons,i=e.setIsDisabled,c=Object(n.useReducer)(Om,t,jm),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)([]),p=Object(o.a)(d,2),b=p[0],g=p[1];return Object(n.useEffect)((function(){var e=Object.keys(m).some((function(e){var t=m[e],a=t.required,n=t.helper_text;return a&&""!==n&&null!==n}));i(e),a(function(e){var t={};return Object.keys(e).forEach((function(a){t[a]=e[a].value})),t}(m))}),[m]),Object(n.useEffect)((function(){if(null!==m.season.value){var e=ym(l,m.season.value);g(e)}}),[m.season.value]),r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{label:"Site code",fullWidth:!0,required:!0,inputProps:{maxLength:3},value:m.site_code.value.toUpperCase(),onChange:function(e){return u({type:"UPDATE",field:"site_code",value:e.target.value})},helperText:m.site_code.helper_text||"",error:Boolean(m.site_code.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Purok",fullWidth:!0,placeholder:"Enter purok if available",InputLabelProps:{shrink:!0},value:m.purok.value||"",onChange:function(e){return u({type:"UPDATE",field:"purok",value:e.target.value})}})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Sitio",fullWidth:!0,placeholder:"Enter sitio if available",InputLabelProps:{shrink:!0},value:m.sitio.value||"",onChange:function(e){return u({type:"UPDATE",field:"sitio",value:e.target.value})}})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Barangay",fullWidth:!0,required:!0,value:m.barangay.value,onChange:function(e){return u({type:"UPDATE",field:"barangay",value:e.target.value})},helperText:m.barangay.helper_text||"",error:Boolean(m.barangay.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Municipality",fullWidth:!0,required:!0,value:m.municipality.value,onChange:function(e){return u({type:"UPDATE",field:"municipality",value:e.target.value})},helperText:m.municipality.helper_text||"",error:Boolean(m.municipality.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Province",fullWidth:!0,required:!0,value:m.province.value,onChange:function(e){return u({type:"UPDATE",field:"province",value:e.target.value})},helperText:m.province.helper_text||"",error:Boolean(m.province.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{required:!0,fullWidth:!0,error:Boolean(m.region.helper_text)},r.a.createElement(fa.a,{id:"region"},"Region"),r.a.createElement(ga.a,{labelId:"region-select-label",id:"region-select-id",required:!0,value:m.region.value,onChange:function(e){return u({type:"UPDATE",field:"region",value:e.target.value})}},r.a.createElement(Y.a,{value:""},r.a.createElement("em",null,"None")),_m.map((function(e,t){return r.a.createElement(Y.a,{value:e,key:t},e)}))))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"PSGC",fullWidth:!0,type:"number",required:!0,value:m.psgc.value,onChange:function(e){return u({type:"UPDATE",field:"psgc",value:e.target.value})},helperText:m.psgc.helper_text||"",error:Boolean(m.psgc.helper_text)})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Elements at Risk",fullWidth:!0,required:!0,value:m.households.value||"",onChange:function(e){return u({type:"UPDATE",field:"households",value:e.target.value})},helperText:m.households.helper_text||"",error:Boolean(m.households.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Re.a,null,r.a.createElement(Be.a,{control:r.a.createElement(kt.a,{checked:m.active.value,onChange:function(e){return u({type:"UPDATE",field:"active",value:e.target.checked})},value:"checkedA",color:"primary"}),label:"Active site"}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{component:"fieldset",required:!0,error:Boolean(m.season.helper_text)},r.a.createElement(na.a,{component:"legend"},"Season"),r.a.createElement(Ye.a,{row:!0,"aria-label":"season_group",name:"season",value:m.season.value.toString(),onChange:function(e){var t=e.target.value;u({type:"UPDATE",field:"season",value:t});var a=ym(l,t);g(a)}},l.map((function(e,t){var a=e.season_group_id;return r.a.createElement(Be.a,{value:a.toString(),control:r.a.createElement(Pe.a,{color:"primary"}),label:"Season  ".concat(a),key:"season_".concat(a)})}))))),r.a.createElement(_.a,{item:!0,container:!0,xs:12},b.map((function(e){var t=e.key,a=e.list;return r.a.createElement(_.a,{item:!0,xs:6,key:t},r.a.createElement(y.a,{variant:"subtitle1",color:"textSecondary",align:"center"},ot(t)),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary",align:"center"},a.map((function(e){return ot(e)})).join(", ")))}))))};var Sm=Object(Fe.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.seasons,i=e.editButtonAction,s=e.siteInformation,m=Object(n.useContext)(Kt).setRefreshSites,u=Object(n.useState)(null),d=Object(o.a)(u,2),b=d[0],f=d[1],g=Object(n.useState)(!0),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(c.b)(),y=_.enqueueSnackbar,O=_.closeSnackbar,j=function(e){return r.a.createElement(p.a,{color:"primary",onClick:function(){O(e)}},"Dismiss")},x=function(){i(!1)};return r.a.createElement(Me.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ne.a,{id:"form-dialog-title"},"Edit site information"),r.a.createElement(Te.a,null,r.a.createElement(He.a,null,"Update necessary fields of site information form then save."),r.a.createElement(xm,{siteInformation:s,setSiteInformationData:f,seasons:l,setIsDisabled:h})),r.a.createElement(Le.a,null,r.a.createElement(p.a,{onClick:x,color:"primary"},"Cancel"),r.a.createElement(p.a,{color:"primary",onClick:function(){!function(e,t){var a="".concat(We.b,"/api/sites/save_site_information");it.a.post(a,e).then((function(e){var a=e.data;console.log("Save site info data reponse",a),t(a)})).catch((function(e){console.error(e)}))}(b,(function(e){var t=e.status,a=e.message;"success"===t&&(x(),m(!0)),y(a,{variant:t,autoHideDuration:3e3,action:j})}))},disabled:v},"Save")))})),km=Object(O.a)((function(e){var t=Object(pm.a)(e);return Object(F.d)(t)})),Cm=function(){return r.a.createElement(Oe.a,{height:125,width:380,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},r.a.createElement("rect",{x:"129",y:"20",rx:"3",ry:"3",width:"123",height:"44"}),r.a.createElement("rect",{x:"18",y:"80",rx:"3",ry:"3",width:"350",height:"22"}))};var wm=function(e){var t=e.width,a=e.siteInformation,l=(km(),Object(n.useState)(null)),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],b=u[1],f=Object(n.useState)([]),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(n.useState)([]),O=Object(o.a)(h,2),j=O[0],x=O[1],S=Object(n.useState)(!1),k=Object(o.a)(S,2),C=k[0],w=k[1];Object(n.useEffect)((function(){"undefined"!==typeof a&&s(a)}),[a]),Object(n.useEffect)((function(){var e;null!==c&&(e=function(e){v(e)},it.a.get("".concat(We.b,"/api/sites/get_seasons")).then((function(t){var a=t.data;e(a)})).catch((function(e){console.log(e)})),function(e,t){it.a.get("".concat(We.b,"/api/sites/get_site_season/").concat(e)).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}(c.site_code,(function(e){var t=e.season_months,a=t.routine_schedules,n=[],r=[];a.forEach((function(e){var t=X()().isoWeekday(e.iso_week_day).format("dddd");"d"===e.season_type?n.push(t):r.push(t)})),x([{key:"dry",list:n},{key:"wet",list:r}]),delete t.routine_schedules,delete t.season_group_id;var l=[],i=[];Object.keys(t).forEach((function(e){"d"===t[e]?l.push(e):i.push(e)})),ft(l),ft(i),b([{key:"dry",list:l},{key:"wet",list:i}])})))}),[c]);var A=function(){w(!C)};return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(_.a,{item:!0,xs:!0},r.a.createElement(hm,Object.assign({},e,{width:t}))),r.a.createElement(_.a,{item:!0,xs:!0,container:!0,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:A,startIcon:r.a.createElement(gl.a,null)},"Edit Info"))),r.a.createElement(_.a,{container:!0,spacing:2},null!==c?r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"h4"},c.site_code.toUpperCase()),r.a.createElement(y.a,{variant:"h5",color:"textSecondary"},ct(c,!1))),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(Ya.a,{raised:!0},r.a.createElement(Pa.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Geographic Information"))),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},"Region"),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},c.region)),r.a.createElement(_.a,{item:!0,xs:!0,sm:9,md:8,lg:!0,align:"center"},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},"Philippine Standard Geographic Code"),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},c.psgc)),r.a.createElement(_.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle1",color:"textSecondary"},"Seasons")),d.length>0&&d.map((function(e){var t=e.key,a=e.list;return r.a.createElement(_.a,{item:!0,xs:6,key:t},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},ot(t)),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},a.map((function(e){return ot(e)})).join(", ")))}))))))),r.a.createElement(_.a,{item:!0,xs:12,sm:6,container:!0,alignItems:"center"},r.a.createElement(Ya.a,{raised:!0,style:{width:"100%"}},r.a.createElement(Pa.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Monitoring Information"))),r.a.createElement(_.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"subtitle1",color:"textSecondary"},"Routine Schedules")),j.length>0&&j.map((function(e){var t=e.key,a=e.list;return r.a.createElement(_.a,{item:!0,xs:6,key:t},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},ot(t)),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},a.map((function(e){return ot(e)})).join(", ")))}))),r.a.createElement(_.a,{item:!0,xs:!0,align:"center"},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},"Current Alert Level"),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},"---")))))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Ya.a,{raised:!0},r.a.createElement(Pa.a,null,r.a.createElement(_.a,{container:!0,spacing:1},r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(y.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Site Status"))),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},"Active"),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},c.active?"Yes":"No")),r.a.createElement(_.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(y.a,{variant:"subtitle2",color:"textSecondary"},"Elements at Risk"),r.a.createElement(y.a,{variant:"subtitle1",color:"textPrimary"},c.households||"---")))))),r.a.createElement(_.a,{item:!0,xs:12,align:"center"},r.a.createElement(Ya.a,{raised:!0,style:{width:"100%"}},r.a.createElement(Pa.a,null,r.a.createElement(Em,{siteCode:c.site_code}))))):r.a.createElement(_.a,{item:!0,xs:!0,style:{width:"100%"}},r.a.createElement(Cm,null))),r.a.createElement(Sm,{isOpen:C,siteInformation:a,editButtonAction:A,seasons:E}))};var Am=function(e){var t=e.siteMapData,a=e.hoveredSite,l=e.url,i=[12.8797,121.774],c=Object(n.useRef)(t.map((function(){return Object(n.createRef)()})));return Object(n.useEffect)((function(){if(null!==a){var e=t.findIndex((function(e){return e.site_code===a})),n=c.current[e].current;null!==n&&n.leafletElement.openPopup()}}),[a]),r.a.createElement(Ec.a,{style:{height:"75vh"},center:i,zoom:5,scrollWheelZoom:"center"},r.a.createElement(vc.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((function(e,t){var a=e.site_code;return r.a.createElement(jc.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0,ref:c.current[t]},r.a.createElement(yc.a,null,r.a.createElement(s.b,{to:"".concat(l,"/").concat(a),style:{color:"black"}},r.a.createElement("strong",null,a.toUpperCase())," ",r.a.createElement("br",null),ct(e,!1))))})))},Dm=Object(O.a)((function(e){var t=Object(F.d)(e),a=118+.06*(window.innerHeight-118);return Object(d.a)(Object(d.a)({},t),{},{sticky:{position:"sticky",top:a,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}})})),Im=function(){return r.a.createElement(Oe.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"561",height:"700"}))};function Mm(e){var t=e.sitesPerRegion,a=e.url,n=e.setHoveredSite,l=Object.keys(t).sort();return r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"center"},l.map((function(e){var l="inactive"!==e?e.toUpperCase():"Inactive Sites";return r.a.createElement(_.a,{container:!0,justify:"center",key:e,style:{margin:"8px 0"}},r.a.createElement(y.a,{variant:"h6",component:_.a,item:!0,xs:12,align:"center",style:{marginBottom:4}},["I","V","X"].includes(l.charAt(0))&&"inactive"!==e?"Region ".concat(l):l),t[e].map((function(e){return r.a.createElement(y.a,{variant:"body2",component:_.a,item:!0,xs:12,align:"center",key:e.site_code},r.a.createElement(s.b,{to:"".concat(a,"/").concat(e.site_code),style:{color:"black"},onFocus:function(t){return n(e.site_code)},onMouseOver:function(t){return n(e.site_code)}},ct(e,!0,"start")))})))})))}var Nm=Object(K.a)()((function(e){var t=Dm(),a=e.width,l=e.location,i=e.match.url,c=Object(n.useContext)(Kt).all_sites_including_inactive,s=Object(n.useState)(null),u=Object(o.a)(s,2),p=u[0],b=u[1],f=Object(n.useState)(null),g=Object(o.a)(f,2),E=g[0],v=g[1],h=Object(n.useState)(null),O=Object(o.a)(h,2),j=O[0],x=O[1];return Object(n.useEffect)((function(){if(c.length>0){var e=[],t={};c.forEach((function(a){var n=a.region;a.active||(n="inactive"),t[n]||(t[n]=[]),t[n].push(a),e.push(Object(d.a)(Object(d.a)({},a),{},{url:"".concat(i,"/").concat(a.site_code)}))})),v(e),x(t)}}),[c]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ge,{title:"Community | Site Information"})),r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(m.d,{location:l},r.a.createElement(m.b,{exact:!0,path:i,render:function(e){return r.a.createElement(_.a,{container:!0,spacing:3,justify:"space-evenly"},r.a.createElement(_.a,{item:!0,xs:12,sm:6},null===E?r.a.createElement(Im,null):r.a.createElement("div",{className:t.sticky},r.a.createElement(Am,{siteMapData:E,width:a,url:i,hoveredSite:p}))),r.a.createElement(_.a,{item:!0,xs:12,sm:6,container:!0,justify:"center"},r.a.createElement(y.a,{variant:"h5",component:_.a,item:!0,xs:12,align:"center",gutterBottom:!0},r.a.createElement("strong",null,"Dynaslope Project Sites")),null===j?"Loading":r.a.createElement(Mm,{sitesPerRegion:j,url:i,setHoveredSite:b})))}}),r.a.createElement(m.b,{path:"".concat(i,"/:site_code"),render:function(e){var t=e.match.params.site_code,n=c.filter((function(e){return e.site_code===t})).pop();return r.a.createElement(wm,Object.assign({},e,{width:a,siteInformation:n}))}}))))})),Tm=Object(O.a)((function(e){return{list:{maxHeight:"60vh",overflowY:"auto",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}},searchBox:{marginBottom:e.spacing(3)},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}}}));var Hm=function(e){var t=e.users,a=e.onMemberClickFn,l=e.selectedUserDetails,i=Tm(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1];return Object(n.useEffect)((function(){u(t)}),[t]),Object(n.useEffect)((function(){if(null!==b){var e=t.filter((function(e){var t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(b.toLowerCase()),"gi").test(n.toLocaleLowerCase())}));u(e)}else u(t)}),[b]),r.a.createElement("div",{className:i.sticky},r.a.createElement(Oa.a,{fullWidth:!0,margin:"dense",placeholder:"Search Dynaslope staff...",onChange:function(e){return f(e.target.value)},className:i.searchBox}),r.a.createElement(hn.a,{"aria-label":"list",className:i.list},null!==m&&m.map((function(e){var t="".concat(e.last_name,", ").concat(e.first_name),n=null!==l&&l.user_id===e.user_id;return r.a.createElement(yn.a,{button:!0,key:e.user_id,onClick:a(e),selected:n},r.a.createElement(On.a,{primary:t}))}))))},Rm=a(832),Ym=a(889),Bm=a(890),Pm=a(891),Lm=a(521),Fm=a.n(Lm);var zm=a(522),Um=a.n(zm),Wm=Object(O.a)((function(e){return{root:{maxWidth:"100%",flexGrow:1},container:{maxWidth:"50%"},media:{objectPosition:"top"},avatar:{width:150,height:150,[e.breakpoints.down("md")]:{width:100,height:100},backgroundColor:"#f2f2f2"},avatarContainer:{marginTop:-72,marginBottom:e.spacing(1)},editButton:{backgroundColor:"#f2f2f2","&:hover":{backgroundColor:"#f2f2f2"}},nickname:{marginBottom:e.spacing(2)},listBody:{paddingLeft:e.spacing(7),paddingRight:e.spacing(11),textAlign:"center"},link:{textDecoration:"none",color:"black"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"}}}));function Gm(e){var t=e.inputRef,a=e.mask,n=Object(Ht.a)(e,["inputRef","mask"]);return r.a.createElement(So.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}var qm=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],Vm=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Qm(e,t,a){return""===t&&a?"Required field":"sim_num"!==e||t.match(/^[a-z0-9]+$/i)?"birthday"!==e||null===t||t.isValid()?"":"Enter a valid date":"Enter complete mobile number"}function Zm(e,t){var a=t.type,n=t.field,r=t.value,l=t.key,i=t.category,c=null,o=null,s=null,m=null,u=e.field_with_error;if("ADD"===a){var p={};"mobile_numbers"===i?(m=Object(Xe.a)(e.mobile_numbers),p=Jm({status:1,mobile_number:{sim_num:"",mobile_id:0}})):"emails"===i&&(m=Object(Xe.a)(e.emails),p=Km({email:"",email_id:0})),m.push(p),u.add("".concat(i,".").concat(m.length-1))}else if("DELETE"===a){"mobile_numbers"===i?m=Object(Xe.a)(e.mobile_numbers):"emails"===i&&(m=Object(Xe.a)(e.emails)),m.splice(l,1),u.forEach((function(e){e.includes("".concat(i,".").concat(l))&&u.delete(e)}))}else{c=e[n];var b=n;if(o=r,["middle_name","sex"].includes(n)&&(o=r||null),"sim_num"===n&&(o=r.replace(/[()+-\s]/g,"")),"undefined"===typeof i&&(s=Qm(n,o,c.required)),m=[],["status","sim_num"].includes(n)){m=Object(Xe.a)(e.mobile_numbers);var f={};if("status"===n)c=m[l][n],f=m[l];else c=m[l].mobile_number[n],f=m[l].mobile_number;s=Qm(n,o,c.required);var g=Object(d.a)(Object(d.a)({},c),{},{value:o,helper_text:s});f[n]=g,b="mobile_numbers.".concat(l)}if("email"===n){var E=(m=Object(Xe.a)(e.emails))[l];s=Qm(n,o,(c=E[n]).required);var v=Object(d.a)(Object(d.a)({},c),{},{value:o,helper_text:s});E[n]=v,b="emails.".concat(l)}"undefined"!==typeof i&&(u.has(b)&&u.delete(b),b+=".".concat(n)),s?u.add(b):u.delete(b)}switch(a){case"UPDATE":return Object(d.a)(Object(d.a)({},e),{},{[n]:Object(d.a)(Object(d.a)({},c),{},{value:o,helper_text:s}),field_with_error:u});case"UPDATE_MOBILE":return Object(d.a)(Object(d.a)({},e),{},{mobile_numbers:m,field_with_error:u});case"UPDATE_EMAIL":return Object(d.a)(Object(d.a)({},e),{},{emails:m,field_with_error:u});case"ADD":return Object(d.a)(Object(d.a)({},e),{},{[i]:m,field_with_error:u});case"DELETE":return Object(d.a)(Object(d.a)({},e),{},{[i]:m,field_with_error:u});default:return Object(d.a)({},e)}}function Km(e){return Object(d.a)(Object(d.a)({},e),{},{email:{value:e.email,helper_text:null,required:!0}})}function Jm(e){var t=e.mobile_number;return Object(d.a)(Object(d.a)({},e),{},{status:{value:e.status,helper_text:null,required:!1},mobile_number:Object(d.a)(Object(d.a)({},t),{},{sim_num:{value:t.sim_num,helper_text:null,required:!0}})})}function Xm(e){var t={},a=["middle_name","sex","birthday"];return Object.keys(e).forEach((function(n){var r={value:e[n],helper_text:null,required:!a.includes(n)};"mobile_numbers"===n&&(r=e[n].map((function(e){return Jm(e)}))),"emails"===n&&(r=e[n].map((function(e){return Km(e)}))),t[n]=r})),t.field_with_error=new Set,t}function $m(e){return Object(xo.conformToMask)(e,Vm).conformedValue}function eu(e){var t=e.classes,a=e.selectedUserDetails,l=e.setIsEdit,i=Object(n.useReducer)(Zm,a,Xm),s=Object(o.a)(i,2),m=s[0],u=s[1],b=Object(n.useContext)(Kt).setRefreshUser,g=Object(c.b)().enqueueSnackbar;return r.a.createElement(n.Fragment,null,r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:2,style:{marginTop:8}},r.a.createElement(_.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"First Name",required:!0,value:m.first_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"first_name",value:e.target.value})},helperText:m.first_name.helper_text||"",error:Boolean(m.first_name.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Last Name",required:!0,value:m.last_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"last_name",value:e.target.value})},helperText:m.last_name.helper_text||"",error:Boolean(m.last_name.helper_text)})),r.a.createElement(_.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Middle Name",value:m.middle_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"middle_name",value:e.target.value})}})),r.a.createElement(_.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Nickname",required:!0,value:m.nickname.value||"",onChange:function(e){return u({type:"UPDATE",field:"nickname",value:e.target.value})},helperText:m.nickname.helper_text||"",error:Boolean(m.nickname.helper_text),disabled:!0})),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(Nr.b,{autoOk:!0,label:"Birthday",value:m.birthday.value||null,onChange:function(e){return u({type:"UPDATE",field:"birthday",value:e})},helperText:m.birthday.helper_text||"",error:Boolean(m.birthday.helper_text),ampm:!1,placeholder:"01/01/2000",format:"MM/DD/YYYY",mask:"__/__/____",clearable:!0,disableFuture:!0}))),r.a.createElement(_.a,{item:!0,xs:6},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(fa.a,{id:"sex-label"},"Sex"),r.a.createElement(ga.a,{labelId:"sex-label",id:"sex-select",value:m.sex.value||"",onChange:function(e){return u({type:"UPDATE",field:"sex",value:e.target.value})}},r.a.createElement(Y.a,{value:""},"---"),r.a.createElement(Y.a,{value:"M"},"Male"),r.a.createElement(Y.a,{value:"F"},"Female")))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(ce.a,null)),r.a.createElement(_.a,{item:!0,xs:12,lg:6,container:!0,spacing:1},r.a.createElement(y.a,{component:_.a,item:!0,xs:12,variant:"h6",align:"center"},"Contact Numbers"),m.mobile_numbers.map((function(e,t){var a=e.mobile_number,n=a.sim_num,l=a.mobile_id,i=e.status,c=0!==l;return r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,key:t},r.a.createElement(_.a,{item:!0,xs:7},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Mobile Number",required:!0,value:$m(n.value),onChange:function(e){return u({type:"UPDATE_MOBILE",field:"sim_num",value:e.target.value,key:t,category:"mobile_numbers"})},InputProps:{inputComponent:Gm,inputProps:{mask:qm}},helperText:n.helper_text||"",error:Boolean(n.helper_text)}))),r.a.createElement(_.a,{item:!0,xs:c?5:3,container:!0,justify:"center"},r.a.createElement(Be.a,{style:{margin:0},control:r.a.createElement(kt.a,{checked:Boolean(i.value),onChange:function(e){return u({type:"UPDATE_MOBILE",field:"status",value:e.target.checked?1:0,key:t,category:"mobile_numbers"})},color:"primary"}),label:"Active"})),!c&&r.a.createElement(_.a,{item:!0,xs:2,container:!0,justify:"center"},r.a.createElement(H.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return u({type:"DELETE",key:t,category:"mobile_numbers"})}},r.a.createElement(El.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,className:t.alignRight},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(jo.a,null),onClick:function(){return u({type:"ADD",category:"mobile_numbers"})}},"Add number"))),r.a.createElement(_.a,{item:!0,xs:12,lg:6,container:!0,spacing:1},r.a.createElement(y.a,{component:_.a,item:!0,xs:12,variant:"h6",align:"center"},"Emails"),0===m.emails.length&&r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),m.emails.map((function(e,t){var a=e.email,n=0!==e.email_id;return r.a.createElement(_.a,{item:!0,xs:12,container:!0,spacing:1,key:t},r.a.createElement(_.a,{item:!0,xs:n?12:10},r.a.createElement(Re.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Email Address",value:a.value,onChange:function(e){return u({type:"UPDATE_EMAIL",field:"email",value:e.target.value,key:t,category:"emails"})},helperText:a.helper_text||"",error:Boolean(a.helper_text)}))),!n&&r.a.createElement(_.a,{item:!0,xs:2,container:!0,justify:"center"},r.a.createElement(H.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return u({type:"DELETE",key:t,category:"emails"})}},r.a.createElement(El.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,className:t.alignRight},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(jo.a,null),onClick:function(){return u({type:"ADD",category:"emails"})}},"Add email"))),r.a.createElement(_.a,{item:!0,xs:12,container:!0,justify:"flex-end",style:{marginTop:8}},r.a.createElement(p.a,{color:"secondary",variant:"contained",style:{marginRight:6},disabled:m.field_with_error.size>0,onClick:function(){var e=function(e){var t={},a=Object(Rl.cloneDeep)(e);return delete a.field_with_error,Object.keys(a).forEach((function(e){var n=null;if("mobile_numbers"===e)n=a[e].map((function(e){var t=e.mobile_number,a=e.status;return Object(d.a)(Object(d.a)({},e),{},{status:a.value,mobile_number:Object(d.a)(Object(d.a)({},t),{},{sim_num:t.sim_num.value})})}));else if("emails"===e)n=a[e].map((function(e){return Object(d.a)(Object(d.a)({},e),{},{email:e.email.value})}));else if("birthday"===e){var r=a[e].value;n="string"===typeof r?r:r.format("YYYY-MM-DD")}else n=a[e].value;t[e]=n})),t}(m);console.log("Final",e),function(e,t){var a="".concat(We.b,"/api/users/update_user_info");it.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t=e.status,a=e.message;g(a,{variant:t,autoHideDuration:5e3}),"success"===t&&(l(!1),b(!0))}))}},"Save"),r.a.createElement(p.a,{color:"primary",variant:"contained",onClick:function(){return l(!1)}},"Cancel"))))}function tu(e){var t=e.classes,a=e.selectedUserDetails,l=a.first_name,i=a.last_name,c=a.middle_name,o=a.nickname,s=a.birthday,m=a.sex,u=a.mobile_numbers,d=a.emails,p=["","NA",null].includes(c)?"":"".concat(c,"."),b=null===s?"---":X()(s).format("MMMM DD, YYYY"),f="---";null!==m&&(f="F"===m.toUpperCase()?"Female":"Male");return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{component:_.a,item:!0,xs:12,gutterBottom:!0,variant:"h5"},"".concat(l," ").concat(p," ").concat(i)),r.a.createElement(y.a,{component:_.a,item:!0,xs:12,variant:"body2",color:"textSecondary",gutterBottom:!0,className:t.nickname},o),r.a.createElement(_.a,{item:!0,xs:12,container:!0,style:{marginBottom:16}},r.a.createElement(_.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Ym.a,{style:{paddingRight:8}}),r.a.createElement(y.a,{variant:"h6"},b)),r.a.createElement(_.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Bm.a,{style:{paddingRight:8}}),r.a.createElement(y.a,{variant:"h6"},f))),r.a.createElement(_.a,{item:!0,xs:12,lg:6},r.a.createElement(y.a,{variant:"h6"},"Contact Numbers"),r.a.createElement(hn.a,{dense:!0},0===u.length?r.a.createElement(yn.a,{className:t.listBody},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ae.a,null))),r.a.createElement(On.a,{primary:"No mobile numbers saved"})):u.map((function(e){return r.a.createElement(yn.a,{className:t.listBody,key:e.mobile_number.mobile_id},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ae.a,null))),r.a.createElement(On.a,{primary:(a=e.mobile_number.sim_num,a.match(/[()+-\s]/g)?a:new Fm.a("(+000) 00-000-0000").apply(a)),secondary:"Status: ".concat(0===e.status?"Inactive":"Active")}));var a})))),r.a.createElement(_.a,{item:!0,xs:12,lg:6},r.a.createElement(y.a,{variant:"h6"},"Emails"),r.a.createElement(hn.a,{dense:!0},0===d.length?r.a.createElement(yn.a,{className:t.listBody},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ms.a,null))),r.a.createElement(On.a,{primary:"No email addresses saved"})):d.map((function(e){return r.a.createElement(yn.a,{className:t.listBody,key:e.email_id},r.a.createElement(so.a,null,r.a.createElement(mo.a,null,r.a.createElement(Ms.a,null))),r.a.createElement(On.a,{primary:e.email}))})))),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"h6"},"Monitoring Shifts"),r.a.createElement(ol,{nickname:o})))}var au=function(e){var t=e.selectedUserDetails,a=e.isUser,l=e.url,i=Wm(),c=Object(n.useState)(!1),m=Object(o.a)(c,2),u=m[0],d=m[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),f=b[0],g=b[1],E=function(){d(!0),g(!1)},v=function(){return r.a.createElement(n.Fragment,null,r.a.createElement(H.a,{className:i.editButton,onClick:function(){return g(!0)}},r.a.createElement(gl.a,{color:"primary"})),r.a.createElement(Me.a,{onClose:function(){return g(!1)},"aria-labelledby":"simple-dialog-title",open:f},r.a.createElement(Ne.a,{id:"simple-dialog-title"},"Profile options"),r.a.createElement(hn.a,null,r.a.createElement(yn.a,{button:!0,onClick:E},r.a.createElement(jn.a,null,r.a.createElement(gl.a,null)),r.a.createElement(On.a,{primary:"Edit info"})),r.a.createElement(s.b,{to:"".concat(l,"/credentials"),className:i.link},r.a.createElement(yn.a,{button:!0},r.a.createElement(jn.a,null,r.a.createElement(Pm.a,null)),r.a.createElement(On.a,{primary:"Update credentials"}))))))};return r.a.createElement(n.Fragment,null,r.a.createElement(Rm.a,{component:"img",height:"200",className:i.media,image:Um.a,title:"Dynaslope Header Pic"}),r.a.createElement(Pa.a,{className:i.alignCenter},r.a.createElement(_.a,{container:!0,justify:"center"},r.a.createElement(_.a,{container:!0,item:!0,xs:12,className:i.avatarContainer,justify:"center"},r.a.createElement(io.a,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:a&&!u&&r.a.createElement(v,null)},r.a.createElement(mo.a,{className:i.avatar,src:vo.a}))),u?r.a.createElement(eu,{classes:i,selectedUserDetails:t,setIsEdit:d}):r.a.createElement(tu,{classes:i,selectedUserDetails:t}))))},nu=Object(O.a)((function(e){return Object(d.a)(Object(d.a)({},Object(F.d)(e)),{},{schedIcon:{width:50,height:50,display:"flex"},margin:{margin:e.spacing(1)},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1}})})),ru=r.a.forwardRef((function(e,t){return r.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}));var lu=function(e){var t=e.match.url,a=nu(),l=Object(n.useContext)(Kt).users,i=Object(x.a)(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],g=Object(n.useState)(!0),E=Object(o.a)(g,2),v=E[0],h=E[1],y=Object(n.useState)(!1),O=Object(o.a)(y,2),j=O[0],S=O[1],k=Object(n.useState)(!1),C=Object(o.a)(k,2),w=C[0],A=C[1];Object(n.useEffect)((function(){u(l)}),[l]),Object(n.useEffect)((function(){if("undefined"!==typeof m&&null!==m){var e=m.filter((function(e){if(e.user_id===i.user_id)return e}));f(e[0])}}),[m]),Object(n.useEffect)((function(){"undefined"!==typeof b&&null!==b&&(b.user_id===i.user_id?S(!0):S(!1),b.teams.forEach((function(e){A("web-admin"===e.team.team_name)})))}),[b]);var D=function(){h(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ge,{title:"Dynaslope | Staff Profiles"})),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(_.a,{container:!0,justify:"center",spacing:2},null!==m&&r.a.createElement(_.a,{item:!0,xs:12,md:4},r.a.createElement(Hm,{users:m,onMemberClickFn:function(e){return function(){f(e),h(!0)}},isWebAdmin:w,isUser:j,selectedUserDetails:b})),null!==b&&r.a.createElement(n.Fragment,null,r.a.createElement(re.a,{smDown:!0},r.a.createElement(_.a,{item:!0,xs:12,md:8},"undefined"!==typeof b&&r.a.createElement(Ya.a,null,r.a.createElement(au,{currentUser:i,selectedUserDetails:b,isUser:j,isAdmin:w,url:t})))),r.a.createElement(re.a,{mdUp:!0},r.a.createElement(Me.a,{fullScreen:!0,open:v,onClose:D,TransitionComponent:ru},r.a.createElement(M.a,{className:a.appBar},r.a.createElement(N.a,{style:{justifyContent:"flex-end"}},r.a.createElement(H.a,{edge:"end",color:"inherit",onClick:D,"aria-label":"close"},r.a.createElement(Ot.a,null)))),"undefined"!==typeof b&&r.a.createElement(au,{currentUser:i,selectedUserDetails:b,isUser:j,isAdmin:w,url:t})))))))},iu=a(524),cu=a.n(iu),ou=a(833),su=a(525),mu=a.n(su),uu=a(526),du=a.n(uu),pu=a(523),bu=a.n(pu),fu=Object(O.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},avatar_success:{margin:e.spacing(1),backgroundColor:"green"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},form_display:{display:"block"},form_hide:{display:"none"}}}));function gu(e){var t=e.history,a=fu(),l=Object(n.useState)(""),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],b=u[1],g=Object(n.useState)(""),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(n.useState)(""),O=Object(o.a)(_,2),j=O[0],S=O[1],k=Object(n.useState)(""),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(!0),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)(!1),R=Object(o.a)(T,2),Y=R[0],B=R[1],P=Object(n.useState)("error"),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)("Update login credentials"),W=Object(o.a)(U,2),G=W[0],q=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(x.a)().user_id;Object(n.useEffect)((function(){v.length>5||j.length>5?v===j?(s("Enter your old password below"),N(!1),z("primary")):(s("Passwords did not matched"),N(!0),z("error")):(s("Password too short"),z("error")),0!==v.length&&0!==j.length||s("")}),[v,j]);var X=function(){t.push("/profile")};return r.a.createElement(ou.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:a.paper},r.a.createElement(mo.a,{className:Z?a.avatar_success:a.avatar},Z?r.a.createElement(bu.a,null):r.a.createElement(cu.a,null)),r.a.createElement(y.a,{component:"h1"},G),r.a.createElement("div",{className:Z?a.form_hide:a.form_display},r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"New username (leave empty if no changes)",name:"Username",onChange:function(e){return b(e.target.value)}}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",fullWidth:!0,type:Y?"text":"password",label:"New password",id:"password1",onChange:function(e){return h(e.target.value)},InputProps:{endAdornment:r.a.createElement(Cs.a,{position:"end"},r.a.createElement(H.a,{"aria-label":"toggle password visibility",onClick:function(){return B(!Y)}},Y?r.a.createElement(mu.a,null):r.a.createElement(du.a,null)))}}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",type:"password",fullWidth:!0,id:"password2",label:"Confirm new password",onChange:function(e){return S(e.target.value)}}),r.a.createElement(y.a,{variant:"body2",color:F},c),r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"currentpassword",label:"Current password",type:"password",id:"password",autoComplete:"current-password",disabled:M,onChange:function(e){return A(e.target.value)}})),r.a.createElement(p.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:a.submit,disabled:M,onClick:Z?X:function(){!function(e,t){var a="".concat(We.b,"/api/users/update_account");it.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}({user_id:J,username:d,new_password:v,old_password:w},(function(e){"success"===e?(q("Account update success"),K(!0)):(K(!1),s("Invalid old password"),z("error"))}))}},Z?"go to profile":"save changes"),!Z&&r.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:X},"Cancel")))}var Eu=a(528),vu=a.n(Eu),hu=a(527),_u=a.n(hu),yu=a(370),Ou=a.n(yu),ju=a(530),xu=a.n(ju),Su=a(529),ku=a.n(Su),Cu=Object(O.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.primary.main,padding:5},successIcon:{margin:e.spacing(1),width:70,height:70,color:"green",backgroundColor:"white"},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)},hide:{display:"none"},flex:{display:"flex"}}}));function wu(e){var t=e.inputRef,a=e.mask,n=Object(Ht.a)(e,["inputRef","mask"]);return r.a.createElement(So.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}var Au=[{value:"Mr.",label:"Mr."},{value:"Ms.",label:"Ms."},{value:"Mrs.",label:"Mrs."}];function Du(){var e=Cu(),t=Object(n.useContext)(Kt).setRefreshUser,a=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],l=Object(n.useState)(""),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],b=u[1],g=Object(n.useState)(""),E=Object(o.a)(g,2),v=E[0],h=E[1],O=Object(n.useState)(""),j=Object(o.a)(O,2),x=j[0],S=j[1],k=Object(n.useState)([]),C=Object(o.a)(k,2),w=C[0],A=C[1],D=Object(n.useState)(""),I=Object(o.a)(D,2),M=I[0],N=I[1],T=Object(n.useState)([]),R=Object(o.a)(T,2),Y=R[0],B=R[1],P=Object(n.useState)(""),L=Object(o.a)(P,2),F=L[0],z=L[1],U=Object(n.useState)(""),W=Object(o.a)(U,2),G=W[0],q=W[1],V=Object(n.useState)(""),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)(!1),$=Object(o.a)(J,2),ee=$[0],te=$[1],ae=Object(n.useState)(null),ne=Object(o.a)(ae,2),re=ne[0],le=ne[1],ie=Object(n.useState)("m"),oe=Object(o.a)(ie,2),se=oe[0],me=oe[1],ue=Object(n.useState)("Mr."),de=Object(o.a)(ue,2),pe=de[0],be=de[1],fe=Object(n.useState)(!0),ge=Object(o.a)(fe,2),Ee=ge[0],ve=ge[1];Object(n.useEffect)((function(){ve(""===G||""===Z)}),[G,Z]);var he=function(){var e=Y.map((function(e){return e.replace(/[()+-\s]/g,"")})),a=[];e.forEach((function(e){var t={mobile_number:{mobile_id:0,sim_num:e},status:1};a.push(t)})),function(e,t){var a="".concat(We.b,"/api/users/create_dynaslope_user");it.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}({user_id:0,first_name:c,middle_name:d,last_name:v,nickname:x,salutation:pe,birthday:re,sex:se,emails:w,mobile_numbers:""!==e?a:[],landline_numbers:[],ewi_recipient:0,status:1,username:G,password:Z},(function(e){e.status&&(te(!0),t(!0))}))};return r.a.createElement(ou.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:e.paper},r.a.createElement(mo.a,{className:ee?e.successIcon:e.avatar},ee?r.a.createElement(_u.a,{className:e.successIcon}):r.a.createElement(vu.a,null)),r.a.createElement(y.a,{component:"h1",variant:"h5"},ee?"New user was created!":" Create Dynaslope User"),r.a.createElement("div",{className:ee?e.hide:e.form},r.a.createElement(_.a,{container:!0,spacing:2},r.a.createElement(_.a,{item:!0,xs:12,md:3},r.a.createElement(f.a,{variant:"outlined",value:pe,fullWidth:!0,select:!0,onChange:function(e){return be(e.target.value)},SelectProps:{native:!0}},Au.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))),r.a.createElement(_.a,{item:!0,xs:12,md:4},r.a.createElement(f.a,{variant:"outlined",value:c,label:"First Name",fullWidth:!0,onChange:function(e){return s(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12,sm:5},r.a.createElement(f.a,{variant:"outlined",value:d,label:"Middle Name",fullWidth:!0,onChange:function(e){return b(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:v,label:"Last Name",fullWidth:!0,onChange:function(e){return h(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{variant:"outlined",value:x,fullWidth:!0,label:"Nickame",onChange:function(e){return S(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12,md:4},r.a.createElement(f.a,{variant:"outlined",value:se,fullWidth:!0,select:!0,onChange:function(e){return me(e.target.value)},SelectProps:{native:!0}},r.a.createElement("option",{value:"m"},"Male"),r.a.createElement("option",{value:"f"},"Female"))),r.a.createElement(_.a,{item:!0,xs:12,md:8},r.a.createElement(Ct.a,{utils:At.a},r.a.createElement(Nr.b,{disableToolbar:!0,variant:"dialog",format:"yyyy-MM-DD",margin:"normal",label:"Birth Date",value:re,onChange:function(e){return function(e){var t=X()(e).format("yyy-MM-DD");le(t)}(e)},KeyboardButtonProps:{"aria-label":"change date"},placeholder:"YYYY-MM-DD",fullWidth:!0,style:{marginTop:0},disableFuture:!0,maxDate:X()().subtract(15,"years")}))),Y.length>0&&Y.map((function(t,n){return r.a.createElement(_.a,{item:!0,xs:12,key:t,className:e.flex},r.a.createElement(f.a,{variant:"outlined",value:t,fullWidth:!0,label:"Phone",InputProps:{inputComponent:wu,inputProps:{mask:a}}}),r.a.createElement(xe.a,{title:"remove from list"},r.a.createElement(H.a,{variant:"contained",style:{margin:2,color:"red"},onClick:function(e){return function(e){var t=Y;t.splice(e,1),B(Object(Xe.a)(t))}(n)}},r.a.createElement(ku.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,className:e.flex},r.a.createElement(f.a,{variant:"outlined",value:F,fullWidth:!0,onChange:function(e){return z(e.target.value)},placeholder:"Mobile Number",InputProps:{inputComponent:wu,inputProps:{mask:a}}}),r.a.createElement(xe.a,{title:"add to list"},r.a.createElement(H.a,{color:"primary",variant:"contained",style:{margin:2},onClick:function(e){return function(){if(F.length>0){var e=Y;e.push(F),B(Object(Xe.a)(e)),z("")}}()}},r.a.createElement(xu.a,null)))),r.a.createElement(ce.a,null),w.length>0&&w.map((function(e,t){return r.a.createElement(_.a,{item:!0,xs:12,key:e},r.a.createElement(Oa.a,{fullWidth:!0,value:e,onChange:function(e){return N(e.target.value)},endAdornment:r.a.createElement(Cs.a,{position:"end"},r.a.createElement(xe.a,{title:"Remove email from list"},r.a.createElement(H.a,{onClick:function(e){return function(e){var t=w;t.splice(e,1),A(Object(Xe.a)(t))}(t)}},r.a.createElement(Ou.a,null))))}))})),r.a.createElement(_.a,{item:!0,xs:12},r.a.createElement(Oa.a,{fullWidth:!0,placeholder:w.length>0?"Add another email":"Email",value:M,onChange:function(e){return N(e.target.value)},endAdornment:r.a.createElement(Cs.a,{position:"end"},r.a.createElement(xe.a,{title:"add email to list"},r.a.createElement(H.a,{color:"primary",onClick:function(e){return function(){if(M.length>0){var e=w;e.push(M),A(Object(Xe.a)(e)),N("")}}()}},r.a.createElement(ds.a,null))))})),r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:G,fullWidth:!0,label:"username",type:"text",onChange:function(e){return q(e.target.value)}})),r.a.createElement(_.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:Z,fullWidth:!0,label:"Password",type:"password",onChange:function(e){return K(e.target.value)}})))),r.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",className:e.submit,onClick:ee?function(e){window.location.href=We.c}:function(e){return he()},disabled:!ee&&Ee},ee?"Dashboard":"Create"),ee&&r.a.createElement(p.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(e){return s(""),b(""),h(""),S(""),me(""),le(null),be(""),q(""),K(""),A([]),B([]),ve(!0),void te(!1)}},"Create another account")))}var Iu=function(e){var t=e.location,a=e.match.url;return r.a.createElement(m.d,{location:t},r.a.createElement(m.b,{exact:!0,path:a,component:mr}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/events"),component:Ir}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/shifts_and_reports"),component:bl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/issues_and_reminders"),component:Nl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/logs"),component:Cl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/qa"),component:$l}),r.a.createElement(m.b,{path:"".concat(a,"monitoring"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(m.b,{path:"".concat(a,"analysis/sites"),component:qc}),r.a.createElement(m.b,{path:"".concat(a,"analysis/alerts"),component:lo}),r.a.createElement(m.b,{path:"".concat(a,"analysis"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(m.b,{path:"".concat(a,"communication/chatterbox"),component:Ss}),r.a.createElement(m.b,{path:"".concat(a,"communication/contacts"),component:rm}),r.a.createElement(m.b,{path:"".concat(a,"communication/mailbox"),component:dm}),r.a.createElement(m.b,{path:"".concat(a,"communication"),render:function(){return r.a.createElement("h3",null,"Sorry. We could not find what you are looking for.")}}),r.a.createElement(m.b,{path:"".concat(a,"community/site_info"),component:Nm}),r.a.createElement(m.b,{path:"".concat(a,"profile/credentials"),component:gu}),r.a.createElement(m.b,{path:"".concat(a,"profile/create"),component:Du}),r.a.createElement(m.b,{path:"".concat(a,"profile"),component:lu}),r.a.createElement(m.b,{render:function(){return r.a.createElement("h3",null," Not found")}}))};var Mu=function(e){var t=e.match.params,a=t.site_code,l=t.ts_end,i=t.chart_type,s=t.tsm_sensor,m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],p=u[1],b=Object(n.useState)(""),f=Object(o.a)(b,2),g=f[0],E=f[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],j=Object(c.b)().enqueueSnackbar,S=Object(x.a)(),k=Object(O.a)((function(e){return Object(F.d)(e)}))();Object(n.useEffect)((function(){j("Please wait for the charts to load before closing the page. If loading took long enough, please wait for about a minute and check your connection before trying again. If loading problem persist, contact the developers.",{variant:"warning",autoHideDuration:1e4,style:{whiteSpace:"pre-line"},anchorOrigin:{vertical:"top",horizontal:"center"}});var t,n={site_code:a,ts_end:l};"rainfall"===i?(t=r.a.createElement(Xi,Object.assign({},e,{input:n,currentUser:S,disableBack:!0,saveSVG:!0})),p(t)):"surficial"===i?(t=r.a.createElement(Fi,Object.assign({},e,{input:n,currentUser:S,disableBack:!0,disableMarkerList:!0,isEndOfShift:!0,saveSVG:!0})),E(t)):"subsurface"===i&&(n.tsm_sensor=s,t=r.a.createElement(uc,Object.assign({},e,{input:n,currentUser:S,disableBack:!0,saveSVG:!0,isEOS:!0})),y(t))}),[]);var C=ot(i);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:k.pageContentMargin},r.a.createElement(ge,{title:"Chart Rendering | ".concat(a.toUpperCase()," | ").concat(C)})),r.a.createElement("div",{className:k.pageContentMargin},d,g,_))};var Nu=Object(u.a)((function(e){return{app:{height:"100%",minHeight:"85vh",display:"flex",flexDirection:"column",justifyContent:"space-between"},body:{marginTop:60,[e.breakpoints.up("sm")]:{marginTop:70},[e.breakpoints.up("md")]:{marginTop:124}}}}))((function(e){var t=e.classes;Object(n.useEffect)((function(){document.title="MIA 3.0 - Dynaslope Monitoring and Information Application"}),[]);var a=Object(n.useState)(!1),l=Object(o.a)(a,2),i=l[0],c=l[1],u=function(e){return function(){c(e)}},d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],g=Object(n.useRef)(!1);Object(n.useEffect)((function(){return Object(x.b)((function(e){f(e),e&&(g.current=setInterval(x.e,We.a))})),function(){return clearInterval(g.current)}}),[]);var E=function(){f(!0),g.current=setInterval(x.e,We.a)},v=function(){f(!1),clearInterval(g.current)};return r.a.createElement(s.a,null,r.a.createElement(m.d,null,r.a.createElement(m.b,{path:"/bulletin/:release_id",component:_t}),r.a.createElement(m.b,{path:"/chart_rendering/:site_code/:ts_end/:chart_type/:tsm_sensor?",component:Mu}),r.a.createElement(m.b,{exact:!0,path:"/login",render:function(e){return null===b?r.a.createElement("div",null,"Loading..."):b?r.a.createElement(m.a,{to:"/"}):r.a.createElement(I,Object.assign({},e,{onLogin:E}))}}),r.a.createElement(m.b,{path:"/",render:function(e){return null===b?r.a.createElement("div",null,"Loading..."):b?r.a.createElement(Jt,null,r.a.createElement(Aa,null,r.a.createElement(ee.b,null,r.a.createElement(U,Object.assign({},e,{drawerHandler:u,onLogout:v})),r.a.createElement(ne,Object.assign({},e,{drawerHandler:u,drawer:i,onLogout:v})),r.a.createElement("div",{className:t.app},r.a.createElement("div",{className:t.body},r.a.createElement(Iu,e))),r.a.createElement(T,null)))):r.a.createElement(m.a,{to:"/login"})}})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Tu(){}console.log=Tu,console.warn=Tu,console.error=Tu,i.a.render(r.a.createElement(c.a,{maxSnack:3,anchorOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(Nu,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},94:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return u})),a.d(t,"a",(function(){return m})),a.d(t,"e",(function(){return d}));var n,r=a(187),l=a.n(r),i=a(11);function c(){"undefined"!==typeof n&&null!==n||(n=l()("".concat(i.b,"/misc"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function o(){c(),n.emit("get_server_time")}function s(e){n.on("receive_server_time",(function(t){e(t)}))}function m(){c(),n.emit("get_monitoring_shifts")}function u(e){c(),n.on("receive_monitoring_shifts",(function(t){var a=JSON.parse(t);console.log("Monitoring Shifts:",a),e(a)}))}function d(){n.removeListener("receive_monitoring_shifts")}}},[[544,1,2]]]);
//# sourceMappingURL=main.acb39884.chunk.js.map