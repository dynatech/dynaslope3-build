(this["webpackJsonpmia-3.0"]=this["webpackJsonpmia-3.0"]||[]).push([[0],{118:function(e,t){e.exports="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAgMAAAACc8MQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURcXFxf///+np6dbW1sCaIHAAAAnDSURBVHja7d0xbuw2FEBRNW7UaGtu1LDR1tiwcTNbU6NmGgcJEqQIkPx4SOq9uffuQAcg+Uj/by+LmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ5e77+fW1/1H5+vo+BYB9/Z/f/nflcQpAafvH1/9lIAD58zEEcIDtuf9r5VuAt+7Z9v/q6xQAuf8hdkI6wHfbf613nYrpAM/9lyunAOjvf08BOMCvnYBvfBbSAba2/98eArC//70E8AA/+f59rwIgZ6B3nIboAD/8/vcRoAP8+PvfRYAOsO0vdAjAnILfaR7GA7z2/W8wD9MBni9+f/qTkA6w7S93CEDeAtNvg3SAZ4fvT70N0gG2vUuHAOQtMPU2SAd4dvr+tNsgHWDrtQKyPovgAbqtgKxrgA6w7R07BMjX1RNgPwVAr4CMawAP0PoC5LsQ0QHWzt+/FwHYKyDdGqADbN2/P9lBiAe4+gPkmobpAANWQK41gAcYsQJSrQE6wNaGADwEAD6I53wcxwOMWQGJ7kN0gHXQ96d5FMEDXKMAsoxCdIBt2PcnuQ/hAdZxAEUA8hiUZhSiAwzcA3PsgniAayRAhlEID9CGAlQBwGNQjlEIDzB2D0ywC+IB2mCAKgB4EM4wDOMBRu+B4XdBPEAbDlAFQO+B0XdBPMA6HqAIwD4Fg5+DeIA2AaAKgN4DY++CeIAZe2DoXRAP0KYAVAHAV6HY1yE8wDoHoAjAPgUDn4N4gDYJoAoggADgOSjuJIQHWGcBFAHYc1DYSQgP0KYBVAHQp2DUc1AAAeAA6zyAIgB7Dgo6CeEB2kSAKoAAAoDnoJiTEB5gnQlQBBBAAPIkHHIWFkAAOECbClAFCNfU798/BUDfhSLehvAA61yAIoAAAsTqYy7ALgD7LhTwNoQHaJMBqgACCAC+DQe8DwsgABtgmw1wCCCAAOD3kHgvIgIIAAeY/SIW7k1MAAHgANd0gFMAAQQQQADsq3i4d3EBBBBAAAEEEEAALMD074/201EBBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAAMgD8bFEAAAQQQQAABBKACXNMB/P8CAggggABx8v8OCyAAG8DfISKAAGwAf5eYAAKwAfydogIIAAfwd4sLIAAbYParqH9jJBqAf2eIDuDfGhNAADaAf3OUDuDfHcYD+LfH6QBzb0OnAAIIQJ6F403CAgiAB5h6GzoECNjMWbgKIIAA6Fn4FIA9CUWcgwSYOQkdAgggAHoSqgKE7GLPQQLMm4RizkECzDsHDwGC1tinoAAC4AEu9hwkwKxJKOocJMCsSegQIGyNfQoKMOkcPAVgn4NxT0EB5uyCVYCFvQueArB3wdB7oAATrkOHAKFr7FNQgAnn4CkAexcMvgcKMHwXrAIs7F3wFCB4g69DZRGAvQtWARb2LngKEL4NPQgLMHgXrAIkaEWPQQIM3QUPAVJ0kccgAUbugjn2QAHGjUJVgCQ9B62AU4AkbWPWwGMRIEsXeQwSYNR96FgEYK+BUwD2Gki1AgQYcB+qAqSq+6NIWQRgr4EqQLI29CEoQPdp+BSAvQYSrgABej6Ol1OAjGug3yz0WARAr4GcK0CAfheiugiQsw08BQnQbxtMuwUK0GkbrIsAC3kbPBYBMvdEb4ECdNgG6yJA7l58FnksAqQXAJ+BArx6EqY/AwV4TeBNvl+Anwq8zfcL8MN5uC4CvEfbD5fA4xTgPb6/wY9BOsDzhftweQhAvgq9x4MIHGD7evVZ/OsUgPsimv8spAP0+aeSiQXoAL3+rWxaATpAv38snVSADtDzd+mkFKAD9P1lSgkF6AC9f5tWOgE6QP9fp5ZMgA4w4vfppRLAA1z7gA4BKE/h+Z/I6QCDvj+PAB1g4B9YOAWADkGphiE8wNA/t1cE4J6BWU5COsDgv7ka/9/P0gG20X95O/pJiAe49uEdAnDPwPgnIR1g/BYYfBvEA0z5/sg3IjrAc5/UQwDwFhh4G8QDXPu0DgGITyHRn0XoAPO2wKDbIB7guU/tIUC0FbBP7hQAOwXFnIXoAOs+vSoA8DEs7sMYHeC539BDAOhFKOCFCA9wywqItAboAPesgEBrAA9w0wqIswboANt+W6cAyLeQaK8idIAbV0CMNYAHuO4EOARgr4AIawAPcN0LcAgAvQqHuRLjAZ77zT0EQK+A29cAHuD2FXD3GsADtPsBigA3tu4BqgKgV8C9a4AOEGIF3LkG8ABXDIBDAOZ76P0vo3iAZxSAhwDgMejOUYgOsO5hqgKgV8Bda4AOsO2BOgXA3oTuuw/hAVokgCIAeQy6ZxTCA1yxAA4ByGPQHaMQHmCNBlAFAI9Bd4xCdIBwe+DsXRAPcMUDOARA74Gzd0E6wLoHrAqA3gPn7oJ4gBYRoAjA3gNn7oJ4gCsmwCEAeg+cuQvSAYLugfN2QTzAFRXgEAC9B87bBekAYffAWbsgHuCKC3AIgN4DZ+2CdIBtD9wpAPoUnHMO4gFaZIAiAHsPnLEL4gHW2ABVAPBVaM51CA/QYgMUAdin4PhzEA+wRgeoAqD3wPG7IB0g/B44ehfEA6zxAaoA4KvQ+OsQHqDFBygCsE/BsecgHmDNAFAFQJ+CY89BPEDLAFAEYJ+CI89BPMCaA6AKgD4FR56DeICWA6AIwD4Fx52DeIA1C0AVAH0KjjsH8QAtC0ARQAAByHPQqEkID7DmAagCoOegUZMQHqDlASgCsE/BMecgHmDNBFAFEEAA8Bw0ZhLCA7RMAEUA9hw0YhLCA6y5AKoAAggAnoNGTEJ4gJYLoAjAnoP6T0ICCAAHWLMBVAHQc1D/SQgP0LIBFAEEEIA8B/WehPAAaz6AKoAAAoAn4d6zMB6g5QMoAgggAHkS7jsL4wHWjABVAAEEAE/CfWdhAQSAA7SMAEWAfu0pE4B9F+p5G8IDrDkBqgACCACehHvOwgIIAAdoOQGKAAIIQL4L9bsNCSAAHGDNClAFEEAA8F2o321IAAHgAC0rQBFAAAG4Pxz/PQHYt+Fe92EBBIADrHkBqgACCPB6H3kBPgVAv4f0ehERQAA4QMsLUAQQQADyi1inNzE6wJYZ4BRAAAHA7yF9XkQEEEAAAdAAH5kBPgVAv4j1eRMTQAABBEADtMwARQABBBBAAO7PRbr8ZEQAAdgAW26AUwABBBBAAOzPRXr8ZEQAAQQQQAABwAAfuQE+BRBAAAEEwP50vMfPxwUQQAABBBAADNByAxQBBBBAAAH+pd8AoDH47zbOd5EAAAAASUVORK5CYII="},163:function(e,t,a){e.exports=a.p+"static/media/phivolcs-dynaslope-logo.de612ba1.png"},27:function(e,t,a){"use strict";t.a=e=>({dynaslopeLogo:{height:60},phivolcsLogo:{height:70,marginTop:8},phivolcsDynaslopeLogo:{height:62},pageContentMargin:{margin:"0 16px",[e.breakpoints.up("md")]:{margin:"0 64px"},[e.breakpoints.up("lg")]:{margin:"0 100px"}},paperContainer:{width:"100%",overflowX:"auto"},sectionHeadContainer:{margin:"20px 0"},sectionHead:{fontSize:"1.5rem",[e.breakpoints.down("xs")]:{fontSize:"1.2rem"}},extended:{backgroundColor:"green"},alert0:{backgroundColor:"#EEEEEE"},alert1:{backgroundColor:"#FCEE27"},alert2:{backgroundColor:"#F8991D","& *":{color:"white !important"}},alert3:{backgroundColor:"#991B1E","& *":{color:"white !important"}},dyna_error:{color:"#FE0000"}})},442:function(e,t,a){e.exports=a.p+"static/media/login-bg-img.6bf92800.jpg"},445:function(e,t,a){"use strict";(function(e){var n=a(4),r=a(0),l=a.n(r),i=a(29),c=a(700),o=a(267),s=a(41),m=a(473),d=a(282),u=a(283),p=a(687),g=a(202),b=a(688),E=a(468),h=a(686),f=a(689),_=a(690),y=a(7),v=a(163),O=a.n(v),x=a(27);class j extends r.Component{constructor(...e){super(...e),this.state={open:{}},this.handleNestedList=e=>{const t=this.state.open,a="undefined"!==typeof t[e]&&t[e];this.setState(t=>({open:{[e]:!a}}))}}render(){const t=this.props,a=t.classes,n=t.drawerHandler,y=t.drawer,v=t.navigationLabels,x=this.state.open,j=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent);return l.a.createElement(c.a,{open:y,onClose:n(!1),onOpen:n(!0),disableBackdropTransition:!j,disableDiscovery:j},l.a.createElement("div",{tabIndex:0,role:"button",onKeyDown:n(!1)},l.a.createElement("div",{className:a.list},l.a.createElement(o.a,{className:a.drawerHeader},l.a.createElement("img",{src:O.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(a.phivolcsDynaslopeLogo," ").concat(a.logo)}),l.a.createElement(s.a,{variant:"h5",className:a.projectTitle},"MIA 3.0"),l.a.createElement(s.a,{variant:"subtitle2",className:a.projectSubtitle},"Monitoring and Information Application")),l.a.createElement(m.a,null),l.a.createElement(d.a,{component:"nav"},l.a.createElement(u.a,{button:!0},l.a.createElement(p.a,null,l.a.createElement(h.a,null)),l.a.createElement(g.a,{primary:"Profile"}))),l.a.createElement(m.a,null),l.a.createElement(d.a,{component:"nav",subheader:l.a.createElement(b.a,{component:"div"},"Directory")},v.map(({key:e,main:t,sub:c})=>l.a.createElement(r.Fragment,{key:e},l.a.createElement(u.a,{button:!0,onClick:()=>this.handleNestedList(e)},l.a.createElement(g.a,{primary:t}),x[e]?l.a.createElement(f.a,null):l.a.createElement(_.a,null)),l.a.createElement(E.a,{in:x[e],timeout:"auto",unmountOnExit:!0},l.a.createElement(d.a,{component:"div",disablePadding:!0},c.map(({label:e,link:t})=>l.a.createElement(i.b,{to:t,key:e,className:a.link},l.a.createElement(u.a,{button:!0,className:a.nested,onClick:n(!1)},l.a.createElement(g.a,{primaryTypographyProps:{className:a.nestedText},primary:e}))))))))))))}}t.a=Object(y.a)(e=>Object(n.a)(Object(n.a)({},Object(x.a)(e)),(e=>({list:{width:300,maxWidth:360},nested:{paddingLeft:e.spacing(3)},nestedText:{fontSize:"0.9rem"},drawerHeader:{height:160,display:"block",alignItems:"center",textAlign:"center",padding:16},logo:{height:105},titleBlock:{display:"block",margin:"0 4px"},projectTitle:{fontWeight:600},link:{textDecoration:"none"}}))(e)),{withTheme:!0})(j)}).call(this,a(180))},447:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-head.ff13773e.png"},448:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-footer.fc7bb5bf.png"},479:function(e,t,a){e.exports=a(675)},484:function(e,t,a){},531:function(e,t){},675:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(14),i=a.n(l),c=(a(484),a(21)),o=a(2),s=a(29),m=a(44),d=a(7),u=a(4),p=a(121),g=a(704),b=a(260),E=a(328),h=a(703),f=a(94),_=a(307),y=a(281),v=a(41),O=a(56),x=a(706),j=a(17),S=a.n(j);const k="http://dynaslope.phivolcs.dost.gov.ph:5000";function C(e,t){const a="".concat(k,"/api/refresh_session");S.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}function w(e){const t=JSON.parse(localStorage.getItem("data"));if(null!==t){const a=t.tokens,n=a.access_token,r=a.refresh_token;!function(e,t){const a="".concat(k,"/api/check_session");S.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(n,a=>{const n=a.is_logged_in;n&&C(r,e=>{t.tokens.access_token=e.access_token,localStorage.setItem("data",JSON.stringify(t))}),e(n)})}else e(!1)}function A(){const e=JSON.parse(localStorage.getItem("data"));C(e.tokens.refresh_token,t=>{e.tokens.access_token=t.access_token,localStorage.setItem("data",JSON.stringify(e))})}function I(e,t,a){!function(e,t){const a="".concat(k,"/api/login");S.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const n=e.ok,r=e.message,l=e.data;n?(localStorage.setItem("data",JSON.stringify(l)),t(l)):a(r)})}function D(){return JSON.parse(localStorage.getItem("data")).user}var M=a(163),N=a.n(M),T=a(442),H=a.n(T);function R(){return r.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",r.a.createElement(h.a,{color:"inherit",href:"https://material-ui.com/"},"Project Dynaslope")," ",(new Date).getFullYear(),".")}const B=Object(O.a)(e=>({root:{height:"100vh"},image:{backgroundImage:"url(".concat(H.a,")"),backgroundSize:"cover",backgroundPosition:"center"},paperContainer:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{margin:e.spacing(0,4),display:"flex",flexDirection:"column",alignItems:"center",paddingBottom:e.spacing(5),[e.breakpoints.up("lg")]:{paddingBottom:e.spacing(9)}},phivolcsDynaslopeLogo:{margin:e.spacing(1),height:200,[e.breakpoints.between("sm","md")]:{height:164},[e.breakpoints.only("xs")]:{height:140}},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},title:{margin:e.spacing(2,0),[e.breakpoints.down("sm")]:{fontSize:"1.25rem"},[e.breakpoints.only("xs")]:{margin:e.spacing(0,0)}},passwordField:{margin:e.spacing(0,0,3,0),[e.breakpoints.only("xs")]:{margin:e.spacing(0,0,1,0)}},buttonChild:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"}}));function Y(e){const t=B(),a=Object(n.useState)({username:"",password:""}),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)({username:!1,password:!1}),m=Object(o.a)(s,2),d=m[0],h=m[1],O=Object(n.useState)(""),j=Object(o.a)(O,2),S=j[0],k=j[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],D=w[1],M=e.history,T=e.onLogin,H=()=>{Object.entries(i).forEach(e=>{const t=Object(o.a)(e,2),a=t[0],n=t[1];""===n&&z(a,n)}),Object.values(d).includes(!0)?k("Fill up all required fields"):(D(!0),I(i,()=>{D(!1),T(),M.push("/")},e=>{D(!1),k(e)}))},Y=i.username,P=i.password,L=e=>t=>{const a=t.target.value;c(Object(u.a)(Object(u.a)({},i),{},{[e]:a})),k(""),z(e,a)},F=e=>t=>{z(e,i[e])},z=(e,t)=>{h(Object(u.a)(Object(u.a)({},d),{},{[e]:""===t}))};return r.a.createElement(y.a,{container:!0,component:"main",className:t.root},r.a.createElement(g.a,null),r.a.createElement(y.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),r.a.createElement(y.a,{item:!0,xs:12,sm:8,md:5,component:f.a,elevation:6,square:!0,className:t.paperContainer},r.a.createElement("div",{className:t.paper},r.a.createElement("img",{src:N.a,alt:"PHIVOLCS-Dynaslope Logo",className:t.phivolcsDynaslopeLogo}),r.a.createElement(v.a,{component:"h1",variant:"h5",align:"center",className:t.title},r.a.createElement("strong",null,"MONITORING AND INFORMATION APPLICATION (MIA 3.0)")),r.a.createElement("div",{className:t.form},r.a.createElement(b.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:Y,onChange:L("username"),onFocus:F("username"),error:d.username}),r.a.createElement(b.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:P,onChange:L("password"),onKeyPress:e=>{"Enter"===e.key&&H()},onFocus:F("password"),error:d.password,className:t.passwordField}),""!==S&&r.a.createElement(E.a,{error:!0,focused:!0},S),r.a.createElement(p.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:H,disabled:A},A?r.a.createElement("div",{className:t.buttonChild},r.a.createElement("span",{style:{marginRight:6}},"Signing In... "),r.a.createElement(x.a,{color:"secondary",size:20})):r.a.createElement("span",null,"Sign In")),r.a.createElement(_.a,{mt:5},r.a.createElement(R,null))))))}var P=a(707),L=a(267);var F=Object(d.a)(e=>({footer:{display:"flex",padding:"2% 0",flexDirection:"column",marginTop:40,justifyContent:"center",alignItems:"center",textAlign:"center",[e.breakpoints.down("sm")]:{marginTop:30},zIndex:0},footerText:{fontSize:"0.5rem",[e.breakpoints.up("sm")]:{fontSize:"0.85rem"}}}))((function(e){const t=e.classes;return r.a.createElement(P.a,{position:"static",className:t.footer},r.a.createElement(L.a,null,r.a.createElement(v.a,{variant:"subtitle2",color:"inherit",className:t.footerText},"4F PHIVOLCS Building, C. P. Garcia Avenue, UP Campus, Diliman, Quezon City 1101 ",r.a.createElement("br",null),"Tel. no. (02) 8426-1468 loc. 401 & 403 | dynaslope.phivolcs@gmail.com ",r.a.createElement("br",null),"www.facebook.com/dynaslopecommunity")))})),z=a(171),G=a(444),U=a(390),W=a(708),q=a(686),V=a(27);var Q=Object(d.a)(e=>Object(u.a)(Object(u.a)({},Object(V.a)(e)),(e=>({root:{width:"100%"},grow:{flexGrow:1},menuButton:{display:"flex",marginLeft:-12,marginRight:0,[e.breakpoints.up("md")]:{display:"none"}},projectTitle:{display:"block",fontWeight:900},titleBlock:{display:"block",margin:"0 4px",alignItems:"center",textAlign:"center",justifyContent:"center"},projectSubtitle:{display:"none",fontSize:"0.7rem",marginTop:-3,[e.breakpoints.up("md")]:{display:"block"}},logo:{marginRight:12,[e.breakpoints.down("sm")]:{marginRight:0}},sectionDesktop:{display:"none",[e.breakpoints.up("md")]:{display:"flex",padding:"4px 0"}},list:{width:250},menu:{marginTop:40}}))(e)),{withTheme:!0})((function(e){const t=e.classes,a=e.drawerHandler,l=e.history,i=e.onLogout,c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],d=s[1],u=()=>{d(null)},g=D().first_name;return r.a.createElement("div",{className:t.root},r.a.createElement(P.a,{position:"fixed",color:"primary"},r.a.createElement(L.a,null,r.a.createElement(z.a,{onClick:a(!0),className:t.menuButton,color:"inherit","aria-label":"Open drawer"},r.a.createElement(W.a,null)),r.a.createElement("img",{src:N.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(t.phivolcsDynaslopeLogo," ").concat(t.logo," ").concat(t.sectionDesktop)}),r.a.createElement("div",{className:t.titleBlock},r.a.createElement(v.a,{className:t.projectTitle,variant:"h4",color:"inherit",noWrap:!0},"MIA 3.0"),r.a.createElement(v.a,{variant:"caption",className:t.projectSubtitle,color:"inherit"},"Monitoring and Information Application")),r.a.createElement("div",{className:t.grow}),r.a.createElement("div",{className:t.sectionDesktop},r.a.createElement(p.a,{"aria-owns":"menu-list-grow","aria-haspopup":"true",onClick:e=>{d(e.currentTarget)},color:"inherit",startIcon:r.a.createElement(q.a,null)},r.a.createElement("strong",null,g))))),r.a.createElement(G.a,{id:"simple-menu",anchorEl:m,keepMounted:!0,open:Boolean(m),onClose:u,className:t.menu},r.a.createElement(U.a,{disabled:!0,onClick:u},"Profile",r.a.createElement(v.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")),r.a.createElement(U.a,{onClick:()=>{var e;e=()=>{i(),l.push("/login")},localStorage.clear(),e()}},"Logout")))})),Z=a(698),K=a(474),J=a(692),X=a(201),$=a(679),ee=a(684),te=a(153),ae=a(8),ne=a.n(ae),re=a(445);function le(e,t=!0,a="end"){const n=e.purok,r=e.sitio,l=e.barangay,i=e.municipality,c=e.province,o=e.site_code;let s="";if(null!==r&&""!==r&&(s="Sitio ".concat(r,", ")),null!==n&&""!==n&&(s+="Purok ".concat(n,", ")),s+="Brgy. ".concat(l,", ").concat(i,", ").concat(c),t){const e=o.toUpperCase();"end"===a?s+=" (".concat(e,")"):s="".concat(e," (").concat(s,")")}return s}function ie(e,t=!1){const a=e=>e.charAt(0).toUpperCase()+e.slice(1);if(t){return e.split(" ").map(e=>a(e)).join(" ")}return a(e)}function ce(e,t=!1){let a=null;const n=e.map(e=>{const n=e.site,r=e.org_name;return a=r.toUpperCase(),t?n:n.site_code.toUpperCase()});return t?{sites:n,org:a}:(a&&n.unshift(a),n)}function oe(e){let t=!1;return e.length>0&&(t=Boolean(e[0].primary_contact)),t}function se(e){return"0"===e[0]||e.match(/[a-z]/i)?e:"+".concat(e)}function me(e,t=7,a="days"){if("all"===a)return"None";return e.clone().subtract(t,a).format("YYYY-MM-DD HH:mm:ss")}function de(e,t,a=null,n=null){S.a.post(e,t).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e),null!==n&&n(e)})}function ue(e,t=null){S.a.get(e).then(e=>{const a=e.data;null!==t&&t(a)}).catch(e=>{console.log(e)})}function pe(e){const t=["january","february","march","april","may","june","july","august","september","october","november","december"];e.sort((e,a)=>t.indexOf(e)-t.indexOf(a))}var ge=a(164),be=a.n(ge);let Ee;function he(){"undefined"!==typeof Ee&&null!==Ee||(Ee=be()("".concat(k,"/misc"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function fe(){he(),Ee.emit("get_monitoring_shifts")}function _e(e){he(),Ee.on("receive_monitoring_shifts",t=>{const a=JSON.parse(t);console.log("Monitoring Shifts:",a),e(a)})}function ye(){Ee.removeListener("receive_monitoring_shifts")}const ve=Object(n.createContext)(),Oe=({children:e})=>{const t=Object(n.useState)(!0),a=Object(o.a)(t,2),l=a[0],i=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],u=m[1],p=Object(n.useState)([]),g=Object(o.a)(p,2),b=g[0],E=g[1],h=Object(n.useState)([]),f=Object(o.a)(h,2),_=f[0],y=f[1],v=Object(n.useState)([]),O=Object(o.a)(v,2),x=O[0],j=O[1],S=Object(n.useState)(null),C=Object(o.a)(S,2),w=C[0],A=C[1],I=Object(n.useState)(null),D=Object(o.a)(I,2),M=D[0],N=D[1];Object(n.useEffect)(()=>{var e;l&&(e=e=>{const t=e.filter(e=>e.active);E(t),y(e),i(!1)},ue("".concat(k,"/api/sites/get_sites_data?include_inactive=true"),e))},[l]),Object(n.useEffect)(()=>{var e;e=e=>{u(e)},ue("".concat(k,"/api/users/get_dynaslope_users"),e)},[]),Object(n.useEffect)(()=>{var e;e=e=>{j(e)},ue("".concat(k,"/api/users/get_organizations"),e)},[]),Object(n.useEffect)(()=>{var e;he(),Ee.emit("get_server_time"),e=e=>{N(e)},Ee.on("receive_server_time",t=>{e(t)})},[]);const T=Object(c.b)(),H=T.enqueueSnackbar,R=T.closeSnackbar,B=Object(n.useState)(null),Y=Object(o.a)(B,2),P=Y[0],L=Y[1];Object(n.useEffect)(()=>{if(null!==w)if(!0===w){const e=H("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});L(e)}else R(P),H("Reconnection successful...",{variant:"success",autoHideDuration:5e3})},[w]);const F={users:d,sites:b,all_sites_including_inactive:_,organizations:x,is_reconnecting:w,setIsReconnecting:A,setRefreshSites:i,server_time:M};return r.a.createElement(ve.Provider,{value:F},e)},xe=Object(O.a)(e=>({navBar:{display:"none",[e.breakpoints.up("md")]:{display:"block"}},appBar:{top:70},popper:{zIndex:500,marginTop:2},list:{width:250},link:{textDecoration:"none",color:"blue"}})),je=[{key:"monitoring",main:"Monitoring",sub:[{label:"Dashboard",link:"/"},{label:"Events Table",link:"/monitoring/events"},{label:"Shifts and Reports",link:"/monitoring/shifts_and_reports"},{label:"Issues and Reminders",link:"/monitoring/issues_and_reminders"},{label:"Site Logs",link:"/monitoring/logs"},{label:"Quality Assurance",link:"/monitoring/qa",soon:!0}]},{key:"analysis",main:"Analysis",sub:[{label:"Site Data Analytics",link:"/analysis/sites"},{label:"Communications Analytics",link:"/analysis/communications",soon:!0},{label:"Monitoring Alerts Analytics",link:"/analysis/alerts",soon:!0}]},{key:"communication",main:"Communication",sub:[{label:"Chatterbox",link:"/communication/chatterbox"},{label:"Contacts",link:"/communication/contacts"},{label:"Mailbox",link:"/communication/mailbox"}]},{key:"community",main:"Community",sub:[{label:"Site Information",link:"/community/site_info"},{label:"Stakeholders' Concerns",link:"/community/concerns",soon:!0},{label:"Community Feedback",link:"/community/feedback",soon:!0}]},{key:"knowledge",main:"Knowledge Management",sub:[{label:"Protocols",link:"/knowlegde/protocols",soon:!0},{label:"Papers",link:"/knowledge/papers",soon:!0}]}];var Se=r.a.memo(Object(te.a)()((function(e){const t=e.width,a=e.drawerHandler,l=e.drawer,i=xe(),c=window.location.pathname.split("/")[1],m=je.findIndex(e=>e.key===c),d=Object(n.useState)(-1===m?0:m),u=Object(o.a)(d,2),p=u[0],g=u[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),h=E[0],_=E[1],O=Object(n.useState)(null),x=Object(o.a)(O,2),j=x[0],S=x[1],k=Object(n.useState)(!1),C=Object(o.a)(k,2),w=C[0],A=C[1],I=Object(n.useState)(null),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useContext)(ve).server_time,H=je[p===h&&null!==j?j:p].sub;Object(n.useEffect)(()=>{S(p)},[p]);const R=e=>{const t=p;A(!0),N(e.currentTarget),_(t)},B=e=>{M.contains(e.target)||(A(!1),setTimeout(()=>g(h),100))},Y=e=>{A(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.navBar},r.a.createElement(P.a,{position:"fixed",color:"default",className:i.appBar},r.a.createElement(y.a,{container:!0,spacing:0,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Z.a,{value:p,onChange:(e,t)=>{g(t)},indicatorColor:"primary",textColor:"primary",variant:Object(te.c)("md",t)?"standard":"scrollable",scrollButtons:"on",centered:Object(te.c)("md",t)},je.map(({main:e,key:t})=>r.a.createElement(K.a,{key:t,label:e,"aria-owns":w?"monitoring-menu":null,"aria-haspopup":"true",onClick:R})))),r.a.createElement(y.a,{item:!0,xs:2,align:"center"},r.a.createElement(v.a,{variant:"button"},T?ne()(T).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time..."))))),r.a.createElement(J.a,{className:i.popper,open:w,anchorEl:M,transition:!0,disablePortal:!0},({TransitionProps:e,placement:t})=>r.a.createElement(X.a,Object.assign({},e,{id:"monitoring-menu",style:{transformOrigin:"bottom"===t?"center top":"center bottom"}}),r.a.createElement(f.a,null,r.a.createElement($.a,{onClickAway:B},r.a.createElement(ee.a,null,H.map(({label:e,link:t,soon:a})=>{const n="undefined"!==typeof a;return n?r.a.createElement(U.a,{key:e,onClick:Y,disabled:n},e,n&&r.a.createElement(v.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")):r.a.createElement(s.b,{to:t,key:e,className:i.link},r.a.createElement(U.a,{onClick:Y},e))})))))),r.a.createElement(re.a,{drawer:l,drawerHandler:a,navigationLabels:je}))}))),ke=a(727),Ce=a(749);var we=Object(d.a)(e=>({pageTitleContainer:{margin:"24px 0 18px",[e.breakpoints.down("sm")]:{margin:"10px 0 10px"}},pageTitle:{fontSize:"0.85rem"},hasCustomButtons:{display:"flex",alignItems:"baseline",justifyContent:"space-between",paddingTop:12,paddingBottom:12}}))((function({title:e,classes:t,customButtons:a}){const n=void 0!==a&&a;let l=t.pageTitleContainer;return n&&(l+=" ".concat(t.hasCustomButtons)),r.a.createElement("div",{className:l},r.a.createElement(v.a,{variant:"overline",className:t.pageTitle},e),a)})),Ae=a(709);const Ie=e=>{e.preventDefault()};function De(e){return r.a.createElement(K.a,Object.assign({component:"a",onClick:Ie},e))}var Me=Object(d.a)(e=>({root:{flexGrow:1}}))((function(e){const t=e.chosenTab,a=e.onSelect,n=e.tabsArray,l=e.classes;return r.a.createElement(Ae.a,null,r.a.createElement(P.a,{position:"static",color:"default",className:l.root},r.a.createElement(Z.a,{variant:"fullWidth",value:t,onChange:(e,t)=>{a(t)}},n.map(e=>{const t=e.label,a=e.href;return r.a.createElement(De,{label:t,href:a,key:a})}))))})),Ne=a(473),Te=a(49),He=a(805),Re=a(724),Be=a(723),Ye=a(725),Pe=a(409),Le=a(726),Fe=a(728),ze=a(729),Ge=a(730),Ue=a(731),We=a(732),qe=a(693),Ve=a(711),Qe=a(694),Ze=a(712),Ke=a(326),Je=a(404),Xe=a(405),$e=a(803),et=a(695),tt=a(713);let at;function nt(){"undefined"!==typeof at&&null!==at||(at=be()("".concat(k,"/monitoring"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function rt(e){nt(),at.on("reconnecting",()=>{e(!0)}),at.on("reconnect",()=>{e(!1)}),at.on("reconnect_failed",()=>{console.log("failed")})}function lt(e,t=null){nt(),console.log("Payload: { key: data }",e,t);const a={data:t,key:e};at.send(a)}function it(){at.close(),at=null}function ct(e){nt(),at.on("receive_alerts_from_db",t=>{const a=JSON.parse(t);console.log("Alerts from DB: ",a),e(a)})}var ot=Object(tt.a)()(e=>{const t=e.isShowing,a=e.hide,l=e.data,c=e.isValidating,s=l.site,m=l.trigger_id,d=l.ts_updated,u=Object(n.useState)(""),g=Object(o.a)(u,2),E=g[0],h=g[1],f=Object(n.useState)(""),_=Object(o.a)(f,2),y=_[0],v=_[1],O=D();O.user_id;function x(){a(),h(""),v("")}const j=""===E;return t?i.a.createPortal(r.a.createElement(n.Fragment,null,r.a.createElement(qe.a,{open:!0,onClose:x,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Validate Trigger"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Select whether trigger is valid or invalid. Also, provide remarks."),r.a.createElement(Ke.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(Je.a,{"aria-label":"trigger_validity",name:"trig_validity_1",row:!0,style:{justifyContent:"space-around"},value:E,onChange:function(e){const t=Number.parseInt(e.target.value,10);h(t)}},r.a.createElement(Xe.a,{value:1,control:r.a.createElement($e.a,null),label:"Valid"}),!c&&r.a.createElement(Xe.a,{value:0,control:r.a.createElement($e.a,null),label:"Validating"}),r.a.createElement(Xe.a,{value:-1,control:r.a.createElement($e.a,null),label:"Invalid"}))),r.a.createElement(b.a,{autoFocus:!0,margin:"dense",id:"remarks",label:"Remarks",onChange:function(e){v(e.target.value)},value:y,fullWidth:!0})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:x,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:e=>{!function(e,t,a,n,r,l){lt("validate_trigger",{site_code:e,alert_status:n,trigger_id:t,trigger_ts:a,remarks:r,user_id:l})}(s,m,d,E,y,O.user_id),a(),h(""),v("")},color:"primary",disabled:j},"Confirm")))),document.body):null});var st=()=>{const e=Object(n.useState)(!1),t=Object(o.a)(e,2),a=t[0],r=t[1];return{isShowing:a,toggle:function(){r(!a)}}},mt=a(172),dt=a.n(mt),ut=a(447),pt=a.n(ut),gt=a(448),bt=a.n(gt);function Et(e,t=!1){const a=e.offsetHeight,n=getComputedStyle(e),r=n.marginBottom,l=n.marginTop,i=parseFloat(r)+parseFloat(l);return t?i:a+i}function ht(e){const t=e.classes;return r.a.createElement("div",{id:"letter-head",className:t.letterHeadContainer},r.a.createElement("img",{src:pt.a,alt:"PHIVOLCS Letter Head",className:t.phivolcsLetterHead}))}function ft(e){const t=e.classes;return r.a.createElement("div",{id:"letter-foot",className:"".concat(t.letterHeadContainer," ").concat(t.letterFooterContainer)},r.a.createElement("img",{src:bt.a,alt:"PHIVOLCS Letter Footer",className:t.phivolcsLetterHead}))}function _t(e){const t=e.classes,a=e.bulletinDetail,l=e.isMD,i=a.bulletin_control_code,c=a.site_address,o=a.data_ts,s=a.alert_description_group,m=a.recommended_response;return r.a.createElement(n.Fragment,null,r.a.createElement(v.a,{variant:"body2",align:"center",className:t.title},r.a.createElement("strong",null,"DYNASLOPE LANDSLIDE ALERT LEVEL INFORMATION: ",i)),r.a.createElement(v.a,{variant:"body2",component:"div",className:t.mainInfo},r.a.createElement(y.a,{container:!0,spacing:l?2:1},r.a.createElement(y.a,{item:!0,xs:4},"Location:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,c)),r.a.createElement(y.a,{item:!0,xs:4},"Date/Time:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,o)),r.a.createElement(y.a,{item:!0,xs:4},"Alert Level Released:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,s)),r.a.createElement(y.a,{item:!0,xs:4},"Recommended Response:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,m)))))}var yt=Object(te.a)()((function(e){const t=e.releaseId,a=e.width,l=(e=>Object(O.a)(t=>{let a;return a="undefined"===typeof e?{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"28px 44px",[t.breakpoints.only("md")]:{padding:"58.3324px 91.6652px"},[t.breakpoints.up("lg")]:{padding:"116.6648px 183.3304px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"33.3328px"},[t.breakpoints.up("lg")]:{marginTop:"66.6656px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{padding:"0 44px",height:629,maxHeight:629,overflowY:"hidden",[t.breakpoints.only("md")]:{padding:"0 91.6652px",height:1310.3957,maxHeight:1310.3957},[t.breakpoints.up("lg")]:{padding:"0 183.3304px",height:2620.7914,maxHeight:2620.7914}},title:{marginBottom:16,fontSize:"0.8rem",[t.breakpoints.only("md")]:{marginBottom:33.3328,fontSize:"1.6664rem"},[t.breakpoints.up("lg")]:{marginBottom:66.6656,fontSize:"3.47111rem"}},mainInfo:{border:"0.5px solid black",padding:"8px 12px",fontSize:"0.65rem",letterSpacing:0,marginBottom:12,[t.breakpoints.only("md")]:{padding:"16.6664px 24.9996px",fontSize:"1.354145rem",marginBottom:24.9996},[t.breakpoints.up("lg")]:{padding:"33.3328px 49.9992px",fontSize:"2.70829rem",marginBottom:49.9992}},sectionHeader:{fontSize:"0.7rem",[t.breakpoints.only("md")]:{fontSize:"1.45831rem"},[t.breakpoints.up("lg")]:{fontSize:"2.91662rem"}},sectionDetails:{fontSize:"0.65rem",[t.breakpoints.only("md")]:{fontSize:"1.354145rem"},[t.breakpoints.up("lg")]:{fontSize:"2.70829rem"}},indent:{marginLeft:24,[t.breakpoints.only("md")]:{marginLeft:49.9992},[t.breakpoints.up("lg")]:{marginLeft:99.9984}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}:{letterHeadContainer:{width:"inherit",height:"auto",boxSizing:"border-box",padding:"7px 11px",[t.breakpoints.only("md")]:{padding:"20px 22.9163px"},[t.breakpoints.up("lg")]:{padding:"29.1662px 45.8326px"}},letterFooterContainer:{paddingTop:0,marginTop:16,[t.breakpoints.only("md")]:{marginTop:"8.3332px"},[t.breakpoints.up("lg")]:{marginTop:"16.6664px"}},phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:{overflowY:"hidden",padding:"0 11px",height:"100%",maxHeight:"100%",[t.breakpoints.only("md")]:{padding:"0 22.9163px",height:"100%",maxHeight:"100%"},[t.breakpoints.up("lg")]:{padding:"0 45.8326px",height:"100%",maxHeight:"100%"}},title:{marginBottom:4,fontSize:"0.65625rem",[t.breakpoints.only("md")]:{marginBottom:16,fontSize:"1.45rem"},[t.breakpoints.up("lg")]:{marginBottom:33.3328,fontSize:"1.367163rem"}},mainInfo:{border:"0.5px solid black",letterSpacing:0,padding:"2px 3px",fontSize:"0.4875rem",marginBottom:3,[t.breakpoints.only("md")]:{padding:"10px 16px",fontSize:"1rem",marginBottom:12},[t.breakpoints.up("lg")]:{padding:"8.3332px 12.4998px",fontSize:"1.01560875rem",marginBottom:12.4998}},sectionHeader:{fontSize:"0.525rem",[t.breakpoints.only("md")]:{fontSize:"1.2rem"},[t.breakpoints.up("lg")]:{fontSize:"1.0937325rem"}},sectionDetails:{fontSize:"0.4875rem",[t.breakpoints.only("md")]:{fontSize:"1rem"},[t.breakpoints.up("lg")]:{fontSize:"1.01560875rem"}},indent:{marginLeft:6,[t.breakpoints.only("md")]:{marginLeft:12.4998},[t.breakpoints.up("lg")]:{marginLeft:24.9996}},divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}},a}))(t)(),i=Object(n.useState)([]),c=Object(o.a)(i,2),s=c[0],m=c[1],d=Object(n.useState)(!1),p=Object(o.a)(d,2),g=p[0],b=p[1],E=Object(n.useState)(!1),h=Object(o.a)(E,2),f=h[0],_=h[1],j=Object(n.useRef)(null),C=Object(n.useState)({site:{},alert_level:0,bulletin_control_code:"",site_address:"",alert_description_group:"",recommended_response:"",community_response:"",lewc_lgu_response:"",households_at_risk:"",has_ground_trigger:!1,ground_movement_details:"",prepared_triggers:[],no_data_triggers:[],publishers:"",next_ewi_release_ts:""}),w=Object(o.a)(C,2),A=w[0],I=w[1],D=A.alert_level,M=A.community_response,N=A.households_at_risk,T=A.lewc_lgu_response,H=A.prepared_triggers,R=A.has_ground_trigger,B=A.site.barangay,Y=A.no_data_triggers,P=A.publishers,L=A.next_ewi_release_ts,F=A.ground_movement_details,z=Object(te.c)("md",a);Object(n.useEffect)(()=>{let a=t;if("undefined"===typeof t){a=e.match.params.release_id}!function(e,t){const a="".concat(k,"/api/monitoring/create_bulletin/").concat(e);S.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}(a,e=>{const t=le(e.site,!1),a=Object(u.a)(Object(u.a)({},e),{},{site_address:t});b(!0),I(a)})},[]),Object(n.useEffect)(()=>{if(null!==j.current){const e=j.current,t=Array.from(e.children);let a=0;t.forEach((e,t)=>{if("subcontent"!==e.id)a+=Et(e);else{a+=Et(e,!0);const t=Array.from(e.children),n=[];t.forEach(e=>{const t=Et(e);a+t<1310.3957?a+=t:(a+=t,n.push(e),e.setAttribute("style","display: none"))}),m(n)}}),""!==A.site_address&&_(!0)}},[A,j]);let G=!1;return r.a.createElement(n.Fragment,null,g?r.a.createElement(n.Fragment,null,r.a.createElement("div",{id:"bulletin-root",className:l.root},r.a.createElement(ht,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:j},r.a.createElement(_t,{classes:l,bulletinDetail:A,isMD:z}),r.a.createElement(y.a,{container:!0,spacing:z?2:1,id:"subcontent"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"AREA SITUATION"),":"))),H.map((e,t,a)=>{const i=e.is_ground,c=e.trigger_source;let o="";!G&&i&&(o=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),G=!0);let s=!1;(0===t||a[t-1].trigger_source!==c)&&(s=!0);let m="";if(s){const e=c.toUpperCase();m=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:"".concat(l.sectionHeader," ").concat(i?l.indent:"")},r.a.createElement("strong",null,i?r.a.createElement("u",null,r.a.createElement("i",null,e)):e)))}let d="";return Y.includes(c)&&(!s&&i||!i)&&(d=r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:"0 !important"}},r.a.createElement(v.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},"Currently, no data available."))),r.a.createElement(n.Fragment,{key:"key-".concat(t+1)},o,m,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent),dangerouslySetInnerHTML:{__html:e.description}})),d)}),(!R||0===D)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},F))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"ELEMENTS AT RISK"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},N)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"OTHER RECOMMENDATIONS"),":"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Landslide Early Warning Committee (LEWC):")," ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:T}}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Community:")," ",M)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"NOTE:")," This bulletin contains the official Alert Level and Recommended Response of the Dynaslope Project for Brgy. ",B," and will hold true until a new bulletin is released.")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{className:l.divider})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{component:"div",variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.releaseDetailsArea)},0===D?r.a.createElement("span",null):r.a.createElement("span",null,"Next bulletin on: ",r.a.createElement("strong",null,L)),r.a.createElement("span",null,"Released by: ",r.a.createElement("strong",null,P)))))),r.a.createElement(ft,{classes:l})),s.length>0&&r.a.createElement("div",{id:"bulletin-root-2",className:l.root},r.a.createElement(ht,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:j},r.a.createElement(_t,{classes:l,bulletinDetail:A,isMD:z}),r.a.createElement(y.a,{container:!0,spacing:z?2:1,id:"excess-content"},s.map((e,t)=>r.a.createElement(y.a,{key:"key-".concat(t+1),item:!0,xs:12,dangerouslySetInnerHTML:{__html:e.innerHTML}})))),r.a.createElement(ft,{classes:l})),f&&r.a.createElement("div",{id:"is-loaded"})):r.a.createElement(y.a,{item:!0,style:{textAlign:"center"}},r.a.createElement(x.a,{size:50}),r.a.createElement(v.a,null,"Loading Bulletin")))}));var vt=Object(tt.a)()((function(e){const t=e.classes,a=e.fullScreen,l=e.isOpenBulletinModal,i=e.setIsOpenBulletinModal,s=e.releaseDetail,m=s.release_id,d=s.site_code,u=s.site_id,g=s.type,E=s.is_bulletin_sent,h=Object(n.useState)(""),f=Object(o.a)(h,2),_=f[0],v=f[1],O=Object(n.useState)([]),x=Object(o.a)(O,2),j=x[0],S=x[1],C=Object(n.useState)(""),w=Object(o.a)(C,2),A=w[0],I=w[1],M=Object(n.useState)(""),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)({}),B=Object(o.a)(R,2),Y=B[0],P=B[1],L=Object(c.b)(),F=L.enqueueSnackbar,z=L.closeSnackbar,G=D().user_id,U=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{z(e)}},"Dismiss");Object(n.useEffect)(()=>{"undefined"!==typeof m&&l&&function(e,t){ue("".concat(k,"/api/bulletin_email/get_bulletin_email_details/").concat(e),t)}(m,e=>{const t=e.subject,a=e.recipients,n=e.mail_body,r=e.file_name,l=e.narrative_details;P(l),S(a),v(t),I(n),H(r)})},[l]);const W=()=>{i(!1),P({}),S([]),v(""),I(""),H("")};let q="";return"undefined"!==typeof d&&(q=d.toUpperCase()),r.a.createElement(qe.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title",maxWidth:"md"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Early Warning Bulletin for ",q),r.a.createElement(Qe.a,null,r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Mail Content",value:A,onChange:e=>{I(e.target.value)},placeholder:"Add mail content",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(dt.a,{label:"To",value:j,onAdd:e=>(e=>{const t=j;t.push(e),S([...t])})(e),onDelete:(e,t)=>((e,t)=>{j.splice(j.indexOf(e),1),S([...j])})(e),fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(yt,{releaseId:m})))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:(V=m,()=>{!function(e,t){ue("".concat(k,"/api/bulletin/download_bulletin/").concat(e),t)}(V,e=>{console.log("LOG bulletin_download",e)})}),color:"primary"},"Download"),r.a.createElement(p.a,{color:"secondary",onClick:()=>{const e={subject:_,recipients:j,mail_body:A,release_id:m,file_name:T,alert_db_group:g,site_id:u,sender_id:G,narrative_details:Y},t=F("Sending EWI bulletin...",{variant:"warning",persist:!0});W(),function(e,t,a){de("".concat(k,"/api/mailbox/send_bulletin_email"),e,t,a)}(e,e=>{console.log("Sent bulletin email...",e);const a=e.status,n=e.message;let r;z(t),r=a?"success":"error",F(n,{variant:r,autoHideDuration:7e3,action:U})},()=>{z(t),F("Send bulletin failed. Ask the devs.",{variant:"error",autoHideDuration:7e3,action:U})})},disabled:!1},E?"Sent already (Send again?)":"Send"),r.a.createElement(p.a,{onClick:W,color:"primary"},"Cancel")));var V}));var Ot=a(722),xt=a(721),jt=a(717),St=a(718),kt=a(437),Ct=a(40),wt=a(37),At=a(716),It=a(269);function Dt(e,t,a){const n="".concat(k,"/api/chatterbox/send_message");S.a.post(n,e).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e),a(e)})}var Mt=a(467),Nt=a(472);const Tt=Object(n.forwardRef)((e,t)=>r.a.createElement(Mt.a,Object.assign({direction:"up"},e,{ref:t}))),Ht=Object(n.forwardRef)((e,t)=>r.a.createElement(Nt.a,Object.assign({},e,{ref:t})));var Rt=a(169),Bt=a(466),Yt=a(439),Pt=a(451),Lt=a.n(Pt),Ft=a(333);function zt(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(v.a,Object.assign({color:"textSecondary",className:t.classes.noOptionsMessage},a),n)}function Gt(e){let t=e.inputRef,a=Object(Rt.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}function Ut(e){const t=e.selectProps,a=e.innerRef,n=e.children,l=e.innerProps;return r.a.createElement(b.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:Gt,inputProps:Object(u.a)({className:t.classes.input,inputRef:a,children:n},l)}},t.textFieldProps))}function Wt(e){const t=e.innerRef,a=e.isFocused,n=e.isSelected,l=e.innerProps,i=e.children,c=e.data.color;return r.a.createElement(U.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400,color:c}},l),i)}function qt(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(v.a,Object.assign({color:"textSecondary",className:t.classes.placeholder},a),n)}function Vt(e){const t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)}function Qt(e){const t=e.children,a=e.selectProps,n=e.isFocused,l=e.data,i=e.removeProps,c=l.chipLabel,o="undefined"!==typeof c?c:t;return r.a.createElement(Yt.a,{tabIndex:-1,label:o,className:"".concat(a.classes.chip," ").concat({[a.classes.chipFocused]:n}),onDelete:i.onClick,deleteIcon:r.a.createElement(Lt.a,i)})}function Zt(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(f.a,Object.assign({square:!0,className:t.classes.paper},a),n)}var Kt=Object(d.a)(e=>({root:{flexGrow:1},input:{display:"flex",padding:0,height:"auto"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object(Ft.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:2,marginTop:e.spacing(1),left:0,right:0},divider:{height:e.spacing(2)}}),{withTheme:!0})((function(e){const t=e.classes,a=e.changeHandler,n=e.options,l=e.value,i=e.label,c=e.placeholder,o=e.renderDropdownIndicator,s=e.openMenuOnClick,m=e.isMulti,d=e.isDisabled,p=e.isClearable,g=e.hasAlternativeChipLabel,b={input:e=>Object(u.a)(Object(u.a)({},e),{},{color:"blue","& input":{font:"inherit"}})},E={Control:Ut,Menu:Zt,MultiValue:Qt,NoOptionsMessage:zt,Option:Wt,Placeholder:qt,ValueContainer:Vt},h=void 0===s||s,f=void 0!==m&&m,_=void 0!==d&&d,y=void 0!==p&&p;return!1===(void 0===o||o)&&(E.DropdownIndicator=()=>null,E.IndicatorSeparator=()=>null),r.a.createElement("div",{className:t.root},r.a.createElement(Ae.a,null,r.a.createElement(Bt.a,{classes:t,styles:b,textFieldProps:{label:i,InputLabelProps:{shrink:!0}},options:n,components:E,value:l,onChange:a,placeholder:c,isMulti:f,openMenuOnFocus:!1,openMenuOnClick:h,isDisabled:_,isClearable:y,hasAlternativeChipLabel:g})))}));function Jt(e,t,a){return e.map(e=>{const n=e.site_code,r=e.site_id;let l=n.toUpperCase();t&&(l=le(e,!0,"start"));let i="black";if("undefined"!==typeof a&&null!==a){const e=a.latest,t=a.extended,r=[...e,...a.overdue],l=n.toLowerCase();r.find(e=>e.event.site.site_code===l)&&(i="red"),t.find(e=>e.event.site.site_code===l)&&(i="green")}return{value:r,label:l,data:e,color:i}})}var Xt=function(e){const t=e.value,a=e.changeHandler,l=e.isMulti,i=e.renderDropdownIndicator,c=e.includeAddressOnOptions,o=e.returnSiteDataCallback,s=e.isFromSiteLogs,m=Object(n.useContext)(ve).sites,d=Jt(m,"undefined"===typeof c||c,s),u="undefined"!==typeof l&&l,p=u?"Select site(s)":"Select site",g="undefined"!==typeof i&&i;let b=t;if(""!==t&&null!==t){const e=t.label,a=t.value;if("undefined"!==typeof o&&o){const e=m.find(e=>e.site_id===a);"undefined"!==typeof e&&o(e)}"undefined"!==typeof e||u||(b=d[a-1])}return r.a.createElement(Kt,{label:l?"Site(s)":"Site",options:d,value:b,changeHandler:a,placeholder:p,renderDropdownIndicator:g,openMenuOnClick:!0,isMulti:u})};var $t=Object(It.a)(Object(d.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}})),Object(tt.a)())((function(e){const t=e.classes,a=e.fullScreen,l=e.isOpen,i=e.clickHandler,s=e.setComposedMessage,m=Object(n.useState)(ne()().format("YYYY-MM-DD HH:mm:ss")),d=Object(o.a)(m,2),u=d[0],g=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),h=E[0],f=E[1],_=Object(n.useState)(!0),v=Object(o.a)(_,2),O=v[0],x=v[1],j=Object(c.b)(),C=j.enqueueSnackbar,w=j.closeSnackbar,A=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{w(e)}},"Dismiss"),I=()=>{const e=function(e){const t=[];return e.forEach((e,a)=>{const n=e.data,r=n.site_code,l=n.barangay,i=n.municipality,c=n.province,o="Brgy. ".concat(l,", ").concat(i,", ").concat(c);t.push({site_code:r,site_info:o})}),t}(h),t=O,a=ne()(u).format("LLL");!function(e,t){const a="".concat(k,"/api/rainfall/get_all_site_rainfall_data");S.a.post(a,e).then(e=>{const a=e.data;console.log("Get rain information data reponse",a),t(a)}).catch(e=>{console.error(e)})}({is_express:t,site_details:e,date_time:u,as_of:a},e=>{const t=e.status,a=e.message,n=e.ewi;s(n),!0===t?(i(),C(a,{variant:"success",autoHideDuration:3e3,action:A})):C(a,{variant:"error",autoHideDuration:3e3,action:A})})};return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title",TransitionComponent:a?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Load Templates"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Select template to be loaded."),r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Xt,{value:h,changeHandler:e=>{f(e)},isMulti:!0})),r.a.createElement(y.a,{item:!0,xs:6,className:t.inputGridContainer},r.a.createElement(Pe.a,{title:"Example tooltip",placement:"top",interactive:!0},r.a.createElement(Ke.a,null,r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:O,onChange:e=>x(e.target.checked),value:"checkedB",color:"primary"}),label:"Express data in percentage"})))),r.a.createElement(y.a,{item:!0,xs:6,className:t.inputGridContainer},r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Data timestamp",value:u,onChange:e=>g(ne()(e).format("YYYY-MM-DD HH:mm:ss")),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0}))))),r.a.createElement(et.a,null,r.a.createElement(p.a,{color:"primary",onClick:()=>I()},"Select"),r.a.createElement(p.a,{onClick:i},"Cancel")))}));const ea=Object(O.a)(e=>({container:{display:"flex",alignItems:"center",paddingTop:16},textBox:{width:"100%",flexGrow:2,margin:0},iconArea:{textAlign:"right",flexShrink:2}}));var ta=function(e){const t=e.limitRows,a=e.value,l=e.disableSend,i=e.messageChangeHandler,c=e.sendButtonClickHandler,s=e.setComposedMessage,m=e.disableTemplateLoader,d=ea(),u=void 0===t||t,p=Object(n.useState)(!1),g=Object(o.a)(p,2),E=g[0],h=g[1],f=e=>()=>h(e);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.container},r.a.createElement(b.a,{id:"message_textbox",label:"Message",multiline:!0,rows:"4",rowsMax:u?4:10,fullWidth:!0,className:d.textBox,margin:"dense",variant:"filled",value:a,onChange:i}),r.a.createElement("div",{className:d.iconArea},r.a.createElement(z.a,{color:"primary","aria-label":"Send message",onClick:c,disabled:l},r.a.createElement(jt.a,null)),!m&&r.a.createElement(z.a,{color:"primary","aria-label":"More options",onClick:f(!0)},r.a.createElement(St.a,null)))),r.a.createElement($t,{isOpen:E,setComposedMessage:s,clickHandler:f(!1)}))},aa=a(682),na=a(332),ra=a(719),la=a(720);var ia=Object(d.a)(e=>({checkboxes:{paddingTop:4,paddingBottom:4}}))((function(e){const t=e.classes,a=(e.label,e.changeHandler),l=e.choices,i=e.checkboxStyle;return r.a.createElement(n.Fragment,null,l.map(({state:e,value:n,label:l,is_disabled:c},o)=>r.a.createElement(Xe.a,{key:o,control:r.a.createElement(kt.a,{checked:e,onChange:a(n),value:n,disabled:"undefined"!==typeof c&&c,className:t.checkboxes}),label:l,className:i})))}));const ca=Object(O.a)(e=>({formControl:{width:"-webkit-fill-available",marginTop:8,"&:first-child":{marginTop:12}},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxSites:{flex:"1 1 25%",[e.breakpoints.down("xs")]:{"&:last-child":{flexBasis:"58.5%"}},[e.breakpoints.up("sm")]:{flexBasis:"17%"},[e.breakpoints.up("md")]:{flexBasis:"9%"}},checkboxOrganizations:{flex:"1 1 45%",[e.breakpoints.up("sm")]:{flexBasis:"17%","&:last-child":{flexBasis:"77%"}},[e.breakpoints.up("md")]:{flexBasis:"9%","&:last-child":{flexBasis:"45%"}}},checkboxGroup:{flexDirection:"row",paddingTop:6},buttons:{[e.breakpoints.down("xs")]:{padding:"12px 6px"}}}));var oa=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setRecipients,c=ca(),s=Object(n.useContext)(ve),m=s.sites,d=s.organizations,g=m.map(e=>({label:e.site_code.toUpperCase(),value:e.site_id,state:!1})),b=d.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{label:t+e.name.toUpperCase(),value:e.org_id,state:!1}}),E=Object(n.useState)(!1),h=Object(o.a)(E,2),f=h[0],_=h[1],y=Object(n.useState)(g),v=Object(o.a)(y,2),O=v[0],x=v[1],j=Object(n.useState)(b),C=Object(o.a)(j,2),w=C[0],A=C[1],I={handleCheckAll:(e,t)=>()=>{let a,n;"sites"===e?(a=O,n=x):"organizations"===e&&(a=w,n=A);n([...a.map(e=>Object(u.a)(Object(u.a)({},e),{},{state:t}))])},handleChange:e=>t=>a=>{const n=a.target.checked;if("only_ewi_recipient"===e)_(n);else{let a,r;"sites"===e?(a=O,r=x):"organizations"===e&&(a=w,r=A);const l=a.findIndex(e=>e.value===t);a[l].state=n,r([...a])}}};return r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht,maxWidth:"md"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Select recipients"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Choose your preferred sites and offices as message recipients."),r.a.createElement(Ke.a,{className:c.formControl},r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:f,onChange:e=>_(e.target.checked),value:"only_ewi_recipients",className:c.checkboxes}),label:"Only EWI Recipients"})),[{state_list:w,group:"Organizations",list:d},{state_list:O,group:"Sites",list:m}].map(e=>function(e,t,a){const n=t.state_list,l=t.group,i=t.list,c=a.handleCheckAll,o=a.handleChange,s=l.toLowerCase();return r.a.createElement(Ke.a,{component:"fieldset",className:e.formControl,key:l},r.a.createElement(aa.a,{component:"legend",className:e.formLabel},r.a.createElement("span",null,l),r.a.createElement("span",null,[{label:"Check all",component:r.a.createElement(ra.a,null),bool:!0},{label:"Uncheck all",component:r.a.createElement(la.a,null),bool:!1}].map(t=>r.a.createElement(z.a,{"aria-label":t.label,color:"primary",className:e.buttons,onClick:c(s,t.bool),key:t.label},t.component)))),r.a.createElement(na.a,{className:e.checkboxGroup},r.a.createElement(ia,{choices:i.map(e=>function(e,t,a){let n;"Sites"===t?n="site_id":"Organizations"===t&&(n="org_id");return a.filter(t=>t.value===e[n]).pop()}(e,l,n)),changeHandler:o(s),checkboxStyle:e["checkbox".concat(l)]})))}(c,e,I))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:()=>{const e=[],t=[];O.forEach(t=>{t.state&&e.push(t.value)}),w.forEach(e=>{e.state&&t.push(e.value)});!function(e,t){const a="".concat(k,"/api/contacts/get_recipients_option");S.a.post(a,e).then(e=>{const a=e.data;console.log("Selected recipients",a),t(a)}).catch(e=>{console.error(e)})}({site_ids:e,org_ids:t,only_ewi_recipients:f},e=>{const t=e.map(e=>{const t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num;let l=t;""!==n&&(l="".concat(t," (").concat(n,")")),l+=" - ".concat(r);return{label:l,chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}});i(t)}),l()},color:"primary"},"Select"),r.a.createElement(p.a,{onClick:l},"Cancel"))))}));var sa=function(e){const t=e.isMobile,a=e.textboxValue,l=e.disableQuickSelect,i=e.releaseId,s=e.siteCode,m=e.fromEWIModal,d=e.modalStateHandler,g=e.updateSentStatusObj,b=e.recipientsList,E=Object(c.b)(),h=E.enqueueSnackbar,f=E.closeSnackbar,_=D(),v=Object(n.useState)([]),O=Object(o.a)(v,2),j=O[0],C=O[1],w=Object(n.useState)([]),A=Object(o.a)(w,2),I=A[0],M=A[1],N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1],B=Object(n.useState)(a),Y=Object(o.a)(B,2),P=Y[0],L=Y[1],F="undefined"!==typeof l&&l,G="undefined"!==typeof m&&m,U=Object(n.useState)(!1),W=Object(o.a)(U,2),q=W[0],V=W[1];Object(n.useEffect)(()=>{"undefined"!==typeof s&&(V(!0),function(e,t){const a="".concat(k,"/api/contacts/get_contacts_per_site/").concat(e);S.a.get(a).then(e=>{const a=e.data;console.log(e),console.log(a),t(a)}).catch(e=>{console.error(e)})}(s,e=>{const t=[],a=[],n=g.type,r=g.public_alert_symbol.alert_level;e.forEach(e=>{if(e.mobile_numbers.length>0){const l=e.user_id,i=e.last_name,c=e.first_name,o=e.organizations,s=e.ewi_recipient,m=e.ewi_restriction,d=o[0].organization,u=d.name,p=d.scope;let g=u.toUpperCase();if("lgu"===u){let e;1===p&&(e="B"),2===p&&(e="M"),3===p&&(e="P"),g=e+g}const b={label:"".concat(i,", ").concat(c," (").concat(g,")"),value:l,data:e};if(t.push(b),1===s){let e=!0;"extended"===n?(e=!1,("lewc"===u||p<3&&"lgu"===u)&&(e=!0)):null!==m&&0!==r&&r<m.alert_level&&(e=!1),e&&a.push(b)}}}),M(t),C(a),V(!1)}))},[s]),Object(n.useEffect)(()=>{if("undefined"!==typeof b){V(!0);const e=b.map(e=>{const t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num;let l=t;""!==n&&(l="".concat(t," (").concat(n,")")),l+=" - ".concat(r);return{label:l,chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}});M(e),C([]),V(!1)}},[b]);const Q=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{f(e)}},"Dismiss"),Z=null===j||0===j.length,K=""===P||"undefined"===typeof P;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},q&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(x.a,{size:20})),r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(Kt,{label:"Recipients",options:I,value:j,changeHandler:e=>C(e),placeholder:"Select recipients",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0})),!F&&r.a.createElement(y.a,{item:!0,style:{textAlign:"right"}},r.a.createElement(z.a,{"aria-label":"Quick select option",onClick:e=>R(!0)},r.a.createElement(xt.a,null)))),r.a.createElement(oa,{isOpen:H,closeHandler:e=>R(!1),setRecipients:C}),!t&&r.a.createElement("div",{style:{height:80}}),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(ta,{limitRows:!1,value:P,disableSend:Z||K,sendButtonClickHandler:()=>{const e=[];G?j.forEach(t=>{const a=t.data;a.mobile_numbers.forEach(t=>e.push({mobile_id:t.mobile_number.mobile_id,gsm_id:t.mobile_number.gsm_id,data:a}))}):j.forEach(({data:{mobile_id:t,gsm_id:a}})=>{e.push({mobile_id:t,gsm_id:a})});let t={sms_msg:"".concat(P," - ").concat(_.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:e,is_ewi:G};if(G){const e=g.site_id,a=g.type;t=Object(u.a)(Object(u.a)({},t),{},{release_id:i,user_id:_.user_id,site_id:e,alert_db_group:a})}const a=h("Sending EWI message...",{variant:"warning",persist:!0});d(),Dt(t,e=>{f(a);let t,n=e.message;e.status?(t="success",n="EWI SMS sent!"):t="error",h(n,{variant:t,autoHideDuration:7e3,action:Q})},()=>{h("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:Q})})},messageChangeHandler:e=>L(e.target.value),setComposedMessage:L,disableTemplateLoader:G})))};var ma=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.textboxValue,i=e.releaseDetail,c=i.release_id,o=i.site_code;return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Early Warning Information"),r.a.createElement(z.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Qe.a,{style:{overflowY:"auto"}},r.a.createElement(Ze.a,null,"Early warning information recipients for this site is already pre-loaded. Add additional site-related contacts if necessary. Use Chatterbox for non-site-related contacts."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(sa,{isMobile:t,textboxValue:l,disableQuickSelect:!0,releaseId:c,siteCode:o,fromEWIModal:!0,updateSentStatusObj:i,modalStateHandler:a}))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))}));function da(e){const t=e.is_loading_recipients,a=e.textboxValue,l=e.sendHandler;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},t&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(x.a,{size:20}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(ta,{limitRows:!1,value:a,disableSend:!1,sendButtonClickHandler:l,messageChangeHandler:()=>console.log("tried msg change")})))}var ua=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.textboxValue,i=e.siteList,o=Object(c.b)(),s=o.enqueueSnackbar,m=o.closeSnackbar,d=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{m(e)}},"Dismiss");return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Routine Early Warning Information"),r.a.createElement(z.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Qe.a,{style:{overflowY:"hidden"}},r.a.createElement(Ze.a,null,"Early warning information recipients for this site is already pre-loaded. Recipients are LEWC, Barangay, and Municipal LGUs per site. If you need to add a new recipient, add a new community contact via chatterbox."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(da,{isMobile:t,textboxValue:l,disableQuickSelect:!0,sendHandler:()=>{const e=D(),t=e.user_id,n=e.nickname,r={site_list:i,user_id:t,nickname:n};a(),function(e,t,a){const n="".concat(k,"/api/chatterbox/send_routine_ewi_sms");S.a.post(n,e).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e),a(e)})}(r,e=>{if(console.log(e),e.status)s("Routine EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:d});else{const t=e.site_ids.map(e=>e.toUpperCase());s("Some problems occurred sending EWI SMS to ".concat(t.join(", ")),{variant:"error",persist:!0,action:d})}},e=>{console.log("error_response",e),s("Error sending routine EWI SMS...",{variant:"error",autoHideDuration:7e3,action:d})})},fromEWIModal:!0,updateSentStatusObj:"",modalStateHandler:a}))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))})),pa=a(327),ga=a(336);var ba=Object(d.a)(e=>({formControl:{minWidth:120}}))((function(e){const t=e.classes,a=e.list,l=e.mapping,i=e.label,c=e.div_id,o=e.changeHandler,s=e.value,m=e.css,d=e.error,u=e.required,p=e.disabled,g="undefined"!==typeof u&&u,b="undefined"!==typeof d&&d;return r.a.createElement(n.Fragment,null,r.a.createElement(Ke.a,{required:g,error:b,className:"".concat(t.formControl," ").concat(m),fullWidth:!0},r.a.createElement(pa.a,{htmlFor:c},i),r.a.createElement(ga.a,{value:s,onChange:o,name:c,inputProps:{id:c},disabled:p},r.a.createElement(U.a,{value:""},r.a.createElement("em",null,"---")),a.map((e,t)=>r.a.createElement(U.a,{value:e[l.id],key:t},e[l.label])))))})),Ea=a(335);class ha extends n.Component{constructor(...e){super(...e),this.state={labelWidth:0}}componentDidMount(){this.setState({labelWidth:i.a.findDOMNode(this.InputLabelRef).offsetWidth})}render(){const e=this.props,t=e.classes,a=e.list,n=e.mapping,l=e.label,i=e.div_id,c=e.changeHandler,o=e.value,s=e.css,m=this.state.labelWidth;return r.a.createElement(Ke.a,{required:!0,variant:"outlined",className:"".concat(t.formControl," ").concat(s)},r.a.createElement(pa.a,{ref:e=>{this.InputLabelRef=e},htmlFor:i},l),r.a.createElement(ga.a,{value:o,onChange:c,name:i,input:r.a.createElement(Ea.a,{labelWidth:m,id:i}),fullWidth:!0},r.a.createElement(U.a,{value:""},r.a.createElement("em",null,"---")),a.map((e,t)=>r.a.createElement(U.a,{value:e[n.id],key:t},e[n.label]))))}}var fa=Object(d.a)(e=>({formControl:{minWidth:120}}))(ha);const _a={id:"user_id",label:"name"};function ya(e){return e.map(({user_id:e,first_name:t,last_name:a})=>({user_id:e,name:"".concat(a,", ").concat(t)}))}var va=function(e){const t=e.variant,a=e.label,l=e.div_id,i=e.changeHandler,c=e.value,s=e.css,m=e.disabled,d=e.returnFullNameCallback,u=e.isCommunityStaff,p=Object(n.useState)([]),g=Object(o.a)(p,2),b=g[0],E=g[1],h=Object(n.useContext)(ve).users;if(Object(n.useEffect)(()=>{const t=S.a.CancelToken.source();if(u){const a=e.site_code,n="".concat(k,"/api/users/get_community_users_by_site/").concat(a);S.a.get(n,{cancelToken:t.token}).then(e=>{const t=ya(e.data);E(t)}).catch(e=>{console.log(e)})}else{const e=ya(h);E(e)}return()=>{t.cancel()}},[h]),"undefined"!==typeof d&&d){const e=b.find(e=>e.user_id===c);"undefined"!==typeof e&&d(e.name)}return r.a.createElement(n.Fragment,null,"standard"===t&&r.a.createElement(ba,{label:a,div_id:l,changeHandler:i,value:0===b.length?"":c,list:b,mapping:_a,css:s,disabled:m}),"outlined"===t&&r.a.createElement(fa,{label:a,div_id:l,changeHandler:i,value:0===b.length?"":c,list:b,mapping:_a,css:s}))};const Oa=Object(n.createContext)(),xa=({children:e})=>{const t=Object(n.useState)(""),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Object(n.useState)("---"),s=Object(o.a)(c,2),m=s[0],d=s[1];return r.a.createElement(Oa.Provider,{value:{reporter_id_ct:l,setReporterIdCt:i,ct_full_name:m,setCTFullName:d}},e)},ja=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{root:{width:"100%"},sectionHead:Object(u.a)(Object(u.a)({},t.sectionHead),{},{marginBottom:24}),expansionPanelSummaryContent:{justifyContent:"space-between"},invalidCandidate:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)"},validCandidate:{background:"linear-gradient(315deg, #00b712 0%, #5aff15 74%)"},partialInvalidCandidate:{background:"linear-gradient(315deg, #bbf0f3 0%, #f6d285 74%)"},inputWidth:{width:"50%"}})});function Sa(e){return ne()(e).format("DD MMMM YYYY, HH:mm")}const ka=()=>r.a.createElement(Te.a,{height:60,width:700,speed:.5,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}));function Ca(e){const t=e.alertData,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.index,o=e.releaseFormOpenHandler,s=e.isShowingValidation,m=e.toggleValidation,d=e.validationDetails;let u="",g="",b="",E=[],h=!1;const f=t.general_status,_=t.is_release_time,O=t.unresolved_moms_list,x=t.validity_status;let j="valid";if("undefined"!==typeof x&&(j=x),"routine"===f){const e=t.data_ts,a=t.public_alert_symbol;u="ROUTINE RELEASE",g=Sa(e),b=a}else{const e=t.site_code,a=t.release_details,n=t.internal_alert_level,r=t.trigger_list_arr,l=a.data_ts;u=e,g=Sa(l),b=n,E="undefined"===typeof r?[]:r,h="No new triggers"!==E&&E.length>0}u=u.toUpperCase();const S=f.toUpperCase();let k=a.alert0;return"invalid"===j?k=a.alert3:"partially valid"===j&&(k=a.alert2),r.a.createElement(He.a,{key:"panel-".concat(c+1),expanded:l==="panel".concat(c),onChange:i("panel".concat(c))},r.a.createElement(Be.a,{"aria-controls":"panel".concat(c,"bh-content"),id:"panel".concat(c,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:k}},[u,g,j.toUpperCase(),S].map((e,t)=>r.a.createElement(v.a,{key:"candidate-column-".concat(t+1),color:"textSecondary",variant:"body2"},e))),r.a.createElement(Ne.a,{style:{marginBottom:12}}),r.a.createElement(Re.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},g)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Internal Alert:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},b))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"TRIGGERS")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},h?E.map((e,t)=>{const a=e.ts_updated,l=e.alert,i=(e.tech_info,e.trigger_id),c=e.trigger_type,o=Sa(a);let g="Valid",b=!1,h=!1;try{const t=e.validating_status;0===t?(g="Validating",h=!0,b=!0):null===t?(g="---",b=!0):1===t&&(b=!1)}catch(_){}try{e.invalid&&(g="Invalid")}catch(_){}const f=["surficial","rainfall","subsurface"].includes(c)&&b;return r.a.createElement(n.Fragment,{key:"trigger-".concat(c,"-").concat(l)},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Trigger"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},l)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:!0,align:f?"flex-start":"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Status:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},g)),f&&r.a.createElement(y.a,{item:!0,xs:!0,justify:"flex-end",container:!0},r.a.createElement(p.a,{onClick:m(!0,{site:u,trigger_id:i,ts_updated:a}),variant:"contained",color:"secondary",size:"small","aria-label":"Validate trigger"},"Validate")),r.a.createElement(ot,{isShowing:s,data:d,hide:m(!1,{}),isValidating:h}),E.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)))}):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"No new triggers"))))),"undefined"!==typeof O&&O.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"UNRESOLVED MOMS LIST")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},O.map((e,t)=>{const a=e.moms_instance,l=e.observance_ts,i=e.op_trigger,c=a.feature.feature_type,o=a.feature_name,s="".concat(ie(c)," ").concat(o.toUpperCase()),m=Sa(l);return r.a.createElement(n.Fragment,{key:e.moms_id},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Feature"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Last Report"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Alert Level"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},i)),O.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)))})))))),r.a.createElement(Ne.a,null),r.a.createElement(Ye.a,null,r.a.createElement(p.a,{color:"secondary",size:"small","aria-label":"Release candidate alert",startIcon:r.a.createElement(Le.a,null),onClick:o(t,f),disabled:!_},"Release")))}function wa(e){const t=e.siteAlert,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.smsHandler,o=e.bulletinHandler,s=e.keyName,m=e.type,d=e.history,u=t.event,g=t.internal_alert_level,b=t.releases,E=t.day,h=t.sent_statuses,f=t.public_alert_symbol,_=t.is_onset_release,O=t.prescribed_release_time,x=t.has_alert_release_today,j=f.alert_level,S=Object(n.useContext)(ve).server_time,k=h.is_sms_sent,C=h.is_bulletin_sent,w=u.validity,A=u.site,I=u.event_start,D=u.event_id,M=A.site_code,N=A.site_id,T=M.toUpperCase(),H=Sa(I),R=Sa(w),B=b[0],Y=B.release_id,P=B.data_ts,L=B.release_time;let F=P;_||(F=ne()(P).add(30,"minutes")),F=Sa(F);const z=[T,g];if("extended"===m){let e="";x||(e=r.a.createElement(Pe.a,{arrow:!0,title:"No alert release for today yet!"},r.a.createElement(ke.a,{fontSize:"small",style:{marginLeft:8},className:a.dyna_error})));const t=r.a.createElement("span",{style:{display:"flex",alignItems:"center"}},"Day ",E,e);z.push(t)}else z.push(F,L);let G=k?r.a.createElement(Fe.a,null):"",U=C?r.a.createElement(Fe.a,null):"";const W=null!==S&&ne()(S).isBefore(O)&&!_;W&&(G=r.a.createElement(ze.a,null),U=r.a.createElement(ze.a,null));const q=e=>W?"Wait for EWI sending time":h["is_".concat(e.toLowerCase(),"_sent")]?"EWI ".concat(e," sent!"):"Send EWI ".concat(e);return r.a.createElement(He.a,{expanded:l===s,onChange:i(s)},r.a.createElement(Be.a,{"aria-controls":"".concat(s,"bh-content"),id:"".concat(s,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:a["alert".concat(j)]}},z.map((e,t)=>r.a.createElement(v.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e))),r.a.createElement(Ne.a,{style:{marginBottom:12}}),r.a.createElement(Re.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Start:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},H)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Validity:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},R))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"LATEST RELEASE")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},[["Internal Alert",g],["Data Timestamp",Sa(P)],["Release Time",L]].map((e,t)=>r.a.createElement(y.a,{key:e[0],item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},e[0]),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},e[1])))))),r.a.createElement(Ne.a,null),r.a.createElement(Ye.a,null,r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ge.a,null),onClick:()=>d.push("/monitoring/events/".concat(D)),align:"left"},"Timeline"),r.a.createElement(Pe.a,{arrow:!0,title:q("SMS")},r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ue.a,null),onClick:c({release_id:Y,site_code:M,site_id:N,type:m,public_alert_symbol:f}),endIcon:G,className:W&&a.dyna_error},"EWI SMS")),r.a.createElement(Pe.a,{arrow:!0,title:q("Bulletin")},r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(We.a,null),onClick:o({release_id:Y,site_code:M,site_id:N,type:m,is_bulletin_sent:C}),endIcon:U,className:W&&a.dyna_error},"Bulletin"))))}function Aa(e){const t=e.siteAlert,a=e.classes,n=e.expanded,l=e.handleExpansion,i=e.smsHandler,c=e.keyName,o=t.released_sites;let s=o[0].data_ts;return s=Sa(s),r.a.createElement(He.a,{expanded:n===c,onChange:l(c)},r.a.createElement(Be.a,{"aria-controls":"".concat(c,"bh-content"),id:"".concat(c,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:a.alert0}},["ROUTINE",s].map((e,t)=>r.a.createElement(v.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e))),r.a.createElement(Ne.a,{style:{marginBottom:12}}),r.a.createElement(Re.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(v.a,{component:"span",variant:"body1",color:"textPrimary"},s))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",color:"textPrimary"},"ROUTINE SITES")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},o.map((e,t)=>r.a.createElement(y.a,{key:"site-".concat(e.site_code),item:!0,xs:2,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},e.site_code.toUpperCase())))))),r.a.createElement(Ne.a,null),r.a.createElement(Ye.a,null,r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ue.a,null),onClick:i(o)},"EWI SMS")))}var Ia=function(e){const t=e.candidateAlertsData,a=e.alertsFromDbData,l=e.releaseFormOpenHandler,i=e.history,c=ja(),s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],u=m[1],p=Object(n.useState)(!1),g=Object(o.a)(p,2),b=g[0],E=g[1],h=Object(n.useState)({}),f=Object(o.a)(h,2),_=f[0],O=f[1],x=st(),j=x.isShowing,C=x.toggle,w=st(),A=w.isShowing,I=w.toggle,D=Object(n.useState)({}),M=Object(o.a)(D,2),N=M[0],T=M[1],H=Object(n.useState)(!1),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=r.a.useContext(Oa),L=P.reporter_id_ct,F=P.setReporterIdCt,z=P.setCTFullName,G=Object(n.useState)({}),U=Object(o.a)(G,2),W=U[0],q=U[1],V=e=>(t,a)=>{u(!!a&&e)},Q=Object(n.useState)(""),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=e=>t=>{T(e);!function(e,t){const a="".concat(k,"/api/chatterbox/get_ewi_message/").concat(e);S.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(e.release_id,e=>{J(e),C()})},$=(e,t)=>()=>{O(t),E(e)},ee=e=>t=>{T(e),Y(!0)};let te=[],ae=[],ne=[],re=[];if(null!==a){te=a.latest,ae=a.extended,ne=a.overdue,re=a.routine}return r.a.createElement("div",{className:c.root},r.a.createElement(y.a,{container:!0,className:c.sectionHeadContainer},r.a.createElement(y.a,{item:!0,xs:12,align:"right",style:{marginBottom:22}},r.a.createElement(va,{variant:"standard",label:"Monitoring Partner",div_id:"reporter_id_ct",changeHandler:e=>F(e.target.value),value:L,css:c.inputWidth,returnFullNameCallback:e=>z(e)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{className:c.sectionHead,variant:"h5"},"Candidate Alerts")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===t?r.a.createElement(ka,null):0!==t.length?t.map((e,t)=>r.a.createElement(Ca,{key:"exp-".concat(t+1),classes:c,alertData:e,expanded:d,handleExpansion:V,releaseFormOpenHandler:l,index:t,isShowingValidation:b,toggleValidation:$,validationDetails:_})):r.a.createElement(v.a,{variant:"body1",align:"center"},"No candidate alerts")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{className:c.sectionHead,variant:"h5"},"Event Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(ka,null):te.length>0?te.map((e,t)=>r.a.createElement(wa,{key:"latest-".concat(t+1),keyName:"latest-".concat(t+1),classes:c,siteAlert:e,expanded:d,handleExpansion:V,smsHandler:X,bulletinHandler:ee,type:"latest",history:i})):r.a.createElement(v.a,{variant:"body1",align:"center"},"No active alerts on database")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{className:c.sectionHead,variant:"h5"},"Extended Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(ka,null):ae.length>0?ae.map((e,t)=>r.a.createElement(wa,{key:"db-alert-".concat(t+1),keyName:"db-alert-".concat(t+1),classes:c,siteAlert:e,expanded:d,handleExpansion:V,smsHandler:X,index:t,bulletinHandler:ee,type:"extended",history:i})):r.a.createElement(v.a,{variant:"body1",align:"center"},"No sites under extended monitoring")),null===a?r.a.createElement(ka,null):"undefined"!==typeof re.released_sites&&re.released_sites.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{className:c.sectionHead,variant:"h5"},"Routine Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},r.a.createElement(Aa,{key:"routine-alert-panel",keyName:"routine-alert-panel",classes:c,siteAlert:re,expanded:d,handleExpansion:V,smsHandler:e=>()=>{!function(e,t){const a="".concat(k,"/api/chatterbox/get_routine_ewi_template");S.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(0,t=>{q(e),J(t),I()})},index:0,bulletinHandler:ee,type:"routine",history:i}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{className:c.sectionHead,variant:"h5"},"Overdue Event Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(ka,null):ne.length>0?ne.map((e,t)=>r.a.createElement(wa,{key:"overdue-alert-".concat(t+1),keyName:"overdue-alert-".concat(t+1),classes:c,siteAlert:e,expanded:d,handleExpansion:V,smsHandler:X,index:t,bulletinHandler:ee,type:"overdue",history:i})):r.a.createElement(v.a,{variant:"body1",align:"center"},"No sites under overdue alerts")),r.a.createElement(vt,{classes:c,isOpenBulletinModal:B,setIsOpenBulletinModal:Y,releaseDetail:N})),r.a.createElement(ma,{modalStateHandler:C,modalState:j,textboxValue:K,releaseDetail:N}),r.a.createElement(ua,{modalStateHandler:I,modalState:A,textboxValue:K,siteList:W}))},Da=a(733),Ma=a(734),Na=a(735);function Ta(e){return ne()(e).format("D MMMM YYYY, H:mm")}const Ha=()=>r.a.createElement(Te.a,{height:300,width:684,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"8",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"0",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"8",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"140",rx:"0",ry:"0",width:"206",height:"116"}));var Ra=function(e){const t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],d=s[1],u=e=>t=>{i(!0),d(e)},g=()=>{i(!1)};let b="";const E=e.generatedAlertsData,h=Object(n.useContext)(ve).sites;if(null!==E&&E.length>0){b=function(e,t,a,l){const i=e.site_code,c=e.ts,o=e.internal_alert,s=e.validity,m=e.current_trigger_alerts,d=e.event_triggers,u=function(e,t){let a=null;for(let n=0;n<t.length;n+=1)if(t[n].site_code===e){a=t[n];break}return a}(i,l),g=Ta(c),b=le(u),E=[];let h=null;return m.forEach(e=>{const t=e.type,a=e.details;if("subsurface"===t)h=a.trigger_details;else{const e=a.alert_level,n=a.alert_symbol,l="rainfall"===t&&e>0?" (".concat(a.rain_gauge,")"):"";E.push(r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t},r.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},t.charAt(0).toUpperCase()+t.slice(1)," Alert"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},n,r.a.createElement(v.a,{component:"span",variant:"body2",color:"textPrimary",align:"center"},l))))}}),r.a.createElement(qe.a,{fullWidth:!0,open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(Ve.a,{id:"alert-dialog-title"},r.a.createElement("div",null,b),r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},g)),r.a.createElement(Qe.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Internal Alert Level"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),""!==s&&r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"Validity"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},Ta(s))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"OPERATIONAL ALERT STATUS"))),E.map(e=>e),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textPrimary"},"Subsurface Column Status")),h.length>0?h.map(e=>{const t=e.alert_symbol,a=e.tsm_name;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},a.toUpperCase()),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},t))}):r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"No subsurface sensors available")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),d.length>0&&r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"EVENT TRIGGERS"))),d.map(e=>{const t=e.ts_updated,a=e.alert,l=e.tech_info,i=e.invalid,c=e.invalid_details,o=Ta(t);return r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:a},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"Trigger | ",a))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},l)),"undefined"!==typeof i&&!0===i&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"INVALIDATED ALERT"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},"".concat(c.user.first_name," ").concat(c.user.last_name))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},Ta(c.ts_ack))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},c.remarks))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)))}))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:a,color:"primary",autoFocus:!0},"Close")))}(E[m],l,g,h)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2},null===E?r.a.createElement(Ha,null):E.map((e,t)=>function(e,t,a,n){const l=e.ts,i=e.site_code,c=e.internal_alert,o=Ta(l);return r.a.createElement(y.a,{item:!0,xs:6,sm:4,lg:3,key:t},r.a.createElement(Da.a,{className:"alert-card"},r.a.createElement(Ma.a,{onClick:a(t)},r.a.createElement(Na.a,{style:{paddingBottom:16}},r.a.createElement(v.a,{variant:"body2",color:"textSecondary",gutterBottom:!0},o),r.a.createElement("div",{style:{display:"flex",alignItems:"baseline",alignContent:"flex-end",justifyContent:"space-between"}},r.a.createElement(v.a,{variant:"h5",component:"h2"},i.toUpperCase()),r.a.createElement(v.a,{className:"card-internal-alert",color:"textSecondary"},c))))))}(e,t,u)),b))},Ba=a(736),Ya=a(737),Pa=a(738),La=a(739),Fa=a(740);var za=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxes:{paddingTop:4,paddingBottom:4},checkboxesGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}))((function(e){const t=e.classes,a=e.switchState,l=e.switchHandler,i=e.switchValue,c=e.label,o=e.changeHandler,s=(e.setTriggersState,e.choices);return r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,c),r.a.createElement(Ba.a,{checked:a,onChange:l,value:i})),a?r.a.createElement(n.Fragment,null,r.a.createElement(na.a,{className:t.checkboxesGroup},s.map(({state:e,value:a,label:n},l)=>{const i=e.status,c=e.disabled;return r.a.createElement(Xe.a,{key:l,control:r.a.createElement(kt.a,{checked:i,onChange:o(a),value:a,className:t.checkboxes,disabled:c}),label:n})})),r.a.createElement(E.a,null,"Add required if required")):r.a.createElement("div",null))}));const Ga=(e,t)=>(a,n)=>r=>{const l="timestamp"===a?r:r.target.value,i=parseInt(n.charAt(1),10);e({action:"UPDATE_DETAILS",trigger_type:t,value:{alert_level:i,[a]:l}})},Ua=(e,t)=>a=>{const n=a.target.checked;if(e({action:"TOGGLE_SWITCH",trigger_type:t,value:n}),["on_demand","earthquake"].includes(t)){let a,r=null;"on_demand"===t?(a={reason:"",reporterId:""},r=12):"earthquake"===t&&(a={magnitude:"",longitude:"",latitude:""},r=11),e({action:n?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:Object(u.a)({alert_level:1,timestamp:null,tech_info:"",internal_sym_id:r},a)})}},Wa=(e,t)=>a=>n=>{const r=n.target.checked;let l=null;"surficial"===t?2===a?l=6:3===a&&(l=4):"subsurface"===t&&(2===a?l=3:3===a&&(l=1)),e({action:r?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:{alert_level:a,status:r,disabled:!1,timestamp:null,tech_info:"",internal_sym_id:l}})},qa=(e,t)=>a=>{const n=a.target.value;e({action:"REMOVE_TRIGGER",trigger_type:t,value:"clear_all"}),e({action:"ADD_TRIGGER",trigger_type:t,value:{alert_level:parseInt(n,10),timestamp:null,tech_info:"",internal_sym_id:8}})},Va=(e,t,a)=>n=>{const r=n.target.value;t({action:"UPDATE_DETAILS",trigger_type:a,value:{alert_level:1,[e]:r}})};var Qa=Object(d.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.changeHandler,l=e.labelFor,i=e.trigger_timestamp,c=e.tech_info;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Trigger Timestamp (".concat(l,")"),value:i,onChange:a("timestamp",l),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,label:"Technical Information (".concat(l,")"),multiline:!0,rowsMax:"2",placeholder:'Enter technical info for "'.concat(l,'" trigger'),value:c,onChange:a("tech_info",l),fullWidth:!0})))}));var Za=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.subsurface,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach(e=>{const t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(u.a)(Object(u.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0});const d=m.trigger_2,p=m.trigger_3,g=m.trigger_nd,b=[{state:d,value:2,label:"Release trigger (s2)"},{state:p,value:3,label:"Release trigger (S3)"}],E=i.filter(e=>"subsurface"===e.trigger_source);if(E.length>0){const e=E.pop();b.push({state:g,value:"nd",label:"No data ([s/S]0)"}),-1===e.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(za,{label:"Subsurface",switchState:o,switchHandler:Ua(l,"subsurface"),switchValue:"subsurface_switch",choices:b,changeHandler:Wa(l,"subsurface")})),d.status&&o?r.a.createElement(Qa,{labelFor:"s2",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:Ga(l,"subsurface")}):r.a.createElement("div",null),p.status&&o?r.a.createElement(Qa,{labelFor:"S3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:Ga(l,"subsurface")}):r.a.createElement("div",null))}));var Ka=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.surficial,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach(e=>{const t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(u.a)(Object(u.a)({},e),{},{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0});const d=m.trigger_2,p=m.trigger_3,g=m.trigger_nd,b=[{state:d,value:2,label:"Release trigger (g2)"},{state:p,value:3,label:"Release trigger (G3)"}],E=i.filter(e=>"surficial"===e.trigger_source);if(E.length>0){const e=E.pop();b.push({state:g,value:"nd",label:"No data ([g/G]0)"}),-1===e.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(za,{label:"Surficial",switchState:o,switchHandler:Ua(l,"surficial"),switchValue:"surficial_switch",choices:b,changeHandler:Wa(l,"surficial")})),d.status?r.a.createElement(Qa,{labelFor:"g2",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:Ga(l,"surficial")}):r.a.createElement("div",null),p.status?r.a.createElement(Qa,{labelFor:"G3",trigger_timestamp:p.timestamp,tech_info:p.tech_info,changeHandler:Ga(l,"surficial")}):r.a.createElement("div",null))}));const Ja=Object(O.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}));var Xa=function(e){const t=e.triggersState,a=(e.setTriggerState,Ja()),l=t.moms,i=l.switchState,c=l.triggers,o=()=>{console.log("change has been made")};return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:i?a.groupGridContainer:""},r.a.createElement(Ke.a,{component:"fieldset",className:a.formControl},r.a.createElement(aa.a,{component:"legend",className:a.formLabel},r.a.createElement("span",null,"Manifestation of Movement"))),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"body1",color:"textSecondary"},"NOTE: If you want to add MOMs in the release, use MOMs Insert Form.")),c.map(e=>{const t=e.alert,l=e.timestamp,i=e.tech_info,c=e.moms_list;return r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:12,sm:3,align:"center"},r.a.createElement(v.a,{variant:"body1",component:"span",color:"textSecondary"},"Trigger: "),r.a.createElement(v.a,{variant:"body1",component:"span"},r.a.createElement("strong",null,t))),r.a.createElement(y.a,{item:!0,xs:12,sm:9,align:"center"},r.a.createElement(v.a,{variant:"body1",component:"span",color:"textSecondary"},"Trigger Timestamp: "),r.a.createElement(v.a,{variant:"body1",component:"span"},r.a.createElement("strong",null,l.format("YYYY/MM/DD HH:mm:00")))),c.map(e=>{const t=e.moms_instance,a=e.observance_ts,n=t.feature.feature_type,l=t.feature_name,i=t.instance_id;return r.a.createElement(y.a,{key:i,item:!0,xs:12,container:!0,spacing:0,justify:"space-around"},r.a.createElement(y.a,{item:!0,xs:6,sm:!0,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Feature Type"),r.a.createElement(v.a,{variant:"body2"},r.a.createElement("strong",null,ie(n)))),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Feature Name"),r.a.createElement(v.a,{variant:"body2"},r.a.createElement("strong",null,l))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Observance Timestamp"),r.a.createElement(v.a,{variant:"body2"},r.a.createElement("strong",null,ne()(a).format("YYYY/MM/DD HH:mm:00")))))}),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:a.inputGridContainer},r.a.createElement(b.a,{required:!0,label:"Technical Info",multiline:!0,rowsMax:"2",placeholder:"Enter technical info for 'MOMs' trigger",value:i,onChange:o,fullWidth:!0})))}))))};var $a=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},radios:{paddingTop:4,paddingBottom:4},radioGroup:{display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",justifyContent:"space-between"}}}))((function(e){const t=e.classes,a=e.id,l=e.label,i=e.changeHandler,c=e.radioValue,o=e.choices,s=e.switchState,m=e.switchValue,d=e.switchHandler;return r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,l),r.a.createElement(Ba.a,{checked:s,onChange:d,value:m})),s?r.a.createElement(n.Fragment,null,r.a.createElement(Je.a,{className:t.radioGroup,"aria-label":l,name:a,value:c,onChange:i},o.map(({value:e,label:a},n)=>r.a.createElement(Xe.a,{key:n,value:e,control:r.a.createElement($e.a,{className:t.radios}),label:a}))),r.a.createElement(E.a,null,"Add required if required")):r.a.createElement("div",null))}));var en=Object(d.a)(e=>({groupGridContainer:{marginTop:0,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.triggersReleased,c=a.rainfall,o=c.switchState,s=c.triggers;let m={alert_level:""};0!==s.length&&s.forEach(e=>{m=Object(u.a)(Object(u.a)({},e),{},{alert_level:"".concat(e.alert_level)})});const d=[{value:"1",label:"Release new trigger"}],p=i.filter(e=>"rainfall"===e.trigger_source);if(p.length>0){p.pop();d.push({value:"-1",label:"No data (R0)"},{value:"-2",label:"Intermediate threshold (rx)"})}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement($a,{label:"Rainfall",id:"rainfall",switchState:o,switchHandler:Ua(l,"rainfall"),switchValue:"rainfall_switch",radioValue:m.alert_level,choices:d,changeHandler:qa(l,"rainfall")})),"1"===m.alert_level&&o?r.a.createElement(Qa,{labelFor:"R1",trigger_timestamp:m.timestamp,tech_info:m.tech_info,changeHandler:Ga(l,"rainfall")}):r.a.createElement("div",null))}));var tn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=a.earthquake,c=i.switchState,o=i.triggers;let s={timestamp:null,tech_info:"",magnitude:null,latitude:null,longitude:null};0!==o.length&&(s=Object(u.a)({},o[0]));const m=s,d=m.timestamp,p=m.tech_info,g=m.magnitude,E=m.latitude,h=m.longitude;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"Earthquake"),r.a.createElement(Ba.a,{checked:c,onChange:Ua(l,"earthquake"),value:"switch_earthquake"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(Qa,{labelFor:"e1",trigger_timestamp:d,tech_info:p,changeHandler:Ga(l,"earthquake")}),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"magnitude",label:"Magnitude",value:g,onChange:Va("magnitude",l,"earthquake"),type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"latitude",label:"Latitude",value:E,onChange:Va("latitude",l,"earthquake"),type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"longitude",label:"Longitude",value:h,onChange:Va("longitude",l,"earthquake"),type:"number"}))):r.a.createElement("div",null))}));const an=[{user_id:1,name:"MLGU Something"},{user_id:2,name:"LEWC Chenes"},{user_id:3,name:"BLGU Chos"}];var nn=Object(d.a)(e=>({formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}))((function(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=a.on_demand,c=i.switchState,o=i.triggers;let s={timestamp:null,tech_info:"",reason:"",reporterId:""};0!==o.length&&(s=Object(u.a)({},o[0]));const m=s,d=m.timestamp,p=m.tech_info,g=m.reason,E=m.reporterId;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"On Demand"),r.a.createElement(Ba.a,{checked:c,onChange:Ua(l,"on_demand"),value:"switch_on_demand"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(Qa,{labelFor:"d1",trigger_timestamp:d,tech_info:p,changeHandler:Ga(l,"on_demand")}),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"reason",label:"Reason",value:g,onChange:Va("reason",l,"on_demand"),placeholder:"Enter reason of on-demand request",multiline:!0,rowsMax:2,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(ba,{label:"Reporter",div_id:"reporter_id",changeHandler:Va("reporterId",l,"on_demand"),value:E,list:an,mapping:{id:"user_id",label:"name"}}))):r.a.createElement("div",null))}));const rn=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}));function ln(e){const t=e.setModalTitle,a=e.generalData,l=e.classes,i=e.handleEventChange,c=e.handleDateTime,o=e.setGeneralData,s=e.isUpdatingRelease,m=e.changeState,d=a.siteId,p=a.dataTimestamp,g=a.releaseTime,b=a.reporterIdMt,E=a.reporterIdCt;Object(n.useEffect)(()=>{t("Provide information to the following fields.")},[]);return r.a.createElement(n.Fragment,null,s&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",color:"secondary"},"You chose a data timestamp that has been released. You are allowed to update release details but changes on triggers and alert level cannot be accepted. For those kind of changes, please contact the Software Infra Devs. Thank you."))),r.a.createElement(y.a,{item:!0,xs:12,className:l.inputGridContainer},r.a.createElement(Xt,{value:d,changeHandler:e=>(e=>{const t=e.label,n=e.data;o(Object(u.a)(Object(u.a)({},a),{},{siteId:e,address:t,siteCode:n.site_code})),m("siteId",e)})(e)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Data timestamp",value:p,onChange:c("dataTimestamp"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(Ya.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:g,onChange:c("releaseTime"),clearable:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(va,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",changeHandler:i("reporterIdMt"),value:b,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:l.inputGridContainer},r.a.createElement(va,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",changeHandler:i("reporterIdCt"),value:E,disabled:!0})))}function cn(e){const t=e.classes,a=e.triggersState,l=e.setTriggersState,i=e.setModalTitle,c=e.hasNoGroundData,o=e.setHasNoGroundData,s=e.triggersReleased,m=e.alert_level,d=e.setAlert0,u=e.isAlert0,p=a.subsurface.switchState,g=a.surficial.switchState,b=a.moms.switchState;return Object(n.useEffect)(()=>{i("Add triggers if not yet included in this release.")},[]),r.a.createElement(n.Fragment,null,0!==m&&r.a.createElement(y.a,{item:!0,xs:12,className:u?t.groupGridContainer:""},r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"Lower to Alert 0"),r.a.createElement(Ba.a,{checked:u,onChange:e=>d(e.target.checked),value:"has_no_ground_data"})))),!p&&!g&&!b&&m<=1&&r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ke.a,{component:"fieldset",className:t.formControl},r.a.createElement(aa.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"No Ground Data (ND)"),r.a.createElement(Ba.a,{checked:c,onChange:e=>o(e.target.checked),value:"has_no_ground_data"})))),!1===u&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",color:"secondary"},"Ground-Related Triggers")),r.a.createElement(Za,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(Ka,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(Xa,{triggersState:a,setTriggersState:l}),r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(v.a,{variant:"h6",color:"secondary"},"Secondary Triggers")),r.a.createElement(en,{triggersState:a,setTriggersState:l,triggersReleased:s}),r.a.createElement(tn,{triggersState:a,setTriggersState:l}),r.a.createElement(nn,{triggersState:a,setTriggersState:l})))}function on(e){const t=e.classes,a=e.handleEventChange,l=e.generalData,i=e.internalAlertLevel,c=e.setModalTitle,s=e.mtFullName,m=e.ctFullName,d=e.ewiPayload,u=e.isAlertRecomputing,p=l.siteId,g=l.dataTimestamp,E=l.releaseTime,h=l.comments,f=Object(n.useState)(null),_=Object(o.a)(f,2),O=_[0],j=_[1];Object(n.useEffect)(()=>{c("Review release summary. Add comment if necessary.");let e=[];"undefined"!==typeof d.trigger_list_arr&&(e=d.trigger_list_arr);let t=r.a.createElement(v.a,{variant:"body2",color:"textPrimary",align:"center"},"No triggers included in this release.");e.length>0&&(t=e.map((e,t)=>{const a=e.ts_updated,l=e.alert_level,i=e.trigger_type,c=e.tech_info,o=i.charAt(0).toUpperCase()+i.slice(1),s=ne()(a).format("DD MMMM YYYY, HH:mm");return r.a.createElement(n.Fragment,{key:"".concat(t+1)},r.a.createElement(y.a,{item:!0,xs:6,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Trigger"),r.a.createElement(v.a,{variant:"body2",color:"textPrimary"},"".concat(o," Alert ").concat(l))),r.a.createElement(y.a,{item:!0,xs:6,align:"center"},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(v.a,{variant:"body2",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:12,align:"center",style:{paddingBottom:20}},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Tech info"),r.a.createElement(v.a,{variant:"caption",color:"textPrimary"},c)))})),j(t)},[d]);const S=ne()(g).format("DD MMMM YYYY, HH:mm"),k=ne()(E).format("HH:mm");return r.a.createElement(n.Fragment,null,u?r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(x.a,null)):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Site"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},p.label)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Internal Alert"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},i)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Data Timestamp"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},S)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"Release Time"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},k)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"MT Personnel"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(v.a,{variant:"body2",color:"textSecondary"},"CT Personnel"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"button",color:"textSecondary"},"Triggers")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,align:"center"},O)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(b.a,{label:"Comments",multiline:!0,rowsMax:"2",placeholder:"Enter additional comments necessary",value:h,onChange:a("comments"),fullWidth:!0}))))}var sn=function(e){const t=e.activeStep,a=e.generalData,l=e.setGeneralData,i=e.setInternalAlertLevel,c=e.internalAlertLevel,s=e.setPublicAlertLevel,m=e.isUpdatingRelease,d=e.currentTriggersStatus,p=e.setDBSavedTriggers,g=e.siteCurrentAlertLevel,b=e.setSiteCurrentAlertLevel,E=rn(),h=Object(u.a)({classes:E},e),f=D(),_=f.first_name,O=f.last_name,x="".concat(O,", ").concat(_),j=r.a.useContext(Oa).ct_full_name,S=Object(n.useState)([...d]),C=Object(o.a)(S,2),w=C[0],A=C[1],I=(e,t)=>{if("siteId"===e){!function(e,t){const a=e.site_id;let n="".concat(k,"/api/monitoring/get_site_alert_details");n+="?site_id=".concat(a),ue(n,t)}({site_id:t.value},e=>{console.log(e);const t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_sources,r=e.alert_level;A(n),p(n),s(a),i(t),b(r)})}else l(Object(u.a)(Object(u.a)({},a),{},{[e]:t}))},M=e=>t=>{I(e,t)},N=e=>t=>{const a=t.target.value;I(e,a)},T=["What are the release details?","List the triggers.","Add Comments and Review Release Summary"];return r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},(e=>{switch(e){case 0:return r.a.createElement(ln,Object.assign({},h,{handleDateTime:M,handleEventChange:N,isUpdatingRelease:m,changeState:I}));case 1:return r.a.createElement(cn,Object.assign({},h,{triggersReleased:w,alert_level:g}));case 2:return r.a.createElement(on,Object.assign({},h,{mtFullName:x,ctFullName:j,internalAlertLevel:c,handleEventChange:N}));case 3:return r.a.createElement(v.a,{variant:"body1"},"Early warning information released! Please wait for the dashboard to update or check the site event timeline to confirm if EWI is released.");default:return"Uknown stepIndex"}})(t),r.a.createElement("div",{className:E.root},r.a.createElement(v.a,{className:E.instructions}),r.a.createElement(Pa.a,{activeStep:t,alternativeLabel:!0},T.map(e=>r.a.createElement(La.a,{key:e},r.a.createElement(Fa.a,null)))))))};const mn=Object(O.a)(e=>({inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}}}));function dn(e,t){const a=t.rainfall;let n=!1;return a.switchState&&a.triggers.forEach(e=>{e.alert_level<0&&(n=!0)}),e||n}const un={subsurface:{switchState:!1,triggers:[]},surficial:{switchState:!1,triggers:[]},moms:{switchState:!1,triggers:[]},rainfall:{switchState:!1,triggers:[]},earthquake:{switchState:!1,triggers:[]},on_demand:{switchState:!1,triggers:[]}};function pn(e,{action:t,trigger_type:a,value:n}){let r={},l=[];if("RESET_STATE"!==t){const t=e[a];r=Object(u.a)({},t);l=r.triggers}switch(t){case"TOGGLE_SWITCH":return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},r),{},{switchState:n})});case"ADD_TRIGGER":return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},r),{},{triggers:[...l,n]})});case"REMOVE_TRIGGER":let t;return t="clear_all"===n?[]:l.filter(e=>e.alert_level!==n.alert_level),Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},r),{},{triggers:t})});case"UPDATE_DETAILS":const i=l.map(e=>e.alert_level===n.alert_level?Object(u.a)(Object(u.a)({},e),n):e);return Object(u.a)(Object(u.a)({},e),{},{[a]:Object(u.a)(Object(u.a)({},r),{},{triggers:i})});case"RESET_STATE":return Object(u.a)({},un);default:return e}}var gn=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=e.setIsOpenRoutineModal,d=mn(),g=D().user_id,b=Object(n.useState)({}),E=Object(o.a)(b,2),h=E[0],f=E[1],_=Object(n.useState)(0),v=Object(o.a)(_,2),O=v[0],x=v[1],j=Object(n.useState)(!0),S=Object(o.a)(j,2),C=S[0],w=S[1],A=[1,2,3],I=Object(n.useState)(""),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)(""),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(n.useState)(""),L=Object(o.a)(P,2),F=L[0],z=L[1],G=r.a.useContext(Oa).reporter_id_ct,U={dataTimestamp:null,releaseTime:ne()(),siteId:{},siteCode:"",address:"",reporterIdCt:G,reporterIdMt:g,comments:"",publicAlertSymbol:"",publicAlertLevel:"",triggerListStr:""},W=Object(n.useState)(Object(u.a)({},U)),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=Object(n.useState)(!1),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],re=Object(n.useState)(0),le=Object(o.a)(re,2),ie=le[0],ce=le[1],oe=Object(n.useState)(!1),se=Object(o.a)(oe,2),me=se[0],pe=se[1],ge=Object(n.useReducer)(pn,Object(u.a)({},un)),be=Object(o.a)(ge,2),Ee=be[0],he=be[1],fe=Object(n.useState)([]),_e=Object(o.a)(fe,2),ye=_e[0],ve=_e[1],Oe=Object(n.useState)([]),xe=Object(o.a)(Oe,2),je=xe[0],Se=xe[1],ke=Object(c.b)().enqueueSnackbar;Object(n.useEffect)(()=>{const e=V.dataTimestamp,t=V.siteCode;if("object"===typeof e&&null!==e){const l=ne()(e).format("YYYY-MM-DD HH:mm:ss");a=t,n=l,r=e=>{Object.entries(e).length>1&&ae(!0)},ue("".concat(k,"/api/monitoring/get_monitoring_releases_by_data_ts/").concat(a,"/").concat(n),r)}var a,n,r},[V.dataTimestamp]),Object(n.useEffect)(()=>{if(null!==i&&"routine"!==i.general_status){const e=i.site_id,t=i.site_code,a=i.public_alert_level,n=i.public_alert_symbol,r=i.release_details,l=i.trigger_list_arr,c=i.has_ground_data,o=i.non_triggering_moms,s=i.internal_alert_level,m=i.current_triggers_status,d=i.saved_event_triggers,p=i.to_extend_validity,b=r.data_ts,E=r.trigger_list_str;T(s);const _=[];l.forEach(e=>{if(!0!==e.invalid&&_.push(e),"moms"===e.trigger_type){const t=e.moms_list;e.moms_id_list=t.map(e=>e.moms_id)}});let y=null;if(o.length>0){y={moms_id_list:o.map(e=>e.moms_id)}}f(Object(u.a)(Object(u.a)({},h),{},{site_id:e,site_code:t,public_alert_level:a,public_alert_symbol:n,release_details:{data_ts:b,trigger_list_str:E,release_time:ne()().format("HH:mm:00")},publisher_details:{publisher_mt_id:g,publisher_ct_id:G},trigger_list_arr:_,non_triggering_moms:y,to_extend_validity:p}));X(!c);const v=Object(u.a)(Object(u.a)({},V),{},{reporterIdCt:G,dataTimestamp:ne()(b),siteId:{value:e,label:t.toUpperCase()},siteCode:t,triggerListStr:E,publicAlertSymbol:n,publicAlertLevel:a,nonTriggeringMoms:o});Q(Object(u.a)({},v)),he({action:"RESET_STATE"}),"undefined"!==typeof d&&ve(d);const O=[];l.forEach(e=>{const t=e.trigger_type,a=e.alert_level,n=e.ts_updated,r=e.internal_sym_id,l=e.tech_info,i=e.alert;if("undefined"===typeof e.invalid){let c={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};he(c);const o={alert:i,alert_level:a,internal_sym_id:r,tech_info:l,disabled:!1,status:!0,timestamp:ne()(n)};if("moms"===t){const t=e.moms_list;o.moms_list=t,o.moms_id_list=t.map(e=>e.moms_id)}if(c={action:"ADD_TRIGGER",trigger_type:t,value:o},he(c),t in["on demand","earthquake"]){let e=null;switch(t){case"on demand":e={action:"UPDATE_TRIGGER",trigger_type:t,value:{od_details:{request_ts:"",narrative:""}}};break;case"earthquake":e={action:"UPDATE_TRIGGER",trigger_type:t,value:{eq_details:{magnitude:"",latitude:"",longitude:""}}}}null!=e&&he(e)}}else O.push(t)}),Se(m),m.forEach(e=>{const t=e.trigger_source,a=e.alert_level;if(O.includes(t))return;let n=a;-1===a&&"rainfall"!==t&&(n="nd");let r={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};he(r);r={action:"ADD_TRIGGER",trigger_type:t,value:{status:!0,disabled:!1,alert_level:n,timestamp:null,tech_info:""}},he(r)}),x(2)}else Q(Object(u.a)({},U)),he({action:"RESET_STATE"}),ve([]),Se([]),T(""),x(0)},[i,G]);const Ce=Object(n.useState)(!1),we=Object(o.a)(Ce,2),Ae=we[0],Ie=we[1];Object(n.useEffect)(()=>{if(w(!0),0===O){const e=V.siteId,t=V.dataTimestamp,a=V.releaseTime,n=V.reporterIdCt,r=V.reporterIdMt;w(""===e||null===t||null===a||""===n||""===r)}else if(1===O){const e=Object.keys(Ee);let t=!1;for(let a=0;a<e.length;a+=1){const n=Ee[e[a]],r=n.switchState,l=n.triggers;if(r){const n=l.length;if(0===n)t=!0;else for(let r=0;r<n;r+=1)if([1,2,3].includes(l[r].alert_level)){if("on_demand"===e[a]){const e=l[r],a=e.reason,n=e.reporterId,i=e.tech_info,c=e.timestamp;""!==i&&""!==c&&""!==a&&""!==n||(t=!0)}else if("earthquake"===e[a]){const e=l[r],a=e.tech_info,n=e.timestamp,i=e.magnitude,c=e.longitude,o=e.latitude;""!==a&&""!==n&&""!==i&&""!==c&&""!==o||(t=!0)}else{const e=l[r],a=e.tech_info,n=e.timestamp;""!==a&&null!==n||(t=!0)}break}}}w(t)}else if(2===O){w(""===G||Ae)}},[V,Ee,O,G,Ae]),Object(n.useEffect)(()=>{const e=Ee.subsurface,t=Ee.surficial;(e.switchState||t.switchState)&&X(!1)},[Ee.subsurface,Ee.surficial]);const De=()=>{l(),x(0),s(null),Q(Object(u.a)({},U)),f({}),pe(!1),X(!1)};return r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Alert Release Form"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,F),r.a.createElement(sn,{activeStep:O,isUpdatingRelease:te,triggersState:Ee,setTriggersState:he,generalData:V,setGeneralData:Q,internalAlertLevel:N,setInternalAlertLevel:T,setPublicAlertLevel:Y,setModalTitle:z,ewiPayload:h,hasNoGroundData:J,setHasNoGroundData:X,currentTriggersStatus:je,setDBSavedTriggers:ve,siteCurrentAlertLevel:ie,setSiteCurrentAlertLevel:ce,isAlert0:me,setAlert0:pe,isAlertRecomputing:Ae})),r.a.createElement(et.a,null,O===A.length?r.a.createElement("div",null,r.a.createElement(p.a,{onClick:De,color:"primary"},"Okay")):r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},r.a.createElement(y.a,{item:!0,xs:!0,style:{display:null===i?"flex":"none"}},r.a.createElement(p.a,{onClick:m,className:d.backButton},"Release Routine")),r.a.createElement(y.a,{item:!0,xs:!0,align:"right"},r.a.createElement(p.a,{onClick:De,color:"primary"},"Cancel"),r.a.createElement(p.a,{disabled:0===O,onClick:()=>{x(e=>e-1)},className:d.backButton},"Back"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{x(e=>e+1);const e=V.siteId,t=V.siteCode,a=V.publicAlertSymbol,n=V.dataTimestamp,r=V.releaseTime,l=V.reporterIdMt,i=V.reporterIdCt,c=V.comments,o=V.triggerListStr;let s=[],m=[],d={};if(0===O)f(Object(u.a)(Object(u.a)({},h),{},{site_id:e.value,site_code:t,public_alert_level:B,public_alert_symbol:a,release_details:{data_ts:ne()(n).format("YYYY-MM-DD HH:mm:00"),trigger_list_str:o,release_time:ne()(r).format("HH:mm:00")},publisher_details:{publisher_mt_id:l,publisher_ct_id:i},non_triggering_moms:[]}));else if(1===O){s=function(e){const t=[];return Object.keys(e).forEach(a=>{if(e[a].switchState){const n=e[a].triggers,r="on_demand"===a?"on demand":a;n.forEach(e=>{const n=e.timestamp,l=e.alert_level,i=e.internal_sym_id,c=e.tech_info;let o=null;null!==n&&(o=n.format("YYYY-MM-DD HH:mm:00"));let s,m=l;switch("nd"===l?m=-1:"rx"===l&&(m=-2),a){case"moms":s={moms_id_list:e.moms_id_list};break;case"on_demand":s={od_details:{request_ts:o,narrative:e.reason,reporter_id:e.reporterId}};break;case"earthquake":const t=e.magnitude,a=e.latitude,n=e.longitude;s={eq_details:{magnitude:parseFloat(t),latitude:parseFloat(a),longitude:parseFloat(n)}};break;default:s={}}const d=Object(u.a)(Object(u.a)({},s),{},{alert_level:m,internal_sym_id:i,tech_info:c,trigger_type:r,ts_updated:o});t.push(d)})}}),t}(Ee),m=ye;const e={latest_trigger_list:s,current_trigger_list:m,has_no_ground_data:J,is_alert_0:me};console.log("JSON data for alert generation recomputation",e),Ie(!0);const t=s.filter(e=>e.alert_level>0);!function(e,t){de("".concat(k,"/api/monitoring/create_release_details"),e,t)}(e,e=>{const a=e.internal_alert_level,n=e.public_alert_level,r=e.trigger_list_str,l=e.public_alert_symbol;Y(n),T(a),f(Object(u.a)(Object(u.a)({},h),{},{public_alert_level:n,public_alert_symbol:l,internal_alert_level:a,release_details:Object(u.a)(Object(u.a)({},h.release_details),{},{trigger_list_str:r}),trigger_list_arr:t,to_extend_validity:dn(J,Ee)})),Ie(!1)})}else if(O===A.length-1){z(""),d=h,d.release_details.comments=c;const e=ke("Inserting EWI release...",{variant:"warning",persist:!0});d.snackbar_key=e,f(d),console.log("Submitting data...",h),lt("insert_ewi",h)}},disabled:C},O===A.length-1?"Submit":"Next"))))))})),bn=a(282),En=a(741),hn=a(283),fn=a(202),_n=a(687);const yn=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{margin:"auto"},cardHeader:{padding:e.spacing(1,2)},list:{width:200,height:230,backgroundColor:e.palette.background.paper,overflow:"auto"},button:{margin:e.spacing(.5,0)}}));function vn(e,t){return e.filter(e=>!t.some(t=>t.value===e.value))}function On(e,t){return e.filter(e=>t.some(t=>t.value===e.value))}var xn=function(e){const t=e.routineData,a=e.setRoutineData,l=e.a0SiteList,i=e.setA0SiteList,c=e.NDSiteList,s=e.setNDSiteList,m=e.dataTimestamp,d=e.setDataTimestamp,g=yn(),b=r.a.useContext(Oa).reporter_id_ct,E=Object(n.useState)(null),h=Object(o.a)(E,2),f=h[0],_=h[1];Object(n.useEffect)(()=>{_(t.release_time)},[t]);const v=t.reporter_id_mt,O=e=>n=>{const r=Object(u.a)(Object(u.a)({},t),{},{[e]:n});a(r),"data_ts"===e&&d(ne()(n).format("YYYY-MM-DD HH:mm:00"))},x=r.a.useState([]),j=Object(o.a)(x,2),S=j[0],k=j[1],C=On(S,l.site_id_list),w=On(S,c.site_id_list),A=(e,t)=>()=>{const a=S.findIndex(t=>t.value===e),n=[...S];if(-1===a){const a=t.find(t=>t.value===e);n.push(a)}else n.splice(a,1);k(n)},I=e=>On(S,e).length,D=e=>()=>{var t,a;I(e)===e.length?k(vn(S,e)):k((t=S,a=e,[...t,...vn(a,t)]))},M=(e,t)=>{const a=t.site_id_list;return r.a.createElement(Da.a,null,r.a.createElement(En.a,{className:g.cardHeader,avatar:r.a.createElement(kt.a,{onClick:D(a),checked:I(a)===a.length&&0!==a.length,indeterminate:I(a)!==a.length&&0!==I(a),disabled:0===a.length,inputProps:{"aria-label":"all site_id_list selected"}}),title:e}),r.a.createElement(Ne.a,null),r.a.createElement(bn.a,{className:g.list,dense:!0,component:"div",role:"list"},a.map(e=>{const t=e.value,n=e.label,l="transfer-list-all-item-".concat(t,"-label");return r.a.createElement(hn.a,{key:t,role:"listitem",button:!0,onClick:A(t,a)},r.a.createElement(_n.a,null,r.a.createElement(kt.a,{checked:S.some(e=>e.value===t),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":l}})),r.a.createElement(fn.a,{id:l,primary:n}))}),r.a.createElement(hn.a,null)))};return r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:g.inputGridContainer},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Data timestamp",value:m,onChange:O("data_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,error:null===m})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:g.inputGridContainer},r.a.createElement(Ya.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:f,onChange:O("release_time"),clearable:!0})),r.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center",className:g.root},r.a.createElement(y.a,{item:!0},M("A0 Sites",l)),r.a.createElement(y.a,{item:!0},r.a.createElement(y.a,{container:!0,direction:"column",alignItems:"center"},r.a.createElement(p.a,{variant:"outlined",size:"small",className:g.button,onClick:()=>{s(Object(u.a)(Object(u.a)({},c),{},{site_id_list:c.site_id_list.concat(C)})),i(Object(u.a)(Object(u.a)({},l),{},{site_id_list:vn(l.site_id_list,C)})),k(vn(S,C))},disabled:0===C.length,"aria-label":"move selected NDSiteList"},">"),r.a.createElement(p.a,{variant:"outlined",size:"small",className:g.button,onClick:()=>{i(Object(u.a)(Object(u.a)({},l),{},{site_id_list:l.site_id_list.concat(w)})),s(Object(u.a)(Object(u.a)({},c),{},{site_id_list:vn(c.site_id_list,w)})),k(vn(S,w))},disabled:0===w.length,"aria-label":"move selected a0SiteList"},"<"))),r.a.createElement(y.a,{item:!0},M("ND Sites",c))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:g.inputGridContainer},r.a.createElement(va,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:v,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:g.inputGridContainer},r.a.createElement(va,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:b,disabled:!0}))))};function jn(e){let t=[];return e.length>0&&(t=e.map(e=>{const t=e.site_code;return{state:!0,value:e.site_id,label:t.toUpperCase(),is_disabled:!1}})),t.sort((e,t)=>e.site_id>t.site_id)}var Sn=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=D().user_id,d=r.a.useContext(Oa).reporter_id_ct,g=Object(n.useContext)(ve).sites,b=Object(n.useState)({}),E=Object(o.a)(b,2),h=E[0],f=E[1],_=Object(c.b)().enqueueSnackbar,y={public_alert_symbol:"A0",public_alert_level:0,data_ts:null,release_time:ne()(),general_status:"routine",reporter_id_ct:d,reporter_id_mt:m,non_triggering_moms:{}},v=Object(n.useState)(Object(u.a)({},y)),O=Object(o.a)(v,2),x=O[0],j=O[1],S=Object(n.useState)(Object(u.a)({},{site_id_list:[],internal_alert_level:"A0",trigger_list_str:null})),C=Object(o.a)(S,2),w=C[0],A=C[1],I=Object(n.useState)(Object(u.a)({},{site_id_list:[],internal_alert_level:"ND",trigger_list_str:null})),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)([]),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(n.useState)(null),L=Object(o.a)(P,2),F=L[0],z=L[1],G=0===w.site_id_list.length&&0===N.site_id_list.length||""===d;return Object(n.useEffect)(()=>{j(Object(u.a)({},y));const e=jn(g);Y(e)},[g]),Object(n.useEffect)(()=>{var e,t;null===i&&(null!==F?(e=F,t=e=>{const t=jn(e.unreleased_sites);A(Object(u.a)(Object(u.a)({},w),{},{site_id_list:t}))},ue("".concat(k,"/api/monitoring/get_unreleased_routine_sites/").concat(e),t)):(A(Object(u.a)(Object(u.a)({},w),{},{site_id_list:[]})),T(Object(u.a)(Object(u.a)({},N),{},{site_id_list:[]}))))},[F,i]),Object(n.useEffect)(()=>{if("undefined"!==typeof i&&null!==i&&"routine"===i.general_status){const e=Object(u.a)({},i);delete e.routine_details;const t=Object(u.a)(Object(u.a)({},y),e);j(t),z(e.data_ts);Object(u.a)({},i).routine_details.forEach(e=>{const t=e.site_id_list,a=e.internal_alert_level,n=B.filter(e=>t.includes(e.value)),r=Object(u.a)(Object(u.a)({},e),{},{site_id_list:n});"A0"===a?A(r):T(r)}),f(Object(u.a)({},h))}},[i,B]),r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Routine Release Form"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Transfer site codes to their respective list if needed. Put sites with ground data on A0 Sites list while put sites without ground data on ND Sites."),r.a.createElement(xn,{routineData:x,setRoutineData:j,a0SiteList:w,setA0SiteList:A,NDSiteList:N,setNDSiteList:T,dataTimestamp:F,setDataTimestamp:z})),r.a.createElement(et.a,null,r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:()=>{l(),s(null),z(null)},color:"primary"},"Cancel"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{const e=ne()(x.data_ts).format("YYYY-MM-DD HH:mm:00"),t=ne()(x.release_time).format("HH:mm:ss"),a=_("Inserting Routine EWI release...",{variant:"warning",persist:!0}),n=Object(u.a)(Object(u.a)({},x),{},{data_timestamp:e,release_time:t,reporter_id_ct:d,routine_details:[Object(u.a)({},w),Object(u.a)({},N)],snackbar_key:a});console.log("Submitting data...",n),lt("insert_ewi",n),l()},disabled:G},"Submit"))))))})),kn=a(742),Cn=a(743),wn=a(744),An=a(340),In=a.n(An);function Dn(e){const t=e,a=e.ts_posted,n=e.ts_expiration,r=e.site_id_list,l=[];return null!==r&&r.forEach(({value:e})=>{l.push(e)}),t.user_id=D().user_id,t.ts_posted=ne()(a).format("YYYY-MM-DD HH:mm:ss"),"Invalid date"!==n&&(t.ts_expiration=ne()(n).format("YYYY-MM-DD HH:mm:ss")),t.site_id_list=l,t}function Mn(e,t){!function(e,t,a=null){S.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}(Dn(e),"".concat(k,"/api/issues_and_reminders/write_issue_reminder_to_db"),t)}const Nn=[{active:!0,barangay:"Agbatuan",municipality:"Dumarao",province:"Capiz",psgc:61904001,purok:null,region:"VI",season:1,site_code:"agb",site_id:1,sitio:null,latitude:11.28137,longitude:122.8311},{active:!0,barangay:"Poblacion",municipality:"Bakun",province:"Benguet",psgc:141103009,purok:null,region:"CAR",season:2,site_code:"bak",site_id:2,sitio:null,latitude:16.7907,longitude:120.6616},{active:!0,barangay:"Banlasan",municipality:"Calape",province:"Bohol",psgc:71210003,purok:null,region:"VI",season:1,site_code:"ban",site_id:3,sitio:null,latitude:9.888559,longitude:123.9488},{active:!0,barangay:"Baras",municipality:"Tarangnan",province:"Samar",psgc:86020008,purok:null,region:"VIII",season:1,site_code:"bar",site_id:4,sitio:null,latitude:11.90208,longitude:124.6566},{active:!0,barangay:"Bayabas",municipality:"Labo",province:"Camarines Norte",psgc:51606009,purok:null,region:"V",season:1,site_code:"bay",site_id:5,sitio:null,latitude:14.18797,longitude:122.4675},{active:!0,barangay:"Boloc",municipality:"Tubungan",province:"Iloilo",psgc:63046016,purok:null,region:"VI",season:2,site_code:"blc",site_id:6,sitio:null,latitude:10.82665,longitude:122.3108},{active:!0,barangay:"Bolodbolod",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412004,purok:"3 & 4",region:"VIII",season:1,site_code:"bol",site_id:7,sitio:null,latitude:10.30199,longitude:125.1279},{active:!0,barangay:"Bato",municipality:"Sibonga",province:"Cebu",psgc:72246007,purok:null,region:"VI",season:1,site_code:"bto",site_id:8,sitio:null,latitude:10.01379,longitude:123.5776},{active:!0,barangay:"San Carlos",municipality:"Dapa",province:"Surigao del Norte",psgc:166707025,purok:null,region:"XIII",season:1,site_code:"car",site_id:9,sitio:null,latitude:9.719629,longitude:125.9737},{active:!0,barangay:"Cudog",municipality:"Lagawe",province:"Ifugao",psgc:142704010,purok:null,region:"CAR",season:2,site_code:"cud",site_id:10,sitio:"Natuwolan at Wadwad",latitude:16.80931,longitude:121.1047},{active:!0,barangay:"Dadong",municipality:"Tarragona",province:"Davao Oriental",psgc:112511003,purok:null,region:"XI",season:1,site_code:"dad",site_id:11,sitio:"Sagasa",latitude:7.13731,longitude:126.4509},{active:!0,barangay:"Gaas",municipality:"Balamban",province:"Cebu",psgc:72208014,purok:null,region:"VII",season:1,site_code:"gaa",site_id:12,sitio:null,latitude:10.42352,longitude:123.7851},{active:!0,barangay:"Gamut",municipality:"Tago",province:"Surigao del Sur",psgc:166818012,purok:null,region:"XIII",season:1,site_code:"gam",site_id:13,sitio:null,latitude:9.0101,longitude:126.1676},{active:!0,barangay:"1 & 2",municipality:"Hinabangan",province:"Samar",psgc:86008012,purok:null,region:"VIII",season:1,site_code:"hin",site_id:14,sitio:null,latitude:11.70064,longitude:125.0691},{active:!0,barangay:"Humayhumay",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611013,purok:null,region:"VII",season:1,site_code:"hum",site_id:15,sitio:null,latitude:10.18392,longitude:123.2503},{active:!0,barangay:"Imelda",municipality:"Tarangnan",province:"Samar",psgc:86020024,purok:null,region:"VIII",season:1,site_code:"ime",site_id:16,sitio:null,latitude:11.90383,longitude:124.7526},{active:!0,barangay:"Immuli",municipality:"Pidigan",province:"Abra",psgc:140118005,purok:null,region:"CAR",season:2,site_code:"imu",site_id:17,sitio:null,latitude:17.52308,longitude:120.6046},{active:!0,barangay:"Inabasan",municipality:"Maasin",province:"Iloilo",psgc:63029025,purok:null,region:"VI",season:2,site_code:"ina",site_id:18,sitio:"Sambag",latitude:10.86991,longitude:122.4362},{active:!0,barangay:"Poblacion 1",municipality:"San Jorge",province:"Samar",psgc:86025024,purok:null,region:"VIII",season:1,site_code:"jor",site_id:19,sitio:null,latitude:11.97779,longitude:124.8249},{active:!0,barangay:"Ambuklao",municipality:"Bokod",province:"Benguet",psgc:141104001,purok:null,region:"CAR",season:2,site_code:"lab",site_id:20,sitio:"Labey",latitude:16.47032,longitude:120.7054},{active:!0,barangay:"Laygayon",municipality:"Pinabacdao",province:"Samar",psgc:86013013,purok:null,region:"VIII",season:1,site_code:"lay",site_id:21,sitio:null,latitude:11.5127,longitude:125.0257},{active:!0,barangay:"Lipanto",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412016,purok:"1",region:"VIII",season:1,site_code:"lip",site_id:22,sitio:null,latitude:10.22767,longitude:125.1266},{active:!0,barangay:"Looc",municipality:"Villanueva",province:"Misamis Oriental",psgc:104326011,purok:null,region:"X",season:1,site_code:"loo",site_id:23,sitio:null,latitude:8.597964,longitude:124.7775},{active:!0,barangay:"Lipata",municipality:"Paranas",province:"Samar",psgc:86022016,purok:null,region:"VIII",season:1,site_code:"lpa",site_id:24,sitio:null,latitude:11.78625,longitude:125.0196},{active:!0,barangay:"Literon",municipality:"Calbiga",province:"Samar",psgc:86004017,purok:null,region:"VIII",season:1,site_code:"lte",site_id:25,sitio:null,latitude:11.59037,longitude:125.0903},{active:!0,barangay:"Lunas",municipality:"Maasin City",province:"Southern Leyte",psgc:86407034,purok:null,region:"VIII",season:1,site_code:"lun",site_id:26,sitio:"Caianuhan",latitude:10.25819,longitude:124.877},{active:!0,barangay:"Magsaysay",municipality:"Kibawe",province:"Bukidnon",psgc:101308016,purok:"1, 2 & 3",region:"X",season:1,site_code:"mag",site_id:27,sitio:null,latitude:7.51923,longitude:125.0598},{active:!0,barangay:"Ambassador",municipality:"Tublay",province:"Benguet",psgc:141114001,purok:null,region:"CAR",season:2,site_code:"mam",site_id:28,sitio:"Mamuyod",latitude:16.4883,longitude:120.689},{active:!0,barangay:"Marirong",municipality:"Leon",province:"Iloilo",psgc:63028059,purok:null,region:"VI",season:2,site_code:"mar",site_id:29,sitio:null,latitude:10.827459,longitude:122.321555},{active:!0,barangay:"Mac-Arthur",municipality:"Esperanza",province:"Agusan del Sur",psgc:160303010,purok:null,region:"XIII",season:1,site_code:"mca",site_id:30,sitio:null,latitude:8.58543,longitude:125.741},{active:!0,barangay:"Manghulyawon",municipality:"La Libertad",province:"Negros Oriental",psgc:184613013,purok:null,region:"VII",season:1,site_code:"mng",site_id:31,sitio:"Dao",latitude:10.04793,longitude:123.2062},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msl",site_id:32,sitio:"Lower Mesolong",latitude:7.629616,longitude:125.5445},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msu",site_id:33,sitio:"Upper Mesolong",latitude:7.628743,longitude:125.5403},{active:!0,barangay:"Nagyubuyuban",municipality:"San Fernando City",province:"La Union",psgc:13314034,purok:"5",region:"I",season:2,site_code:"nag",site_id:34,sitio:null,latitude:16.62678,longitude:120.4176},{active:!0,barangay:"Nurcia",municipality:"Lanuza",province:"Surigao del Sur",psgc:166810011,purok:null,region:"XIII",season:1,site_code:"nur",site_id:35,sitio:null,latitude:9.269702,longitude:126.1384},{active:!0,barangay:"Oslao",municipality:"San Francisco",province:"Surigao del Norte",psgc:166719010,purok:null,region:"XIII",season:1,site_code:"osl",site_id:36,sitio:null,latitude:9.75719,longitude:125.4014},{active:!0,barangay:"Parasanon",municipality:"Pinabacdao",province:"Samar",psgc:86013022,purok:null,region:"VIII",season:1,site_code:"par",site_id:37,sitio:null,latitude:11.51487,longitude:125.0255},{active:!0,barangay:"Pepe",municipality:"Leon",province:"Iloilo",psgc:63028070,purok:null,region:"VI",season:2,site_code:"pep",site_id:38,sitio:"Bangi",latitude:10.78788,longitude:122.3336},{active:!0,barangay:"Pinagkamaligan",municipality:"Calauag",province:"Quezon",psgc:45607060,purok:null,region:"IVB",season:1,site_code:"pin",site_id:39,sitio:null,latitude:13.9536,longitude:122.2855},{active:!0,barangay:"Planas",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611027,purok:null,region:"VII",season:1,site_code:"pla",site_id:40,sitio:"Mambog",latitude:10.15984,longitude:123.2459},{active:!0,barangay:"Pange",municipality:"Matnog",province:"Sorsogon",psgc:56212032,purok:null,region:"V",season:1,site_code:"png",site_id:41,sitio:null,latitude:12.63063,longitude:124.0183},{active:!0,barangay:"Puguis",municipality:"La Trinidad",province:"Benguet",psgc:141110013,purok:null,region:"CAR",season:2,site_code:"pug",site_id:42,sitio:"Longlong",latitude:16.44655,longitude:120.5706},{active:!0,barangay:"Antadao",municipality:"Sagada",province:"Mt. Province",psgc:144409005,purok:null,region:"CAR",season:2,site_code:"sag",site_id:43,sitio:null,latitude:17.08263,longitude:120.9248},{active:!0,barangay:"Sibajay",municipality:"Boston",province:"Davao Oriental",psgc:112503006,purok:null,region:"XI",season:1,site_code:"sib",site_id:44,sitio:null,latitude:7.82567,longitude:126.3834},{active:!0,barangay:"Amgaleyguey",municipality:"Buguias",province:"Benguet",psgc:141105002,purok:null,region:"CAR",season:2,site_code:"sin",site_id:45,sitio:"Sinipsip",latitude:16.7234,longitude:120.7815},{active:!0,barangay:"Sumalsag",municipality:"Malitbog",province:"Bukidnon",psgc:101313011,purok:null,region:"X",season:1,site_code:"sum",site_id:46,sitio:null,latitude:8.54511,longitude:124.8597},{active:!0,barangay:"Talahid",municipality:"Almeria",province:"Biliran",psgc:87801012,purok:null,region:"VIII",season:1,site_code:"tal",site_id:47,sitio:null,latitude:11.63742,longitude:124.3665},{active:!0,barangay:"Taga",municipality:"Pinukpuk",province:"Kalinga",psgc:143209022,purok:null,region:"CAR",season:2,site_code:"tga",site_id:48,sitio:null,latitude:17.57347,longitude:121.3834},{active:!0,barangay:"Tue",municipality:"Tadian",province:"Mt. Province",psgc:144410019,purok:null,region:"CAR",season:2,site_code:"tue",site_id:49,sitio:null,latitude:16.97229,longitude:120.8286},{active:!0,barangay:"Umingan",municipality:"Alimodian",province:"Iloilo",psgc:63002053,purok:null,region:"VI",season:2,site_code:"umi",site_id:50,sitio:null,latitude:10.90807,longitude:122.3278}],Tn=Jt(Nn),Hn=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},justify:{display:"flex",justifyContent:"space-evenly"}}));var Rn=function(e){const t=e.issueReminderData,a=e.setIssueReminderData,l=e.fullScreen,i=e.toResolve,c=Hn(),s=t.iar_id,m=t.detail,d=t.ts_expiration,p=t.resolution,g=t.is_event_entry,E=t.site_id_list,h=Object(n.useState)("general"),f=Object(o.a)(h,2),_=f[0],v=f[1],O=Object(n.useState)(_),x=Object(o.a)(O,2),j=x[0],S=x[1],k=Object(n.useState)(j),C=Object(o.a)(k,2),w=C[0],A=C[1],I=Object(n.useState)(!1),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useState)(!1),H=Object(o.a)(T,2),R=H[0],B=H[1];Object(n.useEffect)(()=>{if(N(g),""!==s&&"undefined"!==typeof s){const e=E.map(e=>Tn.filter(t=>t.value===e).pop());a(Object(u.a)(Object(u.a)({},t),{},{site_id_list:e}))}null!==E&&"undefined"!==typeof E&&E.length>0&&(v("site"),S("site"),A("site")),null===d&&B(!0)},[]);const Y=e=>n=>{const r=n.target.value;a(Object(u.a)(Object(u.a)({},t),{},{[e]:r}))},P=e=>{const n=e.target,r=n.value,l=n.checked;switch(r){case"is_event_entry":N(l),l||B(!1),a(Object(u.a)(Object(u.a)({},t),{},{is_event_entry:l}));break;case"is_persistent":B(l),a(Object(u.a)(Object(u.a)({},t),{},{is_persistent:l}))}};return r.a.createElement(wt.a,{utils:Ct.a},i?r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Resolution",value:p||"",onChange:Y("resolution"),placeholder:"Enter resolution",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))):r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Je.a,{"aria-label":"position",name:"position",value:j,onChange:e=>{const t=e.target.value;S(t),A(t)},row:!0,className:l?"":c.justify},r.a.createElement(Xe.a,{value:"general",control:r.a.createElement($e.a,{color:"primary"}),label:"General issue/reminder",labelPlacement:"end"}),r.a.createElement(Xe.a,{value:"site",control:r.a.createElement($e.a,{color:"primary"}),label:"Site-specific issue/reminder",labelPlacement:"end"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{style:{marginBottom:8}})),"site"===w&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xt,{value:E,changeHandler:e=>a(Object(u.a)(Object(u.a)({},t),{},{site_id_list:e})),isMulti:!0,includeAddressOnOptions:!1})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xe.a,{key:"is_event_entry",control:r.a.createElement(kt.a,{checked:M,onChange:P,value:"is_event_entry",className:c.checkboxes}),label:r.a.createElement("div",null,"Related to current monitoring event ",r.a.createElement(Pe.a,{title:"Checking this will make the issue/reminder expire at the end of site(s) current monitoring event validity"},r.a.createElement("strong",null,"[?]"))),className:"primary"}))),(w||!M)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6,container:!0,justify:"center"},r.a.createElement(Xe.a,{key:"is_persistent",control:r.a.createElement(kt.a,{checked:R,onChange:P,value:"is_persistent",className:c.checkboxes}),label:"Persistent reminder",className:"primary"})),R?r.a.createElement(y.a,{item:!0,md:6}):r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(At.b,{autoOk:!0,label:"Issue/Reminder Expiration",value:d,onChange:(L="ts_expiration",e=>{a(Object(u.a)(Object(u.a)({},t),{},{[L]:e}))}),ampm:!1,format:"YYYY-MM-DD HH:mm:ss",mask:"____-__-__ __:__:__",clearable:!0}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{style:{margin:"8px 0"}})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Details",value:m,onChange:Y("detail"),placeholder:"Enter detail",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))));var L};const Bn={detail:"",iar_id:"",site_id_list:null,user_id:"",postings:"",resolution:null,resolved_by:null,ts_resolved:null,ts_posted:ne()().format("YYYY-MM-DD HH:mm:ss"),ts_expiration:null,is_event_entry:!1,is_persistent:!1};var Yn=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setIsIandRUpdateNeeded,c=e.chosenIssueReminder,s=e.isIandRUpdateNeeded,m=e.toResolve,d=e.setToRefresh,g=e.toRefresh,b=Object(n.useState)({}),E=Object(o.a)(b,2),h=E[0],f=E[1];Object(n.useEffect)(()=>{if(s){const e=c,t=c.postings.map(e=>e.site_id),a=[];c.postings.forEach(e=>{const t=e.event;null!==t&&a.push(t)}),e.site_id_list=t,e.is_event_entry=a.length>0,f(e)}else f(Bn)},[a,c]);const _=()=>{i(!1),l(!1)};return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Issues and Reminder Form"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Provide information to the following fields."),r.a.createElement(Rn,{issueReminderData:h,setIssueReminderData:f,fullScreen:t,toResolve:m})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:_,color:"primary"},"Cancel"),r.a.createElement(p.a,{color:"secondary",onClick:()=>{const e=h.resolution,t=ne()().format("YYYY-MM-DD HH:mm:ss");let a=Object(u.a)(Object(u.a)({},h),{},{ts_posted:t});if(""!==e&&null!==e){const e=D().user_id;a=Object(u.a)(Object(u.a)({},h),{},{ts_resolved:t,resolved_by:e})}Mn(a,e=>{e&&"undefined"!==typeof g&&d(!g)}),_()},disabled:!1},"Submit")))}));const Pn=Object(O.a)(e=>({inputGridContainer:{marginTop:8,marginBottom:8},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},gridList:{height:"100vh",margin:"0 !important",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"},position:"sticky",top:148,padding:8},hasNoIssues:{display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"},icon:{color:"rgba(255, 255, 255, 0.54)"},previewText:{padding:"12px",fontSize:"14px"},tile:{border:"0.5px solid #b2b2b2",padding:"0 !important",marginBottom:6,"&:last-of-type":{marginBottom:0}},tileBar:{background:"#7f7f7f",height:"50px !important"}}));function Ln(e){const t=e.isCardModalOpen,a=e.chosenIssueReminder,n=e.setCardModalOpen,l=e.setIsOpenIssueReminderModal,i=e.setToResolve,c=e.setIsIandRUpdateNeeded,o=a.site_list,s=a.ts_posted,m=a.detail,d=a.issue_reporter,u=d.first_name,g=d.last_name,b=Fn(o,!1),E=ne()(s).format("DD MMMM YYYY, HH:mm");return r.a.createElement(qe.a,{open:t,maxWidth:"sm"},r.a.createElement(Ve.a,{style:{paddingBottom:8}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(In.a,{style:{paddingRight:8}})," ",b)),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,E),r.a.createElement(Ze.a,{style:{textIndent:40},align:"justify"},m),r.a.createElement(Ze.a,{align:"right",style:{marginBottom:0}},"".concat(u," ").concat(g))),r.a.createElement(et.a,{disableSpacing:!0},r.a.createElement(p.a,{onClick:()=>{n(!1),i(!1),l(!0),c(!0)},color:"primary"},"Edit"),r.a.createElement(p.a,{onClick:()=>{n(!1),i(!0),l(!0),c(!0)},color:"secondary"},"Resolve"),r.a.createElement(p.a,{onClick:()=>n(!1),color:"primary",autoFocus:!0},"Close")))}function Fn(e,t){let a=t?"GENERAL":"General";return 0!==e.length&&(a=e.join(", ")),a}var zn=function(e){const t=e.isOpenIssueReminderModal,a=e.setIsOpenIssueReminderModal,l=e.isIandRUpdateNeeded,i=e.setIsIandRUpdateNeeded,c=Pn(),s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],p=m[1],g=Object(n.useState)(!1),b=Object(o.a)(g,2),E=b[0],h=b[1],f=Object(n.useState)({site_list:[],site_id_list:null,ts_posted:null,detail:"",issue_reporter:{first_name:"",last_name:""}}),_=Object(o.a)(f,2),y=_[0],O=_[1],x=Object(n.useState)(!1),j=Object(o.a)(x,2),S=j[0],k=j[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],I=w[1];Object(n.useEffect)(()=>{var e;e=e=>{h(!1);let t=r.a.createElement(v.a,{component:"div",style:{fontStyle:"italic",width:"auto",height:0}},"No active issues");if(0!==e.length){const a=function(e){return e.map((e,t)=>{const a=[],n=[],r=[],l=null===e.ts_expiration;e.postings.forEach(e=>{const t=e.event_id,l=e.site_id,i=e.site;null!==l&&(a.push(l),n.push(i.site_code.toUpperCase()),r.push(t))});const i=0!==r.length;return Object(u.a)(Object(u.a)({},e),{},{site_id_list:a,site_list:n,site_events_list:r,is_event_entry:i,is_persistent:l})})}(e);t=function(e,t,a){return t.map((t,n)=>{const l=t.site_list,i=t.detail,c=t.issue_reporter,o=Fn(l);return r.a.createElement(kn.a,{key:"test ".concat(n+1),cols:2,className:e.tile},r.a.createElement(v.a,{className:e.previewText},i),r.a.createElement(Cn.a,{className:e.tileBar,title:o,subtitle:"".concat(c.first_name," ").concat(c.last_name),actionIcon:r.a.createElement(Pe.a,{title:"Expand card"},r.a.createElement(z.a,{"aria-label":"Expand",className:e.icon,onClick:a(t)},r.a.createElement(In.a,null)))}))})}(c,a,D),h(!0)}p(t)},nt(),at.on("receive_issues_and_reminders",t=>{const a=JSON.parse(t);e(a)})},[c]);const D=e=>t=>{O(e),k(!0)};return r.a.createElement(n.Fragment,null,r.a.createElement(wn.a,{component:"div",cellHeight:"auto",className:"".concat(c.gridList," ").concat(!E&&c.hasNoIssues)},d),r.a.createElement(Ln,{isCardModalOpen:S,setCardModalOpen:k,chosenIssueReminder:y,setToResolve:I,setIsOpenIssueReminderModal:a,setIsIandRUpdateNeeded:i}),r.a.createElement(Yn,{isOpen:t,isIandRUpdateNeeded:l,chosenIssueReminder:y,setIsIandRUpdateNeeded:i,toResolve:A,closeHandler:()=>{a(!1)}}))},Gn=a(745),Un=a(746),Wn=a(453),qn=a.n(Wn);var Vn=Object(It.a)(Object(d.a)(e=>({fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:1}})),Object(te.a)())((function(e){const t=e.classes,a=e.clickHandler,n=e.width;return r.a.createElement(Gn.a,{in:!0,unmountOnExit:!0,style:{transitionDelay:"100ms"}},r.a.createElement(Un.a,{color:"secondary","aria-label":"Add",className:t.fab,size:Object(te.c)("md",n)?"large":"medium",onClick:a},r.a.createElement(qn.a,null)))})),Qn=a(104),Zn=a.n(Qn),Kn=a(454),Jn=a.n(Kn);const Xn=Object(O.a)(e=>({summary:{minHeight:24},summaryContent:{marginBottom:6,marginTop:6},icon:{paddingTop:6,paddingBottom:6},details:{paddingTop:16}}));var $n=function(e){const t=e.shiftData,a=Xn(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],m=i[1];return Object(n.useEffect)(()=>{if(null!==t||"undefined"!==t){const e=t.filter(e=>ne()(e.ts)>ne()().subtract({hours:12})?e:null).slice(0,3);m(e)}},[t]),r.a.createElement(He.a,{defaultExpanded:!1},r.a.createElement(Be.a,{expandIcon:r.a.createElement(Zn.a,null),"aria-controls":"panel1c-content",id:"panel1c-header",className:a.summary,IconButtonProps:{className:a.icon},classes:{content:a.summaryContent}},r.a.createElement(y.a,{container:!0,justify:"space-between",alignItems:"baseline"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(v.a,{variant:"caption"},r.a.createElement("strong",null,"MONITORING SHIFT"))),c.length>0&&r.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"space-evenly"},r.a.createElement(v.a,{variant:"overline"},"MT - ",c[0].iompmt),r.a.createElement(v.a,{variant:"overline"},"CT - ",c[0].iompct)))),r.a.createElement(Ne.a,null),r.a.createElement(Re.a,null,r.a.createElement(y.a,{container:!0,justify:"space-evenly",className:a.details},c.length>0&&c.map(e=>r.a.createElement(y.a,{item:!0,xs:12,sm:4,key:e.ts},r.a.createElement(v.a,{variant:"subtitle2",align:"center"},r.a.createElement("strong",null,(e=>{const t=ne()(),a=ne()(e),n=ne()(e).add(12,"hours");return t>a&&a<=n?"Current":t.add(12,"hours")>a?"Next":t.add(24,"hours")>a?a.format("MMMM D, A (ddd)"):null})(e.ts))),r.a.createElement(v.a,{variant:"body2",align:"center"},e.iompmt," (MT)"),r.a.createElement(v.a,{variant:"body2",align:"center"},e.iompct," (CT)"))))),r.a.createElement(Ne.a,null),r.a.createElement(Ye.a,null,r.a.createElement(s.b,{to:"monitoring/shifts_and_reports/shifts",style:{textDecoration:"none"}},r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Jn.a,null)},"Go to Calendar"))))},er=a(747);function tr(e){const t=e.momsEntry,a=e.updateField,n=e.isAddingNewInstance,l=e.setIsNoneEntrySelected,i=e.location,c=e.site_code,o=t.moms,s=t.options,m=o.feature_type,d=null!==m&&"None"===m.label;return l(d),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Kt,{label:"Feature Type",options:s.feature_type,value:o.feature_type,changeHandler:a("feature_type"),placeholder:"Select feature type",renderDropdownIndicator:!0,openMenuOnClick:!0})),!d&&r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(Pe.a,{title:"Feature names are auto-generated. To add new MOMs feature name, choose (Add new instance)",placement:"top",interactive:!0},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Kt,{label:"Feature Name",options:s.feature_name.options,isDisabled:s.feature_name.disabled,value:o.feature_name,changeHandler:a("feature_name"),placeholder:s.feature_name.disabled?"Disabled":"Select feature name",renderDropdownIndicator:!0,openMenuOnClick:!0}))),n&&r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Location",multiline:!0,rowsMax:"2",placeholder:"Enter location of new instance",value:i,onChange:a("location"),fullWidth:!0,InputLabelProps:{shrink:!0}}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Kt,{label:"Alert Level",options:s.alert_level.options,isDisabled:s.alert_level.disabled,value:o.alert_level,changeHandler:a("alert_level"),placeholder:s.alert_level.disabled?"Disabled":"Select alert level",renderDropdownIndicator:!0,openMenuOnClick:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Observance Timestamp",value:o.observance_ts,onChange:a("observance_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Narrative",multiline:!0,rowsMax:"2",placeholder:"Enter report narrative",value:o.narrative,onChange:a("narrative"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(va,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:a("reporter"),value:o.reporter,isCommunityStaff:"true",site_code:c})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Remarks",multiline:!0,rowsMax:"2",placeholder:"Enter expert's remarks",value:o.remarks,onChange:a("remarks"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(va,{variant:"standard",label:"Validator",div_id:"validator",changeHandler:a("validator"),value:o.validator})))}var ar=function(e){const t=e.momsEntries,a=e.setMomsEntries,l=e.siteCode,i=e.site,c=e.setSite,s=e.selectSite,m="undefined"!==typeof s&&s,d=Object(n.useState)(!1),u=Object(o.a)(d,2),g=u[0],b=u[1],E=Object(n.useState)(!1),h=Object(o.a)(E,2),f=h[0],_=h[1],y=e=>t=>n=>{let r="";if("feature_name"===t&&("(Add new instance)"===n.label?b(!0):b(!1)),["feature_type","feature_name","alert_level","observance_ts"].includes(t))r=n;else if(["narrative","remarks","reporter","validator","location"].includes(t)){r=n.target.value}a({action:"UPDATE_DETAILS",key:e,attribute:t,value:r})},O=e=>()=>a({action:"DELETE_INSTANCE",key:e});return r.a.createElement(n.Fragment,null,m&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(Xt,{value:i,changeHandler:e=>c(e)})),!m||m&&null!==i?r.a.createElement(n.Fragment,null,r.a.createElement(wt.a,{utils:Ct.a},t.map((e,a)=>{const i=0===a,c=t.length===a+1;return r.a.createElement(n.Fragment,{key:a},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:i?12:0}},r.a.createElement(v.a,{variant:"subtitle2"},"Entry Number ",a+1),!i&&r.a.createElement(z.a,{"aria-label":"delete",color:"primary",onClick:O(a)},r.a.createElement(er.a,null))),r.a.createElement(tr,{momsEntry:e,updateField:y(a),isAddingNewInstance:g,setIsNoneEntrySelected:_,site_code:l}),!c&&r.a.createElement(Ne.a,{style:{margin:"24px 0 12px"},variant:"middle"}))})),!f&&r.a.createElement("div",{style:{margin:"16px 0",textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>a({action:"ADD_INSTANCE"})},"Add MOMs Observation"))):r.a.createElement("div",{style:{height:200}}))};const nr={moms:{feature_type:null,feature_name:null,alert_level:null,observance_ts:null,narrative:"",reporter:"",remarks:"",validator:"",location:""},options:{feature_type:[],feature_name:{options:[],disabled:!0},alert_level:{options:[],disabled:!0}}};function rr(e,t){const a=t.action,n=t.key,r=t.attribute,l=t.value,i=JSON.parse(JSON.stringify(e));switch(a){case"OVERWRITE":return[...l];case"ADD_INSTANCE":return[...e,JSON.parse(JSON.stringify(nr))];case"DELETE_INSTANCE":return i.splice(n,1),[...i];case"UPDATE_DETAILS":if(i[n].moms[r]=l,"feature_type"===r){const e=l.instances,t=l.alerts,a=e.map(e=>({value:e.instance_id,label:ie(e.feature_name)}));a.push({value:0,label:"(Add new instance)"});const r=t.map(e=>{const t=e.feature_alert_id,a=e.alert_level,n=e.description;return{value:l,feature_alert_id:t,label:a,description:n}}),c=i[n],o=c.moms,s=c.options;i[n].options=Object(u.a)(Object(u.a)({},s),{},{feature_name:{options:a,disabled:!1},alert_level:{options:r,disabled:!1}}),i[n].moms=Object(u.a)(Object(u.a)({},o),{},{feature_name:null,alert_level:null})}return[...i];default:return e}}const lr=Object(O.a)(e=>({form_message_style:{color:"red",fontStyle:"italic"}}));var ir=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.match,s=lr(),m=Object(n.useState)(null),d=Object(o.a)(m,2),g=d[0],b=d[1],E=Object(n.useState)(null),h=Object(o.a)(E,2),f=h[0],_=h[1],O=Object(n.useReducer)(rr,[]),x=Object(o.a)(O,2),j=x[0],C=x[1],w=Object(n.useState)(!1),A=Object(o.a)(w,2),I=A[0],M=A[1],N=Object(n.useState)(""),T=Object(o.a)(N,2),H=T[0],R=T[1];Object(n.useEffect)(()=>{if("undefined"!==typeof i){const e=i.params.site_code;_(e)}},[i]),Object(n.useEffect)(()=>{null!==g&&_(g.data.site_code)},[g]);const B=Object(c.b)(),Y=B.enqueueSnackbar,P=B.closeSnackbar,L=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{P(e)}},"Dismiss"),F=Object(n.useState)([]),z=Object(o.a)(F,2),G=z[0],U=z[1];return Object(n.useEffect)(()=>{null!==f&&function(e,t){const a="".concat(k,"/api/manifestations_of_movement/get_moms_features/").concat(e);S.a.get(a).then(e=>{const a=e.data;console.log("MOMs Features",a),t(a)}).catch(e=>{console.error(e)})}(f,e=>{const t=e.map(e=>{const t=e.feature_id,a=e.feature_type,n=e.instances,r=e.alerts;return{value:t,label:ie(a),instances:n,alerts:r}});U(Object(u.a)(Object(u.a)({},G),{},{feature_type:t}));const a=nr;a.options.feature_type=t;C({action:"OVERWRITE",value:[a]})})},[f]),Object(n.useEffect)(()=>{console.log(j);const e=function(e){let t=!1,a=!1,n=new Set;const r=[],l=[];let i,c="";return e.forEach((e,i)=>{const c=e.moms,o=c.alert_level,s=c.feature_type,m=c.narrative,d=c.observance_ts,u=c.remarks,p=c.reporter,g=c.validator;let b=c.feature_name,E=c.location;const h=ne()(d).format("YYYY-MM-DD HH:mm:00");if(null!==s){9===s.value&&(b="value")}if(null!==b){const e=b.value;r.includes(e)?!1===t&&(t=!0):r.push(e),0===e?void 0===E&&(E=""):E="value"}!0!==t&&"Invalid date"===h||(l.includes(h)?!1===a&&(a=!0):l.push(h)),null===s&&n.add("feature type"),null===b&&n.add("feature name"),""===E&&n.add("location"),null===o&&n.add("alert level"),null===d&&n.add("observance timestamp"),""===m&&n.add("narrative"),""===p&&n.add("reporter"),""===u&&n.add("remarks"),""===g&&n.add("validator")}),n=[...n],!1===t&&(a=!1),0!==n.length||!0===a?(i=!0,c="Please input ".concat(n.join(", ")," form(s). "),a&&(c+="Duplicate observance time for the same feature instance.")):i=!1,{button_state:i,form_messsage:c}}(j),t=e.button_state,a=e.form_messsage;M(t),R(a)},[j]),r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Insert Manifestation of Movement Form"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Provide manifestation of movement (MOMs) details to save information in our database."),r.a.createElement(ar,{momsEntries:j,setMomsEntries:C,siteCode:f,site:g,setSite:b,selectSite:!0})),r.a.createElement(et.a,null,r.a.createElement(y.a,{container:!0,spacing:0},r.a.createElement(y.a,{item:!0,xs:12,sm:8},r.a.createElement(v.a,{variant:"caption",display:"block",className:s.form_message_style,gutterBottom:!0,align:"left"},H)),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(p.a,{onClick:l,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:()=>{console.log("moms_entries",j);const e={moms_list:j.map(({moms:e},t)=>{const a=e.alert_level,n=e.feature_name,r=e.feature_type,l=e.narrative,i=e.observance_ts,c=e.remarks,o=e.reporter,s=e.validator,m=e.location,d=ne()(i).format("YYYY-MM-DD HH:mm:ss"),u=D(),p=r.label;let g="None",b=null;if("None"!==p){const e=n.value,t=n.label;g="(Add new instance)"===t?null:t,b=e}return{alert_level:a.label,instance_id:b,feature_name:g,feature_type:p,report_narrative:l,observance_ts:d,remarks:c,reporter_id:o,validator_id:s,location:m,iomp:u.user_id}}),site_code:f};console.log("PAYLOAD",e),l(),function(e,t,a){const n="".concat(k,"/api/manifestations_of_movement/write_monitoring_moms_to_db");console.log("moms_list",e),S.a.post(n,e).then(e=>{const a=e.data;null!==t&&(console.log("Moms Insert result",a),t(a))}).catch(e=>{console.log(e),null!==a&&a(e)})}(e,e=>{e.status?(lt("run_alert_generation",{site_code:f}),Y("MOMs input success!",{variant:"success",autoHideDuration:7e3,action:L})):Y(e.message,{variant:"error",autoHideDuration:7e3,action:L})},()=>{Y("Error MOMS input...",{variant:"error",autoHideDuration:7e3,action:L})})},color:"primary",disabled:I},"Submit")))))})),cr=a(748);function or(e){const t=e.clickHandler;return r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:t,startIcon:r.a.createElement(cr.a,null)},"Insert MOMs")}const sr=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)({},t.pageContentMargin),tabBarContent:{marginTop:30}})}),mr=[{label:"Monitoring Tables",href:"monitoring-tables"},{label:"Generated Alerts",href:"generated-alerts"}];var dr=Object(te.a)()((function(e){const t=e.width,a=e.history,l=sr(),i=Object(n.useState)(0),s=Object(o.a)(i,2),m=s[0],d=s[1],u=Object(n.useState)(null),g=Object(o.a)(u,2),b=g[0],E=g[1],h=Object(n.useState)([]),f=Object(o.a)(h,2),_=f[0],v=f[1],O=Object(n.useState)(null),x=Object(o.a)(O,2),j=x[0],S=x[1],k=Object(n.useState)(null),C=Object(o.a)(k,2),w=C[0],A=C[1],I=Object(n.useState)(!1),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useState)(!1),H=Object(o.a)(T,2),R=H[0],B=H[1],Y=Object(n.useState)(null),P=Object(o.a)(Y,2),L=P[0],F=P[1],z=Object(n.useState)(!1),G=Object(o.a)(z,2),U=G[0],W=G[1],q=Object(n.useState)(!1),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(!1),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=e=>()=>$(e),ae=Object(n.useContext)(ve).setIsReconnecting,ne=Object(c.b)(),re=ne.enqueueSnackbar,le=ne.closeSnackbar;Object(n.useEffect)(()=>{var e;return rt(ae),e=e=>E(e),nt(),at.on("receive_generated_alerts",t=>{const a=JSON.parse(t);console.log("Generated alerts: ",a),e(a)}),function(e){nt(),at.on("receive_candidate_alerts",t=>{const a=JSON.parse(t);console.log("Candidate alerts: ",a),e(a)})}(e=>S(e)),ct(e=>A(e)),_e(e=>v(e)),fe(),function(e){nt(),at.on("receive_ewi_insert_response",t=>{const a=JSON.parse(t);e(a)})}(e=>{const t=e.snackbar_key,a=e.message,n=e.status;le(t),re(a,{variant:n?"success":"error",autoHideDuration:7e3})}),function(){it(),ye()}},[]);const ie=(e,t)=>()=>{"is_open_release_modal"===e?N(t):"is_open_issues_modal"===e?(Z(!t),W(t)):"is_routine_modal_open"===e&&B(t)},ce=(e,t)=>()=>{F(e),"routine"===t?ie("is_routine_modal_open",!0)():ie("is_open_release_modal",!0)()},oe=Object(te.c)("md",t),se=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Add issue/reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:ie("is_open_issues_modal",!0),startIcon:r.a.createElement(ke.a,null)},"Add issue/reminder"),r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(or,{clickHandler:ee(!0)})),r.a.createElement(p.a,{"aria-label":"Release alert",variant:"contained",color:"primary",size:"small",onClick:ce(null),startIcon:r.a.createElement(Ce.a,null)},"Release Alert"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:l.pageContentMargin},r.a.createElement(we,{title:"Alert Monitoring | Dashboard",customButtons:!!oe&&se})),r.a.createElement("div",{className:l.tabBar},r.a.createElement(y.a,{container:!0,spacing:3},r.a.createElement(y.a,{item:!0,xs:12,md:3},r.a.createElement(zn,{isOpenIssueReminderModal:U,setIsOpenIssueReminderModal:W,isIandRUpdateNeeded:Q,setIsIandRUpdateNeeded:Z})),r.a.createElement(y.a,{item:!0,md:9},r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement($n,{shiftData:_})),r.a.createElement(Me,{chosenTab:m,onSelect:e=>{d(e)},tabsArray:mr}),r.a.createElement("div",{className:l.tabBarContent},0===m&&r.a.createElement(Ia,{width:t,candidateAlertsData:j,alertsFromDbData:w,releaseFormOpenHandler:ce,history:a}),1===m&&r.a.createElement(Ra,{generatedAlertsData:b}))))),!oe&&r.a.createElement(Vn,{clickHandler:ie("is_open_release_modal",!0)}),r.a.createElement(gn,{isOpen:M,closeHandler:ie("is_open_release_modal",!1),setChosenCandidateAlert:F,chosenCandidateAlert:L,alertsFromDbData:w,setIsOpenRoutineModal:(me=null,()=>{F(me),ie("is_open_release_modal",!1)(),ie("is_routine_modal_open",!0)()})}),r.a.createElement(Sn,{isOpen:R,closeHandler:ie("is_routine_modal_open",!1),chosenCandidateAlert:L,setChosenCandidateAlert:F}),r.a.createElement(ir,{isOpen:X,closeHandler:ee(!1)}));var me})),ur=a(59),pr=a.n(ur),gr=a(154),br=a(715),Er=a(210),hr=a(753),fr=a(757);const _r=Object(O.a)(e=>({timeline:{margin:"0 auto",lineColor:"#DDDDDD",paddingTop:24}}));function yr(e,t,a=!1){const n=e.moms_details,l=n.moms_instance,i=l.feature.feature_type,c=l.feature_name,o=n.op_trigger,s=n.validator,m=s.first_name,d=s.last_name,u=n.reporter,p=u.first_name,g=u.last_name,b=n.narrative.narrative,E=n.remarks,h=n.moms_id,f=a?"Non-triggering ":"";return r.a.createElement("ul",{key:h},r.a.createElement("li",null,f,"Feature: ",ie(i)," ",c," (",t+o,")"),r.a.createElement("ul",null,r.a.createElement("li",null,"Narrative: ",b),r.a.createElement("li",null,"Reporter: ","".concat(p," ").concat(g)),r.a.createElement("li",null,"Remarks: ",E),r.a.createElement("li",null,"Validator: ","".concat(m," ").concat(d))))}function vr(e,t,a,l){const i=[];let c=0;return e.forEach(e=>{c+=1;const o=e.item_timestamp,s=e.item_data,m=e.item_type;let d=null;const u=ne()(o).format("DD MMMM YYYY, hh:mm A");if("narrative"===m)d=r.a.createElement(Er.TimelineItem,{key:c,dateText:u,style:{color:"#969696"},dateComponent:r.a.createElement("div",{style:{display:"block",float:"right",padding:"10px",marginRight:38,background:"rgb(150, 150, 150)",color:"#fff"}},u)},r.a.createElement(v.a,{variant:"body2",component:"div"},s.narrative));else if("release"===m){const i=s.release_time,o=s.data_ts,m=s.release_publishers,g=s.triggers,b=s.is_onset,E=s.internal_alert_level,h=s.moms_releases,f=s.release_id,_=s.comments,O=e.release_type,x=function(e){let t="#F8991D";return"end_of_validity"===e?t="#00B200":"overdue"===e?t="#FA4413":"extended"===e?t="#00B200":"routine"===e&&(t="#59081E"),t}(O),j=function(e){let t="EARLY WARNING INFORMATION";return"end_of_validity"===e?t="END OF MONITORING":"overdue"===e?t="OVERDUE":"extended"===e?t="EXTENDED MONITORING":"routine"===e&&(t="ROUTINE MONITORING"),t}(O);let S=ne()(o);b||(S=S.add(30,"minutes")),S=S.format("MMMM Do YYYY, h:mm A");let k="",C="";m.forEach(e=>{const t=e.role,a=e.user_details,n=a.first_name,r=a.last_name;"mt"===t&&(k="".concat(n," ").concat(r)),"ct"===t&&(C="".concat(n," ").concat(r))}),d=r.a.createElement(Er.TimelineItem,{key:c,dateText:u,style:{color:x},dateInnerStyle:{background:x,lineHeight:"48px",textAlign:"center"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(hr.a,{style:{color:x,height:45,width:"auto",paddingRight:8}},r.a.createElement(We.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(v.a,{variant:"caption",component:"div",style:{color:x}},r.a.createElement("strong",null,j)),r.a.createElement(v.a,{variant:"h6",component:"div",style:{color:x,lineHeight:1.2}},r.a.createElement("strong",null,S)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(v.a,{variant:"body2",style:{color:x}},"Release Time: ",r.a.createElement("strong",null,i)),r.a.createElement(v.a,{variant:"body2",style:{color:x}},"Internal Alert Level: ",r.a.createElement("strong",null,E))),g.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",component:"div",style:{color:x}},r.a.createElement("strong",null,function(e){return r.a.createElement("ul",null,e.map(e=>{const t=e.ts,a=e.info,l=e.internal_sym,i=l.trigger_symbol,c=i.alert_symbol,o=i.trigger_hierarchy.trigger_source,s=l.alert_symbol,m=e.trigger_id,d="moms"===o?"Manifestation of Movement":ie(o),u=r.a.createElement("li",null,"".concat(d," (").concat(c,") alert triggered on ").concat(ne()(t).format("MMMM Do YYYY, hh:mm A"))),p=r.a.createElement("ul",null,r.a.createElement("li",null,a)),g=[];if("moms"===o){e.trigger_misc.moms_releases.forEach(e=>{const t=yr(e,s);g.push(t)})}else if("on demand"===o){e.trigger_misc.on_demand}return r.a.createElement(n.Fragment,{key:m},u,p,g.map(e=>e))}))}(g))))),h.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",component:"div",style:{color:x}},r.a.createElement("strong",null,h.map(e=>yr(e,"m",!0)))))),""!==_&&null!==_&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(v.a,{variant:"body2",style:{color:x}},"Comments: ",r.a.createElement("strong",null,_)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between",alignItems:"center"},r.a.createElement(v.a,{variant:"body2",style:{color:x}},k," | ",C),r.a.createElement(p.a,{"aria-label":"Show bulletin",variant:"text",color:"primary",size:"small",onClick:t({release_id:f,site_code:a,site_id:l})},"Bulletin"))))}else if("eos"===m){const e="#3f51b5";d=r.a.createElement(Er.TimelineItem,{key:c,dateText:u,style:{color:e},dateInnerStyle:{background:e,lineHeight:"48px"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(hr.a,{style:{color:e,height:45,width:"auto",paddingRight:8}},r.a.createElement(fr.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(v.a,{variant:"caption",component:"div",style:{color:e}},r.a.createElement("strong",null,"END-OF-SHIFT-ANALYSIS")),r.a.createElement(v.a,{variant:"h6",component:"div",style:{color:e,lineHeight:1.2}},r.a.createElement("strong",null,ne()(o).format("MMMM Do YYYY, h:mm A"))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",style:{color:e},dangerouslySetInnerHTML:{__html:s}}))))}i.push(d)}),i}var Or=function(e){const t=e.match.params.event_id,a=_r(),l=Object(n.useState)({event_id:t,site_code:"---",site_id:1,validity:ne()(),event_start:ne()(),site_address:"",status:1}),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],p=d[1],g=Object(n.useState)({}),b=Object(o.a)(g,2),E=b[0],h=b[1],f=Object(n.useState)(!1),_=Object(o.a)(f,2),O=_[0],x=_[1];Object(n.useEffect)(()=>{!function(e,t){const a=e.event_id,n="".concat(k,"/api/monitoring/get_event_timeline_data/").concat(a);S.a.get(n).then(e=>{const a=e.data;console.log("Event details",a),t(a)}).catch(e=>{console.error("Problem in getEventTimelineEntries Axios request"),console.error(e)})}({event_id:t},e=>{const t=e.event_details,a=e.timeline_items;Object.keys(t).length>0&&(s(t),p(a))})},[]);const j=1===c.status?"ROUTINE":"EVENT",C=ne()(c.event_start).format("MMMM Do YYYY, hh:mm A");let w="PRESENT";return null!==c.validity&&(w=ne()(c.validity).format("MMMM Do YYYY, hh:mm A")),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,j," MONITORING TIMELINE")),r.a.createElement(v.a,{variant:"h4",align:"center"},c.site_address," (",c.site_code.toUpperCase(),")"),r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"".concat(C," to ").concat(w))),r.a.createElement(Er.Timeline,{className:a.timeline,lineColor:"#DDDDDD"},vr(u,e=>t=>{console.log(e),h(e),x(!0)},c.site_code,c.site_id)),r.a.createElement(vt,{classes:a,isOpenBulletinModal:O,setIsOpenBulletinModal:x,releaseDetail:E}))},xr=a(166),jr=a.n(xr),Sr=a(126),kr=a.n(Sr);class Cr extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props,a=t.options,n=t.onSearch,r=a.onSearchChange;r&&r(e.target.value),n(e.target.value)},this.onKeyDown=e=>{const t=this.props,a=t.onHide,n=t.onSearchClick;27===e.keyCode?a():13===e.keyCode&&n()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(X.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(b.a,{placeholder:"Search events using YYYY-MM-DD format...",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(z.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(jr.a,null)),r.a.createElement(z.a,{className:t.clearIcon,onClick:n},r.a.createElement(kr.a,null))))}}var wr=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(Cr);const Ar=[],Ir=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(V.a)(e)),{},{eventTable:{minWidth:"900px"}}));const Dr=Object(gr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Mr=Object(te.a)()((function(e){const t=e.width,a=e.location,l=e.match.url,i=Ir(),c=Object(n.useState)([["Loading Data..."]]),d=Object(o.a)(c,2),p=d[0],g=d[1],b=Object(n.useState)(0),E=Object(o.a)(b,2),h=E[0],_=E[1],y=Object(n.useState)(10),O=Object(o.a)(y,2),j=O[0],C=O[1],w=Object(n.useState)(1),A=Object(o.a)(w,2),I=A[0],D=A[1],M=Object(n.useState)(!1),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)({}),B=Object(o.a)(R,2),Y=B[0],P=B[1],L=Object(n.useState)([]),F=Object(o.a)(L,2),z=F[0],G=F[1],U=Object(n.useState)([]),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=Object(n.useState)(""),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)(!1),$=Object(o.a)(X,2),ee=$[0],ae=$[1],re=Object(n.useContext)(ve).sites;Object(n.useEffect)(()=>{const e={};re.forEach(t=>{const a=le(t,!0,"start"),n=t.site_code.toUpperCase();Ar.push(n),e[n]={site_id:t.site_id,address:a}}),P(e)},[re]),Object(n.useEffect)(()=>{H(!0);!function(e,t){const a=e.limit,n=e.offset,r=e.include_count,l=e.filters,i=e.search_str;let c="".concat(k,"/api/monitoring/get_monitoring_events?filter_type=complete&offset=").concat(n,"&limit=").concat(a);if(r&&(c+="&include_count=true"),l.length>0){c+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(c+="&search=".concat(i)),S.a.get(c).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({include_count:!0,limit:h*j+j,offset:h*j,filters:z,search_str:K},e=>{const t=e.events,a=e.count,n=function(e,t){return e.map((e,a)=>{const n=e.event_id,r=e.site_code,l=e.entry_type,i=e.event_start,c=e.validity,o=e.public_alert;let s=null,m="ROUTINE";""!==i&&null!==i&&(s=ne()(i).format("D MMMM YYYY, HH:mm")),""!==c&&null!==c&&(m=ne()(c).format("D MMMM YYYY, HH:mm"));let d="";if(Object.keys(t).length){d=t[r.toUpperCase()].address}return[n,d,l,o,s,m]})}(t,Y);g(n),D(a),H(!1)})},[h,j,z,K,l,Y]);const ie={textLabels:{body:{noMatch:"No data"}},filterType:"multiselect",responsive:Object(te.c)(t,"xs")?"scroll":"scrollFullHeight",searchText:K,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:j,count:I,page:h,filter:!0,selectableRows:"none",print:!1,download:!1,serverSide:!0,onTableChange:(e,t)=>{if("changePage"===e){const e=t.page;_(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==j&&C(e)}else"resetFilters"===e?(V({}),G([])):"onSearchOpen"===e&&ae(!0)},onSearchChange:e=>{console.log("Searching for ".concat(e))},onFilterChange:(e,t)=>{const a=[];let n=!0;t.forEach((e,t)=>{let r=null;if(0!==e.length){n=!1;const l=ce[t].name;if("site_name"===l){const t=[],n=[];e.forEach(e=>{t.push(Y[e].site_id),n.push(e)}),a.push({name:"site_ids",data:t}),r=n}else if("entry_type"===l){const t=[],n=[];let l;e.forEach(e=>{"EVENT"===e?l=2:"ROUTINE"===e&&(l=1),t.push(e),n.push(l)}),a.push({name:"entry_types",data:n}),r=t}V(Object(u.a)(Object(u.a)({},q),{},{[l]:r}))}}),n&&V({}),G(a)},customSearchRender:(e,t,a,n)=>{let l=e||"";ee&&(l=K,ae(!1));return r.a.createElement(wr,{searchText:e,onSearch:t,onHide:()=>{a(),ae(!1)},options:n,onSearchClick:()=>J(l)})}},ce=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:(e,{rowIndex:t})=>"Loading Data..."===e?e:function(e,t){return r.a.createElement(s.b,{to:"".concat(e,"/").concat(t)},t)}(l,e)}},{name:"site_name",label:"Site",options:{filter:!0,filterList:"undefined"===typeof q.site_name?[]:q.site_name,filterOptions:{names:Ar}}},{name:"entry_type",label:"Entry Type",options:{filter:!0,filterList:"undefined"===typeof q.entry_type?[]:q.entry_type,filterOptions:{names:["ROUTINE","EVENT"]},sort:!1}},{name:"public_alert",label:"Last Alert Level",options:{filter:!0,sort:!0}},{name:"ts_start",label:"Event Start",options:{filter:!1,sort:!1}},{name:"ts_end",label:"Event End",options:{filter:!1,sort:!1}}];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(we,{title:"Alert Monitoring | Events"})),r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(m.d,{location:a},r.a.createElement(m.b,{exact:!0,path:l,render:e=>r.a.createElement(f.a,{className:i.paperContainer},r.a.createElement(br.a,{theme:Dr},r.a.createElement(pr.a,{title:r.a.createElement(v.a,{variant:"h5",component:"div"},"Monitoring Events Table",T&&r.a.createElement(x.a,{size:24,style:{marginLeft:15,position:"relative",top:4}})),data:p,columns:ce,options:ie})))}),r.a.createElement(m.b,{path:"".concat(l,"/:event_id"),render:e=>r.a.createElement(Or,Object.assign({},e,{width:t}))}))))})),Nr=a(765),Tr=a(764),Hr=a(758),Rr=a(759),Br=a(760),Yr=a(761),Pr=a(762),Lr=a(208),Fr=a.n(Lr);a(435);const zr={toolbar:[["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],["clean"]],clipboard:{matchVisual:!1}},Gr=["bold","italic","underline","strike","blockquote","list","bullet","indent","link"],Ur=Object(O.a)(e=>({root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}}}));function Wr(e){return Object.keys(e).filter(t=>!0===e[t])}function qr(e){const t=e.shiftSummary,a=e.dataAnalysis,n=e.shiftNarratives,r=t.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),l=a.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),i=n.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>");return"<p>".concat(r,"</p><br/><p>").concat(l,"</p><br/><p>").concat(i,"</p>")}var Vr=function(e){const t=e.data,a=e.shiftStartTs,l=e.currentUser,i=Ur(),s=t.site_code,m=t.eos_head,d=t.shift_start_info,g=t.shift_end_info,b=t.data_analysis,E=t.narratives,h=t.event_id,_=t.validity,O="".concat(m,"<br/>").concat(d,"<br/><br/>").concat(g),x=Object(n.useState)(O),j=Object(o.a)(x,2),C=j[0],w=j[1],A=Object(n.useState)(b),I=Object(o.a)(A,2),D=I[0],M=I[1],N=Object(n.useState)(b.length),T=Object(o.a)(N,2),H=T[0],R=T[1],B=Object(n.useState)(E),Y=Object(o.a)(B,2),P=Y[0],L=Y[1],F=Object(n.useState)(!1),z=Object(o.a)(F,2),G=z[0],U=z[1],W=Object(c.b)(),q=W.enqueueSnackbar,V=W.closeSnackbar,Q=Object(n.useState)([]),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X={rainfall:!1,surficial:!1},$=[["rainfall","Rainfall",!1]],ee=t.has_markers,te=t.has_surficial_data,ae=t.subsurface_columns;let re="Surficial",le=!1;ee?te||(re+=" (No data)",le=!0):(re+=" (No markers)",le=!0),$.push(["surficial",re,le]),ae.forEach(e=>{const t=e.logger.logger_name,a="subsurface_".concat(t);let n="Subsurface - ".concat(t.toUpperCase());X[a]=!1;const r=!e.has_data;r&&(n+=" (No data)"),$.push([a,n,r])});const ie=Object(n.useState)(X),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=$.map(e=>({state:oe[e[0]],value:e[0],label:e[1],is_disabled:e[2]}));!function(e,t,a=!1){const r=Object(n.useRef)();Object(n.useEffect)(()=>{r.current=e}),Object(n.useEffect)(()=>{const e=setInterval((function(){r.current()}),t);return a&&clearInterval(e),()=>clearInterval(e)},[t,a])}(()=>{var e,t;e={shift_ts:a,event_id:h,dataAnalysis:D},t=e=>{console.log("response",e)},de("".concat(k,"/api/end_of_shift/save_eos_data_analysis"),e,t)},1e4,G);const ue=ne()(a).add(12,"hours"),pe=ne()(_),ge=pe.isBefore(ue)?pe.subtract(30,"minutes").format("YYYY-MM-DD HH:mm:ss"):ne()(ue).format("YYYY-MM-DD HH:mm:ss"),be="".concat("http://dynaslope.phivolcs.dost.gov.ph","/chart_rendering/").concat(s,"/").concat(ge),Ee=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{V(e)}},"Dismiss"),he=e=>()=>{const t=K;t.pop(t[e]),J([...t])},fe=[{label:"Shift Summary",value:C,key:"shift_summary",updateFn:w},{label:"Data Analysis",value:D,key:"data_analysis",updateFn:M}],_e=H>1500;return r.a.createElement(He.a,null,r.a.createElement(Be.a,{expandIcon:r.a.createElement(Zn.a,null)},r.a.createElement("div",{className:i.column},r.a.createElement(v.a,{variant:"body1"},s.toUpperCase())),r.a.createElement("div",{className:i.column},r.a.createElement(v.a,{variant:"body1"},"Shift Report"))),r.a.createElement(Ne.a,null),r.a.createElement(Re.a,{className:i.details},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:12}},r.a.createElement(v.a,{variant:"body1"},r.a.createElement("strong",null,"Charts"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,justify:"space-around"},r.a.createElement(ia,{label:"Data Sources",changeHandler:e=>t=>{const a=t.target.checked;if(se(Object(u.a)(Object(u.a)({},oe),{},{[e]:a})),a){let t=e;["surficial","rainfall"].includes(e)||(t=e.replace("_","/")),window.open("".concat(be,"/").concat(t),"_blank")}},choices:me,checkboxStyle:"primary"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1"},r.a.createElement("strong",null,"Attachments"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{square:!0,style:{padding:"8px 12px",marginBottom:12,background:"gainsboro",border:"4px solid #CCCCCC"}},K.length>0?K.map((e,t)=>r.a.createElement(Yt.a,{key:t,label:e.name,onDelete:he(t),color:"primary"})):r.a.createElement(v.a,{variant:"body2"},r.a.createElement("i",null,"None")))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end"},r.a.createElement("input",{className:i.input,style:{display:"none"},multiple:!0,type:"file",onChange:e=>{const t=e.target.files;for(let a=0;a<t.length;a+=1)K.push(t.item(a));J([...K])},id:"raised-button-file"}),r.a.createElement("label",{htmlFor:"raised-button-file"},r.a.createElement(p.a,{startIcon:r.a.createElement(Hr.a,null),variant:"contained",component:"span",color:"primary",size:"small"},K.length>0?"Add more":"Attach File")))),fe.map(({label:e,value:t,key:a,updateFn:l})=>r.a.createElement(n.Fragment,{key:a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1"},r.a.createElement("strong",null,e))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Fr.a,{onChange:t=>{"Data Analysis"===e&&R(t.length),l(t)},defaultValue:t,modules:zr,formats:Gr})),"Data Analysis"===e&&r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",style:{color:_e?"red":"black"}},r.a.createElement(Pe.a,{title:"Content of text area is formatted on the background using HTML. HTML elements are included in the character count.",placement:"top",interactive:!0,arrow:!0},r.a.createElement("div",null,r.a.createElement(Rr.a,{color:"primary",fontSize:"small"}),"\xa0")),r.a.createElement(v.a,{variant:"caption"},r.a.createElement("strong",null,"Character count (including HTML): ",H,"/1500"))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1"},r.a.createElement("strong",null,"Shift Narratives ")),r.a.createElement(v.a,{variant:"body2"},r.a.createElement("i",null,"NOTE: It is recommended NOT to add narratives via this text box. Use Site Logs Form instead then click Refresh."))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Fr.a,{onChange:e=>L(e),value:P,defaultValue:P,modules:zr,formats:Gr,bounds:".app"})))),r.a.createElement(Ne.a,null),r.a.createElement(Ye.a,null,r.a.createElement(p.a,{size:"small",onClick:()=>{const e=Wr(oe),t={site_code:s,user_id:l.user_id,charts:e,file_name:"".concat(s,"_chart.pdf")};var a,n;a=t,n=e=>{const t=e.message,a=e.file_response,n=a.file_path,r=a.message;console.log("response",r),"success"===t?q("Charts Saved! Path: ".concat(n),{variant:"success",autoHideDuration:7e3,action:Ee}):q("Error saving charts...",{variant:"error",autoHideDuration:7e3,action:Ee})},de("".concat(k,"/api/end_of_shift/download_eos_charts"),a,n)},startIcon:r.a.createElement(Br.a,null)},"Download Charts"),r.a.createElement(p.a,{size:"small",startIcon:r.a.createElement(Yr.a,null),onClick:()=>{!function(e,t){const a=e.shift_ts,n=e.event_id,r="".concat(k,"/api/end_of_shift/get_narrative/").concat(a,"/").concat(n);S.a.get(r).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({shift_ts:a,event_id:h},e=>{console.log(e),L(e)})}},"Refresh Narratives"),r.a.createElement(p.a,{size:"small",color:"primary",startIcon:r.a.createElement(Pr.a,null),onClick:()=>{const e=q("Sending End-of-Shift Report...",{variant:"warning",persist:!0}),t=new FormData,n=ne()(ge).add(30,"minutes").format("YYYY-MM-DD HH:mm:ss");Wr(oe).forEach(e=>t.append("charts",e)),K.forEach(e=>{t.append("attached_files",e)});const r={shift_ts:a,event_id:h,data_analysis:D,file_name_ts:n,mail_body:qr({shiftSummary:C,dataAnalysis:D,shiftNarratives:P}),site_code:s,user_id:l.user_id};for(const a in r)r.hasOwnProperty(a)&&t.append(a,r[a]);var i,c,o;i=t,c=t=>{V(e),console.log(t);let a="Error sending End-of-Shift Report...",n="error";"Success"===t&&(a="End-of-Shift Report Sent!",n="success"),q(a,{variant:n,autoHideDuration:7e3,action:Ee})},o=()=>{V(e),q("Error sending End-of-Shift Report...",{variant:"error",autoHideDuration:7e3,action:Ee})},de("".concat(k,"/api/mailbox/send_eos_email"),i,c,o),U(!0)},disabled:_e},"Send")))},Qr=a(763);function Zr(e){const t=e.selectedSites,a=e.setSelectedSites,n=e.site_code,r=e.checkAll,l=t;if(l.includes(n)){if(!r){const e=l.indexOf(n);l.splice(e,1)}}else l.push(n);a([...l])}var Kr=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.eosData,c=e.setSelectedEosData,s=e.setModalOpen,m=e.setEosData,d=Object(n.useState)([]),u=Object(o.a)(d,2),g=u[0],b=u[1],E=Object(n.useState)(!0),h=Object(o.a)(E,2),f=h[0],_=h[1],O=e=>t=>{Zr({selectedSites:g,setSelectedSites:b,site_code:e})},j=null!==i&&0===i.length;return r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Generate End-of-Shift Report"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Select sites to create end-of-shift report."),null===i&&r.a.createElement(x.a,{style:{position:"absolute",left:"50%",top:"50%"}}),!0===j&&r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"No active sites."),null!==i&&r.a.createElement(y.a,{container:!0,alignItems:"baseline"},r.a.createElement(z.a,{onClick:()=>{i.forEach(e=>{const t=e.site_code;Zr({selectedSites:g,setSelectedSites:b,site_code:t,checkAll:f})}),_(!f)},style:{marginRight:6},"aria-label":"Select all"},r.a.createElement(Qr.a,null)),i.map(e=>{const t=e.site_code,a=e.event_id,n=g.includes(t),l=t.toUpperCase();return r.a.createElement(Ke.a,{key:a},r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{key:a,onChange:O(t),value:t,color:"primary",checked:n}),label:l}))}))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:()=>{l(),m(null)},color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:()=>{const e=i.filter(e=>g.includes(e.site_code));c(e),s(!1)},color:"primary"},"Submit"))))}));const Jr=Object(O.a)(e=>({inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},expansionPanelsGroup:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"24px 0"},marginTop:16},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},hidden:{display:"none !important"}})),Xr=()=>r.a.createElement(Te.a,{height:150,width:700,speed:.5,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}));function $r(e,t,a){const n="am"===t?"07:30:00":"19:30:00",r=ne()(e).format("YYYY-MM-DD ".concat(n));return function(e,t){const a=e.shift_start,n="".concat(k,"/api/end_of_shift/get_end_of_shift_reports/").concat(a);S.a.get(n).then(e=>{const a=e.data;console.log("EOS Data",a),t(a)}).catch(e=>{console.error("Problem in Axios request"),console.error(e)})}({shift_start:r},e=>{a(e)}),r}function el(e){const t=e.isStart;let a="No event report to generate";return"undefined"!==t&&t&&(a="Generate end-of-shift reports here"),r.a.createElement(f.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var tl=Object(te.a)()((function(e){const t=e.width,a=e.hidden,l=Jr(),i=ne()(),c=i.hour(),s=Object(n.useState)(i.format("YYYY-MM-DD")),m=Object(o.a)(s,2),d=m[0],u=m[1],g=Object(n.useState)(c>=10&&c<=22?"am":"pm"),b=Object(o.a)(g,2),E=b[0],h=b[1],_=Object(n.useState)(!1),v=Object(o.a)(_,2),O=v[0],x=(v[1],Object(n.useState)(null)),j=Object(o.a)(x,2),S=j[0],k=j[1],C=Object(n.useState)(null),w=Object(o.a)(C,2),A=w[0],I=w[1],M=Object(n.useState)(null),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)(!1),B=Object(o.a)(R,2),Y=B[0],P=B[1],L=D(),F=e=>{u(e)};return r.a.createElement("div",{className:a?l.hidden:""},r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:4,style:{display:a?"none !important":""}},[{label:"Shift Start",value:d,id:"start_ts"}].map(e=>{const t=e.id;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t,className:l.inputGridContainer},function({label:e,value:t,id:a},n){return r.a.createElement(Tr.b,{required:!0,autoOk:!0,label:e,value:t,onChange:n,ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,variant:"dialog",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,F))}),r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(ba,{div_id:"shift_time",label:"Shift Time",changeHandler:e=>h(e.target.value),value:E,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,className:"".concat(l.inputGridContainer," ").concat(l.buttonGrid)},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(te.b)("sm",t)?"small":"medium",onClick:(G="site_list",e=>{if("generate_report"===G)P(!1);else{P(!0);const e=$r(d,E,k);H(e)}})},"Generate ",r.a.createElement(Nr.a,{className:l.button}))))),r.a.createElement("div",{className:l.expansionPanelsGroup},null===A&&!O&&r.a.createElement(el,{isStart:!0}),O?r.a.createElement(Xr,null):r.a.createElement(f.a,null,null!==A&&(A.length>0?A.map((e,t)=>r.a.createElement(Vr,{data:e,key:t,shiftStartTs:T,currentUser:L})):r.a.createElement(el,null)))),r.a.createElement(Kr,{isOpen:Y,closeHandler:(z=!1,()=>P(z)),eosData:S,setSelectedEosData:I,setModalOpen:P,setEosData:k}));var z,G})),al=a(766),nl=a(455),rl=a.n(nl),ll=a(265),il=a(342);a(674);function cl({event:e}){const t=Object(n.useState)(null),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Boolean(l),s=c?"simple-popover":void 0;return r.a.createElement("div",{style:{width:"inherit "}},r.a.createElement("div",{"aria-describedby":s,onClick:e=>{i(e.currentTarget)},role:"button",tabIndex:"0"},e.title),r.a.createElement(ll.a,{id:s,open:c,anchorEl:l,onClose:()=>{i(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(v.a,{variant:"body1",style:{padding:8}},e.title)))}var ol=r.a.memo((function(e){const t=Object(il.b)(ne.a),a=Object(n.useState)([]),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),d=m[0],u=m[1],p=Object(n.useState)([]),g=Object(o.a)(p,2),b=g[0],E=g[1];Object(n.useEffect)(()=>(_e(e=>c(e)),fe(),function(){ye()}),[]),Object(n.useEffect)(()=>{null===i&&"undefined"===i||u(i)},[i]),Object(n.useEffect)(()=>{const e=d.flatMap(e=>{const t=ne()(e.ts),a=ne()(e.ts),n=t.hours()>19?"PM":"AM";let r=a.add(12,"hours");return"PM"===n&&(r=t.set({h:23,m:59})),[{title:"".concat(e.iompmt," (MT - ").concat(n,")"),start:t,end:r},{title:"".concat(e.iompct," (CT - ").concat(n,")"),start:t,end:r}]});E(e)},[d]);const h=ne()();return r.a.createElement("div",{style:{height:850,width:"-webkit-fill-available"}},r.a.createElement(v.a,{variant:"subtitle2",align:"center"},r.a.createElement("i",null,"Note: The border color of the bordered box specifies the current monitoring shift.")),r.a.createElement(il.a,{events:b,localizer:t,defaultDate:new Date,eventPropGetter:(e,t,a)=>{let n="#E5DE44",r="black";return ne()(t).hours()>19&&(n="#053752",r="white"),{className:"",style:{color:r,borderRadius:5,border:"none",fontSize:12,backgroundColor:n}}},defaultView:"month",dayPropGetter:e=>{const t=h.hours(),a=ne()(e),n=h.clone().subtract(1,"day"),r=t<8&&n.isSame(a,"day"),l=t>8&&a.isSame(h,"day");if(r||l){return{className:"current-shift",style:{border:"dashed 5px ".concat(t>=8&&t<20?"#E5DE44":"#053752")}}}return{}},views:["month"],components:{event:cl},popup:!0}))}));const sl=Object(O.a)(e=>{const t=Object(V.a)(e);return{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),selects:{width:"auto",[e.breakpoints.up("md")]:{width:"-webkit-fill-available"}},link:{textDecoration:"none"},valueFont:{color:"black",textDecoration:"none"},hidden:{display:"none !important"}}});function ml(e,t){return t.map((t,a)=>{const n=t.date,l=t.data,i=t.ampm,c=t.mt,o=t.ct,m=rl.a.toWords(l.length),d="".concat(ie(m)," (").concat(l.length,")"),u=l.map((t,a)=>{const n=t.general_status,l=t.site_code,i=t.public_alert_level,c=t.event_id,o=t.internal_alert,m=function(e,t,a){return r.a.createElement(s.b,{className:e.link,to:"/monitoring/events/".concat(t),target:"_blank"},a.toUpperCase())}(e,c,l);return r.a.createElement(y.a,{container:!0,justify:"space-evenly",direction:"column",item:!0,xs:4,key:"site_alert_".concat(a+1)},r.a.createElement(v.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},m)),r.a.createElement(v.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},"Alert ",i," (",o,")")),r.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center"},"Monitoring status: ",r.a.createElement("span",{className:e.valueFont},ie(n))))});return r.a.createElement(He.a,{key:"monitoring_date_".concat(a+1)},r.a.createElement(Be.a,{expandIcon:r.a.createElement(Zn.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{color:"textSecondary",align:"center"},"Shift Date: ",r.a.createElement("span",{className:e.valueFont},ne()(n).format("MMMM D, YYYY")))),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{color:"textSecondary",align:"center"},"Sites Monitored: ",r.a.createElement("span",{className:e.valueFont},d))),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{color:"textSecondary",align:"center"},"Shift Schedule: ",r.a.createElement("span",{className:e.valueFont},i))))),r.a.createElement(Ne.a,null),r.a.createElement(Re.a,null,r.a.createElement(y.a,{container:!0,spacing:2,className:e.def_padding},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"Shift Schedule"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},i)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"MT Personnel"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},c)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(v.a,{variant:"body1",color:"textSecondary",align:"center"},"CT Personnel"),r.a.createElement(v.a,{variant:"body1",color:"textPrimary",align:"center"},o)),r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20}},r.a.createElement(Ne.a,null)),u)),r.a.createElement(Ne.a,null))})}var dl=Object(te.a)()((function(e){const t=e.hidden,a=e.width,l=e.defaultCalendarOpen,i=sl(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],d=s[1],u=Object(n.useState)(null),g=Object(o.a)(u,2),b=g[0],E=g[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),O=_[0],x=_[1],j=Object(n.useState)({}),S=Object(o.a)(j,2),C=S[0],w=S[1],A=Object(n.useState)(""),I=Object(o.a)(A,2),D=I[0],M=I[1];Object(n.useEffect)(()=>{w({ts_start:ne()(m).format("YYYY-MM-DD HH:mm:ss"),ts_end:ne()(b).format("YYYY-MM-DD HH:mm:ss"),user_id:O})},[m,b,O]);const N=e=>t=>{switch(e){case"ts_start":d(t);break;case"ts_end":E(t)}};return r.a.createElement("div",{className:t?i.hidden:""},r.a.createElement(He.a,{defaultExpanded:l},r.a.createElement(Be.a,{expandIcon:r.a.createElement(Zn.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},r.a.createElement(v.a,{variant:"body1",component:y.a,container:!0},r.a.createElement(al.a,{style:{marginRight:8}})," ",r.a.createElement("div",null,r.a.createElement("strong",null,"MONITORING SHIFTS CALENDAR")))),r.a.createElement(Ne.a,null),r.a.createElement(Re.a,null,r.a.createElement(ol,null))),r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(f.a,{component:y.a,container:!0,spacing:2,style:{marginTop:16,marginBottom:16,padding:8},alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6"},r.a.createElement("strong",null,"MONITORING SHIFT CHECKER")),r.a.createElement(v.a,{variant:"subtitle2"},r.a.createElement("i",null,"Note: The checker currently shows event and extended releases only. Routine releases are NOT yet reflected."))),r.a.createElement(y.a,{container:!0,spacing:2,item:!0,xs:12,sm:10},[{label:"Start Timestamp",value:m,id:"ts_start"},{label:"End Timestamp",value:b,id:"ts_end"}].map(e=>r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,key:e.id},function({label:e,value:t,id:a},n){return r.a.createElement(At.a,{required:!0,autoOk:!0,label:e,value:t,onChange:n(a),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0,inputVariant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,N))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4},r.a.createElement(va,{label:"Staff Name",div_id:"user_id",changeHandler:(T="user_id",e=>{const t=e.target.value;switch(T){case"user_id":x(t)}}),value:O,css:i.selects,variant:"outlined"}))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,container:!0,justify:"center"},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:Object(te.b)("sm",a)?"small":"medium",onClick:()=>{var e,t;e=C,t=e=>{const t=ml(i,e);M(r.a.createElement(v.a,{style:{fontStyle:"italic"}},"No shift data")),t.length>0&&M(t)},de("".concat(k,"/api/shift_checker/get_shift_data"),e,t)},endIcon:r.a.createElement(Nr.a,null)},"Generate"))),r.a.createElement(y.a,{item:!0,sm:12},D)));var T}));const ul=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})}),pl=[{label:"End-of-Shift Report Generator",href:"report_generator"},{label:"Monitoring Shifts",href:"shifts"}];Object(n.createContext)();var gl=function(e){const t=e.history,a=e.match.url,l=e.location.pathname,i=Object(n.useState)(0),c=Object(o.a)(i,2),s=c[0],d=c[1],u=ul(),p=Object(n.useState)(!1),g=Object(o.a)(p,2),b=g[0],E=g[1];return Object(n.useEffect)(()=>{const e=Object(m.f)(l,{path:"".concat(a,"/:tab"),exact:!0});if(e){const t=e.params.tab,a=pl.findIndex(e=>e.href===t);d(a),1===a&&E(!0)}},[a]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:u.pageContentMargin},r.a.createElement(we,{title:"Alert Monitoring | Shifts & Reports"})),r.a.createElement("div",{className:u.tabBar},r.a.createElement(Me,{chosenTab:s,onSelect:e=>{d(e),t.push("".concat(a,"/").concat(pl[e].href))},tabsArray:pl})),r.a.createElement("div",{className:"".concat(u.pageContentMargin," ").concat(u.tabBarContent)},r.a.createElement(tl,{hidden:0!==s}),r.a.createElement(dl,{hidden:1!==s,defaultCalendarOpen:b})))},bl=a(754),El=a(767),hl=a(768);class fl extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(X.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(b.a,{placeholder:"Type words to search narrative column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(z.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(jr.a,null)),r.a.createElement(z.a,{className:t.clearIcon,onClick:n},r.a.createElement(kr.a,null))))}}var _l=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(fl);function yl(e,t,a=null){S.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}const vl=Object(O.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}));var Ol=function(e){const t=vl(),a=e.narrativeData,n=e.setNarrativeData,l=e.siteList,i=e.setSiteList,c=e.isFromSiteLogs,o=a.narrative,s=a.timestamp,m=a.user_id,d=e=>t=>{n(Object(u.a)(Object(u.a)({},a),{},{[e]:t}))},p=e=>t=>{const r=t.target.value;n(Object(u.a)(Object(u.a)({},a),{},{[e]:r}))};return r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Xt,{value:l,changeHandler:e=>{i(e)},isMulti:!0,isFromSiteLogs:c})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Tr.a,{required:!0,autoOk:!0,label:"Date",value:s,onChange:d("timestamp"),ampm:!1,placeholder:"2020-01-01",format:"YYYY-MM-DD",mask:"____-__-__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Ya.b,{required:!0,autoOk:!0,label:"Time",value:s,onChange:d("timestamp"),ampm:!1,placeholder:"00:00",format:"HH:mm",mask:"__:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:t.inputGridContainer},r.a.createElement(va,{variant:"standard",label:"Reporter",div_id:"user_id",changeHandler:p("user_id"),value:m,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"standard-multiline-static",label:"Narrative",value:o,onChange:p("narrative"),placeholder:"Enter narrative",multiline:!0,rows:"4",rowsMax:4,fullWidth:!0,className:t.textField,variant:"filled"}))))};var xl=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setIsUpdateNeeded,s=e.chosenNarrative,m=e.isEditMode,d=e.isFromSiteLogs,u=e.setSort,g=e.resetInput,b=Object(c.b)(),E=b.enqueueSnackbar,h=b.closeSnackbar,f=D(),_={narrative_id:null,timestamp:ne()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:f.user_id,event_id:null,type_id:1},y=Object(n.useState)(null),v=Object(o.a)(y,2),O=v[0],x=v[1],j=Object(n.useState)(_),S=Object(o.a)(j,2),C=S[0],w=S[1],A=Object(n.useState)(!0),I=Object(o.a)(A,2),M=I[0],N=I[1],T=Object(n.useContext)(ve).sites,H=(R=!0,T.map(e=>{const t=e.site_code,a=e.site_id;let n=t.toUpperCase();return R&&(n=le(e,!0,"start")),{value:a,label:n,data:e}}));var R;Object(n.useEffect)(()=>{let e={};if(0!==Object.keys(s).length){const t=s.id,a=s.narrative,n=s.timestamp,r=s.site_id,l=s.user_id,i=s.event_id,c=s.type_id,o=H.filter(e=>e.value===r);delete o.data,x([...o]),e={narrative_id:t,timestamp:n,narrative:a,user_id:l,event_id:i,type_id:c},w(e)}},[s]),Object(n.useEffect)(()=>{const e=""===C.narrative||null===O;N(e)},[C,O]);const B=()=>{w({narrative_id:null,narrative:"",user_id:f.user_id,event_id:"",type_id:1}),x(O)},Y=()=>{w({narrative_id:null,timestamp:ne()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:f.user_id,event_id:"",type_id:1}),x(null)},P=()=>{l(),Y()};return r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Site Logs Form"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Note: Only monitoring-related narratives can be entered in this form. Please use other forms dedicated to its purposes."),r.a.createElement(Ol,{narrativeData:C,setNarrativeData:w,siteList:O,setSiteList:x,isFromSiteLogs:d})),r.a.createElement(et.a,null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:P,color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:Y},"Reset"),r.a.createElement(p.a,{variant:"contained",color:"primary",onClick:()=>{N(!0);const e=E("Inserting site log...",{variant:"warning",persist:!0}),t=[];var a;O.forEach(({value:e})=>{t.push(e)}),C.site_list=t,C.timestamp=ne()(C.timestamp).format("YYYY-MM-DD HH:mm:ss"),C.user_id=f.user_id,a=t=>{console.log("ret",t),B(),h(e),E("Site log inserted successfully!",{variant:"success",autoHideDuration:3e3}),u({order_by:"id",order:"desc"}),g(),i(!0),m&&P()},yl(C,"".concat(k,"/api/narratives/write_narratives_to_db"),a)},disabled:M},m?"Save Edits":"Save & Add More")))))}));var jl=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,n=e.closeHandler,l=e.chosenNarrative,i=e.setIsUpdateNeeded,c=l.id,o=l.narrative;return r.a.createElement("div",null,r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Site Logs Delete"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Are you sure you want to delete this narrative?"),r.a.createElement(Ze.a,{align:"center"},'"'.concat(o,'"'))),r.a.createElement(et.a,null,r.a.createElement("div",null,r.a.createElement(p.a,{onClick:n,color:"primary"},"Cancel"),r.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:()=>{n();var e;e=e=>{console.log("ret",e),i(!0)},yl({narrative_id:c},"".concat(k,"/api/narratives/delete_narratives_from_db"),e)},disabled:!1},"Confirm")))))}));const Sl=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(u.a)(Object(u.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}})})}),kl=Object(gr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Cl=Object(te.a)()((function(e){const t=e.width,a=Sl(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(0),d=Object(o.a)(m,2),g=d[0],b=d[1],E=Object(n.useState)(10),h=Object(o.a)(E,2),_=h[0],y=h[1],v=Object(n.useState)(0),O=Object(o.a)(v,2),x=O[0],j=O[1],C=Object(n.useState)([]),w=Object(o.a)(C,2),A=w[0],I=w[1],D=Object(n.useState)([]),M=Object(o.a)(D,2),N=M[0],T=M[1],H=Object(n.useState)(""),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(n.useState)({order_by:"timestamp",order:"desc"}),L=Object(o.a)(P,2),F=L[0],G=L[1],W=Object(n.useState)(!0),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=Object(n.useState)(!1),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),ae=ee[0],re=ee[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=Object(n.useState)({}),de=Object(o.a)(me,2),ue=de[0],pe=de[1],ge=Object(n.useState)(!0),be=Object(o.a)(ge,2),Ee=be[0],he=be[1],fe=Object(n.useState)(null),_e=Object(o.a)(fe,2),ye=_e[0],Oe=_e[1],xe=Object(n.useContext)(ve).setIsReconnecting,je=Object(n.useContext)(ve).sites,Se=[],Ae={};je.forEach(e=>{const t=e.site_code.toUpperCase();Se.push(t),Ae[t]=e.site_id}),Object(n.useEffect)(()=>(rt(xe),ct(e=>Oe(e)),function(){it()}),[]),Object(n.useEffect)(()=>{if(Ee){Q(!0);!function(e,t){const a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.order_by,o=e.order;let s="".concat(k,"/api/narratives/get_narratives?limit=").concat(n,"&offset=").concat(r);if(s+="&order_by=".concat(c,"&order=").concat(o),a&&(s+="&include_count=true"),0!==l.length){s+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(s+="&search=".concat(i)),S.a.get(s).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(Object(u.a)({include_count:!0,limit:_,offset:g*_,filters:A,search_str:B},F),e=>{const t=e.narratives,a=e.count,n=t.map(e=>{const t=e.narrative,a=e.user_details,n=e.site_id,r=e.user_id,l=e.id,i=e.type_id,c=e.event_id,o=e.timestamp;let s="---";if(null!==a){const e=a.last_name,t=a.first_name;s="".concat(t," ").concat(e)}return{narrative:t,user_details:s,site_name:le(e.site,!0,"start"),timestamp:o,type:e.type_id,actions:"---",site_id:n,user_id:r,id:l,type_id:i,event_id:c}});s(n),j(a),Q(!1)}),he(!1)}},[g,_,A,B,F,Ee]);const Ie=(e=!1)=>{b(0),e||I([]),Y("")},De=(e,t)=>()=>{"is_narrative_modal_open"===e?(X(!J),se(!1)):"is_open_delete_modal"===e&&re(!ae)},Me={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(te.c)(t,"xs")?"scroll":"scrollFullHeight",serverSide:!0,searchText:B,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:x,page:g,onTableChange(e,t){if("changePage"===e){const e=t.page;b(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==_&&y(e)}else"resetFilters"===e&&(T({}),I([]));["changePage","changeRowsPerPage","resetFilters"].includes(e)&&he(!0)},onColumnSortChange(e,t){G({order_by:e,order:"ascending"===t?"asc":"desc"}),he(!0)},onFilterChange(e,t){const a=[];let n=!0;t.forEach((e,t)=>{if(0!==e.length){n=!1;const r=Ne[t].name;if("site_name"===r){const t=[],n=[];e.forEach(e=>{t.push(Ae[e]),n.push(e)}),a.push({name:"site_ids",data:t}),T(Object(u.a)(Object(u.a)({},N),{},{[r]:n}))}}}),n&&T({}),I(a),he(!0)},customSearchRender:(e,t,a,n)=>{const l=e||"";return r.a.createElement(_l,{searchText:e,onSearch:t,onHide:()=>{a(),Y(""),he(!0)},options:n,onSearchClick:()=>{Ie(!0),Y(l),he(!0)}})}},Ne=[{name:"id",label:"Log ID",options:{filter:!1,display:!1,sort:!0}},{name:"timestamp",label:"Timestamp",options:{filter:!1,sort:!0,sortDirection:"timestamp"===F.order_by?F.order:"none",customBodyRender:e=>ne()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"site_name",label:"Site",options:{display:"true",filter:!0,filterType:"custom",filterList:"undefined"===typeof N.site_name?[]:N.site_name,filterOptions:{fullWidth:!0,logic:(e,t)=>!!t.length&&!t.includes(e),display(e,t,n,l){const i=ye.latest,c=ye.extended,o=[...i,...ye.overdue];return r.a.createElement(Ke.a,null,r.a.createElement(pa.a,null,"Site"),r.a.createElement(ga.a,{multiple:!0,value:e[n],renderValue:e=>e.join(", "),onChange:a=>{e[n]=a.target.value,t(e[n],n,l)}},Se.map(t=>{const l=t.toLowerCase(),i=o.find(e=>e.event.site.site_code===l),s=c.find(e=>e.event.site.site_code===l);let m=a.alert0;i&&(m=a.alert3),s&&(m=a.extended);const d=i||s?r.a.createElement(_n.a,null,r.a.createElement(ke.a,null)):"";return r.a.createElement(U.a,{key:t,value:t,className:m},r.a.createElement(kt.a,{color:"primary",checked:e[n].indexOf(t)>-1}),r.a.createElement(fn.a,{primary:t}),d)})))}},sort:!1}},{name:"narrative",label:"Narrative",options:{filter:!1,sort:!1}},{name:"type",label:"Type",options:{filter:!0}},{name:"user_details",label:"Reporter",options:{filter:!1}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,{rowIndex:t})=>function(e,t){const a=t.setChosenNarrative,n=t.setIsOpenNarrativeModal,l=t.setIsOpenDeleteModal,i=t.setIsEditMode;return r.a.createElement("span",null,r.a.createElement(z.a,{tooltip:"Edit",style:{float:"left"},onClick:t=>{a(e),n(!0),i(!0)}},r.a.createElement(El.a,{style:{fontSize:20}})),r.a.createElement(z.a,{tooltip:"Delete",style:{float:"left"},onClick:t=>{a(e),l(!0)}},r.a.createElement(hl.a,{style:{fontSize:20}})))}(c[t],{setChosenNarrative:pe,setIsOpenNarrativeModal:X,isOpenNarrativeModal:J,setIsOpenDeleteModal:re,isOpenDeleteModal:ae,setIsEditMode:se,isEditMode:oe})}}],Te=Object(te.c)("md",t),He=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Write a site log",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:De("is_narrative_modal_open")},r.a.createElement(Ce.a,{style:{paddingRight:4,fontSize:20}}),"Write a Site Log"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(we,{title:"Alert Monitoring | Site Logs",customButtons:!!Te&&He})),r.a.createElement(qe.a,{open:V,fullWidth:!0},r.a.createElement(Qe.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(bl.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(f.a,{className:a.paperContainer},r.a.createElement(br.a,{theme:kl},r.a.createElement(pr.a,{title:"Site Logs",data:c,columns:Ne,options:Me})))),r.a.createElement(xl,{isOpen:J,closeHandler:De("is_narrative_modal_open"),setIsUpdateNeeded:he,chosenNarrative:ue,isFromSiteLogs:ye,isEditMode:oe,setSort:G,resetInput:Ie}),r.a.createElement(jl,{isOpen:ae,closeHandler:De("is_open_delete_modal"),chosenNarrative:ue,setIsUpdateNeeded:he}))}));class wl extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(X.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(b.a,{placeholder:"Type words to search details column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(z.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(jr.a,null)),r.a.createElement(z.a,{className:t.clearIcon,onClick:n},r.a.createElement(kr.a,null))))}}var Al=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(wl);const Il={},Dl=Object(O.a)(e=>Object(u.a)(Object(u.a)({},Object(V.a)(e)),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8}})),Ml=Object(gr.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Nl=Object(te.a)()((function(e){const t=e.width,a=Dl(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(0),d=Object(o.a)(m,2),g=d[0],b=d[1],E=Object(n.useState)(5),h=Object(o.a)(E,2),_=h[0],y=h[1],v=Object(n.useState)(0),O=Object(o.a)(v,2),x=O[0],j=O[1],C=Object(n.useState)([]),w=Object(o.a)(C,2),A=w[0],I=w[1],D=Object(n.useState)([]),M=Object(o.a)(D,2),N=M[0],T=M[1],H=Object(n.useState)(""),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(n.useState)(!1),L=Object(o.a)(P,2),F=L[0],G=L[1],U=Object(n.useState)(!0),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)({}),$=Object(o.a)(X,2),ee=$[0],ae=$[1],re=Object(n.useState)(!1),le=Object(o.a)(re,2),ie=le[0],ce=le[1],oe=Object(n.useState)(!1),se=Object(o.a)(oe,2),me=se[0],de=se[1],ue=Object(n.useState)(!0),pe=Object(o.a)(ue,2),ge=pe[0],be=pe[1];Object(n.useEffect)(()=>{V(!0);!function(e,t){const a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.include_expired;let o="".concat(k,"/api/issues_and_reminders/get_issues_and_reminders");if(o+="?include_expired=".concat(c),null!==n||null!==r){if(o+="&limit=".concat(n,"&offset=").concat(r),a&&(o+="&include_count=true"),0!==l.length){o+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(o+="&search=".concat(i))}S.a.get(o).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}({include_count:!0,limit:_,offset:g*_,filters:A,search_str:B,include_expired:!0},e=>{const t=e.issues_and_reminders,a=e.count;s(t),j(a),V(!1)})},[g,_,A,B,ge]);const Ee=(e,t)=>()=>{"is_issue_reminder_modal_open"===e&&(J(t),ce(!1))},he={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(te.c)(t,"xs")?"scroll":"scrollFullHeight",serverSide:!0,rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:x,page:g,onTableChange(e,t){if("changePage"===e){const e=t.page;b(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==_&&y(e)}else"resetFilters"===e?(T({}),I([])):"onSearchOpen"===e&&G(!0)},onFilterChange(e,t){const a=[];let n=!0;t.forEach((e,t)=>{if(0!==e.length){n=!1;const r=fe[t].name;if("site_name"===r){const t=[],n=[];e.forEach(e=>{t.push(Il[e]),n.push(e)}),a.push({name:"site_ids",data:t}),T(Object(u.a)(Object(u.a)({},N),{},{[r]:n}))}}}),n&&T({}),I(a)},customSearchRender:(e,t,a,n)=>{let l=e||"";F&&(l=B,G(!1));return r.a.createElement(Al,{searchText:e,onSearch:t,onHide:()=>{a(),G(!1)},options:n,onSearchClick:()=>Y(l)})}},fe=[{name:"ts_posted",label:"Date Posted",options:{filter:!1,customBodyRender:e=>ne()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"detail",label:"Details",options:{filter:!1}},{name:"reporter",label:"Reporter",options:{filter:!0,customBodyRender:(e,{rowIndex:t})=>{const a=c[t];return"".concat(a.issue_reporter.first_name," ").concat(a.issue_reporter.last_name)}}},{name:"ts_expiration",label:"Posted Until",options:{filter:!1,sort:!1,customBodyRender:e=>null===e?"-":ne()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"resolved_by",label:"Resolved By",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"resolution",label:"Resolution",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,{rowIndex:t})=>{const a=c[t],n=a.ts_expiration,l=a.resolution;return ne()(n).isAfter(ne()())||null!==l?"Finished":function(e,t){const a=t.setChosenIssueReminder,n=t.setIsOpenIssueReminderModal,l=t.setToResolve,i=t.setIsIandRUpdateNeeded,c=e.ts_resolved,o=e.ts_expiration,s=ne()().isBefore(o)||null===o,m=null===c&&(s||null===o);return r.a.createElement("span",null,s&&r.a.createElement(z.a,{tooltip:"Edit",style:{float:"left"},onClick:t=>{a(e),n(!0),i(!0),l(!1)}},r.a.createElement(El.a,{style:{fontSize:20}})),m&&r.a.createElement(z.a,{tooltip:"Delete",style:{float:"left"},onClick:t=>{a(e),n(!0),i(!0),l(!0)}},r.a.createElement(hl.a,{style:{fontSize:20}})),!s&&!m&&"Finished")}(a,{setChosenIssueReminder:ae,setIsOpenIssueReminderModal:J,isOpenIssueReminderModal:K,setToResolve:de,setIsIandRUpdateNeeded:ce})}}}],_e=Object(te.c)("md",t),ye=r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Post an Issue or reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:Ee("is_issue_reminder_modal_open",!0)},r.a.createElement(Ce.a,{style:{paddingRight:4,fontSize:20}}),"Post an Issue / Reminder"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(we,{title:"Alert Monitoring | Issues and Reminders",customButtons:!!_e&&ye})),r.a.createElement(qe.a,{open:q,fullWidth:!0},r.a.createElement(Qe.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(bl.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(f.a,{className:a.paperContainer},r.a.createElement(br.a,{theme:Ml},r.a.createElement(pr.a,{title:"Issues and Reminders",data:c,columns:fe,options:he})))),r.a.createElement(Yn,{isOpen:K,closeHandler:Ee("is_issue_reminder_modal_open",!1),isIandRUpdateNeeded:ie,setIsIandRUpdateNeeded:ce,chosenIssueReminder:ee,toResolve:me,setToRefresh:be,toRefresh:ge}))})),Tl=a(777),Hl=a(778),Rl=a(131),Bl=a.n(Rl),Yl=a(459),Pl=a.n(Yl),Ll=a(55),Fl=a.n(Ll),zl=a(34),Gl=a.n(zl),Ul=a(167),Wl=a.n(Ul),ql=a(413),Vl=a(412),Ql=a(751),Zl=a(772),Kl=a(771),Jl=a(773),Xl=a(460),$l=a.n(Xl),ei=a(769);function ti(e,t){const a="".concat(k,"/api/analysis/get_latest_data_presence/").concat(e);S.a.get(a).then(a=>{const n=a.data;console.log("Data Presence: ".concat(e),n),t(n)}).catch(e=>{console.error(e)})}function ai(e,t){const a="".concat(k,"/api/analysis/save_chart_svg");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save SVG",a),t(a)}).catch(e=>{console.error(e)})}function ni(e,t){const a=[];return t.forEach(t=>{const n=t.dataset_name,r=function(e){const t=e.dataset_name,a=e.dataset;return"velocity_acceleration"===t?a.forEach(({name:e},t)=>{"Trend Line"===e?a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{type:"spline"}):"Threshold Interval"===e?a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,color:"#FFEB32"}):"Last Data Point"===e&&(a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{marker:{symbol:"asterisk",lineColor:"#ff9e32",lineWidth:4}}))}):"displacement_interpolation"===t?a.forEach(({name:e},t)=>{"Surficial Data"===e?a[t].type="scatter":"Interpolation"===e&&(a[t]=Object(u.a)(Object(u.a)({},a[t]),{},{marker:{enabled:!0,radius:0}}))}):"velocity_acceleration_time"===t&&a.forEach(({name:e},t)=>{"Velocity"===e?a[t].yAxis=0:"Acceleration"===e&&(a[t].yAxis=1)}),a}(t);let l;if("velocity_acceleration"===n)l=function(e,t){const a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity Acceleration Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(ne()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{title:{text:"<b>Velocity (cm/day)</b>"}},yAxis:{title:{text:"<b>Acceleration (cm/day^2)</b>"}},tooltip:{headerFormat:"",shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1}}}(r,e);else if("displacement_interpolation"===n)l=function(e,t){const a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"spline",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Displacement Interpolation Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat(ne()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},tooltip:{crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}},scatter:{tooltip:{pointFormat:"Date/Time: <b>{point.x:%A, %e %b, %H:%M:%S}</b><br>Displacement: <b>{point.y:.2f}</b>"}}},credits:{enabled:!1}}}(r,e);else if("velocity_acceleration_time"===n){const t=r.findIndex(e=>"Timestamps"===e.name),a=JSON.parse(JSON.stringify(r)),n=a.splice(t,1);l=function(e,t,a){const n=a.site_code,r=a.marker_name,l=a.ts;return{series:e,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity & Acceleration vs Time Chart of ".concat(n.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(r,"</b><br/>Timestamp: <b>").concat(ne()(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{categories:t,type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},labels:{formatter(){return ne()(this.value).format("D MMM")}},title:{text:"<b>Time (Days)</b>"}},yAxis:[{title:{text:"<b>Velocity (cm/day)</b>",style:{color:Gl.a.getOptions().colors[1]}}},{title:{text:"<b>Acceleration (cm/days^2)</b>",style:{color:Gl.a.getOptions().colors[0]}},labels:{style:{color:Gl.a.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!1}}},credits:{enabled:!1}}}(a,Object(o.a)(n,1)[0].data,e)}a.push(l)}),a}$l()(Gl.a),Gl.a.SVGRenderer.prototype.symbols.asterisk=(e,t,a,n)=>["M",e-3,t-3,"L",e+a+3,t+n+3,"M",e+a+3,t-3,"L",e-3,t+n+3,"M",e-4,t+n/2,"L",e+a+4,t+n/2,"M",e+a/2,t-4,"L",e+a/2,t+n+4,"z"],Gl.a.VMLRenderer&&(Gl.a.VMLRenderer.prototype.symbols.asterisk=Gl.a.SVGRenderer.prototype.symbols.asterisk);var ri=function(e){const t=e.siteCode,a=e.generateTrending,l=e.setShowTrending,i=e.setGenerateTrending,c=e.chosenPoint,s=r.a.useRef(null),m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],g=d[1],b=Object(n.useState)([]),E=Object(o.a)(b,2),h=E[0],_=E[1],v=Object(n.useState)(!1),O=Object(o.a)(v,2),x=O[0],j=O[1],C=c.ts,w=c.name,A={site_code:t,ts:ne()(C).format("YYYY-MM-DD HH:ss:mm"),marker_name:w};return Object(n.useEffect)(()=>{a&&(j(!0),function(e,t){const a=e.site_code,n=e.marker_name,r=e.ts,l="".concat(k,"/api/surficial/get_surficial_marker_trending_data/")+"".concat(a,"/").concat(n,"/").concat(r);S.a.get(l).then(e=>{const a=e.data;console.log("Surficial Marker Trending Data",a),t(a)}).catch(e=>{console.error(e)})}(A,e=>{const t=e.has_trend,a=e.trending_data,n=t?[...a]:[];g(n),i(!1),j(!1)}))},[a]),Object(n.useEffect)(()=>{if(0!==u.length){const e=function(e,t,a){return ni(e,t).map(e=>r.a.createElement(Fl.a,{highcharts:Gl.a,options:e,ref:a}))}(A,u,s);_(e)}},[u]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),x?r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:16}},r.a.createElement(bl.a,{variant:"query",style:{height:8}})):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",onClick:()=>l(!1),color:"primary",size:"small",endIcon:r.a.createElement(ei.a,null)},"Hide")),r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"center",spacing:1},0!==u.length?h.map((e,t)=>r.a.createElement(y.a,{item:!0,xs:12,sm:6,key:t},r.a.createElement(f.a,null,e))):r.a.createElement(f.a,{component:y.a,container:!0,item:!0,alignItems:"center",justify:"center",style:{height:"20vh",padding:60,background:"gainsboro",border:"4px solid #CCCCCC"}},"Selected data has no trend."))))},li=a(770);const ii=e=>t=>{t.preventDefault(),e.push("/analysis/sites"),e.replace("/analysis/sites")};var ci=function(e){const t=e.width,a=e.history;return Object(te.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:ii(a)},r.a.createElement(li.a,{style:{fontSize:16}})," Back to site list"):r.a.createElement(z.a,{variant:"contained",color:"primary",size:"small",onClick:ii(a),style:{marginLeft:6}},r.a.createElement(li.a,null))};const oi=[{label:"3 days",unit:"days",duration:3},{label:"7 days",unit:"days",duration:7},{label:"10 days",unit:"days",duration:10},{label:"2 weeks",unit:"weeks",duration:2},{label:"1 month",unit:"months",duration:1},{label:"3 months",unit:"months",duration:3},{label:"6 months",unit:"months",duration:6},{label:"1 year",unit:"years",duration:1},{label:"All",unit:"all",duration:0}],si=[{label:"4 hours",hour_value:4},{label:"8 hours",hour_value:8},{label:"12 hours",hour_value:12},{label:"1 day",hour_value:24}];var mi=function(e){const t=e.isSubsurface,a=e.selectedRangeInfo,l=e.setSelectedRangeInfo,i=e.selectedHourInterval,c=e.setSelectedHourInterval,s=e.disableAll,m=Object(n.useState)(null),d=Object(o.a)(m,2),u=d[0],g=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),h=E[0],f=E[1],_="undefined"!==typeof s&&s,v="undefined"!==typeof t&&t;let O="";if(i){const e=i.label;O=e}const x=e=>{f(e.currentTarget)},j=()=>{f(null)};return r.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},v&&r.a.createElement(n.Fragment,null,r.a.createElement(Pe.a,{title:"Select time interval",arrow:!0},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:x,style:{marginRight:6},endIcon:r.a.createElement(Kl.a,null)},O)),r.a.createElement(G.a,{id:"simple-menu",anchorEl:h,keepMounted:!0,open:Boolean(h),onClose:j},si.map((e,t)=>{const a=e.label;return r.a.createElement(U.a,{key:"hour_interval_".concat(t),onClick:()=>(c(e),void f(null))},a)}))),r.a.createElement(Pe.a,{title:"Select date range",arrow:!0},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{g(e.currentTarget)},style:{marginRight:v?8:0},endIcon:r.a.createElement(Kl.a,null)},a.label)),r.a.createElement(G.a,{id:"simple-menu",anchorEl:u,keepMounted:!0,open:Boolean(u),onClose:()=>{g(null)}},oi.map((e,t)=>{const a=e.label;return"all"===e.unit&&_?null:r.a.createElement(U.a,{key:"date_range_".concat(t),onClick:()=>(l(e),void g(null))},a)})))};function di(e,t){return r.a.createElement(p.a,{color:"primary",onClick:()=>{e(t)}},"Dismiss")}function ui(e){const t=e.fullScreen,a=e.open,l=e.setIsOpen,i=e.selectedMarker,s=e.historicalMarkers,m=e.addNewMarker,d=e.siteCode,u=e.setRedrawChart,g=e.history,E=e.match.url;let h=null,f=null;if(null!==i){const e=i.marker_id,t=i.marker_name;h=e,f=t}const _=Object(c.b)(),O=_.enqueueSnackbar,x=_.closeSnackbar,j=Object(n.useState)(""),C=Object(o.a)(j,2),w=C[0],A=C[1],I=Object(n.useState)(null),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useState)(""),H=Object(o.a)(T,2),R=H[0],B=H[1],Y=Object(n.useState)(""),P=Object(o.a)(Y,2),L=P[0],F=P[1],z=()=>{l(!1),N(null),B(""),q(null),A(""),F("")},G=Object(n.useState)(null),U=Object(o.a)(G,2),W=U[0],q=U[1],V=()=>{""===R&&q("Required field")};Object(n.useEffect)(()=>{""!==R?/[^a-zA-Z]/.test(R)?q("Enter alphabet characters only."):s.includes(R)?q("Marker name already exists."):q(null):q("")},[R]);const Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1];return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},m?"Add new marker":"Add event to Marker ".concat(f)),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,m?"Choose a new marker name then submit.":"Choose a marker event then answer the corresponding field(s)."),r.a.createElement(Ke.a,{component:"fieldset",style:{display:"flex"}},!m&&r.a.createElement(Je.a,{"aria-label":"marker_event",name:"marker_event",row:!0,style:{justifyContent:"space-around"},value:w,onChange:e=>{A(e.target.value),N(null),B(""),q(null),F("")}},r.a.createElement(Xe.a,{value:"reposition",control:r.a.createElement($e.a,null),label:"Reposition"}),r.a.createElement(Xe.a,{value:"rename",control:r.a.createElement($e.a,null),label:"Rename"}),r.a.createElement(Xe.a,{value:"decommission",control:r.a.createElement($e.a,null),label:"Decommission"})),r.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:8}},""!==w&&r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Timestamp",value:M,onChange:e=>N(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),("rename"===w||m)&&r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(b.a,{error:Boolean(W),label:"New Marker Name",value:R,onChange:e=>B(e.target.value.toUpperCase()),onBlur:V,type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:1},placeholder:"Input a letter",helperText:W||""})),(""!==w||m)&&r.a.createElement(y.a,{item:!0,xs:12,sm:12},r.a.createElement(b.a,{label:"Remarks",value:L,onChange:e=>F(e.target.value),onBlur:V,type:"text",multiline:!0,rowsMax:3,fullWidth:!0,inputProps:{maxLength:1500},placeholder:"Input remarks"})))),K&&r.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:12}},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},"Are you sure submitting this data?")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)))),r.a.createElement(et.a,null,K&&r.a.createElement(p.a,{onClick:()=>J(!1)},"Go Back"),r.a.createElement(p.a,{variant:K?"contained":"text",color:"secondary",onClick:()=>{let e=!0;if(("reposition"!==w||m)&&(e=!1,K?(e=!0,J(!1)):J(!0)),e){z();const e=m?"add":w,t=m?ne()():M;!function(e,t){const a="".concat(k,"/api/surficial/insert_marker_event");S.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({site_code:d,event:e,marker_id:h,ts:ne()(t).format("YYYY-MM-DD HH:mm:ss"),marker_name:R,remarks:""===L?null:L},t=>{const a=t.status;let n="Error inserting new marker event...";m&&(n="Error creating new marker..."),"success"===a&&(n="Inserting new marker event successful!",m&&(n="Creating new marker successful!"),u(!0),["add","rename"].includes(e)&&g.push("".concat(E,"/").concat(R))),O(n,{variant:a,autoHideDuration:7e3,action:e=>di(x,e)})})}}},"Submit"),!K&&r.a.createElement(p.a,{onClick:z},"Cancel")))}function pi(e){const t=e.markerInfo,a=e.markerName,n=[{name:"ts",label:"Timestamp",options:{filter:!1,customBodyRender:e=>ne()(e).format("D MMMM YYYY, HH:mm"),sortDirection:"desc"}},{name:"event",label:"Event"},{name:"m_name",label:"Name",options:{filter:!1}},{name:"remarks",label:"Remarks",options:{filter:!1,display:!1}}],l={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",expandableRows:!0,expandableRowsHeader:!1,renderExpandableRow:(e,t)=>{const a=e.length+1,n=e[3];return r.a.createElement(ql.a,null,r.a.createElement(Vl.a,{colSpan:a,align:"justify"},r.a.createElement("strong",null,"Remarks:")," ",n))},rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"scrollMaxHeight",customSort:(e,t,a)=>e.sort((e,n)=>0===t?(ne()(e.data[t]).isAfter(n.data[t])?-1:1)*("desc"===a?1:-1):(e.data[t]<n.data[t]?-1:1)*("desc"===a?1:-1))};let i=[];return t&&(i=t.marker_history.map(e=>{const t=e.ts,a=e.event,n=e.marker_name,r=e.remarks,l=n?n.marker_name:"---";return{event:ie(a),m_name:l,ts:t,remarks:r||"None"}})),r.a.createElement(pr.a,{title:"Marker ".concat(a," History"),columns:n,options:l,data:i})}function gi(e){const t=e.editModal,a=e.fullScreen,l=e.setEditModal,i=e.siteCode,s=e.setRedrawChart,m=e.chosenPoint,d=t.is_open,g=t.ts,E=t.name,h=t.measurement,f=t.mo_id,_=t.data_id,O=m.ts,x=m.measurement,j=Object(c.b)(),C=j.enqueueSnackbar,w=j.closeSnackbar,A=Object(n.useState)(!1),I=Object(o.a)(A,2),D=I[0],M=I[1],N=Object(n.useState)("one"),T=Object(o.a)(N,2),H=T[0],R=T[1];Object(n.useEffect)(()=>{M(!1)},[d]);const B=(e,a)=>n=>{let r=a;"ts"===e?r=n:"measurement"===e&&(r=n.target.value),l(Object(u.a)(Object(u.a)({},t),{},{[e]:r}))};return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:a,open:d,"aria-labelledby":"form-dialog-title",TransitionComponent:a?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Update surficial data"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Carefully edit the necessary fields or delete entries if needed."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(v.a,{variant:"subtitle1",style:{fontWeight:"bold"}},i.toUpperCase()," - Marker ",E),r.a.createElement(v.a,{variant:"body2"},"Timestamp: ",ne()(O).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(v.a,{variant:"body2"},"Measurement: ",x," cm")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"EDIT")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{label:"Change marker data measurement",value:h,onChange:B("measurement"),type:"number",fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},"Change observation timestamp (applies to the rest of the points)"),r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Observation Timestamp",value:ne()(g),onChange:B("ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>{let e={};O!==g&&(e=Object(u.a)(Object(u.a)({},e),{},{mo_id:f,ts:ne()(g).format("YYYY-MM-DD HH:mm:ss")})),x!==h&&(e=Object(u.a)(Object(u.a)({},e),{},{data_id:_,measurement:h})),l(Object(u.a)(Object(u.a)({},t),{},{is_open:!1})),0!==Object.keys(e).length&&function(e,t){const a="".concat(k,"/api/surficial/update_surficial_data");S.a.post(a,e).then(e=>{const a=e.data;console.log("Update Surficial Data Response",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{let t="Error updating surficial data...",a="error";"success"===e.status&&(t="Surficial data update successful!",a="success",s(!0)),C(t,{variant:a,autoHideDuration:7e3,action:e=>di(w,e)})})}},"Update Data")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"DELETE")),r.a.createElement(y.a,{item:!0,xs:12},"Be careful on deleting marker data. Delete only IF REALLY NEEDED."),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ke.a,{component:"fieldset"},r.a.createElement(Je.a,{"aria-label":"gender",name:"gender1",value:H,onChange:e=>R(e.target.value)},r.a.createElement(Xe.a,{value:"one",control:r.a.createElement($e.a,null),label:"Delete measurement of this marker only"}),r.a.createElement(Xe.a,{value:"all",control:r.a.createElement($e.a,null),label:"Delete all measurements from given marker observation"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:()=>M(!0)},"Delete Data")),D&&r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(Ql.a,{variant:"contained",size:"small",color:"secondary","aria-label":"small contained button group"},r.a.createElement(p.a,{disabled:!0},"Are you sure?"),r.a.createElement(p.a,{onClick:()=>{const e=t.data_id,a=t.mo_id;let n=e;"all"===H&&(n=a);const r={quantity:H,id:n};l(Object(u.a)(Object(u.a)({},t),{},{is_open:!1})),function(e,t){const a="".concat(k,"/api/surficial/delete_surficial_data");S.a.post(a,e).then(e=>{const a=e.data;console.log("Delete Surficial Data Response",a),t(a)}).catch(e=>{console.error(e)})}(r,e=>{let t="Error deleting surficial data...",a="error";"success"===e.status&&(t="Surficial data delete successful!",a="success",s(!0)),C(t,{variant:a,autoHideDuration:7e3,action:e=>di(w,e)})})}},"Yes"),r.a.createElement(p.a,{onClick:()=>M(!1)},"No"))))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:B("is_open",!1)},"Cancel")))}function bi(e){const t=e.setIsOpenClickModal,a=e.open,n=e.chosenPoint,l=e.setEditModal,i=e.setShowTrending,c=e.setGenerateTrending,o=n.ts,s=n.measurement,m=n.name,d=()=>{t(!1)};return r.a.createElement(qe.a,{onClose:d,"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(Ve.a,{id:"simple-dialog-title"},"Point options"),r.a.createElement(Qe.a,null,r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(v.a,{variant:"subtitle1",style:{fontWeight:"bold"}},"Marker ",m),r.a.createElement(v.a,{variant:"body2"},"Timestamp: ",ne()(o).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(v.a,{variant:"body2"},"Measurement: ",s," cm"))),r.a.createElement(bn.a,null,r.a.createElement(hn.a,{button:!0,onClick:()=>{d(),l(Object(u.a)(Object(u.a)({},n),{},{is_open:!0}))}},r.a.createElement(_n.a,null,r.a.createElement(El.a,null)),r.a.createElement(fn.a,{primary:"Edit/Delete data"})),r.a.createElement(hn.a,{button:!0,onClick:()=>{d(),i(!0),c(!0)}},r.a.createElement(_n.a,null,r.a.createElement(Zl.a,null)),r.a.createElement(fn.a,{primary:"Generate trending chart"}))))}function Ei(e){const t=e.width,a=e.url,l=e.selectedMarker,i=e.surficialData,c=e.setIsOpenAddEventModal,m=e.setAddNewMarker,d=Object(n.useState)(null),u=Object(o.a)(d,2),g=u[0],b=u[1],E=()=>{b(null)},h=Object(te.b)(t,"sm")&&i.length<=5;return r.a.createElement(n.Fragment,null,r.a.createElement(Ql.a,{variant:"contained",color:"primary",size:"small","aria-label":"Site markers button group",style:{marginRight:6}},r.a.createElement(p.a,{disabled:!0,style:{color:"#000000"}},"Marker Info"),h?i.map(e=>{const t=e.marker_name,n=e.marker_id;return r.a.createElement(p.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n},t)}):r.a.createElement(p.a,{color:"primary",variant:"contained",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{b(e.currentTarget)},endIcon:r.a.createElement(Kl.a,null)},l?l.marker_name:"Select"),r.a.createElement(Pe.a,{title:"Add a new marker",onClick:()=>{m(!0),c(!0)},arrow:!0},r.a.createElement(p.a,null,r.a.createElement(Jl.a,null)))),r.a.createElement(G.a,{id:"simple-menu",anchorEl:g,keepMounted:!0,open:Boolean(g),onClose:E},i.map(e=>{const t=e.marker_name,n=e.marker_id;return r.a.createElement(U.a,{component:s.b,to:"".concat(a,"/").concat(t),key:n,onClick:E},t)})))}Wl()(Gl.a);var hi=Object(tt.a)()((function(e){const t=e.width,a=e.location.pathname,l=e.match,i=l.url,c=l.params.site_code,s=e.fullScreen,d=e.disableBack,g=e.disableMarkerList,b=e.saveSVG,E=e.input,h=e.currentUser,_=e.isEndOfShift,v=Object(n.useState)({label:"3 months",unit:"months",duration:3}),O=Object(o.a)(v,2),x=O[0],j=O[1],C=x.unit,w=x.duration;let A,I="";if("undefined"!==typeof E){const e=E.ts_end;I=e,A=ne()(e)}else{const e=ne()();I=e.format("YYYY-MM-DD HH:mm:ss"),A=e}const D="undefined"!==typeof d&&d,M="undefined"!==typeof g&&g,N="undefined"!==typeof b&&b,T="undefined"!==typeof _&&_,H=me(A,w,C),R=r.a.useRef(null),B={start:H,end:I},Y=Object(n.useState)([]),P=Object(o.a)(Y,2),L=P[0],F=P[1],z=Object(n.useState)(null),G=Object(o.a)(z,2),U=G[0],W=G[1],q=Object(n.useState)(!1),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(!1),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)(!0),ae=Object(o.a)(ee,2),re=ae[0],le=ae[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],de=Object(n.useState)(!1),ue=Object(o.a)(de,2),pe=ue[0],ge=ue[1],be=Object(n.useState)(!1),Ee=Object(o.a)(be,2),he=Ee[0],fe=Ee[1],_e=Object(n.useState)(!1),ye=Object(o.a)(_e,2),ve=ye[0],Oe=ye[1],xe=Object(n.useState)(!1),je=Object(o.a)(xe,2),Se=je[0],ke=je[1],Ce={data_id:null,mo_id:null,name:null,ts:null,measurement:0},we=Object(n.useState)(Object(u.a)({},Ce)),Ae=Object(o.a)(we,2),Ie=Ae[0],De=Ae[1],Me=Object(n.useState)(Object(u.a)(Object(u.a)({},Ce),{},{is_open:!1})),Ne=Object(o.a)(Me,2),Te=Ne[0],He=Ne[1];Object(n.useEffect)(()=>{le(!0)},[x]),Object(n.useEffect)(()=>{const e=R.current;if((null!==e||re)&&e.chart.showLoading(),re){!function(e,t,a=!1){const n=e.site_code,r=e.start,l=e.end;let i="".concat(k,"/api/surficial/get_surficial_plot_data/")+"".concat(n,"/").concat(r,"/").concat(l);a&&(i+="?is_end_of_shift=true"),S.a.get(i).then(e=>{const a=e.data;console.log("Surficial Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(Object(u.a)({site_code:c},B),t=>{if(F(t),null!==e){e.chart.hideLoading(),N&&$(!0)}},T),le(!1)}},[re]),Object(n.useEffect)(()=>{if(!Q&&0!==L.length){const e=[];L.forEach(({marker_history:t})=>{t.forEach(({marker_name:t})=>{t&&e.push(t.marker_name)})}),Z(e)}},[Q,L]),Object(n.useEffect)(()=>{if(0!==L.length){const e=Object(m.f)(a,{path:"".concat(i,"/:marker_name"),exact:!0});if(e){const t=e.isExact,a=e.params.marker_name;if(t){const e=L.find(e=>e.marker_name===a);"undefined"!==typeof e&&W(e)}}}},[a,L]),Object(n.useEffect)(()=>{const e=R.current.chart.getSVGForExport();if(X){ai({user_id:h.user_id,site_code:c,chart_type:"surficial",svg:e},e=>{})}},[X]),Object(n.useEffect)(()=>{const e=R.current.chart;U&&(e.series.forEach(e=>{const t=U.marker_name===e.name;e.setVisible(t,!1)}),e.redraw(),e.reflow())},[U]);const Re=function(e,t){return r.a.createElement(Fl.a,{highcharts:Gl.a,options:e,ref:t})}(function(e,t,a,n,r,l){const i=e.site_code,c=e.timestamps,o=c.start,s=c.end,m=ne()(o,"YYYY-MM-DD HH:mm:ss"),d=ne()(s,"YYYY-MM-DD HH:mm:ss"),u=Object(te.b)(a,"sm")?"1rem":"0.90rem";let p="As of: <b>".concat(ne()(d).format("D MMM YYYY, HH:mm"),"</b>");l||(p+="<br/><i>Note: Click data points to access several options.</i>");let g=m;if((l||"None"===o)&&t.length>0){const e=t[0].data;e.length>0&&(g=ne()(e[0].x))}return{title:{text:"<b>Surficial Data History Chart of ".concat(i.toUpperCase(),"</b>"),style:{fontSize:u},margin:36,y:18},time:{timezoneOffset:-480},series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:24,spacingRight:24},subtitle:{text:p,style:{fontSize:"0.75rem"}},legend:{labelFormatter(){const e=this.userOptions,t=e.marker_name;return 0===e.in_use?"".concat(t," (Defunct)"):t}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},xAxis:{min:Date.parse(g),max:Date.parse(d),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0},dashStyle:"ShortDash"},series:{marker:{radius:3},cursor:"pointer",point:{events:{click(){if(!l){const e=this.data_id,t=this.x,a=this.y,l=this.mo_id,i={data_id:e,name:this.series.name,mo_id:l,ts:ne()(t),measurement:a};r(i),n(!0)}}}}}},loading:{showDuration:100,hideDuration:1e3},credits:{enabled:!1}}}({site_code:c,timestamps:B},L,t,fe,De,T),R);return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(y.a,{container:!0,item:!0,xs:12,style:{marginBottom:16}},!D&&r.a.createElement(y.a,{item:!0,sm:!0},r.a.createElement(ci,e)),r.a.createElement(y.a,{item:!0,container:!0,xs:!0,justify:"flex-end"},!M&&L.length>0&&r.a.createElement(Ei,Object.assign({},e,{width:t,url:i,selectedMarker:U,surficialData:L,setIsOpenAddEventModal:Oe,setAddNewMarker:ke})),r.a.createElement("div",null,r.a.createElement(mi,{selectedRangeInfo:x,setSelectedRangeInfo:j})))),r.a.createElement(y.a,{item:!0,xs:12,md:U?7:12,lg:U?8:12},r.a.createElement(f.a,{elevation:2},Re)),r.a.createElement(m.b,{path:"".concat(i,"/:marker_name"),render:e=>{const t=e.match.params.marker_name;return U?r.a.createElement(y.a,{item:!0,xs:12,md:5,lg:4},r.a.createElement(pi,{markerInfo:U,markerName:t}),r.a.createElement(y.a,{container:!0,justify:"flex-end",style:{marginTop:12}},r.a.createElement(p.a,{variant:"contained",color:"primary",startIcon:r.a.createElement(Jl.a,null),onClick:()=>{ke(!1),Oe(!0)}},"Add New Event"))):""}}),oe&&r.a.createElement(ri,{siteCode:c,setShowTrending:se,generateTrending:pe,setGenerateTrending:ge,chosenPoint:Ie})),r.a.createElement(bi,{open:he,setIsOpenClickModal:fe,chosenPoint:Ie,setEditModal:He,setShowTrending:se,setGenerateTrending:ge}),r.a.createElement(gi,{chosenPoint:Ie,editModal:Te,setEditModal:He,fullScreen:s,siteCode:c,setRedrawChart:le}),r.a.createElement(ui,Object.assign({},e,{siteCode:c,open:ve,setIsOpen:Oe,selectedMarker:U,setRedrawChart:le,historicalMarkers:Q,addNewMarker:Se})))})),fi=a(804);window.moment=ae,Wl()(Gl.a);const _i={set:{"24h":[],"72h":[],rain:[],null_ranges:[],max_rval:0,max_72h:0,gauge_name:"loading",distance:0,data_source:"loading",threshold_value:0},series_data:[],max_rval_data:[]},yi={"24h":"rgba(73, 105, 252, 0.9)","72h":"rgba(239, 69, 50, 0.9)",rain:"rgba(0, 0, 0, 0.9)"};function vi(e,t){const a=e.set,n=e.max_rval_data,r=e.null_processed,l=a.distance,i=a.max_rval,c=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"column",zoomType:"x",panning:!0,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Instantaneous Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source : <b>".concat(ji(l,c),"</b><br/>As of: <b>").concat(ae(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),plotBands:r,type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:Si}},yAxis:{max:i,min:0,title:{text:"<b>Value (mm)</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}function Oi(e,t){const a=e.set,n=e.series_data,r=a.distance,l=a.max_72h,i=a.threshold_value,c=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Cumulative Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source: <b>".concat(ji(r,c),"</b><br/>As of: <b>").concat(ae(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:Si}},yAxis:{title:{text:"<b>Value (mm)</b>"},max:Math.max(0,l-parseFloat(i))+parseFloat(i),min:0,plotBands:[{value:Math.round(10*parseFloat(i/2))/10,color:yi["24h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"24-hr threshold (".concat(i/2,")")}},{value:i,color:yi["72h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"72-hr threshold (".concat(i,")")}}]},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}var xi=function(e){const t=e.match.params,a=t.rain_gauge,l=t.site_code,i=e.input,c=e.disableBack,s=e.currentUser,m=e.saveSVG,d="undefined"!==typeof a?1:4,p=Object(n.useState)([]),g=Object(o.a)(p,2),b=g[0],E=g[1],h=Object(n.useState)([]),_=Object(o.a)(h,2),v=_[0],O=_[1],x=Object(n.useState)({label:"3 days",unit:"days",duration:3}),j=Object(o.a)(x,2),C=j[0],w=j[1],A=Object(n.useRef)([...Array(d)].map(()=>({instantaneous:Object(n.createRef)(),cumulative:Object(n.createRef)()}))),I=Object(n.useState)(!1),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useState)([]),H=Object(o.a)(T,2),R=H[0],B=H[1],Y="undefined"!==typeof c&&c,P="undefined"!==typeof m&&m;let L,F="",z="";if("undefined"!==typeof i){const e=i.ts_end;F=e,L=ae(e),z=l}else{const e=ae();F=e.format("YYYY-MM-DD HH:mm:ss"),L=e,z=a.substr(0,3)}const G=C.unit,U=C.duration,W=me(L,U,G),q={days_diff:L.diff(ae(W,"YYYY-MM-DD HH:mm:ss"),"days"),ts_start:W,ts_end:F,site_code:z},V={cumulative:Oi(_i,q),instantaneous:vi(_i,q)};Object(n.useEffect)(()=>{O([]),function(e,t){const a=e.site_code,n=e.ts_end,r=e.days_diff,l="".concat(k,"/api/rainfall/get_rainfall_plot_data/").concat(a,"/").concat(n,"/").concat(r);S.a.get(l).then(e=>{const a=e.data;console.log("Rainfall Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(q,e=>{let t=e;"undefined"!==typeof a&&(t=e.filter(e=>e.gauge_name==="rain_".concat(a))),E(t)})},[C,U]),Object(n.useEffect)(()=>{const e=[];b.forEach(t=>{const a=function(e){const t=e.null_ranges,a=[],n=[];Object.keys(yi).forEach(t=>{const r=yi[t],l={name:t,step:!0,data:e[t],color:r,id:t,fillOpacity:1,lineWidth:1};"rain"!==t?a.push(l):n.push(l)});const r=t.map(({from:e,to:t})=>({from:e,to:t,color:"rgba(68, 170, 213, 0.3)"}));return{set:e,series_data:a,max_rval_data:n,null_processed:r}}(t);e.push(a)}),e.length>0&&O(e)},[b]);const Q=Object(n.useState)([]),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1];Object(n.useEffect)(()=>{const e=[];v.forEach(t=>{const a=vi(t,q),n=Oi(t,q);e.push({instantaneous:a,cumulative:n})}),J(e),e.length>0&&P&&N(!0)},[v]),Object(n.useEffect)(()=>{if(M){const e=[];A.current.forEach(t=>{const a=t.instantaneous,n=t.cumulative,r=a.current.chart,l=n.current.chart.getSVGForExport(),i=r.getSVGForExport();e.push({c:l,i:i})}),B(e)}},[M]);const X=Object(n.useRef)(null);return Object(n.useEffect)(()=>{if(R.length>0){const e=X.current.outerHTML;ai({user_id:s.user_id,site_code:l,chart_type:"rainfall",svg:e},e=>{})}},[R]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},!Y&&r.a.createElement(ci,e),r.a.createElement(mi,{selectedRangeInfo:C,setSelectedRangeInfo:w,disableAll:!0})),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},A.current.map((e,t)=>{let a=Object(u.a)({},V);return K.length>0&&(a=K[t]),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,null,r.a.createElement(Fl.a,{highcharts:Gl.a,options:a.instantaneous,ref:e.instantaneous}))),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,null,r.a.createElement(Fl.a,{highcharts:Gl.a,options:a.cumulative,ref:e.cumulative}))))}))),P&&r.a.createElement(fi.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:1600,viewBox:"0 0 1200 1600",ref:X},R.map((e,t)=>{const a=e.i,l=e.c;return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:0,y:400*t,dangerouslySetInnerHTML:{__html:a}}),r.a.createElement("svg",{x:600,y:400*t,dangerouslySetInnerHTML:{__html:l}}))}))))};function ji(e,t){const a=t.toUpperCase();return null===e?a:"".concat(a," (").concat(e," KM)")}function Si(e){const t=this.chart,a=Gl.a.charts;"syncExtremes"!==e.trigger&&Gl.a.each(a,a=>{a!==t&&a.xAxis[0].setExtremes&&a.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})})}function ki(e){const t=e.length,a=wi(t),n=[...e];for(let r=0;r<t;r+=1)"Cumulative"!==e[r].name&&(n[r].color=a[r]);return n}window.moment=ae,Wl()(Gl.a);let Ci=[];function wi(e){const t=[...Ci];if(t.length!==e){for(let a=0;a<e;a+=1){const n={index:a,size:e},r=Ai(n,2*Math.PI*2/3),l=Ai(n,1*Math.PI*2/3),i=Ai(n,0*Math.PI*2/3);t[a]="#".concat(r).concat(i).concat(l)}Ci=[...t]}return t}function Ai({index:e,size:t},a){const n=Math.sin(Math.PI/t*2*e+a),r=(Math.floor(127*n)+128).toString(16);return 1===r.length?"0".concat(r):r}var Ii=function(e){const t=e.match.params.tsm_sensor,a=e.width,l=e.input,i=e.disableBack,c=e.saveSVG,s=e.currentUser;let m,d="",p=t;const g=Object(n.useState)({label:"3 days",unit:"days",duration:3}),b=Object(o.a)(g,2),E=b[0],h=b[1],_=Object(n.useState)({label:"4 hours",hour_value:"4"}),v=Object(o.a)(_,2),O=v[0],x=v[1];if("undefined"!==typeof l){const e=l.ts_end,t=l.tsm_sensor;d=e,m=ae(e),p=t}else{const e=ae();d=e.format("YYYY-MM-DD HH:mm:ss"),m=e}const j=E.unit,C=me(m,E.duration,j),w="undefined"!==typeof i&&i,A="undefined"!==typeof c&&c,I=Object(n.useState)([]),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useRef)([...Array(6)].map(()=>Object(n.createRef)())),H=Object(n.useState)(!1),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],z=L[1],G=O.hour_value,U={ts_end:d,ts_start:C,subsurface_column:p,hour_value:G},W=Object(te.b)(a,"sm"),q={title:{text:"Loading"}};Object(n.useEffect)(()=>{N([]),function(e,t){const a=e.subsurface_column,n=e.ts_end,r=e.ts_start,l=e.hour_value,i="".concat(k,"/api/subsurface/get_subsurface_plot_data/").concat(a,"/").concat(n,"/").concat(r,"/").concat(l);S.a.get(i).then(e=>{const a=e.data;console.log("Subsurface Plot Data",a),t(a)}).catch(e=>{console.error(e)})}(U,e=>{const t=[];e.forEach(({type:e,data:a})=>{const n=JSON.parse(JSON.stringify(a));let r=[];"column_position"===e?r=function(e,t){const a=e.data,n=[];return a.forEach(({orientation:a,data:r})=>{const l=ki(r),i=Object(u.a)(Object(u.a)({},e),{},{data:l,orientation:a,type:t});n.push(i)}),n}(n,e):"displacement"===e?r=function(e,t){const a=[];return e.forEach((e,n)=>{const r=e.data,l=e.annotations;r[0].type="area";const i=ki(r);l.forEach(e=>{e.width=0,e.label.style={color:"gray"}});const c=Object(u.a)(Object(u.a)({},e),{},{data:i,annotations:l,type:t});a.push(c)}),a}(n,e):"velocity_alerts"===e&&(r=function(e,t){const a=e.velocity_alerts,n=e.timestamps_per_node,r=[],l=ki(n);return a.forEach(e=>{const a=e.orientation,n=e.data,i=[...l];Object.keys(n).forEach(e=>{const t="L2"===e?7:10,a="L2"===e?"#FFFF00":"#FF0000",r={data:n[e],type:"scatter",zIndex:5,name:e,marker:{symbol:"triangle",radius:t,fillColor:a,lineColor:"#000000",lineWidth:2}};i.push(r)});const c={data:i,type:t,orientation:a};r.push(c)}),r}(n,e)),t.push(...r)}),N(t)})},[E,O]);const V=Object(n.useState)([{title:{text:"Loading"}}]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1];Object(n.useEffect)(()=>{const e=[];M.forEach(t=>{const a=t.type;let n;"column_position"===a?n=function(e,t,a){const n=e.data,r=e.max_position,l=e.min_position,i=e.orientation,c=t.subsurface_column,o="across_slope"===i?"Across Slope":"Downslope";return{series:n,chart:{type:"scatter",zoomType:"x",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Column Position Plot of ".concat(c.toUpperCase(),"</b>"),style:{fontSize:"1rem"}},plotOptions:{series:{lineWidth:2,states:{hover:{enabled:!0,lineWidth:5}},marker:{enabled:!0,radius:3,lineColor:null}}},tooltip:{formatter(){return"Timestamp: <b>".concat(ae(this.series.name).format("dddd, MMM D, HH:mm"),"</b><br>Depth: <b>").concat(this.y,"</b><br>Displacement: <b>").concat(this.x,"</b>")}},xAxis:{min:l,max:r+.02,gridLineWidth:1,title:{text:"<b>Horizontal displacement, ".concat(o," (m)</b>")}},yAxis:{title:{text:"<b>Depth (m)</b>"}},credits:{enabled:!1},legend:{enabled:!0,align:a?"right":"center",layout:a?"vertical":"horizontal",verticalAlign:a?"middle":"bottom",labelFormatter(){return"".concat(ae(this.name).format("MM/DD, HH:mm"))}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,U,W):"displacement"===a?n=function(e,t){const a=e.orientation,n=e.data,r=e.annotations,l=t.subsurface_column,i=t.ts_end;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Displacement Plot, ".concat("across_slope"===a?"Across Slope":"Downslope"," of ").concat(l.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(ae(i).format("D MMM YYYY, HH:mm"),"</b><br><br><b>Note: </b> (+/-) consistently increasing/decreasing trend"),style:{fontSize:"0.6rem"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{plotBands:r,title:{text:"<b>Relative Displacement (mm)</b>"}},tooltip:{header:"{point.x:%Y-%m-%d}: {point.y:.2f}"},plotOptions:{spline:{marker:{enabled:!0}}},credits:{enabled:!1},legend:{enabled:!1},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,U):"velocity_alerts"===a&&(n=function(e,t){const a=e.data,n=e.orientation,r=t.subsurface_column,l=t.ts_end,i="across_slope"===n?"Across Slope":"Downslope",c=a.map(e=>e.name).filter(e=>"number"===typeof e);return c.unshift(0),{series:a,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Velocity Alerts Plot, ".concat(i," of ").concat(r.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(ae(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.6rem"}},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Time</b>"}},legend:{enabled:!1},yAxis:{categories:c,reversed:!0,title:{text:"<b>Nodes</b>"},labels:{formatter(){return this.value}}},tooltip:{formatter(){return"<b>".concat(ae(this.x).format("DD MMM YYYY, HH:mm"),"</b>")}},plotOptions:{line:{marker:{enabled:!0,radius:2}}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,U)),e.push(n)}),K(e),e.length>0&&A&&Y(!0)},[M]),Object(n.useEffect)(()=>{if(B){const e=[];T.current.forEach(t=>{const a=t.current;if(null!==a){const t=a.chart.getSVGForExport();e.push(t)}}),z(e)}},[B,T]);const J=Object(n.useRef)(null);return Object(n.useEffect)(()=>{if(F.length>0){const e=J.current.outerHTML;ai({user_id:s.user_id,tsm_sensor:p,site_code:l.site_code,chart_type:"subsurface",svg:e},e=>{})}},[F]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},!w&&r.a.createElement(ci,e),r.a.createElement(mi,{isSubsurface:!0,selectedRangeInfo:E,setSelectedRangeInfo:h,selectedHourInterval:O,setSelectedHourInterval:x})),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},0===Z.length&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6,key:1},r.a.createElement(f.a,null,r.a.createElement(Fl.a,{highcharts:Gl.a,options:q}))),r.a.createElement(y.a,{item:!0,xs:12,md:6,key:2},r.a.createElement(f.a,null,r.a.createElement(Fl.a,{highcharts:Gl.a,options:q})))),Z.map((e,t)=>{const a=T.current[t];return r.a.createElement(y.a,{item:!0,xs:12,md:6,key:t},r.a.createElement(f.a,null,r.a.createElement(Fl.a,{highcharts:Gl.a,allowChartUpdate:!0,options:e,ref:a})))}))),A&&r.a.createElement(fi.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:2400,viewBox:"0 0 1200 2400",ref:J},F.map((e,t)=>{const a=t%2===1?0:600,l=800*Math.floor(t/2);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:a,y:l,dangerouslySetInnerHTML:{__html:e}}))}))))};var Di=function(e){const t=e.match.params.site_code,a=e.location,n=a.site,l=a.ts_end,i=a.to_include;let c=l,o=a.subsurface_columns,s=Object(u.a)({},i);"undefined"===typeof n&&(c=ne()(),o=[],s={rainfall:!0,surficial:!0});const m={site_code:t,ts_end:c.format("YYYY-MM-DD HH:mm:ss")};return r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ci,e)),s.rainfall&&r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(xi,Object.assign({},e,{input:m,disableBack:!0}))),s.surficial&&r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(hi,Object.assign({},e,{input:m,disableBack:!0}))),o.map(t=>{const a=Object(u.a)(Object(u.a)({},m),{},{tsm_sensor:t});return r.a.createElement(y.a,{key:t,item:!0,xs:12},r.a.createElement(Ii,Object.assign({},e,{input:a,disableBack:!0})))}))};var Mi=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.isMobile,c=e.url,m=Object(n.useState)({value:null,data:{site_code:null}}),d=Object(o.a)(m,2),g=d[0],b=d[1],E=Object(n.useState)(ne()()),h=Object(o.a)(E,2),f=h[0],_=h[1],O=Object(n.useState)({rainfall:!0,surficial:!0,subsurface:{}}),x=Object(o.a)(O,2),j=x[0],C=x[1],w=Object(n.useState)([]),A=Object(o.a)(w,2),I=A[0],D=A[1],M=(e,t=null)=>a=>{const n=a.target.checked;let r=n;if(null!==t){const e=j.subsurface;e[t]=n,r=e}C(Object(u.a)(Object(u.a)({},j),{},{[e]:r}))};Object(n.useEffect)(()=>()=>{_(ne()())},[a]),Object(n.useEffect)(()=>{const e=g.data.site_code;null!==e&&function(e,t){const a="".concat(k,"/api/subsurface/get_site_subsurface_columns/").concat(e);S.a.get(a).then(a=>{const n=a.data;console.log("Subsurface Columns of ".concat(e.toUpperCase()),n),t(n)}).catch(e=>{console.error(e)})}(e,e=>{D([]);const t={};e.forEach(e=>{const a=null===e.date_deactivated;t[e.logger.logger_name]=a}),C(Object(u.a)(Object(u.a)({},j),{},{subsurface:t})),D(e)})},[g.data.site_code]);const N=g.data,T=[];return Object.keys(j.subsurface).forEach(e=>{j.subsurface[e]&&T.push(e)}),r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Consolidate charts per site"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xt,{value:g,changeHandler:e=>b(e)})),r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:f,onChange:e=>_(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:18}},r.a.createElement(Ke.a,{component:"fieldset"},r.a.createElement(aa.a,{component:"legend"},"Charts to Show"),r.a.createElement(na.a,{"aria-label":"position",row:!0},r.a.createElement(Xe.a,{value:"rainfall",control:r.a.createElement(kt.a,{color:"primary",onClick:M("rainfall"),checked:j.rainfall}),label:"Rainfall"}),r.a.createElement(Xe.a,{value:"surficial",control:r.a.createElement(kt.a,{color:"primary",onClick:M("surficial"),checked:j.surficial}),label:"Surficial"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:8}},r.a.createElement(Ke.a,{component:"fieldset"},r.a.createElement(aa.a,{component:"legend"},"Subsurface Columns"),r.a.createElement(na.a,{"aria-label":"position",row:!0},I.map(e=>{const t=e.date_deactivated,a=e.logger.logger_name,n=null===t?"":" (Deactivated)";return r.a.createElement(Xe.a,{key:a,value:a,control:r.a.createElement(kt.a,{color:"primary",onClick:M("subsurface",a),checked:j.subsurface[a]}),label:a.toUpperCase()+n})}),0===I.length&&r.a.createElement(v.a,{variant:"body1"},"No site selected")))),!i&&r.a.createElement("div",{style:{height:120}})),r.a.createElement(et.a,null,r.a.createElement(p.a,{component:s.b,to:{pathname:"".concat(c,"/consolidated/").concat(N.site_code),ts_end:f,site:N,to_include:j,subsurface_columns:T},color:"primary",onClick:l,disabled:null===g.value},"View"),r.a.createElement(p.a,{onClick:l},"Cancel")))}));var Ni=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.setReloadEqEvent,s=Object(n.useState)(null),m=Object(o.a)(s,2),d=m[0],u=m[1],g=Object(n.useState)(null),E=Object(o.a)(g,2),h=E[0],f=E[1],_=Object(n.useState)(0),v=Object(o.a)(_,2),O=v[0],x=v[1],j=Object(n.useState)(0),C=Object(o.a)(j,2),w=C[0],A=C[1],I=Object(n.useState)(ne()()),M=Object(o.a)(I,2),N=M[0],T=M[1],H=Object(n.useState)(!0),R=Object(o.a)(H,2),B=R[0],Y=R[1],P=Object(c.b)(),L=P.enqueueSnackbar,F=P.closeSnackbar,z=D(),G=z.first_name,U=z.last_name,W=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{F(e)}},"Dismiss");Object(n.useEffect)(()=>T(ne()()),[a]),Object(n.useEffect)(()=>{Y(!(h>0&&O>0&&w>0&&d>=0&&d<=10))},[h,d,w,O]);const q=()=>{const e="".concat(G," ").concat(U).split(" ");let t="";e.forEach(e=>{t+=e.charAt(0)});!function(e,t){const a="".concat(k,"/api/analysis/insert_earthquake_event");S.a.post(a,e).then(e=>{t(e)}).catch(e=>{console.error(e)})}({magnitude:d,depth:h,long:O,lat:w,timestamp:N.format("YYYY-MM-DD HH:mm"),issued_by:t},e=>{200===e.status?(L("Success saving earthquake event",{variant:"success",autoHideDuration:7e3,action:W}),i(!0)):L("Error saving earthquake event",{variant:"error",autoHideDuration:7e3,action:W})}),l(!1)},V=(d>10||d<=0)&&null!==d,Q=h<=0&&null!==d;return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Insert Earthquake Event"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(wt.a,{utils:Ct.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(At.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:N,onChange:e=>T(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Magnitude",onChange:e=>u(e.target.value),type:"number",InputProps:{inputProps:{max:10,min:1}},fullWidth:!0,helperText:V?"Insert magnitude from 0.1 to 10":"",error:V}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Depth (km)",defaultValue:"",onChange:e=>f(e.target.value),type:"number",fullWidth:!0,helperText:Q?"Positive numbers only":"",error:Q}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{type:"number",required:!0,label:"Latitude",defaultValue:"",onChange:e=>A(e.target.value)}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Longitude",type:"number",defaultValue:"",onChange:e=>x(e.target.value)}))))),r.a.createElement(et.a,null,r.a.createElement(p.a,{color:"primary",onClick:()=>q(),disabled:B},"Submit"),r.a.createElement(p.a,{onClick:l,color:"secondary"},"Cancel")))})),Ti=a(45),Hi=a.n(Ti),Ri=(a(436),a(808)),Bi=a(809),Yi=a(774),Pi=a(775),Li=a(810),Fi=a(776),zi=a(461),Gi=a.n(zi),Ui=a(462),Wi=a.n(Ui),qi=a(463),Vi=a.n(qi);const Qi=Hi.a.icon({iconUrl:Gi.a,shadowUrl:Wi.a,iconRetinaUrl:Vi.a,iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],shadowAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});var Zi=function(e){const t=e.eqEvents;let a=[12.8797,121.774],l=5;if(e.zoomIn){const e=t[0];a=[e.latitude,e.longitude],l=7}const i=/\.0*$|(?<=\.[0-9]{0,2147483646})0*$/;return r.a.createElement(Ri.a,{style:{height:465},center:a,zoom:l},r.a.createElement(Bi.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map(e=>{const t=e.latitude,a=e.longitude,l=e.magnitude,c=e.depth,o=e.critical_distance,s=e.eq_id,m=[t,a],d=null===o?0:parseFloat(o);return r.a.createElement(n.Fragment,{key:s},r.a.createElement(Yi.a,{center:m,fillColor:"blue",radius:1e3*d}),r.a.createElement(Pi.a,{icon:Qi,position:m},r.a.createElement(Li.a,null,"Magnitude: ",r.a.createElement("strong",null,l.replace(i,""))," ",r.a.createElement("br",null),"Depth: ",r.a.createElement("strong",null,c.replace(i,""))," ",r.a.createElement("br",null),"Critical Distance: ",r.a.createElement("strong",null,d," km"))))}),Nn.map(e=>r.a.createElement(Fi.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},r.a.createElement(Li.a,null,r.a.createElement("strong",null,e.site_code.toUpperCase())," ",r.a.createElement("br",null),le(e,!1)))))};const Ki=Object(gr.a)({overrides:{MUIDataTableBodyCell:{root:{whiteSpace:"nowrap"}}}}),Ji=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}}],Xi=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}},{name:"Sites",options:{filter:!1}}];var $i=function(e){const t=e.eqEvents,a=e.eqAlerts,n=e.eqAlertsPagination,l=e.setEqAlTblPage,i=r.a.useState(0),c=Object(o.a)(i,2),s=c[0],m=c[1],d=r.a.useState([]),p=Object(o.a)(d,2),g=p[0],b=p[1],E=r.a.useState([]),h=Object(o.a)(E,2),f=h[0],_=h[1];r.a.useEffect(()=>{b([...t]);const e=t.map(e=>[ne()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id]);_([...e])},[t]);const O=(e,t)=>{const a=t.filter(t=>t.eq_id===e);b([...a])},x=r.a.useState([]),j=Object(o.a)(x,2),S=j[0],k=j[1];r.a.useEffect(()=>{const e=a.map(e=>{const t=e.eq_alerts.map(e=>e.site.site_code.toUpperCase());return[ne()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id,t.join(", ")]});k([...e])},[a]);const C={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"scrollMaxHeight",onRowClick(e,a,n){O(e[2],t)}},w={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",count:n.count,rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"scrollMaxHeight",serverSide:!0,onChangePage:e=>{const t=e*n.limit;l(Object(u.a)(Object(u.a)({},n),{},{offset:t}))},onRowClick(e,t,n){O(e[2],a)}};return r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(Zi,{eqEvents:g,zoomIn:1===g.length})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(P.a,{position:"static"},r.a.createElement(Z.a,{value:s,onChange:(e,t)=>m(t),variant:"fullWidth"},r.a.createElement(K.a,{label:"EQ Events"}),r.a.createElement(K.a,{label:"EQ Alerts"}))),0===s&&r.a.createElement(br.a,{theme:Ki},r.a.createElement(pr.a,{title:"Latest Earthquake Events",columns:Ji,options:C,data:f,style:{height:465}})),1===s&&r.a.createElement(br.a,{theme:Ki},r.a.createElement(pr.a,{title:r.a.createElement(v.a,{variant:"body1"},"Earthquake Alerts"),columns:Xi,options:w,data:S}))))};function ec(e){return ne()(e).format("D MMMM YYYY, HH:mm")}function tc(e){const t=e.first_name,a=e.last_name;return"".concat(t," ").concat(a)}function ac(e){const t=e.moms_data,a=e.match.params.instance_id,n=t.find(e=>e.instance_id===parseInt(a,10));let l=[],i="";if("undefined"!==typeof n){l=n.moms;const e=n.feature.feature_type,t=n.feature_name;i="".concat(e," - ").concat(t)}const c=function(e){return e.map(e=>{const t=e.observance_ts,a=e.narrative,n=e.reporter,r=e.validator,l=e.op_trigger,i=e.remarks,c=a.narrative,o=a.timestamp;return[ec(t),c,ec(o),tc(n),tc(r),i,l]})}(l);return r.a.createElement(f.a,{style:{marginTop:16}},r.a.createElement(pr.a,{title:r.a.createElement(v.a,{variant:"h6"},"Manifestation of Movement Reports ",r.a.createElement("span",{style:{fontSize:"small"}},i.toUpperCase())),columns:["Observance Timestamp","Narrative","Report Timestamp","Reporter","Validator","Remarks","Alert Level"],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"scrollMaxHeight"},data:c}))}var nc=function(e){const t=e.history,a=e.match,l=a.url,i=a.params.site_code,c=Object(n.useState)([]),s=Object(o.a)(c,2),d=s[0],u=s[1],p=Object(n.useState)([]),g=Object(o.a)(p,2),b=g[0],E=g[1];Object(n.useEffect)(()=>{!function(e,t){const a="".concat(k,"/api/manifestations_of_movement/get_moms_instances/").concat(e);S.a.get(a).then(a=>{const n=a.data;console.log("MOMs Instances of ".concat(e.toUpperCase()),n),t(n)}).catch(e=>{console.error(e)})}(i,e=>{const t=e.map(e=>{const t=e.feature.feature_type,a=e.feature_name,n=e.moms,r=e.instance_id,l=e.location,i=t.charAt(0).toUpperCase()+t.slice(1),c=n[0];let o=[];if("undefined"!==typeof c){const e=c.observance_ts,t=c.op_trigger;o=[i,a,l,ec(e),t,r]}return o}).filter(e=>e.length>0).sort((e,t)=>t[4]-e[4]);E(t),u(e)})},[]);const h=Object(n.useState)(!1),_=Object(o.a)(h,2),y=_[0],v=_[1],O=e=>()=>v(e);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(ci,e),r.a.createElement(or,{clickHandler:O(!0)})),r.a.createElement(f.a,{style:{marginTop:16}},r.a.createElement(pr.a,{title:"Manifestation of Movement Features of ".concat(i.toUpperCase()),columns:["Type",{name:"Name",options:{filter:!1}},{name:"Location",options:{filter:!1}},{name:"Last Observance Timestamp",options:{filter:!1}},"Alert Level",{name:"data",options:{display:!1,viewColumns:!1,filter:!1}}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"scrollMaxHeight",onRowClick(e,a,n){const r=e[5];t.push("".concat(l,"/").concat(r))}},data:b})),r.a.createElement(ir,Object.assign({},e,{isOpen:y,closeHandler:O(!1)})),r.a.createElement(m.b,{path:"".concat(l,"/:instance_id"),render:e=>r.a.createElement(ac,Object.assign({},e,{moms_data:d}))}))};let rc;Pl()(Bl.a);const lc=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})}),ic=()=>r.a.createElement(Te.a,{height:600,width:400,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("rect",{x:"0",y:"0",rx:"0",ry:"0",width:"400",height:"600"}));function cc(e,t){return r.a.createElement("span",null,r.a.createElement(p.a,{"aria-label":"Insert Earthquake Event",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:t(!0),startIcon:r.a.createElement(Tl.a,null)},"Insert Earthquake Event"),r.a.createElement(p.a,{"aria-label":"Consolidate by site",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:e(!0),startIcon:r.a.createElement(Hl.a,null)},"Consolidate by site"))}function oc(e,t){const a=[];return e&&0!==Object.keys(e).length&&e.xAxis[0]&&e.series[0].points.forEach(e=>{a.push(function(e,t){const a=t.data,n=t.type,i=t.dataLabel;return r.a.createElement("div",{key:a},Object(l.createPortal)(r.a.createElement(s.b,{to:"".concat(e,"/").concat(n,"/").concat(a),style:{fontSize:i.options.style.fontSize,position:"absolute",fontFamily:"Lucida Grande, Lucida Sans Unicode, Arial Helvetica, sans-serif",color:"#000000"}},a.toUpperCase()),i.div))}(t,e))}),a}function sc(e,t,a){const n=t.charAt(0).toUpperCase()+t.slice(1),r="<b>".concat(n," Data Availability</b>");let l=50,i=60,c="Timestamp: <b>".concat(rc.format("D MMM YYYY, HH:mm"),"</b>");switch(t){case"surficial":c+="<br/>Note: Data presence within four hours until next release<br/><b>*Sites without markers</b>";break;case"subsurface":l=85,i=100;break;case"loggers":l=95,i=100}e&&(l+=i);return{chart:{type:"heatmap",height:700,spacingTop:12,spacingRight:18},title:{text:r,style:{fontSize:"1rem"},y:20},subtitle:{text:c,style:{fontSize:"0.70rem"}},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},colorAxis:{stops:[[0,"#cccccc"],[1,"#7cb5ec"]],min:0,max:1},tooltip:{outside:!0,formatter(){const e=this.point,t=e.label,a=e.type,n=e.value,r=e.event_type,l=e.ts_last_data,i=e.ts_updated,c=e.diff_days,o=n?"With":"No";let s;switch(a){case"rainfall":s="Rain gauge";break;case"surficial":s="Site";break;case"subsurface":s="Sensor";break;case"loggers":s="Logger"}let m="".concat(s,": <b>").concat(t,"</b><br/>")+"Presence: <b>".concat(o," data</b><br/>")+"Last data timestamp: <b>".concat(ne()(l).format("D MMM YYYY, HH:mm"),"</b><br/>");return m+="surficial"!==a?"<br/>Last update timestamp: <b>".concat(ne()(i).format("D MMM YYYY, HH:mm"),"</b><br/>")+"Days since last data: <b>".concat(c,"</b><br/>"):"Event type: <b>".concat(r,"</b>"),m}},credits:{enabled:!1},series:[{name:"",borderWidth:1,borderColor:"#444444",data:function(e,t,a){const n=[];let r=0;return e.forEach((e,a)=>{const l=e.last_data,i=e.ts_updated,c=e.diff_days,o=e.event_type;let s,m;const d=e.presence;"surficial"===t?(s=e.site_code,m=s,e.has_surficial_markers||(s+="*")):"rainfall"===t?(s=e.rain_gauge.gauge_name,m=s):"subsurface"===t?(s=e.tsm_sensor.logger.logger_name,m=s):(s=e.logger.logger_name,m=s);const u={x:a%5,y:5-r,value:d,label:s.toUpperCase(),data:m,type:t,ts_last_data:l,ts_updated:i,diff_days:c,event_type:o};n.push(u);a%5===4&&(r+=1)}),n}(a,t),dataLabels:{enabled:!0,useHTML:!0,color:"#000000",display:"none",style:{fontWeight:100},formatter(){return this.point.label}}}]}}var mc=Object(te.a)()((function(e){const t=e.width,a=e.location,l=e.match,i=l.path,c=l.url,d=lc(),p=Object(te.b)(t,"sm");rc=ne()();const g=Object(n.useState)(!1),b=Object(o.a)(g,2),E=b[0],h=b[1],_=Object(n.useState)(!1),v=Object(o.a)(_,2),O=v[0],x=v[1],j=e=>()=>h(e),C=e=>()=>x(e),w=Object(n.useState)([]),A=Object(o.a)(w,2),I=A[0],D=A[1],M=Object(n.useState)(null),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)(null),B=Object(o.a)(R,2),Y=B[0],P=B[1],L=Object(n.useState)([]),F=Object(o.a)(L,2),z=F[0],G=F[1],U=Object(n.useState)(null),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=Object(n.useState)(null),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)([]),$=Object(o.a)(X,2),ee=$[0],ae=$[1],re=Object(n.useState)(null),ie=Object(o.a)(re,2),ce=ie[0],oe=ie[1],se=Object(n.useState)(null),me=Object(o.a)(se,2),de=me[0],ue=me[1],pe=Object(n.useState)([]),ge=Object(o.a)(pe,2),be=ge[0],Ee=ge[1],he=Object(n.useState)(null),fe=Object(o.a)(he,2),_e=fe[0],ye=fe[1],Oe=Object(n.useState)({}),xe=Object(o.a)(Oe,2),je=xe[0],Se=xe[1],ke=Object(n.useState)(null),Ce=Object(o.a)(ke,2),Ae=Ce[0],Ie=Ce[1],De=e=>t=>{Se(a=>Object(u.a)(Object(u.a)({},a),{},{[e]:t}))};Object(n.useEffect)(()=>{ti("surficial",e=>{G(e)}),ti("tsm",e=>{D(e)}),ti("rain_gauges",e=>{ae(e)}),ti("loggers",e=>{Ee(e)})},[]),Object(n.useEffect)(()=>{if(z.length>0){const e=sc(!p,"surficial",z);V(e)}},[z,p]),Object(n.useEffect)(()=>{if(I.length>0){const e=sc(!p,"subsurface",I);H(e)}},[I,p]),Object(n.useEffect)(()=>{if(ee.length>0){const e=sc(!p,"rainfall",ee);oe(e)}},[ee,p]),Object(n.useEffect)(()=>{if(be.length>0){const e=sc(!p,"loggers",be);ye(e)}},[be,p]),Object(n.useEffect)(()=>{const e=oc(je.rainfall,c);ue(e)},[je.rainfall,c]),Object(n.useEffect)(()=>{const e=oc(je.surficial,c);J(e)},[je.surficial,c]),Object(n.useEffect)(()=>{const e=oc(je.subsurface,c);P(e)},[je.subsurface,c]);const Me=Object(n.useContext)(ve).setIsReconnecting;Object(n.useEffect)(()=>{var e;return rt(Me),e=e=>{const t=e.rainfall_summary,a=e.ts,n=function(e,t){const a=e.site_codes,n=e.list_1d,r=e.list_3d,l=null===t?"---":ne()(t).format("D MMM YYYY, HH:mm");return{chart:{type:"column"},title:{text:"<b>Cumulative Rainfall Data vs Threshold Plot of Dynaslope Sites</b>",style:{fontSize:"1rem"},y:20},subtitle:{text:"As of: <b>".concat(l,"</b><br>Note: Percentage capped at 100%")},xAxis:{categories:a,title:{text:"<b>Sites</b>"}},yAxis:{min:0,max:100,title:{text:"<b>Threshold Ratio (%)</b>"}},tooltip:{shared:!0,useHTML:!0,formatter(){const e=this.x,t=this.points,a=t[0].point.data_source.replace(/_/g," ");let n="<b>".concat(e," (").concat(a.toUpperCase(),")</b><br>");return t.forEach(e=>{n+="".concat(e.point.data_value,"<br>"),n+="- Percentage: <b>".concat(e.point.y.toFixed(2),"%</b><br>")}),n}},plotOptions:{column:{grouping:!1,shadow:!1}},series:[{name:"Three-day Cumulative Data",data:r,pointPadding:0,color:"#FF0000"},{name:"One-day Cumulative Data",data:n,pointPadding:.2}],credits:{enabled:!1}}}(function(e){const t=[],a=[],n=[];return e.forEach(e=>{const r=e.site_code,l=e["1D cml"],i=e["3D cml"],c=e["half of 2yr max"],o=e["2yr max"],s=e.DataSource,m=l?"".concat(l," mm"):"0 mm",d=i?"".concat(i," mm"):"0 mm",u={y:l/c*100,data_value:"<b><i>One Day Data</i></b><br>- Cumulative Data: <b>".concat(m,"</b><br>- Threshold: <b>").concat(c," mm</b>"),data_source:s},p={y:i/o*100,data_value:"<b><i>Three Day Data</i></b><br>- Cumulative Data: <b>".concat(d,"</b><br>- Threshold: <b>").concat(o," mm</b>"),data_source:s};t.push(u),a.push(p),n.push(r.toUpperCase())}),{list_1d:t,list_3d:a,site_codes:n}}(t),a);Ie(n)},nt(),at.on("receive_rainfall_data",t=>{const a=JSON.parse(t);console.log("All Site Rainfall Data: ",a),e(a)}),function(){it()}},[]);const Ne=Object(n.useState)([]),Te=Object(o.a)(Ne,2),He=Te[0],Re=Te[1];Object(n.useEffect)(()=>{const e=[];!function(e){const t="".concat(k,"/api/manifestations_of_movement/get_latest_alerts");S.a.get(t).then(t=>{const a=t.data;console.log("MOMs Alerts",a),e(a)}).catch(e=>{console.error(e)})}(t=>{t.forEach(t=>{const a=t.site_code,n=t.moms_alert,r={site_code:a,address:le(t,!0,"start"),moms_alert:n};e.push(r)}),Re(e)})},[c]);const Be=[{name:"address",label:"Site",options:{filter:!1,customBodyRender:(e,{rowIndex:t})=>{const a=He[t].site_code;return r.a.createElement(s.b,{to:"".concat(c,"/moms/").concat(a),style:{color:"black"}},e)}}},{name:"moms_alert",label:"Alert"}],Ye=Object(n.useState)([]),Pe=Object(o.a)(Ye,2),Le=Pe[0],Fe=Pe[1],ze=Object(n.useState)(!0),Ge=Object(o.a)(ze,2),Ue=Ge[0],We=Ge[1];Object(n.useEffect)(()=>{Ue&&(!function(e){const t="".concat(k,"/api/analysis/get_earthquake_events");S.a.get(t).then(t=>{const a=t.data;console.log("Earthquake Events",a),e(a)}).catch(e=>{console.error(e)})}(e=>{Fe(e)}),We(!1))},[Ue]);const qe=r.a.useState([]),Ve=Object(o.a)(qe,2),Qe=Ve[0],Ze=Ve[1],Ke=r.a.useState({limit:5,offset:0,count:0}),Je=Object(o.a)(Ke,2),Xe=Je[0],$e=Je[1],et=r.a.useState(!0),tt=Object(o.a)(et,2),lt=tt[0],ct=tt[1];r.a.useEffect(()=>{!function(e,t){const a=e.limit,n=e.offset,r="".concat(k,"/api/analysis/get_earthquake_alerts")+"?limit=".concat(a,"&offset=").concat(n);S.a.get(r).then(e=>{const a=e.data;console.log("Earthquake Alerts",a),t(a)}).catch(e=>{console.error(e)})}(Xe,e=>{const t=e.count,a=e.data;Ze([...a]),lt&&(ct(!1),$e(Object(u.a)(Object(u.a)({},Xe),{},{count:t})))})},[Xe,lt]);const ot=a.pathname===i;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(we,{title:"Analysis | Site Data Analytics",customButtons:!(!p||!ot)&&cc(j,C)})),r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(m.d,{location:a},r.a.createElement(m.b,{exact:!0,path:c,render:e=>r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==q?r.a.createElement(f.a,{elevation:2},r.a.createElement(Fl.a,{highcharts:Bl.a,options:q,callback:De("surficial"),allowChartUpdate:!1}),K):r.a.createElement(ic,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==ce?r.a.createElement(f.a,{elevation:2},r.a.createElement(Fl.a,{highcharts:Bl.a,options:ce,callback:De("rainfall"),allowChartUpdate:!1}),de):r.a.createElement(ic,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==T?r.a.createElement(f.a,{elevation:2},r.a.createElement(Fl.a,{highcharts:Bl.a,options:T,callback:De("subsurface"),allowChartUpdate:!1}),Y):r.a.createElement(ic,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==_e?r.a.createElement(f.a,{elevation:2},r.a.createElement(Fl.a,{highcharts:Bl.a,options:_e,callback:De("loggers"),allowChartUpdate:!1})):r.a.createElement(ic,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12},null!==Ae?r.a.createElement(f.a,{elevation:2},r.a.createElement(Fl.a,{highcharts:Bl.a,options:Ae})):r.a.createElement("div",null,"Loading...")),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:7},r.a.createElement(f.a,{elevation:2},r.a.createElement($i,{eqEvents:Le,eqAlerts:Qe,eqAlertsPagination:Xe,setEqAlTblPage:$e}))),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:5},r.a.createElement(f.a,{elevation:2},r.a.createElement(pr.a,{title:"Latest MOMs Alert",columns:Be,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:6,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"scrollMaxHeight"},data:He}))))}),r.a.createElement(m.b,{path:"".concat(c,"/surficial/:site_code"),render:e=>r.a.createElement(hi,Object.assign({},e,{width:t}))}),r.a.createElement(m.b,{path:"".concat(c,"/rainfall/:rain_gauge"),render:e=>r.a.createElement(xi,Object.assign({},e,{width:t}))}),r.a.createElement(m.b,{path:"".concat(c,"/subsurface/:tsm_sensor"),render:e=>r.a.createElement(Ii,Object.assign({},e,{width:t,chartType:"subsurface"}))}),r.a.createElement(m.b,{path:"".concat(c,"/moms/:site_code"),render:e=>r.a.createElement(nc,Object.assign({},e,{width:t}))}),r.a.createElement(m.b,{path:"".concat(c,"/consolidated/:site_code"),render:e=>r.a.createElement(Di,Object.assign({},e,{width:t}))}))),r.a.createElement(Mi,{isOpen:E,clickHandler:j(!1),url:c}),r.a.createElement(Ni,{isOpen:O,clickHandler:C(!1),setReloadEqEvent:We}))})),dc=a(750),uc=a(789),pc=a(790),gc=a(755),bc=a(806),Ec=a(782),hc=a(783),fc=a(784),_c=a(785),yc=a(118),vc=a.n(yc),Oc=a(779);var xc=function(e){const t=e.onClose,a=e.open,n=e.isUnregistered,l=e.setBlockModal,i=e.setSaveContactModal;return r.a.createElement(qe.a,{onClose:()=>{t()},"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(Ve.a,{id:"simple-dialog-title"},"Message options"),r.a.createElement(bn.a,null,n&&r.a.createElement(hn.a,{button:!0,onClick:()=>{t(),i(!0)}},r.a.createElement(_n.a,null,r.a.createElement(Br.a,null)),r.a.createElement(fn.a,{primary:"Save number"})),r.a.createElement(hn.a,{button:!0,onClick:()=>{t(),l(!0)}},r.a.createElement(_n.a,null,r.a.createElement(Oc.a,null)),r.a.createElement(fn.a,{primary:"Block number"}))))};var jc=r.a.memo((function(e){const t=e.open,a=e.setBlockModal,l=e.mobileDetails,i=e.setOpenOptions,s=l.sim_num,m=l.mobile_id,d=Object(c.b)(),u=d.enqueueSnackbar,g=d.closeSnackbar,E=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{g(e)}},"Dismiss"),h=Object(n.useState)(""),f=Object(o.a)(h,2),_=f[0],y=f[1],v=Object(n.useState)(null),O=Object(o.a)(v,2),x=O[0],j=O[1],C=D().user_id;return r.a.createElement(qe.a,{open:t,onExited:()=>y(""),"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Block mobile number (+".concat(s,")")),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Provide the reason for blocking this mobile number from Chatterbox"),r.a.createElement(b.a,{autoFocus:!0,value:_,onChange:e=>{const t=e.target.value;y(t);let a="";""===t&&(a="This is a required field"),j(a)},margin:"dense",id:"reason",label:"Reason",multiline:!0,fullWidth:!0,required:!0,placeholder:"Enter reason",inputProps:{maxLength:500},error:""===_,helperText:x})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:()=>a(!1),color:"primary"},"Cancel"),r.a.createElement(p.a,{onClick:()=>{if(""===_)j("This is a required field");else{a(!1);const e={mobile_id:m,reporter_id:C,reason:_};console.log(e),function(e,t){const a="".concat(k,"/api/contacts/save_block_number");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save blocked contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const t=e.status,a=e.message;console.log(e),u(a,t?{variant:"success",autoHideDuration:4e3,action:E}:{variant:"error",autoHideDuration:3e3,action:E})}),i(!1)}},color:"secondary"},"Block")))})),Sc=a(780),kc=a(781),Cc=a(341),wc=a.n(Cc);const Ac={0:["LEWC"],1:["LGU","NGO"],2:["LGU","NGO","PNP"],3:["LGU","NGO","PNP"],4:["NGO","OCD","PHIVOLCS","DOST"],5:["NGO","OCD","PHIVOLCS","DOST","MGB"]},Ic=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],Dc=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Mc(e,t){let a=[];if("municipality"===t){a=[...e.map(({municipality:e,province:t})=>({id:e,label:"".concat(e,", ").concat(t)}))]}else if(["province","region"].includes(t)){a=[...[...new Set(e.map(e=>e[t]).sort())].map(e=>({id:e,label:e}))]}return a}function Nc(e){const t=e.inputRef,a=e.mask,n=Object(Rt.a)(e,["inputRef","mask"]);return r.a.createElement(wc.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function Tc(e,t){const a=[];return"mobile"===t?e.forEach((e,t)=>{const n=e.mobile_number;n.sim_num=n.sim_num.replace(/[()+-\s]/g,""),a.push(e)}):e.forEach((e,t)=>{delete e.mobile_id;void 0===e.landline_id&&(e.landline_id=0),e.landline_num=e.landline_num.replace(/[()+-\s]/g,""),a.push(e)}),a}function Hc(e,t){const a=t.type,n=t.category,r=t.payload,l=[...e];let i={status:1,has_delete:!0};switch("email"===n?i="":"mobile"===n?i=Object(u.a)(Object(u.a)({},i),{},{mobile_number:{sim_num:"",mobile_id:0}}):"landline"===n&&(i=Object(u.a)(Object(u.a)({},i),{},{landline_num:""})),a){case"UPDATE":return"email"===n?l[r.key]=r.value:"mobile"===n&&"sim_num"===r.data?l[r.key].mobile_number[r.data]=r.value:l[r.key][r.data]=r.value,[...l];case"ADD":return[...l,i];case"DELETE":return l.splice(r.key,1),[...l]}return[]}function Rc(e){return Ac[e].map(e=>({id:e.toLowerCase(),label:e}))}var Bc=r.a.memo((function(e){const t=e.setContactForm,a=e.chosenContact,l=e.isEditMode,i=e.setContactFormForEdit,s=e.handleClose,m=e.isFromChatterbox,d=e.setSnackbarKey;let g=[{mobile_number:{sim_num:"",mobile_id:0},status:1}],E=[],h=[],f=0,_="",O=[],x="",j="",C=!0,w=!0,A=0,I={first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0};if(l||m){const e=a.mobile_numbers,t=a.ewi_recipient,n=a.ewi_restriction,r=a.landline_numbers,l=a.emails,i=a.first_name,c=a.last_name,o=a.middle_name,s=a.nickname,m=a.user_id,d=a.organizations,u=a.status;if(I={first_name:i,last_name:c,middle_name:o,nickname:s,user_id:m},0!==d.length){const e=d[0].organization,t=e.scope,a=e.name,n=d[0].site;f=t,_=a,O=Rc(t);const r=function(e,t){const a=t.municipality,n=t.province,r=t.region,l=t.site_id;let i="",c="";return 0===e||1===e?(i={value:l},c=""):2===e?(i="",c=a):3===e?(i="",c=n):4===e&&(i="",c=r),{site:i,location:c}}(t,n);x=r.site,j=r.location}if(null!==n&&0!==n.length){A=n.alert_level}g=e.map((e,t)=>{const a=JSON.parse(JSON.stringify(e)),n=a.mobile_number.sim_num;var r;return a.mobile_number.sim_num=(r=n,Object(Cc.conformToMask)(r,Dc).conformedValue),a}),E=r,h=l,w=1===t,C=1===u}const D=Object(n.useContext)(ve).sites,M=[{id:0,label:"Community"},{id:1,label:"Barangay"},{id:2,label:"Municipal",select_label:"Municipality",list:Mc(D,"municipality")},{id:3,label:"Provincial",select_label:"Province",list:Mc(D,"province")},{id:4,label:"Regional",select_label:"Region",list:Mc(D,"region")},{id:5,label:"National"}],N=Object(n.useState)(I),T=Object(o.a)(N,2),H=T[0],R=T[1],B=Object(n.useState)(f),Y=Object(o.a)(B,2),P=Y[0],L=Y[1],F=Object(n.useState)(x),G=Object(o.a)(F,2),U=G[0],W=G[1],q=Object(n.useState)(j),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(O),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)(_),te=Object(o.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useReducer)(Hc,g),le=Object(o.a)(re,2),ie=le[0],ce=le[1],oe=Object(n.useReducer)(Hc,E),se=Object(o.a)(oe,2),me=se[0],de=se[1],ue=Object(n.useReducer)(Hc,h),pe=Object(o.a)(ue,2),ge=pe[0],be=pe[1],Ee=Object(n.useState)(w),he=Object(o.a)(Ee,2),fe=he[0],_e=he[1],ye=Object(n.useState)(C),Oe=Object(o.a)(ye,2),xe=Oe[0],je=Oe[1],Se=Object(c.b)(),ke=Se.enqueueSnackbar,Ce=Se.closeSnackbar,we=Object(n.useState)(A),Ae=Object(o.a)(we,2),Ie=Ae[0],De=Ae[1],Me=Object(n.useState)(!1),Te=Object(o.a)(Me,2),He=Te[0],Re=Te[1],Be=()=>(m&&s(),l?i(!1):t(!1)),Ye=e=>t=>{R(Object(u.a)(Object(u.a)({},H),{},{[e]:t.target.value}))},Pe=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{Ce(e)}},"Dismiss");Object(n.useEffect)(()=>{if(""!==P){const e=Rc(P);$(e),l||(W(""),Z(""),ne(""))}},[P]),Object(n.useEffect)(()=>{let e=!0;e=function(e,t,a){const n=e.first_name,r=e.last_name,l=a.scope,i=a.site,c=a.office,o=a.location,s=t.mobile_nums,m=t.landline_nums;let d=!1,u=!1,p=!1,g=null;return s.forEach((e,t)=>{const a=e.mobile_number.sim_num;!1===d&&(d=""===a||a.includes("x"))}),0!==m.length&&m.forEach((e,t)=>{const a=e.landline_num;!1===p&&(p=""===a||a.includes("x"))}),0===l||1===l?u=""===i||""===c:2===l||3===l||4===l?u=""===o||""===c:5===l&&(u=""===o),g=""===n||""===r||!0===d||!0===u||!0===p,g}(H,{mobile_nums:ie,landline_nums:me},{scope:P,site:U,office:ae,location:Q}),Re(e)},[H,ie,me,P,U,ae,Q]);const Le=()=>{const e=Tc(ie,"mobile"),t=Tc(me,"landline"),a=fe?1:0,n=xe?1:0;!function(e,t){const a="".concat(k,"/api/contacts/save_contact");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}({user:Object(u.a)(Object(u.a)({},H),{},{emails:ge,ewi_recipient:a,restriction:Ie,status:n}),affiliation:{site:U,location:Q,scope:P,office:ae},contact_numbers:{mobile_numbers:e,landline_numbers:t}},e=>{const t=e.status,a=e.message;let n;!0===t?(Be(),(()=>{if(!m){const e=ke("Updating contacts list...",{variant:"warning",persist:!0});d(e)}})(),n="success"):n="error",ke(a,{variant:n,autoHideDuration:5e3,action:Pe})})};return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},!m&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"-webkit-center"}},r.a.createElement(bc.a,null,r.a.createElement(Sc.a,null))),r.a.createElement(y.a,{item:!0,xs:9},r.a.createElement(v.a,{variant:"h5",align:"center"},"Contact Form")),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(z.a,{edge:"start",onClick:Be},r.a.createElement(Ot.a,null))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Personal Details")),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"First Name",value:H.first_name,onChange:Ye("first_name"),margin:"dense",required:!0,error:""===H.first_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Last Name",value:H.last_name,onChange:Ye("last_name"),margin:"dense",required:!0,error:""===H.last_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Middle Name",value:H.middle_name,onChange:Ye("middle_name"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Nickname",value:H.nickname,onChange:Ye("nickname"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Affiliation")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ba,{div_id:"scope",label:"Scope",changeHandler:e=>L(e.target.value),value:P,list:M,mapping:{id:"id",label:"label"},required:!0,error:""===P})),[0,1].includes(P)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Xt,{value:U,changeHandler:e=>W(e)})),[2,3,4].includes(P)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(ba,{div_id:"location",label:M[P].select_label,changeHandler:e=>Z(e.target.value),value:Q,list:M[P].list,mapping:{id:"id",label:"label"},required:!0,error:""===Q})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(ba,{div_id:"office",label:"Office",changeHandler:e=>ne(e.target.value),value:ae,list:X,mapping:{id:"id",label:"label"},required:!0,error:""===ae})),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Ke.a,null,r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:xe,onChange:e=>je(e.target.checked),value:"checkedA",color:"primary"}),label:"Active"}))),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Ke.a,null,r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:fe,onChange:e=>_e(e.target.checked),value:"checkedB",color:"primary"}),label:"EWI Recipient"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ba,{div_id:"ewi_restriction",label:"Ewi Restriction",changeHandler:e=>De(e.target.value),value:Ie,list:[{id:0,label:"No restrictions"},{id:1,label:"Do not send on Alert 1"},{id:2,label:"Do not send on Alert 2 and below"}],mapping:{id:"id",label:"label"},required:!0,error:""===Ie})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},"Mobile")),ie.map((e,t)=>{const a=e.mobile_number.sim_num,l=e.status,i="undefined"!==typeof e.has_delete;let c=!0;return c=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(Ke.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Mobile Number",value:a,onChange:e=>ce({type:"UPDATE",payload:{data:"sim_num",value:e.target.value,key:t},category:"mobile"}),InputProps:{inputComponent:Nc,inputProps:{mask:Ic}},required:!0,error:c}))),r.a.createElement(y.a,{item:!0,xs:3,style:{textAlign:"center"}},r.a.createElement(Xe.a,{style:{margin:0},control:r.a.createElement(kt.a,{checked:Boolean(l),onChange:e=>ce({type:"UPDATE",payload:{data:"status",value:e.target.checked?1:0,key:t},category:"mobile"}),color:"primary"}),label:"Active"})),0!==t&&i?r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(z.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>ce({type:"DELETE",payload:{key:t}})},r.a.createElement(hl.a,null))):r.a.createElement(fi.a,null,r.a.createElement(y.a,{item:!0,xs:2})))}),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(kc.a,null),onClick:()=>ce({type:"ADD",category:"mobile"})},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},"Landline")),0===me.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No landline number saved")),me.map((e,t)=>{const a=e.landline_num;let l=!0;return l=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Ke.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Landline Number",value:a,onChange:e=>de({type:"UPDATE",payload:{data:"landline_num",value:e.target.value,key:t},category:"landline"}),InputProps:{inputComponent:Nc,inputProps:{mask:[/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/]}},required:!0,error:l}))),r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(z.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>de({type:"DELETE",payload:{key:t}})},r.a.createElement(hl.a,null))))}),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(kc.a,null),onClick:()=>de({type:"ADD",category:"landline"})},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},"Email")),0===ge.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),ge.map((e,t)=>r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Ke.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Email",value:e.email,onChange:e=>be({type:"UPDATE",payload:{value:e.target.value,key:t},category:"email"})}))),r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(z.a,{edge:"end",size:"small","aria-label":"delete",onClick:()=>be({type:"DELETE",payload:{key:t}})},r.a.createElement(hl.a,null))))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(kc.a,null),onClick:()=>be({type:"ADD",category:"email"})},"Add email")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"16px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",style:{marginRight:6},onClick:()=>Le(),disabled:He},"Save"),r.a.createElement(p.a,{variant:"contained",onClick:Be},"Cancel")))}));var Yc=r.a.memo((function(e){const t=e.open,a=e.setSaveContactModal,l=e.mobileDetails,i=l.sim_num,s=l.mobile_id,m={emails:[],ewi_recipient:[],ewi_restriction:[],landline_numbers:[],first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0,organizations:[],status:0,mobile_numbers:[{mobile_number:{sim_num:i,mobile_id:s},priority:0,status:1}]},d=Object(n.useContext)(_o).contacts,u=Object(n.useState)("existing"),g=Object(o.a)(u,2),b=g[0],E=g[1],h=Object(n.useState)(!0),f=Object(o.a)(h,2),_=f[0],v=f[1],O=Object(n.useState)(null),x=Object(o.a)(O,2),j=x[0],C=x[1],w=Object(n.useState)(!0),A=Object(o.a)(w,2),I=A[0],D=A[1],M=Object(c.b)().enqueueSnackbar,N=d.map(e=>{const t=e.user_id,a=e.first_name,n=e.last_name;return{label:"".concat(a," ").concat(n),value:t,data:e}}),T=()=>{a(!1)};return r.a.createElement(qe.a,{open:t,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Save mobile number (+".concat(i,")")),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Choose whether to add number to an existing contact or fill-out a new contact form."),r.a.createElement(Ke.a,{component:"fieldset",style:{display:"flex",marginBottom:16}},r.a.createElement(Je.a,{"aria-label":"save-number-options",name:"save-number-options",row:!0,style:{justifyContent:"space-around"},value:b,onChange:e=>E(e.target.value)},r.a.createElement(Xe.a,{value:"existing",control:r.a.createElement($e.a,null),label:"Add to existing contact"}),r.a.createElement(Xe.a,{value:"new",control:r.a.createElement($e.a,null),label:"Create new contact"}))),"existing"===b&&r.a.createElement(y.a,{container:!0,spacing:2,style:{marginBottom:200}},r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement(Kt,{label:"Contact Person",options:N,value:j,changeHandler:e=>C(e),placeholder:"Type name of contact person",openMenuOnClick:!1,renderDropdownIndicator:!1,isClearable:!0})),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(Pe.a,{title:"Inactive numbers will not receive EWI if a contact is an EWI recipient.",arrow:!0},r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:I,onChange:e=>D(e.target.checked),name:"is_active",color:"primary"}),label:"Set as active"})))),"new"===b&&r.a.createElement(Bc,{setContactForm:e=>{v(!1)},chosenContact:m,isEditMode:_,setContactFormForEdit:e=>{v(e)},handleClose:T,isFromChatterbox:!0})),"existing"===b&&r.a.createElement(et.a,null,r.a.createElement(p.a,{variant:"text",onClick:()=>{!function(e,t){const a="".concat(k,"/api/contacts/attach_mobile_number_to_existing_user");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save contact data reponse",a),t(a)}).catch(e=>{console.error(e)})}({user_id:j.value,mobile_id:s,status:I?1:0},e=>{const t=e.status,a=e.message;let n;!0===t?(T(),n="success"):n="error",M(a,{variant:n,autoHideDuration:4e3})})},color:"secondary"},"Save"),r.a.createElement(p.a,{variant:"text",onClick:T,color:"primary"},"Cancel")))}));const Pc=Object(O.a)(e=>({inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}));function Lc(e){const t=e.user,a=t.first_name,n=t.last_name,r=t.organizations;return{sender:"".concat(a," ").concat(n),orgs:ce(r)}}function Fc(e,t){const a=t.sms_msg,n=t.ts,l=t.source,i=t.send_status,c=t.ts_sent,o=function(e){const t=ne()(e);return t.isSame(ne()(),"day")?t.format("HH:mm"):t.format("MMM D")}(n);return r.a.createElement(y.a,{container:!0,justify:"space-between",spacing:0},r.a.createElement(y.a,{item:!0,xs:1,style:{flexBasis:0,marginRight:6}},"inbox"===l?r.a.createElement(Ec.a,{fontSize:"small"}):r.a.createElement(hc.a,{fontSize:"small"})),r.a.createElement(y.a,{item:!0,xs:!0,className:e.overflowEllipsis},a),r.a.createElement(y.a,{item:!0,style:{marginRight:8},className:e.noFlexGrow},o),r.a.createElement(y.a,{item:!0,style:{paddingTop:2,marginRight:8}},(0===i||null===i&&null!==c)&&r.a.createElement(fc.a,{className:e.sentIcon}),i>0&&i<=5&&r.a.createElement(ra.a,{color:"primary",className:e.sentIcon}),(-1===i||i>5)&&r.a.createElement(_c.a,{color:"error",className:e.sentIcon})))}var zc=function(e){const t=e.messagesArr,a=e.hidden,l=Pc(),i=Object(u.a)(Object(u.a)({},e),{},{classes:l}),c=r.a.useState(!1),m=Object(o.a)(c,2),d=m[0],p=m[1],g=r.a.useState(!1),b=Object(o.a)(g,2),E=b[0],h=b[1],_=r.a.useState(!1),O=Object(o.a)(_,2),x=O[0],j=O[1],S=r.a.useState(!1),k=Object(o.a)(S,2),C=k[0],w=k[1],A=r.a.useState({}),I=Object(o.a)(A,2),D=I[0],M=I[1],N=(e,t)=>{h(e),M(t),p(!0)};return r.a.createElement(n.Fragment,null,0===t.length?r.a.createElement(f.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?l.hidden:""},r.a.createElement("div",null,"No conversations")):r.a.createElement(bn.a,{dense:!0,className:a?l.hidden:""},t.map(e=>function(e,t,a){const n=e.messages,l=e.mobile_details,i=Object(o.a)(n,1)[0],c=t.classes,m=t.url,d=t.width,u=t.async,p=t.is_desktop,g=l.mobile_id,b=l.sim_num,E=l.user_details,h=se(b);let f=h,_=[];const O=null===E;if(!O){const e=Lc(E);f=e.sender,_=e.orgs}return r.a.createElement(s.b,{to:{pathname:"".concat(m,"/").concat(g),state:{async:u}},key:g,className:c.link},r.a.createElement(hn.a,{alignItems:"center",button:!0},r.a.createElement(gc.a,null,r.a.createElement(bc.a,{alt:f,src:vc.a,className:c.bigAvatar})),r.a.createElement(fn.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0,className:c.noFlexGrow},r.a.createElement(v.a,{variant:"body1",style:{marginRight:8},className:c.overflowEllipsis},f)),_.map((e,t)=>{const a=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:c.noFlexGrow},r.a.createElement(Yt.a,{color:a,size:"small",label:e}))}),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,style:{textAlign:Object(te.c)("sm",d)?"right":"left"}},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},h)),r.a.createElement(y.a,{item:!0,xs:!0,style:{textAlign:"right",flexGrow:p?0:1,flexBasis:"auto"}},r.a.createElement(z.a,{size:"small",onClick:e=>{e.preventDefault(),a(O,l)}},r.a.createElement(St.a,null)))),primaryTypographyProps:{className:c.overflowEllipsis},secondary:n.length>0?Fc(c,i):r.a.createElement("div",{style:{textAlign:"center"}},"No conversation yet"),secondaryTypographyProps:{component:"div"}})))}(e,i,N))),r.a.createElement(xc,{open:d,onClose:e=>{p(!1)},isUnregistered:E,setBlockModal:j,setSaveContactModal:w}),r.a.createElement(jc,{open:x,setBlockModal:j,mobileDetails:D,setOpenOptions:p}),r.a.createElement(Yc,{open:C,setSaveContactModal:w,mobileDetails:D,setOpenOptions:p}))},Gc=a(788),Uc=a(786),Wc=a(787);var qc=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.tagOption,c=e.isMobile,s=e.tagObject,m=e.mobileDetails,d=e.message,u=function(e){const t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],l=a[1],i=S.a.CancelToken.source();return Object(n.useEffect)(()=>{const t="".concat(k,"/api/chatterbox/get_message_tag_options/sms").concat(e,"_users");S.a.get(t,{cancelToken:i.token}).then(({data:e})=>{const t=e.map(e=>({value:e.tag_id,label:e.tag}));l(t)}).catch(e=>{console.log(e)})},[e]),r}(i),g=Object(n.useState)(null),b=Object(o.a)(g,2),E=b[0],h=b[1],f=Object(n.useState)([]),_=Object(o.a)(f,2),y=_[0],v=_[1];return Object(n.useEffect)(()=>{const e=s.tags.map(e=>({value:e.tag_id,label:e.tag.tag}));h(e),v(e)},[s]),r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},"General Data Tagging"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Attach tags to selected data."),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Kt,{label:"Tags",options:u,value:E,changeHandler:e=>h(e),placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),!c&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(et.a,null,r.a.createElement(p.a,{color:"primary",onClick:()=>{const e=s.id,t=s.source,a=s.ts;let n=null;const r=[];if(null!==m.user_details){m.user_details.user.organizations.forEach(e=>{const t=e.site.site_id;!r.includes(t)&&r.push(t)}),n=function(e){let t=e.sim_num;const a=e.user_details;if(null!==a){const e=Lc(a),n=e.sender,r=e.orgs;let l="";r.forEach(e=>{l+="".concat(e," ")}),t=l+n}return t}(m)}const i="inbox"===t?"inbox_id":"outbox_id";let c=[];if(console.log(y,E),y.length>0&&(c=null===E?[...y]:y.filter(e=>!E.some(t=>t.value===e.value))),c.length>0){console.log("missing_tags",c);const a=c.map(e=>e.value),n={tag_type:"sms".concat(t,"_user_tags"),tag_details:{[i]:e,delete_tag_id_list:a}};console.log("delete_payload",n),o=n,u=e=>{console.log("untag response",e)},de("".concat(k,"/api/general_data_tag/handle_delete_tags"),o,u)}var o,u;let p=[];var g;if(null!==E&&(p=E.filter((g=0,e=>e!==y[g]||!++g))),p.length>null){console.log("new_tags",p);const l=p.map(e=>e.value),c={tag_type:"sms".concat(t,"_user_tags"),contact_person:n,message:d,tag_details:{user_id:D().user_id,[i]:e,tag_id_list:l,site_id_list:r,ts:ne()().format("YYYY-MM-DD HH:mm:ss"),ts_message:a}};console.log("PAYLOAD",c),function(e,t){de("".concat(k,"/api/general_data_tag/handle_update_insert_tags"),e,t)}(c,e=>{console.log("tag response",e)})}l()}},"Submit"),r.a.createElement(p.a,{onClick:l},"Cancel")))}));const Vc=Object(O.a)(e=>({root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"},chatItemSent:{justifyContent:"flex-end"},chatBubble:{flexGrow:0,maxWidth:"65%",[e.breakpoints.down("xs")]:{maxWidth:"75%"},[e.breakpoints.up("md")]:{maxWidth:"50%"},paddingLeft:"12px !important",paddingRight:12,paddingTop:12,paddingBottom:6,border:"solid 1px rgba(215, 215, 215, 1)",backgroundColor:"rgba(245, 245, 245, 1)"},chatBubbleReceived:{marginLeft:14,"&:before":{content:"''",left:69,right:"auto",top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:71.5,right:"auto",top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatBubbleSent:{marginRight:14,"&:before":{content:"''",left:"auto",right:69,top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:"auto",right:71.5,top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatMessage:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",fontSize:"0.75rem",lineHeight:"1.25em"},timestampArea:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:12},timestamp:{fontSize:"0.65rem"},tagButton:{padding:0,zIndex:1},sentIcon:{fontSize:"1rem"}}));const Qc=Object(O.a)(e=>{return{arrow:{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}},popper:(t=e.palette.common.black,{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(t," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(t," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(t," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(t)}}}),tooltip:{position:"relative",backgroundColor:e.palette.common.black},tooltipPlacementLeft:{margin:"0 8px"},tooltipPlacementRight:{margin:"0 8px"},tooltipPlacementTop:{margin:"8px 0"},tooltipPlacementBottom:{margin:"8px 0"}};var t});function Zc(e){const t=Qc(),a=t.arrow,n=Object(Rt.a)(t,["arrow"]),l=r.a.useState(null),i=Object(o.a)(l,2),c=i[0],s=i[1],m=e.title;return r.a.createElement(Pe.a,Object.assign({classes:n,PopperProps:{popperOptions:{modifiers:{arrow:{enabled:Boolean(c),element:c}}}}},e,{title:r.a.createElement(r.a.Fragment,null,m,r.a.createElement("span",{className:a,ref:s}))}))}var Kc=function(e){const t=e.message_list,a=e.mobileDetails,l=e.setScrollToBottom,i=Vc(),c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],d=s[1],u=Object(n.useState)(!1),g=Object(o.a)(u,2),b=g[0],E=g[1],h=Object(n.useState)(""),f=Object(o.a)(h,2),_=f[0],y=f[1],O={id:"",source:"",tags:[]},x=Object(n.useState)(O),j=Object(o.a)(x,2),C=j[0],w=j[1],A=Object(n.useState)(1),I=Object(o.a)(A,2),D=I[0],M=I[1],N=Object(n.useState)([]),T=Object(o.a)(N,2),H=T[0],R=T[1];Object(n.useEffect)(()=>{const e=t.slice(0).reverse();d(e),R(e),l(!0)},[t]);const B=(e,t=O,a)=>()=>{w(t),E(e),y(a)},Y=e=>{const t=e.convo_id,a=m.map(e=>(e.convo_id===t&&(e.send_status=0),e));d(a),function(e,t){const a="".concat(k,"/api/chatterbox/resend_message/").concat(e);S.a.get(a).then(e=>{const a=e.data;console.log("Resend message",a),"undefined"!==typeof t&&t(a)}).catch(e=>{console.error(e)})}(t)};return r.a.createElement(n.Fragment,null,0===t.length&&r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"No conversation yet"),H.length>=20&&r.a.createElement(p.a,{color:"primary",size:"small",fullWidth:!0,onClick:()=>{!function(e,t,a){const n="".concat(k,"/api/chatterbox/load_more_messages/").concat(e,"/").concat(t);S.a.get(n).then(e=>{const t=e.data;console.log("Additional loaded messages",t),a(t)}).catch(e=>{console.error(e)})}(a.mobile_id,D,e=>{R(e);const t=e.slice(0).reverse();d(t.concat(m))}),M(D+1)}},r.a.createElement("strong",null,"Load more messages...")),r.a.createElement(bn.a,{className:i.root},m.map(e=>function(e,t,a,l){const i=t.convo_id,c=t.source,s=t.sms_msg,m=t.ts,d=t.ts_sent,u=t.send_status,p=t.tags,g={tags:p,source:c,id:t["".concat(c,"_id")],ts:m},b="outbox"===c,E=ne()(m).format("M/D/YYYY HH:mm:ss"),h=r.a.createElement(gc.a,{style:{textAlign:"-webkit-center"}},r.a.createElement(bc.a,{alt:"Remy Sharp",src:vc.a})),f=p.length>0,_=f?r.a.createElement(Uc.a,{fontSize:"small",color:"primary"}):r.a.createElement(Wc.a,{fontSize:"small",color:"primary"}),y=p.map(e=>e.tag.tag).join(", ");let O=[h,r.a.createElement(fn.a,{className:"".concat(e.chatBubble," ").concat(b?e.chatBubbleSent:e.chatBubbleReceived),primary:r.a.createElement(v.a,{component:"span",className:e.chatMessage,variant:"body2",color:"textPrimary"},r.a.createElement("span",{style:{paddingRight:6,zIndex:1}},s),r.a.createElement(Zc,{disableFocusListener:!0,disableHoverListener:!f,title:y},r.a.createElement(z.a,{className:e.tagButton,onClick:a(!0,g,s)},_))),secondary:r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.timestamp,style:{paddingRight:b?6:0}},E),u>=0&&u<5&&null!==u&&r.a.createElement(Zc,{disableFocusListener:!0,title:"SENDING"},r.a.createElement(fc.a,{className:e.sentIcon})),5===u&&r.a.createElement(Zc,{disableFocusListener:!0,title:"SENT: ".concat(ne()(d).format("M/D/YYYY HH:mm:ss"))},r.a.createElement(ra.a,{color:"primary",className:e.sentIcon})),(-1===u||u>5)&&r.a.createElement(n.Fragment,null,r.a.createElement(Zc,{disableFocusListener:!0,title:"UNSENT"},r.a.createElement(_c.a,{color:"error",className:e.sentIcon})),r.a.createElement(Zc,{disableFocusListener:!0,title:"Resend"},r.a.createElement(Yr.a,{color:"action",className:e.sentIcon,onClick:()=>l(t)})))),secondaryTypographyProps:{component:"div",className:e.timestampArea}})];b&&(O=O.reverse());const x=O,j=Object(o.a)(x,2),S=j[0],k=j[1];return r.a.createElement(hn.a,{alignItems:"flex-start",className:b?e.chatItemSent:"",key:i},S,k)}(i,e,B,Y))),r.a.createElement(qc,{isOpen:b,closeHandler:B(!1),tagOption:C.source,tagObject:C,mobileDetails:a,message:_}))};let Jc;function Xc(){"undefined"!==typeof Jc&&null!==Jc||(Jc=be()("".concat(k,"/communications"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function $c(e,t){Xc(),"chatterbox"===t?(Jc.emit("get_latest_messages"),Jc.emit("get_all_mobile_numbers"),Jc.emit("get_all_contacts")):"contacts"===t&&Jc.emit("get_all_contacts"),Jc.on("reconnecting",()=>{e(!0)}),Jc.on("reconnect",()=>{e(!1)}),Jc.on("reconnect_failed",()=>{console.log("failed")})}function eo(e){Xc(),Jc.on("receive_all_contacts",t=>{console.log("All Contacts",t),e(t)})}function to(){Jc.removeListener("receive_all_contacts")}const ao=Object(O.a)(e=>{const t=Object(V.a)(e);return{regularContainer:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(u.a)({},t.pageContentMargin),divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),sticky:{position:"sticky",top:56,[e.breakpoints.up("sm")]:{top:63},[e.breakpoints.up("md")]:{top:118},backgroundColor:"white",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",zIndex:3},chatHead:{paddingLeft:8,[e.breakpoints.up("md")]:{paddingLeft:0},display:"flex",alignItems:"center"},backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40},noFlexGrow:{flexGrow:0}}}),no=()=>r.a.createElement(Te.a,{height:70,width:800,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",preserveAspectRatio:"xMinYMin slice"},r.a.createElement("rect",{x:"69",y:"7",rx:"4",ry:"4",width:"663",height:"19"}),r.a.createElement("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"293",height:"14"}),r.a.createElement("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"201",height:"6"}),r.a.createElement("circle",{cx:"30",cy:"30",r:"30"})),ro=e=>r.a.createElement(Te.a,{height:160,width:446,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("circle",{cx:"19",cy:"25",r:"16"}),r.a.createElement("rect",{x:"39",y:"12",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"40",y:"29",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"420",cy:"71",r:"16"}),r.a.createElement("rect",{x:"179",y:"76",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"179",y:"58",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"21",cy:"117",r:"16"}),r.a.createElement("rect",{x:"45",y:"104",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"45",y:"122",rx:"5",ry:"5",width:"220",height:"10"}));function lo(e){const t=e.mobile_details,a=e.classes,l=e.saveNumberModal,i=t.user_details,c=se(t.sim_num);let s=c,m=[];const d=Object(n.useState)(null),u=Object(o.a)(d,2),p=u[0],g=u[1],b=null===i;if(!b){const e=Lc(i);s=e.sender,m=e.orgs}return r.a.createElement(y.a,{container:!0,alignItems:"center"},r.a.createElement("div",{style:{marginRight:12}},r.a.createElement(bc.a,{alt:s,src:vc.a,className:a.bigAvatar})),r.a.createElement("div",null,r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(v.a,{variant:"body1",style:{marginRight:8}},s)),m.map((e,t)=>{const n=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:a.noFlexGrow},r.a.createElement(Yt.a,{color:n,size:"small",label:e}))})),!b&&r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},c)),b&&r.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},r.a.createElement(z.a,{size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{g(e.currentTarget)}},r.a.createElement(St.a,null)),r.a.createElement(G.a,{id:"simple-menu",anchorEl:p,getContentAnchorEl:null,keepMounted:!0,open:Boolean(p),onClose:()=>{g(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(U.a,{style:{fontSize:12},key:"save_unknown",onClick:()=>{g(null),l()}},"Save unknown number"))))}const io=e=>t=>{t.preventDefault(),e.goBack()};var co=function(e){const t=e.history,a=e.match.params.mobile_id,l=e.location.state.async,i=e.messageCollection,s=e.socket,m=ao(),d=D(),u=Object(c.b)(),g=u.enqueueSnackbar,b=u.closeSnackbar,E=Object(n.useState)(!1),h=Object(o.a)(E,2),f=h[0],_=h[1],y=Object(n.useState)({message_list:null,mobile_details:{}}),v=Object(o.a)(y,2),O=v[0],x=v[1],j=Object(n.useState)(""),S=Object(o.a)(j,2),k=S[0],C=S[1];Object(n.useEffect)(()=>{var e;return l&&"undefined"!==typeof s&&(s.emit("join_mobile_id_room",a),e=e=>{const t=e.mobile_details,a=e.messages;x({mobile_details:t,message_list:a})},Xc(),Jc.on("receive_mobile_id_room_update",t=>{console.log("Mobile ID Room Update",t),e(t)})),()=>{l&&"undefined"!==typeof s&&(s.emit("leave_mobile_id_room",a),Jc.removeListener("receive_mobile_id_room_update"))}},[s,a]);let w=O.mobile_details,A=O.message_list;if(!l){if(null!==i.inbox){const e=[...i.inbox].filter(e=>e.mobile_details.mobile_id===parseInt(a,10));if(e.length>0){const t=e.pop(),a=t.mobile_details,n=t.messages;w=a,A=n}}}const I=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{b(e)}},"Dismiss"),M=Object(n.useRef)(null),N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1];return Object(n.useEffect)(()=>{M.current.scrollIntoView()},[H]),r.a.createElement(n.Fragment,null,null===A?r.a.createElement("div",{className:m.regularContainer,style:{paddingLeft:16,paddingBottom:0}},r.a.createElement(no,null)):r.a.createElement("div",{className:"".concat(m.regularContainer," ").concat(m.sticky)},r.a.createElement("div",{className:m.chatHead},r.a.createElement(z.a,{"aria-label":"Back",color:"primary",className:m.backButton,onClick:io(t)},r.a.createElement(Gc.a,{className:m.backIcon})),r.a.createElement(lo,{mobile_details:w,classes:m,saveNumberModal:()=>{_(!0)}}))),r.a.createElement("div",{className:m.regularContainer},null===A?r.a.createElement("div",{style:{padding:"0 16px"}},r.a.createElement(ro,{style:{height:"100%"}})):r.a.createElement(Kc,{message_list:A,mobileDetails:w,setScrollToBottom:R})),null!==A&&r.a.createElement(n.Fragment,null,r.a.createElement(Ne.a,{className:m.divider}),r.a.createElement("div",{className:m.chatInputContainer},r.a.createElement(ta,{value:k,disableSend:""===k,messageChangeHandler:e=>C(e.target.value),sendButtonClickHandler:()=>{const e=w,t=e.mobile_id,a=e.gsm_id;Dt({sms_msg:"".concat(k," - ").concat(d.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:[{mobile_id:t,gsm_id:a}]},e=>{e.status?(g("EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:I}),C("")):g(e.message,{variant:"error",autoHideDuration:7e3,action:I})},()=>{g("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:I})})}}))),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:M}),r.a.createElement(Yc,{open:f,setSaveContactModal:_,mobileDetails:w}))};var oo=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.recipientsList;return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send a Message"),r.a.createElement(z.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Qe.a,{style:{overflowY:"hidden"}},r.a.createElement(Ze.a,null,"Choose your recipients and compose a message, then send it."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(sa,{isMobile:t,textboxValue:"",recipientsList:l,modalStateHandler:a}))),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:a,color:"primary"},"Cancel")))}));const so=Object(O.a)(e=>({link:{textDecoration:"none"}}));var mo=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,l=e.setSearchResultsToEmpty,i=e.modalState,c=e.url,m=e.isMobile,d=so(),u=Object(n.useContext)(ve).organizations,g=Object(n.useState)([]),b=Object(o.a)(g,2),E=b[0],h=b[1];Object(n.useEffect)(()=>{const e=u.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}});h(e)},[u]);const f=Object(n.useState)([]),_=Object(o.a)(f,2),y=_[0],v=_[1],O=Object(n.useState)([]),x=Object(o.a)(O,2),j=x[0],S=x[1],k=Object(n.useState)(!1),C=Object(o.a)(k,2),w=C[0],A=C[1];return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:i,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search Chatterbox"),r.a.createElement(z.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Qe.a,{style:{overflowY:"hidden"}},r.a.createElement(Ze.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Kt,{label:"Organizations",options:E,value:j,changeHandler:(I="organizations",e=>{"sites"===I?v(e):"organizations"===I&&S(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Xt,{value:y,changeHandler:e=>v(e),isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:w,onChange:e=>A(e.target.checked),name:"onlyEWIRecipients"}),label:"Only EWI Recipients"})),!m&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:()=>{a(),l()},color:"primary"},r.a.createElement(s.b,{to:{pathname:"".concat(c,"/search_results"),state:{sites:y,organizations:j,only_ewi_recipients:w}},className:d.link},"Search")),r.a.createElement(p.a,{onClick:a},"Cancel")));var I}));const uo=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{regularContainer:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(u.a)({},t.pageContentMargin),divider:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40}})}),po=e=>t=>{t.preventDefault(),e.goBack()};function go(e){const t=e.width,a=e.history;return Object(te.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:po(a),startIcon:r.a.createElement(li.a,null)},"Back to conversation list"):r.a.createElement(z.a,{variant:"contained",color:"primary",size:"small",onClick:po(a)},r.a.createElement(li.a,null))}var bo=function(e){const t=e.location,a=e.socket,l=e.width,i=e.url,c=e.is_desktop,s=e.searchResults,m=e.setSearchResults,d=e.ListLoader,u=uo(),p=t.state,g=p.sites,b=p.organizations,E=p.only_ewi_recipients,h=Object(n.useState)(!1),f=Object(o.a)(h,2),_=f[0],y=f[1],O=null===g&&null===b;return Object(n.useEffect)(()=>{const e=0===s.length;if(!O&&e){y(!0);const e={site_ids:g.map(e=>e.value),org_ids:b.map(e=>e.value),only_ewi_recipients:E};"undefined"!==typeof a&&(a.emit("get_search_results",e),t=e=>{y(!1),m(e)},Jc.on("receive_search_results",e=>{console.log("Chatterbox Search Results",e),t(e)}))}var t;return()=>{"undefined"!==typeof a&&Jc.removeListener("receive_search_results")}},[a,s,g,b]),r.a.createElement("div",{className:u.pageContentMargin},r.a.createElement(we,{title:"Communications | Chatterbox"}),r.a.createElement(go,e),r.a.createElement(v.a,{variant:"h5",style:{marginTop:24}},"SEARCH RESULTS"),O&&r.a.createElement(v.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No search input")),_?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(d,null)):s.length>0?r.a.createElement(zc,{width:l,url:i,messagesArr:s,async:!0,hidden:!1,is_desktop:c}):r.a.createElement(v.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No results found")))};const Eo=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16}})}),ho=()=>r.a.createElement(Te.a,{height:400,width:600,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("circle",{cx:"47",cy:"48",r:"26"}),r.a.createElement("rect",{x:"90",y:"36",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"47",cy:"108",r:"26"}),r.a.createElement("rect",{x:"90",y:"96",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"168",r:"26"}),r.a.createElement("rect",{x:"90",y:"156",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"228",r:"26"}),r.a.createElement("rect",{x:"90",y:"216",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"288",r:"26"}),r.a.createElement("rect",{x:"90",y:"276",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"348",r:"26"}),r.a.createElement("rect",{x:"90",y:"336",rx:"0",ry:"0",width:"489",height:"29"}));function fo(e){const t=e.modalState,a=e.modalStateHandler;return r.a.createElement(qe.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:t},r.a.createElement(Ve.a,{id:"simple-dialog-title"},"Chatterbox Information"),r.a.createElement(Qe.a,null,r.a.createElement(v.a,{variant:"h6",gutterBottom:!0,align:"center"},"Inbox"),r.a.createElement(v.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Inbox tab contains the list of our contacts who recently sent a message to our server. The first contact in the list is the most recent message sender, and so on.",r.a.createElement("br",null),r.a.createElement("br",null),"\u2003\u2003Unlike a regular message list on a messaging app, outbound messages to our contacts do not affect the order of the list nor the appearance of a contact on the list (because our server sends a lot of messages, especially when routine, that incoming messages might get unnoticed)."),r.a.createElement(Ne.a,{style:{margin:"8px 0"}}),r.a.createElement(v.a,{variant:"h6",gutterBottom:!0,align:"center"},"Unsent"),r.a.createElement(v.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Unsent tab displays conversation threads which contains unsent messages within one day span. Unsent messages refer to messages in the process of sending or messages with failed sending attempt.")))}const _o=Object(n.createContext)();var yo=Object(te.a)()((function(e){const t=e.location,a=e.match.url,l=e.width,i=Eo(),c=Object(n.useState)(0),s=Object(o.a)(c,2),d=s[0],u=s[1],g=Object(n.useState)(!1),b=Object(o.a)(g,2),E=b[0],h=b[1],f=Object(n.useState)(!1),_=Object(o.a)(f,2),y=_[0],v=_[1],O=Object(n.useState)({inbox:null,unsent:null}),x=Object(o.a)(O,2),j=x[0],S=x[1],k=Object(n.useState)([{label:"Inbox",href:"inbox"},{label:"Unsent",href:"unsent"}]),C=Object(o.a)(k,2),w=C[0],A=C[1],I=Object(n.useState)([]),D=Object(o.a)(I,2),M=D[0],N=D[1],T=Object(n.useState)([]),H=Object(o.a)(T,2),R=H[0],B=H[1],Y=Object(n.useState)([]),P=Object(o.a)(Y,2),L=P[0],F=P[1],G=Object(n.useState)(!1),U=Object(o.a)(G,2),W=U[0],q=U[1],V=(e,t)=>()=>{"send"===e?h(t):"search"===e?v(t):"info"===e&&q(t)},Q=Object(n.useContext)(ve).setIsReconnecting;Object(n.useEffect)(()=>{var e;return $c(Q,"chatterbox"),e=e=>{S(e);const t=e.unsent.length;let a="Unsent";const n=w.findIndex(e=>e.href===a);t>0&&(a=r.a.createElement(dc.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:t,overlap:"rectangle"},"Unsent")),A(e=>[...e.slice(0,n),{label:a,href:"unsent"}])},Xc(),Jc.on("receive_latest_messages",t=>{console.log("Latest messages",t),e(t)}),function(e){Xc(),Jc.on("receive_all_mobile_numbers",t=>{console.log("All Saved Mobile Numbers",t),e(t)})}(e=>{B(e)}),eo(e=>F(e)),()=>{Jc.removeListener("receive_latest_messages"),Jc.removeListener("receive_all_mobile_numbers"),to()}},[]);const Z=Object(te.c)("md",l),K=r.a.createElement("span",null,r.a.createElement(z.a,{color:"primary","aria-label":"Chatterbox info",onClick:V("info",!0)},r.a.createElement(Rr.a,{fontSize:"large"})),r.a.createElement(p.a,{"aria-label":"Compose message",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:V("send",!0),startIcon:r.a.createElement(uc.a,null)},"Compose"),r.a.createElement(p.a,{"aria-label":"Search messages",variant:"contained",color:"primary",size:"small",onClick:V("search",!0),startIcon:r.a.createElement(pc.a,null)},"Search"));return r.a.createElement(m.d,{location:t},r.a.createElement(m.b,{exact:!0,path:a,render:e=>r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(we,{title:"Communications | Chatterbox",customButtons:!!Z&&K})),r.a.createElement("div",{className:i.tabBar},r.a.createElement(Me,{chosenTab:d,onSelect:e=>u(e),tabsArray:w})),r.a.createElement("div",{className:"".concat(i.tabBar," ").concat(i.tabBarContent)},r.a.createElement(_o.Provider,{value:{contacts:L}},null===j.inbox?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(ho,null)):r.a.createElement(zc,{width:l,url:a,messagesArr:j.inbox,async:!0,hidden:0!==d,is_desktop:Z}),null===j.unsent?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(ho,null)):r.a.createElement(zc,{width:l,url:a,messagesArr:j.unsent,async:!0,hidden:1!==d,is_desktop:Z}))),!Z&&r.a.createElement(Vn,{clickHandler:V("send",!0)}),r.a.createElement(oo,{modalStateHandler:V("send",!1),modalState:E,recipientsList:R}),r.a.createElement(mo,{modalStateHandler:V("search",!1),modalState:y,setSearchResultsToEmpty:()=>N([]),url:a}),r.a.createElement(fo,{modalStateHandler:V("info",!1),modalState:W}))}),r.a.createElement(m.b,{path:"".concat(a,"/search_results"),render:e=>r.a.createElement(_o.Provider,{value:{contacts:L}},r.a.createElement(bo,Object.assign({},e,{messageCollection:j,socket:Jc,url:a,width:l,is_desktop:Z,searchResults:M,setSearchResults:N,ListLoader:ho})))}),r.a.createElement(m.b,{path:"".concat(a,"/:mobile_id"),render:e=>r.a.createElement(_o.Provider,{value:{contacts:L}},r.a.createElement(co,Object.assign({},e,{messageCollection:j,socket:Jc})))}))})),vo=a(756),Oo=a(696),xo=a(468),jo=a(471),So=a(791),ko=a(794),Co=a(795),wo=a(796),Ao=a(797),Io=a(798),Do=a(799),Mo=a(800),No=a(801);const To=r.a.memo(e=>{const t=e.classes,a=e.row,n=e.index,l=e.onContactClickFn,i=a.user_id,c=a.first_name,o=a.last_name,s=a.organizations,m=ce(s),d=oe(s);return r.a.createElement(hn.a,{button:!0,onClick:l(a,n),key:i},r.a.createElement(gc.a,null,r.a.createElement(bc.a,null,r.a.createElement(Sc.a,null))),r.a.createElement(fn.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(v.a,{variant:"body1",style:{marginRight:8}},"".concat(o,", ").concat(c))),m.map((e,a)=>{const n=0===a,l=n?"secondary":"primary";return n&&d?r.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(Pe.a,{arrow:!0,disableFocusListener:!0,title:"Contact Priority",placement:"top"},r.a.createElement(Yt.a,{color:l,size:"small",label:e,icon:r.a.createElement(So.a,{style:{color:"gold"}})}))):r.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(Yt.a,{color:l,size:"small",label:e}))}))}))});var Ho=function(e){const t=e.contacts,a=e.onContactClickFn,n=e.classes;return r.a.createElement(bn.a,{dense:!0,style:{paddingTop:0}},t.map((e,t)=>r.a.createElement(To,{row:e,index:t,onContactClickFn:a,classes:n,key:"list-".concat(t)})))};var Ro=r.a.memo((function(e){const t=e.blocked_numbers,a=e.onBlockContactClickFn;return 0===t.length?r.a.createElement("div",null,"No blocked contact"):r.a.createElement(bn.a,{dense:!0,style:{paddingTop:0}},t.map(e=>{const t=e.mobile_number,n=t.mobile_id,l=t.sim_num;return r.a.createElement(hn.a,{button:!0,onClick:a(e),key:n},r.a.createElement(gc.a,null,r.a.createElement(bc.a,null,r.a.createElement(Oc.a,null))),r.a.createElement(fn.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(v.a,{variant:"body1",style:{marginRight:8}},"+".concat(l))))}))}))}));function Bo(e){const t=e.row,a=t.network,l=t.prefixes;return r.a.createElement(n.Fragment,null,r.a.createElement(v.a,{variant:"h5",style:{marginBottom:12}},a),r.a.createElement(f.a,{style:{padding:"24px 16px"}},r.a.createElement(y.a,{container:!0,spacing:3},l.map(e=>r.a.createElement(v.a,{variant:"body1",component:y.a,item:!0,xs:2,align:"center",key:e},e)))))}var Yo=r.a.memo((function(e){const t=function(e){const t=[],a=[];return e.forEach(e=>{const n=e.prefix,r=e.network_id,l="0".concat(n);1===r?a.push(l):t.push(l)}),[{network:"Globe",prefixes:a},{network:"Smart",prefixes:t}]}(e.sim_prefixes);return r.a.createElement(n.Fragment,null,t.map(e=>r.a.createElement(n.Fragment,{key:e.network},r.a.createElement(Bo,{row:e}),r.a.createElement("div",{style:{marginBottom:24}}))))})),Po=a(752),Lo=a(792),Fo=a(793);const zo=Object(O.a)(e=>({root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},title:{fontSize:14},pos:{marginBottom:12}}));function Go(e,t){let a="";0===e?a="community":1===e?a="barangay":2===e?a="municipal":3===e?a="provincial":4===e?a="regional":5===e&&(a="national");return{header:"".concat(ie(a)," ").concat(t.toUpperCase()),offices:"".concat(a,"_").concat(t)}}function Uo(e){const t=e.checkbox_data,a=e.updatePrimary,l=e.contact_per_org,i=e.setContactsPerOrg,c=e.contacts_key,s=e.classes,m=Object(n.useState)(0),d=Object(o.a)(m,2),u=d[0],g=d[1],b=[];Object(n.useEffect)(()=>{let e=!1;if(t.find(e=>1===e.primary_contact)&&!1===e){e=!0;const a=t.find(e=>1===e.primary_contact).user_org_id.toString();g(a)}},[]);return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,key:"contact_radio_button"},r.a.createElement(Ke.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(aa.a,{component:"legend",style:{textAlign:"center",marginBottom:8}},"Choose primary contact."),r.a.createElement(Je.a,{"aria-label":"choose_primary_contact",name:"choose_primary_contact",value:u,onChange:e=>{g(e.target.value)},row:!0,style:{justifyContent:"space-around"}},t.map((e,t)=>{const a=e.contact_person,n=e.user_org_id,l=a.first_name,i=a.last_name;return r.a.createElement(Xe.a,{value:n.toString(),control:r.a.createElement($e.a,{color:"primary"}),label:"".concat(l," ").concat(i),key:"contact_radio_button_".concat(t+1)})})))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",color:"secondary",size:"small",className:s.button,style:{marginRight:8},startIcon:r.a.createElement(Lo.a,null),onClick:()=>{a();const e=parseInt(u,10);t.forEach((t,a)=>{let n=0;e===t.user_org_id&&(n=1),t.primary_contact=n,b.push(t)}),l[c]=b,i(l),function(e,t=null){const a="".concat(k,"/api/contacts/save_primary_contact");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save updated primary contact",a),null!==t&&t(a)}).catch(e=>{console.error(e)})}(b,e=>{var t;t="update_all_contacts",Xc(),Jc.emit(t)})}},"Save"),r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",className:s.button,startIcon:r.a.createElement(Fo.a,null),onClick:()=>a()},"Back")))}function Wo(e){const t=e.siteData,a=e.classes,l=e.isUpdatePrimary,i=e.setIsUpdatePrimary,c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],d=s[1],u=Object(n.useState)({}),g=Object(o.a)(u,2),b=g[0],E=g[1],h=Object(n.useState)([]),f=Object(o.a)(h,2),_=f[0],O=f[1],x=Object(n.useState)([]),j=Object(o.a)(x,2),S=j[0],k=j[1];Object(n.useEffect)(()=>{i(!1);const e={},a=[];t.forEach((t,n)=>{const r=t.org_name,l=Go(t.scope,r).offices;void 0===e[l]?(e[l]=[t],a.push(l)):e[l].push(t)}),E(e),d(a)},[t]);const C=e=>{i(!l),void 0!==e&&(O(b[e]),k(e))};return l?r.a.createElement(Uo,{checkbox_data:_,updatePrimary:C,contact_per_org:b,setContactsPerOrg:E,contacts_key:S,classes:a}):m.map((e,t)=>{const n=b[e][0],l=Go(n.scope,n.org_name).header,i=b[e].find(e=>1===e.primary_contact);let c="No primary contact set";if("undefined"!==typeof i){const e=i.contact_person,t=e.first_name,a=e.last_name;c="".concat(t," ").concat(a)}return r.a.createElement(y.a,{item:!0,xs:12,sm:6,lg:4,align:"center",key:"contact_per_org_".concat(t+1)},r.a.createElement(Da.a,{className:a.root,key:"contact_per_org_card_".concat(t+1)},r.a.createElement(Na.a,{key:"contact_per_org_content_".concat(t+1)},r.a.createElement(v.a,{variant:"subtitle2"},l),r.a.createElement(v.a,{variant:"body1"},c)),r.a.createElement(Po.a,{disableSpacing:!0},r.a.createElement(y.a,{container:!0,justify:"flex-end"},r.a.createElement(p.a,{size:"small",color:"primary",onClick:()=>C(e)},"Update")))))})}var qo=r.a.memo((function(e){const t=e.siteLabel,a=e.siteID,l=e.siteData,i=Object(n.useState)(!1),c=Object(o.a)(i,2),s=c[0],m=c[1],d=zo();return r.a.createElement(n.Fragment,{key:"site_ID".concat(a+1)},r.a.createElement(He.a,null,r.a.createElement(Be.a,{expandIcon:r.a.createElement(Zn.a,null)},r.a.createElement(v.a,{variant:"body1"},t)),r.a.createElement(Ne.a,null),r.a.createElement(Re.a,{className:d.details},r.a.createElement(y.a,{container:!0,spacing:3,style:{marginTop:6}},r.a.createElement(Wo,{siteData:l,classes:d,isUpdatePrimary:s,setIsUpdatePrimary:m}))),r.a.createElement(Ne.a,null)))}),(function(e,t){return e.siteData.length===t.siteData.length}));var Vo=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.modalState,l=e.modalStateHandler,i=e.isMobile,c=e.contactsArray,s=e.classes,m=e.setChosenContact,d=Object(n.useContext)(ve).organizations,u=Object(n.useState)([]),g=Object(o.a)(u,2),b=g[0],E=g[1];Object(n.useEffect)(()=>{const e=d.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}});E(e)},[d]);const h=Object(n.useState)(null),f=Object(o.a)(h,2),_=f[0],y=f[1],v=Object(n.useState)(null),O=Object(o.a)(v,2),x=O[0],j=O[1],S=Object(n.useState)([]),k=Object(o.a)(S,2),C=k[0],w=k[1],A=r.a.useCallback(e=>()=>{m(e),I()},[]),I=()=>{l()};return Object(n.useEffect)(()=>{let e=[];if(null!==x){const t=x.map(e=>e.value);e=c.filter(e=>{const a=e.organizations;let n=null;return 0!==a.length&&(n=a[0].organization.org_id),t.includes(n)})}if(null!==_){const t=_.map(e=>e.data.site_code);let a=c;0!==e.length&&(a=e),e=[],a.forEach(a=>{a.organizations.every(n=>{const r=n.site.site_code;return!t.includes(r)||(e.push(a),!1)})})}e.length>0?w(e):w(null)},[x,_]),r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?Tt:Ht},r.a.createElement(Ve.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search contacts"),r.a.createElement(z.a,{color:"inherit",onClick:l,"aria-label":"Close",style:{padding:0}},r.a.createElement(Ot.a,null)))),r.a.createElement(Qe.a,{style:{overflowY:"auto"}},r.a.createElement(Ze.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Xt,{value:_,changeHandler:e=>y(e),isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Kt,{label:"Organizations",options:b,value:x,changeHandler:(D="organizations",e=>{"sites"===D?y(e):"organizations"===D&&j(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),null!==C?r.a.createElement(Ho,Object.assign({},e,{contacts:C,classes:s,onContactClickFn:A})):null,!i&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:l},"Close")));var D}));const Qo=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{tabBar:Object(u.a)(Object(u.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:{overflowY:"auto",height:"calc(100vh - 250px)",[e.breakpoints.down("md")]:{height:"80vh"}},insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"}})}),Zo=e=>r.a.createElement(Te.a,Object.assign({speed:2,width:700,height:350,viewBox:"0 0 700 350"},e),r.a.createElement("rect",{x:"4",y:"8",rx:"3",ry:"3",width:"8",height:"317"}),r.a.createElement("rect",{x:"7",y:"317",rx:"3",ry:"3",width:"669",height:"8"}),r.a.createElement("rect",{x:"669",y:"9",rx:"3",ry:"3",width:"7",height:"313"}),r.a.createElement("rect",{x:"5",y:"8",rx:"3",ry:"3",width:"669",height:"7"}),r.a.createElement("rect",{x:"114",y:"52",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"77",cy:"60",r:"15"}),r.a.createElement("rect",{x:"116",y:"105",rx:"6",ry:"6",width:"420",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"113",r:"15"}),r.a.createElement("rect",{x:"115",y:"158",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"166",r:"15"}),r.a.createElement("rect",{x:"117",y:"211",rx:"6",ry:"6",width:"444",height:"15"}),r.a.createElement("circle",{cx:"79",cy:"219",r:"15"}),r.a.createElement("rect",{x:"117",y:"263",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"80",cy:"271",r:"15"}));function Ko(e){const t=e.contact,a=e.chosenContact,l=e.setSlideOpen,i=e.classes,c=e.setContactFormForEdit,o=e.siteOrgs,s=e.isContactPriority,m=o.sites,d=o.org,u=a.status,g=a.emails,b=a.ewi_recipient,E=a.landline_numbers,h=a.mobile_numbers;return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:2},r.a.createElement(bc.a,null,r.a.createElement(Sc.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(v.a,{variant:"h5",align:"center"},t)),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(fi.a,{smDown:!0,lgUp:!0},r.a.createElement(z.a,{onClick:()=>l(!1)},r.a.createElement(Ot.a,null)))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center",paragraph:!0},"Affiliation")),null!==d?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(Pe.a,{arrow:!0,disableFocusListener:!0,disableHoverListener:!s,title:"Contact Priority",placement:"top"},r.a.createElement(Yt.a,{color:"secondary",label:r.a.createElement(v.a,{variant:"body1"},d.toUpperCase()),icon:s?r.a.createElement(So.a,{style:{color:"gold"}}):null}))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},m.map(e=>{const t=e.site_code,a=le(e,!1);return r.a.createElement(Pe.a,{key:t,title:a,"aria-label":a},r.a.createElement(Yt.a,{color:"primary",label:r.a.createElement(v.a,{variant:"body2"},t.toUpperCase())}))}))):r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center",paragraph:!0},"No affiliations saved")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"Status"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",align:"center"},0===u?"Inactive":"Active")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Recipient"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",align:"center"},0===b?"No":"Yes")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Mobile")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(bn.a,{dense:!0},0===h.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No mobile numbers saved")):h.map(e=>r.a.createElement(hn.a,{key:e.mobile_number.mobile_id},r.a.createElement(gc.a,null,r.a.createElement(bc.a,null,r.a.createElement(Ue.a,null))),r.a.createElement(fn.a,{primary:"+".concat(e.mobile_number.sim_num)}),r.a.createElement(vo.a,null,r.a.createElement(fn.a,{secondary:"Status: ".concat(0===e.status?"Inactive":"Active")})))))),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Landline")),r.a.createElement(y.a,{item:!0,xs:12},0===E.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No landline numbers saved")):r.a.createElement(bn.a,{dense:!0},E.map(e=>r.a.createElement(hn.a,{key:e.landline_id},r.a.createElement(gc.a,null,r.a.createElement(bc.a,null,r.a.createElement(ko.a,null))),r.a.createElement(fn.a,{primary:"+".concat(e.landline_num)}))))),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle1",align:"center"},"Email")),r.a.createElement(y.a,{item:!0,xs:12},0===g.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{color:"textSecondary",variant:"body2",align:"center"},"No email addresses saved")):r.a.createElement(bn.a,{dense:!0},g.map(e=>r.a.createElement(hn.a,{key:e.email_id},r.a.createElement(gc.a,null,r.a.createElement(bc.a,null,r.a.createElement(Co.a,null))),r.a.createElement(fn.a,{primary:"+".concat(e.email)}))))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(El.a,null),onClick:()=>c(!0)},"Edit")))}function Jo(e){const t=e.chosenContact,a=e.setSlideOpen;if(0===t.length)return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(v.a,{variant:"caption",display:"block"},"No initial blocked contact")));const n=t.mobile_number,l=t.reporter,i=t.ts,c=t.reason,o=n.sim_num,s=n.user_details,m=l.first_name,d=l.last_name;let u="No contact details";if(null!==s){const e=s.user,t=e.first_name,a=e.last_name;u="".concat(a,", ").concat(t)}const g=ne()(i).format("MMMM D, YYYY, HH:mm:ss");return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(bc.a,null,r.a.createElement(wo.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(v.a,{variant:"h5",align:"center"},"+".concat(o))),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(fi.a,{smDown:!0,lgUp:!0},r.a.createElement(z.a,{onClick:()=>a(!1)},r.a.createElement(Ot.a,null)))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Details")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},u)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Reason")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",align:"center"},r.a.createElement("i",null,c))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body2",align:"center"},g)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"h6",align:"center"},"Reporter")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"body1",align:"center"},"".concat(d,", ").concat(m))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Ne.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(p.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(Ao.a,null),disabled:!0},"Unblock (soon)")))}const Xo=({search_str:e,setSearchStr:t,inputProps:a})=>r.a.createElement(b.a,{margin:"dense",hiddenLabel:!0,fullWidth:!0,variant:"outlined",placeholder:"Type contact name",InputProps:a,value:e,onChange:e=>t(e.target.value)});var $o=function(e){const t=Qo(),a=Object(n.useState)([]),l=Object(o.a)(a,2),i=l[0],s=l[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],p=d[1],g=Object(n.useState)({}),b=Object(o.a)(g,2),E=b[0],h=b[1],_=Object(n.useState)(0),O=Object(o.a)(_,2),x=O[0],j=O[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],I=w[1],D=Object(n.useState)(!1),M=Object(o.a)(D,2),N=M[0],T=M[1],H=Object(n.useState)(!1),R=Object(o.a)(H,2),B=R[0],Y=R[1],F=Object(n.useState)(""),G=Object(o.a)(F,2),U=G[0],W=G[1],q=Object(n.useState)([]),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)([]),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)([]),te=Object(o.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)([]),ie=Object(o.a)(re,2),se=ie[0],me=ie[1],de=Object(n.useState)("active_numbers"),ue=Object(o.a)(de,2),pe=ue[0],ge=ue[1],be=Object(n.useState)(null),Ee=Object(o.a)(be,2),he=Ee[0],fe=Ee[1],_e=Object(n.useState)(!1),ye=Object(o.a)(_e,2),Oe=ye[0],xe=ye[1],je=r.a.useCallback((e,t)=>()=>{h(e),j(t),I(!0)},[]),Se=r.a.useCallback(e=>()=>{$(e),I(!0)},[]),ke=e=>{I(e),T(e),Y(!1)},Ce=e=>{Y(e),T(e)},Ae=e=>{ge(e)},Ie=Object(c.b)(),De=Ie.enqueueSnackbar,Me=Ie.closeSnackbar,Ne=Object(n.useContext)(ve),Te=Ne.setIsReconnecting,He=Ne.sites,Re=Object(n.useState)(!1),Be=Object(o.a)(Re,2),Ye=Be[0],Pe=Be[1];Object(n.useEffect)(()=>($c(Te,"contacts"),eo(e=>{s(e);let t={};e.length>0&&(t=e[x]),h(t),p(e),Pe(!0),null!==he&&(Me(he),fe(null),De("Loading contacts list successful!",{variant:"success",autoHideDuration:5e3}))}),()=>to()),[x,he]),Object(n.useEffect)(()=>{const e=U.length;if(e>2){const e=i.filter(e=>{const t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(U),"gi").test(n)});p(e)}else 0===e&&p(i)},[U]),Object(n.useEffect)(()=>{!function(e){const t="".concat(k,"/api/contacts/blocked_numbers");S.a.get(t).then(t=>{const a=t.data;e(a)}).catch(e=>{console.error(e)})}(e=>{const t=e.status,a=e.blocked_numbers;t&&(Z(a),0!==a.length&&$(a[0]))}),function(e){const t="".concat(k,"/api/contacts/sim_prefix");S.a.get(t).then(t=>{const a=t.data;e(a)}).catch(e=>{console.error(e)})}(e=>{const t=e.status,a=e.prefixes;t&&ne(a)})},[]),Object(n.useEffect)(()=>{Ye&&(!function(e){const t="".concat(k,"/api/contacts/get_contact_prioritization");S.a.get(t).then(t=>{const a=t.data;console.log("All Sites Stakeholders",a),e(a)}).catch(e=>{console.error(e)})}(e=>{me(e)}),Pe(!1))},[Ye]);let Le="",Fe=null,ze=!1;if(E.hasOwnProperty("user_id")){const e=E.first_name,t=E.last_name,a=E.organizations;Le="".concat(e," ").concat(t),Fe=ce(a,!0),ze=oe(a)}const Ge=()=>N?r.a.createElement(Bc,{setContactForm:ke,chosenContact:E,setSnackbarKey:fe,isEditMode:B,setContactFormForEdit:Ce,isFromChatterbox:!1}):""!==Le?r.a.createElement(Ko,{contact:Le,chosenContact:E,setSlideOpen:I,classes:t,setContactFormForEdit:Ce,siteOrgs:Fe,isContactPriority:ze}):void 0,Ue=r.a.createElement(Xo,{search_str:U,setSearchStr:W,inputProps:{endAdornment:r.a.createElement(Oo.a,{position:"end"},r.a.createElement(z.a,{"aria-controls":"sortContacts","aria-haspopup":"true",onClick:e=>{xe(!Oe)},color:"primary"},r.a.createElement(Io.a,null)))}});return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(we,{title:"Communications | Contacts"}),r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(fi.a,{mdUp:!0},r.a.createElement(y.a,{item:!0,xs:12,className:t.sticky,style:{paddingBottom:0}},Ue)),r.a.createElement(fi.a,{smDown:!0},r.a.createElement(y.a,{item:!0,md:4,lg:3},r.a.createElement("div",{className:t.sticky},Ue,r.a.createElement(bn.a,{component:"nav","aria-label":"main"},r.a.createElement(hn.a,{button:!0,onClick:()=>Ae("active_numbers"),selected:"active_numbers"===pe},r.a.createElement(_n.a,null,r.a.createElement(Do.a,null)),r.a.createElement(fn.a,{primary:"Active Contacts"})),r.a.createElement(xo.a,{in:"active_numbers"===pe,timeout:"auto",unmountOnExit:!0},r.a.createElement(bn.a,{component:"div",disablePadding:!0},r.a.createElement(hn.a,{button:!0,onClick:()=>ke(!0),className:t.nested},r.a.createElement(_n.a,null,r.a.createElement(Ao.a,null)),r.a.createElement(fn.a,{primary:"Add Contact"})))),r.a.createElement(hn.a,{button:!0,onClick:()=>Ae("blocked_numbers"),selected:"blocked_numbers"===pe},r.a.createElement(_n.a,null,r.a.createElement(Oc.a,null)),r.a.createElement(fn.a,{primary:"Blocked Contacts"})),r.a.createElement(hn.a,{button:!0,onClick:()=>Ae("contact_prioritization"),selected:"contact_prioritization"===pe},r.a.createElement(_n.a,null,r.a.createElement(Mo.a,null)),r.a.createElement(fn.a,{primary:"Contact Prioritization"})),r.a.createElement(hn.a,{button:!0,onClick:()=>Ae("sim_prefixes"),selected:"sim_prefixes"===pe},r.a.createElement(_n.a,null,r.a.createElement(No.a,null)),r.a.createElement(fn.a,{primary:"SIM Prefixes"})))))),r.a.createElement(y.a,{item:!0,xs:12,md:8,lg:9},0===i.length?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Zo,null)):r.a.createElement(n.Fragment,null,r.a.createElement(fi.a,{xsUp:"active_numbers"!==pe,implementation:"css"},r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(y.a,{item:!0,xs:12,lg:7},r.a.createElement(Ho,{classes:t,contacts:u,onContactClickFn:je})),r.a.createElement(fi.a,{mdDown:!0},r.a.createElement(y.a,{item:!0,lg:5},""!==Le&&r.a.createElement(f.a,{elevation:1,style:{padding:16,zIndex:2},className:"".concat(t.sticky," ").concat(t.overflow),variant:"outlined"},Ge())),r.a.createElement(jo.a,{open:N,style:{zIndex:1}})),r.a.createElement(fi.a,{smDown:!0,lgUp:!0},r.a.createElement(Mt.a,{direction:"left",in:A,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(f.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},Ge())),r.a.createElement(jo.a,{open:A,style:{zIndex:1}})),r.a.createElement(fi.a,{mdUp:!0},r.a.createElement(qe.a,{fullScreen:!0,open:A,TransitionComponent:Tt},r.a.createElement(P.a,{style:{position:"relative"}},r.a.createElement(L.a,null,r.a.createElement(z.a,{edge:"start",color:"inherit",onClick:()=>ke(!1),"aria-label":"close"},r.a.createElement(Ot.a,null)))),r.a.createElement(f.a,{elevation:0,style:{padding:16}},Ge()))))),r.a.createElement(fi.a,{xsUp:"blocked_numbers"!==pe,implementation:"css"},r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(y.a,{item:!0,xs:12,lg:7},r.a.createElement(Ro,{blocked_numbers:Q,onBlockContactClickFn:Se})),r.a.createElement(fi.a,{mdDown:!0},r.a.createElement(y.a,{item:!0,lg:5},r.a.createElement(f.a,{elevation:1,style:{padding:16,zIndex:2},className:t.sticky,variant:"outlined"},r.a.createElement(Jo,{chosenContact:X,setSlideOpen:I})))),r.a.createElement(fi.a,{smDown:!0,lgUp:!0},r.a.createElement(Mt.a,{direction:"left",in:A,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(f.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},r.a.createElement(Jo,{chosenContact:X,setSlideOpen:I}))),r.a.createElement(jo.a,{open:A,style:{zIndex:1}})),r.a.createElement(fi.a,{mdUp:!0},r.a.createElement(qe.a,{fullScreen:!0,open:A,TransitionComponent:Tt},r.a.createElement(P.a,{style:{position:"relative"}},r.a.createElement(L.a,null,r.a.createElement(z.a,{edge:"start",color:"inherit",onClick:()=>ke(!1),"aria-label":"close"},r.a.createElement(Ot.a,null)))),r.a.createElement(f.a,{elevation:0,style:{padding:16}},r.a.createElement(Jo,{chosenContact:X,setSlideOpen:I})))))),r.a.createElement(fi.a,{xsUp:"contact_prioritization"!==pe,implementation:"css"},r.a.createElement(v.a,{variant:"body1",style:{marginBottom:12}},r.a.createElement("strong",null,r.a.createElement("i",null,"Note: Contact priority can only be chosen from stakeholders that are currently active and EWI recipients."))),0!==se.length&&He.map((e,t)=>{const a=e.site_id,n=e.site_code,l=le(e,!0,"start"),i=se[n];return r.a.createElement(qo,{siteLabel:l,siteID:a,siteData:i,key:t})})),r.a.createElement(fi.a,{xsUp:"sim_prefixes"!==pe,implementation:"css"},r.a.createElement(Yo,{sim_prefixes:ae}))))),r.a.createElement(Vo,{modalStateHandler:(We=!1,()=>{xe(We)}),modalState:Oe,contactsArray:u,classes:t,chosenContact:E,setChosenContact:h}));var We},es=a(161),ts=a(158),as=a(678),ns=a(465),rs=a.n(ns);const ls=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},insetDivider:{padding:"8px 70px !important"}})}),is={to:[],cc:[],bcc:[]};var cs=function(e){const t=ls(),a=(e.siteId,Object(n.useState)(is)),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),d=m[0],g=m[1],E=Object(n.useState)({}),h=Object(o.a)(E,2),f=h[0],_=h[1],v=Object(n.useState)(""),O=Object(o.a)(v,2),x=O[0],j=O[1],C=Object(n.useState)(""),w=Object(o.a)(C,2),A=w[0],I=w[1],D=(e,t)=>{const a=i[e].push(t);c(Object(u.a)(Object(u.a)({},i),a))},M=(e,t,a)=>{const n=i[e].splice(i[e].indexOf(t),1);c(Object(u.a)(Object(u.a)({},i),n))};return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(we,{title:"Communications | MailBox"}),r.a.createElement(y.a,{container:!0,spacing:4,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:"sending_options"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(dt.a,{label:"To",value:i.to,onAdd:e=>D("to",e),onDelete:(e,t)=>M("to",e),fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(b.a,{label:"Subject",value:x,onChange:e=>j(e.target.value),margin:"dense",fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(dt.a,{label:"Cc",value:i.cc,onAdd:e=>D("cc",e),onDelete:(e,t)=>M("cc",e),fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(dt.a,{label:"Bcc",value:i.bcc,onAdd:e=>D("bcc",e),onDelete:(e,t)=>M("bcc",e),fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,key:"message_body"},r.a.createElement(Fr.a,{theme:"snow",value:A,onChange:I})),r.a.createElement(y.a,{item:!0,xs:12,key:"buttons"},r.a.createElement(p.a,{color:"secondary",onClick:()=>{const e={recipients:[...i.to,...i.cc,...i.bcc],subject:x,mail_body:A};console.log("payload",e),function(e,t){const a="".concat(k,"/api/mailbox/send_email");console.log(e),S.a.post(a,e).then(e=>{const a=e.data;console.log("Send email response",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{console.log("AXIOS Response",e);e.status?(_({text:"Email sent!",color:es.a[600]}),c(is),j(""),I("")):_({text:"Email sent!",color:ts.a[600]}),g(!0)})}},"SEND"),r.a.createElement(p.a,{color:"primary",onClick:()=>{c({to:[],cc:[],bcc:[]}),j(""),I("")}},"Discard/Reset"))),r.a.createElement(as.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:d,autoHideDuration:6e3,onClose:e=>g(!1),ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},f.text),action:[r.a.createElement(z.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:e=>g(!1)},r.a.createElement(rs.a,null))],style:{backgroundColor:f.color}}))},os=a(438),ss=a(802);const ms=Object(O.a)(e=>{const t=Object(V.a)(e);return Object(u.a)(Object(u.a)({},t),{},{customPaper:{padding:8,marginTop:20,textAlign:"center"},bigAvatar:{margin:10,width:40,height:40}})}),ds=Object(d.a)(e=>({badge:{right:14,top:48,padding:"0 4px"}}))(dc.a);var us=function(e){const t=ms(),a=e.siteCode,l=Object(n.useState)(null),i=Object(o.a)(l,2),c=i[0],s=i[1];return Object(n.useEffect)(()=>{var e,l;e=a,l=e=>{console.log(e);const a=function(e,t){const a=[],l=[];return Object.keys(t).forEach(e=>{let t=l;/lewc|lgu/i.test(e)&&(t=a),t.push(e)}),a.concat(l).map((a,l,i)=>{const c=t[a].map((t,a)=>{const n=t.last_name,l=t.first_name,i=t.salutation,c=t.status,o=t.primary_contact,s=i||"";let m="Active",d=r.a.createElement(ra.a,{style:{color:"green"}});Boolean(o)&&c?(m="Contact Priority",d=r.a.createElement(ss.a,{style:{color:"gold"}})):c||(m="Inactive",d=r.a.createElement(la.a,{style:{color:"gray"}}));const u=r.a.createElement(Pe.a,{arrow:!0,title:m,placement:"top",enterTouchDelay:200},d);return r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,lg:3,justify:"center",alignItems:"center",container:!0,spacing:1,key:"staff_".concat(a+1)},r.a.createElement(ds,{badgeContent:u},r.a.createElement(bc.a,{alt:"Stakeholder",src:vc.a,className:e.bigAvatar})),r.a.createElement(v.a,{variant:"subtitle1",color:c?"textPrimary":"textSecondary"},"".concat(s," ").concat(l," ").concat(n)))});return r.a.createElement(n.Fragment,{key:"fragment_".concat(l+1)},r.a.createElement(y.a,{item:!0,xs:12,key:"org_label_".concat(l+1)},r.a.createElement(v.a,{variant:"subtitle1"},r.a.createElement("strong",null,a.toUpperCase()))),r.a.createElement(y.a,{item:!0,xs:12,justify:"space-evenly",alignItems:"center",container:!0,spacing:1,key:"staff_list_".concat(l+1)},c),i.length>l+1&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ne.a,{style:{margin:"16px 0"}})))})}(t,e);s(a)},S.a.get("".concat(k,"/api/users/get_community_orgs_by_site/").concat(e)).then(e=>{const t=e.data;l(t)})},[]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"h6",color:"textPrimary",gutterBottom:!0},r.a.createElement("strong",null,"Site Stakeholders"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1,justify:"center"},null===c?"Loading...":0!==c.length?c:"No site stakeholders"))};const ps=e=>t=>{t.preventDefault(),e.push("/community/site_info"),e.replace("/community/site_info")};var gs=function(e){const t=e.width,a=e.history;return Object(te.b)(t,"sm")?r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:ps(a)},r.a.createElement(li.a,{style:{fontSize:16}})," Back"):r.a.createElement(z.a,{variant:"contained",color:"primary",size:"small",onClick:ps(a),style:{marginLeft:6}},r.a.createElement(li.a,null))};const bs=["I","II","III","IV-A","IV-B","V","VI","VII","VIII","IX","X","XI","XII","XIII","CAR","NCR","BARMM"];function Es(e,t){const a=e[t-1],n=[],r=[];Object.keys(a).forEach(e=>{"d"!==a[e]&&"w"!==a[e]||("d"===a[e]?n.push(e):r.push(e))}),pe(n),pe(r);return[{key:"dry",list:n},{key:"wet",list:r}]}function hs(e,t){const a=t.type,n=t.field,r=t.value,l=e[n],i=function(e,t){return""===t?"Required field":"site_code"===e&&t.length<3?"Site code must be three-lettered keyword":""}(n,r);let c=r;switch(["purok","sitio","households"].includes(n)&&(c=r||null),"season"===n&&(c=parseInt(r,10)),a){case"UPDATE":return Object(u.a)(Object(u.a)({},e),{},{[n]:Object(u.a)(Object(u.a)({},l),{},{value:c,helper_text:i})});default:return Object(u.a)({},e)}}function fs(e){const t={},a=["sitio","purok","active","site_id"];return Object.keys(e).forEach(n=>{t[n]={value:e[n],helper_text:null,required:!a.includes(n)}}),t}var _s=function(e){const t=e.siteInformation,a=e.setSiteInformationData,l=e.seasons,i=e.setIsDisable,c=Object(n.useReducer)(hs,t,fs),s=Object(o.a)(c,2),m=s[0],d=s[1],u=Object(n.useState)([]),p=Object(o.a)(u,2),g=p[0],E=p[1];return Object(n.useEffect)(()=>{const e=Object.keys(m).some(e=>{const t=m[e],a=t.required,n=t.helper_text;return a&&""!==n&&null!==n});i(e),a(function(e){const t={};return Object.keys(e).forEach(a=>{t[a]=e[a].value}),t}(m))},[m]),Object(n.useEffect)(()=>{if(null!==m.season.value){const e=Es(l,m.season.value);E(e)}},[m.season.value]),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(b.a,{label:"Site code",fullWidth:!0,required:!0,inputProps:{maxLength:3},value:m.site_code.value.toUpperCase(),onChange:e=>d({type:"UPDATE",field:"site_code",value:e.target.value}),helperText:m.site_code.helper_text||"",error:Boolean(m.site_code.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Purok",fullWidth:!0,placeholder:"Enter purok if available",InputLabelProps:{shrink:!0},value:m.purok.value||"",onChange:e=>d({type:"UPDATE",field:"purok",value:e.target.value})})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Sitio",fullWidth:!0,placeholder:"Enter sitio if available",InputLabelProps:{shrink:!0},value:m.sitio.value||"",onChange:e=>d({type:"UPDATE",field:"sitio",value:e.target.value})})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Barangay",fullWidth:!0,required:!0,value:m.barangay.value,onChange:e=>d({type:"UPDATE",field:"barangay",value:e.target.value}),helperText:m.barangay.helper_text||"",error:Boolean(m.barangay.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Municipality",fullWidth:!0,required:!0,value:m.municipality.value,onChange:e=>d({type:"UPDATE",field:"municipality",value:e.target.value}),helperText:m.municipality.helper_text||"",error:Boolean(m.municipality.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Province",fullWidth:!0,required:!0,value:m.province.value,onChange:e=>d({type:"UPDATE",field:"province",value:e.target.value}),helperText:m.province.helper_text||"",error:Boolean(m.province.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{required:!0,fullWidth:!0,error:Boolean(m.region.helper_text)},r.a.createElement(pa.a,{id:"region"},"Region"),r.a.createElement(ga.a,{labelId:"region-select-label",id:"region-select-id",required:!0,value:m.region.value,onChange:e=>d({type:"UPDATE",field:"region",value:e.target.value})},r.a.createElement(U.a,{value:""},r.a.createElement("em",null,"None")),bs.map((e,t)=>r.a.createElement(U.a,{value:e,key:t},e))))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"PSGC",fullWidth:!0,type:"number",required:!0,value:m.psgc.value,onChange:e=>d({type:"UPDATE",field:"psgc",value:e.target.value}),helperText:m.psgc.helper_text||"",error:Boolean(m.psgc.helper_text)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{label:"Elements at Risk",fullWidth:!0,required:!0,value:m.households.value||"",onChange:e=>d({type:"UPDATE",field:"households",value:e.target.value}),helperText:m.households.helper_text||"",error:Boolean(m.households.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Ke.a,null,r.a.createElement(Xe.a,{control:r.a.createElement(kt.a,{checked:m.active.value,onChange:e=>d({type:"UPDATE",field:"active",value:e.target.checked}),value:"checkedA",color:"primary"}),label:"Active site"}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ke.a,{component:"fieldset",required:!0,error:Boolean(m.season.helper_text)},r.a.createElement(aa.a,{component:"legend"},"Season"),r.a.createElement(Je.a,{row:!0,"aria-label":"season_group",name:"season",value:m.season.value.toString(),onChange:e=>{const t=e.target.value;d({type:"UPDATE",field:"season",value:t});const a=Es(l,t);E(a)}},l.map((e,t)=>{const a=e.season_group_id;return r.a.createElement(Xe.a,{value:a.toString(),control:r.a.createElement($e.a,{color:"primary"}),label:"Season  ".concat(a),key:"season_".concat(a)})})))),r.a.createElement(y.a,{item:!0,container:!0,xs:12},g.map(e=>{const t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary",align:"center"},ie(t)),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary",align:"center"},a.map(e=>ie(e)).join(", ")))})))};var ys=Object(tt.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.seasons,i=e.editButtonAction,s=e.siteInformation,m=Object(n.useContext)(ve).setRefreshSites,d=Object(n.useState)(null),u=Object(o.a)(d,2),g=u[0],b=u[1],E=Object(n.useState)(!0),h=Object(o.a)(E,2),f=h[0],_=h[1],y=Object(c.b)(),v=y.enqueueSnackbar,O=y.closeSnackbar,x=e=>r.a.createElement(p.a,{color:"primary",onClick:()=>{O(e)}},"Dismiss"),j=()=>{i(!1)};return r.a.createElement(qe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Ve.a,{id:"form-dialog-title"},"Edit site information"),r.a.createElement(Qe.a,null,r.a.createElement(Ze.a,null,"Update necessary fields of site information form then save."),r.a.createElement(_s,{siteInformation:s,setSiteInformationData:b,seasons:l,setIsDisable:_})),r.a.createElement(et.a,null,r.a.createElement(p.a,{onClick:j,color:"primary"},"Cancel"),r.a.createElement(p.a,{color:"primary",onClick:()=>{!function(e,t){const a="".concat(k,"/api/sites/save_site_information");S.a.post(a,e).then(e=>{const a=e.data;console.log("Save site info data reponse",a),t(a)}).catch(e=>{console.error(e)})}(g,e=>{const t=e.status,a=e.message;"success"===t&&(j(),m(!0)),v(a,{variant:t,autoHideDuration:3e3,action:x})})},disabled:f},"Save")))}));const vs=Object(O.a)(e=>{const t=Object(os.a)(e);return Object(V.a)(t)}),Os=()=>r.a.createElement(Te.a,{height:125,width:380,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("rect",{x:"129",y:"20",rx:"3",ry:"3",width:"123",height:"44"}),r.a.createElement("rect",{x:"18",y:"80",rx:"3",ry:"3",width:"350",height:"22"}));var xs=function(e){const t=e.width,a=e.siteInformation,l=(vs(),Object(n.useState)(null)),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),d=Object(o.a)(m,2),u=d[0],g=d[1],b=Object(n.useState)([]),E=Object(o.a)(b,2),h=E[0],f=E[1],_=Object(n.useState)([]),O=Object(o.a)(_,2),x=O[0],j=O[1],C=Object(n.useState)(!1),w=Object(o.a)(C,2),A=w[0],I=w[1];Object(n.useEffect)(()=>{"undefined"!==typeof a&&s(a)},[a]),Object(n.useEffect)(()=>{var e;null!==c&&(e=e=>{f(e)},S.a.get("".concat(k,"/api/sites/get_seasons")).then(t=>{const a=t.data;e(a)}).catch(e=>{console.log(e)}),function(e,t){S.a.get("".concat(k,"/api/sites/get_site_season/").concat(e)).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}(c.site_code,e=>{const t=e.season_months,a=t.routine_schedules,n=[],r=[];a.forEach(e=>{const t=ne()().isoWeekday(e.iso_week_day).format("dddd");"d"===e.season_type?n.push(t):r.push(t)});j([{key:"dry",list:n},{key:"wet",list:r}]),delete t.routine_schedules,delete t.season_group_id;const l=[],i=[];Object.keys(t).forEach(e=>{"d"===t[e]?l.push(e):i.push(e)}),pe(l),pe(i);g([{key:"dry",list:l},{key:"wet",list:i}])}))},[c]);const D=()=>{I(!A)};return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(gs,Object.assign({},e,{width:t}))),r.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"flex-end"},r.a.createElement(p.a,{variant:"contained",color:"primary",size:"small",onClick:D,startIcon:r.a.createElement(El.a,null)},"Edit Info"))),r.a.createElement(y.a,{container:!0,spacing:2},null!==c?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"h4"},c.site_code.toUpperCase()),r.a.createElement(v.a,{variant:"h5",color:"textSecondary"},le(c,!1))),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Da.a,{raised:!0},r.a.createElement(Na.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Geographic Information"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Region"),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},c.region)),r.a.createElement(y.a,{item:!0,xs:!0,sm:9,md:8,lg:!0,align:"center"},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Philippine Standard Geographic Code"),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},c.psgc)),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary"},"Seasons")),u.length>0&&u.map(e=>{const t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},ie(t)),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>ie(e)).join(", ")))})))))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,alignItems:"center"},r.a.createElement(Da.a,{raised:!0,style:{width:"100%"}},r.a.createElement(Na.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Monitoring Information"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(v.a,{variant:"subtitle1",color:"textSecondary"},"Routine Schedules")),x.length>0&&x.map(e=>{const t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},ie(t)),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>ie(e)).join(", ")))})),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Current Alert Level"),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},"---")))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Da.a,{raised:!0},r.a.createElement(Na.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(v.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Site Status"))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Active"),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},c.active?"Yes":"No")),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(v.a,{variant:"subtitle2",color:"textSecondary"},"Elements at Risk"),r.a.createElement(v.a,{variant:"subtitle1",color:"textPrimary"},c.households||"---")))))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(Da.a,{raised:!0,style:{width:"100%"}},r.a.createElement(Na.a,null,r.a.createElement(us,{siteCode:c.site_code}))))):r.a.createElement(y.a,{item:!0,xs:!0,style:{width:"100%"}},r.a.createElement(Os,null))),r.a.createElement(ys,{isOpen:A,siteInformation:a,editButtonAction:D,seasons:h}))};var js=function(e){const t=e.siteMapData,a=e.hoveredSite,l=e.url,i=[12.8797,121.774],c=Object(n.useRef)(t.map(()=>Object(n.createRef)()));return Object(n.useEffect)(()=>{if(null!==a){const e=t.findIndex(e=>e.site_code===a),n=c.current[e].current;null!==n&&n.leafletElement.openPopup()}},[a]),r.a.createElement(Ri.a,{style:{height:"75vh"},center:i,zoom:5,scrollWheelZoom:"center"},r.a.createElement(Bi.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((e,t)=>{const a=e.site_code;return r.a.createElement(Fi.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0,ref:c.current[t]},r.a.createElement(Li.a,null,r.a.createElement(s.b,{to:"".concat(l,"/").concat(a),style:{color:"black"}},r.a.createElement("strong",null,a.toUpperCase())," ",r.a.createElement("br",null),le(e,!1))))}))};const Ss=Object(O.a)(e=>{const t=Object(V.a)(e),a=118+.06*(window.innerHeight-118);return Object(u.a)(Object(u.a)({},t),{},{sticky:{position:"sticky",top:a,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}})}),ks=()=>r.a.createElement(Te.a,{height:300,width:684,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"561",height:"700"}));function Cs(e){const t=e.sitesPerRegion,a=e.url,n=e.setHoveredSite,l=Object.keys(t).sort();return r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},l.map(e=>{const l="inactive"!==e?e.toUpperCase():"Inactive Sites";return r.a.createElement(y.a,{container:!0,justify:"center",key:e,style:{margin:"8px 0"}},r.a.createElement(v.a,{variant:"h6",component:y.a,item:!0,xs:12,align:"center",style:{marginBottom:4}},["I","V","X"].includes(l.charAt(0))&&"inactive"!==e?"Region ".concat(l):l),t[e].map(e=>r.a.createElement(v.a,{variant:"body2",component:y.a,item:!0,xs:12,align:"center",key:e.site_code},r.a.createElement(s.b,{to:"".concat(a,"/").concat(e.site_code),style:{color:"black"},onFocus:t=>n(e.site_code),onMouseOver:t=>n(e.site_code)},le(e,!0,"start")))))}))}var ws=Object(te.a)()((function(e){const t=Ss(),a=e.width,l=e.location,i=e.match.url,c=Object(n.useContext)(ve).all_sites_including_inactive,s=Object(n.useState)(null),d=Object(o.a)(s,2),p=d[0],g=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),h=E[0],f=E[1],_=Object(n.useState)(null),O=Object(o.a)(_,2),x=O[0],j=O[1];return Object(n.useEffect)(()=>{if(c.length>0){const e=[],t={};c.forEach(a=>{let n=a.region;a.active||(n="inactive"),t[n]||(t[n]=[]),t[n].push(a),e.push(Object(u.a)(Object(u.a)({},a),{},{url:"".concat(i,"/").concat(a.site_code)}))}),f(e),j(t)}},[c]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(we,{title:"Community | Site Information"})),r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(m.d,{location:l},r.a.createElement(m.b,{exact:!0,path:i,render:e=>r.a.createElement(y.a,{container:!0,spacing:3,justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},null===h?r.a.createElement(ks,null):r.a.createElement("div",{className:t.sticky},r.a.createElement(js,{siteMapData:h,width:a,url:i,hoveredSite:p}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center"},r.a.createElement(v.a,{variant:"h5",component:y.a,item:!0,xs:12,align:"center",gutterBottom:!0},r.a.createElement("strong",null,"Dynaslope Project Sites")),null===x?"Loading":r.a.createElement(Cs,{sitesPerRegion:x,url:i,setHoveredSite:g})))}),r.a.createElement(m.b,{path:"".concat(i,"/:site_code"),render:e=>{const t=e.match.params.site_code,n=c.filter(e=>e.site_code===t).pop();return r.a.createElement(xs,Object.assign({},e,{width:a,siteInformation:n}))}}))))}));var As=function(e){const t=e.location,a=e.match.url;return r.a.createElement(m.d,{location:t},r.a.createElement(m.b,{exact:!0,path:a,component:dr}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/events"),component:Mr}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/shifts_and_reports"),component:gl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/issues_and_reminders"),component:Nl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring/logs"),component:Cl}),r.a.createElement(m.b,{path:"".concat(a,"monitoring"),render:()=>r.a.createElement("h3",null," Not yet created")}),r.a.createElement(m.b,{path:"".concat(a,"analysis/sites"),component:mc}),r.a.createElement(m.b,{path:"".concat(a,"analysis"),render:()=>r.a.createElement("h3",null," Not yet created")}),r.a.createElement(m.b,{path:"".concat(a,"communication/chatterbox"),component:yo}),r.a.createElement(m.b,{path:"".concat(a,"communication/contacts"),component:$o}),r.a.createElement(m.b,{path:"".concat(a,"communication/mailbox"),component:cs}),r.a.createElement(m.b,{path:"".concat(a,"communication"),render:()=>r.a.createElement("h3",null,"Sorry. We could not find what you are looking for.")}),r.a.createElement(m.b,{path:"".concat(a,"community/site_info"),component:ws}),r.a.createElement(m.b,{render:()=>r.a.createElement("h3",null," Not found")}))};var Is=function(e){const t=e.match.params,a=t.site_code,l=t.ts_end,i=t.chart_type,s=t.tsm_sensor,m=Object(n.useState)(""),d=Object(o.a)(m,2),u=d[0],p=d[1],g=Object(n.useState)(""),b=Object(o.a)(g,2),E=b[0],h=b[1],f=Object(n.useState)(""),_=Object(o.a)(f,2),y=_[0],v=_[1],x=Object(c.b)().enqueueSnackbar,j=D(),S=Object(O.a)(e=>Object(V.a)(e))();Object(n.useEffect)(()=>{x("Please wait for the charts to load before closing the page. If loading took long enough, please wait for about a minute and check your connection before trying again. If loading problem persist, contact the developers.",{variant:"warning",autoHideDuration:1e4,style:{whiteSpace:"pre-line"},anchorOrigin:{vertical:"top",horizontal:"center"}});const t={site_code:a,ts_end:l};let n;"rainfall"===i?(n=r.a.createElement(xi,Object.assign({},e,{input:t,currentUser:j,disableBack:!0,saveSVG:!0})),p(n)):"surficial"===i?(n=r.a.createElement(hi,Object.assign({},e,{input:t,currentUser:j,disableBack:!0,disableMarkerList:!0,isEndOfShift:!0,saveSVG:!0})),h(n)):"subsurface"===i&&(t.tsm_sensor=s,n=r.a.createElement(Ii,Object.assign({},e,{input:t,currentUser:j,disableBack:!0,saveSVG:!0})),v(n))},[]);const k=ie(i);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:S.pageContentMargin},r.a.createElement(we,{title:"Chart Rendering | ".concat(a.toUpperCase()," | ").concat(k)})),r.a.createElement("div",{className:S.pageContentMargin},u,E,y))};var Ds=Object(d.a)(e=>({app:{height:"100%",minHeight:"85vh",display:"flex",flexDirection:"column",justifyContent:"space-between"},body:{marginTop:60,[e.breakpoints.up("sm")]:{marginTop:70},[e.breakpoints.up("md")]:{marginTop:124}}}))((function(e){const t=e.classes;Object(n.useEffect)(()=>{document.title="MIA 3.0 - Dynaslope Monitoring and Information Application"},[]);const a=Object(n.useState)(!1),l=Object(o.a)(a,2),i=l[0],c=l[1],d=e=>()=>{c(e)},u=Object(n.useState)(null),p=Object(o.a)(u,2),g=p[0],b=p[1],E=Object(n.useRef)(!1);Object(n.useEffect)(()=>(w(e=>{b(e),e&&(E.current=setInterval(A,15e5))}),()=>clearInterval(E.current)),[]);const h=()=>{b(!0),E.current=setInterval(A,15e5)},f=()=>{b(!1),clearInterval(E.current)};return r.a.createElement(s.a,null,r.a.createElement(m.d,null,r.a.createElement(m.b,{path:"/bulletin/:release_id",component:yt}),r.a.createElement(m.b,{path:"/chart_rendering/:site_code/:ts_end/:chart_type/:tsm_sensor?",component:Is}),r.a.createElement(m.b,{exact:!0,path:"/login",render:e=>null===g?r.a.createElement("div",null,"Loading..."):g?r.a.createElement(m.a,{to:"/"}):r.a.createElement(Y,Object.assign({},e,{onLogin:h}))}),r.a.createElement(m.b,{path:"/",render:e=>null===g?r.a.createElement("div",null,"Loading..."):g?r.a.createElement(Oe,null,r.a.createElement(xa,null,r.a.createElement(Q,Object.assign({},e,{drawerHandler:d,onLogout:f})),r.a.createElement(Se,{drawerHandler:d,drawer:i}),r.a.createElement("div",{className:t.app},r.a.createElement("div",{className:t.body},r.a.createElement(As,e))),r.a.createElement(F,null))):r.a.createElement(m.a,{to:"/login"})})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ms(){}console.log=Ms,console.warn=Ms,console.error=Ms,i.a.render(r.a.createElement(c.a,{maxSnack:3,anchorOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(Ds,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[479,1,2]]]);
//# sourceMappingURL=main.1a2b290c.chunk.js.map