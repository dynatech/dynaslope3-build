(this["webpackJsonpmia-3.0"]=this["webpackJsonpmia-3.0"]||[]).push([[0],{10:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return l}));const n="http://192.168.150.110:5000",r="http://192.168.150.110",l=15e5},103:function(e,t){e.exports="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAgMAAAACc8MQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURcXFxf///+np6dbW1sCaIHAAAAnDSURBVHja7d0xbuw2FEBRNW7UaGtu1LDR1tiwcTNbU6NmGgcJEqQIkPx4SOq9uffuQAcg+Uj/by+LmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ5e77+fW1/1H5+vo+BYB9/Z/f/nflcQpAafvH1/9lIAD58zEEcIDtuf9r5VuAt+7Z9v/q6xQAuf8hdkI6wHfbf613nYrpAM/9lyunAOjvf08BOMCvnYBvfBbSAba2/98eArC//70E8AA/+f59rwIgZ6B3nIboAD/8/vcRoAP8+PvfRYAOsO0vdAjAnILfaR7GA7z2/W8wD9MBni9+f/qTkA6w7S93CEDeAtNvg3SAZ4fvT70N0gG2vUuHAOQtMPU2SAd4dvr+tNsgHWDrtQKyPovgAbqtgKxrgA6w7R07BMjX1RNgPwVAr4CMawAP0PoC5LsQ0QHWzt+/FwHYKyDdGqADbN2/P9lBiAe4+gPkmobpAANWQK41gAcYsQJSrQE6wNaGADwEAD6I53wcxwOMWQGJ7kN0gHXQ96d5FMEDXKMAsoxCdIBt2PcnuQ/hAdZxAEUA8hiUZhSiAwzcA3PsgniAayRAhlEID9CGAlQBwGNQjlEIDzB2D0ywC+IB2mCAKgB4EM4wDOMBRu+B4XdBPEAbDlAFQO+B0XdBPMA6HqAIwD4Fg5+DeIA2AaAKgN4DY++CeIAZe2DoXRAP0KYAVAHAV6HY1yE8wDoHoAjAPgUDn4N4gDYJoAoggADgOSjuJIQHWGcBFAHYc1DYSQgP0KYBVAHQp2DUc1AAAeAA6zyAIgB7Dgo6CeEB2kSAKoAAAoDnoJiTEB5gnQlQBBBAAPIkHHIWFkAAOECbClAFCNfU798/BUDfhSLehvAA61yAIoAAAsTqYy7ALgD7LhTwNoQHaJMBqgACCAC+DQe8DwsgABtgmw1wCCCAAOD3kHgvIgIIAAeY/SIW7k1MAAHgANd0gFMAAQQQQADsq3i4d3EBBBBAAAEEEEAALMD074/201EBBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAAMgD8bFEAAAQQQQAABBKACXNMB/P8CAggggABx8v8OCyAAG8DfISKAAGwAf5eYAAKwAfydogIIAAfwd4sLIAAbYParqH9jJBqAf2eIDuDfGhNAADaAf3OUDuDfHcYD+LfH6QBzb0OnAAIIQJ6F403CAgiAB5h6GzoECNjMWbgKIIAA6Fn4FIA9CUWcgwSYOQkdAgggAHoSqgKE7GLPQQLMm4RizkECzDsHDwGC1tinoAAC4AEu9hwkwKxJKOocJMCsSegQIGyNfQoKMOkcPAVgn4NxT0EB5uyCVYCFvQueArB3wdB7oAATrkOHAKFr7FNQgAnn4CkAexcMvgcKMHwXrAIs7F3wFCB4g69DZRGAvQtWARb2LngKEL4NPQgLMHgXrAIkaEWPQQIM3QUPAVJ0kccgAUbugjn2QAHGjUJVgCQ9B62AU4AkbWPWwGMRIEsXeQwSYNR96FgEYK+BUwD2Gki1AgQYcB+qAqSq+6NIWQRgr4EqQLI29CEoQPdp+BSAvQYSrgABej6Ol1OAjGug3yz0WARAr4GcK0CAfheiugiQsw08BQnQbxtMuwUK0GkbrIsAC3kbPBYBMvdEb4ECdNgG6yJA7l58FnksAqQXAJ+BArx6EqY/AwV4TeBNvl+Anwq8zfcL8MN5uC4CvEfbD5fA4xTgPb6/wY9BOsDzhftweQhAvgq9x4MIHGD7evVZ/OsUgPsimv8spAP0+aeSiQXoAL3+rWxaATpAv38snVSADtDzd+mkFKAD9P1lSgkF6AC9f5tWOgE6QP9fp5ZMgA4w4vfppRLAA1z7gA4BKE/h+Z/I6QCDvj+PAB1g4B9YOAWADkGphiE8wNA/t1cE4J6BWU5COsDgv7ka/9/P0gG20X95O/pJiAe49uEdAnDPwPgnIR1g/BYYfBvEA0z5/sg3IjrAc5/UQwDwFhh4G8QDXPu0DgGITyHRn0XoAPO2wKDbIB7guU/tIUC0FbBP7hQAOwXFnIXoAOs+vSoA8DEs7sMYHeC539BDAOhFKOCFCA9wywqItAboAPesgEBrAA9w0wqIswboANt+W6cAyLeQaK8idIAbV0CMNYAHuO4EOARgr4AIawAPcN0LcAgAvQqHuRLjAZ77zT0EQK+A29cAHuD2FXD3GsADtPsBigA3tu4BqgKgV8C9a4AOEGIF3LkG8ABXDIBDAOZ76P0vo3iAZxSAhwDgMejOUYgOsO5hqgKgV8Bda4AOsO2BOgXA3oTuuw/hAVokgCIAeQy6ZxTCA1yxAA4ByGPQHaMQHmCNBlAFAI9Bd4xCdIBwe+DsXRAPcMUDOARA74Gzd0E6wLoHrAqA3gPn7oJ4gBYRoAjA3gNn7oJ4gCsmwCEAeg+cuQvSAYLugfN2QTzAFRXgEAC9B87bBekAYffAWbsgHuCKC3AIgN4DZ+2CdIBtD9wpAPoUnHMO4gFaZIAiAHsPnLEL4gHW2ABVAPBVaM51CA/QYgMUAdin4PhzEA+wRgeoAqD3wPG7IB0g/B44ehfEA6zxAaoA4KvQ+OsQHqDFBygCsE/BsecgHmDNAFAFQJ+CY89BPEDLAFAEYJ+CI89BPMCaA6AKgD4FR56DeICWA6AIwD4Fx52DeIA1C0AVAH0KjjsH8QAtC0ARQAAByHPQqEkID7DmAagCoOegUZMQHqDlASgCsE/BMecgHmDNBFAFEEAA8Bw0ZhLCA7RMAEUA9hw0YhLCA6y5AKoAAggAnoNGTEJ4gJYLoAjAnoP6T0ICCAAHWLMBVAHQc1D/SQgP0LIBFAEEEIA8B/WehPAAaz6AKoAAAoAn4d6zMB6g5QMoAgggAHkS7jsL4wHWjABVAAEEAE/CfWdhAQSAA7SMAEWAfu0pE4B9F+p5G8IDrDkBqgACCACehHvOwgIIAAdoOQGKAAIIQL4L9bsNCSAAHGDNClAFEEAA8F2o321IAAHgAC0rQBFAAAG4Pxz/PQHYt+Fe92EBBIADrHkBqgACCPB6H3kBPgVAv4f0ehERQAA4QMsLUAQQQADyi1inNzE6wJYZ4BRAAAHA7yF9XkQEEEAAAdAAH5kBPgVAv4j1eRMTQAABBEADtMwARQABBBBAAO7PRbr8ZEQAAdgAW26AUwABBBBAAOzPRXr8ZEQAAQQQQAABwAAfuQE+BRBAAAEEwP50vMfPxwUQQAABBBAADNByAxQBBBBAAAH+pd8AoDH47zbOd5EAAAAASUVORK5CYII="},1092:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(21),i=a.n(l),c=(a(662),a(24)),o=a(2),s=a(9),m=a(37),u=a(59),d=a(8),p=a(3),b=a(157),g=a(1126),f=a(327),E=a(423),v=a(1125),h=a(112),_=a(381),y=a(355),O=a(50),j=a(76),x=a(1128),k=a(22),S=a(207),C=a.n(S),D=a(609),A=a.n(D);function w(){return r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",r.a.createElement(v.a,{color:"inherit",href:"https://material-ui.com/"},"Project Dynaslope")," ",(new Date).getFullYear(),".")}const I=Object(j.a)(e=>({root:{height:"100vh"},image:{backgroundImage:"url(".concat(A.a,")"),backgroundSize:"cover",backgroundPosition:"center"},paperContainer:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{margin:e.spacing(0,4),display:"flex",flexDirection:"column",alignItems:"center",paddingBottom:e.spacing(5),[e.breakpoints.up("lg")]:{paddingBottom:e.spacing(9)}},phivolcsDynaslopeLogo:{margin:e.spacing(1),height:200,[e.breakpoints.between("sm","md")]:{height:164},[e.breakpoints.only("xs")]:{height:140}},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},title:{margin:e.spacing(2,0),[e.breakpoints.down("sm")]:{fontSize:"1.25rem"},[e.breakpoints.only("xs")]:{margin:e.spacing(0,0)}},passwordField:{margin:e.spacing(0,0,3,0),[e.breakpoints.only("xs")]:{margin:e.spacing(0,0,1,0)}},buttonChild:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"}}));function M(e){const t=I(),a=Object(n.useState)({username:"",password:""}),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)({username:!1,password:!1}),m=Object(o.a)(s,2),u=m[0],d=m[1],v=Object(n.useState)(""),j=Object(o.a)(v,2),S=j[0],D=j[1],A=Object(n.useState)(!1),M=Object(o.a)(A,2),T=M[0],N=M[1],Y=e.history,R=e.onLogin,H=()=>{Object.entries(i).forEach(e=>{const t=Object(o.a)(e,2),a=t[0],n=t[1];""===n&&U(a,n)}),Object.values(u).includes(!0)?D("Fill up all required fields"):(N(!0),Object(k.c)(i,()=>{N(!1),R(),Y.push("/")},e=>{N(!1),D(e)}))},B=i.username,P=i.password,L=e=>t=>{const a=t.target.value;c(Object(p.a)(Object(p.a)({},i),{},{[e]:a})),D(""),U(e,a)},F=e=>t=>{U(e,i[e])},U=(e,t)=>{d(Object(p.a)(Object(p.a)({},u),{},{[e]:""===t}))};return r.a.createElement(y.a,{container:!0,component:"main",className:t.root},r.a.createElement(g.a,null),r.a.createElement(y.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),r.a.createElement(y.a,{item:!0,xs:12,sm:8,md:5,component:h.a,elevation:6,square:!0,className:t.paperContainer},r.a.createElement("div",{className:t.paper},r.a.createElement("img",{src:C.a,alt:"PHIVOLCS-Dynaslope Logo",className:t.phivolcsDynaslopeLogo}),r.a.createElement(O.a,{component:"h1",variant:"h5",align:"center",className:t.title},r.a.createElement("strong",null,"MONITORING AND INFORMATION APPLICATION (MIA 3.0)")),r.a.createElement("div",{className:t.form},r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:B,onChange:L("username"),onFocus:F("username"),error:u.username}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:P,onChange:L("password"),onKeyPress:e=>{"Enter"===e.key&&H()},onFocus:F("password"),error:u.password,className:t.passwordField}),""!==S&&r.a.createElement(E.a,{error:!0,focused:!0},S),r.a.createElement(b.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:H,disabled:T},T?r.a.createElement("div",{className:t.buttonChild},r.a.createElement("span",{style:{marginRight:6}},"Signing In... "),r.a.createElement(x.a,{color:"secondary",size:20})):r.a.createElement("span",null,"Sign In")),r.a.createElement(_.a,{mt:5},r.a.createElement(w,null))))))}var T=a(1129),N=a(334);var Y=Object(d.a)(e=>({footer:{display:"flex",padding:"2% 0",flexDirection:"column",marginTop:40,justifyContent:"center",alignItems:"center",textAlign:"center",[e.breakpoints.down("sm")]:{marginTop:30},zIndex:0},footerText:{fontSize:"0.5rem",[e.breakpoints.up("sm")]:{fontSize:"0.85rem"}}}))((function(e){const t=e.classes;return r.a.createElement(T.a,{position:"static",className:t.footer},r.a.createElement(N.a,null,r.a.createElement(O.a,{variant:"subtitle2",color:"inherit",className:t.footerText},"4F PHIVOLCS Building, C. P. Garcia Avenue, UP Campus, Diliman, Quezon City 1101 ",r.a.createElement("br",null),"Tel. no. (02) 8426-1468 loc. 401 & 403 | dynaslope.phivolcs@gmail.com ",r.a.createElement("br",null),"www.facebook.com/dynaslopecommunity")))})),R=a(215),H=a(1139),B=a(611),P=a(510),L=a(644),F=a(649),U=a(1138),q=a(1140),W=a(1106),z=a(1107),G=a(1130),V=a(1131),Q=a(647),Z=a(1132),K=a(1133),J=a(1134),X=a(6),$=a.n(X),ee=a(99),te=a(10),ae=a(15),ne=a.n(ae);function re(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"end",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"province",r=e.purok,l=e.sitio,i=e.barangay,c=e.municipality,o=e.province,s=e.site_code,m="";if(null!==l&&""!==l&&(m="Sitio ".concat(l,", ")),null!==r&&""!==r&&(m+="Purok ".concat(r,", ")),m+="Brgy. ".concat(i),"barangay"!==n&&(m+=", ".concat(c)),"province"===n&&(m+=", ".concat(o)),t){var u=s.toUpperCase();"end"===a?m+=" (".concat(u,")"):m="".concat(u," (").concat(m,")")}return m}function le(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};if(t){var n=e.split(" "),r=n.map((function(e){return a(e)}));return r.join(" ")}return a(e)}function ie(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null,n=e.map((function(e){var n=e.site,r=e.org_name;return a=r.toUpperCase(),t?n:n.site_code.toUpperCase()}));return t?{sites:n,org:a}:(a&&n.unshift(a),n)}function ce(e){var t=!1;return e.length>0&&(t=Boolean(e[0].primary_contact)),t}function oe(e){return"0"===e[0]||e.match(/[a-z]/i)?e:"+".concat(e)}function se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"days";if("all"===a)return"None";var n="YYYY-MM-DD HH:mm:ss",r=e.clone().subtract(t,a).format(n);return r}function me(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;ne.a.post(e,t).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e),null!==n&&n(e)}))}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ne.a.get(e).then((function(e){var a=e.data;null!==t&&t(a)})).catch((function(e){console.log(e)}))}function de(e){var t=["january","february","march","april","may","june","july","august","september","october","november","december"];e.sort((function(e,a){return t.indexOf(e)-t.indexOf(a)}))}const pe=Object(n.createContext)(),be=({children:e})=>{const t=Object(n.useReducer)((function(e,t){const a=t.action,n=t.data,r=e.notifications;switch(a){case"INSERT":return Object(p.a)({},n);case"UPDATE_COUNT":return Object(p.a)(Object(p.a)({},e),{},{count:n});case"UPDATE_NOTIFICATION":const t=n.notification_id,a=n.value,l=[...r],i=l.findIndex(e=>e.notification_id===t);return l[i].ts_read=a,Object(p.a)(Object(p.a)({},e),{},{notifications:l});default:return e}}),{notifications:[],count:0}),a=Object(o.a)(t,2),l=a[0],i=a[1];Object(n.useEffect)(()=>{Object(ee.c)(),Object(ee.f)(e=>i({action:"INSERT",data:e}))},[]);const c={notifications_object:l,setNotificationsObject:i,setNotificationCountToZero:function(e){i({action:"UPDATE_COUNT",data:0}),function(e){me("".concat(te.b,"/api/notifications/set_all_seen_notifications"),{user_id:e})}(e),Object(ee.f)(e=>i({action:"INSERT",data:e}))},toggleReadTS:function(e,t,a){const n="read"===a?$()().format("YYYY-MM-DD HH:mm:ss"):null;i({action:"UPDATE_NOTIFICATION",data:{notification_id:t,value:n}}),function(e,t,a){me("".concat(te.b,"/api/notifications/update_ts_read"),{user_id:e,notification_id:t,ts_read:a})}(e,t,n)},getUserNotifications:ee.c};return r.a.createElement(pe.Provider,{value:c},e)},ge=Object(j.a)(e=>({divider:{margin:"16px 0"},sectionHead:{marginBottom:12},cardSection:{marginBottom:12},card:{marginBottom:8},cardUnread:{backgroundColor:"lightgray"},cardContent:{paddingBottom:"16px !important",display:"flex",justifyContent:"space-between",alignItems:"center"},toggleReadIcon:{marginLeft:8},notifTS:{marginTop:8},noNotifs:{display:"flex",padding:48,justifyContent:"center",border:"1px solid lightgray"}})),fe=r.a.memo(e=>{const t=e.classes,a=e.details,n=e.toggleNotifStatus,l=e.goToLink,i=a.notification_id,c=a.message,o=a.ts_read,s=a.ts,m=a.link,u=o?"unread":"read";return r.a.createElement(G.a,{variant:"outlined",className:"".concat(t.card," ").concat(o?"":t.cardUnread)},r.a.createElement(V.a,{className:t.cardContent,component:_.a},r.a.createElement(_.a,null,r.a.createElement(O.a,{variant:"body2",component:"div"},c),r.a.createElement(O.a,{variant:"caption",component:"div",className:t.notifTS},$()(s).format("D MMMM YYYY, HH:mm"))),r.a.createElement(_.a,{align:"right",className:t.toggleReadIcon},m&&r.a.createElement(R.a,{"aria-label":"go-to-link",color:"primary",disableRipple:!0,disableFocusRipple:!0,edge:"end",size:"small",onClick:l(m,i,!o),title:"Go to link"},r.a.createElement(Z.a,null)),r.a.createElement(R.a,{"aria-label":"toggle-notif-status",color:"primary",disableRipple:!0,disableFocusRipple:!0,edge:"end",size:"small",onClick:n(i,u),title:"Mark as ".concat(u)},o?r.a.createElement(K.a,null):r.a.createElement(J.a,null)))))});var Ee,ve,he=function(e){const t=e.history,a=e.handleCloseNotif,l=ge(),i=Object(k.a)().user_id,c=Object(n.useContext)(pe),s=c.notifications_object,m=c.toggleReadTS,u=s.notifications,d=Object(n.useState)(1),p=Object(o.a)(d,2),g=p[0],f=p[1],E=[],v=[];u.forEach(e=>{null===e.ts_read?E.push(e):v.push(e)});const h=v.slice(0,10*g),y=v.length>10*g,j=0!==E.length,x=r.a.useCallback((e,t)=>()=>{m(i,e,t)},[]),S=(e,n,r)=>()=>{a(),t.push(e),r&&m(i,n,"read")};return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"h4"},"Notifications"),r.a.createElement(Q.a,{className:l.divider}),r.a.createElement(_.a,{display:"flex",justifyContent:"space-between",alignItems:"baseline"},r.a.createElement(O.a,{variant:"h6",className:l.sectionHead},"Unread notifications"),j&&r.a.createElement(b.a,{color:"primary",onClick:()=>{E.forEach(e=>{const t=e.notification_id;m(i,t,"read")})}},"Mark all as read")),r.a.createElement("div",{className:l.cardSection},j?E.map(e=>r.a.createElement(fe,{classes:l,details:e,key:e.notification_id,toggleNotifStatus:x,goToLink:S})):r.a.createElement(O.a,{variant:"body1",component:"div",className:l.noNotifs},"No unread notifications")),r.a.createElement(O.a,{variant:"h6",className:l.sectionHead,style:{marginTop:24}},"Previous notifications"),r.a.createElement("div",{className:l.cardSection},0===h.length?r.a.createElement(O.a,{variant:"body1",component:"div",className:l.noNotifs},"No previous notifications"):h.map(e=>r.a.createElement(fe,{classes:l,details:e,key:"notification-".concat(e.notification_id),toggleNotifStatus:x,goToLink:S}))),r.a.createElement(_.a,{display:"flex",justifyContent:"space-between",alignItems:"baseline"},y&&r.a.createElement(b.a,{color:"primary",onClick:()=>f(g+1)},"Load more previous notifications...")))},_e=a(27),ye=a(29),Oe=a(1102),je=a(1135),xe=a(1103),ke=a(1136),Se=a(1104),Ce=a(1137),De=a(208),Ae=a.n(De);function we(e){"undefined"!==typeof Ee&&null!==Ee||(Ee=Ae()("".concat(te.b,"/monitoring"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]})),Ee.on("reconnecting",(function(){e(!0)})),Ee.on("reconnect",(function(){e(!1)})),Ee.on("reconnect_failed",(function(){console.log("failed")}))}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("Payload: { key: data }",e,t);var a={data:t,key:e};Ee.send(a)}function Me(e,t){"undefined"!==typeof ve&&null!==ve||(ve=Ae()("".concat(te.b,"/communications"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]})),ve.emit("get_latest_messages"),ve.emit("get_all_mobile_numbers"),ve.emit("get_all_contacts"),ve.on("reconnecting",(function(){e(!0)})),ve.on("reconnect",(function(){e(!1)})),ve.on("reconnect_failed",(function(){console.log("failed")}))}var Te=Object(n.createContext)(),Ne=function(e){var t=e.children,a=Object(n.useState)(null),l=Object(o.a)(a,2),i=l[0],s=l[1],m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],p=u[1],b=Object(n.useState)(null),g=Object(o.a)(b,2),f=g[0],E=g[1],v=Object(n.useState)([]),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(n.useState)({inbox:null,unsent:null,queue:null}),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)([]),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)(null),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(c.b)(),q=U.enqueueSnackbar,W=U.closeSnackbar,z=Object(n.useState)(null),G=Object(o.a)(z,2),V=G[0],Q=G[1];Object(n.useEffect)((function(){if(null!==L)if(!0===L){var e=q("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});Q(e)}else W(V),q("Reconnection successful...",{variant:"success",autoHideDuration:5e3})}),[L]),Object(n.useEffect)((function(){var e;return we(F),Me(F),e=function(e){return s(e)},Ee.on("receive_generated_alerts",(function(t){var a=JSON.parse(t);console.log("Generated alerts: ",a),e(a)})),function(e){Ee.on("receive_candidate_alerts",(function(t){var a=JSON.parse(t);console.log("Candidate alerts: ",a),e(a)}))}((function(e){return p(e)})),function(e){Ee.on("receive_alerts_from_db",(function(t){var a=JSON.parse(t);console.log("Alerts from DB: ",a),e(a)}))}((function(e){return E(e)})),function(e){Ee.on("receive_ewi_insert_response",(function(t){var a=JSON.parse(t);e(a)}))}((function(e){var t=e.snackbar_key,a=e.message,n=e.status;W(t),q(a,{variant:n?"success":"error",autoHideDuration:7e3})})),function(e){Ee.on("receive_issues_and_reminders",(function(t){var a=JSON.parse(t);e(a)}))}((function(e){return y(e)})),function(e){Ee.on("receive_rainfall_data",(function(t){var a=JSON.parse(t);console.log("All Site Rainfall Data: ",a),e(a)}))}((function(e){return k(e)})),function(e){ve.on("receive_latest_messages",(function(t){console.log("Latest messages",t),e(t)}))}((function(e){return A(e)})),function(e){ve.on("receive_all_mobile_numbers",(function(t){console.log("All Saved Mobile Numbers",t),e(t)}))}((function(e){return T(e)})),function(e){ve.on("receive_all_contacts",(function(t){console.log("All Contacts",t),e(t)}))}((function(e){return H(e)})),function(){Ee.close(),Ee=null,ve.close(),ve=null}}),[]);var Z={generatedAlerts:i,candidateAlertsData:d,alertsFromDbData:f,issuesAndReminders:_,rainfallSummaryData:x,latestMessageCollection:D,recipientsList:M,contacts:R};return r.a.createElement(Te.Provider,{value:Z},t)},Ye=a(612),Re=a.n(Ye),He=Object(Ce.a)()((function(e){var t=Object(n.useContext)(Te).candidateAlertsData,a=Object(n.useState)(!1),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(null),_=Object(o.a)(h,2),j=_[0],x=_[1],k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],D=S[1];Object(n.useEffect)((function(){if(clearInterval(E),clearTimeout(j),t){var e=[],a=[];Object(ye.a)(t).map((function(t){if("routine"!==t.general_status){var n=t.trigger_list_arr;if("undefined"!==typeof n){var r=n.filter((function(e){return null===e.validating_status}));if(r.length>0){e.push(r);var l=Object(p.a)(Object(p.a)({},t),{},{trigger_list_arr:r});a.push(l)}}}return e}));var n=function(){c(!0);var e=setTimeout(r,3e4);x(e)},r=function(){c(!1),D(!0)};if(e.length>0){C||n(),d(a);var l=setInterval((function(){clearTimeout(j),n()}),18e4);v(l)}else r(),clearInterval(E),D(!1)}}),[t]);var A=Object(n.useState)(new Audio(Re.a)),w=Object(o.a)(A,1)[0];Object(n.useEffect)((function(){i?w.play():(w.pause(),w.currentTime=0)}),[i]);var I=function(){return c(!1)};return r.a.createElement(Oe.a,{fullWidth:!0,open:i,disableBackdropClick:!0,onClose:I,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"New alerts for validation"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Validate the following alert triggers. Acknowledge all alerts on candidate alerts' validation dialog box."),u&&u.map((function(e,t){var a=e.site_code,l=e.trigger_list_arr;return r.a.createElement(y.a,{container:!0,spacing:2,key:a,style:{textAlign:"center"}},r.a.createElement(O.a,{gutterBottom:!0,variant:"h6",component:y.a,item:!0,xs:12},"Site Code: ",a.toUpperCase()),l.length>0&&l.map((function(e,t){var a=e.trigger_alert_level,l=e.ts_updated;return r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{color:"textSecondary"},"Trigger"),r.a.createElement(O.a,{variant:"body2",component:"p"},a)),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement(O.a,{color:"textSecondary"},"Trigger timestamp"),r.a.createElement(O.a,{variant:"body2",component:"p"},$()(l).format("DD MMMM YYYY, HH:mm"))))})))}))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:I},"Close")))})),Be=Object(j.a)((function(e){var t;return Object(p.a)(Object(p.a)({},Object(_e.d)(e)),{},{root:{width:"100%"},grow:{flexGrow:1},menuButton:Object(s.a)({display:"flex",marginLeft:-12,marginRight:0},e.breakpoints.up("md"),{display:"none"}),projectTitle:{display:"block",fontWeight:900},titleBlock:{display:"block",margin:"0 4px",alignItems:"center",textAlign:"center",justifyContent:"center"},projectSubtitle:Object(s.a)({display:"none",fontSize:"0.7rem",marginTop:-3},e.breakpoints.up("md"),{display:"block"}),logo:Object(s.a)({marginRight:12},e.breakpoints.down("sm"),{marginRight:0}),sectionDesktop:Object(s.a)({display:"none"},e.breakpoints.up("md"),{display:"flex",padding:"4px 0"}),list:{width:250},menu:{marginTop:40},icon:{paddingRight:e.spacing(2)},paper:(t={position:"fixed",right:0,width:"45vw"},Object(s.a)(t,e.breakpoints.down("sm"),{width:"55vw"}),Object(s.a)(t,e.breakpoints.up("lg"),{width:"40vw"}),Object(s.a)(t,"height","100vh"),Object(s.a)(t,"zIndex",1300),Object(s.a)(t,"padding",24),Object(s.a)(t,"overflowY","auto"),Object(s.a)(t,"boxSizing","border-box"),t),backdrop:{zIndex:1299}})}));var Pe=r.a.memo((function(e){var t=e.drawerHandler,a=e.history,l=e.onLogout,i=Object(n.useState)(null),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Be(),d=function(){m(null)},p=Object(k.a)(),g=p.user_id,f=p.first_name,E=Object(n.useContext)(pe),v=E.notifications_object,_=E.setNotificationCountToZero,y=E.getUserNotifications,j=v.count,x=Object(n.useState)(!1),S=Object(o.a)(x,2),D=S[0],A=S[1],w=function(){A(!1),document.body.style.overflow="auto",_(g)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:u.root},r.a.createElement(T.a,{position:"fixed",color:"primary"},r.a.createElement(N.a,null,r.a.createElement(R.a,{onClick:t(!0),className:u.menuButton,color:"inherit","aria-label":"Open drawer"},r.a.createElement(U.a,null)),r.a.createElement("img",{src:C.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(u.phivolcsDynaslopeLogo," ").concat(u.logo," ").concat(u.sectionDesktop)}),r.a.createElement("div",{className:u.titleBlock},r.a.createElement(O.a,{className:u.projectTitle,variant:"h4",color:"inherit",noWrap:!0},"MIA 3.0"),r.a.createElement(O.a,{variant:"caption",className:u.projectSubtitle,color:"inherit"},"Monitoring and Information Application")),r.a.createElement("div",{className:u.grow}),r.a.createElement("div",{className:u.sectionDesktop},r.a.createElement(R.a,{color:"inherit",onClick:function(){A(!0),document.body.style.overflow="hidden",y()}},r.a.createElement(H.a,{badgeContent:j,color:"secondary"},r.a.createElement(q.a,null))),r.a.createElement(b.a,{"aria-owns":"menu-list-grow","aria-haspopup":"true",onClick:function(e){m(e.currentTarget)},color:"inherit",startIcon:r.a.createElement(W.a,null)},r.a.createElement("strong",null,f))))),r.a.createElement(B.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:d,className:u.menu},r.a.createElement(P.a,{onClick:function(){a.push("/profile"),d()}},r.a.createElement(W.a,{className:u.icon})," Profile"),r.a.createElement(P.a,{onClick:function(){Object(k.d)((function(){l(),a.push("/login")}))}},r.a.createElement(z.a,{className:u.icon})," Logout")),r.a.createElement(L.a,{direction:"left",in:D,mountOnEnter:!0},r.a.createElement(h.a,{elevation:4,className:u.paper},r.a.createElement(he,{history:a,handleCloseNotif:w}))),r.a.createElement(F.a,{open:D,className:u.backdrop,onClick:w})),r.a.createElement(He,null))})),Le=a(1116),Fe=a(651),Ue=a(1111),qe=a(257),We=a(646),ze=a(1100),Ge=a(197),Ve=a(613),Qe=a(110);const Ze=Object(j.a)(e=>({navBar:{display:"none",[e.breakpoints.up("md")]:{display:"block"}},appBar:{top:70},popper:{zIndex:500,marginTop:2},list:{width:250},link:{textDecoration:"none",color:"blue"}})),Ke=[{key:"monitoring",main:"Monitoring",sub:[{label:"Dashboard",link:"/"},{label:"Events Table",link:"/monitoring/events"},{label:"Shifts and Reports",link:"/monitoring/shifts_and_reports"},{label:"Issues and Reminders",link:"/monitoring/issues_and_reminders"},{label:"Site Logs",link:"/monitoring/logs"},{label:"Quality Assurance",link:"/monitoring/qa"}]},{key:"analysis",main:"Analysis",sub:[{label:"Site Data Analytics",link:"/analysis/sites"},{label:"Communications Analytics",link:"/analysis/communications",soon:!0},{label:"Monitoring Alerts Analytics",link:"/analysis/alerts"},{divider:!0},{label:"Loggers and Sensors Form",link:"/analysis/forms/loggers_and_sensors"}]},{key:"communication",main:"Communication",sub:[{label:"Chatterbox",link:"/communication/chatterbox"},{label:"Contacts",link:"/communication/contacts"},{label:"Mailbox",link:"/communication/mailbox"}]},{key:"community",main:"Community",sub:[{label:"Site Information",link:"/community/site_info"},{label:"Stakeholders' Concerns",link:"/community/concerns",soon:!0},{label:"Community Feedback",link:"/community/feedback",soon:!0}]},{key:"knowledge",main:"Knowledge Management",sub:[{label:"Protocols",link:"/knowlegde/protocols",soon:!0},{label:"Papers",link:"/knowledge/papers",soon:!0}]}];var Je=r.a.memo(Object(Ge.a)()((function(e){const t=e.width,a=e.drawerHandler,l=e.drawer,i=e.history,c=e.onLogout,s=Ze(),u=window.location.pathname.split("/")[1],d=Ke.findIndex(e=>e.key===u),p=Object(n.useState)(-1===d?0:d),b=Object(o.a)(p,2),g=b[0],f=b[1],E=Object(n.useState)(null),v=Object(o.a)(E,2),_=v[0],j=v[1],x=Object(n.useState)(null),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(null),N=Object(o.a)(M,2),Y=N[0],R=N[1],H=Object(n.useContext)(Qe.a).server_time,B=Ke[g===_&&null!==S?S:g].sub;Object(n.useEffect)(()=>{C(g)},[g]);const L=e=>{const t=g;I(!0),R(e.currentTarget),j(t)},F=e=>{Y.contains(e.target)||(I(!1),setTimeout(()=>f(_),100))},U=e=>{I(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:s.navBar},r.a.createElement(T.a,{position:"fixed",color:"default",className:s.appBar},r.a.createElement(y.a,{container:!0,spacing:0,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Le.a,{value:g,onChange:(e,t)=>{f(t)},indicatorColor:"primary",textColor:"primary",variant:Object(Ge.c)("md",t)?"standard":"scrollable",scrollButtons:"on",centered:Object(Ge.c)("md",t)},Ke.map(({main:e,key:t})=>r.a.createElement(Fe.a,{key:t,label:e,"aria-owns":w?"monitoring-menu":null,"aria-haspopup":"true",onClick:L})))),r.a.createElement(y.a,{item:!0,xs:2,align:"center"},r.a.createElement(O.a,{variant:"button"},H?$()(H).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time..."))))),r.a.createElement(Ue.a,{className:s.popper,open:w,anchorEl:Y,transition:!0,disablePortal:!0},({TransitionProps:e,placement:t})=>r.a.createElement(qe.a,Object.assign({},e,{id:"monitoring-menu",style:{transformOrigin:"bottom"===t?"center top":"center bottom"}}),r.a.createElement(h.a,null,r.a.createElement(We.a,{onClickAway:F},r.a.createElement(ze.a,null,B.map((e,t)=>{const a=e.label,n=e.link,l=e.soon,i=e.divider,c="undefined"!==typeof l;return c?r.a.createElement(P.a,{key:a,onClick:U,disabled:c},a,c&&r.a.createElement(O.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")):"undefined"!==typeof i?r.a.createElement(P.a,{key:t,divider:!0,button:!1,style:{paddingTop:2,marginBottom:8}}):r.a.createElement(m.b,{to:n,key:a,className:s.link},r.a.createElement(P.a,{onClick:U},a))})))))),r.a.createElement(Ve.a,{drawer:l,drawerHandler:a,navigationLabels:Ke,history:i,onLogout:c}))}))),Xe=a(1249),$e=a(1151),et=a(1152),tt=a(1153),at=a(1176),nt=a(1177),rt=a(1178),lt=a(1156),it=a(1179),ct=a(1110),ot=a(1180),st=a(1252),mt=a(1181);var ut=Object(d.a)(e=>({pageTitleContainer:{margin:"24px 0 18px",[e.breakpoints.down("sm")]:{margin:"10px 0 10px"}},pageTitle:{fontSize:"0.85rem"},hasCustomButtons:{display:"flex",alignItems:"baseline",justifyContent:"space-between",paddingTop:12,paddingBottom:12}}))((function({title:e,classes:t,customButtons:a}){const n=void 0!==a&&a;let l=t.pageTitleContainer;return n&&(l+=" ".concat(t.hasCustomButtons)),r.a.createElement("div",{className:l},r.a.createElement(O.a,{variant:"overline",className:t.pageTitle},e),a)})),dt=a(1141);const pt=e=>{e.preventDefault()};function bt(e){return r.a.createElement(Fe.a,Object.assign({component:"a",onClick:pt},e))}var gt=Object(d.a)(e=>({root:{flexGrow:1}}))((function(e){const t=e.chosenTab,a=e.onSelect,n=e.tabsArray,l=e.classes;return r.a.createElement(dt.a,null,r.a.createElement(T.a,{position:"static",color:"default",className:l.root},r.a.createElement(Le.a,{variant:"fullWidth",value:t,onChange:(e,t)=>{a(t)}},n.map(e=>{const t=e.label,a=e.href;return r.a.createElement(bt,{label:t,href:a,key:a})}))))})),ft=a(67),Et=a(1154),vt=a(430),ht=a(1155),_t=a(1157),yt=a(1158),Ot=a(1159),jt=a(1160),xt=a(1161),kt=a(1162),St=a(1163),Ct=a(1164),Dt=a(421),At=a(511),wt=a(512),It=a(1248);var Mt=Object(Ce.a)()(e=>{const t=e.isShowing,a=e.hide,l=e.data,c=e.isValidating,s=l.site,m=l.trigger_id,u=l.ts_updated,d=Object(n.useState)(""),p=Object(o.a)(d,2),g=p[0],E=p[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(k.a)();O.user_id;function j(){a(),E(""),y("")}const x=""===g;return t?i.a.createPortal(r.a.createElement(n.Fragment,null,r.a.createElement(Oe.a,{open:!0,onClose:j,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Validate Trigger"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Select whether trigger is valid or invalid. Also, provide remarks."),r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(At.a,{"aria-label":"trigger_validity",name:"trig_validity_1",row:!0,style:{justifyContent:"space-around"},value:g,onChange:function(e){const t=Number.parseInt(e.target.value,10);E(t)}},r.a.createElement(wt.a,{value:1,control:r.a.createElement(It.a,null),label:"Valid"}),!c&&r.a.createElement(wt.a,{value:0,control:r.a.createElement(It.a,null),label:"Validating"}),r.a.createElement(wt.a,{value:-1,control:r.a.createElement(It.a,null),label:"Invalid"}))),r.a.createElement(f.a,{autoFocus:!0,margin:"dense",id:"remarks",label:"Remarks",onChange:function(e){y(e.target.value)},value:_,fullWidth:!0})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:j,color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:e=>{!function(e,t,a,n,r,l){Ie("validate_trigger",{site_code:e,alert_status:n,trigger_id:t,trigger_ts:a,remarks:r,user_id:l})}(s,m,u,g,_,O.user_id),a(),E(""),y("")},color:"primary",disabled:x},"Confirm")))),document.body):null});var Tt=()=>{const e=Object(n.useState)(!1),t=Object(o.a)(e,2),a=t[0],r=t[1];return{isShowing:a,toggle:function(){r(!a)}}},Nt=a(216),Yt=a.n(Nt),Rt=a(615),Ht=a.n(Rt),Bt=a(616),Pt=a.n(Bt);function Lt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.offsetHeight,n=getComputedStyle(e),r=n.marginBottom,l=n.marginTop,i=parseFloat(r)+parseFloat(l);return t?i:a+i}function Ft(e){var t=e.classes;return r.a.createElement("div",{id:"letter-head",className:t.letterHeadContainer},r.a.createElement("img",{src:Ht.a,alt:"PHIVOLCS Letter Head",className:t.phivolcsLetterHead}))}function Ut(e){var t=e.classes;return r.a.createElement("div",{id:"letter-foot",className:"".concat(t.letterHeadContainer," ").concat(t.letterFooterContainer)},r.a.createElement("img",{src:Pt.a,alt:"PHIVOLCS Letter Footer",className:t.phivolcsLetterHead}))}function qt(e){var t=e.classes,a=e.bulletinDetail,l=e.isMD,i=a.bulletin_control_code,c=a.site_address,o=a.data_ts,s=a.alert_description_group,m=a.recommended_response;return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"body2",align:"center",className:t.title},r.a.createElement("strong",null,"DYNASLOPE LANDSLIDE ALERT LEVEL INFORMATION: ",i)),r.a.createElement(O.a,{variant:"body2",component:"div",className:t.mainInfo},r.a.createElement(y.a,{container:!0,spacing:l?2:1},r.a.createElement(y.a,{item:!0,xs:4},"Location:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,c)),r.a.createElement(y.a,{item:!0,xs:4},"Date/Time:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,o)),r.a.createElement(y.a,{item:!0,xs:4},"Alert Level Released:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,s)),r.a.createElement(y.a,{item:!0,xs:4},"Recommended Response:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,m)))))}var Wt=Object(Ge.a)()((function(e){var t=e.releaseId,a=e.width,l=function(e){return Object(j.a)((function(t){var a,n,r,l,i,c,o,m,u,d,p,b,g,f,E,v,h;"undefined"===typeof e?a={letterHeadContainer:(n={width:"inherit",height:"auto",boxSizing:"border-box",padding:"28px 44px"},Object(s.a)(n,t.breakpoints.only("md"),{padding:"58.3324px 91.6652px"}),Object(s.a)(n,t.breakpoints.up("lg"),{padding:"116.6648px 183.3304px"}),n),letterFooterContainer:(r={paddingTop:0,marginTop:16},Object(s.a)(r,t.breakpoints.only("md"),{marginTop:"33.3328px"}),Object(s.a)(r,t.breakpoints.up("lg"),{marginTop:"66.6656px"}),r),phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:(l={padding:"0 44px",height:604,maxHeight:604,overflowY:"hidden"},Object(s.a)(l,t.breakpoints.only("md"),{padding:"0 91.6652px",height:1258.3132,maxHeight:1258.3132}),Object(s.a)(l,t.breakpoints.up("lg"),{padding:"0 183.3304px",height:2620.7914,maxHeight:2620.7914}),l),title:(i={marginBottom:16,fontSize:"0.8rem"},Object(s.a)(i,t.breakpoints.only("md"),{marginBottom:33.3328,fontSize:"1.6664rem"}),Object(s.a)(i,t.breakpoints.up("lg"),{marginBottom:66.6656,fontSize:"3.47111rem"}),i),mainInfo:(c={border:"0.5px solid black",padding:"8px 12px",fontSize:"0.65rem",letterSpacing:0,marginBottom:12},Object(s.a)(c,t.breakpoints.only("md"),{padding:"16.6664px 24.9996px",fontSize:"1.354145rem",marginBottom:24.9996}),Object(s.a)(c,t.breakpoints.up("lg"),{padding:"33.3328px 49.9992px",fontSize:"2.70829rem",marginBottom:49.9992}),c),sectionHeader:(o={fontSize:"0.7rem"},Object(s.a)(o,t.breakpoints.only("md"),{fontSize:"1.45831rem"}),Object(s.a)(o,t.breakpoints.up("lg"),{fontSize:"2.91662rem"}),o),sectionDetails:(m={fontSize:"0.65rem"},Object(s.a)(m,t.breakpoints.only("md"),{fontSize:"1.354145rem"}),Object(s.a)(m,t.breakpoints.up("lg"),{fontSize:"2.70829rem"}),m),indent:(u={marginLeft:24},Object(s.a)(u,t.breakpoints.only("md"),{marginLeft:49.9992}),Object(s.a)(u,t.breakpoints.up("lg"),{marginLeft:99.9984}),u),divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}:a={letterHeadContainer:(d={width:"inherit",height:"auto",boxSizing:"border-box",padding:"7px 11px"},Object(s.a)(d,t.breakpoints.only("md"),{padding:"20px 22.9163px"}),Object(s.a)(d,t.breakpoints.up("lg"),{padding:"29.1662px 45.8326px"}),d),letterFooterContainer:(p={paddingTop:0,marginTop:16},Object(s.a)(p,t.breakpoints.only("md"),{marginTop:"8.3332px"}),Object(s.a)(p,t.breakpoints.up("lg"),{marginTop:"16.6664px"}),p),phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:(b={overflowY:"hidden",padding:"0 11px",height:"100%",maxHeight:"100%"},Object(s.a)(b,t.breakpoints.only("md"),{padding:"0 22.9163px",height:"100%",maxHeight:"100%"}),Object(s.a)(b,t.breakpoints.up("lg"),{padding:"0 45.8326px",height:"100%",maxHeight:"100%"}),b),title:(g={marginBottom:4,fontSize:"0.65625rem"},Object(s.a)(g,t.breakpoints.only("md"),{marginBottom:16,fontSize:"1.45rem"}),Object(s.a)(g,t.breakpoints.up("lg"),{marginBottom:33.3328,fontSize:"1.367163rem"}),g),mainInfo:(f={border:"0.5px solid black",letterSpacing:0,padding:"2px 3px",fontSize:"0.4875rem",marginBottom:3},Object(s.a)(f,t.breakpoints.only("md"),{padding:"10px 16px",fontSize:"1rem",marginBottom:12}),Object(s.a)(f,t.breakpoints.up("lg"),{padding:"8.3332px 12.4998px",fontSize:"1.01560875rem",marginBottom:12.4998}),f),sectionHeader:(E={fontSize:"0.525rem"},Object(s.a)(E,t.breakpoints.only("md"),{fontSize:"1.2rem"}),Object(s.a)(E,t.breakpoints.up("lg"),{fontSize:"1.0937325rem"}),E),sectionDetails:(v={fontSize:"0.4875rem"},Object(s.a)(v,t.breakpoints.only("md"),{fontSize:"1rem"}),Object(s.a)(v,t.breakpoints.up("lg"),{fontSize:"1.01560875rem"}),v),indent:(h={marginLeft:6},Object(s.a)(h,t.breakpoints.only("md"),{marginLeft:12.4998}),Object(s.a)(h,t.breakpoints.up("lg"),{marginLeft:24.9996}),h),divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}};return a}))}(t)(),i=Object(n.useState)([]),c=Object(o.a)(i,2),m=c[0],u=c[1],d=Object(n.useState)(!1),b=Object(o.a)(d,2),g=b[0],f=b[1],E=Object(n.useState)(!1),v=Object(o.a)(E,2),h=v[0],_=v[1],k=Object(n.useRef)(null),S=Object(n.useState)({site:{},alert_level:0,bulletin_control_code:"",site_address:"",alert_description_group:"",recommended_response:"",community_response:"",lewc_lgu_response:"",households_at_risk:"",has_ground_trigger:!1,ground_movement_details:"",prepared_triggers:[],no_data_triggers:[],barangay_address:"",publishers:"",next_ewi_release_ts:""}),C=Object(o.a)(S,2),D=C[0],A=C[1],w=D.alert_level,I=D.community_response,M=D.households_at_risk,T=D.lewc_lgu_response,N=D.prepared_triggers,Y=D.has_ground_trigger,R=D.no_data_triggers,H=D.barangay_address,B=D.publishers,P=D.next_ewi_release_ts,L=D.ground_movement_details,F=Object(Ge.c)("md",a);Object(n.useEffect)((function(){var a=t;"undefined"===typeof t&&(a=e.match.params.release_id);!function(e,t){const a="".concat(te.b,"/api/monitoring/create_bulletin/").concat(e);ne.a.get(a).then(e=>{const a=e.data;console.log("Bulletin details",a),t(a)}).catch(e=>{console.log(e)})}(a,(function(e){var t=e.site,a=re(t,!1),n=re(t,!1,"end","barangay"),r=Object(p.a)(Object(p.a)({},e),{},{site_address:a,barangay_address:n});f(!0),A(r)}))}),[]),Object(n.useEffect)((function(){if(null!==k.current){var e=k.current,t=Array.from(e.children),a=0;t.forEach((function(e,t){if("subcontent"!==e.id)a+=Lt(e);else{a+=Lt(e,!0);var n=Array.from(e.children),r=[];n.forEach((function(e){var t=Lt(e);a+t<1310.3957?a+=t:(a+=t,r.push(e.children[0]),e.setAttribute("style","display: none"))})),u(r)}})),""!==D.site_address&&_(!0)}}),[D,k]);var U=!1;return r.a.createElement(n.Fragment,null,g?r.a.createElement(n.Fragment,null,r.a.createElement("div",{id:"bulletin-root",className:l.root},r.a.createElement(Ft,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:k},r.a.createElement(qt,{classes:l,bulletinDetail:D,isMD:F}),r.a.createElement(y.a,{container:!0,spacing:F?2:1,id:"subcontent"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"AREA SITUATION"),":"))),N.map((function(e,t,a){var i=e.is_ground,c=e.trigger_source,o="";!U&&i&&(o=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),U=!0);var s=!1;(0===t||a[t-1].trigger_source!==c)&&(s=!0);var m="";if(s){var u=c.toUpperCase();m=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(l.sectionHeader," ").concat(i?l.indent:"")},r.a.createElement("strong",null,i?r.a.createElement("u",null,r.a.createElement("i",null,u)):u)))}var d="";return R.includes(c)&&(d=r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:"0 !important"}},r.a.createElement(O.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},"Currently, no data available."))),r.a.createElement(n.Fragment,{key:"key-".concat(t+1)},o,m,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent),dangerouslySetInnerHTML:{__html:e.description}})),d)})),(!Y||0===w)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},L))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,"ELEMENTS AT RISK"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.indent)},M)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"OTHER RECOMMENDATIONS"),":"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Landslide Early Warning Committee (LEWC):")," ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:T}}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"For the Community:")," ",I)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:l.sectionDetails},r.a.createElement("strong",null,"NOTE:")," This bulletin contains the official Alert Level and Recommended Response of the Dynaslope Project for ",H," and will hold true until a new bulletin is released.")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{className:l.divider})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{component:"div",variant:"body2",className:"".concat(l.sectionDetails," ").concat(l.releaseDetailsArea)},0===w?r.a.createElement("span",null):r.a.createElement("span",null,"Next bulletin on: ",r.a.createElement("strong",null,P)),r.a.createElement("span",null,"Released by: ",r.a.createElement("strong",null,B)))))),r.a.createElement(Ut,{classes:l})),m.length>0&&r.a.createElement("div",{id:"bulletin-root-2",className:l.root},r.a.createElement(Ft,{classes:l}),r.a.createElement("div",{id:"bulletin-content",className:l.body,ref:k},r.a.createElement(qt,{classes:l,bulletinDetail:D,isMD:F}),r.a.createElement(y.a,{container:!0,spacing:F?2:1,id:"excess-content"},m.map((function(e,t){var a=[];e.classList.forEach((function(e){if(e.includes("makeStyles")){var t=e.split("-")[1];a.push(l[t])}else a.push(e)}));var n=e.outerHTML.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,'"'.concat(a.join(" "),'"'));return r.a.createElement(y.a,{key:"key-".concat(t+1),item:!0,xs:12,dangerouslySetInnerHTML:{__html:n}})})))),r.a.createElement(Ut,{classes:l})),h&&r.a.createElement("div",{id:"is-loaded"})):r.a.createElement(y.a,{item:!0,style:{textAlign:"center"}},r.a.createElement(x.a,{size:50}),r.a.createElement(O.a,null,"Loading Bulletin")))}));function zt(e,t,a){me("".concat(te.b,"/api/mailbox/send_bulletin_email"),e,t,a)}function Gt(e,t,a){me("".concat(te.b,"/api/mailbox/queue_bulletin_email"),e,t,a)}function Vt(e,t,a){me("".concat(te.b,"/api/mailbox/cancel_queued_bulletin"),e,t,a)}var Qt=Object(Ce.a)()((function(e){var t=e.classes,a=e.fullScreen,l=e.isOpenBulletinModal,i=e.setIsOpenBulletinModal,s=e.releaseDetail,m=s.release_id,u=s.site_code,d=s.site_id,p=s.type,g=s.is_bulletin_sent,E=s.not_yet_sending_time,v=s.is_onset_release,h=s.is_bulletin_queued,_=s.prescribed_release_time,O=s.event_id,j=!v&&E,x=Object(n.useState)(""),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(""),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)(""),B=Object(o.a)(H,2),P=B[0],L=B[1],F=Object(n.useState)({}),U=Object(o.a)(F,2),q=U[0],W=U[1],z=Object(c.b)(),G=z.enqueueSnackbar,V=z.closeSnackbar,Z=Object(k.a)().user_id,K=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){V(e)}},"Dismiss")};Object(n.useEffect)((function(){"undefined"!==typeof m&&l&&function(e,t){ue("".concat(te.b,"/api/bulletin_email/get_bulletin_email_details/").concat(e),t)}(m,(function(e){var t=e.subject,a=e.recipients,n=e.mail_body,r=e.file_name,l=e.narrative_details;W(l),M(a),D(t),R(n),L(r)}))}),[l]);var J,X=function(){i(!1),W({}),M([]),D(""),R(""),L("")},$=function(e){var t={subject:C,recipients:I,mail_body:Y,release_id:m,file_name:P,alert_db_group:p,site_id:d,site_code:u,sender_id:Z,event_id:O,narrative_details:q,prescribed_release_time:_};h&&(t.task_id=h.remarks);var a=e.loading_message,n=e.error_message,r=e.ajaxFn,l=G(a,{variant:"warning",persist:!0});X(),r(t,(function(e){var t=e.status,a=e.message;V(l),G(a,{variant:!0===t?"success":"queued"===t?"info":"error",autoHideDuration:7e3,action:K})}),(function(){V(l),G(n,{variant:"error",autoHideDuration:7e3,action:K})}))},ee="";return"undefined"!==typeof u&&(ee=u.toUpperCase()),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title",maxWidth:"md"},r.a.createElement(je.a,{id:"form-dialog-title"},"Early Warning Bulletin for ",ee),r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Mail Content",value:Y,onChange:function(e){R(e.target.value)},placeholder:"Add mail content",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Yt.a,{label:"To",value:I,onAdd:function(e){return function(e){var t=I;t.push(e),M(Object(ye.a)(t))}(e)},onDelete:function(e,t){return function(e,t){I.splice(I.indexOf(e),1),M(Object(ye.a)(I))}(e)},fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(Wt,{releaseId:m})))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:(J=m,function(){!function(e,t){const a="".concat(te.b,"/api/bulletin/download_bulletin/").concat(e);ne.a.get(a,{responseType:"blob"}).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}(J,(function(e){var t=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=t,a.setAttribute("download",P),document.body.appendChild(a),a.click()}))}),color:"primary"},"Download"),j&&!h&&r.a.createElement(b.a,{onClick:function(){$({loading_message:"Queueing EWI bulletin...",error_message:"Error queueing EWI bulletin...",ajaxFn:Gt})},color:"primary",disabled:0===I.length},"Queue"),j&&h&&r.a.createElement(b.a,{color:"primary",onClick:function(){$({loading_message:"Canceling queued EWI bulletin...",error_message:"Error canceling queued EWI bulletin...",ajaxFn:Vt})}},"Cancel Queue"),!E&&r.a.createElement(b.a,{onClick:function(){$({loading_message:"Sending EWI bulletin...",error_message:"Send bulletin failed... Report to the incident to the developers.",ajaxFn:zt})},color:"primary",disabled:0===I.length},g?"Send Again":"Send"),r.a.createElement(b.a,{onClick:X,color:"primary"},"Cancel")))}));var Zt=a(1150),Kt=a(1149),Jt=a(601),Xt=a(1098),$t=a(1146),ea=a(53),ta=a(1145),aa=a(25);function na(e,t,a){var n="".concat(te.b,"/api/chatterbox/send_routine_ewi_sms");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}function ra(e,t,a){var n="".concat(te.b,"/api/chatterbox/queue_routine_ewi_sms");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}function la(e,t,a){var n="".concat(te.b,"/api/chatterbox/cancel_queued_routine_ewi_sms");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}function ia(e,t,a){var n="".concat(te.b,"/api/chatterbox/send_message");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}function ca(e,t,a){var n="".concat(te.b,"/api/chatterbox/queue_message");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}function oa(e,t,a){var n="".concat(te.b,"/api/chatterbox/cancel_queued_message");ne.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}var sa=a(648);const ma=Object(n.forwardRef)((e,t)=>r.a.createElement(L.a,Object.assign({direction:"up"},e,{ref:t}))),ua=Object(n.forwardRef)((e,t)=>r.a.createElement(sa.a,Object.assign({},e,{ref:t})));var da=a(93),pa=a(643),ba=a(603),ga=a(617),fa=a.n(ga),Ea=a(428);function va(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(O.a,Object.assign({color:"textSecondary",className:t.classes.noOptionsMessage},a),n)}function ha(e){let t=e.inputRef,a=Object(da.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}function _a(e){const t=e.selectProps,a=e.innerRef,n=e.children,l=e.innerProps,i=e.isDisabled;return r.a.createElement(f.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:ha,inputProps:Object(p.a)({className:t.classes.input,inputRef:a,children:n},l)}},t.textFieldProps,{disabled:i}))}function ya(e){const t=e.innerRef,a=e.isFocused,n=e.isSelected,l=e.innerProps,i=e.children,c=e.data.color;return r.a.createElement(P.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400,color:c}},l),i)}function Oa(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(O.a,Object.assign({color:"textSecondary",className:t.classes.placeholder},a),n)}function ja(e){const t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)}function xa(e){const t=e.children,a=e.selectProps,n=e.isFocused,l=e.data,i=e.removeProps,c=l.chipLabel,o="undefined"!==typeof c?c:t;return r.a.createElement(ba.a,{tabIndex:-1,label:o,className:"".concat(a.classes.chip," ").concat({[a.classes.chipFocused]:n}),onDelete:i.onClick,deleteIcon:r.a.createElement(fa.a,i)})}function ka(e){const t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(h.a,Object.assign({square:!0,className:t.classes.paper},a),n)}var Sa=Object(d.a)(e=>({root:{flexGrow:1},input:{display:"flex",padding:0,height:"auto"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object(Ea.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:2,marginTop:e.spacing(1),left:0,right:0},divider:{height:e.spacing(2)}}),{withTheme:!0})((function(e){const t=e.classes,a=e.changeHandler,n=e.isRequired,l=e.options,i=e.value,c=e.label,o=e.placeholder,s=e.renderDropdownIndicator,m=e.openMenuOnClick,u=e.isMulti,d=e.isDisabled,b=e.isClearable,g=e.hasAlternativeChipLabel,f=e.isError,v=e.helperText,h={input:e=>Object(p.a)(Object(p.a)({},e),{},{color:"blue","& input":{font:"inherit"}}),menuPortal:e=>Object(p.a)(Object(p.a)({},e),{},{zIndex:9999})},_={Control:_a,Menu:ka,MultiValue:xa,NoOptionsMessage:va,Option:ya,Placeholder:Oa,ValueContainer:ja},y=void 0===m||m,O=void 0!==u&&u,j=void 0!==d&&d,x=void 0!==b&&b,k=void 0!==n&&n;return!1===(void 0===s||s)&&(_.DropdownIndicator=()=>null,_.IndicatorSeparator=()=>null),r.a.createElement("div",{className:t.root},r.a.createElement(dt.a,null,r.a.createElement(pa.a,{required:k,classes:t,styles:h,textFieldProps:{label:c,InputLabelProps:{shrink:!0}},menuPortalTarget:document.body,options:l,components:_,value:i,onChange:a,placeholder:o,isMulti:O,openMenuOnFocus:!1,openMenuOnClick:y,isDisabled:j,isClearable:x,hasAlternativeChipLabel:g}),Boolean(f)&&r.a.createElement(Dt.a,{error:!0},r.a.createElement(E.a,{id:"component-error-text"},v))))}));const Ca=Object(n.createContext)(),Da=({children:e})=>{const t=Object(n.useState)([]),a=Object(o.a)(t,2),l=a[0],i=a[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(!0),b=Object(o.a)(p,2),g=b[0],f=b[1];Object(n.useEffect)(()=>{var e;g&&(e=e=>{const t=e.filter(e=>e.active);i(t),d(e),f(!1)},ue("".concat(te.b,"/api/sites/get_sites_data?include_inactive=true"),e))},[g]);const E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useState)(!0),O=Object(o.a)(y,2),j=O[0],x=O[1];Object(n.useEffect)(()=>{var e;j&&(e=e=>{_(e),x(!1)},ue("".concat(te.b,"/api/users/get_dynaslope_users/true/true"),e))},[j]);const k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],D=S[1];Object(n.useEffect)(()=>{var e;e=e=>{D(e)},ue("".concat(te.b,"/api/users/get_organizations"),e)},[]);const A=Object(n.useState)(null),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(c.b)(),N=T.enqueueSnackbar,Y=T.closeSnackbar,R=Object(n.useState)(null),H=Object(o.a)(R,2),B=H[0],P=H[1];Object(n.useEffect)(()=>{if(null!==I)if(!0===I){const e=N("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});P(e)}else Y(B),N("Reconnection successful...",{variant:"success",autoHideDuration:5e3})},[I]);const L={users:h,sites:l,all_sites_including_inactive:u,organizations:C,is_reconnecting:I,setIsReconnecting:M,setRefreshUser:x,setRefreshSites:f};return r.a.createElement(Ca.Provider,{value:L},e)};function Aa(e,t,a){return e.map((function(e){var n=e.site_code,r=e.site_id,l=n.toUpperCase();t&&(l=re(e,!0,"start"));var i="black",c=null;if("undefined"!==typeof a&&null!==a){var o=a.latest,s=a.extended,m=a.overdue,u=[].concat(Object(ye.a)(o),Object(ye.a)(m)),d=n.toLowerCase(),p=u.findIndex((function(e){return e.event.site.site_code===d})),b=s.findIndex((function(e){return e.event.site.site_code===d}));p>-1&&(i="red",c=u[p].event.event_id),b>-1&&(i="green",c=s[b].event.event_id)}return{value:r,label:l,data:e,color:i,event_id:c}}))}var wa=function(e){var t=e.value,a=e.changeHandler,l=e.isMulti,i=e.renderDropdownIndicator,c=e.includeAddressOnOptions,o=e.returnSiteDataCallback,s=e.isFromSiteLogs,m=e.disabled,u=e.customPlaceholder,d=e.isClearable,p=e.required,b=e.isError,g=e.helperText,f=e.enableSelectAll,E=Object(n.useContext)(Ca).sites,v=Aa(E,"undefined"===typeof c||c,s);f&&v.push({value:1e3,label:"All Sites"});var h="undefined"!==typeof l&&l,_=h?"Select site(s)":"Select site";_=u||_;var y="undefined"!==typeof i&&i,O="undefined"!==typeof d&&d,j=t;if(""!==t&&null!==t)if(h){j=Boolean(f)&&t.find((function(e){return 1e3===e.value}))?v.filter((function(e){return 1e3!==e.value})):t.map((function(e){var t=e.label,a=e.value,n=e;return"undefined"===typeof t&&(n=v[a-1]),n}))}else{var x=t.label,k=t.value;if("undefined"===typeof x&&(j=v.find((function(e){return e.value===k}))),"undefined"!==typeof o&&o){var S=E.find((function(e){return e.site_id===k}));"undefined"!==typeof S&&o(S)}}Object(n.useEffect)((function(){if(h&&Boolean(f)&&t&&t.find((function(e){return 1e3===e.value}))){var e=v.filter((function(e){return 1e3!==e.value}));a(e)}}),[t,h,f,v,a]);var C=h?"Site(s)":"Site";return p&&(C+=" *"),r.a.createElement(Sa,{isRequired:Boolean(p),label:C,options:v,value:j,changeHandler:a,placeholder:_,renderDropdownIndicator:y,openMenuOnClick:!0,isMulti:h,isDisabled:Boolean(m),isClearable:O,isError:Boolean(b),helperText:g})},Ia=Object(j.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:3,marginBottom:3},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}}));var Ma=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.inputFieldLength,i=e.clickHandler,s=e.setComposedMessage,m=e.maxCharacters,u=Ia(),d=Object(n.useState)($()().format("YYYY-MM-DD HH:mm:ss")),p=Object(o.a)(d,2),g=p[0],f=p[1],E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],_=v[1],O=Object(n.useState)("percentage"),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(c.b)(),C=S.enqueueSnackbar,D=S.closeSnackbar,A=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){D(e)}},"Dismiss")},w=function(){var e=function(e){var t=[];return e.forEach((function(e,a){var n=e.data,r=n.site_code,l=n.barangay,i=n.municipality,c=n.province,o=n.sitio,s="";o&&(s+="".concat(o,", ")),s+="Brgy. ".concat(l,", ").concat(i,", ").concat(c),t.push({site_code:r,site_info:s})})),t}(h),t=x,a=$()(g).format("LLL");!function(e,t){var a="".concat(te.b,"/api/rainfall/get_all_site_rainfall_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Get rain information data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({is_express:t,site_details:e,date_time:g,as_of:a},(function(e){var t=e.status,a=e.message,n=e.ewi;s(n.slice(0,l));var r=a,c="error";!0===t&&(i(),c="success",n.length>l&&(c="warning",r="Rainfall information message is trimmed down because of length restrictions (max characters: ".concat(m,")"))),C(r,{variant:c,autoHideDuration:3e3,action:A})}))},I=Object(n.useState)(!0),M=Object(o.a)(I,2),T=M[0],N=M[1];return Object(n.useEffect)((function(){N(null===g||null===h)}),[g,h]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Load rainfall information"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill-up the form with needed data."),r.a.createElement(y.a,{container:!0,spacing:1,direction:"row",alignItems:"flex-start",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,className:u.inputGridContainer},r.a.createElement(wa,{value:h,changeHandler:function(e){_(e)},isMulti:!0})),r.a.createElement(y.a,{item:!0,xs:6,className:u.inputGridContainer},r.a.createElement(Dt.a,{component:"fieldset"},r.a.createElement(At.a,{"aria-label":"express_rainfall_data_group",name:"express_rainfall_data",value:x,onChange:function(e){k(e.target.value)}},r.a.createElement(wt.a,{value:"percentage",control:r.a.createElement(It.a,{color:"primary"}),label:"Express data in percentage"}),r.a.createElement(wt.a,{value:"mm",control:r.a.createElement(It.a,{color:"primary"}),label:"Express data in mm"}),r.a.createElement(wt.a,{value:"both",control:r.a.createElement(It.a,{color:"primary"}),label:"Express data in % and mm"})))),r.a.createElement(y.a,{item:!0,xs:6,className:u.inputGridContainer},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Data timestamp",value:g,onChange:function(e){return f($()(e).format("YYYY-MM-DD HH:mm:ss"))},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:function(){return w()},disabled:T},"Select"),r.a.createElement(b.a,{onClick:i},"Cancel")))})),Ta=a(422),Na=a(436);var Ya=Object(d.a)(e=>({formControl:{minWidth:120}}))((function(e){const t=e.classes,a=e.list,l=e.mapping,i=e.label,c=e.div_id,o=e.changeHandler,s=e.value,m=e.css,u=e.error,d=e.required,p=e.disabled,b=e.helperText,g="undefined"!==typeof d&&d,f="undefined"!==typeof u&&u;return r.a.createElement(n.Fragment,null,r.a.createElement(Dt.a,{required:g,error:f,className:"".concat(t.formControl," ").concat(m),fullWidth:!0},r.a.createElement(Ta.a,{htmlFor:c},i),r.a.createElement(Na.a,{value:s,onChange:o,name:c,inputProps:{id:c},disabled:p},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"---")),a.map((e,t)=>r.a.createElement(P.a,{value:e[l.id],key:t},e[l.label]))),Boolean(b)&&r.a.createElement(E.a,null,b)))})),Ra=a(12),Ha=Object(j.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}}));var Ba=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.setComposedMessage,s=Ha(),m=Object(n.useState)($()()),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(null),_=Object(o.a)(h,2),O=_[0],j=_[1],x=Object(n.useState)(null),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)([]),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(c.b)(),T=M.enqueueSnackbar,N=M.closeSnackbar;Object(n.useEffect)((function(){var e;e=function(e){return I(e)},ue("".concat(te.b,"/api/chatterbox/get_alert_fyi_triggers"),e)}),[]);var Y=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){N(e)}},"Dismiss")},R=Object(n.useState)(!0),H=Object(o.a)(R,2),B=H[0],P=H[1];return Object(n.useEffect)((function(){P(null===d||null===E||null===O||null===S)}),[d,E,O,S]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Generate alert FYI message"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill-up the form with needed data."),r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,className:s.inputGridContainer},r.a.createElement(wa,{value:E,changeHandler:function(e){return v(e)},isMulti:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:s.inputGridContainer},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp",value:d,onChange:function(e){return p(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:s.inputGridContainer},r.a.createElement(Xt.a,{component:"legend",style:{textAlign:"center"}},"Alert action"),r.a.createElement(At.a,{row:!0,"aria-label":"position",name:"position",style:{justifyContent:"space-evenly"},value:O,onChange:function(e){return j(e.target.value)}},r.a.createElement(wt.a,{value:"raised",control:r.a.createElement(It.a,{color:"primary"}),label:"Raising",labelPlacement:"end"}),r.a.createElement(wt.a,{value:"lowered",control:r.a.createElement(It.a,{color:"primary"}),label:"Lowering",labelPlacement:"end"}))),r.a.createElement(y.a,{item:!0,xs:12,className:s.inputGridContainer},r.a.createElement(Xt.a,{component:"legend"},"lowered"===O?"Highest alert trigger":"Alert trigger"),r.a.createElement(At.a,{row:!0,"aria-label":"position",name:"position",value:S,onChange:function(e){return C(e.target.value)}},w.map((function(e){var t=e.internal_sym_id,a=e.internal_sym.trigger_symbol,n=a.alert_symbol,l=a.trigger_hierarchy.trigger_source;return r.a.createElement(wt.a,{key:n,value:t.toString(),control:r.a.createElement(It.a,{color:"primary"}),label:"".concat(Object(Ra.a)(l)," (").concat(n,")"),labelPlacement:"end"})})))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:function(){!function(e,t,a){var n="".concat(te.b,"/api/chatterbox/generate_alert_fyi_message");ne.a.get(n,{params:e}).then((function(e){var a=e.data;null!==t&&t(a)})).catch((function(e){console.log(e),a(e)}))}({ts:d.format("YYYY-MM-DD HH:mm:00"),sites:E.map((function(e){return e.value})),action:O,internal_sym_id:parseInt(S,10)},(function(e){i(e),l(),T("Alert FYI message successfully generated!",{variant:"success",autoHideDuration:3e3,action:Y})}),(function(e){T(e.response.data,{variant:"error",action:Y})}))},disabled:B},"Generate"),r.a.createElement(b.a,{onClick:l},"Cancel")))})),Pa=Object(j.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}}));var La=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.setComposedMessage,c=Pa(),s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(0),g=Object(o.a)(p,2),f=g[0],E=g[1],v=Object(n.useState)(!0),h=Object(o.a)(v,2),_=h[0],O=h[1];return Object(n.useEffect)((function(){O(null===f)}),[f]),Object(n.useEffect)((function(){!function(e,t,a){var n="".concat(te.b,"/api/chatterbox/get_eq_intensity_for_last_24hours");ne.a.get(n,{params:e}).then((function(e){var a=e.data;null!==t&&t(a)})).catch((function(e){console.log(e),a(e)}))}({start_ts:$()().format("YYYY-MM-DD 00:00:00"),end_ts:$()().format("YYYY-MM-DD 23:59:59")},(function(e){d(e)}),(function(e){console.log(e)}))}),[]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Select earthquake intensity data to generate"),r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,className:c.inputGridContainer},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"eq-event-select-label"},"Select Earthquake Intensity"),r.a.createElement(Na.a,{labelId:"eq-event-select-standard-label",id:"eq-event-select-standard",value:f,onChange:function(e){return E(e.target.value)},label:"Earthquake Intensity"},r.a.createElement(P.a,{value:"0"},r.a.createElement("em",null,"None")),u.length>0&&u.map((function(e,t){var a=e.intensity,n=e.reporter,l=e.ts,i=e.mei_id,c=n.first_name,o=n.last_name,s=n.organizations[0].site,m=s.barangay,u=s.province,d=s.municipality,p=$()(l).format("LLL");return r.a.createElement(P.a,{value:"".concat(i),key:t},c," ",o," | ",p," | Brgy. ",m,", ",d,", ",u," | Intensity ",a)}))))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:function(){var e=parseInt(f);E(f);var t=u.filter((function(t){return t.mei_id===e}));if(t.length>0){var a=t[0],n=a.intensity,r=a.reporter,c=a.ts,o=r.first_name,s=r.last_name,m=r.organizations[0].site,d=m.barangay,p=m.province,b=m.municipality,g=$()(c).format("LLL"),v="-".concat(o," ").concat(s," \n-").concat(g," \n-Brgy. ").concat(d,", ").concat(b,", ").concat(p," \n-Intensity ").concat(n);i(v),l()}},disabled:_},"Generate"),r.a.createElement(b.a,{onClick:l},"Cancel")))}));var Fa=function(e){var t=e.limitRows,a=e.value,l=e.disableSend,i=e.messageChangeHandler,c=e.sendButtonClickHandler,s=e.setComposedMessage,m=e.fromEWIModal,u=e.setPriority,d=e.setTsSending,p=e.priority,g=e.tsSending,E=e.sites,v=e.setSites,h=void 0===t||t,_=Object(n.useState)(!1),j=Object(o.a)(_,2),x=j[0],S=j[1],C=Object(n.useState)(!1),D=Object(o.a)(C,2),A=D[0],w=D[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)(!1),H=Object(o.a)(Y,2),L=H[0],F=H[1],U=Object(n.useState)([]),q=Object(o.a)(U,2),W=q[0],z=q[1];Object(n.useEffect)((function(){var e;m||(e=function(e){var t=e.filter((function(e){return Boolean(e.list_as_option)})),a=e.find((function(e){return"Default"===e.name}));z(t),u(a.priority_id)},ue("".concat(te.b,"/api/chatterbox/get_all_sms_priority"),e))}),[m]),Object(n.useEffect)((function(){!T&&d&&d(null)}),[T]);var G=Object(n.useState)(null),V=Object(o.a)(G,2),Z=V[0],K=V[1],J=function(){return K(null)},X=Object(n.useState)(!1),$=Object(o.a)(X,2),ee=$[0],ae=$[1],ne=Object(k.a)().nickname,re=" - ".concat(ne," from PHIVOLCS-DYNASLOPE"),le=a.length+re.length,ie=T&&null===g?"Required field":null;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",style:{paddingTop:16}},r.a.createElement(y.a,{item:!0,xs:m?12:10,sm:m?12:11},r.a.createElement(f.a,{id:"message_textbox",label:"Message",multiline:!0,rows:"4",rowsMax:h?4:10,fullWidth:!0,margin:"dense",variant:"filled",inputProps:{maxLength:1e3},value:a,onChange:i}),r.a.createElement(O.a,{variant:"caption",align:"right",component:"div"},r.a.createElement("strong",null,"Character count (including signature): ",le,"/",1e3))),!m&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:1,container:!0,direction:"column"},r.a.createElement(R.a,{color:"primary","aria-label":"Send message",onClick:c,disabled:l||T&&null===g,title:"Send message"},r.a.createElement($t.a,null)),r.a.createElement(O.a,{style:{textAlign:"center",fontStyle:"italic",fontWeight:"bolder",color:"#3f51b5",cursor:"pointer"},onClick:function(e){return K(e.currentTarget)},variant:"caption",display:"block",gutterBottom:!0},"More options"),r.a.createElement(B.a,{id:"simple-menu",anchorEl:Z,keepMounted:!0,open:Boolean(Z),onClose:J},r.a.createElement(P.a,{onClick:function(){ae(!0),J()}},"Queue/Schedule message sending"),r.a.createElement(P.a,{onClick:function(){S(!0),J()}},"Generate rainfall information"),r.a.createElement(P.a,{onClick:function(){w(!0),J()}},"Generate alert raising/lowering FYI message"),r.a.createElement(P.a,{onClick:function(){F(!0),J()}},"Generate earthquake intensity message"))),ee&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"12px 0"}})),r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:8},r.a.createElement("strong",null,"Message options")),r.a.createElement(O.a,{variant:"body2",component:y.a,item:!0,xs:4,align:"right"},r.a.createElement(b.a,{color:"primary",onClick:function(){ae(!1)}},"Hide")),r.a.createElement(y.a,{item:!0,xs:4,sm:3,style:{textAlign:"center"}},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:T,onChange:function(e){return N(e.target.checked)},name:"checkedA"}),label:"Schedule"})),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:8,sm:6},r.a.createElement(ta.b,{autoOk:!0,label:"Timestamp of sending",value:g,onChange:function(e){return d(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,fullWidth:!0,disablePast:!0,disabled:!T,helperText:ie||"",error:Boolean(ie)}))),r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(Ya,{div_id:"sms-priority",label:"Priority",list:W,mapping:{id:"priority_id",label:"name"},value:p,changeHandler:function(e){return u(e.target.value)}})),T&&"rain_info"===W.find((function(e){return e.priority_id===p})).keyword&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"12px 0"}})),r.a.createElement(O.a,{variant:"body2",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Rainfall Information Tagging")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xt.a,{component:"legend"},"Attach narrative to")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wa,{value:E,changeHandler:function(e){return v(e)},isMulti:!0,required:!0})))))),r.a.createElement(Ma,{isOpen:x,setComposedMessage:s,clickHandler:function(){return S(!1)},maxCharacters:1e3,inputFieldLength:1e3-re.length}),r.a.createElement(Ba,{isOpen:A,setComposedMessage:s,clickHandler:function(){return w(!1)}}),r.a.createElement(La,{isOpen:L,setComposedMessage:s,clickHandler:function(){return F(!1)}}))},Ua=a(427),qa=a(1147),Wa=a(1148);var za=Object(d.a)(e=>({checkboxes:{paddingTop:4,paddingBottom:4}}))((function(e){const t=e.classes,a=e.changeHandler,l=e.choices,i=e.checkboxStyle;return r.a.createElement(n.Fragment,null,l.map(({state:e,value:n,label:l,is_disabled:c},o)=>r.a.createElement(wt.a,{key:o,control:r.a.createElement(Jt.a,{checked:e,onChange:a(n),value:n,disabled:"undefined"!==typeof c&&c,className:t.checkboxes}),label:l,className:i})))})),Ga=Object(j.a)((function(e){var t,a;return{formControl:{width:"-webkit-fill-available",marginTop:8,"&:first-child":{marginTop:12}},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxSites:(t={flex:"1 1 25%"},Object(s.a)(t,e.breakpoints.down("xs"),{"&:last-child":{flexBasis:"58.5%"}}),Object(s.a)(t,e.breakpoints.up("sm"),{flexBasis:"17%"}),Object(s.a)(t,e.breakpoints.up("md"),{flexBasis:"9%"}),t),checkboxOrganizations:(a={flex:"1 1 45%"},Object(s.a)(a,e.breakpoints.up("sm"),{flexBasis:"17%","&:last-child":{flexBasis:"77%"}}),Object(s.a)(a,e.breakpoints.up("md"),{flexBasis:"9%","&:last-child":{flexBasis:"45%"}}),a),checkboxGroup:{flexDirection:"row",paddingTop:6},buttons:Object(s.a)({},e.breakpoints.down("xs"),{padding:"12px 6px"})}}));var Va=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setRecipients,c=Ga(),s=Object(n.useContext)(Ca),m=s.sites,u=s.organizations,d=m.map((function(e){return{label:e.site_code.toUpperCase(),value:e.site_id,state:!1}})),g=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{label:t+e.name.toUpperCase(),value:e.org_id,state:!1}})),f=Object(n.useState)(!1),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)(!0),y=Object(o.a)(_,2),O=y[0],j=y[1],x=Object(n.useState)(d),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)(g),A=Object(o.a)(D,2),w=A[0],I=A[1],M={handleCheckAll:function(e,t){return function(){var a,n;"sites"===e?(a=S,n=C):"organizations"===e&&(a=w,n=I);var r=a.map((function(e){return Object(p.a)(Object(p.a)({},e),{},{state:t})}));n(Object(ye.a)(r))}},handleChange:function(e){return function(t){return function(a){var n,r,l=a.target.checked;"sites"===e?(n=S,r=C):"organizations"===e&&(n=w,r=I);var i=n.findIndex((function(e){return e.value===t}));n[i].state=l,r(Object(ye.a)(n))}}}};return r.a.createElement("div",null,r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua,maxWidth:"md"},r.a.createElement(je.a,{id:"form-dialog-title"},"Select recipients"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Choose your preferred sites and offices as message recipients."),r.a.createElement(Dt.a,{className:c.formControl},r.a.createElement(Ua.a,{"aria-label":"position",row:!0},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:v,onChange:function(e){return h(e.target.checked)},value:"only_ewi_recipients",className:c.checkboxes}),label:"Only EWI recipients"}),r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:O,onChange:function(e){return j(e.target.checked)},value:"only_active_users",className:c.checkboxes}),label:"Only active users",title:"Remove from the result all inactive stakeholders"}))),[{state_list:w,group:"Organizations",list:u},{state_list:S,group:"Sites",list:m}].map((function(e){return function(e,t,a){var n=t.state_list,l=t.group,i=t.list,c=a.handleCheckAll,o=a.handleChange,s=l.toLowerCase();return r.a.createElement(Dt.a,{component:"fieldset",className:e.formControl,key:l},r.a.createElement(Xt.a,{component:"legend",className:e.formLabel},r.a.createElement("span",null,l),r.a.createElement("span",null,[{label:"Check all",component:r.a.createElement(qa.a,null),bool:!0},{label:"Uncheck all",component:r.a.createElement(Wa.a,null),bool:!1}].map((function(t){return r.a.createElement(R.a,{"aria-label":t.label,color:"primary",className:e.buttons,onClick:c(s,t.bool),key:t.label},t.component)})))),r.a.createElement(Ua.a,{className:e.checkboxGroup},r.a.createElement(za,{choices:i.map((function(e){return function(e,t,a){var n;"Sites"===t?n="site_id":"Organizations"===t&&(n="org_id");return a.filter((function(t){return t.value===e[n]})).pop()}(e,l,n)})),changeHandler:o(s),checkboxStyle:e["checkbox".concat(l)]})))}(c,e,M)}))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:function(){var e=[],t=[];S.forEach((function(t){t.state&&e.push(t.value)})),w.forEach((function(e){e.state&&t.push(e.value)})),function(e,t){var a="".concat(te.b,"/api/contacts/get_recipients_option");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Selected recipients",a),t(a)})).catch((function(e){console.error(e)}))}({site_ids:e,org_ids:t,only_ewi_recipients:v,only_active_users:O},(function(e){var t=e.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,l=t;return""!==n&&(l="".concat(t," (").concat(n,")")),{label:l+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));i(t)})),l()},color:"primary"},"Select"),r.a.createElement(b.a,{onClick:l},"Cancel"))))}));function Qa(e,t){var a=e.prepare_payload,n=e.enqueueSnackbar,r=e.modalStateHandler,l=e.closeSnackbar,i=e.snackBarActionFn,c=e.task_id,o=t.loading_message,s=t.success_message,m=t.error_message,u=t.ajaxFunction,d=a();c&&(d.task_id=c);var p=n(o,{variant:"warning",persist:!0});r(),u(d,(function(e){l(p);var t,a=e.message,r=e.status,c=a;!0===r?(t="success",c=s):"queued"===r?(t="info",c=a):t="error",n(c,{variant:t,autoHideDuration:7e3,action:i})}),(function(){l(p),n(m,{variant:"error",autoHideDuration:7e3,action:i})}))}function Za(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a={loading_message:"Sending EWI SMS...",success_message:"EWI SMS sent!",error_message:"Error sending EWI SMS...",ajaxFunction:ia};t||(a={loading_message:"Sending message...",success_message:"Message sent!",error_message:"Error sending message...",ajaxFunction:ia}),Qa(e,a)}function Ka(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a={loading_message:"Queueing EWI SMS...",success_message:"EWI SMS sending successfully queued!",error_message:"Error queueing EWI SMS...",ajaxFunction:ca};t||(a={loading_message:"Queueing message...",success_message:"Message sending successfully queued!",error_message:"Error queueing message...",ajaxFunction:ca}),Qa(e,a)}var Ja=function(e){var t=e.textboxValue,a=e.disableQuickSelect,l=e.releaseId,i=e.modalStateHandler,s=e.recipientsList,m=e.fromEWIModal,u=e.eventId,d=e.siteCode,g=e.updateSentStatusObj,f=e.prescribedReleaseTime,E=e.ewiModalTriggers,v=Object(c.b)(),h=v.enqueueSnackbar,_=v.closeSnackbar;console.log("PROPS:",e);var O=Object(k.a)(),j=Object(n.useState)([]),S=Object(o.a)(j,2),C=S[0],D=S[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],H=N[1],B=Object(n.useState)(t),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(""),q=Object(o.a)(U,2),W=q[0],z=q[1],G=Object(n.useState)(null),V=Object(o.a)(G,2),Q=V[0],Z=V[1],K=Object(n.useState)([]),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)(null),ae=Object(o.a)(ee,2),re=ae[0],le=ae[1],ie="undefined"!==typeof a&&a,ce="undefined"!==typeof m&&m,oe=Object(n.useState)(!1),se=Object(o.a)(oe,2),me=se[0],ue=se[1];Object(n.useEffect)((function(){"undefined"!==typeof d&&(ue(!0),function(e,t){var a="".concat(te.b,"/api/contacts/get_contacts_per_site/").concat(e);ne.a.get(a).then((function(e){var a=e.data;console.log(e),console.log(a),t(a)})).catch((function(e){console.error(e)}))}(d,(function(e){var t=[],a=[],n=g.type,r=g.public_alert_symbol.alert_level,l=g.highest_event_alert_level;e.forEach((function(e){if(e.mobile_numbers.length>0){var i,c=e.user_id,o=e.last_name,s=e.first_name,m=e.organizations,u=e.ewi_recipient,d=e.ewi_restriction,p=m[0].organization,b=p.name,g=p.scope,f=b.toUpperCase();if("lgu"===b)1===g&&(i="B"),2===g&&(i="M"),3===g&&(i="P"),f=i+f;var E={label:"".concat(o,", ").concat(s," (").concat(f,")"),value:c,data:e};if(t.push(E),1===u){var v=!0;if(null!==d){var h=d.alert_level;(0!==r&&r<=h||0===r&&(l<=h||-1===h&&"latest"!==n))&&(v=!1)}v&&a.push(E)}}})),M(t),D(a),ue(!1)})))}),[d,g]),Object(n.useEffect)((function(){if("undefined"!==typeof s){ue(!0);var e=s.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,l=t;return""!==n&&(l="".concat(t," (").concat(n,")")),{label:l+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));M(e),D([]),ue(!1)}}),[s]);var de={prepare_payload:function(){var e=[],t="";if(ce)C.forEach((function(t){var a=t.data;a.mobile_numbers.forEach((function(t){return e.push({mobile_id:t.mobile_number.mobile_id,gsm_id:t.mobile_number.gsm_id,data:a})}))}));else{var a=[];C.forEach((function(t){var n=t.data,r=n.mobile_id,l=n.gsm_id,i=t.label;e.push({mobile_id:r,gsm_id:l}),a.push(i)})),t=a.join(", ")}var n={sms_msg:"".concat(L," - ").concat(O.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:e,is_ewi:ce,priority:parseInt(W,10)||null,ts_sending:Q?Q.format("YYYY-MM-DD HH:mm:ss"):null,user_id:O.user_id,tag_data:{site_list:X.map((function(e){return e.value})),contact_person:t}};if(ce){var r=g.site_id,i=g.type;n=Object(p.a)(Object(p.a)({},n),{},{release_id:l,event_id:u,site_id:r,alert_db_group:i,prescribed_release_time:f,site_code:d})}return n},enqueueSnackbar:h,modalStateHandler:i,closeSnackbar:_,snackBarActionFn:function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){_(e)}},"Dismiss")}};Object(n.useEffect)((function(){var e=Za;Q&&(e=Ka),le((function(){return e}))}),[Q]),Object(n.useEffect)((function(){m&&E.send.trigger&&(E.send.revert(),Za(de))}),[m,E,de]),Object(n.useEffect)((function(){m&&E.queue.trigger&&(E.queue.revert(),Ka(de))}),[m,E,de]),Object(n.useEffect)((function(){m&&E.cancel_queue.trigger&&(E.cancel_queue.revert(),de.task_id=E.cancel_queue.task_id,function(e){Qa(e,{loading_message:"Canceling queued EWI SMS...",success_message:"Queued EWI SMS succesfully canceled!",error_message:"Error canceling queued EWI SMS...",ajaxFunction:oa})}(de))}),[m,E,de]),Object(n.useEffect)((function(){m&&E.disable_send_queue_buttons(null===C||0===C.length)}),[m,C,E]);var pe=null===C||0===C.length,be=""===L||"undefined"===typeof L;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},me&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(x.a,{size:20})),r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(Sa,{label:"Recipients",options:I,value:C,changeHandler:function(e){return D(e)},placeholder:"Select recipients",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0})),!ie&&r.a.createElement(y.a,{item:!0,style:{textAlign:"right"}},r.a.createElement(R.a,{"aria-label":"Quick select option",onClick:function(e){return H(!0)}},r.a.createElement(Kt.a,null)))),r.a.createElement(Va,{isOpen:Y,closeHandler:function(e){return H(!1)},setRecipients:D}),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(Fa,{limitRows:!1,value:L,disableSend:pe||be,sendButtonClickHandler:function(){return re(de,!1)},messageChangeHandler:function(e){return F(e.target.value)},setComposedMessage:F,disableTemplateLoader:ce,fromEWIModal:ce,setPriority:z,setTsSending:Z,priority:W,tsSending:Q,sites:X,setSites:$})))};var Xa=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,l=e.modalState,i=e.textboxValue,c=e.releaseDetail,s=c.release_id,m=c.site_code,u=c.is_onset_release,d=c.not_yet_sending_time,p=c.is_queued,g=c.prescribed_release_time,f=c.event_id,E=c.is_sms_sent,v=!u&&d,h=Object(n.useState)(!1),_=Object(o.a)(h,2),y=_[0],O=_[1],j=Object(n.useState)(!1),k=Object(o.a)(j,2),S=k[0],C=k[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(!0),T=Object(o.a)(M,2),N=T[0],Y=T[1],H={send:{trigger:y,revert:()=>O(!1)},queue:{trigger:S,revert:()=>C(!1)},cancel_queue:{task_id:p?p.remarks:null,trigger:w,revert:()=>I(!1)},disable_send_queue_buttons:Y};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:l,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Early Warning Information"),r.a.createElement(R.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Zt.a,null)))),r.a.createElement(xe.a,{style:{overflowY:"auto"}},r.a.createElement(ke.a,null,"Early warning information recipients for this site is already pre-loaded. Add additional site-related contacts if necessary. Use Chatterbox for non-site-related contacts."),r.a.createElement("div",{style:{marginTop:20,textAlign:"center"}},null!==i?r.a.createElement(Ja,{isMobile:t,textboxValue:i,disableQuickSelect:!0,releaseId:s,eventId:f,siteCode:m,updateSentStatusObj:c,modalStateHandler:a,prescribedReleaseTime:g,fromEWIModal:!0,ewiModalTriggers:H}):r.a.createElement(x.a,null))),r.a.createElement(Se.a,null,v&&!p&&r.a.createElement(b.a,{onClick:()=>C(!0),color:"primary",disabled:null===i||N},"Queue"),v&&p&&r.a.createElement(b.a,{color:"primary",onClick:()=>I(!0)},"Cancel Queue"),!d&&r.a.createElement(b.a,{onClick:()=>O(!0),color:"primary",disabled:null===i||N},E?"Send Again":"Send"),r.a.createElement(b.a,{onClick:a,color:"primary"},"Cancel")))}));const $a=Object(j.a)(e=>Object(_e.d)(e));function en(e){const t=e.is_loading_recipients,a=e.textboxValue,l=e.sendHandler;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},t&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(x.a,{size:20}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(Fa,{limitRows:!1,value:a,disableSend:!1,sendButtonClickHandler:l,messageChangeHandler:()=>console.log("tried msg change"),disableTemplateLoader:!0,fromEWIModal:!0})))}var tn=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.textboxValue,i=e.routineData,o=$a(),s=i.released_sites,m=i.prescribed_release_time,u=i.not_yet_sending_time,d=i.is_sms_sent,p=i.is_sms_queued,g=Object(c.b)(),f=g.enqueueSnackbar,E=g.closeSnackbar,v=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{E(e)}},"Dismiss"),h=e=>{const t=e.loading_message,n=e.success_message,r=e.error_message,l=e.ajaxFunction,i=Object(k.a)(),c=i.user_id,o=i.nickname,u={alert_db_group:"routine",site_list:s,prescribed_release_time:m,user_id:c,nickname:o};p&&(u.task_id=p.remarks);const d=f(t,{variant:"warning",persist:!0});a(),l(u,e=>{E(d),console.log(e);let t=n,a={variant:"success",autoHideDuration:7e3,action:v};if(!e.status){const n=e.site_ids.map(e=>e.toUpperCase());t="Some problems occurred sending EWI SMS to ".concat(n.join(", ")),a={variant:"error",persist:!0,action:v}}f(t,a)},e=>{console.log("error_response",e),f(r,{variant:"error",autoHideDuration:7e3,action:v})})},_=()=>{h({loading_message:"Sending routine EWI SMS...",success_message:"Routine EWI SMS sent!",error_message:"Error sending routine EWI SMS...",ajaxFunction:na})};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Routine Early Warning Information"),r.a.createElement(R.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Zt.a,null)))),r.a.createElement(xe.a,{style:{overflowY:"hidden"}},r.a.createElement(ke.a,null,"Early warning information recipients for this site is already pre-loaded. Recipients are LEWC, Barangay, and Municipal LGUs per site. If you need to add a new recipient, add a new community contact via chatterbox."),r.a.createElement(ke.a,{className:o.dyna_error},"NOTE: Ensure first that alerts for ALL sites under routine monitoring has been released before sending routine EWI SMS. Sending routine EWI in multiple batches will result in message duplication on our stakeholders."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(en,{isMobile:t,textboxValue:l,disableQuickSelect:!0,sendHandler:_,fromEWIModal:!0,updateSentStatusObj:"",modalStateHandler:a}))),r.a.createElement(Se.a,null,u&&!p&&r.a.createElement(b.a,{onClick:()=>{h({loading_message:"Queueing routine EWI SMS...",success_message:"Routine EWI SMS sucessfully queued!",error_message:"Error queueing routine EWI SMS...",ajaxFunction:ra})},color:"primary"},"Queue"),u&&p&&r.a.createElement(b.a,{color:"primary",onClick:()=>{h({loading_message:"Canceling queued routine EWI SMS...",success_message:"Queued routine EWI SMS succesfully canceled!",error_message:"Error canceling queued routine EWI SMS...",ajaxFunction:la})}},"Cancel Queue"),!u&&r.a.createElement(b.a,{onClick:_,color:"primary"},d?"Send Again":"Send"),r.a.createElement(b.a,{onClick:a,color:"primary"},"Cancel")))})),an=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{root:{width:"100%"},sectionHead:Object(p.a)(Object(p.a)({},t.sectionHead),{},{marginBottom:24}),AccordionSummaryContent:{justifyContent:"space-between"},invalidCandidate:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)"},validCandidate:{background:"linear-gradient(315deg, #00b712 0%, #5aff15 74%)"},partialInvalidCandidate:{background:"linear-gradient(315deg, #bbf0f3 0%, #f6d285 74%)"},inputWidth:{width:"50%"}})}));function nn(e){return $()(e).format("DD MMMM YYYY, HH:mm")}var rn=function(){return r.a.createElement(ft.a,{height:60,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}))};function ln(e){var t=e.alertData,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.index,o=e.releaseFormOpenHandler,s=e.isShowingValidation,m=e.toggleValidation,u=e.validationDetails,d=Object(n.useContext)(Ca).sites,p="",g="",f="",E=[],v=!1,h=t.general_status,_=t.is_release_time,j=t.unresolved_moms_list,x=[],k=[],S=[],C=t.validity_status,D="valid";if("undefined"!==typeof C&&(D=C),"routine"===h){var A=t.data_ts,w=t.public_alert_symbol,I=t.overdue_routine_list,M=t.routine_details;p="ROUTINE RELEASE",g=nn(A),f=w,S=I,M.forEach((function(e){"ND"===e.internal_alert_level&&null!==d&&e.site_id_list.forEach((function(e){var t=d.filter((function(t){return t.site_id===e}));k.push(t[0])})),"A0"===e.internal_alert_level&&null!==d&&e.site_id_list.forEach((function(e){var t=d.filter((function(t){return t.site_id===e}));x.push(t[0])}))}))}else{var T=t.site_code,N=t.release_details,Y=t.internal_alert_level,R=t.trigger_list_arr,H=N.data_ts;p=T,g=nn(H),f=Y,v="No new triggers"!==(E="undefined"===typeof R?[]:R)&&E.length>0}p=p.toUpperCase();var B=h.toUpperCase(),P=a.alert0;return"invalid"===D?P=a.invalidAlert:"partially valid"===D&&(P=a.alert2),r.a.createElement($e.a,{key:"panel-".concat(c+1),expanded:l==="panel".concat(c),onChange:i("panel".concat(c))},r.a.createElement(et.a,{"aria-controls":"panel".concat(c,"bh-content"),id:"panel".concat(c,"bh-header"),classes:{content:a.AccordionSummaryContent,root:P}},[p,g,D.toUpperCase(),B].map((function(e,t){return r.a.createElement(O.a,{key:"candidate-column-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Q.a,{style:{marginBottom:12}}),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},g)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Internal Alert:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},f))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},"ROUTINE"===B?r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,justify:"space-between"},r.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},r.a.createElement("strong",null,"A0"))),x.length>0?x.map((function(e){return r.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_code,style:{padding:3}},r.a.createElement(O.a,{variant:"body1"},e.site_code.toUpperCase()))})):r.a.createElement(O.a,{variant:"subtitle2"},"None")),r.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},r.a.createElement("strong",null,"ND"))),k.length>0&&"undefined"!==typeof k?k.map((function(e){return r.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_id,style:{padding:3}},r.a.createElement(O.a,{variant:"body1"},e.site_code.toUpperCase()))})):r.a.createElement(O.a,{variant:"subtitle2"},"None")),r.a.createElement(y.a,{item:!0,container:!0,xs:12,md:12},S.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:a.routineSitesContainer},r.a.createElement(O.a,{variant:"h6"},r.a.createElement("strong",null,"Overdue"))),S.map((function(e){return r.a.createElement(y.a,{item:!0,md:1,xs:2,key:e.site_code,style:{justifyItems:"center",padding:3}},r.a.createElement(O.a,{variant:"body1"},e.site_code.toUpperCase()))}))))):r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(y.a,{item:!0,xs:12,md:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"TRIGGERS")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},v?E.map((function(e,t){var a=e.ts_updated,l=e.alert,i=(e.tech_info,e.trigger_id),c=e.trigger_type,o=nn(a),d="Valid",g=!1,f=!1;try{var v=e.validating_status;0===v?(d="Validating",f=!0,g=!0):null===v?(d="---",g=!0):1===v&&(g=!1)}catch(_){}try{e.invalid&&(d="Invalid")}catch(_){}var h=["surficial","rainfall","subsurface"].includes(c)&&g;return r.a.createElement(n.Fragment,{key:"trigger-".concat(c,"-").concat(l)},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Trigger"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},l)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:!0,align:h?"flex-start":"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Status:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},d)),h&&r.a.createElement(y.a,{item:!0,xs:!0,justify:"flex-end",container:!0},r.a.createElement(b.a,{onClick:m(!0,{site:p,trigger_id:i,ts_updated:a}),variant:"contained",color:"secondary",size:"small","aria-label":"Validate trigger"},"Validate")),r.a.createElement(Mt,{isShowing:s,data:u,hide:m(!1,{}),isValidating:f}),E.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)))})):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"No new triggers")))))),"undefined"!==typeof j&&j.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"UNRESOLVED MOMS LIST")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},j.map((function(e,t){var a=e.moms_instance,l=e.observance_ts,i=e.op_trigger,c=a.feature.feature_type,o=a.feature_name,s="".concat(le(c)," ").concat(o.toUpperCase()),m=nn(l);return r.a.createElement(n.Fragment,{key:e.moms_id},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Feature"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Last Report"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Alert Level"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},i)),j.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)))}))))))),r.a.createElement(Q.a,null),r.a.createElement(Et.a,null,r.a.createElement(b.a,{color:"secondary",size:"small","aria-label":"Release candidate alert",startIcon:r.a.createElement(ht.a,null),onClick:o(t,h),disabled:!_},"Release")))}function cn(e){var t=e.siteAlert,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.smsHandler,o=e.bulletinHandler,s=e.keyName,m=e.type,u=e.history,d=t.event,p=t.internal_alert_level,g=t.releases,f=t.day,E=t.sent_statuses,v=t.public_alert_symbol,h=t.is_onset_release,_=t.prescribed_release_time,j=t.has_alert_release_today,x=t.highest_event_alert_level,k=v.alert_level,S=Object(n.useContext)(Qe.a).server_time,C=d.validity,D=d.site,A=d.event_start,w=d.event_id,I=D.site_code,M=D.site_id,T=I.toUpperCase(),N=nn(A),Y=nn(C),R=g[0],H=R.release_id,B=R.data_ts,P=R.release_time,L=B;h||(L=$()(B).add(30,"minutes")),L=nn(L);var F=[T,p];if("extended"===m){var U="";j||(U=r.a.createElement(vt.a,{arrow:!0,title:"Don't forget to release today's site alert for extended monitoring!"},r.a.createElement(lt.a,{fontSize:"small",style:{marginLeft:8},className:a.dyna_error})));var q=r.a.createElement("span",{style:{display:"flex",alignItems:"center"}},"Day ",f,U);F.push(q)}else F.push(L,P);var W=E.sms,z=E.bulletin,G=null!==S&&$()(S).isBefore(_)&&!h,V=function(e){var t=null;return null!==e&&(t=e.action),"send"===t?r.a.createElement(_t.a,null):"error"===t?r.a.createElement(yt.a,null):G?"queue"===t?r.a.createElement(Ot.a,null):r.a.createElement(jt.a,null):""},Z=function(e,t){return null!==e&&e.action===t},K={sms:V(W),bulletin:V(z)},J=function(e,t){if("bulletin"===e.toLowerCase()&&"extended"===m)return"No need to send EWI bulletin on sites under extended monitoring";var a=null;return null!==t&&(a=t.action),"send"===a?"EWI ".concat(e," sent!"):"error"===a?"Error sending EWI ".concat(e,"! Retry..."):G?"queue"===a?"EWI ".concat(e," already queued for sending"):"Queue EWI ".concat(e," for sending"):"Send EWI ".concat(e)},X=!!Z(W,"queue")&&W,ee=Z(W,"send"),te=!!Z(z,"queue")&&z,ae=Z(z,"send");return r.a.createElement($e.a,{expanded:l===s,onChange:i(s)},r.a.createElement(et.a,{"aria-controls":"".concat(s,"bh-content"),id:"".concat(s,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a["alert".concat(k)]}},F.map((function(e,t){return r.a.createElement(O.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Q.a,{style:{marginBottom:12}}),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Start:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},N)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Validity:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},Y))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"LATEST RELEASE")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},[["Internal Alert",p],["Data Timestamp",nn(B)],["Release Time",P]].map((function(e,t){return r.a.createElement(y.a,{key:e[0],item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},e[0]),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},e[1]))}))))),r.a.createElement(Q.a,null),r.a.createElement(Et.a,null,r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement(xt.a,null),onClick:function(){return u.push("/monitoring/events/".concat(w))},align:"left"},"Timeline"),r.a.createElement(vt.a,{arrow:!0,title:J("SMS",W)},r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement(kt.a,null),onClick:c({release_id:H,site_code:I,site_id:M,type:m,public_alert_symbol:v,highest_event_alert_level:x,is_onset_release:h,not_yet_sending_time:G,is_queued:X,prescribed_release_time:_,event_id:w,is_sms_sent:ee}),endIcon:K.sms,className:Z(W,"error")?a.dyna_error:""},"EWI SMS")),r.a.createElement(vt.a,{arrow:!0,title:J("Bulletin",z)},r.a.createElement("span",null,r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement(St.a,null),onClick:o({release_id:H,site_code:I,site_id:M,type:m,is_bulletin_sent:ae,is_bulletin_queued:te,not_yet_sending_time:G,is_onset_release:h,prescribed_release_time:_,event_id:w}),endIcon:K.bulletin,className:Z(z,"error")?a.dyna_error:"",disabled:"extended"===m},"Bulletin")))))}function on(e){var t=e.siteAlert,a=e.classes,l=e.expanded,i=e.handleExpansion,c=e.smsHandler,o=e.keyName,s=Object(n.useContext)(Qe.a).server_time,m=t.released_sites,u=t.prescribed_release_time,d=t.sent_statuses,p=m[0].data_ts;p=nn(p);var g=d.sms,f=null!==s&&$()(s).isBefore(u),E=function(e,t){return null!==e&&e.action===t},v=function(e){var t=null;return null!==e&&(t=e.action),"send"===t?r.a.createElement(_t.a,null):"error"===t?r.a.createElement(yt.a,null):f?"queue"===t?r.a.createElement(Ot.a,null):r.a.createElement(jt.a,null):""}(g),h=!!E(g,"queue")&&g,_=E(g,"send");return r.a.createElement($e.a,{expanded:l===o,onChange:i(o)},r.a.createElement(et.a,{"aria-controls":"".concat(o,"bh-content"),id:"".concat(o,"bh-header"),classes:{content:a.AccordionSummaryContent,root:a.alert0}},["ROUTINE",p].map((function(e,t){return r.a.createElement(O.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Q.a,{style:{marginBottom:12}}),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},p))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"ROUTINE SITES")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},m.map((function(e,t){return r.a.createElement(y.a,{key:"site-".concat(e.site_code),item:!0,xs:2,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},e.site_code.toUpperCase()))}))))),r.a.createElement(Q.a,null),r.a.createElement(Et.a,null,r.a.createElement(vt.a,{arrow:!0,title:function(e,t){var a=null;return null!==t&&(a=t.action),"send"===a?"Routine EWI ".concat(e," sent!"):"error"===a?"Error sending routine EWI ".concat(e,"! Resend error via Chatterbox..."):f?"queue"===a?"Routine EWI ".concat(e," already queued for sending"):"Queue routine EWI ".concat(e," for sending"):"Send routine EWI ".concat(e)}("SMS",g)},r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement(kt.a,null),onClick:c({released_sites:m,prescribed_release_time:u,sent_statuses:d,not_yet_sending_time:f,is_sms_queued:h,is_sms_sent:_}),endIcon:v,className:E(g,"error")?a.dyna_error:""},"EWI SMS"))))}var sn=function(e){var t=e.candidateAlertsData,a=e.alertsFromDbData,l=e.releaseFormOpenHandler,i=e.history,c=an(),s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],f=b[1],E=Object(n.useState)({}),v=Object(o.a)(E,2),h=v[0],_=v[1],j=Tt(),x=j.isShowing,k=j.toggle,S=Tt(),C=S.isShowing,D=S.toggle,A=Object(n.useState)({}),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)({}),B=Object(o.a)(H,2),P=B[0],L=B[1],F=function(e){return function(t,a){d(!!a&&e)}},U=Object(n.useState)(null),q=Object(o.a)(U,2),W=q[0],z=q[1],G=function(e){return function(t){M(e),k(),function(e,t){const a="".concat(te.b,"/api/chatterbox/get_ewi_message/").concat(e);ne.a.get(a).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(e.release_id,(function(e){z(e)}))}},V=function(e,t){return function(){_(t),f(e)}},Q=function(e){return function(t){M(e),R(!0)}},Z=[],K=[],J=[],X=[],$=[];return null!==a&&(Z=a.latest,K=a.extended,J=a.overdue,X=a.routine,$=a.invalids),r.a.createElement("div",{className:c.root},r.a.createElement(y.a,{container:!0,className:c.sectionHeadContainer},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5"},"Candidate Alerts")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===t?r.a.createElement(rn,null):0!==t.length?t.map((function(e,a){return r.a.createElement(ln,{key:"exp-".concat(a+1),classes:c,alertData:e,expanded:u,handleExpansion:F,releaseFormOpenHandler:l,index:a,isShowingValidation:g,toggleValidation:V,validationDetails:h,candidateAlertsData:t})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No candidate alerts")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5"},"Event Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(rn,null):Z.length>0?Z.map((function(e,t){return r.a.createElement(cn,{key:"latest-".concat(t+1),keyName:"latest-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:F,smsHandler:G,bulletinHandler:Q,type:"latest",history:i})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No active alerts on database")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5",component:y.a,container:!0,alignItems:"center"},"Overdue Event Monitoring",r.a.createElement(vt.a,{title:"This section shows all monitoring events that are beyond their validities. Possible causes of not updated validity: no latest release, wrong internal alert to extend validity (for cases like ND).",style:{marginLeft:8},arrow:!0},r.a.createElement(Ct.a,{color:"primary"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(rn,null):J.length>0?J.map((function(e,t){return r.a.createElement(cn,{key:"overdue-alert-".concat(t+1),keyName:"overdue-alert-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:F,smsHandler:G,index:t,bulletinHandler:Q,type:"overdue",history:i})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No sites with monitoring events beyond their validity")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(rn,null):$.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5",component:y.a,container:!0,alignItems:"center"},"Recently Invalidated Monitoring Events",r.a.createElement(vt.a,{title:"This section shows all monitoring events that were invalidated in the last 24 hours. All invalidated monitoring events will not undergo three-day extended monitoring.",style:{marginLeft:8},arrow:!0},r.a.createElement(Ct.a,{color:"primary"})))),$.map((function(e,t){return r.a.createElement(cn,{key:"invalid-alert-".concat(t+1),keyName:"invalid-alert-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:F,smsHandler:G,index:t,bulletinHandler:Q,type:"invalids",history:i})})))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5"},"Extended Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(rn,null):K.length>0?K.map((function(e,t){return r.a.createElement(cn,{key:"db-alert-".concat(t+1),keyName:"db-alert-".concat(t+1),classes:c,siteAlert:e,expanded:u,handleExpansion:F,smsHandler:G,index:t,bulletinHandler:Q,type:"extended",history:i})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No sites under extended monitoring")),null===a?r.a.createElement(rn,null):"undefined"!==typeof X.released_sites&&X.released_sites.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:c.sectionHead,variant:"h5"},"Routine Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},r.a.createElement(on,{key:"routine-alert-panel",keyName:"routine-alert-panel",classes:c,siteAlert:X,expanded:u,handleExpansion:F,smsHandler:function(e){return function(){!function(e){const t="".concat(te.b,"/api/chatterbox/get_routine_ewi_template");ne.a.get(t).then(t=>{const a=t.data;e(a)}).catch(e=>{console.error(e)})}((function(t){L(e),z(t),D()}))}},index:0,bulletinHandler:Q,type:"routine",history:i}))),r.a.createElement(Qt,{classes:c,isOpenBulletinModal:Y,setIsOpenBulletinModal:R,releaseDetail:I})),r.a.createElement(Xa,{modalStateHandler:function(){k(),z(null)},modalState:x,textboxValue:W,releaseDetail:I}),P.released_sites&&r.a.createElement(tn,{modalStateHandler:D,modalState:C,textboxValue:W,routineData:P}))},mn=a(1165);function un(e){return $()(e).format("D MMMM YYYY, H:mm")}const dn=()=>r.a.createElement(ft.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"8",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"0",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"8",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"140",rx:"0",ry:"0",width:"206",height:"116"}));var pn=function(e){const t=Object(n.useState)(!1),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],u=s[1],d=e=>t=>{i(!0),u(e)},p=()=>{i(!1)};let g="";const f=e.generatedAlertsData,E=Object(n.useContext)(Ca).sites;if(null!==f&&f.length>0){g=function(e,t,a,l){const i=e.site_code,c=e.ts,o=e.internal_alert,s=e.validity,m=e.current_trigger_alerts,u=e.event_triggers,d=function(e,t){let a=null;for(let n=0;n<t.length;n+=1)if(t[n].site_code===e){a=t[n];break}return a}(i,l),p=un(c),g=re(d),f=[];let E=null;return m.forEach(e=>{const t=e.type,a=e.details;if("subsurface"===t)E=a.trigger_details;else{const e=a.alert_level,n=a.alert_symbol,l="rainfall"===t&&e>0?" (".concat(a.rain_gauge,")"):"";f.push(r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",align:"center"},t.charAt(0).toUpperCase()+t.slice(1)," Alert"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},n,r.a.createElement(O.a,{component:"span",variant:"body2",color:"textPrimary",align:"center"},l))))}}),r.a.createElement(Oe.a,{fullWidth:!0,open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(je.a,{id:"alert-dialog-title"},r.a.createElement("div",null,g),r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},p)),r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Internal Alert Level"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),""!==s&&r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Validity"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},un(s))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"OPERATIONAL ALERT STATUS"))),f.map(e=>e),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textPrimary"},"Subsurface Column Status")),E.length>0?E.map(e=>{const t=e.alert_symbol,a=e.tsm_name,n=e.ts;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},a.toUpperCase()),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},un(n)),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},t))}):r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"No subsurface sensors available")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),u.length>0&&r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"EVENT TRIGGERS"))),u.map(e=>{const t=e.ts_updated,a=e.alert,l=e.tech_info,i=e.invalid,c=e.invalid_details,o=un(t);return r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:a},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"Trigger | ",a))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},l)),"undefined"!==typeof i&&!0===i&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"INVALIDATED ALERT"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},"".concat(c.user.first_name," ").concat(c.user.last_name))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},un(c.ts_ack))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},c.remarks))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)))}))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:a,color:"primary",autoFocus:!0},"Close")))}(f[m],l,p,E)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2},null===f?r.a.createElement(dn,null):f.map((e,t)=>function(e,t,a,n){const l=e.ts,i=e.site_code,c=e.internal_alert,o=un(l);return r.a.createElement(y.a,{item:!0,xs:6,sm:4,lg:3,key:t},r.a.createElement(G.a,{className:"alert-card"},r.a.createElement(mn.a,{onClick:a(t)},r.a.createElement(V.a,{style:{paddingBottom:16}},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",gutterBottom:!0},o),r.a.createElement("div",{style:{display:"flex",alignItems:"baseline",alignContent:"flex-end",justifyContent:"space-between"}},r.a.createElement(O.a,{variant:"h5",component:"h2"},i.toUpperCase()),r.a.createElement(O.a,{className:"card-internal-alert",color:"textSecondary"},c))))))}(e,t,d)),g))},bn=a(1168),gn=a(1169),fn=a(1170),En=a(1167),vn=a(431),hn=a.n(vn),_n=a(1166),yn=a(439),On=a.n(yn),jn=Object(n.createContext)(),xn={data_ts:null,release_time:$()(),site:"",iomp_mt:"",iomp_ct:"",with_retrigger_validation:!1,subsurface:{value:"",triggers:{2:{checked:!1,ts:null,tech_info:""},3:{checked:!1,ts:null,tech_info:""}}},surficial:{value:"",triggers:{2:{checked:!1,ts:null,tech_info:""},3:{checked:!1,ts:null,tech_info:""}}},moms:{value:"-1",triggers:{2:{checked:!1,ts:null,tech_info:""},3:{checked:!1,ts:null,tech_info:""}}},rainfall:{value:"",trigger:{ts:null,tech_info:""}},"on demand":{value:"-1",trigger:{ts:null,tech_info:""}},earthquake:{value:"",trigger:{ts:null,tech_info:"",magnitude:"",latitude:"",longitude:""}},comments:{value:"",helper_text:"",required:!1},validation:{},previous_release:null,post_computation:null,non_triggering_moms:[],manually_lower_alert:{value:!1,is_valid:""},preview:null};function kn(e,t){var a=t.type,n=t.payload,r=e.validation,l=On()(e);switch(a){case"UPDATE_DATA_TS":var i="";null===n?i="Required field":n.isValid()||(i="Invalid date/time format");var c=Object(p.a)(Object(p.a)({},r),{},{data_ts:i});return Object(p.a)(Object(p.a)({},e),{},{data_ts:n,validation:c});case"UPDATE_RELEASE_TIME":var o="";null===n?o="Required field":n.isValid()||(o="Invalid time format");var m=Object(p.a)(Object(p.a)({},r),{},{release_time:o});return Object(p.a)(Object(p.a)({},e),{},{release_time:n,validation:m});case"UPDATE_SITE":var u=Object(p.a)(Object(p.a)({},r),{},{site:n?"":"Required field"});return Object(p.a)(Object(p.a)({},e),{},{site:n,validation:u});case"UPDATE_CT_PERSONNEL":var d=Object(p.a)(Object(p.a)({},r),{},{iomp_ct:n?"":"Required field"});return Object(p.a)(Object(p.a)({},e),{},{iomp_ct:n,validation:d});case"UPDATE_RETRIGGER_VALIDATION":var b=Object(p.a)(Object(p.a)({},r),{},{with_retrigger_validation:n?"":"Required field"});return Object(p.a)(Object(p.a)({},e),{},{with_retrigger_validation:n,validation:b});case"UPDATE_SUBSURFACE_PRESENCE":var g=e.subsurface;return Object(p.a)(Object(p.a)({},e),{},{subsurface:Object(p.a)(Object(p.a)({},g),{},{value:n})});case"UPDATE_SUBSURFACE_TRIGGER":var f=n.key,E=n.value,v=l.subsurface.triggers[f];return l.subsurface.triggers[f]=Object(p.a)(Object(p.a)({},v),{},{checked:E}),l;case"UPDATE_SUBSURFACE_TRIGGER_DETAILS":var h=n.key,_=n.value,y=n.attr,O=l.subsurface.triggers[h];return l.subsurface.triggers[h]=Object(p.a)(Object(p.a)({},O),{},Object(s.a)({},y,_)),l;case"UPDATE_SURFICIAL_PRESENCE":var j=e.surficial;return Object(p.a)(Object(p.a)({},e),{},{surficial:Object(p.a)(Object(p.a)({},j),{},{value:n})});case"UPDATE_SURFICIAL_TRIGGER":var x=n.key,k=n.value,S=l.surficial.triggers[x];return l.surficial.triggers[x]=Object(p.a)(Object(p.a)({},S),{},{checked:k}),l;case"UPDATE_SURFICIAL_TRIGGER_DETAILS":var C=n.key,D=n.value,A=n.attr,w=l.surficial.triggers[C];return l.surficial.triggers[C]=Object(p.a)(Object(p.a)({},w),{},Object(s.a)({},A,D)),l;case"UPDATE_RAINFALL_PRESENCE":var I=e.rainfall;return Object(p.a)(Object(p.a)({},e),{},{rainfall:Object(p.a)(Object(p.a)({},I),{},{value:n})});case"UPDATE_RAINFALL_TRIGGER_DETAILS":var M=n.value,T=n.attr,N=l.rainfall.trigger;return l.rainfall.trigger=Object(p.a)(Object(p.a)({},N),{},Object(s.a)({},T,M)),l;case"UPDATE_EARTHQUAKE_PRESENCE":var Y=e.earthquake;return Object(p.a)(Object(p.a)({},e),{},{earthquake:Object(p.a)(Object(p.a)({},Y),{},{value:n})});case"UPDATE_EARTHQUAKE_TRIGGER_DETAILS":var R=n.value,H=n.attr,B=l.earthquake.trigger;return l.earthquake.trigger=Object(p.a)(Object(p.a)({},B),{},Object(s.a)({},H,R)),l;case"UPDATE_COMMENTS":var P={value:n,helper_text:"",required:!1};return e.manually_lower_alert.value&&(P.helper_text=n?"":"Enter reason for manual lowering",P.required=!0),Object(p.a)(Object(p.a)({},e),{},{comments:Object(p.a)({},P)});case"SAVE_LATEST_SITE_EVENT_DETAIL":return Object(p.a)(Object(p.a)({},e),{},{previous_release:n});case"SAVE_NON_TRIGGERING_MOMS":var L=l.moms;return L.value=n.length>0?"0":"-1",Object(p.a)(Object(p.a)({},e),{},{non_triggering_moms:n,moms:L});case"SAVE_POST_COMPUTATION_DETAILS":return Object(p.a)(Object(p.a)({},e),{},{post_computation:Object(p.a)({},n),preview:Object(p.a)({},n)});case"USE_CANDIDATE_ALERT":return function(e,t){var a=On()(xn),n=new Set,r=[],l=null;e.trigger_list_arr.forEach((function(e,t){var i=e.trigger_type,c=e.invalid;n.add(i),a[i].value="1",["subsurface","surficial","moms"].includes(i)?(a[i].triggers[e.alert_level]={checked:!0,tech_info:e.tech_info,ts:e.ts_updated},"moms"===i&&(a.moms.triggers[e.alert_level].moms_list=e.moms_list)):(a[i].trigger={tech_info:e.tech_info,ts:e.ts_updated},"on demand"===i&&(a[i].trigger.od_details=e.od_details)),c?l="Above threshold triggers tagged as invalid were already removed from this release. Review them if necessary. Furthermore, validity from generated alerts might differ to actual monitoring event because of the invalid trigger.":r.push(Object(p.a)(Object(p.a)({},e),{},{source:i,alert_symbol:e.alert[0],ts:e.ts_updated}))})),e.current_triggers_status.forEach((function(e){n.has(e.trigger_source)||(a[e.trigger_source].value="".concat(e.alert_level)),n.has("earthquake")||(a.earthquake.value="0")}));var i={public_alert_level:e.public_alert_level,internal_alert:e.internal_alert_level,note:l,trigger_list:r,trigger_list_str:e.release_details.trigger_list_str,to_extend_validity:e.to_extend_validity};return Object(p.a)(Object(p.a)({},a),{},{data_ts:e.release_details.data_ts,release_time:$()(),site:{value:e.site_id,data:{site_code:e.site_code}},previous_release:Object(p.a)({},e.previous_release),post_computation:i,preview:i,non_triggering_moms:e.non_triggering_moms,iomp_ct:t.iomp_ct})}(n,e);case"UPDATE_MANUALLY_LOWER_ALERT":var F=e.subsurface,U=e.surficial,q=e.moms,W=e.comments,z=[F,U,q].every((function(e){return"-1"===e.value}))?"ND":"A0",G=Object(p.a)(Object(p.a)({},W),{},{helper_text:n&&!W.value?"Enter reason for manual lowering":"",required:n}),V={public_alert_level:0,internal_alert:z,trigger_list_str:z,note:'You are manually lowering an alert. We are encouraging you to REVIEW ALL THE INPUTS in the previous section. If it is already the end of event validity, choose the "Valid" option. Else, choose whether the monitoring event is valid and provide reason of premature lowering on the comments.',trigger_list:[],to_extend_validity:!1,comments:G};return n||(V=Object(p.a)({},e.post_computation)),Object(p.a)(Object(p.a)({},e),{},{manually_lower_alert:{value:n,is_valid:""},comments:Object(p.a)({},G),preview:Object(p.a)(Object(p.a)({},e.preview),V)});case"UPDATE_LOWERING_VALIDITY":var Q=e.manually_lower_alert;return Object(p.a)(Object(p.a)({},e),{},{manually_lower_alert:Object(p.a)(Object(p.a)({},Q),{},{is_valid:n})});case"RESET":return Object(p.a)({},xn);default:return e}}function Sn(e){var t=e.children,a=Object(k.a)().user_id;xn.iomp_mt=a;var l=Object(n.useReducer)(kn,xn),i=Object(o.a)(l,2),c=i[0],s=i[1],m={state:c,dispatch:s,validateIfNextIsDisabled:function(e){return function(e,t){switch(e){case 0:return["site","data_ts","release_time","iomp_ct"].some((function(e){return Boolean(t.validation[e])||!t[e]}));case 1:return["subsurface","surficial","rainfall","earthquake"].some((function(e){if("1"===t[e].value){var a=t[e],n=a.trigger,r=a.triggers,l=[];if("undefined"!==typeof n)l.push(Object(p.a)(Object(p.a)({},n),{},{checked:!0}));else if(l.push.apply(l,Object(ye.a)(Object.values(r))),l.every((function(e){return!e.checked})))return!0;return l.map((function(e){return!!e.checked&&!Object.values(e).every((function(e){return Boolean(e)}))})).some((function(e){return e}))}return Boolean(t.validation[e])||!t[e].value}));case 2:return Boolean(!t.iomp_ct)||t.manually_lower_alert.value&&(!t.comments.value||!t.manually_lower_alert.is_valid);default:return!0}}(e,c)},prepareAlertReleasePayload:function(e){return function(e){var t=e.comments.value,a=!0,n=e.manually_lower_alert.value;e.manually_lower_alert.value&&(t="<MANUALLY LOWERED; this is added by system> ".concat(t),a=Boolean(parseInt(e.manually_lower_alert.is_valid,10)));var r=e.with_retrigger_validation?1:0;return{site_id:e.site.value,site_code:e.site.data.site_code,public_alert_level:e.preview.public_alert_level,release_details:{data_ts:$()(e.data_ts).format("YYYY-MM-DD HH:mm:00"),trigger_list_str:e.preview.trigger_list_str,release_time:$()(e.release_time).format("HH:mm:00"),comments:t,with_retrigger_validation:r},publisher_details:{publisher_mt_id:e.iomp_mt,publisher_ct_id:e.iomp_ct},to_extend_validity:e.preview.to_extend_validity,trigger_list_arr:e.preview.trigger_list,non_triggering_moms:e.non_triggering_moms,is_event_valid:a,is_manually_lowered:n}}(e)}};return r.a.createElement(jn.Provider,{value:m},t)}var Cn=function(e){return(0,e.dispatch)({type:"UPDATE_DATA_TS",payload:e.payload})},Dn=function(e){(0,e.dispatch)({type:"UPDATE_RELEASE_TIME",payload:e.payload})},An=function(e){return(0,e.dispatch)({type:"UPDATE_SITE",payload:e.payload})},wn=function(e){return(0,e.dispatch)({type:"UPDATE_CT_PERSONNEL",payload:e.payload})},In=function(e){return(0,e.dispatch)({type:"UPDATE_RETRIGGER_VALIDATION",payload:e.payload})},Mn=function(e){return(0,e.dispatch)({type:"UPDATE_SUBSURFACE_PRESENCE",payload:e.payload})},Tn=function(e){return(0,e.dispatch)({type:"UPDATE_SUBSURFACE_TRIGGER",payload:e.payload})},Nn=function(e){return(0,e.dispatch)({type:"UPDATE_SUBSURFACE_TRIGGER_DETAILS",payload:e.payload})},Yn=function(e){return(0,e.dispatch)({type:"UPDATE_SURFICIAL_PRESENCE",payload:e.payload})},Rn=function(e){return(0,e.dispatch)({type:"UPDATE_SURFICIAL_TRIGGER",payload:e.payload})},Hn=function(e){return(0,e.dispatch)({type:"UPDATE_SURFICIAL_TRIGGER_DETAILS",payload:e.payload})},Bn=function(e){return(0,e.dispatch)({type:"UPDATE_RAINFALL_PRESENCE",payload:e.payload})},Pn=function(e){return(0,e.dispatch)({type:"UPDATE_RAINFALL_TRIGGER_DETAILS",payload:e.payload})},Ln=function(e){return(0,e.dispatch)({type:"UPDATE_EARTHQUAKE_PRESENCE",payload:e.payload})},Fn=function(e){return(0,e.dispatch)({type:"UPDATE_EARTHQUAKE_TRIGGER_DETAILS",payload:e.payload})},Un=function(e){return(0,e.dispatch)({type:"UPDATE_COMMENTS",payload:e.payload})},qn=function(e){return(0,e.dispatch)({type:"SAVE_LATEST_SITE_EVENT_DETAIL",payload:e.payload})},Wn=function(e){return(0,e.dispatch)({type:"SAVE_NON_TRIGGERING_MOMS",payload:e.payload})},zn=function(e){return(0,e.dispatch)({type:"SAVE_POST_COMPUTATION_DETAILS",payload:e.payload})},Gn=function(e){return(0,e.dispatch)({type:"USE_CANDIDATE_ALERT",payload:e.payload})},Vn=function(e){return(0,e.dispatch)({type:"UPDATE_MANUALLY_LOWER_ALERT",payload:e.payload})},Qn=function(e){return(0,e.dispatch)({type:"UPDATE_LOWERING_VALIDITY",payload:e.payload})},Zn=function(e){return(0,e.dispatch)({type:"RESET"})},Kn=a(435);class Jn extends n.Component{constructor(...e){super(...e),this.state={labelWidth:0}}componentDidMount(){this.setState({labelWidth:i.a.findDOMNode(this.InputLabelRef).offsetWidth})}render(){const e=this.props,t=e.classes,a=e.list,n=e.mapping,l=e.label,i=e.div_id,c=e.changeHandler,o=e.value,s=e.css,m=this.state.labelWidth;return r.a.createElement(Dt.a,{required:!0,variant:"outlined",className:"".concat(t.formControl," ").concat(s)},r.a.createElement(Ta.a,{ref:e=>{this.InputLabelRef=e},htmlFor:i},l),r.a.createElement(Na.a,{value:o,onChange:c,name:i,input:r.a.createElement(Kn.a,{labelWidth:m,id:i}),fullWidth:!0},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"---")),a.map((e,t)=>r.a.createElement(P.a,{value:e[n.id],key:t},e[n.label]))))}}var Xn=Object(d.a)(e=>({formControl:{minWidth:120}}))(Jn);const $n={id:"user_id",label:"name"};function er(e){return e.map(({user_id:e,first_name:t,last_name:a})=>({user_id:e,name:"".concat(a,", ").concat(t)}))}var tr=function(e){const t=e.variant,a=e.label,l=e.div_id,i=e.changeHandler,c=e.value,s=e.css,m=e.disabled,u=e.returnFullNameCallback,d=e.isCommunityStaff,p=e.required,b=e.error,g=e.helperText,f=e.site_code,E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useContext)(Ca).users;if(Object(n.useEffect)(()=>{const e=ne.a.CancelToken.source();if(d){const t="".concat(te.b,"/api/users/get_community_users_by_site/").concat(f);ne.a.get(t,{cancelToken:e.token}).then(e=>{const t=er(e.data);_(t)}).catch(e=>{console.log(e)})}else{const e=er(y);_(e)}return()=>{e.cancel()}},[y,f]),"undefined"!==typeof u&&u){const e=h.find(e=>e.user_id===c);"undefined"!==typeof e&&u(e.name)}let O=a;return p&&(O+=" *"),r.a.createElement(n.Fragment,null,"standard"===t&&r.a.createElement(Ya,{label:O,div_id:l,changeHandler:i,value:0===h.length?"":c,list:h,mapping:$n,css:s,disabled:m,error:b,helperText:g}),"outlined"===t&&r.a.createElement(Xn,{label:a,div_id:l,changeHandler:i,value:0===h.length?"":c,list:h,mapping:$n,css:s,error:b,helperText:g}))};function ar(e){var t=e.message;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(x.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},t)))}function nr(e){var t=Object(n.useContext)(jn),a=t.state,l=t.dispatch,i=Object(n.useContext)(Qe.a).server_time,c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1];return Object(n.useEffect)((function(){u(i)}),[i]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(wa,{value:a.site,changeHandler:function(e){return An({dispatch:l,payload:e})},required:!0,helperText:a.validation.site||"",error:Boolean(a.validation.site)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4},r.a.createElement(ta.b,{required:!0,autoOk:!0,fullWidth:!0,label:"Data Timestamp",value:a.data_ts,onChange:function(e){return Cn({dispatch:l,payload:e})},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,helperText:a.validation.data_ts||"",error:Boolean(a.validation.data_ts)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:2},r.a.createElement(_n.a,{required:!0,autoOk:!0,fullWidth:!0,ampm:!1,label:"Time of Release",mask:"__:__",placeholder:"00:00",value:m,onChange:function(e){return Dn({dispatch:l,payload:e})},disabled:!0,helperText:a.validation.release_time||"",error:Boolean(a.validation.release_time)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(tr,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:a.iomp_mt,disabled:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(tr,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:a.iomp_ct,changeHandler:function(e){return wn({dispatch:l,payload:e.target.value})},required:!0,helperText:a.validation.iomp_ct||"",error:Boolean(a.validation.iomp_ct)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:a.with_retrigger_validation,onChange:function(e){return In({dispatch:l,payload:e.target.checked})},name:"isActive",color:"primary"}),label:r.a.createElement(y.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"center",spacing:1},r.a.createElement(O.a,{variant:"body2"},"Retrigger Validation"),r.a.createElement(vt.a,{title:"Tick this if alert validation was done prior to manual release. This will serve as confirmation that the reason for the late monitoring release is valid or invalid."},r.a.createElement(R.a,{"aria-label":"delete"},r.a.createElement(hn.a,{color:"primary"})))),labelPlacement:"end"})))}function rr(e){var t=e.isLoading;return r.a.createElement(n.Fragment,null,t?r.a.createElement(ar,{message:"Fetching current site alert..."}):r.a.createElement(n.Fragment,null,r.a.createElement(lr,null),r.a.createElement(or,null),r.a.createElement(sr,null),r.a.createElement(dr,null),r.a.createElement(pr,null),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(mr,null),r.a.createElement(br,null)))}function lr(e){var t=Object(n.useContext)(jn).state,a=t.previous_release,l=a.internal_alert,i=a.event_alert,c=a.data_ts,o=i.public_alert_symbol.alert_level,s=null;return $()(c).isAfter(t.data_ts)?s="You entered a data timestamp (".concat(t.data_ts.format("YYYY/MM/DD HH:mm"),") ")+"that is prior to the last site alert release.\nReview your data timestamp entry.":$()(c).isSame(t.data_ts)&&(s="Note: You entered the same data timestamp from the last site alert release. Ignore this note if you want to overwrite the last alert release."),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(O.a,{variant:"h6",component:y.a,item:!0,xs:12,align:"center"},"Last Site Release Details: ",i.event.site.site_code.toUpperCase()),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:0,justify:"center"},r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:12,sm:6,align:"center"},r.a.createElement("strong",null,"Internal Alert:")," ",l),r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:12,sm:6,align:"center"},r.a.createElement("strong",null,"Data Timestamp:")," ",c),0!==o&&r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:12,sm:6,align:"center"},r.a.createElement("strong",null,"Validity:")," ",i.event.validity),r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:12,sm:6,align:"center"},r.a.createElement("strong",null,"Release Time:")," ",a.release_time))),s&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",component:"p",color:"error",align:"center",style:{whiteSpace:"pre-line"},display:"block"},s)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)))}function ir(e){var t=e.form,a=e.value,n=e.changeHandler;return r.a.createElement(Dt.a,{component:"fieldset",style:{width:"100%"}},r.a.createElement(Xt.a,{component:"legend"},"Choose the appropriate data situation for the release period."),r.a.createElement(y.a,{container:!0,spacing:0},t.map((function(e){return r.a.createElement(y.a,{item:!0,xs:12,sm:6,key:e.value,container:!0,justify:"center"},r.a.createElement(wt.a,{value:e.value,label:e.label,control:r.a.createElement(It.a,{checked:a===e.value,onChange:n,size:"small"})}))}))))}function cr(e){var t=e.triggerHandler,a=e.labelFor,l=e.trigger;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Trigger Timestamp (".concat(a,")"),value:l.ts,onChange:function(e){return t("ts",e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{required:!0,label:"Technical Information (".concat(a,")"),multiline:!0,rowsMax:"2",placeholder:'Enter technical info for "'.concat(a,'" trigger'),value:l.tech_info,onChange:function(e){return t("tech_info",e.target.value)},fullWidth:!0})))}function or(e){var t=Object(n.useContext)(jn),a=t.state,l=t.dispatch,i=a.subsurface,c=i.value,o=i.triggers,s=function(e){return function(t){Tn({dispatch:l,payload:{value:t.target.checked,key:e}})}},m=function(e){return function(t,a){Nn({dispatch:l,payload:{value:a,key:e,attr:t}})}},u=Object.keys(o).map((function(e){var t=parseInt(e,10),a=o[e],n=a.checked,l="s".concat(t);return r.a.createElement(y.a,{item:!0,xs:12,container:!0,key:l},r.a.createElement(y.a,{item:!0,xs:n?4:12,sm:n?3:12,justify:"center",container:!0},r.a.createElement(wt.a,{value:t,control:r.a.createElement(Jt.a,{color:"primary",checked:n,onClick:s(t)}),label:"Trigger ".concat(l)})),n&&r.a.createElement(y.a,{item:!0,xs:8,sm:9,container:!0,justify:"space-evenly",alignItems:"center",spacing:2},r.a.createElement(cr,{labelFor:l,trigger:a,triggerHandler:m(t)})))}));return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"Subsurface (S/s)")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ir,{form:[{value:"1",label:"ABOVE threshold at a certain time (s2/s3)"},{value:"0",label:"BELOW threshold all throughout (s)"},{value:"-1",label:"No data all throughout (s0)"}],value:c,changeHandler:function(e){var t=e.target.value;Mn({dispatch:l,payload:t})}})),"1"===c&&r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},u))}function sr(e){var t=Object(n.useContext)(jn),a=t.state,l=t.dispatch,i=a.surficial,c=i.value,o=i.triggers,s=function(e){return function(t){Rn({dispatch:l,payload:{value:t.target.checked,key:e}})}},m=function(e){return function(t,a){Hn({dispatch:l,payload:{value:a,key:e,attr:t}})}},u=Object.keys(o).map((function(e){var t=parseInt(e,10),a=o[e],n=a.checked,l="g".concat(t);return r.a.createElement(y.a,{item:!0,xs:12,container:!0,key:l},r.a.createElement(y.a,{item:!0,xs:n?4:12,sm:n?3:12,justify:"center",container:!0},r.a.createElement(wt.a,{value:t,control:r.a.createElement(Jt.a,{color:"primary",checked:n,onClick:s(t)}),label:"Trigger ".concat(l)})),n&&r.a.createElement(y.a,{item:!0,xs:8,sm:9,container:!0,justify:"space-evenly",alignItems:"center",spacing:2},r.a.createElement(cr,{labelFor:l,trigger:a,triggerHandler:m(t)})))}));return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"Surficial (G/g)")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ir,{form:[{value:"1",label:"ABOVE threshold at a certain time (g2/g3)"},{value:"0",label:"BELOW threshold all throughout (g)"},{value:"-1",label:"No data all throughout (g0)"}],value:c,changeHandler:function(e){var t=e.target.value;Yn({dispatch:l,payload:t})}})),"1"===c&&r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},u))}function mr(e){var t=Object(n.useContext)(jn).state,a=t.moms,l=a.value,i=a.triggers,c=t.non_triggering_moms;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"MOMS (M/m)"),r.a.createElement(O.a,{variant:"caption"},"Note: MOMs triggers are inserted via MOMs Form. If you inserted a MOMs trigger for this site, wait for the trigger to be included on the site's candidate alert then release it.")),"1"===l&&r.a.createElement(n.Fragment,null," ",Object.keys(i).map((function(e){var t=i[e],a=t.checked,l=t.ts,c=t.tech_info,o=t.moms_list,s=[{label:"Alert",value:"m".concat(e)},{label:"Trigger Timestamp",value:$()(l).format("YYYY-MM-DD HH:mm")},{label:"Technical Information",value:c}];if(a){var m=s.map((function(e){return r.a.createElement(y.a,{item:!0,xs:12,sm:"Technical Information"===e.label?6:3,key:e.label},gr(e))})),u=r.a.createElement(O.a,{variant:"body2",align:"center",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"MOMs List")),d=ur(o);return r.a.createElement(n.Fragment,{key:e},m,u,d)}}))," "),"0"===l&&r.a.createElement(O.a,{variant:"body1",align:"center",component:y.a,item:!0,xs:12},"This release HAS non-triggering MOMs data within release period (m)."),c&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"body2",align:"center",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Non-triggering MOMs")),ur(c)),"-1"===l&&r.a.createElement(O.a,{variant:"body1",align:"center",component:y.a,item:!0,xs:12},"No MOMs entry present for this release period (m0)."))}function ur(e){return e.map((function(e){var t=e.moms_instance,a=t.feature,n=t.feature_name,l=e.remarks,i=e.observance_ts,c={label:"Feature",value:"".concat(Object(Ra.a)(a.feature_type)," ").concat(n)},o={label:"Observance Timestamp",value:i},s={label:"Remarks",value:l};return r.a.createElement(y.a,{item:!0,xs:12,key:e.moms_id},r.a.createElement(y.a,{container:!0,item:!0,xs:12},r.a.createElement(y.a,{item:!0,xs:3},gr(c)),r.a.createElement(y.a,{item:!0,xs:3},gr(o)),r.a.createElement(y.a,{item:!0,xs:6},gr(s))))}))}function dr(e){var t=Object(n.useContext)(jn),a=t.state,l=t.dispatch,i=a.rainfall,c=i.value,o=i.trigger;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"Rainfall (R)")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ir,{form:[{value:"1",label:"ABOVE threshold at a certain time (r1)"},{value:"0",label:"BELOW threshold all throughout (r)"},{value:"-2",label:"Currently BELOW threshold BUT above 75% (rx)"},{value:"-1",label:"No data all throughout (r0)"}],value:c,changeHandler:function(e){var t=e.target.value;Bn({dispatch:l,payload:t})}})),"1"===c&&r.a.createElement(cr,{labelFor:"r1",trigger:o,triggerHandler:function(e,t){Pn({dispatch:l,payload:{value:t,attr:e}})}}))}function pr(e){var t=Object(n.useContext)(jn),a=t.state,l=t.dispatch,i=a.earthquake,c=i.value,o=i.trigger,s=o.magnitude,m=o.latitude,u=o.longitude,d=function(e,t){Fn({dispatch:l,payload:{value:t,attr:e}})};return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"Earthquake (E)")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ir,{form:[{value:"1",label:"Recent trigger occured"},{value:"0",label:"No recent trigger"}],value:c,changeHandler:function(e){var t=e.target.value;Ln({dispatch:l,payload:t})}})),"1"===c&&r.a.createElement(n.Fragment,null,r.a.createElement(cr,{labelFor:"e1",trigger:o,triggerHandler:d}),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(f.a,{required:!0,id:"magnitude",label:"Magnitude",value:s,onChange:function(e){return d("magnitude",e.target.value)},type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(f.a,{required:!0,id:"latitude",label:"Latitude",value:m,onChange:function(e){return d("latitude",e.target.value)},type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(f.a,{required:!0,id:"longitude",label:"Longitude",value:u,onChange:function(e){return d("longitude",e.target.value)},type:"number"}))))}function br(e){var t=Object(n.useContext)(jn).state["on demand"],a=t.value,l=t.trigger,i=[];if("1"===a){var c=l.ts,o=l.tech_info;i=[{label:"Alert",value:"d1"},{label:"Trigger Timestamp",value:$()(c).format("YYYY-MM-DD HH:mm")},{label:"Technical Information",value:o}]}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"On-Demand (D)"),r.a.createElement(O.a,{variant:"caption"},"Note: On-demand triggers are inserted via On-Demand Trigger Form. If you inserted a On-Demand trigger for this site, wait for the trigger to be included on the site's candidate alert then release it.")),"1"===a&&r.a.createElement(n.Fragment,null," ",i.map((function(e){return r.a.createElement(y.a,{item:!0,xs:12,sm:"Technical Information"===e.label?6:3,key:e.label},gr(e))}))," "),"0"===a&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center",gutterBottom:!0},"This release has data request to end on-demand monitoring (d) OR the monitoring event has other positive triggers*."),r.a.createElement(O.a,{variant:"caption",align:"center"},"*If there is other released positive threshold aside form on-demand trigger, data presence for this trigger is not observed (default to d).")),"-1"===a&&r.a.createElement(O.a,{variant:"body1",align:"center",component:y.a,item:!0,xs:12},"No on-demand entry present for this release period (d0)."))}var gr=function(e){return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},e.label),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},e.value))};function fr(e){var t=e.isLoading,a=Object(n.useContext)(jn),l=a.state,i=a.dispatch,c="---",o=null,s=[];if(l.preview){var m=l.preview,u=m.internal_alert,d=m.note,p=m.trigger_list;c=u,o=d,s.push.apply(s,Object(ye.a)(p))}var b,g=[{label:"Site",value:l.site.data.site_code.toUpperCase()},{label:"Internal Alert",value:c},{label:"Data Timestamp",value:$()(l.data_ts).format("YYYY-MM-DD HH:mm")},{label:"Release Time",value:l.release_time.format("HH:mm")}];return r.a.createElement(n.Fragment,null,t?r.a.createElement(ar,{message:"Calculating internal alert..."}):r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"h6",component:y.a,item:!0,xs:12,align:"center"},"Alert Release Summary"),o&&r.a.createElement(O.a,{variant:"body1",color:"error",component:y.a,item:!0,xs:12,align:"center"},o),g.map((function(e){return r.a.createElement(y.a,{item:!0,xs:6,sm:3,key:e.label},gr(e))})),(b=s,r.a.createElement(n.Fragment,null,0!==b.length&&r.a.createElement(y.a,{item:!0,xs:12,container:!0},r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:12,align:"center"},r.a.createElement("strong",null,"Release Triggers")),b.map((function(e){var t="".concat(e.alert_symbol).concat(e.alert_level),a=[{label:"Source",value:"".concat(Object(Ra.a)(e.source)," (").concat(t,")")},{label:"Trigger Timestamp",value:$()(e.ts).format("YYYY-MM-DD HH:mm:00")},{label:"Technical Information",value:e.tech_info}];return r.a.createElement(y.a,{item:!0,xs:12,container:!0,key:t,spacing:1,style:{margin:"1em 0"}},a.map((function(e){return r.a.createElement(y.a,{item:!0,xs:12,sm:"Technical Information"===e.label?6:3,key:e.label},gr(e))})))}))))),l.previous_release.event_alert.public_alert_symbol.alert_level>0&&r.a.createElement(y.a,{item:!0,xs:12,sm:l.manually_lower_alert.value?4:12},r.a.createElement(wt.a,{control:r.a.createElement(En.a,{checked:l.manually_lower_alert.value,onChange:function(e){return Vn({dispatch:i,payload:e.target.checked})},value:"lower_to_a0"}),label:"Manually Lower to Alert 0"})),l.manually_lower_alert.value&&r.a.createElement(y.a,{item:!0,xs:12,sm:8,container:!0,justify:"center"},r.a.createElement(Dt.a,{style:{display:"flex",alignItems:"center"},required:!0,error:!l.manually_lower_alert.is_valid,title:"If the monitoring event is invalid, the site will NOT undergo three-day extended monitoring period."},r.a.createElement(Xt.a,{component:"legend"},"Is valid monitoring event (?)"),r.a.createElement(At.a,{"aria-label":"position",name:"Is monitoring event valid?",value:l.manually_lower_alert.is_valid,onChange:function(e){return Qn({dispatch:i,payload:e.target.value})},row:!0},r.a.createElement(wt.a,{value:"1",control:r.a.createElement(It.a,{color:"primary"}),label:"Valid",labelPlacement:"end"}),r.a.createElement(wt.a,{value:"0",control:r.a.createElement(It.a,{color:"primary"}),label:"Invalid",labelPlacement:"end"})))),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(tr,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:l.iomp_mt,disabled:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(tr,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:l.iomp_ct,changeHandler:function(e){return wn({dispatch:i,payload:e.target.value})},required:!0,helperText:l.validation.iomp_ct||"",error:Boolean(l.validation.iomp_ct)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Comments",multiline:!0,rowsMax:"2",placeholder:"Enter additional comments necessary",value:l.comments.value,onChange:function(e){return Un({dispatch:i,payload:e.target.value})},fullWidth:!0,required:l.comments.required,helperText:l.comments.helper_text,error:Boolean(l.comments.helper_text)}))))}var Er=function(e){var t=e.activeStep,a=e.isLoading;return r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:2},0===t&&r.a.createElement(nr,null),1===t&&r.a.createElement(rr,{isLoading:a}),2===t&&r.a.createElement(fr,{isLoading:a})))};const vr=Object(n.createContext)();const hr=({children:e})=>{const t=Object(n.useState)([]),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Object(n.useState)(""),s=Object(o.a)(c,2),m=s[0],u=s[1];Object(n.useEffect)(()=>(Object(ee.a)(),Object(ee.d)(e=>{i(e);const t=function(e){const t=$()();return e.find(e=>{const a=$()(e.ts).add(30,"minutes"),n=$()(e.ts).add(12,"hours");return a<=t&&t<n&&e})}(e);if(t){const e=t.iompct;a=e,n=e=>{u(e)},ue("".concat(te.b,"/api/users/get_user_by_nickname/").concat(a),n)}var a,n}),function(){Object(ee.g)()}),[]);const d={monitoring_shifts:l,current_ct:m};return r.a.createElement(vr.Provider,{value:d},e)};var _r=Object(j.a)((function(){return{stepper:{padding:"12px 0 36px"}}}));var yr=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=e.setIsOpenRoutineModal,u=e.generatedAlerts,d=_r(),p=Object(n.useContext)(vr).current_ct,g=Object(c.b)().enqueueSnackbar,f=Object(n.useContext)(jn),E=f.state,v=f.dispatch,h=f.validateIfNextIsDisabled,_=f.prepareAlertReleasePayload;Object(n.useEffect)((function(){if(a){var e=$()();Dn({dispatch:v,payload:e}),p&&wn({dispatch:v,payload:p.user_id})}}),[a,v,p]),Object(n.useEffect)((function(){i&&"routine"!==i.general_status&&(k(2),Gn({dispatch:v,payload:i}))}),[i,v]);var O=Object(n.useState)(0),j=Object(o.a)(O,2),x=j[0],k=j[1],S=["General monitoring alert details","Site alert data and triggers","Alert release preview and comments"],C=Object(n.useState)(!0),D=Object(o.a)(C,2),A=D[0],w=D[1];Object(n.useEffect)((function(){var e=h(x);w(e)}),[E,x,h]);var I=Object(n.useState)(!1),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=function(){Zn({dispatch:v}),k(0),s(null),N(!1)};return r.a.createElement(Oe.a,{fullWidth:!0,maxWidth:"md",fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Monitoring Alert Release Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill out the form and read the instructions carefully."),r.a.createElement(bn.a,{activeStep:x,alternativeLabel:!0,className:d.stepper},S.map((function(e){return r.a.createElement(gn.a,{key:e},r.a.createElement(fn.a,null,e))}))),r.a.createElement(Er,{activeStep:x,isLoading:T})),r.a.createElement(Se.a,null,r.a.createElement(y.a,{item:!0,xs:!0,style:{display:0===x&&null===i?"flex":"none"}},r.a.createElement(b.a,{onClick:m,color:"secondary"},"Release Routine Manually")),r.a.createElement(y.a,{item:!0,xs:!0,align:"right"},x<3&&r.a.createElement(b.a,{onClick:Y,color:"primary"},"Reset"),r.a.createElement(b.a,{onClick:l,color:"primary"},"Close"),x<3&&r.a.createElement(n.Fragment,null,r.a.createElement(b.a,{disabled:0===x,onClick:function(){return k(x-1)}},"Back"),r.a.createElement(b.a,{color:"primary",onClick:function(){if(0===x)N(!0),a=E.site.value,n=function(e){if(qn({dispatch:v,payload:e}),!i){var t=u.find((function(e){return e.site_id===E.site.value}));if(t){var a=t.unreleased_moms_list.filter((function(e){return 0===e.op_trigger}));Wn({dispatch:v,payload:a})}}N(!1)},ue("".concat(te.b,"/api/monitoring/get_latest_site_event_details/").concat(a),n);else{if(1!==x){var e=g("Inserting EWI release...",{variant:"warning",persist:!0}),t=_(E);return t.snackbar_key=e,console.log(t),Ie("insert_ewi",t),l(),void Y()}N(!0),function(e,t){me("".concat(te.b,"/api/monitoring/process_release_internal_alert"),e,t)}(E,(function(e){zn({dispatch:v,payload:e}),N(!1)}))}var a,n;k(x+1)},disabled:A},x===S.length-1?"Submit":"Next")))))})),Or=a(356),jr=a(1171),xr=a(177),kr=a(174),Sr=a(650);const Cr=Object(j.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{margin:"auto"},cardHeader:{padding:e.spacing(1,2)},list:{width:200,height:230,backgroundColor:e.palette.background.paper,overflow:"auto"},button:{margin:e.spacing(.5,0)}}));function Dr(e,t){return e.filter(e=>!t.some(t=>t.value===e.value))}function Ar(e,t){return e.filter(e=>t.some(t=>t.value===e.value))}var wr=function(e){const t=e.routineData,a=e.setRoutineData,l=e.a0SiteList,i=e.setA0SiteList,c=e.NDSiteList,s=e.setNDSiteList,m=e.dataTimestamp,u=e.setDataTimestamp,d=Cr(),g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1];Object(n.useEffect)(()=>{v(t.release_time)},[t]);const h=t.reporter_id_mt,_=e=>n=>{const r=Object(p.a)(Object(p.a)({},t),{},{[e]:n});a(r),"data_ts"===e&&u($()(n).format("YYYY-MM-DD HH:mm:00"))},O=r.a.useState([]),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Ar(x,l.site_id_list),C=Ar(x,c.site_id_list),D=(e,t)=>()=>{const a=x.findIndex(t=>t.value===e),n=[...x];if(-1===a){const a=t.find(t=>t.value===e);n.push(a)}else n.splice(a,1);k(n)},A=e=>Ar(x,e).length,w=e=>()=>{var t,a;A(e)===e.length?k(Dr(x,e)):k((t=x,a=e,[...t,...Dr(a,t)]))},I=(e,t)=>{const a=t.site_id_list;return r.a.createElement(G.a,null,r.a.createElement(jr.a,{className:d.cardHeader,avatar:r.a.createElement(Jt.a,{onClick:w(a),checked:A(a)===a.length&&0!==a.length,indeterminate:A(a)!==a.length&&0!==A(a),disabled:0===a.length,inputProps:{"aria-label":"all site_id_list selected"}}),title:e}),r.a.createElement(Q.a,null),r.a.createElement(Or.a,{className:d.list,dense:!0,component:"div",role:"list"},a.map(e=>{const t=e.value,n=e.label,l="transfer-list-all-item-".concat(t,"-label");return r.a.createElement(xr.a,{key:t,role:"listitem",button:!0,onClick:D(t,a)},r.a.createElement(Sr.a,null,r.a.createElement(Jt.a,{checked:x.some(e=>e.value===t),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":l}})),r.a.createElement(kr.a,{id:l,primary:n}))}),r.a.createElement(xr.a,null)))};return r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:d.inputGridContainer},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Data timestamp",value:m,onChange:_("data_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,error:null===m})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:d.inputGridContainer},r.a.createElement(_n.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:E,onChange:_("release_time"),clearable:!0})),r.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center",className:d.root},r.a.createElement(y.a,{item:!0},I("A0 Sites",l)),r.a.createElement(y.a,{item:!0},r.a.createElement(y.a,{container:!0,direction:"column",alignItems:"center"},r.a.createElement(b.a,{variant:"outlined",size:"small",className:d.button,onClick:()=>{s(Object(p.a)(Object(p.a)({},c),{},{site_id_list:c.site_id_list.concat(S)})),i(Object(p.a)(Object(p.a)({},l),{},{site_id_list:Dr(l.site_id_list,S)})),k(Dr(x,S))},disabled:0===S.length,"aria-label":"move selected NDSiteList"},">"),r.a.createElement(b.a,{variant:"outlined",size:"small",className:d.button,onClick:()=>{i(Object(p.a)(Object(p.a)({},l),{},{site_id_list:l.site_id_list.concat(C)})),s(Object(p.a)(Object(p.a)({},c),{},{site_id_list:Dr(c.site_id_list,C)})),k(Dr(x,C))},disabled:0===C.length,"aria-label":"move selected a0SiteList"},"<"))),r.a.createElement(y.a,{item:!0},I("ND Sites",c))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:d.inputGridContainer},r.a.createElement(tr,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:h,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:d.inputGridContainer},r.a.createElement(tr,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:t.reporter_id_ct,changeHandler:e=>a(Object(p.a)(Object(p.a)({},t),{},{reporter_id_ct:e.target.value}))}))))};function Ir(e){var t=[];return e.length>0&&(t=e.map((function(e){var t=e.site_code;return{state:!0,value:e.site_id,label:t.toUpperCase(),is_disabled:!1}}))),t.sort((function(e,t){return e.site_id>t.site_id}))}var Mr=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.chosenCandidateAlert,s=e.setChosenCandidateAlert,m=Object(k.a)().user_id,u=Object(n.useContext)(Ca).sites,d=Object(n.useState)({}),g=Object(o.a)(d,2),f=g[0],E=g[1],v=Object(c.b)().enqueueSnackbar,h={public_alert_symbol:"A0",public_alert_level:0,data_ts:null,release_time:$()(),general_status:"routine",reporter_id_ct:"",reporter_id_mt:m,non_triggering_moms:{}},_=Object(n.useState)(Object(p.a)({},h)),y=Object(o.a)(_,2),O=y[0],j=y[1],x=Object(n.useState)(Object(p.a)({},{site_id_list:[],internal_alert_level:"A0",trigger_list_str:null})),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(Object(p.a)({},{site_id_list:[],internal_alert_level:"ND",trigger_list_str:null})),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)([]),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)(null),B=Object(o.a)(H,2),P=B[0],L=B[1],F=Object(n.useState)(!0),U=Object(o.a)(F,2),q=U[0],W=U[1];return Object(n.useEffect)((function(){W(0===C.site_id_list.length&&0===I.site_id_list.length||""===O.reporter_id_ct)}),[C.site_id_list,I.site_id_list,O.reporter_id_ct]),Object(n.useEffect)((function(){j(Object(p.a)({},h));var e=Ir(u);R(e)}),[u]),Object(n.useEffect)((function(){var e,t;null===i&&(null!==P?(e=P,t=function(e){var t=Ir(e.unreleased_sites);D(Object(p.a)(Object(p.a)({},C),{},{site_id_list:t}))},ue("".concat(te.b,"/api/monitoring/get_unreleased_routine_sites/").concat(e),t)):(D(Object(p.a)(Object(p.a)({},C),{},{site_id_list:[]})),M(Object(p.a)(Object(p.a)({},I),{},{site_id_list:[]}))))}),[P,i]),Object(n.useEffect)((function(){if("undefined"!==typeof i&&null!==i&&"routine"===i.general_status){var e=Object(p.a)({},i);delete e.routine_details;var t=Object(p.a)(Object(p.a)({},h),e);j(t),L(e.data_ts),Object(p.a)({},i).routine_details.forEach((function(e){var t=e.site_id_list,a=e.internal_alert_level,n=Y.filter((function(e){return t.includes(e.value)})),r=Object(p.a)(Object(p.a)({},e),{},{site_id_list:n});"A0"===a?D(r):M(r)})),E(Object(p.a)({},f))}}),[i,Y]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Routine Release Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Transfer site codes to their respective list if needed. Put sites with ground data on A0 Sites list while put sites without ground data on ND Sites."),r.a.createElement(wr,{routineData:O,setRoutineData:j,a0SiteList:C,setA0SiteList:D,NDSiteList:I,setNDSiteList:M,dataTimestamp:P,setDataTimestamp:L})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:function(){l(),s(null),L(null)},color:"primary"},"Cancel"),r.a.createElement(b.a,{variant:"contained",color:"primary",onClick:function(){var e=$()(O.data_ts).format("YYYY-MM-DD HH:mm:00"),t=$()(O.release_time).format("HH:mm:ss"),a=v("Inserting Routine EWI release...",{variant:"warning",persist:!0}),n=Object(p.a)(Object(p.a)({},O),{},{data_timestamp:e,release_time:t,with_retrigger_validation:!1,routine_details:[Object(p.a)({},C),Object(p.a)({},I)],snackbar_key:a});console.log("Submitting data...",n),Ie("insert_ewi",n),l()},disabled:q},"Submit")))})),Tr=a(1172),Nr=a(1173),Yr=a(1174),Rr=a(440),Hr=a.n(Rr);function Br(e){const t=e,a=e.ts_posted,n=e.ts_expiration,r=e.site_id_list,l=[];return null!==r&&r.forEach(({value:e})=>{l.push(e)}),t.user_id=Object(k.a)().user_id,t.ts_posted=$()(a).format("YYYY-MM-DD HH:mm:ss"),"Invalid date"!==n&&(t.ts_expiration=$()(n).format("YYYY-MM-DD HH:mm:ss")),t.site_id_list=l,t}function Pr(e,t){!function(e,t,a=null){ne.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}(Br(e),"".concat(te.b,"/api/issues_and_reminders/write_issue_reminder_to_db"),t)}const Lr=[{active:!0,barangay:"Agbatuan",municipality:"Dumarao",province:"Capiz",psgc:61904001,purok:null,region:"VI",season:1,site_code:"agb",site_id:1,sitio:null,latitude:11.28137,longitude:122.8311},{active:!0,barangay:"Poblacion",municipality:"Bakun",province:"Benguet",psgc:141103009,purok:null,region:"CAR",season:2,site_code:"bak",site_id:2,sitio:null,latitude:16.7907,longitude:120.6616},{active:!0,barangay:"Banlasan",municipality:"Calape",province:"Bohol",psgc:71210003,purok:null,region:"VI",season:1,site_code:"ban",site_id:3,sitio:null,latitude:9.888559,longitude:123.9488},{active:!0,barangay:"Baras",municipality:"Tarangnan",province:"Samar",psgc:86020008,purok:null,region:"VIII",season:1,site_code:"bar",site_id:4,sitio:null,latitude:11.90208,longitude:124.6566},{active:!0,barangay:"Bayabas",municipality:"Labo",province:"Camarines Norte",psgc:51606009,purok:null,region:"V",season:1,site_code:"bay",site_id:5,sitio:null,latitude:14.18797,longitude:122.4675},{active:!0,barangay:"Boloc",municipality:"Tubungan",province:"Iloilo",psgc:63046016,purok:null,region:"VI",season:2,site_code:"blc",site_id:6,sitio:null,latitude:10.82665,longitude:122.3108},{active:!0,barangay:"Bolodbolod",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412004,purok:"3 & 4",region:"VIII",season:1,site_code:"bol",site_id:7,sitio:null,latitude:10.30199,longitude:125.1279},{active:!0,barangay:"Bato",municipality:"Sibonga",province:"Cebu",psgc:72246007,purok:null,region:"VI",season:1,site_code:"bto",site_id:8,sitio:null,latitude:10.01379,longitude:123.5776},{active:!0,barangay:"San Carlos",municipality:"Dapa",province:"Surigao del Norte",psgc:166707025,purok:null,region:"XIII",season:1,site_code:"car",site_id:9,sitio:null,latitude:9.719629,longitude:125.9737},{active:!0,barangay:"Cudog",municipality:"Lagawe",province:"Ifugao",psgc:142704010,purok:null,region:"CAR",season:2,site_code:"cud",site_id:10,sitio:"Natuwolan at Wadwad",latitude:16.80931,longitude:121.1047},{active:!0,barangay:"Dadong",municipality:"Tarragona",province:"Davao Oriental",psgc:112511003,purok:null,region:"XI",season:1,site_code:"dad",site_id:11,sitio:"Sagasa",latitude:7.13731,longitude:126.4509},{active:!0,barangay:"Gaas",municipality:"Balamban",province:"Cebu",psgc:72208014,purok:null,region:"VII",season:1,site_code:"gaa",site_id:12,sitio:null,latitude:10.42352,longitude:123.7851},{active:!0,barangay:"Gamut",municipality:"Tago",province:"Surigao del Sur",psgc:166818012,purok:null,region:"XIII",season:1,site_code:"gam",site_id:13,sitio:null,latitude:9.0101,longitude:126.1676},{active:!0,barangay:"1 & 2",municipality:"Hinabangan",province:"Samar",psgc:86008012,purok:null,region:"VIII",season:1,site_code:"hin",site_id:14,sitio:null,latitude:11.70064,longitude:125.0691},{active:!0,barangay:"Humayhumay",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611013,purok:null,region:"VII",season:1,site_code:"hum",site_id:15,sitio:null,latitude:10.18392,longitude:123.2503},{active:!0,barangay:"Imelda",municipality:"Tarangnan",province:"Samar",psgc:86020024,purok:null,region:"VIII",season:1,site_code:"ime",site_id:16,sitio:null,latitude:11.90383,longitude:124.7526},{active:!0,barangay:"Immuli",municipality:"Pidigan",province:"Abra",psgc:140118005,purok:null,region:"CAR",season:2,site_code:"imu",site_id:17,sitio:null,latitude:17.52308,longitude:120.6046},{active:!0,barangay:"Inabasan",municipality:"Maasin",province:"Iloilo",psgc:63029025,purok:null,region:"VI",season:2,site_code:"ina",site_id:18,sitio:"Sambag",latitude:10.86991,longitude:122.4362},{active:!0,barangay:"Poblacion 1",municipality:"San Jorge",province:"Samar",psgc:86025024,purok:null,region:"VIII",season:1,site_code:"jor",site_id:19,sitio:null,latitude:11.97779,longitude:124.8249},{active:!0,barangay:"Ambuklao",municipality:"Bokod",province:"Benguet",psgc:141104001,purok:null,region:"CAR",season:2,site_code:"lab",site_id:20,sitio:"Labey",latitude:16.47032,longitude:120.7054},{active:!0,barangay:"Laygayon",municipality:"Pinabacdao",province:"Samar",psgc:86013013,purok:null,region:"VIII",season:1,site_code:"lay",site_id:21,sitio:null,latitude:11.5127,longitude:125.0257},{active:!0,barangay:"Lipanto",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412016,purok:"1",region:"VIII",season:1,site_code:"lip",site_id:22,sitio:null,latitude:10.22767,longitude:125.1266},{active:!0,barangay:"Looc",municipality:"Villanueva",province:"Misamis Oriental",psgc:104326011,purok:null,region:"X",season:1,site_code:"loo",site_id:23,sitio:null,latitude:8.597964,longitude:124.7775},{active:!0,barangay:"Lipata",municipality:"Paranas",province:"Samar",psgc:86022016,purok:null,region:"VIII",season:1,site_code:"lpa",site_id:24,sitio:null,latitude:11.78625,longitude:125.0196},{active:!0,barangay:"Literon",municipality:"Calbiga",province:"Samar",psgc:86004017,purok:null,region:"VIII",season:1,site_code:"lte",site_id:25,sitio:null,latitude:11.59037,longitude:125.0903},{active:!0,barangay:"Lunas",municipality:"Maasin City",province:"Southern Leyte",psgc:86407034,purok:null,region:"VIII",season:1,site_code:"lun",site_id:26,sitio:"Caianuhan",latitude:10.25819,longitude:124.877},{active:!0,barangay:"Magsaysay",municipality:"Kibawe",province:"Bukidnon",psgc:101308016,purok:"1, 2 & 3",region:"X",season:1,site_code:"mag",site_id:27,sitio:null,latitude:7.51923,longitude:125.0598},{active:!0,barangay:"Ambassador",municipality:"Tublay",province:"Benguet",psgc:141114001,purok:null,region:"CAR",season:2,site_code:"mam",site_id:28,sitio:"Mamuyod",latitude:16.4883,longitude:120.689},{active:!0,barangay:"Marirong",municipality:"Leon",province:"Iloilo",psgc:63028059,purok:null,region:"VI",season:2,site_code:"mar",site_id:29,sitio:null,latitude:10.827459,longitude:122.321555},{active:!0,barangay:"Mac-Arthur",municipality:"Esperanza",province:"Agusan del Sur",psgc:160303010,purok:null,region:"XIII",season:1,site_code:"mca",site_id:30,sitio:null,latitude:8.58543,longitude:125.741},{active:!0,barangay:"Manghulyawon",municipality:"La Libertad",province:"Negros Oriental",psgc:184613013,purok:null,region:"VII",season:1,site_code:"mng",site_id:31,sitio:"Dao",latitude:10.04793,longitude:123.2062},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msl",site_id:32,sitio:"Lower Mesolong",latitude:7.629616,longitude:125.5445},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msu",site_id:33,sitio:"Upper Mesolong",latitude:7.628743,longitude:125.5403},{active:!0,barangay:"Nagyubuyuban",municipality:"San Fernando City",province:"La Union",psgc:13314034,purok:"5",region:"I",season:2,site_code:"nag",site_id:34,sitio:null,latitude:16.62678,longitude:120.4176},{active:!0,barangay:"Nurcia",municipality:"Lanuza",province:"Surigao del Sur",psgc:166810011,purok:null,region:"XIII",season:1,site_code:"nur",site_id:35,sitio:null,latitude:9.269702,longitude:126.1384},{active:!0,barangay:"Oslao",municipality:"San Francisco",province:"Surigao del Norte",psgc:166719010,purok:null,region:"XIII",season:1,site_code:"osl",site_id:36,sitio:null,latitude:9.75719,longitude:125.4014},{active:!0,barangay:"Parasanon",municipality:"Pinabacdao",province:"Samar",psgc:86013022,purok:null,region:"VIII",season:1,site_code:"par",site_id:37,sitio:null,latitude:11.51487,longitude:125.0255},{active:!0,barangay:"Pepe",municipality:"Leon",province:"Iloilo",psgc:63028070,purok:null,region:"VI",season:2,site_code:"pep",site_id:38,sitio:"Bangi",latitude:10.78788,longitude:122.3336},{active:!0,barangay:"Pinagkamaligan",municipality:"Calauag",province:"Quezon",psgc:45607060,purok:null,region:"IVB",season:1,site_code:"pin",site_id:39,sitio:null,latitude:13.9536,longitude:122.2855},{active:!0,barangay:"Planas",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611027,purok:null,region:"VII",season:1,site_code:"pla",site_id:40,sitio:"Mambog",latitude:10.15984,longitude:123.2459},{active:!0,barangay:"Pange",municipality:"Matnog",province:"Sorsogon",psgc:56212032,purok:null,region:"V",season:1,site_code:"png",site_id:41,sitio:null,latitude:12.63063,longitude:124.0183},{active:!0,barangay:"Puguis",municipality:"La Trinidad",province:"Benguet",psgc:141110013,purok:null,region:"CAR",season:2,site_code:"pug",site_id:42,sitio:"Longlong",latitude:16.44655,longitude:120.5706},{active:!0,barangay:"Antadao",municipality:"Sagada",province:"Mt. Province",psgc:144409005,purok:null,region:"CAR",season:2,site_code:"sag",site_id:43,sitio:null,latitude:17.08263,longitude:120.9248},{active:!0,barangay:"Sibajay",municipality:"Boston",province:"Davao Oriental",psgc:112503006,purok:null,region:"XI",season:1,site_code:"sib",site_id:44,sitio:null,latitude:7.82567,longitude:126.3834},{active:!0,barangay:"Amgaleyguey",municipality:"Buguias",province:"Benguet",psgc:141105002,purok:null,region:"CAR",season:2,site_code:"sin",site_id:45,sitio:"Sinipsip",latitude:16.7234,longitude:120.7815},{active:!0,barangay:"Sumalsag",municipality:"Malitbog",province:"Bukidnon",psgc:101313011,purok:null,region:"X",season:1,site_code:"sum",site_id:46,sitio:null,latitude:8.54511,longitude:124.8597},{active:!0,barangay:"Talahid",municipality:"Almeria",province:"Biliran",psgc:87801012,purok:null,region:"VIII",season:1,site_code:"tal",site_id:47,sitio:null,latitude:11.63742,longitude:124.3665},{active:!0,barangay:"Taga",municipality:"Pinukpuk",province:"Kalinga",psgc:143209022,purok:null,region:"CAR",season:2,site_code:"tga",site_id:48,sitio:null,latitude:17.57347,longitude:121.3834},{active:!0,barangay:"Tue",municipality:"Tadian",province:"Mt. Province",psgc:144410019,purok:null,region:"CAR",season:2,site_code:"tue",site_id:49,sitio:null,latitude:16.97229,longitude:120.8286},{active:!0,barangay:"Umingan",municipality:"Alimodian",province:"Iloilo",psgc:63002053,purok:null,region:"VI",season:2,site_code:"umi",site_id:50,sitio:null,latitude:10.90807,longitude:122.3278}],Fr=Aa(Lr),Ur=Object(j.a)(e=>({inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:{width:"auto",[e.breakpoints.down("xs")]:{width:"250px"}},root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},justify:{display:"flex",justifyContent:"space-evenly"}}));var qr=function(e){const t=e.issueReminderData,a=e.setIssueReminderData,l=e.fullScreen,i=e.toResolve,c=Ur(),s=t.iar_id,m=t.detail,u=t.ts_expiration,d=t.resolution,b=t.is_event_entry,g=t.site_id_list,E=Object(n.useState)("general"),v=Object(o.a)(E,2),h=v[0],_=v[1],O=Object(n.useState)(h),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(n.useState)(x),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(!1),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)(!1),Y=Object(o.a)(N,2),R=Y[0],H=Y[1];Object(n.useEffect)(()=>{if(T(b),""!==s&&"undefined"!==typeof s){const e=g.map(e=>Fr.filter(t=>t.value===e).pop());a(Object(p.a)(Object(p.a)({},t),{},{site_id_list:e}))}null!==g&&"undefined"!==typeof g&&g.length>0&&(_("site"),k("site"),A("site")),null===u&&H(!0)},[]);const B=e=>n=>{const r=n.target.value;a(Object(p.a)(Object(p.a)({},t),{},{[e]:r}))},P=e=>{const n=e.target,r=n.value,l=n.checked;switch(r){case"is_event_entry":T(l),l||H(!1),a(Object(p.a)(Object(p.a)({},t),{},{is_event_entry:l}));break;case"is_persistent":H(l),a(Object(p.a)(Object(p.a)({},t),{},{is_persistent:l}))}};return r.a.createElement(ea.a,{utils:aa.a},i?r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Resolution",value:d||"",onChange:B("resolution"),placeholder:"Enter resolution",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))):r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(At.a,{"aria-label":"position",name:"position",value:x,onChange:e=>{const t=e.target.value;k(t),A(t)},row:!0,className:l?"":c.justify},r.a.createElement(wt.a,{value:"general",control:r.a.createElement(It.a,{color:"primary"}),label:"General issue/reminder",labelPlacement:"end"}),r.a.createElement(wt.a,{value:"site",control:r.a.createElement(It.a,{color:"primary"}),label:"Site-specific issue/reminder",labelPlacement:"end"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{marginBottom:8}})),"site"===D&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wa,{value:g,changeHandler:e=>a(Object(p.a)(Object(p.a)({},t),{},{site_id_list:e})),isMulti:!0,includeAddressOnOptions:!1})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wt.a,{key:"is_event_entry",control:r.a.createElement(Jt.a,{checked:M,onChange:P,value:"is_event_entry",className:c.checkboxes}),label:r.a.createElement("div",null,"Related to current monitoring event ",r.a.createElement(vt.a,{title:"Checking this will make the issue/reminder expire at the end of site(s) current monitoring event validity"},r.a.createElement("strong",null,"[?]"))),className:"primary"}))),(D||!M)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6,container:!0,justify:"center"},r.a.createElement(wt.a,{key:"is_persistent",control:r.a.createElement(Jt.a,{checked:R,onChange:P,value:"is_persistent",className:c.checkboxes}),label:"Persistent reminder",className:"primary"})),R?r.a.createElement(y.a,{item:!0,md:6}):r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(ta.b,{autoOk:!0,label:"Issue/Reminder Expiration",value:u,onChange:(L="ts_expiration",e=>{a(Object(p.a)(Object(p.a)({},t),{},{[L]:e}))}),ampm:!1,format:"YYYY-MM-DD HH:mm:ss",mask:"____-__-__ __:__:__",clearable:!0}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"8px 0"}})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{required:!0,label:"Details",value:m,onChange:B("detail"),placeholder:"Enter detail",multiline:!0,rowsMax:6,fullWidth:!0,className:c.textField}))));var L};const Wr={detail:"",iar_id:"",site_id_list:null,user_id:"",postings:"",resolution:null,resolved_by:null,ts_resolved:null,ts_posted:$()().format("YYYY-MM-DD HH:mm:ss"),ts_expiration:null,is_event_entry:!1,is_persistent:!1};var zr=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.setIsIandRUpdateNeeded,c=e.chosenIssueReminder,s=e.isIandRUpdateNeeded,m=e.toResolve,u=e.setToRefresh,d=e.toRefresh,g=Object(n.useState)({}),f=Object(o.a)(g,2),E=f[0],v=f[1];Object(n.useEffect)(()=>{if(s){const e=c,t=c.postings.map(e=>e.site_id),a=[];c.postings.forEach(e=>{const t=e.event;null!==t&&a.push(t)}),e.site_id_list=t,e.is_event_entry=a.length>0,v(e)}else v(Wr)},[a,c]);const h=()=>{i(!1),l(!1)};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Issues and Reminder Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Provide information to the following fields."),r.a.createElement(qr,{issueReminderData:E,setIssueReminderData:v,fullScreen:t,toResolve:m})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:h,color:"primary"},"Cancel"),r.a.createElement(b.a,{color:"secondary",onClick:()=>{const e=E.resolution,t=$()().format("YYYY-MM-DD HH:mm:ss");let a=Object(p.a)(Object(p.a)({},E),{},{ts_posted:t});if(""!==e&&null!==e){const e=Object(k.a)().user_id;a=Object(p.a)(Object(p.a)({},E),{},{ts_resolved:t,resolved_by:e})}Pr(a,e=>{e&&"undefined"!==typeof d&&u(!d)}),h()},disabled:!1},"Submit")))})),Gr=Object(j.a)((function(e){return{inputGridContainer:{marginTop:8,marginBottom:8},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),gridList:{height:"100vh",margin:"0 !important",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"},position:"sticky",top:148,padding:8},hasNoIssues:{display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"},icon:{color:"rgba(255, 255, 255, 0.54)"},previewText:{padding:"12px",fontSize:"14px",minHeight:68},tile:{border:"0.5px solid #b2b2b2",padding:"0 !important",marginBottom:6,"&:last-of-type":{marginBottom:0}},tileBar:{background:"#7f7f7f",height:"50px !important"}}}));function Vr(e){var t=e.isCardModalOpen,a=e.chosenIssueReminder,n=e.setCardModalOpen,l=e.setIsOpenIssueReminderModal,i=e.setToResolve,c=e.setIsIandRUpdateNeeded,o=a.site_list,s=a.ts_posted,m=a.detail,u=a.issue_reporter,d=u.first_name,p=u.last_name,g=Qr(o,!1),f=$()(s).format("DD MMMM YYYY, HH:mm");return r.a.createElement(Oe.a,{open:t,maxWidth:"sm"},r.a.createElement(je.a,{style:{paddingBottom:8}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Hr.a,{style:{paddingRight:8}})," ",g)),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,f),r.a.createElement(ke.a,{style:{textIndent:40},align:"justify"},m),r.a.createElement(ke.a,{align:"right",style:{marginBottom:0}},"".concat(d," ").concat(p))),r.a.createElement(Se.a,{disableSpacing:!0},r.a.createElement(b.a,{onClick:function(){n(!1),i(!1),l(!0),c(!0)},color:"primary"},"Edit"),r.a.createElement(b.a,{onClick:function(){n(!1),i(!0),l(!0),c(!0)},color:"secondary"},"Resolve"),r.a.createElement(b.a,{onClick:function(){return n(!1)},color:"primary",autoFocus:!0},"Close")))}function Qr(e,t){var a=t?"GENERAL":"General";return 0!==e.length&&(a=e.join(", ")),a}var Zr=function(e){var t=e.isOpenIssueReminderModal,a=e.setIsOpenIssueReminderModal,l=e.isIandRUpdateNeeded,i=e.setIsIandRUpdateNeeded,c=Gr(),s=Object(n.useContext)(Te).issuesAndReminders,m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],b=u[1],g=Object(n.useState)(!1),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)({site_list:[],site_id_list:null,ts_posted:null,detail:"",issue_reporter:{first_name:"",last_name:""}}),_=Object(o.a)(h,2),y=_[0],j=_[1],x=Object(n.useState)(!1),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),w=A[0],I=A[1];Object(n.useEffect)((function(){v(!1);var e=r.a.createElement(O.a,{component:"div",style:{fontStyle:"italic",width:"auto",height:0}},"No active issues");if(0!==s.length){var t=s.map((function(e,t){var a=[],n=[],r=[],l=null===e.ts_expiration;e.postings.forEach((function(e){var t=e.event_id,l=e.site_id,i=e.site;null!==l&&(a.push(l),n.push(i.site_code.toUpperCase()),r.push(t))}));var i=0!==r.length;return Object(p.a)(Object(p.a)({},e),{},{site_id_list:a,site_list:n,site_events_list:r,is_event_entry:i,is_persistent:l})}));e=function(e,t,a){return t.map((function(t,n){var l=t.site_list,i=t.detail,c=t.issue_reporter,o=t.iar_id,s=Qr(l);return r.a.createElement(Tr.a,{key:"test ".concat(n+1),cols:2,className:e.tile},r.a.createElement(O.a,{className:e.previewText},i),r.a.createElement(Nr.a,{className:e.tileBar,title:"".concat(o," ").concat(s),subtitle:"".concat(c.first_name," ").concat(c.last_name),actionIcon:r.a.createElement(vt.a,{title:"Expand card"},r.a.createElement(R.a,{"aria-label":"Expand",className:e.icon,onClick:a(t)},r.a.createElement(Hr.a,null)))}))}))}(c,t,M),v(!0)}b(e)}),[c,s]);var M=function(e){return function(t){j(e),C(!0)}};return r.a.createElement(n.Fragment,null,r.a.createElement(Yr.a,{component:"div",cellHeight:"auto",className:"".concat(c.gridList," ").concat(!E&&c.hasNoIssues)},d),r.a.createElement(Vr,{isCardModalOpen:S,setCardModalOpen:C,chosenIssueReminder:y,setToResolve:I,setIsOpenIssueReminderModal:a,setIsIandRUpdateNeeded:i}),r.a.createElement(zr,{isOpen:t,isIandRUpdateNeeded:l,chosenIssueReminder:y,setIsIandRUpdateNeeded:i,toResolve:w,closeHandler:function(){a(!1)}}))},Kr=a(135),Jr=a.n(Kr),Xr=a(618),$r=a.n(Xr);const el=Object(j.a)(e=>({summary:{minHeight:24},summaryContent:{marginBottom:6,marginTop:6},icon:{paddingTop:6,paddingBottom:6},details:{paddingTop:16}}));var tl=function(e){const t=Object(n.useContext)(vr).monitoring_shifts,a=el(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1];return Object(n.useEffect)(()=>{if(null!==t&&"undefined"!==typeof t){const e=t.filter(e=>$()(e.ts)>$()().subtract({hours:12})?e:null).slice(0,3);s(e)}},[t]),r.a.createElement($e.a,{defaultExpanded:!1},r.a.createElement(et.a,{expandIcon:r.a.createElement(Jr.a,null),"aria-controls":"panel1c-content",id:"panel1c-header",className:a.summary,IconButtonProps:{className:a.icon},classes:{content:a.summaryContent}},r.a.createElement(y.a,{container:!0,justify:"space-between",alignItems:"baseline"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(O.a,{variant:"caption"},r.a.createElement("strong",null,"MONITORING SHIFT"))),c.length>0&&r.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"space-evenly"},r.a.createElement(O.a,{variant:"overline"},"MT - ",c[0].iompmt),r.a.createElement(O.a,{variant:"overline"},"CT - ",c[0].iompct)))),r.a.createElement(Q.a,null),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,justify:"space-evenly",className:a.details},c.length>0&&c.map(e=>r.a.createElement(y.a,{item:!0,xs:6,sm:4,key:e.ts},r.a.createElement(O.a,{variant:"subtitle2",align:"center"},r.a.createElement("strong",null,(e=>{const t=$()(),a=$()(e),n=$()(e).add(12,"hours");return t>a&&a<=n?"Current":t.add(12,"hours")>a?"Next":t.add(24,"hours")>a?a.format("MMMM D, A (ddd)"):null})(e.ts))),r.a.createElement(O.a,{variant:"body2",align:"center"},e.iompmt," (MT)"),r.a.createElement(O.a,{variant:"body2",align:"center",gutterBottom:!0},e.iompct," (CT)"))))),r.a.createElement(Q.a,null),r.a.createElement(Et.a,null,r.a.createElement(m.b,{to:"monitoring/shifts_and_reports/shifts",style:{textDecoration:"none"}},r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement($r.a,null)},"Go to Calendar"))))},al=a(1175);function nl(e){const t=e.momsEntry,a=e.updateField,n=e.isAddingNewInstance,l=e.setIsNoneEntrySelected,i=e.location,c=e.site_code,o=t.moms,s=t.options,m=o.feature_type,u=null!==m&&"None"===m.label;return l(u),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Sa,{label:"Feature Type",options:s.feature_type,value:o.feature_type,changeHandler:a("feature_type"),placeholder:"Select feature type",renderDropdownIndicator:!0,openMenuOnClick:!0})),!u&&r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(vt.a,{title:"Feature names are auto-generated. To add new MOMs feature name, choose (Add new instance)",placement:"top",interactive:!0},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Sa,{label:"Feature Name",options:s.feature_name.options,isDisabled:s.feature_name.disabled,value:o.feature_name,changeHandler:a("feature_name"),placeholder:s.feature_name.disabled?"Disabled":"Select feature name",renderDropdownIndicator:!0,openMenuOnClick:!0}))),n&&r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Location",multiline:!0,rowsMax:"2",placeholder:"Enter location of new instance",value:i,onChange:a("location"),fullWidth:!0,InputLabelProps:{shrink:!0}}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Sa,{label:"Alert Level",options:s.alert_level.options,isDisabled:s.alert_level.disabled,value:o.alert_level,changeHandler:a("alert_level"),placeholder:s.alert_level.disabled?"Disabled":"Select alert level",renderDropdownIndicator:!0,openMenuOnClick:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Observance Timestamp",value:o.observance_ts,onChange:a("observance_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Narrative",multiline:!0,rowsMax:"2",placeholder:"Enter report narrative",value:o.narrative,onChange:a("narrative"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(tr,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:a("reporter"),value:o.reporter,isCommunityStaff:"true",site_code:c})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Remarks",multiline:!0,rowsMax:"2",placeholder:"Enter expert's remarks",value:o.remarks,onChange:a("remarks"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(tr,{variant:"standard",label:"Validator",div_id:"validator",changeHandler:a("validator"),value:o.validator})))}var rl=function(e){const t=e.momsEntries,a=e.setMomsEntries,l=e.selectSite,i=e.site,c=e.setSite,s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(!1),g=Object(o.a)(p,2),f=g[0],E=g[1],v=e=>t=>n=>{let r="";if("feature_name"===t&&("(Add new instance)"===n.label?d(!0):d(!1)),["feature_type","feature_name","alert_level","observance_ts"].includes(t))r=n;else if(["narrative","remarks","reporter","validator","location"].includes(t)){r=n.target.value}a({action:"UPDATE_DETAILS",key:e,attribute:t,value:r})},h=e=>()=>a({action:"DELETE_INSTANCE",key:e});return r.a.createElement(n.Fragment,null,l&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(wa,{value:i,changeHandler:e=>c(e)})),null!==i&&r.a.createElement(n.Fragment,null,r.a.createElement(ea.a,{utils:aa.a},t.map((e,a)=>{const l=0===a,c=t.length===a+1;return r.a.createElement(n.Fragment,{key:"moms_".concat(a)},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:l?12:0}},r.a.createElement(O.a,{variant:"subtitle2"},"Entry Number ",a+1),!l&&r.a.createElement(R.a,{"aria-label":"delete",color:"primary",onClick:h(a)},r.a.createElement(al.a,null))),r.a.createElement(nl,{momsEntry:e,updateField:v(a),isAddingNewInstance:u,setIsNoneEntrySelected:E,site_code:i.data.site_code}),!c&&r.a.createElement(Q.a,{style:{margin:"24px 0 12px"},variant:"middle"}))})),!f&&r.a.createElement("div",{style:{margin:"16px 0",textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:()=>a({action:"ADD_INSTANCE"})},"Add MOMs Observation"))))};const ll={moms:{feature_type:null,feature_name:null,alert_level:null,observance_ts:null,narrative:"",reporter:"",remarks:"",validator:"",location:""},options:{feature_type:[],feature_name:{options:[],disabled:!0},alert_level:{options:[],disabled:!0}}};function il(e,t){const a=t.action,n=t.key,r=t.attribute,l=t.value,i=JSON.parse(JSON.stringify(e));switch(a){case"OVERWRITE":return[...l];case"ADD_INSTANCE":return[...e,JSON.parse(JSON.stringify(ll))];case"DELETE_INSTANCE":return i.splice(n,1),[...i];case"UPDATE_DETAILS":if(i[n].moms[r]=l,"feature_type"===r){const e=l.instances,t=l.alerts,a=e.map(e=>({value:e.instance_id,label:le(e.feature_name)}));a.push({value:0,label:"(Add new instance)"});const r=t.map(e=>{const t=e.feature_alert_id,a=e.alert_level,n=e.description;return{value:l,feature_alert_id:t,label:a,description:n}}),c=i[n],o=c.moms,s=c.options;i[n].options=Object(p.a)(Object(p.a)({},s),{},{feature_name:{options:a,disabled:!1},alert_level:{options:r,disabled:!1}}),i[n].moms=Object(p.a)(Object(p.a)({},o),{},{feature_name:null,alert_level:null})}return[...i];default:return e}}var cl=Object(j.a)((function(e){return{form_message_style:{color:"red",fontStyle:"italic"}}}));var ol=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.match,s=cl(),m=Object(n.useContext)(Ca).sites,u=Object(n.useState)(null),d=Object(o.a)(u,2),g=d[0],f=d[1],E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],_=v[1],j=Object(n.useState)(!0),x=Object(o.a)(j,2),S=x[0],C=x[1],D=Object(n.useReducer)(il,[]),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(!1),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(""),H=Object(o.a)(R,2),B=H[0],P=H[1];Object(n.useEffect)((function(){if("undefined"!==typeof i){var e=i.params.site_code;C(!1),_(e)}}),[i]),Object(n.useEffect)((function(){var e=m.find((function(e){return e.site_code===h}));e&&f({value:e.site_id,data:e})}),[m,h]);var L=Object(c.b)(),F=L.enqueueSnackbar,U=L.closeSnackbar,q=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){U(e)}},"Dismiss")},W=Object(n.useState)([]),z=Object(o.a)(W,2),G=z[0],V=z[1];return Object(n.useEffect)((function(){null!==g&&function(e,t){const a="".concat(te.b,"/api/manifestations_of_movement/get_moms_features/").concat(e);ne.a.get(a).then(e=>{const a=e.data;console.log("MOMs Features",a),t(a)}).catch(e=>{console.error(e)})}(g.data.site_code,(function(e){var t=e.map((function(e){var t=e.feature_id,a=e.feature_type,n=e.instances,r=e.alerts;return{value:t,label:le(a),instances:n,alerts:r}}));V(Object(p.a)(Object(p.a)({},G),{},{feature_type:t}));var a=ll;a.options.feature_type=t,I({action:"OVERWRITE",value:[a]})}))}),[g]),Object(n.useEffect)((function(){var e=function(e){var t,a=!1,n=!1,r=new Set,l=[],i=[],c="";return e.forEach((function(e,t){var c=e.moms,o=c.alert_level,s=c.feature_type,m=c.narrative,u=c.observance_ts,d=c.remarks,p=c.reporter,b=c.validator,g=c.feature_name,f=c.location,E=$()(u).format("YYYY-MM-DD HH:mm:00");null!==s&&(9===s.value&&(g="value"));if(null!==g){var v=g.value;l.includes(v)?!1===a&&(a=!0):l.push(v),0===v?void 0===f&&(f=""):f="value"}!0!==a&&"Invalid date"===E||(i.includes(E)?!1===n&&(n=!0):i.push(E)),null===s&&r.add("feature type"),null===g&&r.add("feature name"),""===f&&r.add("location"),null===o&&r.add("alert level"),null===u&&r.add("observance timestamp"),""===m&&r.add("narrative"),""===p&&r.add("reporter"),""===d&&r.add("remarks"),""===b&&r.add("validator")})),r=Object(ye.a)(r),!1===a&&(n=!1),0!==r.length||!0===n?(t=!0,c="Please input ".concat(r.join(", ")," form(s). "),n&&(c+="Duplicate observance time for the same feature instance.")):t=!1,{button_state:t,form_messsage:c}}(w),t=e.button_state,a=e.form_messsage;Y(t),P(a)}),[w]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Insert Manifestation of Movement Data Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Provide manifestation of movement (MOMs) details to save information in our database."),r.a.createElement(rl,{momsEntries:w,setMomsEntries:I,site:g,setSite:f,selectSite:S})),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12,sm:8,align:"center"},r.a.createElement(O.a,{variant:"caption",className:s.form_message_style,gutterBottom:!0},B)),r.a.createElement(y.a,{item:!0,xs:12,sm:4,align:"right"},r.a.createElement(b.a,{onClick:l,color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:function(){console.log("moms_entries",w);var e=w.map((function(e,t){var a=e.moms,n=a.alert_level,r=a.feature_name,l=a.feature_type,i=a.narrative,c=a.observance_ts,o=a.remarks,s=a.reporter,m=a.validator,u=a.location,d=$()(c).format("YYYY-MM-DD HH:mm:00"),p=Object(k.a)(),b=l.label,g="None",f=null;if("None"!==b){var E=r.value,v=r.label;g="(Add new instance)"===v?null:v,f=E}return{alert_level:n.label,instance_id:f,feature_name:g,feature_type:b,report_narrative:i,observance_ts:d,remarks:o,reporter_id:s,validator_id:m,location:u,iomp:p.user_id}})),t=g.data.site_code,a={moms_list:e,site_code:t};console.log("PAYLOAD",a),l(),function(e,t,a){const n="".concat(te.b,"/api/manifestations_of_movement/write_monitoring_moms_to_db");console.log("moms_list",e),ne.a.post(n,e).then(e=>{const a=e.data;null!==t&&(console.log("Moms Insert result",a),t(a))}).catch(e=>{console.log(e),null!==a&&a(e)})}(a,(function(e){var a="MOMs input success!",n="success";e.status?Ie("run_alert_generation",{site_code:t}):(a=e.message,n="error");F(a,{variant:n,autoHideDuration:7e3,action:q})}),(function(){F("Error MOMS input...",{variant:"error",autoHideDuration:7e3,action:q})}))},color:"primary",disabled:N},"Submit")))))}));function sl(e,t){me("".concat(te.b,"/api/analysis/get_earthquake_events_within_one_day"),e,t)}var ml=function(e){var t=e.selectSite,a=e.site,l=e.setSite,i=e.alertLevel,c=e.setAlertLevel,o=e.requestTs,s=e.setRequestTs,m=e.reason,u=e.setReason,d=e.reporter,p=e.setReporter,b=e.techInfo,g=e.setTechInfo,E=e.loading,v=e.hasOnDemand,h=e.isEq,_=e.setIsEq,O=e.earthquakeEvents,j=e.setEarthquakeEvents,k=e.earthquakeId,S=e.setEarthquakeId,C=e.approvedBy,D=e.setApprovedBy;return Object(n.useEffect)((function(){sl({start_ts:$()().format("YYYY-MM-DD HH:mm:ss"),end_ts:$()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss")},(function(e){console.log(e),j(e)}))}),[]),r.a.createElement(n.Fragment,null,t&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(wa,{value:a,changeHandler:function(e){return l(e)}})),E&&r.a.createElement(y.a,{container:!0,justify:"center"},r.a.createElement(x.a,null)),null!==a&&!E&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:12,md:6,lg:6},r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex",marginTop:16}},r.a.createElement(Xt.a,{component:"legend",style:{textAlign:"center",marginBottom:8}},"Choose alert level"),r.a.createElement(At.a,{"aria-label":"choose_alert_level",name:"choose_alert_level",value:i,onChange:function(e){var t=e.target.value;c(t),"0"===t&&g("")},row:!0,style:{justifyContent:"space-around"}},r.a.createElement(wt.a,{value:"1",control:r.a.createElement(It.a,{color:"primary"}),label:"Raise/Extend (d1)",key:"d1"}),v&&r.a.createElement(wt.a,{value:"0",control:r.a.createElement(It.a,{color:"primary"}),label:"Lower/End (d)",key:"d"})))),r.a.createElement(y.a,{item:!0,xs:12,sm:12,md:6,lg:6,style:{alignSelf:"center",textAlign:"center"}},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:h,onChange:function(e){var t=e.target.checked;_(t)}}),label:"Is Earthquake?"}))),h&&r.a.createElement(y.a,{item:!0,xs:12,sm:12,md:12,lg:12,style:{alignSelf:"center",textAlign:"center"}},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"eq-event-select-label"},"Earthquake Event"),r.a.createElement(Na.a,{labelId:"eq-event-select-standard-label",id:"eq-event-select-standard",value:k,onChange:function(e){return S(e.target.value)},label:"Intensity"},r.a.createElement(P.a,{value:"0"},r.a.createElement("em",null,"None")),O.length>0&&O.map((function(e,t){var a=e.magnitude,n=e.ts,l=e.province,i=e.eq_id,c=$()(n).format("YYYY-MM-DD HH:mm");return r.a.createElement(P.a,{value:"".concat(i),key:t},c," | ",l,", Magnitude ",parseFloat(a))}))))),r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp",value:o,onChange:function(e){return s(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),"1"===i&&r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Technical Information",multiline:!0,rowsMax:"2",placeholder:"This will appear on the EWI bulletin",value:b,onChange:function(e){return g(e.target.value)},fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(f.a,{label:"Reason",multiline:!0,rowsMax:"2",placeholder:"Enter reason (will appear on timeline)",value:m,onChange:function(e){return u(e.target.value)},fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(tr,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:function(e){return p(e.target.value)},value:d,isCommunityStaff:"true",site_code:a.data.site_code,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"approved-by-label"},"Approved by *"),r.a.createElement(Na.a,{labelId:"approved-by",id:"approved-by",value:C,onChange:function(e){return D(e.target.value)},label:"Approved by"},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),[{acronym:"RUS",full_name:"Renato U. Solidum, Jr."},{acronym:"TCB",full_name:"Teresito C. Bacolcol"},{acronym:"ASD",full_name:"Arturo S. Daag"},{acronym:"RANK",full_name:"Roy Albert N. Kaimo"}].map((function(e,t){var a=e.acronym,n=e.full_name;return r.a.createElement(P.a,{value:"".concat(a),key:t},n)}))))))))};var ul=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.match,s=Object(n.useContext)(Ca).sites,m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(!0),_=Object(o.a)(h,2),y=_[0],O=_[1],j=Object(n.useState)(!1),x=Object(o.a)(j,2),k=x[0],S=x[1],C=Object(n.useState)(""),D=Object(o.a)(C,2),A=D[0],w=D[1],I=Object(n.useState)("1"),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)(null),R=Object(o.a)(Y,2),H=R[0],B=R[1],P=Object(n.useState)(""),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)(""),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)(!1),X=Object(o.a)(J,2),ee=X[0],ae=X[1],re=Object(n.useState)(!1),le=Object(o.a)(re,2),ie=le[0],ce=le[1],oe=Object(n.useState)([]),se=Object(o.a)(oe,2),me=se[0],de=se[1],pe=Object(n.useState)(0),be=Object(o.a)(pe,2),ge=be[0],fe=be[1],Ee=Object(n.useState)(""),ve=Object(o.a)(Ee,2),he=ve[0],_e=ve[1];Object(n.useEffect)((function(){if("undefined"!==typeof i){var e=i.params.site_code;O(!1),v(e)}}),[i]),Object(n.useEffect)((function(){var e=s.find((function(e){return e.site_code===E}));e&&p({value:e.site_id,data:e})}),[s,E]),Object(n.useEffect)((function(){var e,t;G(""),d&&(K(!0),e=d.value,t=function(e){ae(e.has_on_demand),K(!1)},ue("".concat(te.b,"/api/monitoring/check_if_current_site_event_has_on_demand/").concat(e),t))}),[d]);var ye=Object(c.b)(),Ce=ye.enqueueSnackbar,De=ye.closeSnackbar,Ae=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){De(e)}},"Dismiss")};return Object(n.useEffect)((function(){var e=null===H||""===F||""===z||""===he;"1"===T&&(e=e||""===A),ie&&(e=e||0===ge),S(e)}),[H,F,z,A,T,he]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Insert On-Demand Data Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Provide on demand details to save information in our database."),r.a.createElement(ml,{site:d,setSite:p,selectSite:y,alertLevel:T,setAlertLevel:N,setRequestTs:B,setReason:U,setReporter:G,setTechInfo:w,reason:F,requestTs:H,reporter:z,tecchInfo:A,loading:Z,hasOnDemand:ee,isEq:ie,setIsEq:ce,earthquakeEvents:me,setEarthquakeEvents:de,earthquakeId:ge,setEarthquakeId:fe,approvedBy:he,setApprovedBy:_e})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:l,color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:function(){l();var e={tech_info:A,alert_level:T,reason:F,reporter_id:z,request_ts:$()(H).format("YYYY-MM-DD HH:mm:ss"),site_id:d.value,eq_id:0===parseInt(ge)?null:parseInt(ge),approved_by:he};console.log(e),function(e,t){var a="".concat(te.b,"/api/monitoring/save_on_demand_data");ne.a.post(a,e).then((function(e){var a=e.data;null!==t&&(console.log("On Demand Insert result",a),t(a))})).catch((function(e){console.log(e)}))}(e,(function(e){var t=e.status,a=e.message,n="success";t?(p(null),v(null),O(!0),S(!1),w(""),N("1"),B(null),U(""),G(""),ce(!1),de([]),fe(0),_e(""),Ie("run_alert_generation",{site_code:d.data.site_code})):n="error",Ce(a,{variant:n,autoHideDuration:4e3,action:Ae})}))},color:"primary",disabled:k},"Submit")))}));var dl=function(e){var t=e.site,a=e.setSite,l=e.selectSite,i=e.reporter,c=e.setReporter,s=e.remarks,m=e.intensity,u=e.setRemarks,d=e.setEqEvent,p=e.setIntensity,b=e.alertsFromDbData,g=e.eqId,E=e.setEqId,v=e.tsFelt,h=e.setTsFelt,_=Object(n.useState)([]),O=Object(o.a)(_,2),j=O[0],x=O[1];return Object(n.useEffect)((function(){if(null!==t){var e=t.value,a=b.latest,n=b.overdue,r=[];a.map((function(e,t){r.push(e)})),n.map((function(e,t){r.push(e)})),function(e){var t="".concat(te.b,"/api/analysis/get_earthquake_alerts");ne.a.get(t).then((function(t){var a=t.data;console.log("EQ Alerts",a),e(a)})).catch((function(e){console.error(e)}))}((function(t){console.log(t);var a=t.data,n=[],l=[];a.map((function(t,a){var i=t.eq_alerts.filter((function(t){return t.site_id===e}));if(i.length>0&&!l.includes(e)){var c;(c=r.filter((function(t){return t.event.site_id===e}))).length>0&&(l.push(e),t.eq_alerts=i[0],t.event_id=c[0].event.event_id,n.push(t))}return n})),sl({start_ts:$()().format("YYYY-MM-DD HH:mm:ss"),end_ts:$()().subtract(1,"days").format("YYYY-MM-DD HH:mm:ss")},(function(e){e.map((function(e,t){var a=e.eq_id;0===r.filter((function(e){return e.eq_id===a})).length&&n.push(e)})),x(n)}))}))}}),[t]),r.a.createElement(n.Fragment,null,l&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(wa,{value:t,changeHandler:function(e){return a(e)}})),null!==t&&r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,lg:12,md:12,sm:12,xs:12},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"eq-event-select-label"},"Earthquake Event"),r.a.createElement(Na.a,{labelId:"eq-event-select-standard-label",id:"eq-event-select-standard",value:g,onChange:function(e){var t=e.target.value;E(t),d(j.filter((function(e){return e.event_id===t})))},label:"Intensity"},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),j.length>0&&j.map((function(e,t){var a=e.eq_id,n=e.magnitude,l=e.ts,i=e.province,c=$()(l).format("YYYY-MM-DD HH:mm");return r.a.createElement(P.a,{value:"".concat(a),key:t},c," | ",i,", Magnitude ",parseFloat(n))}))))),r.a.createElement(y.a,{item:!0,lg:6,md:6,sm:12,xs:12},r.a.createElement(tr,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:function(e){return c(e.target.value)},value:i,isCommunityStaff:"true",site_code:t.data.site_code})),r.a.createElement(y.a,{item:!0,lg:6,md:6,sm:12,xs:12},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"demo-simple-select-label"},"Intensity"),r.a.createElement(Na.a,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",value:m,onChange:function(e){p(e.target.value)},label:"Intensity"},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),r.a.createElement(P.a,{value:"I"},"Intensity I"),r.a.createElement(P.a,{value:"II"},"Intensity II"),r.a.createElement(P.a,{value:"III"},"Intensity III"),r.a.createElement(P.a,{value:"IV"},"Intensity IV"),r.a.createElement(P.a,{value:"V"},"Intensity V"),r.a.createElement(P.a,{value:"VI"},"Intensity VI"),r.a.createElement(P.a,{value:"VII"},"Intensity VII"),r.a.createElement(P.a,{value:"VIII"},"Intensity VIII"),r.a.createElement(P.a,{value:"IX"},"Intensity IX"),r.a.createElement(P.a,{value:"X"},"Intensity X")))),r.a.createElement(y.a,{item:!0,lg:6,md:6,sm:12,xs:12},r.a.createElement(f.a,{id:"remarks",label:"Remarks",fullWidth:!0,multiline:!0,value:s,onChange:function(e){u(e.target.value)},variant:"standard"})),r.a.createElement(y.a,{item:!0,lg:6,md:6,sm:12,xs:12},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp Felt",value:v,onChange:function(e){h(e),console.log(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})))))};var pl=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.match,s=Object(n.useContext)(Ca).sites,m=Object(n.useContext)(Te).alertsFromDbData,u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],g=d[1],f=Object(n.useState)(null),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)(!0),y=Object(o.a)(_,2),O=y[0],j=y[1],x=Object(n.useState)(""),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(""),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)([]),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)(""),B=Object(o.a)(H,2),P=B[0],L=B[1],F=Object(n.useState)(!0),U=Object(o.a)(F,2),q=U[0],W=U[1],z=Object(n.useState)([]),G=Object(o.a)(z,2),V=G[0],Q=G[1],Z=Object(k.a)().user_id,K=Object(n.useState)($()().format("YYYY-MM-DD HH:mm:ss")),J=Object(o.a)(K,2),X=J[0],ee=J[1];Object(n.useEffect)((function(){if("undefined"!==typeof i){var e=i.params.site_code;j(!1),h(e)}}),[i]),Object(n.useEffect)((function(){var e=s.find((function(e){return e.site_code===v}));e&&g({value:e.site_id,data:e})}),[s,v]);var ae=Object(c.b)(),re=ae.enqueueSnackbar,le=ae.closeSnackbar,ie=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){le(e)}},"Dismiss")};return Object(n.useEffect)((function(){W(null===p||""===V||""===I||""===P)}),[p,V,P,I]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Insert Earthquake Intensity Data Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Provide earthquake intensity details to save information in our database."),r.a.createElement(dl,{site:p,setSite:g,selectSite:O,setReporter:M,reporter:I,remarks:C,eqEvent:Y,intensity:P,setRemarks:D,setEqEvent:R,setIntensity:L,alertsFromDbData:m,eqId:V,setEqId:Q,tsFelt:X,setTsFelt:ee})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:l,color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:function(){l(),function(e,t){var a="".concat(te.b,"/api/monitoring/save_earthquake_intensity");ne.a.post(a,e).then((function(e){var a=e.data;null!==t&&(console.log("EQ Intensity result",a),t(a))})).catch((function(e){console.log(e)}))}({eq_id:V,reporter_id:I,intensity:P,remarks:C,user_id:Z,site_id:p.value,ts_felt:$()(X).format("YYYY-MM-DD HH:mm:ss")},(function(e){var t=e.status,a=e.message,n="success";t?(g(null),h(null),j(!0),W(!1),D(""),R(""),L("")):n="error",re(a,{variant:n,autoHideDuration:4e3,action:ie})}))},color:"primary",disabled:q},"Submit")))})),bl=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{tabBar:Object(p.a)({},t.pageContentMargin),tabBarContent:{marginTop:30},speedDial:{position:"fixed","&.MuiSpeedDial-directionUp":{bottom:e.spacing(2),right:e.spacing(2)}}})})),gl=[{label:"Monitoring Tables",href:"monitoring-tables"},{label:"Generated Alerts",href:"generated-alerts"}];var fl=Object(Ge.a)()((function(e){var t,a,l=e.width,i=e.history,c=bl(),s=Object(n.useContext)(Te),m=s.generatedAlerts,u=s.candidateAlertsData,d=s.alertsFromDbData,p=Object(n.useState)(0),g=Object(o.a)(p,2),f=g[0],E=g[1],v=Object(n.useState)(!1),_=Object(o.a)(v,2),j=_[0],x=_[1],k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],D=S[1],A=Object(n.useState)(null),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)(!1),B=Object(o.a)(H,2),L=B[0],F=B[1],U=Object(n.useState)(!1),q=Object(o.a)(U,2),W=q[0],z=q[1],G=Object(n.useState)(!1),V=Object(o.a)(G,2),Z=V[0],K=V[1],J=function(e){return function(){return z(e)}},X=function(e){return function(){return K(e)}},$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=function(e,t){return function(){"is_open_release_modal"===e?x(t):"is_open_issues_modal"===e?(F(!t),R(t)):"is_routine_modal_open"===e&&D(t)}},re=function(e,t){return function(){M(e),"routine"===t?ne("is_routine_modal_open",!0)():ne("is_open_release_modal",!0)()}},le=Object(Ge.c)("md",l),ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=[{icon:r.a.createElement(at.a,null),name:"Release alert",action:re(null)},{icon:r.a.createElement(nt.a,null),name:"Insert MOMs",action:J(!0)},{icon:r.a.createElement(rt.a,null),name:"Insert On-demand entry",action:X(!0)},{icon:r.a.createElement(lt.a,null),name:"Add issue/reminder",action:ne("is_open_issues_modal",!0)}],ue=r.a.useRef(null),de=Object(n.useState)(!1),pe=Object(o.a)(de,2),be=pe[0],ge=pe[1],fe=r.a.createElement("span",null,r.a.createElement(b.a,{"aria-label":"Add issue/reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:ne("is_open_issues_modal",!0),startIcon:r.a.createElement(lt.a,null)},"Add issue/reminder"),r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small","aria-label":"select merge strategy","aria-haspopup":"menu",ref:ue,onClick:function(){return ge(!0)},style:{marginRight:8},startIcon:r.a.createElement(it.a,null)},"Insert trigger data"),r.a.createElement(b.a,{"aria-label":"Release alert",variant:"contained",color:"primary",size:"small",onClick:re(null),startIcon:r.a.createElement(at.a,null)},"Release Alert"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:c.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Dashboard",customButtons:!!le&&fe})),r.a.createElement(Ue.a,{open:be,anchorEl:ue.current,role:void 0,transition:!0},(function(e){var t=e.TransitionProps,a=e.placement;return r.a.createElement(qe.a,Object.assign({},t,{style:{transformOrigin:"bottom"===a?"center top":"center bottom"}}),r.a.createElement(h.a,null,r.a.createElement(We.a,{onClickAway:function(){return ge(!1)}},r.a.createElement(ze.a,{id:"split-button-menu"},r.a.createElement(P.a,{onClick:function(){ge(!1),z(!0)}},"Insert MOMs"),r.a.createElement(P.a,{onClick:function(){ge(!1),K(!0)}},"Insert On-Demand"),r.a.createElement(P.a,{onClick:function(){ge(!1),ae(!0)}},"Insert Earthquake Intensity")))))})),r.a.createElement("div",{className:c.tabBar},r.a.createElement(y.a,{container:!0,spacing:3},r.a.createElement(y.a,{item:!0,xs:12,md:3},r.a.createElement(Xe.a,{smDown:!0},r.a.createElement(Zr,{isOpenIssueReminderModal:Y,setIsOpenIssueReminderModal:R,isIandRUpdateNeeded:L,setIsIandRUpdateNeeded:F})),r.a.createElement(Xe.a,{mdUp:!0},r.a.createElement($e.a,{defaultExpanded:!1},r.a.createElement(et.a,{expandIcon:r.a.createElement(ct.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},r.a.createElement(y.a,{container:!0,justify:"space-between",alignItems:"baseline"},r.a.createElement(O.a,{variant:"caption"},r.a.createElement("strong",null,"ISSUES AND REMINDERS")))),r.a.createElement(Q.a,null),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,justify:"space-evenly",className:c.details},r.a.createElement(Zr,{isOpenIssueReminderModal:Y,setIsOpenIssueReminderModal:R,isIandRUpdateNeeded:L,setIsIandRUpdateNeeded:F})))))),r.a.createElement(y.a,{item:!0,xs:12,md:9},r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(tl,null)),r.a.createElement(gt,{chosenTab:f,onSelect:function(e){E(e)},tabsArray:gl}),r.a.createElement("div",{className:c.tabBarContent},0===f&&r.a.createElement(sn,{width:l,candidateAlertsData:u,alertsFromDbData:d,releaseFormOpenHandler:re,history:i}),1===f&&r.a.createElement(pn,{generatedAlertsData:m}))))),!le&&r.a.createElement(ot.a,{ariaLabel:"SpeedDial example",className:c.speedDial,FabProps:{color:"secondary"},icon:r.a.createElement(st.a,null),onClose:function(){return se(!1)},onOpen:function(){return se(!0)},open:oe},me.map((function(e){return r.a.createElement(mt.a,{key:e.name,icon:e.icon,tooltipTitle:e.name,onClick:e.action})}))),r.a.createElement(Sn,null,r.a.createElement(yr,{isOpen:j,closeHandler:ne("is_open_release_modal",!1),chosenCandidateAlert:I,setChosenCandidateAlert:M,setIsOpenRoutineModal:(a=null,function(){M(a),ne("is_open_release_modal",!1)(),ne("is_routine_modal_open",!0)()}),generatedAlerts:m})),r.a.createElement(Mr,{isOpen:C,closeHandler:ne("is_routine_modal_open",!1),chosenCandidateAlert:I,setChosenCandidateAlert:M}),r.a.createElement(ol,{isOpen:W,closeHandler:J(!1)}),r.a.createElement(ul,{isOpen:Z,closeHandler:X(!1)}),r.a.createElement(pl,{isOpen:te,closeHandler:(t=!1,function(){return ae(t)})}))})),El=a(60),vl=a.n(El),hl=a(198),_l=a(1144),yl=a(267),Ol=a(1186),jl=a(1191),xl=Object(j.a)((function(e){return{timeline:{margin:"0 auto",lineColor:"#DDDDDD",paddingTop:24}}}));function kl(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.moms_details,l=n.moms_instance,i=l.feature.feature_type,c=l.feature_name,o=n.op_trigger,s=n.validator,m=s.first_name,u=s.last_name,d=n.reporter,p=d.first_name,b=d.last_name,g=n.narrative.narrative,f=n.remarks,E=n.moms_id,v=a?"Non-triggering ":"",h=r.a.createElement("ul",{key:E},r.a.createElement("li",null,v,"Feature: ",le(i)," ",c," (",t+o,")"),r.a.createElement("ul",null,r.a.createElement("li",null,"Narrative: ",g),r.a.createElement("li",null,"Reporter: ","".concat(p," ").concat(b)),r.a.createElement("li",null,"Remarks: ",f),r.a.createElement("li",null,"Validator: ","".concat(m," ").concat(u))));return h}function Sl(e,t,a,l){var i=[],c=0;return e.forEach((function(e){c+=1;var o=e.item_timestamp,s=e.item_data,m=e.item_type,u=null,d=$()(o).format("DD MMMM YYYY, hh:mm A");if("narrative"===m)u=r.a.createElement(yl.TimelineItem,{key:c,dateText:d,style:{color:"#969696"},dateComponent:r.a.createElement("div",{style:{display:"block",float:"right",padding:"10px",marginRight:38,background:"rgb(150, 150, 150)",color:"#fff"}},d)},r.a.createElement(O.a,{variant:"body2",component:"div"},s.narrative));else if("release"===m){s.release_time;var p=s.data_ts,g=s.release_publishers,f=s.triggers,E=s.is_onset,v=s.internal_alert_level,h=s.moms_releases,_=s.release_id,j=s.comments,x=e.release_type,k=function(e){var t="#F8991D";return"end_of_validity"===e?t="#00B200":"overdue"===e?t="#FA4413":"extended"===e?t="#00B200":"routine"===e&&(t="#59081E"),t}(x),S=function(e){var t="EARLY WARNING INFORMATION";return"end_of_validity"===e?t="END OF MONITORING":"overdue"===e?t="OVERDUE":"extended"===e?t="EXTENDED MONITORING":"routine"===e&&(t="ROUTINE MONITORING"),t}(x),C=$()(p);E||(C=C.add(30,"minutes")),C=C.format("MMMM Do YYYY, h:mm A");var D="",A="";g.forEach((function(e){var t=e.role,a=e.user_details,n=a.first_name,r=a.last_name;"mt"===t&&(D="".concat(n," ").concat(r)),"ct"===t&&(A="".concat(n," ").concat(r))})),u=r.a.createElement(yl.TimelineItem,{key:c,dateText:d,style:{color:k},dateInnerStyle:{background:k,lineHeight:"48px",textAlign:"center"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(Ol.a,{style:{color:k,height:45,width:"auto",paddingRight:8}},r.a.createElement(St.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(O.a,{variant:"caption",component:"div",style:{color:k}},r.a.createElement("strong",null,S)),r.a.createElement(O.a,{variant:"h6",component:"div",style:{color:k,lineHeight:1.2}},r.a.createElement("strong",null,C)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(O.a,{variant:"body2",style:{color:k}},"Data Timestamp: ",r.a.createElement("strong",null,p)),r.a.createElement(O.a,{variant:"body2",style:{color:k}},"Internal Alert Level: ",r.a.createElement("strong",null,v))),f.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",component:"div",style:{color:k}},r.a.createElement("strong",null,function(e){return r.a.createElement("ul",null,e.map((function(e){var t=e.ts,a=e.info,l=e.internal_sym,i=l.trigger_symbol,c=i.alert_symbol,o=i.trigger_hierarchy.trigger_source,s=l.alert_symbol,m=e.trigger_id,u="moms"===o?"Manifestation of Movement":le(o),d=r.a.createElement("li",null,"".concat(u," (").concat(c,") alert triggered on ").concat($()(t).format("MMMM Do YYYY, hh:mm A"))),p=r.a.createElement("ul",null,r.a.createElement("li",null,a)),b=[];if("moms"===o)e.trigger_misc.moms_releases.forEach((function(e){var t=kl(e,s);b.push(t)}));else if("on demand"===o){var g=e.trigger_misc.on_demand,f=g.narrative.narrative,E=g.approved_by;b.push(r.a.createElement("ul",{key:"od"},r.a.createElement("li",null,"Reason:"),r.a.createElement("ul",null,r.a.createElement("li",null,f)))),b.push(r.a.createElement("ul",{key:"od"},r.a.createElement("li",null,"Approved by: ",E||"--")))}return r.a.createElement(n.Fragment,{key:m},d,p,b.map((function(e){return e})))})))}(f))))),h.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",component:"div",style:{color:k}},r.a.createElement("strong",null,h.map((function(e){return kl(e,"m",!0)})))))),""!==j&&null!==j&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(O.a,{variant:"body2",style:{color:k}},"Comments: ",r.a.createElement("strong",null,j)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between",alignItems:"center"},r.a.createElement(O.a,{variant:"body2",style:{color:k}},D," | ",A),r.a.createElement(b.a,{"aria-label":"Show bulletin",variant:"text",color:"primary",size:"small",onClick:t({release_id:_,site_code:a,site_id:l})},"Bulletin"))))}else if("eos"===m){u=r.a.createElement(yl.TimelineItem,{key:c,dateText:d,style:{color:"#3f51b5"},dateInnerStyle:{background:"#3f51b5",lineHeight:"48px"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(Ol.a,{style:{color:"#3f51b5",height:45,width:"auto",paddingRight:8}},r.a.createElement(jl.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(O.a,{variant:"caption",component:"div",style:{color:"#3f51b5"}},r.a.createElement("strong",null,"END-OF-SHIFT-ANALYSIS")),r.a.createElement(O.a,{variant:"h6",component:"div",style:{color:"#3f51b5",lineHeight:1.2}},r.a.createElement("strong",null,$()(o).format("MMMM Do YYYY, h:mm A"))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",style:{color:"#3f51b5"},dangerouslySetInnerHTML:{__html:s}}))))}i.push(u)})),i}var Cl=function(e){var t=e.match.params.event_id,a=xl(),l=Object(n.useState)({event_id:t,site_code:"---",site_id:1,validity:$()(),event_start:$()(),site_address:"",status:1}),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],b=u[1],g=Object(n.useState)({}),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(!1),_=Object(o.a)(h,2),j=_[0],x=_[1];Object(n.useEffect)((function(){!function(e,t){const a=e.event_id,n="".concat(te.b,"/api/monitoring/get_event_timeline_data/").concat(a);ne.a.get(n).then(e=>{const a=e.data;console.log("Event details",a),t(a)}).catch(e=>{console.error("Problem in getEventTimelineEntries Axios request"),console.error(e)})}({event_id:t},(function(e){var t=e.event_details,a=e.timeline_items;Object.keys(t).length>0&&(s(t),b(a))}))}),[]);var k=1===c.status?"ROUTINE":"EVENT",S=$()(c.event_start).format("MMMM Do YYYY, hh:mm A"),C="PRESENT";return null!==c.validity&&(C=$()(c.validity).format("MMMM Do YYYY, hh:mm A")),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,k," MONITORING TIMELINE")),r.a.createElement(O.a,{variant:"h4",align:"center"},c.site_address," (",c.site_code.toUpperCase(),")"),r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"".concat(S," to ").concat(C))),r.a.createElement(yl.Timeline,{className:a.timeline,lineColor:"#DDDDDD"},Sl(d,(function(e){return function(t){console.log(e);var a=Object(p.a)(Object(p.a)({},e),{},{type:null});v(a),x(!0)}}),c.site_code,c.site_id)),r.a.createElement(Qt,{classes:a,isOpenBulletinModal:j,setIsOpenBulletinModal:x,releaseDetail:E}))},Dl=a(210),Al=a.n(Dl),wl=a(169),Il=a.n(wl);class Ml extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props,a=t.options,n=t.onSearch,r=a.onSearchChange;r&&r(e.target.value),n(e.target.value)},this.onKeyDown=e=>{const t=this.props,a=t.onHide,n=t.onSearchClick;27===e.keyCode?a():13===e.keyCode&&n()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(qe.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(f.a,{placeholder:"Search events using YYYY-MM-DD format...",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(R.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(Al.a,null)),r.a.createElement(R.a,{className:t.clearIcon,onClick:n},r.a.createElement(Il.a,null))))}}var Tl=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(Ml),Nl=Object(j.a)((function(e){return Object(p.a)(Object(p.a)({},Object(_e.d)(e)),{},{eventTable:{minWidth:"900px"}})}));var Yl=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Rl=Object(Ge.a)()((function(e){var t=e.width,a=e.location,l=e.match.url,i=Nl(),c=Object(n.useState)([["Loading Data..."]]),d=Object(o.a)(c,2),b=d[0],g=d[1],f=Object(n.useState)(0),E=Object(o.a)(f,2),v=E[0],_=E[1],y=Object(n.useState)(10),j=Object(o.a)(y,2),k=j[0],S=j[1],C=Object(n.useState)(1),D=Object(o.a)(C,2),A=D[0],w=D[1],I=Object(n.useState)(!1),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)({}),R=Object(o.a)(Y,2),H=R[0],B=R[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)([]),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(""),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),X=Object(o.a)(J,2),ee=X[0],ae=X[1],le=Object(n.useState)(!1),ie=Object(o.a)(le,2),ce=ie[0],oe=ie[1],se=Object(n.useContext)(Ca).sites;Object(n.useEffect)((function(){var e={},t=[];se.forEach((function(a){var n=re(a,!0,"start"),r=a.site_code.toUpperCase();t.push(r),e[r]={site_id:a.site_id,address:n}})),ae(t),B(e)}),[se]),Object(n.useEffect)((function(){N(!0),function(e,t){const a=e.limit,n=e.offset,r=e.include_count,l=e.filters,i=e.search_str;let c="".concat(te.b,"/api/monitoring/get_monitoring_events?filter_type=complete&offset=").concat(n,"&limit=").concat(a);if(r&&(c+="&include_count=true"),l.length>0){c+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(c+="&search=".concat(i)),ne.a.get(c).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({include_count:!0,limit:v*k+k,offset:v*k,filters:F,search_str:Z},(function(e){var t=e.events,a=e.count,n=function(e,t){return e.map((function(e,a){var n=e.event_id,r=e.site_code,l=e.entry_type,i=e.event_start,c=e.validity,o=e.public_alert,s=null,m="ROUTINE";""!==i&&null!==i&&(s=$()(i).format("D MMMM YYYY, HH:mm")),""!==c&&null!==c&&(m=$()(c).format("D MMMM YYYY, HH:mm"));var u="";Object.keys(t).length&&(u=t[r.toUpperCase()].address);return[n,u,l,o,s,m]}))}(t,H);g(n),w(a),N(!1)}))}),[v,k,F,Z,l,H]);var me={textLabels:{body:{noMatch:"No data"}},filterType:"multiselect",responsive:Object(Ge.c)(t,"xs")?"standard":"simple",searchText:Z,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:k,count:A,page:v,filter:!0,selectableRows:"none",print:!1,download:!1,serverSide:!0,onTableChange:function(e,t){if("changePage"===e){var a=t.page;_(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==k&&S(n)}else"resetFilters"===e?(G({}),U([])):"onSearchOpen"===e&&oe(!0)},onSearchChange:function(e){console.log("Searching for ".concat(e))},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){var r=null;if(0!==e.length){n=!1;var l=ue[t].name;if("site_name"===l){var i=[],c=[];e.forEach((function(e){i.push(H[e].site_id),c.push(e)})),a.push({name:"site_ids",data:i}),r=c}else if("entry_type"===l){var o,m=[],u=[];e.forEach((function(e){"EVENT"===e?o=2:"ROUTINE"===e&&(o=1),m.push(e),u.push(o)})),a.push({name:"entry_types",data:u}),r=m}G(Object(p.a)(Object(p.a)({},z),{},Object(s.a)({},l,r)))}})),n&&G({}),U(a)},customSearchRender:function(e,t,a,n){var l=e||"";ce&&(l=Z,oe(!1));return r.a.createElement(Tl,{searchText:e,onSearch:t,onHide:function(){a(),oe(!1)},options:n,onSearchClick:function(){return K(l)}})}},ue=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:function(e,t){t.rowIndex;return"Loading Data..."===e?e:function(e,t){return r.a.createElement(m.b,{to:"".concat(e,"/").concat(t)},t)}(l,e)}}},{name:"site_name",label:"Site",options:{filter:!0,filterList:"undefined"===typeof z.site_name?[]:z.site_name,filterOptions:{names:ee}}},{name:"entry_type",label:"Entry Type",options:{filter:!0,filterList:"undefined"===typeof z.entry_type?[]:z.entry_type,filterOptions:{names:["ROUTINE","EVENT"]},sort:!1}},{name:"public_alert",label:"Last Alert Level",options:{filter:!0,sort:!0}},{name:"ts_start",label:"Event Start",options:{filter:!1,sort:!1}},{name:"ts_end",label:"Event End",options:{filter:!1,sort:!1}}];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Events"})),r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(u.d,{location:a},r.a.createElement(u.b,{exact:!0,path:l,render:function(e){return r.a.createElement(h.a,{className:i.paperContainer},r.a.createElement(_l.a,{theme:Yl},r.a.createElement(vl.a,{title:r.a.createElement(O.a,{variant:"h5",component:"div"},"Monitoring Events Table",T&&r.a.createElement(x.a,{size:24,style:{marginLeft:15,position:"relative",top:4}})),data:b,columns:ue,options:me})))}}),r.a.createElement(u.b,{path:"".concat(l,"/:event_id"),render:function(e){return r.a.createElement(Cl,Object.assign({},e,{width:t}))}}))))})),Hl=a(1199),Bl=a(1198),Pl=a(1192),Ll=a(1193),Fl=a(1194),Ul=a(1195),ql=a(1196),Wl=a(262),zl=a.n(Wl);a(598);const Gl={toolbar:[["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],["clean"]],clipboard:{matchVisual:!1}},Vl=["bold","italic","underline","strike","blockquote","list","bullet","indent","link"],Ql=Object(j.a)(e=>({root:{width:"100%"},icons:{fontSize:"1.15rem",[e.breakpoints.down("xs")]:{fontSize:"1.7rem"}},details:{alignItems:"center"},column:{flexBasis:"33.33%",display:"flex",alignItems:"center"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},sent:{backgroundColor:"#04d811"}}));function Zl(e){return Object.keys(e).filter(t=>!0===e[t])}function Kl(e){const t=e.shiftSummary,a=e.dataAnalysis,n=e.shiftNarratives,r=t.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),l=a.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>"),i=n.replace(/<p>/g,"").replace(/<\/p>/g,"<br/>");return"<p>".concat(r,"</p><br/><p>").concat(l,"</p><br/><p>").concat(i,"</p>")}var Jl=function(e){const t=e.data,a=e.shiftStartTs,l=e.currentUser,i=Ql(),s=t.site_code,m=t.eos_head,u=t.shift_start_info,d=t.shift_end_info,g=t.data_analysis,f=t.narratives,E=t.event_id,v=t.validity,_="".concat(m,"<br/>").concat(u,"<br/><br/>").concat(d),j=Object(n.useState)(_),k=Object(o.a)(j,2),S=k[0],C=k[1],D=Object(n.useState)(g),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(g.length),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(f),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(c.b)(),F=L.enqueueSnackbar,U=L.closeSnackbar,q=Object(n.useState)([]),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(!1),Z=Object(o.a)(V,2),K=Z[0],J=Z[1],X={rainfall:!1,surficial:!1},ee=[["rainfall","Rainfall",!1]],ae=t.has_markers,re=t.has_surficial_data,le=t.subsurface_columns;let ie="Surficial",ce=!1;ae?re||(ie+=" (No data)",ce=!0):(ie+=" (No markers)",ce=!0),ee.push(["surficial",ie,ce]),le.forEach(e=>{const t=e.logger.logger_name,a="subsurface_".concat(t);let n="Subsurface - ".concat(t.toUpperCase());X[a]=!1;const r=!e.has_data;r&&(n+=" (No data)"),ee.push([a,n,r])});const oe=Object(n.useState)(X),se=Object(o.a)(oe,2),ue=se[0],de=se[1],pe=ee.map(e=>({state:ue[e[0]],value:e[0],label:e[1],is_disabled:e[2]})),be=Object(n.useState)(!1),ge=Object(o.a)(be,2),fe=ge[0],Ee=ge[1],ve=Object(n.useState)(null),he=Object(o.a)(ve,2),_e=he[0],ye=he[1],Oe=Object(n.useState)(null),je=Object(o.a)(Oe,2),xe=je[0],ke=je[1];Object(n.useEffect)(()=>{if(fe){null!==_e&&clearTimeout(_e),ke("typing");const e=setTimeout(()=>{ke("saving");const e=setTimeout(()=>{var e,t;e={shift_ts:a,event_id:E,dataAnalysis:w},t=e=>{console.log("response",e),ke("saved"),Ee(!1)},me("".concat(te.b,"/api/end_of_shift/save_eos_data_analysis"),e,t)},3e3);ye(e)},3e3);ye(e)}},[w]);const Se=$()(a).add(12,"hours"),Ce=$()(v),De=Ce.isBefore(Se)?Ce.subtract(30,"minutes").format("YYYY-MM-DD HH:mm:ss"):$()(Se).format("YYYY-MM-DD HH:mm:ss"),Ae=window.location,we=Ae.host,Ie=Ae.protocol,Me="".concat(Ie,"//").concat(we,"/chart_rendering/").concat(s,"/").concat(De),Te=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{U(e)}},"Dismiss"),Ne=e=>()=>{const t=z;t.splice(e,1),G([...t])},Ye=[{label:"Shift Summary",value:S,key:"shift_summary",updateFn:C},{label:"Data Analysis",value:w,key:"data_analysis",updateFn:I}],Re=N>3e3;return r.a.createElement($e.a,null,r.a.createElement(et.a,{expandIcon:r.a.createElement(Jr.a,null),className:K?i.sent:""},r.a.createElement("div",{className:i.column},r.a.createElement(O.a,{variant:"body1"},s.toUpperCase())),r.a.createElement("div",{className:i.column},r.a.createElement(O.a,{variant:"body1"},"Shift Report")),K&&r.a.createElement("div",{className:i.column,style:{justifyContent:"flex-end"}},r.a.createElement(ba.a,{label:"Sent",color:"secondary"}))),r.a.createElement(Q.a,null),r.a.createElement(tt.a,{className:i.details},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:12}},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Charts"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,justify:"space-around"},r.a.createElement(za,{label:"Data Sources",changeHandler:e=>t=>{const a=t.target.checked;if(de(Object(p.a)(Object(p.a)({},ue),{},{[e]:a})),a){let t=e;["surficial","rainfall"].includes(e)||(t=e.replace("_","/")),window.open("".concat(Me,"/").concat(t),"_blank")}},choices:pe,checkboxStyle:"primary"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Attachments"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(h.a,{square:!0,style:{padding:"8px 12px",marginBottom:12,background:"gainsboro",border:"4px solid #CCCCCC"}},z.length>0?z.map((e,t)=>r.a.createElement(ba.a,{key:e.name,label:e.name,onDelete:Ne(t),color:"primary"})):r.a.createElement(O.a,{variant:"body2"},r.a.createElement("i",null,"None")))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end"},r.a.createElement("input",{className:i.input,style:{display:"none"},multiple:!0,type:"file",onChange:e=>{const t=e.target.files;for(let a=0;a<t.length;a+=1){const e=t.item(a);z.some(t=>t.name===e.name)||z.push(e)}G([...z])},onClick:e=>{e.target.value=null},id:"input-file-".concat(s)}),r.a.createElement("label",{htmlFor:"input-file-".concat(s)},r.a.createElement(b.a,{startIcon:r.a.createElement(Pl.a,null),variant:"contained",component:"span",color:"primary",size:"small"},z.length>0?"Add more":"Attach File")))),Ye.map(({label:e,value:t,key:a,updateFn:l})=>r.a.createElement(n.Fragment,{key:a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,e))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(zl.a,{onChange:t=>{"Data Analysis"===e&&(Y(t.length),null!==_e?Ee(!0):ye(1)),l(t)},defaultValue:t,modules:Gl,formats:Vl})),"Data Analysis"===e&&r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",style:{color:Re?"red":"black"}},r.a.createElement(vt.a,{title:"Content of text area is formatted on the background using HTML. HTML elements are included in the character count.",placement:"top",interactive:!0,arrow:!0},r.a.createElement("div",null,r.a.createElement(Ll.a,{color:"primary",fontSize:"small"}),"\xa0")),r.a.createElement(O.a,{variant:"caption"},r.a.createElement("strong",null,"Character count (including HTML): ",N,"/3000")),null!==xe&&r.a.createElement(O.a,{variant:"caption",component:"div",style:{marginLeft:24,display:"flex",alignItems:"center",color:["typing","saving"].includes(xe)?"orange":"green"}},r.a.createElement("div",{style:{marginRight:6}},r.a.createElement("strong",null,xe.toUpperCase())),["typing","saving"].includes(xe)?r.a.createElement(x.a,{size:20}):r.a.createElement(qa.a,null))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Shift Narratives ")),r.a.createElement(O.a,{variant:"body2"},r.a.createElement("i",null,"NOTE: It is recommended NOT to add narratives via this text box. Use Site Logs Form instead then click Refresh."))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(zl.a,{onChange:e=>P(e),value:B,defaultValue:B,modules:Gl,formats:Vl,bounds:".app"})))),r.a.createElement(Q.a,null),r.a.createElement(Et.a,null,r.a.createElement(b.a,{size:"small",onClick:()=>{const e=Zl(ue);!function(e,t){const a="".concat(te.b,"/api/end_of_shift/download_eos_charts");ne.a.post(a,e,{responseType:"blob"}).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({site_code:s,user_id:l.user_id,charts:e,file_name:"".concat(s,"_chart.pdf")},e=>{if(!1===e.status){const t=e.file_response.message;F(t,{variant:"error",autoHideDuration:7e3,action:Te})}else{F("Download success!",{variant:"success",autoHideDuration:7e3,action:Te});const t=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=t,a.setAttribute("download","".concat(s,"_chart.pdf")),document.body.appendChild(a),a.click()}})},startIcon:r.a.createElement(Fl.a,null)},"Download Charts"),r.a.createElement(b.a,{size:"small",startIcon:r.a.createElement(Ul.a,null),onClick:()=>{!function(e,t){const a=e.shift_ts,n=e.event_id,r="".concat(te.b,"/api/end_of_shift/get_narrative/").concat(a,"/").concat(n);ne.a.get(r).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}({shift_ts:a,event_id:E},e=>{console.log(e),P(e)})}},"Refresh Narratives"),r.a.createElement(b.a,{size:"small",color:"primary",startIcon:r.a.createElement(ql.a,null),onClick:()=>{const e=F("Sending End-of-Shift Report for ".concat(s.toUpperCase(),"..."),{variant:"warning",persist:!0}),t=new FormData,n=$()(De).add(30,"minutes").format("YYYY-MM-DD HH:mm:ss");Zl(ue).forEach(e=>t.append("charts",e)),z.forEach(e=>{t.append("attached_files",e)});const r={shift_ts:a,event_id:E,data_analysis:w,file_name_ts:n,mail_body:Kl({shiftSummary:S,dataAnalysis:w,shiftNarratives:B}),site_code:s,user_id:l.user_id};for(const a in r)r.hasOwnProperty(a)&&t.append(a,r[a]);var i,c,o;i=t,c=t=>{U(e),console.log(t);let a="Error sending End-of-Shift Report for ".concat(s.toUpperCase(),"..."),n="error";"Success"===t&&(a="End-of-Shift Report for ".concat(s.toUpperCase()," sent!"),n="success",J(!0)),F(a,{variant:n,autoHideDuration:7e3,action:Te})},o=()=>{U(e),F("Error sending End-of-Shift Report for ".concat(s.toUpperCase(),"..."),{variant:"error",autoHideDuration:7e3,action:Te})},me("".concat(te.b,"/api/mailbox/send_eos_email"),i,c,o)},disabled:Re},"Send")))},Xl=a(1197);function $l(e){const t=e.selectedSites,a=e.setSelectedSites,n=e.site_code,r=e.checkAll,l=t;if(l.includes(n)){if(!r){const e=l.indexOf(n);l.splice(e,1)}}else l.push(n);a([...l])}var ei=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.closeHandler,i=e.eosData,c=e.setSelectedEosData,s=e.setModalOpen,m=e.setEosData,u=Object(n.useState)([]),d=Object(o.a)(u,2),p=d[0],g=d[1],f=Object(n.useState)(!0),E=Object(o.a)(f,2),v=E[0],h=E[1],j=e=>t=>{$l({selectedSites:p,setSelectedSites:g,site_code:e})},k=null!==i&&0===i.length;return r.a.createElement("div",null,r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Generate End-of-Shift Report"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Select sites to create end-of-shift report."),null===i&&r.a.createElement(_.a,{display:"flex",justifyContent:"center"},r.a.createElement(x.a,null)),!0===k&&r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"No site under event monitoring on this shift."),null!==i&&!k&&r.a.createElement(y.a,{container:!0,alignItems:"baseline"},r.a.createElement(R.a,{onClick:()=>{i.forEach(e=>{const t=e.site_code;$l({selectedSites:p,setSelectedSites:g,site_code:t,checkAll:v})}),h(!v)},style:{marginRight:6},"aria-label":"Select all"},r.a.createElement(Xl.a,null)),i.map(e=>{const t=e.site_code,a=e.event_id,n=p.includes(t),l=t.toUpperCase();return r.a.createElement(Dt.a,{key:a},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{key:a,onChange:j(t),value:t,color:"primary",checked:n}),label:l}))}))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:()=>{l(),m(null)},color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:()=>{const e=i.filter(e=>p.includes(e.site_code));c(e),s(!1)},color:"primary"},"Submit"))))}));const ti=Object(j.a)(e=>({inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},AccordionsGroup:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"24px 0"},marginTop:16},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},hidden:{display:"none !important"}})),ai=()=>r.a.createElement(ft.a,{height:150,width:700,speed:.5,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}));function ni({label:e,value:t,id:a},n){return r.a.createElement(Bl.b,{required:!0,autoOk:!0,label:e,value:t,onChange:n,ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,variant:"dialog",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}function ri(e,t,a){const n="am"===t?"07:30:00":"19:30:00",r=$()(e).format("YYYY-MM-DD ".concat(n));return function(e,t){const a=e.shift_start,n="".concat(te.b,"/api/end_of_shift/get_end_of_shift_reports/").concat(a);ne.a.get(n).then(e=>{const a=e.data;console.log("EOS Data",a),t(a)}).catch(e=>{console.error("Problem in Axios request"),console.error(e)})}({shift_start:r},e=>{a(e)}),r}function li(e){const t=e.isStart;let a="No event report to generate";return"undefined"!==t&&t&&(a="Generate end-of-shift reports here"),r.a.createElement(h.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var ii=Object(Ge.a)()((function(e){const t=e.width,a=e.hidden,l=ti(),i=$()(),c=i.hour(),s=Object(n.useState)(i.format("YYYY-MM-DD")),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(c>=10&&c<=22?"am":"pm"),g=Object(o.a)(p,2),f=g[0],E=g[1],v=Object(n.useState)(!1),_=Object(o.a)(v,2),O=_[0],j=(_[1],Object(n.useState)(null)),x=Object(o.a)(j,2),S=x[0],C=x[1],D=Object(n.useState)(null),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(null),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(!1),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(k.a)(),F=e=>{d(e)},U=()=>w.map((e,t)=>r.a.createElement(Jl,{data:e,key:t,shiftStartTs:N,currentUser:L}));return r.a.createElement("div",{className:a?l.hidden:""},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:4,style:{display:a?"none !important":""}},[{label:"Shift Start",value:u,id:"start_ts"}].map(e=>{const t=e.id;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t,className:l.inputGridContainer},ni(e,F))}),r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(Ya,{div_id:"shift_time",label:"Shift Time",changeHandler:e=>E(e.target.value),value:f,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,className:"".concat(l.inputGridContainer," ").concat(l.buttonGrid)},r.a.createElement(b.a,{variant:"contained",color:"secondary",size:Object(Ge.b)("sm",t)?"small":"medium",onClick:(W="site_list",e=>{if("generate_report"===W)P(!1);else{P(!0);const e=ri(u,f,C);Y(e)}})},"Generate ",r.a.createElement(Hl.a,{className:l.button}))))),r.a.createElement("div",{className:l.AccordionsGroup},null===w&&!O&&r.a.createElement(li,{isStart:!0}),O?r.a.createElement(ai,null):r.a.createElement(h.a,null,null!==w&&(w.length>0?r.a.createElement(U,null):r.a.createElement(li,null)))),r.a.createElement(ei,{isOpen:B,closeHandler:(q=!1,()=>P(q)),eosData:S,setSelectedEosData:I,setModalOpen:P,setEosData:C}));var q,W})),ci=a(1200),oi=a(620),si=a.n(oi),mi=a(332),ui=a(444);a(1090);function di({event:e}){const t=Object(n.useState)(null),a=Object(o.a)(t,2),l=a[0],i=a[1],c=Boolean(l),s=c?"simple-popover":void 0;return r.a.createElement("div",{style:{width:"inherit"}},r.a.createElement("div",{"aria-describedby":s,onClick:e=>{i(e.currentTarget)},role:"button",tabIndex:"0"},e.title),r.a.createElement(mi.a,{id:s,open:c,anchorEl:l,onClose:()=>{i(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(O.a,{variant:"body1",style:{padding:8}},e.title)))}var pi=r.a.memo((function(e){const t=e.nickname,a="undefined"!==typeof t,l=Object(n.useContext)(vr).monitoring_shifts,i=Object(ui.b)($.a),c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],u=s[1];Object(n.useEffect)(()=>{const e=l.flatMap(e=>{const n=$()(e.ts),r=$()(e.ts),l=n.hours()>19?"PM":"AM";let i=r.add(12,"hours");if("PM"===l&&(i=n.set({h:23,m:59})),!a)return[{title:"".concat(e.iompmt," (MT - ").concat(l,")"),start:n,end:i},{title:"".concat(e.iompct," (CT - ").concat(l,")"),start:n,end:i}];{let a=null;if(e.iompmt===t&&(a="".concat(t," (MT")),e.iompct===t&&(a="".concat(t," (CT")),a)return[{title:"".concat(a," - ").concat(l,")"),start:n,end:i}]}});u(e)},[l,t]);const d=$()();return r.a.createElement("div",{style:{height:a?300:850,width:"-webkit-fill-available"}},r.a.createElement(O.a,{variant:"subtitle2",align:"center"},r.a.createElement("i",null,"Note: The border color of the bordered box specifies the current monitoring shift.")),r.a.createElement(ui.a,{events:m,localizer:i,defaultDate:new Date,eventPropGetter:(e,t,a)=>{let n="#E5DE44",r="black";return $()(t).hours()>19&&(n="#053752",r="white"),{className:"",style:{color:r,borderRadius:5,border:"none",fontSize:12,backgroundColor:n}}},defaultView:"month",dayPropGetter:e=>{const t=d.hours(),a=$()(e),n=d.clone().subtract(1,"day"),r=t<8&&n.isSame(a,"day"),l=t>=8&&a.isSame(d,"day");if(r||l){return{className:"current-shift",style:{border:"dashed 5px ".concat(t>=8&&t<20?"#E5DE44":"#053752")}}}return{}},views:["month"],components:{event:di},popup:!0}))}));const bi=Object(j.a)(e=>{const t=Object(_e.d)(e);return{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},divider:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),selects:{width:"auto",[e.breakpoints.up("md")]:{width:"-webkit-fill-available"}},link:{textDecoration:"none"},valueFont:{color:"black",textDecoration:"none"},hidden:{display:"none !important"}}});function gi(e,t){return t.map((t,a)=>{const n=t.date,l=t.data,i=t.ampm,c=t.mt,o=t.ct,s=si.a.toWords(l.length),u="".concat(le(s)," (").concat(l.length,")"),d=l.map((t,a)=>{const n=t.general_status,l=t.site_code,i=t.public_alert_level,c=t.event_id,o=t.internal_alert,s=function(e,t,a){return r.a.createElement(m.b,{className:e.link,to:"/monitoring/events/".concat(t),target:"_blank"},a.toUpperCase())}(e,c,l);return r.a.createElement(y.a,{container:!0,justify:"space-evenly",direction:"column",item:!0,xs:4,key:"site_alert_".concat(a+1)},r.a.createElement(O.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},s)),r.a.createElement(O.a,{variant:"body2",align:"center"},r.a.createElement("span",{className:e.valueFont},"Alert ",i," (",o,")")),r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},"Monitoring status: ",r.a.createElement("span",{className:e.valueFont},le(n))))});return r.a.createElement($e.a,{key:"monitoring_date_".concat(a+1)},r.a.createElement(et.a,{expandIcon:r.a.createElement(Jr.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{color:"textSecondary",align:"center"},"Shift Date: ",r.a.createElement("span",{className:e.valueFont},$()(n).format("MMMM D, YYYY")))),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{color:"textSecondary",align:"center"},"Sites Monitored: ",r.a.createElement("span",{className:e.valueFont},u))),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{color:"textSecondary",align:"center"},"Shift Schedule: ",r.a.createElement("span",{className:e.valueFont},i))))),r.a.createElement(Q.a,null),r.a.createElement(tt.a,null,r.a.createElement(y.a,{container:!0,spacing:2,className:e.def_padding},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",align:"center"},"Shift Schedule"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},i)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",align:"center"},"MT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},c)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",align:"center"},"CT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},o)),r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20}},r.a.createElement(Q.a,null)),d)),r.a.createElement(Q.a,null))})}var fi=Object(Ge.a)()((function(e){const t=e.hidden,a=e.width,l=e.defaultCalendarOpen,i=bi(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),p=Object(o.a)(d,2),g=p[0],f=p[1],E=Object(n.useState)(""),v=Object(o.a)(E,2),_=v[0],j=v[1],x=Object(n.useState)({}),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)(""),A=Object(o.a)(D,2),w=A[0],I=A[1];Object(n.useEffect)(()=>{C({ts_start:$()(m).format("YYYY-MM-DD HH:mm:ss"),ts_end:$()(g).format("YYYY-MM-DD HH:mm:ss"),user_id:_})},[m,g,_]);const M=e=>t=>{switch(e){case"ts_start":u(t);break;case"ts_end":f(t)}};return r.a.createElement("div",{className:t?i.hidden:""},r.a.createElement($e.a,{defaultExpanded:l},r.a.createElement(et.a,{expandIcon:r.a.createElement(Jr.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},r.a.createElement(O.a,{variant:"body1",component:y.a,container:!0},r.a.createElement(ci.a,{style:{marginRight:8}})," ",r.a.createElement("div",null,r.a.createElement("strong",null,"MONITORING SHIFTS CALENDAR")))),r.a.createElement(Q.a,null),r.a.createElement(tt.a,null,r.a.createElement(pi,null))),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(h.a,{component:y.a,container:!0,spacing:2,style:{marginTop:16,marginBottom:16,padding:8},alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},r.a.createElement("strong",null,"MONITORING SHIFT CHECKER")),r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("i",null,"Note: The checker currently shows event and extended releases only. Routine releases are NOT yet reflected."))),r.a.createElement(y.a,{container:!0,spacing:2,item:!0,xs:12,sm:10},[{label:"Start Timestamp",value:m,id:"ts_start"},{label:"End Timestamp",value:g,id:"ts_end"}].map(e=>r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,key:e.id},function({label:e,value:t,id:a},n){return r.a.createElement(ta.a,{required:!0,autoOk:!0,label:e,value:t,onChange:n(a),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,inputVariant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,M))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4},r.a.createElement(tr,{label:"Staff Name",div_id:"user_id",changeHandler:(T="user_id",e=>{const t=e.target.value;switch(T){case"user_id":j(t)}}),value:_,css:i.selects,variant:"outlined"}))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,container:!0,justify:"center"},r.a.createElement(b.a,{variant:"contained",color:"secondary",size:Object(Ge.b)("sm",a)?"small":"medium",onClick:()=>{var e,t;e=S,t=e=>{const t=gi(i,e);I(r.a.createElement(O.a,{style:{fontStyle:"italic"}},"No shift data")),t.length>0&&I(t)},me("".concat(te.b,"/api/shift_checker/get_shift_data"),e,t)},endIcon:r.a.createElement(Hl.a,null)},"Generate"))),r.a.createElement(y.a,{item:!0,sm:12},w)));var T}));const Ei=Object(j.a)(e=>{const t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{tabBar:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})}),vi=[{label:"End-of-Shift Report Generator",href:"report_generator"},{label:"Monitoring Shifts",href:"shifts"}];Object(n.createContext)();var hi=function(e){const t=e.history,a=e.match.url,l=e.location.pathname,i=Object(n.useState)(0),c=Object(o.a)(i,2),s=c[0],m=c[1],d=Ei(),p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],f=b[1];return Object(n.useEffect)(()=>{const e=Object(u.f)(l,{path:"".concat(a,"/:tab"),exact:!0});if(e){const t=e.params.tab,a=vi.findIndex(e=>e.href===t);m(a),1===a&&f(!0)}},[a]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Shifts & Reports"})),r.a.createElement("div",{className:d.tabBar},r.a.createElement(gt,{chosenTab:s,onSelect:e=>{m(e),t.push("".concat(a,"/").concat(vi[e].href))},tabsArray:vi})),r.a.createElement("div",{className:"".concat(d.pageContentMargin," ").concat(d.tabBarContent)},r.a.createElement(ii,{hidden:0!==s}),r.a.createElement(fi,{hidden:1!==s,defaultCalendarOpen:g})))},_i=a(1187),yi=a(1201),Oi=a(1202);class ji extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(qe.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(f.a,{placeholder:"Type words to search narrative column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(R.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(Al.a,null)),r.a.createElement(R.a,{className:t.clearIcon,onClick:n},r.a.createElement(Il.a,null))))}}var xi=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(ji);function ki(e,t,a=null){ne.a.post(t,e).then(e=>{const t=e.data;null!==a&&a(t)}).catch(e=>{console.log(e)})}var Si=Object(j.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}}));var Ci=function(e){var t=Si(),a=e.narrativeData,n=e.setNarrativeData,l=e.siteList,i=e.setSiteList,c=e.isFromSiteLogs,o=e.callAck,m=e.setCallAck,u=e.callAckHashtag,d=e.toUseCurrentInstance,b=e.setToUseCurrentInstance,g=e.isFromChatterbox,E=a.narrative,v=a.timestamp,h=a.user_id,_=a.narrative_id,j=function(e){return function(t){n(Object(p.a)(Object(p.a)({},a),{},Object(s.a)({},e,t)))}},x=function(e){return function(t){var r=t.target.value;n(Object(p.a)(Object(p.a)({},a),{},Object(s.a)({},e,r)))}};return r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(wa,{value:l,changeHandler:function(e){i(e)},isMulti:!0,isFromSiteLogs:c,disabled:Boolean(_)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Bl.a,{required:!0,autoOk:!0,label:"Date",value:v,onChange:j("timestamp"),ampm:!1,placeholder:"2020-01-01",format:"YYYY-MM-DD",mask:"____-__-__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(_n.b,{required:!0,autoOk:!0,label:"Time",value:v,onChange:j("timestamp"),ampm:!1,placeholder:"00:00",format:"HH:mm",mask:"__:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(tr,{variant:"standard",label:"Reporter",div_id:"user_id",changeHandler:x("user_id"),value:h,disabled:!0})),!g&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wt.a,{value:"associateToCurrentEvent",control:r.a.createElement(Jt.a,{color:"primary",checked:d,onClick:function(e){return b(e.target.checked)}}),label:r.a.createElement("div",null,"Associate site log to current monitoring instance\xa0",r.a.createElement(vt.a,{title:"Unchecking this will associate the log on the montoring event where the log's timestamp falls through."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"}),r.a.createElement(wt.a,{value:"callAck",control:r.a.createElement(Jt.a,{color:"primary",checked:o,onClick:function(e){var t=e.target.checked;m(t);var r=E,l=" ".concat(u);t?(E.length+l.length>1e3&&r.substring(0,1e3-l.length),r+=l):r=E.replace(l,""),n(Object(p.a)(Object(p.a)({},a),{},{narrative:r}))}}),label:r.a.createElement("div",null,"Early Warning Information (EWI) acknowledgement call\xa0",r.a.createElement(vt.a,{title:"Tick this if the log to enter is a call that acknowledges an EWI. This will add #EWIResponseCall on the narrative."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(f.a,{required:!0,id:"standard-multiline-static",label:"Narrative",value:E,onChange:x("narrative"),placeholder:"Enter narrative",multiline:!0,rows:"4",rowsMax:4,fullWidth:!0,inputProps:{maxLength:1e3},variant:"filled"}),r.a.createElement(O.a,{component:y.a,container:!0,justify:"flex-end",variant:"caption"},"Characters: ",E.length,"/1000"))))};var Di=Object(Ce.a)()((function(e){var t,a=e.fullScreen,l=e.isOpen,i=e.closeHandler,s=e.chosenNarrative,m=e.setIsUpdateNeeded,u=e.isEditMode,d=e.isFromSiteLogs,g=e.setSort,f=e.resetTableInput,E=e.saveOnly,v=e.isFromChatterbox,h=Object(c.b)(),_=h.enqueueSnackbar,y=h.closeSnackbar,O=Object(k.a)(),j={narrative_id:null,timestamp:$()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:O.user_id,event_id:null,type_id:1},x=Object(n.useState)(null),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(j),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!0),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useContext)(Ca).sites,B=(t=!0,H.map((function(e){var a=e.site_code,n=e.site_id,r=a.toUpperCase();return t&&(r=re(e,!0,"start")),{value:n,label:r,data:e}}))),P=Object(n.useState)(!1),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)(!0),W=Object(o.a)(q,2),z=W[0],G=W[1];Object(n.useEffect)((function(){var e="";if("undefined"!==typeof s&&0!==Object.keys(s).length){var t=s.id,a=s.narrative,n=s.timestamp,r=s.site_id,l=s.user_id,i=s.event_id,c=s.type_id,o=B.filter((function(e){return e.value===r}));delete o.data,o.event_id=i,D(Object(ye.a)(o)),M({narrative_id:t,timestamp:n,narrative:a,user_id:l,event_id:i,type_id:c}),G(1===c),e=a}U(e.includes("#EWIResponseCall"))}),[s]),Object(n.useEffect)((function(){if(v){G(!1);var e=v.ts,t=v.message,a=v.source,n=v.contact,r="";r="inbox"===a?"".concat(n,' replied "').concat(t,'"'):'Dynaslope sent "'.concat(t,'"');var l=Object(p.a)(Object(p.a)({},j),{},{timestamp:e,narrative:r});M(l)}}),[v]),Object(n.useEffect)((function(){var e=""===I.narrative||null===C;R(e)}),[I,C]);var V=function(){M({narrative_id:null,narrative:"",user_id:O.user_id,event_id:"",type_id:1}),D(C),U(!1),G(!0)},Q=function(){M({narrative_id:null,timestamp:$()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:O.user_id,event_id:"",type_id:1}),D(null),G(!0)},Z=function(){i(),v||Q()},K=u?"Save Edits":"Save & Add More";return E&&(K="Save"),r.a.createElement("div",null,r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Site Logs Form"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"NOTE: ",v?"Be mindful that some Chatterbox tags already create site log entries.":"Only monitoring-related narratives can be entered in this form. Please use other forms dedicated to its purposes."),r.a.createElement(Ci,{narrativeData:I,setNarrativeData:M,siteList:C,setSiteList:D,isFromSiteLogs:d,callAck:F,setCallAck:U,callAckHashtag:"#EWIResponseCall",toUseCurrentInstance:z,setToUseCurrentInstance:G,isFromChatterbox:v})),r.a.createElement(Se.a,null,r.a.createElement("div",null,r.a.createElement(b.a,{onClick:Z,color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:Q},"Reset"),r.a.createElement(b.a,{variant:"contained",color:"primary",onClick:function(){R(!0);var e,t=_("Inserting site log...",{variant:"warning",persist:!0}),a=C.map((function(e){var t=e.value,a=e.event_id||null;return z||(a=null),{site_id:t,event_id:a}}));I.site_list=a,I.timestamp=$()(I.timestamp).format("YYYY-MM-DD HH:mm:00"),I.user_id=O.user_id,I.type_id=!0===z?1:2,console.log(I),e=function(e){v||V(),y(t),_("Site log inserted successfully!",{variant:"success",autoHideDuration:3e3}),g&&g({order_by:"id",order:"desc"}),f&&f(),m&&m(!0),(u||Boolean(E))&&Z()},ki(I,"".concat(te.b,"/api/narratives/write_narratives_to_db"),e)},disabled:Y},K)))))}));var Ai=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.isOpen,n=e.closeHandler,l=e.chosenNarrative,i=e.setIsUpdateNeeded,c=l.id,o=l.narrative;return r.a.createElement("div",null,r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Site Logs Delete"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Are you sure you want to delete this narrative?"),r.a.createElement(ke.a,{align:"center"},'"'.concat(o,'"'))),r.a.createElement(Se.a,null,r.a.createElement("div",null,r.a.createElement(b.a,{onClick:n,color:"primary"},"Cancel"),r.a.createElement(b.a,{variant:"contained",color:"secondary",onClick:()=>{n();var e;e=e=>{console.log("ret",e),i(!0)},ki({narrative_id:c},"".concat(te.b,"/api/narratives/delete_narratives_from_db"),e)},disabled:!1},"Confirm")))))})),wi=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{inputGridContainer:Object(s.a)({margin:"12px 0"},e.breakpoints.down("sm"),{margin:"0 0"}),buttonGrid:Object(s.a)({textAlign:"right"},e.breakpoints.down("sm"),{textAlign:"right"}),button:{fontSize:16,paddingLeft:8},alert3:Object(p.a)(Object(p.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}})})})),Ii=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Mi=Object(Ge.a)()((function(e){var t=e.width,a=wi(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],m=i[1],u=Object(n.useState)(0),d=Object(o.a)(u,2),g=d[0],f=d[1],E=Object(n.useState)(10),v=Object(o.a)(E,2),_=v[0],y=v[1],O=Object(n.useState)(0),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)([]),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)(""),Y=Object(o.a)(N,2),H=Y[0],B=Y[1],L=Object(n.useState)({order_by:"timestamp",order:"desc"}),F=Object(o.a)(L,2),U=F[0],q=F[1],W=Object(n.useState)(!0),z=Object(o.a)(W,2),G=z[0],V=z[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)(!1),ee=Object(o.a)(X,2),ae=ee[0],le=ee[1],ie=Object(n.useState)(!1),ce=Object(o.a)(ie,2),oe=ce[0],se=ce[1],me=Object(n.useState)({}),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(!0),ge=Object(o.a)(be,2),fe=ge[0],Ee=ge[1],ve=Object(n.useContext)(Ca).sites,he=Object(n.useContext)(Te).alertsFromDbData,_e=[],je={};ve.forEach((function(e){var t=e.site_code.toUpperCase();_e.push(t),je[t]=e.site_id})),Object(n.useEffect)((function(){fe&&(V(!0),function(e,t){const a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.order_by,o=e.order;let s="".concat(te.b,"/api/narratives/get_narratives?limit=").concat(n,"&offset=").concat(r);if(s+="&order_by=".concat(c,"&order=").concat(o),a&&(s+="&include_count=true"),0!==l.length){s+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(s+="&search=".concat(i)),ne.a.get(s).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}(Object(p.a)({include_count:!0,limit:_,offset:g*_,filters:D,search_str:H},U),(function(e){var t=e.narratives,a=e.count,n=t.map((function(e){var t=e.narrative,a=e.user_details,n=e.site_id,r=e.user_id,l=e.id,i=e.type_id,c=e.event_id,o=e.timestamp,s="---";if(null!==a){var m=a.last_name,u=a.first_name;s="".concat(u," ").concat(m)}return{narrative:t,user_details:s,site_name:re(e.site,!0,"start"),timestamp:o,type:e.type_id,actions:"---",site_id:n,user_id:r,id:l,type_id:i,event_id:c}}));m(n),k(a),V(!1)})),Ee(!1))}),[g,_,D,H,U,fe]);var ke=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f(0),e||A([]),B("")},Se=function(e,t){return function(){"is_narrative_modal_open"===e?(J(!K),se(!1),pe({})):"is_open_delete_modal"===e&&le(!ae)}},Ce={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(Ge.c)(t,"xs")?"standard":"simple",serverSide:!0,searchText:H,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:x,page:g,onTableChange:function(e,t){if("changePage"===e){var a=t.page;f(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==_&&y(n)}else"resetFilters"===e&&(T({}),A([]));["changePage","changeRowsPerPage","resetFilters"].includes(e)&&Ee(!0)},onColumnSortChange:function(e,t){q({order_by:e,order:"ascending"===t?"asc":"desc"}),Ee(!0)},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){if(0!==e.length){n=!1;var r=De[t].name;if("site_name"===r){var l=[],i=[];e.forEach((function(e){l.push(je[e]),i.push(e)})),a.push({name:"site_ids",data:l}),T(Object(p.a)(Object(p.a)({},M),{},Object(s.a)({},r,i)))}}})),n&&T({}),A(a),Ee(!0)},customSearchRender:function(e,t,a,n){var l=e||"";return r.a.createElement(xi,{searchText:e,onSearch:t,onHide:function(){a(),B(""),Ee(!0)},options:n,onSearchClick:function(){ke(!0),B(l),Ee(!0)}})}},De=[{name:"id",label:"Log ID",options:{filter:!1,display:!1,sort:!0}},{name:"timestamp",label:"Timestamp",options:{filter:!1,sort:!0,sortOrder:"timestamp"===U.order_by?U.order:"none",customBodyRender:function(e){return $()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"site_name",label:"Site",options:{display:"true",filter:!0,filterType:"custom",filterList:"undefined"===typeof M.site_name?[]:M.site_name,filterOptions:{fullWidth:!0,logic:function(e,t){return!!t.length&&!t.includes(e)},display:function(e,t,n,l){var i=he.latest,c=he.extended,o=he.overdue,s=[].concat(Object(ye.a)(i),Object(ye.a)(o));return r.a.createElement(Dt.a,null,r.a.createElement(Ta.a,null,"Site"),r.a.createElement(Na.a,{multiple:!0,value:e[n],renderValue:function(e){return e.join(", ")},onChange:function(a){e[n]=a.target.value,t(e[n],n,l)}},_e.map((function(t){var l=t.toLowerCase(),i=s.find((function(e){return e.event.site.site_code===l})),o=c.find((function(e){return e.event.site.site_code===l})),m=a.alert0;i&&(m=a.alert3),o&&(m=a.extended);var u=i||o?r.a.createElement(Sr.a,null,r.a.createElement(lt.a,null)):"";return r.a.createElement(P.a,{key:t,value:t,className:m},r.a.createElement(Jt.a,{color:"primary",checked:e[n].indexOf(t)>-1}),r.a.createElement(kr.a,{primary:t}),u)}))))}},sort:!1}},{name:"narrative",label:"Narrative",options:{filter:!1,sort:!1}},{name:"type",label:"Type",options:{filter:!0}},{name:"user_details",label:"Reporter",options:{filter:!1}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:function(e,t){var a=t.rowIndex;return function(e,t){var a=t.setChosenNarrative,n=t.setIsOpenNarrativeModal,l=t.setIsOpenDeleteModal,i=t.setIsEditMode;return r.a.createElement("span",null,r.a.createElement(R.a,{tooltip:"Edit",style:{float:"left"},onClick:function(t){a(e),n(!0),i(!0)}},r.a.createElement(yi.a,{style:{fontSize:20}})),r.a.createElement(R.a,{tooltip:"Delete",style:{float:"left"},onClick:function(t){a(e),l(!0)}},r.a.createElement(Oi.a,{style:{fontSize:20}})))}(c[a],{setChosenNarrative:pe,setIsOpenNarrativeModal:J,isOpenNarrativeModal:K,setIsOpenDeleteModal:le,isOpenDeleteModal:ae,setIsEditMode:se,isEditMode:oe})}}}],Ae=Object(Ge.c)("md",t),we=r.a.createElement("span",null,r.a.createElement(b.a,{"aria-label":"Write a site log",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:Se("is_narrative_modal_open")},r.a.createElement(at.a,{style:{paddingRight:4,fontSize:20}}),"Write a Site Log"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Site Logs",customButtons:!!Ae&&we})),r.a.createElement(Oe.a,{open:G,fullWidth:!0},r.a.createElement(xe.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(_i.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(h.a,{className:a.paperContainer},r.a.createElement(_l.a,{theme:Ii},r.a.createElement(vl.a,{title:"Site Logs",data:c,columns:De,options:Ce})))),r.a.createElement(Di,{isOpen:K,closeHandler:Se("is_narrative_modal_open"),setIsUpdateNeeded:Ee,chosenNarrative:de,isFromSiteLogs:he,isEditMode:oe,setSort:q,resetTableInput:ke}),r.a.createElement(Ai,{isOpen:ae,closeHandler:Se("is_open_delete_modal"),chosenNarrative:de,setIsUpdateNeeded:Ee}))}));class Ti extends r.a.Component{constructor(...e){super(...e),this.handleTextChange=e=>{const t=this.props.options.onSearchChange;t&&t(e.target.value),this.props.onSearch(e.target.value)},this.onKeyDown=e=>{27===e.keyCode?this.props.onHide():13===e.keyCode&&this.props.onSearchClick()}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown,!1)}render(){const e=this.props,t=e.classes,a=e.options,n=e.onHide,l=e.searchText,i=e.onSearchClick;return r.a.createElement(qe.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:t.main,ref:e=>this.rootRef=e},r.a.createElement(f.a,{placeholder:"Type words to search details column",className:t.searchText,InputProps:{"aria-label":a.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:e=>this.searchField=e}),r.a.createElement(R.a,{className:t.clearIcon,style:{marginLeft:6},onClick:i},r.a.createElement(Al.a,null)),r.a.createElement(R.a,{className:t.clearIcon,onClick:n},r.a.createElement(Il.a,null))))}}var Ni=Object(d.a)(e=>({main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}),{name:"CustomSearchRender"})(Ti);const Yi={},Ri=Object(j.a)(e=>Object(p.a)(Object(p.a)({},Object(_e.d)(e)),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8}})),Hi=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Bi=Object(Ge.a)()((function(e){const t=e.width,a=Ri(),l=Object(n.useState)([]),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(0),u=Object(o.a)(m,2),d=u[0],g=u[1],f=Object(n.useState)(5),E=Object(o.a)(f,2),v=E[0],_=E[1],y=Object(n.useState)(0),O=Object(o.a)(y,2),j=O[0],x=O[1],k=Object(n.useState)([]),S=Object(o.a)(k,2),C=S[0],D=S[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(""),N=Object(o.a)(T,2),Y=N[0],H=N[1],B=Object(n.useState)(!1),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(!0),q=Object(o.a)(U,2),W=q[0],z=q[1],G=Object(n.useState)(!1),V=Object(o.a)(G,2),Q=V[0],Z=V[1],K=Object(n.useState)({}),J=Object(o.a)(K,2),X=J[0],ee=J[1],ae=Object(n.useState)(!1),re=Object(o.a)(ae,2),le=re[0],ie=re[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),se=oe[0],me=oe[1],ue=Object(n.useState)(!0),de=Object(o.a)(ue,2),pe=de[0],be=de[1];Object(n.useEffect)(()=>{z(!0);!function(e,t){const a=e.include_count,n=e.limit,r=e.offset,l=e.filters,i=e.search_str,c=e.include_expired;let o="".concat(te.b,"/api/issues_and_reminders/get_issues_and_reminders");if(o+="?include_expired=".concat(c),null!==n||null!==r){if(o+="&limit=".concat(n,"&offset=").concat(r),a&&(o+="&include_count=true"),0!==l.length){o+=l.map(e=>{const t=e.name;return e.data.map(e=>"&".concat(t,"=").concat(e)).join("")}).join("")}""!==i&&(o+="&search=".concat(i))}ne.a.get(o).then(e=>{const a=e.data;t(a)}).catch(e=>{console.error(e)})}({include_count:!0,limit:v,offset:d*v,filters:C,search_str:Y,include_expired:!0},e=>{const t=e.issues_and_reminders,a=e.count;s(t),x(a),z(!1)})},[d,v,C,Y,pe]);const ge=(e,t)=>()=>{"is_issue_reminder_modal_open"===e&&(Z(t),ie(!1))},fe={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(Ge.c)(t,"xs")?"standard":"simple",serverSide:!0,rowsPerPageOptions:[5,10,15],rowsPerPage:v,count:j,page:d,onTableChange(e,t){if("changePage"===e){const e=t.page;g(e)}else if("changeRowsPerPage"===e){const e=t.rowsPerPage;e!==v&&_(e)}else"resetFilters"===e?(M({}),D([])):"onSearchOpen"===e&&F(!0)},onFilterChange(e,t){const a=[];let n=!0;t.forEach((e,t)=>{if(0!==e.length){n=!1;const r=Ee[t].name;if("site_name"===r){const t=[],n=[];e.forEach(e=>{t.push(Yi[e]),n.push(e)}),a.push({name:"site_ids",data:t}),M(Object(p.a)(Object(p.a)({},I),{},{[r]:n}))}}}),n&&M({}),D(a)},customSearchRender:(e,t,a,n)=>{let l=e||"";L&&(l=Y,F(!1));return r.a.createElement(Ni,{searchText:e,onSearch:t,onHide:()=>{a(),F(!1)},options:n,onSearchClick:()=>H(l)})}},Ee=[{name:"ts_posted",label:"Date Posted",options:{filter:!1,customBodyRender:e=>$()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"detail",label:"Details",options:{filter:!1}},{name:"reporter",label:"Reporter",options:{filter:!0,customBodyRender:(e,{rowIndex:t})=>{const a=c[t];return"".concat(a.issue_reporter.first_name," ").concat(a.issue_reporter.last_name)}}},{name:"ts_expiration",label:"Posted Until",options:{filter:!1,sort:!1,customBodyRender:e=>null===e?"-":$()(e).format("DD MMMM YYYY, HH:mm:ss")}},{name:"resolved_by",label:"Resolved By",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"resolution",label:"Resolution",options:{filter:!1,customBodyRender:e=>null===e?"-":e}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,{rowIndex:t})=>{const a=c[t],n=a.ts_expiration,l=a.resolution;return $()(n).isAfter($()())||null!==l?"Finished":function(e,t){const a=t.setChosenIssueReminder,n=t.setIsOpenIssueReminderModal,l=t.setToResolve,i=t.setIsIandRUpdateNeeded,c=e.ts_resolved,o=e.ts_expiration,s=$()().isBefore(o)||null===o,m=null===c&&(s||null===o);return r.a.createElement("span",null,s&&r.a.createElement(R.a,{tooltip:"Edit",style:{float:"left"},onClick:t=>{a(e),n(!0),i(!0),l(!1)}},r.a.createElement(yi.a,{style:{fontSize:20}})),m&&r.a.createElement(R.a,{tooltip:"Delete",style:{float:"left"},onClick:t=>{a(e),n(!0),i(!0),l(!0)}},r.a.createElement(Oi.a,{style:{fontSize:20}})),!s&&!m&&"Finished")}(a,{setChosenIssueReminder:ee,setIsOpenIssueReminderModal:Z,isOpenIssueReminderModal:Q,setToResolve:me,setIsIandRUpdateNeeded:ie})}}}],ve=Object(Ge.c)("md",t),he=r.a.createElement("span",null,r.a.createElement(b.a,{"aria-label":"Post an Issue or reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:ge("is_issue_reminder_modal_open",!0)},r.a.createElement(at.a,{style:{paddingRight:4,fontSize:20}}),"Post an Issue / Reminder"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Issues and Reminders",customButtons:!!ve&&he})),r.a.createElement(Oe.a,{open:W,fullWidth:!0},r.a.createElement(xe.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement(_i.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(h.a,{className:a.paperContainer},r.a.createElement(_l.a,{theme:Hi},r.a.createElement(vl.a,{title:"Issues and Reminders",data:c,columns:Ee,options:fe})))),r.a.createElement(zr,{isOpen:Q,closeHandler:ge("is_issue_reminder_modal_open",!1),isIandRUpdateNeeded:le,setIsIandRUpdateNeeded:ie,chosenIssueReminder:X,toResolve:se,setToRefresh:be,toRefresh:pe}))})),Pi=a(623),Li=a.n(Pi),Fi=a(133),Ui=a.n(Fi),qi=Object(hl.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var Wi=Object(Ge.a)()((function(e){var t=e.width,a=e.isLoading,l=e.columns,i=e.type,c=e.datas,s=e.shift_start_ts,m=Object(n.useState)(c),u=Object(o.a)(m,2),d=u[0],b=u[1],g=Object(n.useState)([]),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Ui()(d).groupBy("site_name").map((function(e,t){return t})).value().length;Object(n.useEffect)((function(){l.map((function(e,t){switch(e.name){case"ewi_sms":e.options=Object(p.a)(Object(p.a)({},e.options),{},{customBodyRender:function(e,t){var a=t.tableData,n=t.rowIndex,l=$()(a[n].ts_limit_start),c=$()(e);h>5?l.add(h,"minutes"):l.add(5,"minutes"),"Lowering"===i&&l.add(15,"minutes");var o=c>l;return r.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"Routine"!==i:e.options=Object(p.a)(Object(p.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,c=$()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),o=$()(n[l].ts_limit_start).add(10,"minutes"),s=$()(e);h>5&&(o=c.add(2*h,"minutes")),"Lowering"===i&&o.add(15,"minutes");var m=s>o;return r.a.createElement("span",{style:{color:m?"red":""}},e)}});break;case"rainfall_info":e.options=Object(p.a)(Object(p.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,i=$()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),c=$()(i).add(15,"minutes"),o=$()(e)>c;return r.a.createElement("span",{style:{color:o?"red":""}},e)}});break;case"ground_measurement":e.options=Object(p.a)(Object(p.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,i=$()(n[l].ts_limit_start).format("YYYY-MM-DD HH:mm:ss"),c=$()(i).subtract(2.5,"hours"),o=$()(i).subtract(2,"hours"),s=$()(e),m=!!(s>=c&&s<=o);return r.a.createElement("span",{style:{color:m?"red":""}},e)}});break;case"internal_alert":e.options=Object(p.a)(Object(p.a)({},e.options),{},{customBodyRender:function(e,t,a){var n=t.tableData,l=t.rowIndex,i=n[l].internal_alert,c=n[l].ground_data,o="ND"==i&&"---"!==c;return r.a.createElement("span",{style:{color:o?"red":""}},e)}})}})),v(l)}),[l,c]);var _={textLabels:{body:{noMatch:"No ".concat(i," event(s)")}},responsive:Object(Ge.c)(t,"xs")?"standard":"vertical",filter:!0,selectableRows:"none",print:!0,download:!0,downloadOptions:{filename:"".concat(i,"_releases_").concat(s,".csv"),separator:";"},filterType:"dropdown",onTableChange:function(e,t){"resetFilters"===e&&b(c),"propsUpdate"===e&&b(c)}};return r.a.createElement("div",null,r.a.createElement(_l.a,{theme:qi},r.a.createElement(vl.a,{title:r.a.createElement("div",null,r.a.createElement(O.a,{variant:"h5",component:"div"},"SMS Inbox"===i?"".concat(i):"".concat(i," Releases"),a&&r.a.createElement(x.a,{size:24,style:{marginLeft:15,position:"relative",top:4}}))),data:d,columns:E,options:_})))})),zi=Object(j.a)((function(e){return{root:{width:"100%"}}}));function Gi(e){var t=zi(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Event",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"internal_alert",label:"Internal Alert",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}const Vi=Object(j.a)(e=>({root:{width:"100%"}}));function Qi(e){const t=Vi(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Lowering",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}const Zi=Object(j.a)(e=>({root:{width:"100%"}}));function Ki(e){const t=Zi(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Extended",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}var Ji=Object(j.a)((function(e){return{root:{width:"100%"}}}));function Xi(e){var t=Ji(),a=e.releasesData,n=e.isLoading,l=e.shift_start_ts;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Routine Monitoring",type:"Routine",shift_start_ts:l,datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"internal_alert",label:"Internal Alert",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"ground_data",label:"Ground Data",options:{filter:!1,sort:!1}}]}))}const $i=Object(j.a)(e=>({root:{width:"100%"}}));function ec(e){const t=$i(),a=e.releasesData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"Raising",datas:a,columns:[{name:"site_name",label:"Site",options:{filter:!0,sort:!0}},{name:"ewi_web_release",label:"EWI Web Release",options:{filter:!1,sort:!1}},{name:"ewi_sms",label:"EWI SMS",options:{filter:!1,sort:!1}},{name:"ewi_bulletin_release",label:"EWI Bulletin",options:{filter:!1,sort:!1}},{name:"rainfall_info",label:"Rainfall Info",options:{filter:!1,sort:!1}},{name:"ground_measurement",label:"Ground Meas Reminder",options:{filter:!1,sort:!1}},{name:"fyi_permission",label:"FYI Permission",options:{filter:!1,sort:!1}}]}))}var tc=Object(j.a)((function(e){return{root:{width:"100%"}}}));function ac(e){var t=tc(),a=e.inboxData,n=e.isLoading;return r.a.createElement("div",{className:t.root},r.a.createElement(Wi,{isLoading:n,tableTitle:"QA for Event Monitoring",type:"SMS Inbox",datas:a,columns:[{name:"timestamp",label:"Timestamp",options:{filter:!0,sort:!0}},{name:"site_code",label:"Site Code",options:{filter:!0,sort:!0}},{name:"affiliation",label:"Affiliation",options:{filter:!1,sort:!1}},{name:"sender",label:"Sender",options:{filter:!1,sort:!1}},{name:"message",label:"Message",options:{filter:!1,sort:!1}},{name:"tag",label:"Tag",options:{filter:!1,sort:!1}}]}))}var nc=Object(j.a)((function(e){return Object(p.a)(Object(p.a)({},Object(_e.d)(e)),{},{root:{display:"flex",flexGrow:1},content:{flexGrow:1,padding:e.spacing(3),overFlowY:"auto"}})}));function rc(e){var t=e.isStart,a="No available data for QA";return"undefined"!==t&&t&&(a="Select shift to generate data for QA"),r.a.createElement(h.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var lc=function(e){var t=e.selectedTab,a=e.eventData,n=e.loweringData,l=e.extendedData,i=e.routineData,c=e.raisingData,o=e.inboxData;return[r.a.createElement(Gi,Object.assign({releasesData:a},e)),r.a.createElement(Qi,Object.assign({releasesData:n},e)),r.a.createElement(Ki,Object.assign({releasesData:l},e)),r.a.createElement(Xi,Object.assign({releasesData:i},e)),r.a.createElement(ec,Object.assign({releasesData:c},e)),r.a.createElement(ac,Object.assign({inboxData:o},e))][t]};function ic(){var e=nc(),t=Object(n.useState)(0),a=Object(o.a)(t,2),l=a[0],i=a[1],c=$()(),s=c.hour(),m=Object(n.useState)(c.format("YYYY-MM-DD")),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(s>=10&&s<=22?"am":"pm"),f=Object(o.a)(g,2),v=f[0],h=f[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),j=O[0],k=O[1],S=Object(n.useState)(null),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(null),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)([]),L=Object(o.a)(B,2),F=L[0],U=L[1],q=Object(n.useState)([]),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)([]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),X=Object(o.a)(J,2),ee=X[0],ae=X[1],re=Object(n.useState)([]),le=Object(o.a)(re,2),ie=le[0],ce=le[1],oe=function(e){p(e)};return Object(n.useEffect)((function(){null!==D&&(D.raising.length>0&&ae(D.raising),D.event.length>0&&H(D.event),D.routine.length>0&&U(D.routine),D.extended.length>0&&G(D.extended),D.lowering.length>0&&K(D.lowering),D.inbox.length>0&&ce(D.inbox),k(!1))}),[D]),Object(n.useEffect)((function(){var e=[R.length,Z.length,z.length,F.length,ee.length,ie.length];i(e.indexOf(Math.max.apply(Math,e)))}),[R,F,Z,z,ee,ie]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.pageContentMargin},r.a.createElement(ut,{title:"Alert Monitoring | Quality Assurance"})),r.a.createElement("div",{className:e.pageContentMargin},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:2,item:!0,xs:12,style:{marginBottom:8}},[{label:"Shift Start",value:d,id:"start_ts"}].map((function(t){var a=t.id;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,className:e.inputGridContainer},ni(t,oe))})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(Ya,{div_id:"shift_time",label:"Shift Time",changeHandler:function(e){return h(e.target.value)},value:v,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"right"},r.a.createElement(b.a,{variant:"contained",color:"secondary",onClick:function(){k(!0),H([]),U([]),G([]),K([]),ae([]),ce([]);var e=function(e,t){const a=e.shift_time,n=e.start_ts,r="am"===a?"08:00:00":"20:00:00",l=$()(n).format("YYYY-MM-DD ".concat(r)),i="".concat(te.b,"/api/monitoring/get_monitoring_releases_for_qa/").concat(l);return ne.a.get(i).then(e=>{const a=e.data;console.log("Releases",a),t(a)}).catch(e=>{console.error("Problem in Axios request"),console.error(e)}),l}({start_ts:d,shift_time:v},A);T(e)},disabled:j,endIcon:r.a.createElement(Li.a,{className:e.button})},"Generate")))),null!==D&&0!==D.length?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:!0,container:!0,justify:"flex-end"},r.a.createElement(Dt.a,null,r.a.createElement(Na.a,{value:l,onChange:function(e){return i(e.target.value)},style:{width:200},autoFocus:!0},r.a.createElement(P.a,{value:0},"Event (".concat(R.length,")")),r.a.createElement(P.a,{value:4},"Raising (".concat(ee.length,")")),r.a.createElement(P.a,{value:1},"Lowering (".concat(Z.length,")")),r.a.createElement(P.a,{value:2},"Extended (".concat(z.length,")")),r.a.createElement(P.a,{value:3},"Routine (".concat(F.length,")")),r.a.createElement(P.a,{value:5},"SMS (".concat(ie.length,")"))),r.a.createElement(E.a,null,"Select monitoring type to display"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(lc,{routineData:F,eventData:R,loweringData:Z,extendedData:z,raisingData:ee,inboxData:ie,isLoading:j,shift_start_ts:M,selectedTab:l}))):r.a.createElement(y.a,{item:!0,xs:12,align:"center"},j?r.a.createElement(x.a,null):null!==M&&null!==D&&0===D.length?r.a.createElement(rc,null):r.a.createElement(rc,{isStart:!0})))))}var cc=a(1215),oc=a(1216),sc=a(113),mc=a.n(sc),uc=a(347),dc=a.n(uc),pc=a(55),bc=a.n(pc),gc=a(32),fc=a.n(gc),Ec=a(211),vc=a.n(Ec),hc=a(212),_c=a.n(hc),yc=a(574),Oc=a(572),jc=a(1182),xc=a(1206),kc=a(1207),Sc=a(1205),Cc=a(1208),Dc=a(1209),Ac=a(624),wc=a.n(Ac),Ic=a(1203);function Mc(e,t){var a="".concat(te.b,"/api/analysis/get_latest_data_presence/").concat(e);ne.a.get(a).then((function(a){var n=a.data;console.log("Data Presence: ".concat(e),n),t(n)})).catch((function(e){console.error(e)}))}function Tc(e,t){var a=e.subsurface_column,n=e.ts_end,r=e.ts_start,l=e.node_id;console.log("node level input",e);var i="".concat(te.b,"/api/subsurface/get_subsurface_node_level/").concat(a,"/").concat(n,"/").concat(r,"/").concat(l);ne.a.get(i).then((function(e){var a=e.data;console.log("Subsurface Node Level Data",a),t(a)})).catch((function(e){console.error(e)}))}function Nc(e,t){var a="".concat(te.b,"/api/analysis/save_chart_svg");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save SVG",a),t(a)})).catch((function(e){console.error(e)}))}function Yc(e){ne.a.get("".concat(te.b,"/api/sensor_deployment/get_loggers_data")).then((function(t){var a=t.data;console.log("Loggers and Sensors Data",a),e(a)})).catch((function(e){console.log(e)}))}function Rc(e,t){var a="".concat(te.b,"/api/monitoring/get_monitoring_analytics_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Monitoring analytics data",a),t(a)})).catch((function(e){console.error(e)}))}function Hc(e,t){const a=[];return t.forEach(t=>{const n=t.dataset_name,r=function(e){const t=e.dataset_name,a=e.dataset;return"velocity_acceleration"===t?a.forEach(({name:e},t)=>{"Trend Line"===e?a[t]=Object(p.a)(Object(p.a)({},a[t]),{},{type:"spline"}):"Threshold Interval"===e?a[t]=Object(p.a)(Object(p.a)({},a[t]),{},{type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,color:"#FFEB32"}):"Last Data Point"===e&&(a[t]=Object(p.a)(Object(p.a)({},a[t]),{},{marker:{symbol:"asterisk",lineColor:"#ff9e32",lineWidth:4}}))}):"displacement_interpolation"===t?a.forEach(({name:e},t)=>{"Surficial Data"===e?a[t].type="scatter":"Interpolation"===e&&(a[t]=Object(p.a)(Object(p.a)({},a[t]),{},{marker:{enabled:!0,radius:0}}))}):"velocity_acceleration_time"===t&&a.forEach(({name:e},t)=>{"Velocity"===e?a[t].yAxis=0:"Acceleration"===e&&(a[t].yAxis=1)}),a}(t);let l;if("velocity_acceleration"===n)l=function(e,t){const a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity Acceleration Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat($()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{title:{text:"<b>Velocity (cm/day)</b>"}},yAxis:{title:{text:"<b>Acceleration (cm/day^2)</b>"}},tooltip:{headerFormat:"",shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1}}}(r,e);else if("displacement_interpolation"===n)l=function(e,t){const a=t.site_code,n=t.marker_name,r=t.ts;return{series:e,time:{timezoneOffset:-480},chart:{type:"spline",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Displacement Interpolation Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>Timestamp: <b>").concat($()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},tooltip:{crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}},scatter:{tooltip:{pointFormat:"Date/Time: <b>{point.x:%A, %e %b, %H:%M:%S}</b><br>Displacement: <b>{point.y:.2f}</b>"}}},credits:{enabled:!1}}}(r,e);else if("velocity_acceleration_time"===n){const t=r.findIndex(e=>"Timestamps"===e.name),a=JSON.parse(JSON.stringify(r)),n=a.splice(t,1);l=function(e,t,a){const n=a.site_code,r=a.marker_name,l=a.ts;return{series:e,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity & Acceleration vs Time Chart of ".concat(n.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(r,"</b><br/>Timestamp: <b>").concat($()(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{categories:t,type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},labels:{formatter(){return $()(this.value).format("D MMM")}},title:{text:"<b>Time (Days)</b>"}},yAxis:[{title:{text:"<b>Velocity (cm/day)</b>",style:{color:fc.a.getOptions().colors[1]}}},{title:{text:"<b>Acceleration (cm/days^2)</b>",style:{color:fc.a.getOptions().colors[0]}},labels:{style:{color:fc.a.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!1}}},credits:{enabled:!1}}}(a,Object(o.a)(n,1)[0].data,e)}a.push(l)}),a}wc()(fc.a),fc.a.SVGRenderer.prototype.symbols.asterisk=(e,t,a,n)=>["M",e-3,t-3,"L",e+a+3,t+n+3,"M",e+a+3,t-3,"L",e-3,t+n+3,"M",e-4,t+n/2,"L",e+a+4,t+n/2,"M",e+a/2,t-4,"L",e+a/2,t+n+4,"z"],fc.a.VMLRenderer&&(fc.a.VMLRenderer.prototype.symbols.asterisk=fc.a.SVGRenderer.prototype.symbols.asterisk);var Bc=function(e){const t=e.siteCode,a=e.generateTrending,l=e.setShowTrending,i=e.setGenerateTrending,c=e.chosenPoint,s=r.a.useRef(null),m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)([]),f=Object(o.a)(g,2),E=f[0],v=f[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),j=O[0],x=O[1],k=c.ts,S=c.name,C={site_code:t,ts:$()(k).format("YYYY-MM-DD HH:ss:mm"),marker_name:S};return Object(n.useEffect)(()=>{a&&(x(!0),function(e,t){var a=e.site_code,n=e.marker_name,r=e.ts,l="".concat(te.b,"/api/surficial/get_surficial_marker_trending_data/")+"".concat(a,"/").concat(n,"/").concat(r);ne.a.get(l).then((function(e){var a=e.data;console.log("Surficial Marker Trending Data",a),t(a)})).catch((function(e){console.error(e)}))}(C,e=>{const t=e.has_trend,a=e.trending_data,n=t?[...a]:[];p(n),i(!1),x(!1)}))},[a]),Object(n.useEffect)(()=>{if(0!==d.length){const e=function(e,t,a){return Hc(e,t).map(e=>r.a.createElement(bc.a,{highcharts:fc.a,options:e,ref:a}))}(C,d,s);v(e)}},[d]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),j?r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:16}},r.a.createElement(_i.a,{variant:"query",style:{height:8}})):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(b.a,{variant:"contained",onClick:()=>l(!1),color:"primary",size:"small",endIcon:r.a.createElement(Ic.a,null)},"Hide")),r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"center",spacing:1},0!==d.length?E.map((e,t)=>r.a.createElement(y.a,{item:!0,xs:12,sm:6,key:t},r.a.createElement(h.a,null,e))):r.a.createElement(h.a,{component:y.a,container:!0,item:!0,alignItems:"center",justify:"center",style:{height:"20vh",padding:60,background:"gainsboro",border:"4px solid #CCCCCC"}},"Selected data has no trend."))))},Pc=a(1204);const Lc=e=>t=>{t.preventDefault(),e.push("/analysis/sites"),e.replace("/analysis/sites")};var Fc=function(e){const t=e.width,a=e.history;return Object(Ge.b)(t,"sm")?r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:Lc(a)},r.a.createElement(Pc.a,{style:{fontSize:16}})," Back to site list"):r.a.createElement(R.a,{variant:"contained",color:"primary",size:"small",onClick:Lc(a),style:{marginLeft:6}},r.a.createElement(Pc.a,null))};const Uc=[{label:"3 days",unit:"days",duration:3},{label:"7 days",unit:"days",duration:7},{label:"10 days",unit:"days",duration:10},{label:"2 weeks",unit:"weeks",duration:2},{label:"1 month",unit:"months",duration:1},{label:"3 months",unit:"months",duration:3},{label:"6 months",unit:"months",duration:6},{label:"1 year",unit:"years",duration:1},{label:"All",unit:"all",duration:0}],qc=[{label:"4 hours",hour_value:4},{label:"8 hours",hour_value:8},{label:"12 hours",hour_value:12},{label:"1 day",hour_value:24}];var Wc=function(e){const t=e.isSubsurface,a=e.selectedRangeInfo,l=e.setSelectedRangeInfo,i=e.selectedHourInterval,c=e.setSelectedHourInterval,s=e.disableAll,m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1],h="undefined"!==typeof s&&s,_="undefined"!==typeof t&&t;let y="";if(i){const e=i.label;y=e}const O=e=>{v(e.currentTarget)},j=()=>{v(null)};return r.a.createElement("div",null,_&&r.a.createElement(n.Fragment,null,r.a.createElement(vt.a,{title:"Select time interval",arrow:!0},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:O,style:{marginRight:6},endIcon:r.a.createElement(Sc.a,null)},y)),r.a.createElement(B.a,{id:"simple-menu",anchorEl:E,keepMounted:!0,open:Boolean(E),onClose:j},qc.map((e,t)=>{const a=e.label;return r.a.createElement(P.a,{key:"hour_interval_".concat(t),onClick:()=>(c(e),void v(null))},a)}))),r.a.createElement(vt.a,{title:"Select date range",arrow:!0},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{p(e.currentTarget)},style:{marginRight:_?8:0},endIcon:r.a.createElement(Sc.a,null)},a.label)),r.a.createElement(B.a,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:()=>{p(null)}},Uc.map((e,t)=>{const a=e.label;return"all"===e.unit&&h?null:r.a.createElement(P.a,{key:"date_range_".concat(t),onClick:()=>(l(e),void p(null))},a)})))};function zc(e,t){return r.a.createElement(b.a,{color:"primary",onClick:function(){e(t)}},"Dismiss")}function Gc(e){var t=e.fullScreen,a=e.open,l=e.setIsOpen,i=e.surficialData,c=e.siteCode,m=Object(n.useState)({}),u=Object(o.a)(m,2),d=u[0],g=u[1],f=Object(n.useState)(null),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)(null),O=Object(o.a)(_,2),j=O[0],x=O[1];Object(n.useEffect)((function(){var e={};i.forEach((function(t){e[t.marker_id]=!1})),g(Object(p.a)(Object(p.a)({},d),e))}),[i]);var k=function(e){var t=e.target,a=t.checked,n=t.value;g(Object(p.a)(Object(p.a)({},d),{},Object(s.a)({},n,a)))};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Export marker history and data tags"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill out the necessary fields."),r.a.createElement(Dt.a,{component:"fieldset",style:{width:"100%"}},r.a.createElement(Xt.a,{component:"legend",style:{textAlign:"center"}},"Choose markers to be exported"),r.a.createElement(Ua.a,{row:!0,style:{display:"flex",justifyContent:"space-evenly"}},i.map((function(e){return r.a.createElement(wt.a,{key:e.marker_name,control:r.a.createElement(Jt.a,{checked:d[e.marker_id],onChange:k,value:e.marker_id,name:e.marker_name.toString()}),label:e.marker_name})})))),r.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:8}},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp of Sending",value:v,onChange:function(e){return h(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"End Timestamp",value:j,onChange:function(e){return x(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"secondary",onClick:function(){var e={ts_start:$()(v).format("YYYY-MM-DD HH:mm:ss"),ts_end:$()(j).format("YYYY-MM-DD HH:mm:ss"),markers:Object.entries(d).filter((function(e){return e[1]})).map((function(e){return parseInt(e[0],10)}))},t="".concat(c,"_").concat($()().format("MM-DD-YYYY_HH-mm-ss"));!function(e,t){var a="".concat(te.b,"/api/surficial/get_marker_history_tags");ne.a.get(a,{params:e,responseType:"blob"}).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var a=window.URL.createObjectURL(new Blob([e])),n=document.createElement("a");n.href=a,n.setAttribute("download",t),document.body.appendChild(n),n.click(),l(!1)}))},disabled:null===v||null===j||Object.values(d).every((function(e){return!1===e}))},"Export"),r.a.createElement(b.a,{onClick:function(){l(!1)}},"Cancel")))}function Vc(e){var t=e.fullScreen,a=e.open,l=e.setIsOpen,i=e.selectedMarker,s=e.historicalMarkers,m=e.addNewMarker,u=e.siteCode,d=e.setRedrawChart,p=e.history,g=e.match.url,E=null,v=null;if(null!==i){var h=i.marker_id,_=i.marker_name;E=h,v=_}var j=Object(c.b)(),x=j.enqueueSnackbar,k=j.closeSnackbar,S=Object(n.useState)(""),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(null),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)(""),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)(""),P=Object(o.a)(B,2),L=P[0],F=P[1],U=function(){l(!1),T(null),H(""),G(null),A(""),F("")},q=Object(n.useState)(null),W=Object(o.a)(q,2),z=W[0],G=W[1],V=function(){""===R&&G("Required field")};Object(n.useEffect)((function(){""!==R?/[^a-zA-Z]/.test(R)?G("Enter alphabet characters only."):s.includes(R)?G("Marker name already exists."):G(null):G("")}),[R]);var Z=Object(n.useState)(!1),K=Object(o.a)(Z,2),J=K[0],X=K[1];return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},m?"Add new marker":"Add event to Marker ".concat(v)),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,m?"Choose a new marker name then submit.":"Choose a marker event then answer the corresponding field(s)."),r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex"}},!m&&r.a.createElement(At.a,{"aria-label":"marker_event",name:"marker_event",row:!0,style:{justifyContent:"space-around"},value:D,onChange:function(e){A(e.target.value),T(null),H(""),G(null),F("")}},r.a.createElement(wt.a,{value:"reposition",control:r.a.createElement(It.a,null),label:"Reposition"}),r.a.createElement(wt.a,{value:"rename",control:r.a.createElement(It.a,null),label:"Rename"}),r.a.createElement(wt.a,{value:"decommission",control:r.a.createElement(It.a,null),label:"Decommission"})),r.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:8}},""!==D&&r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp",value:M,onChange:function(e){return T(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),("rename"===D||m)&&r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(f.a,{error:Boolean(z),label:"New Marker Name",value:R,onChange:function(e){return H(e.target.value.toUpperCase())},onBlur:V,type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:1},placeholder:"Input a letter",helperText:z||""})),(""!==D||m)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{autoOk:!0,label:"Timestamp",value:M,onChange:function(e){return T(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,sm:12},r.a.createElement(f.a,{label:"Remarks",value:L,onChange:function(e){return F(e.target.value)},onBlur:V,type:"text",multiline:!0,rowsMax:3,fullWidth:!0,inputProps:{maxLength:1500},placeholder:"Input remarks"}))))),J&&r.a.createElement(y.a,{container:!0,spacing:2,style:{marginTop:12}},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Are you sure submitting this data?")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)))),r.a.createElement(Se.a,null,J&&r.a.createElement(b.a,{onClick:function(){return X(!1)}},"Go Back"),r.a.createElement(b.a,{variant:J?"contained":"text",color:"secondary",onClick:function(){var e=!0;if(("reposition"!==D||m)&&(e=!1,J?(e=!0,X(!1)):X(!0)),e){U();var t=m?"add":D,a=m&&null==M?$()():M;!function(e,t){var a="".concat(te.b,"/api/surficial/insert_marker_event");ne.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}({site_code:u,event:t,marker_id:E,ts:$()(a).format("YYYY-MM-DD HH:mm:00"),marker_name:R,remarks:""===L?null:L},(function(e){var a=e.status,n="Error inserting new marker event...";m&&(n="Error creating new marker..."),"success"===a&&(n="Inserting new marker event successful!",m&&(n="Creating new marker successful!"),d(!0),["add","rename"].includes(t)&&p.push("".concat(g,"/").concat(R))),x(n,{variant:a,autoHideDuration:7e3,action:function(e){return zc(k,e)}})}))}}},"Submit"),!J&&r.a.createElement(b.a,{onClick:U},"Cancel")))}function Qc(e){var t=e.markerInfo,a=e.markerName,n=[{name:"ts",label:"Timestamp",options:{filter:!1,customBodyRender:function(e){return $()(e).format("D MMMM YYYY, HH:mm")},sort:!0}},{name:"event",label:"Event"},{name:"m_name",label:"Name",options:{filter:!1}},{name:"remarks",label:"Remarks",options:{filter:!1,display:!1}}],l={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",expandableRows:!0,expandableRowsHeader:!1,expandableRowsOnClick:!0,renderExpandableRow:function(e,t){var a=e.length+1,n=e[3];return r.a.createElement(yc.a,null,r.a.createElement(Oc.a,{colSpan:a,align:"justify"},r.a.createElement("strong",null,"Remarks:")," ",n))},rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",customSort:function(e,t,a){return e.sort((function(e,n){return 0===t?($()(e.data[t]).isAfter(n.data[t])?-1:1)*("desc"===a?1:-1):(e.data[t]<n.data[t]?-1:1)*("desc"===a?1:-1)}))}},i=[];return t&&(i=t.marker_history.map((function(e){var t=e.ts,a=e.event,n=e.marker_name,r=e.remarks,l=n?n.marker_name:"---";return{event:le(a),m_name:l,ts:t,remarks:r||"None"}}))),r.a.createElement(vl.a,{title:"Marker ".concat(a," History"),columns:n,options:l,data:i})}function Zc(e){var t=e.editModal,a=e.fullScreen,l=e.setEditModal,i=e.siteCode,m=e.setRedrawChart,u=e.chosenPoint,d=t.is_open,g=t.ts,E=t.name,v=t.measurement,h=t.mo_id,_=t.data_id,j=u.ts,x=u.measurement,k=u.observer_name,S=Object(c.b)(),C=S.enqueueSnackbar,D=S.closeSnackbar,A=Object(n.useState)(!1),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)("one"),N=Object(o.a)(T,2),Y=N[0],R=N[1];Object(n.useEffect)((function(){M(!1)}),[d]);var H=function(e,a){return function(n){var r=a;"ts"===e?r=n:"measurement"===e&&(r=n.target.value),l(Object(p.a)(Object(p.a)({},t),{},Object(s.a)({},e,r)))}};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:a,open:d,"aria-labelledby":"form-dialog-title",TransitionComponent:a?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Update surficial data"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Carefully edit the necessary fields or delete entries if needed."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"subtitle1",style:{fontWeight:"bold"}},i.toUpperCase()," - Marker ",E),r.a.createElement(O.a,{variant:"body2"},"Observation Timestamp: ",$()(j).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(O.a,{variant:"body2"},"Measurement: ",x," cm"),r.a.createElement(O.a,{variant:"body2"},"Observer: ",k)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"EDIT")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Change marker data measurement",value:v,onChange:H("measurement"),type:"number",fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},"Change observation timestamp (applies to the rest of the points)"),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Observation Timestamp",value:$()(g),onChange:H("ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:function(){var e={};j!==g&&(e=Object(p.a)(Object(p.a)({},e),{},{mo_id:h,ts:$()(g).format("YYYY-MM-DD HH:mm:ss")})),x!==v&&(e=Object(p.a)(Object(p.a)({},e),{},{data_id:_,measurement:v})),l(Object(p.a)(Object(p.a)({},t),{},{is_open:!1})),0!==Object.keys(e).length&&function(e,t){var a="".concat(te.b,"/api/surficial/update_surficial_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Update Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t="Error updating surficial data...",a="error";"success"===e.status&&(t="Surficial data update successful!",a="success",m(!0)),C(t,{variant:a,autoHideDuration:7e3,action:function(e){return zc(D,e)}})}))}},"Update Data")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"DELETE")),r.a.createElement(y.a,{item:!0,xs:12},"Be careful on deleting marker data. Delete only IF REALLY NEEDED."),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Dt.a,{component:"fieldset"},r.a.createElement(At.a,{"aria-label":"gender",name:"gender1",value:Y,onChange:function(e){return R(e.target.value)}},r.a.createElement(wt.a,{value:"one",control:r.a.createElement(It.a,null),label:"Delete measurement of this marker only"}),r.a.createElement(wt.a,{value:"all",control:r.a.createElement(It.a,null),label:"Delete all measurements from given marker observation (i.e. all data from observation timestamp)"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:function(){return M(!0)}},"Delete Data")),I&&r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(jc.a,{variant:"contained",size:"small",color:"secondary","aria-label":"small contained button group"},r.a.createElement(b.a,{disabled:!0},"Are you sure?"),r.a.createElement(b.a,{onClick:function(){var e=_;"all"===Y&&(e=h);var a={quantity:Y,id:e};l(Object(p.a)(Object(p.a)({},t),{},{is_open:!1})),function(e,t){var a="".concat(te.b,"/api/surficial/delete_surficial_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Delete Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(a,(function(e){var t="Error deleting surficial data...",a="error";"success"===e.status&&(t="Surficial data delete successful!",a="success",m(!0)),C(t,{variant:a,autoHideDuration:7e3,action:function(e){return zc(D,e)}})}))}},"Yes"),r.a.createElement(b.a,{onClick:function(){return M(!1)}},"No"))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:H("is_open",!1)},"Cancel")))}function Kc(e){var t=e.surficialDataTagModal,a=e.setSurficialDataTagModal,l=e.siteCode,i=e.setRedrawChart,m=t.is_open,u=t.ts,d=t.name,g=t.measurement,E=t.data_id,v=t.unreliable_data,h=Object(k.a)().user_id,_=Object(n.useState)(!1),j=Object(o.a)(_,2),x=j[0],S=j[1],C=Object(n.useState)(""),D=Object(o.a)(C,2),A=D[0],w=D[1],I=Object(n.useState)(""),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(c.b)(),R=Y.enqueueSnackbar,H=Y.closeSnackbar;Object(n.useEffect)((function(){S(!t.unreliable_data)}),[t]);var B=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){H(e)}},"Dismiss")};return r.a.createElement(Oe.a,{open:m,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},v?"Marker data tag information":"Tag marker data"),r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"subtitle1",style:{fontWeight:"bold"}},l.toUpperCase()," - Marker ",d),r.a.createElement(O.a,{variant:"body2"},"Timestamp: ",$()(u).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(O.a,{variant:"body2"},"Measurement: ",g," cm")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},v&&!x&&r.a.createElement(y.a,{container:!0,justify:"center"},r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Tag Type:")),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0},{"-1":"Unreliable",0:"Validating",1:"Confirmed"}[v.tag_type])),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Timestamp:")),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0},$()(v.ts).format("DD MMMM YYYY, HH:mm:ss"))),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Tagger:")),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0},"".concat(v.tagger.first_name," ").concat(v.tagger.last_name))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Remarks:")),r.a.createElement(O.a,{variant:"body1"},v.remarks))),x&&r.a.createElement(n.Fragment,null,r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex",marginBottom:"1rem"}},r.a.createElement(At.a,{"aria-label":"tag_type",name:"tag_type",row:!0,style:{justifyContent:"space-around"},value:T,onChange:function(e){return N(e.target.value)}},r.a.createElement(wt.a,{value:"-1",control:r.a.createElement(It.a,null),label:"Unreliable"}),r.a.createElement(wt.a,{value:"0",control:r.a.createElement(It.a,null),label:"Validating",disabled:v&&0!==v.tag_type}),r.a.createElement(wt.a,{value:"1",control:r.a.createElement(It.a,null),label:"Confirmed"}))),r.a.createElement(f.a,{label:"Remarks",value:A,onChange:function(e){return w(e.target.value)},inputProps:{maxLength:1e3},fullWidth:!0,required:!0,error:""===A,helperText:A?"":"Required"}))))),r.a.createElement(Se.a,null,x?r.a.createElement(b.a,{variant:"contained",color:"secondary",size:"small",onClick:function(){var e=null;v&&(e=v.marker_tag_id),function(e,t){var a="".concat(te.b,"/api/surficial/save_unreliable_marker_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save unreliable data",a),t(a)})).catch((function(e){console.error(e)}))}({marker_tag_id:e,data_id:E,tagger_id:h,remarks:A,tag_type:parseInt(T,10)},(function(e){var n,r=e.status,l=e.message;!0===r?(i(!0),a(Object(p.a)(Object(p.a)({},t),{},{is_open:!1})),n="success",w("")):n="error",R(l,{variant:n,autoHideDuration:5e3,action:B})}))},disabled:""===A||""===T},"Save"):r.a.createElement(b.a,{variant:"contained",color:"secondary",size:"small",onClick:function(){S(!0),w(v.remarks),N(v.tag_type.toString())}},"Edit"),r.a.createElement(b.a,{color:"primary",onClick:function(){var e,n;e="is_open",n=!1,a(Object(p.a)(Object(p.a)({},t),{},Object(s.a)({},e,n))),w(""),N("")}},"Cancel")))}function Jc(e){var t,a=e.setIsOpenClickModal,n=e.open,l=e.chosenPoint,i=e.setEditModal,c=e.setShowTrending,o=e.setGenerateTrending,s=e.setSurficialDataTagModal,m=l.ts,u=l.measurement,d=l.name,b=l.observer_name,g=function(){a(!1)};return r.a.createElement(Oe.a,{onClose:g,"aria-labelledby":"simple-dialog-title",open:n},r.a.createElement(je.a,{id:"simple-dialog-title"},"Point options"),r.a.createElement(xe.a,null,r.a.createElement("div",{align:"center"},r.a.createElement(O.a,{variant:"subtitle1",style:{fontWeight:"bold"}},"Marker ",d),r.a.createElement(O.a,{variant:"body2"},"Timestamp: ",$()(m).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(O.a,{variant:"body2"},"Measurement: ",u," cm"),r.a.createElement(O.a,{variant:"body2"},"Observer: ",b))),r.a.createElement(Or.a,null,r.a.createElement(xr.a,{button:!0,onClick:function(){g(),i(Object(p.a)(Object(p.a)({},l),{},{is_open:!0}))}},r.a.createElement(Sr.a,null,r.a.createElement(yi.a,null)),r.a.createElement(kr.a,{primary:"Edit/Delete data"})),r.a.createElement(xr.a,{button:!0,onClick:function(){g(),c(!0),o(!0)}},r.a.createElement(Sr.a,null,r.a.createElement(xc.a,null)),r.a.createElement(kr.a,{primary:"Generate trending chart"})),r.a.createElement(xr.a,{button:!0,onClick:(t="tag",function(e){g(),s(Object(p.a)(Object(p.a)({},l),{},{is_open:!0,type:t}))})},r.a.createElement(Sr.a,null,r.a.createElement(kc.a,null)),r.a.createElement(kr.a,{primary:"Add/Edit data tag info"}))))}function Xc(e){var t=e.width,a=e.url,l=e.selectedMarker,i=e.surficialData,c=e.setIsOpenAddEventModal,s=e.setAddNewMarker,u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],g=d[1],f=function(){g(null)},E=Object(Ge.b)(t,"sm")&&i.length<=5;return r.a.createElement(n.Fragment,null,r.a.createElement(jc.a,{variant:"contained",color:"primary",size:"small","aria-label":"Site markers button group",style:{marginRight:6}},r.a.createElement(b.a,{disabled:!0,style:{color:"#000000"}},"Marker"),E?i.map((function(e){var t=e.marker_name,n=e.marker_id;return r.a.createElement(b.a,{component:m.b,to:"".concat(a,"/").concat(t),key:n},t)})):r.a.createElement(b.a,{color:"primary",variant:"contained",size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){g(e.currentTarget)},endIcon:r.a.createElement(Sc.a,null)},l?l.marker_name:"Select"),r.a.createElement(vt.a,{title:"Add a new marker",onClick:function(){s(!0),c(!0)},arrow:!0},r.a.createElement(b.a,null,r.a.createElement(Cc.a,null)))),r.a.createElement(B.a,{id:"simple-menu",anchorEl:p,keepMounted:!0,open:Boolean(p),onClose:f},i.map((function(e){var t=e.marker_name,n=e.marker_id;return r.a.createElement(P.a,{component:m.b,to:"".concat(a,"/").concat(t),key:n,onClick:f},t)}))))}function $c(e,t,a,n,r,l){var i=e.site_code,c=e.timestamps,o=c.start,s=c.end,m=$()(o,"YYYY-MM-DD HH:mm:ss"),u=$()(s,"YYYY-MM-DD HH:mm:ss"),d=Object(Ge.b)(a,"sm")?"1rem":"0.90rem",p="As of: <b>".concat($()(u).format("D MMM YYYY, HH:mm"),"</b>");l||(p+="<br/><i>Note: Click data points to access several options.</i>");var b=m;if((l||"None"===o)&&t.length>0){var g=t.reduce((function(e,t){var a=e.data,n=t.data;return 0===a.length?t:0===n.length||a[0].x<n[0].x?e:t}));b=g.data.length>0?$()(g.data[0].x):$()()}return t.forEach((function(e){e.turboThreshold=1e5,e.data.forEach((function(e){var t=e.unreliable_data;if(0!==Object.keys(t).length){var a,n,r=t.tag_type;-1===r?(a="triangle-down",n="#FF0000"):0===r?(a="circle",n="#FFFF00"):(a="triangle",n="#06e606");var l={symbol:a,radius:8,fillColor:n,lineColor:"#000000",lineWidth:1};e.marker=l}else e.unreliable_data=!1}))})),{title:{text:"<b>Surficial Data History Chart of ".concat(i.toUpperCase(),"</b>"),style:{fontSize:d},margin:36,y:18},time:{timezoneOffset:-480},series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:24,spacingRight:24,events:{load:function(){var e=this;[{symbol:"triangle",color:"#06e606",label:"Confirmed"},{symbol:"circle",color:"#FFFF00",label:"Validating"},{symbol:"triangle-down",color:"#FF0000",label:"Unreliable"}].forEach((function(t,a){!function(t,a){var n=5+20*(a+1);e.renderer.symbol(t.symbol,20,n,10,10).attr({zIndex:5}).css({fill:t.color,stroke:"black"}).add();var r=15+20*(a+1);e.renderer.text(t.label,35,r).attr({zIndex:5}).css({fontSize:"12px"}).add()}(t,a)})),e.renderer.rect(10,15,95,70,2).attr({"stroke-width":2,stroke:"black",zIndex:4}).add()}}},subtitle:{text:p,style:{fontSize:"0.75rem"}},legend:{labelFormatter:function(){var e=this.userOptions,t=e.marker_name;return 0===e.in_use?"".concat(t," (Defunct)"):t}},yAxis:{title:{text:"<b>Measurement (cm)</b>"}},xAxis:{min:Date.parse(b),max:Date.parse(u),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0},dashStyle:"ShortDash"},series:{marker:{radius:3},cursor:"pointer",point:{events:{click:function(){if(!l){var e=this.data_id,t=this.x,a=this.y,i=this.mo_id,c=this.series.name,o=this.unreliable_data,s=this.observer_name,m={data_id:e,name:c,mo_id:i,ts:$()(t),measurement:a,unreliable_data:o,observer_name:s};r(m),n(!0)}}}}}},loading:{showDuration:100,hideDuration:1e3},credits:{enabled:!1}}}vc()(fc.a);var eo=Object(Ce.a)()((function(e){var t,a=e.width,l=e.location.pathname,i=e.match,c=i.url,s=i.params.site_code,m=e.fullScreen,d=e.disableBack,g=e.disableMarkerList,f=e.saveSVG,E=e.input,v=e.currentUser,_=e.isEndOfShift,O=Object(n.useState)({label:"3 months",unit:"months",duration:3}),j=Object(o.a)(O,2),x=j[0],k=j[1],S=x.unit,C=x.duration,D="";if("undefined"!==typeof E){var A=E.ts_end;D=A,t=$()(A)}else{var w=$()();D=w.format("YYYY-MM-DD HH:mm:ss"),t=w}var I="undefined"!==typeof d&&d,M="undefined"!==typeof g&&g,T="undefined"!==typeof f&&f,N="undefined"!==typeof _&&_,Y=se(t,C,S),R=r.a.useRef(null),H={start:Y,end:D},B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(null),q=Object(o.a)(U,2),W=q[0],z=q[1],G=Object(n.useState)(!1),V=Object(o.a)(G,2),Q=V[0],Z=V[1],K=Object(n.useState)(!1),J=Object(o.a)(K,2),X=J[0],ee=J[1],ae=Object(n.useState)(!0),re=Object(o.a)(ae,2),le=re[0],ie=re[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),me=oe[0],ue=oe[1],de=Object(n.useState)(!1),pe=Object(o.a)(de,2),be=pe[0],ge=pe[1],fe=Object(n.useState)(!1),Ee=Object(o.a)(fe,2),ve=Ee[0],he=Ee[1],_e=Object(n.useState)(!1),ye=Object(o.a)(_e,2),Oe=ye[0],je=ye[1],xe=Object(n.useState)(!1),ke=Object(o.a)(xe,2),Se=ke[0],Ce=ke[1],De=Object(n.useState)(!1),Ae=Object(o.a)(De,2),we=Ae[0],Ie=Ae[1],Me={data_id:null,mo_id:null,name:null,ts:null,measurement:0},Te=Object(n.useState)(Object(p.a)({},Me)),Ne=Object(o.a)(Te,2),Ye=Ne[0],Re=Ne[1],He=Object(n.useState)(Object(p.a)(Object(p.a)({},Me),{},{is_open:!1})),Be=Object(o.a)(He,2),Pe=Be[0],Le=Be[1],Fe=Object(n.useState)(Object(p.a)(Object(p.a)({},Me),{},{is_open:!1})),Ue=Object(o.a)(Fe,2),qe=Ue[0],We=Ue[1];Object(n.useEffect)((function(){ie(!0)}),[x]),Object(n.useEffect)((function(){var e=R.current;((null!==e||le)&&e.chart.showLoading(),le)&&(!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.site_code,r=e.start,l=e.end,i="".concat(te.b,"/api/surficial/get_surficial_plot_data/")+"".concat(n,"/").concat(r,"/").concat(l);a&&(i+="?is_end_of_shift=true"),ne.a.get(i).then((function(e){var a=e.data;console.log("Surficial Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(Object(p.a)({site_code:s},H),(function(t){(F(t),null!==e)&&(e.chart.hideLoading(),T&&ee(!0))}),N),ie(!1))}),[le]),Object(n.useEffect)((function(){if(!Q&&0!==L.length){var e=[],t=_c.a.scale(["#f00","#0f0","#00f"]).mode("lch").domain([0,L.length-1]);L.forEach((function(a,n){a.marker_history.forEach((function(t){var a=t.marker_name;a&&e.push(a.marker_name)})),L[n].color=t(n).name()})),Z(e)}}),[Q,L]),Object(n.useEffect)((function(){if(0!==L.length){var e=Object(u.f)(l,{path:"".concat(c,"/:marker_name"),exact:!0});if(e){var t=e.isExact,a=e.params.marker_name;if(t){var n=L.find((function(e){return e.marker_name===a}));"undefined"!==typeof n&&z(n)}}}}),[l,L]),Object(n.useEffect)((function(){var e=R.current.chart.getSVGForExport();X&&Nc({user_id:v.user_id,site_code:s,chart_type:"surficial",svg:e},(function(e){}))}),[X]),Object(n.useEffect)((function(){var e=R.current.chart;W&&(e.series.forEach((function(e){var t=W.marker_name===e.name;e.setVisible(t,!1)})),e.redraw(),e.reflow())}),[W]);var ze=function(e,t){return r.a.createElement(bc.a,{highcharts:fc.a,options:e,ref:t})}($c({site_code:s,timestamps:H},L,a,he,Re,N),R);return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(y.a,{container:!0,item:!0,xs:12,style:{marginBottom:12}},!I&&r.a.createElement(y.a,{item:!0,xs:1,sm:3},r.a.createElement(Fc,e)),r.a.createElement(y.a,{item:!0,container:!0,xs:!0,justify:"flex-end"},!M&&L.length>0&&r.a.createElement(Xc,Object.assign({},e,{width:a,url:c,selectedMarker:W,surficialData:L,setIsOpenAddEventModal:je,setAddNewMarker:Ce})),r.a.createElement("div",null,r.a.createElement(Wc,{selectedRangeInfo:x,setSelectedRangeInfo:k})))),r.a.createElement(y.a,{item:!0,xs:12,md:W?7:12,lg:W?8:12},r.a.createElement(h.a,{elevation:2},ze),!M&&0!==L.length&&r.a.createElement(y.a,{container:!0,style:{marginTop:12},align:"left"},r.a.createElement(b.a,{variant:"contained",color:"primary",startIcon:r.a.createElement(Dc.a,null),size:"small",onClick:function(){return Ie(!0)}},"Export history/tags"))),r.a.createElement(u.b,{path:"".concat(c,"/:marker_name"),render:function(e){var t=e.match.params.marker_name;return W?r.a.createElement(y.a,{item:!0,xs:12,md:5,lg:4},r.a.createElement(Qc,{markerInfo:W,markerName:t}),r.a.createElement(y.a,{container:!0,justify:"flex-end",style:{marginTop:12}},r.a.createElement(b.a,{variant:"contained",color:"primary",startIcon:r.a.createElement(Cc.a,null),size:"small",onClick:function(){Ce(!1),je(!0)}},"Add Event"))):""}}),me&&r.a.createElement(Bc,{siteCode:s,setShowTrending:ue,generateTrending:be,setGenerateTrending:ge,chosenPoint:Ye})),r.a.createElement(Jc,{open:ve,setIsOpenClickModal:he,chosenPoint:Ye,setEditModal:Le,setShowTrending:ue,setGenerateTrending:ge,setSurficialDataTagModal:We}),r.a.createElement(Zc,{chosenPoint:Ye,editModal:Pe,setEditModal:Le,fullScreen:m,siteCode:s,setRedrawChart:ie}),r.a.createElement(Kc,{chosenPoint:Ye,surficialDataTagModal:qe,setSurficialDataTagModal:We,fullScreen:m,siteCode:s,setRedrawChart:ie}),r.a.createElement(Vc,Object.assign({},e,{siteCode:s,open:Oe,setIsOpen:je,selectedMarker:W,setRedrawChart:ie,historicalMarkers:Q,addNewMarker:Se})),r.a.createElement(Gc,{open:we,setIsOpen:Ie,surficialData:L,siteCode:s}))}));var to=function(e){const t=e.isOpen,a=e.closeModalFn,l=e.taggingData,i=e.onTagSuccess,s=Object(k.a)();let m={ts_start:null,ts_end:null};null!==l&&(m=Object(p.a)({},l));const u=Object(n.useState)(!1),d=Object(o.a)(u,2),g=d[0],E=d[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],j=h[1],x=Object(n.useState)(""),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(!0),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(c.b)(),N=T.enqueueSnackbar,Y=T.closeSnackbar;Object(n.useEffect)(()=>{M(""===_)},[_]);const R=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{Y(e)}},"Dismiss"),H=()=>{a()};return r.a.createElement(Oe.a,{fullWidth:!0,open:t,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Tag invalid rainfall data"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill in the required fields then submit. Note: DO NOT TAG ALREADY TAGGED POINTS."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},"Start Timestamp"),r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,m.ts_start))),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},"End Timestamp"),r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,g?"Indefinite":m.ts_end))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wt.a,{value:"isIndefinite",control:r.a.createElement(Jt.a,{color:"primary",checked:g,onClick:e=>E(e.target.checked)}),label:r.a.createElement("div",null,"Set end timestamp as indefinite\xa0",r.a.createElement(vt.a,{title:"Checking this will show data from start timestamp to latest timestamp and all incoming data as invalid. A script will provide the end timestamp of the invalidated range."},r.a.createElement("strong",null,"[?]"))),labelPlacement:"end"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ya,{div_id:"observed-data",label:"Observed Data",list:[{id:-1,label:"Actual rainfall data/observation is lower than recorded"},{id:0,label:"No rainfall observed; Actual data is zero"},{id:1,label:"Actual rainfall data/observation is higher than recorded"}],mapping:{id:"id",label:"label"},required:!0,value:_,error:""===_,changeHandler:e=>j(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Remarks",fullWidth:!0,multiline:!0,rowsMax:"3",value:C,onChange:e=>D(e.target.value)})))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:()=>{const e=Object(Fi.cloneDeep)(l);delete e.chart;const t=Object(p.a)(Object(p.a)({tagger_id:s.user_id},e),{},{observed_data:parseInt(_,10),remarks:C||null});g&&(t.ts_end=null),console.log("Submitting invalid tag",t),function(e,t){var a="".concat(te.b,"/api/rainfall/tag_invalid_data");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save tag information",a),t(a)})).catch((function(e){console.error(e)}))}(t,e=>{const t=e.status,a=e.message;"success"===t&&(H(),i()),N(a,{variant:t,autoHideDuration:3e3,action:R})})},disabled:I},"Submit"),r.a.createElement(b.a,{onClick:H,color:"primary"},"Cancel")))};window.moment=X,vc()(fc.a);var ao={set:{"24h":[],"72h":[],rain:[],null_ranges:[],max_rval:0,max_72h:0,gauge_name:"loading",distance:0,data_source:"loading",threshold_value:0,rain_id:null},series_data:[],max_rval_data:[]},no={"-1":"Actual is lower than recorded",0:"No rainfall/Data is zero",1:"Actual is higher than recorded"},ro={"24h":"rgba(73, 105, 252, 0.9)","72h":"rgba(239, 69, 50, 0.9)",rain:"rgba(0, 0, 0, 0.9)"};function lo(e){var t=e.null_ranges,a=e.invalid_data,n=[],r=[];Object.keys(ro).forEach((function(t){var l=ro[t],i=e[t];"rain"===t&&(i=function(e,t){var a=t.length,n=0;return e.map((function(e){var r=Object(o.a)(e,2),l=r[0],i={x:l,y:r[1]};if(a>0&&n<a){var c=t[n],s=c.ts_start,m=c.ts_end,u=X.unix(l/1e3);u.isSameOrAfter(s)&&(u.isSameOrBefore(m)||null===m)&&(i.color="rgba(250, 96, 96)",i.is_invalid=!0,Object.assign(i,t[n])),u.isSame(m)&&(n+=1)}return i}))}(i,a));var c={name:t,step:!0,data:i,color:l,id:t,fillOpacity:1,lineWidth:1,turboThreshold:1e5};"rain"!==t?n.push(c):r.push(c)}));var l=t.map((function(e){return{from:e.from,to:e.to,color:"rgba(68, 170, 213, 0.3)"}}));return{set:e,series_data:n,max_rval_data:r,null_processed:l}}function io(e){var t=e.target,a=e.is_tagging_data,n=e.rain_gauge,r=e.rain_id,l=e.setTaggingData,i=t.series,c=t.resetZoomButton,o=t.is_tagging_data,s=t.rain_gauge,m=t.rain_id,u=t.tagging_sign,d=t.setTaggingData,p=s,b=m;"undefined"!==typeof n&&(t.rain_gauge=n,t.rain_id=r);var g=d;"undefined"!==typeof l&&(t.setTaggingData=l);var f="undefined"===typeof a?!("undefined"===typeof o)&&o:a;t.is_tagging_data=f;var E=function(){t.reset_selection.destroy(),delete t.reset_selection},v=function(){t.submit_selection.destroy(),delete t.submit_selection};if(t.submit_selection=t.renderer.button("Submit",70,65).attr({zIndex:3,r:5,id:"submit-selection",fill:fc.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",(function(){fc.a.fireEvent(t,"selectedpoints",{selected_points:t.getSelectedPoints(),rain_gauge:p,rain_id:b,is_submit:!0,setTaggingData:g}),E(),v(),oo(i)})),t.reset_selection=t.renderer.button("Reset",133,65).attr({zIndex:3,r:5,id:"reset-selection",fill:fc.a.getOptions().colors[0]}).css({color:"#FFFFFF"}).on("click",(function(){E(),v(),oo(i)})),"undefined"!==typeof c&&(f?c.hide():c.show()),!f)return oo(i),E(),v(),delete t.setTaggingData,"undefined"!==typeof u&&(t.tagging_sign.destroy(),delete t.tagging_sign),!0;"undefined"===typeof u&&(t.tagging_sign=t.renderer.label("Tagging",30,20).attr({fill:fc.a.getOptions().colors[5],padding:10,r:5,zIndex:8}).css({color:"#FFFFFF"}).add());var h=t.getSelectedPoints(),_=h.map((function(e){return e.x})),y=Math.min.apply(Math,Object(ye.a)(_)),O=Math.max.apply(Math,Object(ye.a)(_));return"undefined"!==typeof e.xAxis&&(i.forEach((function(t){t.points.forEach((function(t){(t.x>=e.xAxis[0].min||t.x>=y)&&(t.x<=e.xAxis[0].max||t.x<=O)&&null!==t.y&&t.select(!0,!0)}))})),(h=t.getSelectedPoints()).length>0&&(t.reset_selection.add(),t.submit_selection.add())),fc.a.fireEvent(t,"selectedpoints",{selected_points:h,rain_gauge:p,rain_id:b}),!1}function co(e){var t=e.selected_points,a=e.rain_gauge,n=e.rain_id,r=e.is_submit,l=e.setTaggingData,i=e.target,c=[];t.forEach((function(e){var t=new Date(e.x);t=X(t).format("YYYY-MM-DD HH:mm:ss"),!0!==c.includes(t)&&c.push(t)}));var o={rain_gauge:a,ts_start:c[0],ts_end:c[c.length-1],rain_id:n,chart:i};r&&l(o)}function oo(e){e.forEach((function(e){e.points.forEach((function(e){e.select(!1,!1)}))}))}function so(e,t,a,n,r){var l=e.set,i=e.max_rval_data,c=e.null_processed,o=l.distance,s=l.max_rval,m=l.gauge_name,u=l.rain_id,d=t.ts_start,p=t.ts_end;t.site_code;return{series:i,chart:{type:"column",zoomType:"x",panning:!0,events:{selection:io,selectedpoints:co},height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Instantaneous Rainfall Chart of ".concat(po(o,m),"</b><br/>As of: <b>").concat(X(p).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},xAxis:{min:Date.parse(d),max:Date.parse(p),plotBands:c,type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:bo}},yAxis:{max:s,min:0,title:{text:"<b>Value (mm)</b>"}},tooltip:{shared:!0,crosshairs:!0,formatter:function(e){var t=this.points[0].point,a=t.x,n=t.y,r=t.is_invalid,l=t.tagger,i=t.remarks,c=t.observed_data,o="".concat(X.unix(a/1e3).format("dddd, MMMM D, HH:mm"),"<br/>")+"- Rain: <b>".concat(n,"</b>");if(r){var s=l.first_name,m=l.last_name;o+="<br/>- Observed Data: <b>".concat(no[c],"</b><br/>")+"- Tagger: <b>".concat(s," ").concat(m,"</b><br/>")+"- Remarks: <b>".concat(i||"---","</b>")}return o}},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},exporting:{menuItemDefinitions:{tagInvalidData:{onclick:function(){fc.a.fireEvent(this,"selection",{is_tagging_data:!a,rain_gauge:m,rain_id:u,setTaggingData:r}),n(!a)},text:a?"Exit tagging":"Tag invalid data"}},buttons:{contextButton:{menuItems:["tagInvalidData","viewFullscreen","separator","downloadPNG","downloadJPEG","downloadPDF","downloadSVG"]}}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}function mo(e,t){var a=e.set,n=e.series_data,r=a.distance,l=a.max_72h,i=a.threshold_value,c=a.gauge_name,o=t.ts_start,s=t.ts_end;t.site_code;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Cumulative Rainfall Chart of ".concat(po(r,c),"</b><br/>As of: <b>").concat(X(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},xAxis:{min:Date.parse(o),max:Date.parse(s),type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:bo}},yAxis:{title:{text:"<b>Value (mm)</b>"},max:Math.max(0,l-parseFloat(i))+parseFloat(i),min:0,plotBands:[{value:Math.round(10*parseFloat(i/2))/10,color:ro["24h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"24-hr threshold (".concat(i/2,")")}},{value:i,color:ro["72h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"72-hr threshold (".concat(i,")")}}]},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}var uo=function(e){var t,a=e.match.params,l=a.rain_gauge,i=a.site_code,c=e.input,s=e.disableBack,m=e.currentUser,u=e.saveSVG,d="undefined"!==typeof l?1:4,b=Object(n.useState)([]),g=Object(o.a)(b,2),f=g[0],E=g[1],v=Object(n.useState)([]),_=Object(o.a)(v,2),O=_[0],j=_[1],x=Object(n.useState)({label:"3 days",unit:"days",duration:3}),k=Object(o.a)(x,2),S=k[0],C=k[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useRef)(Object(ye.a)(Array(d)).map((function(){return{instantaneous:Object(n.createRef)(),cumulative:Object(n.createRef)()}}))),T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)([]),B=Object(o.a)(H,2),P=B[0],L=B[1],F="undefined"!==typeof s&&s,U="undefined"!==typeof u&&u,q="",W="";if("undefined"!==typeof c){var z=c.ts_end;q=z,t=X(z),W=i}else{var G=X();q=G.format("YYYY-MM-DD HH:mm:ss"),t=G,W=l.substr(0,3)}var V=S.unit,Q=se(t,S.duration,V),Z={days_diff:t.diff(X(Q,"YYYY-MM-DD HH:mm:ss"),"days"),ts_start:Q,ts_end:q,site_code:W},K=Object(n.useState)(!1),J=Object(o.a)(K,2),$=J[0],ee=J[1],ae=Object(n.useState)(null),re=Object(o.a)(ae,2),le=re[0],ie=re[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),me=oe[0],ue=oe[1],de={cumulative:mo(ao,Z),instantaneous:so(ao,Z,$,ee,ie)},pe=function(){j([]),function(e,t){var a=e.site_code,n=e.ts_end,r=e.days_diff,l="".concat(te.b,"/api/rainfall/get_rainfall_plot_data/").concat(a,"/").concat(n,"/").concat(r);ne.a.get(l).then((function(e){var a=e.data;console.log("Rainfall Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(Z,(function(e){var t=e;"undefined"!==typeof l&&(t=e.filter((function(e){return e.gauge_name==="rain_".concat(l)}))),E(t)}))};Object(n.useEffect)((function(){pe()}),[S]),Object(n.useEffect)((function(){w&&(pe(),I(!1))}),[w]),Object(n.useEffect)((function(){var e=[];f.forEach((function(t){var a=lo(t);e.push(a)})),e.length>0&&j(e)}),[f]);var be=Object(n.useState)([]),ge=Object(o.a)(be,2),fe=ge[0],Ee=ge[1];Object(n.useEffect)((function(){var e=[];O.forEach((function(t){var a=so(t,Z,$,ee,ie),n=mo(t,Z);e.push({instantaneous:a,cumulative:n})})),Ee(e),e.length>0&&U&&R(!0)}),[O,$]),Object(n.useEffect)((function(){$&&ue(!0)}),[le]),Object(n.useEffect)((function(){if(Y){var e=[];M.current.forEach((function(t){var a=t.instantaneous,n=t.cumulative,r=a.current.chart,l=n.current.chart.getSVGForExport(),i=r.getSVGForExport();e.push({c:l,i:i})})),L(e)}}),[Y]);var ve=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(P.length>0){var e=ve.current.outerHTML;Nc({user_id:m.user_id,site_code:i,chart_type:"rainfall",svg:e},(function(e){}))}}),[P]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},!F&&r.a.createElement("div",null,r.a.createElement(Fc,e)),r.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},r.a.createElement(Wc,{selectedRangeInfo:S,setSelectedRangeInfo:C,disableAll:!0}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},M.current.map((function(e,t){var a=Object(p.a)({},de);return fe.length>0&&(a=fe[t]),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,options:a.instantaneous,ref:e.instantaneous}))),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,options:a.cumulative,ref:e.cumulative}))))})))),r.a.createElement(to,{isOpen:me,closeModalFn:function(){return ue(!1)},taggingData:le,onTagSuccess:function(){fc.a.fireEvent(le.chart,"selection",{is_tagging_data:!1}),ee(!1),I(!0)}}),U&&r.a.createElement(Xe.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:1600,viewBox:"0 0 1200 1600",ref:ve},P.map((function(e,t){var a=e.i,l=e.c;return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:0,y:400*t,dangerouslySetInnerHTML:{__html:a}}),r.a.createElement("svg",{x:600,y:400*t,dangerouslySetInnerHTML:{__html:l}}))})))))};function po(e,t){var a=t.toUpperCase().replace("RAIN_","");return null===e?a:"".concat(a," (").concat(e," km away)")}function bo(e){var t=this.chart,a=fc.a.charts;"syncExtremes"!==e.trigger&&a.forEach((function(a){a!==t&&"undefined"!==typeof a&&a.xAxis[0].setExtremes&&a.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})}))}var go=a(442),fo=a.n(go),Eo=a(625);function vo(e){const t=e.length,a=_c.a.scale(["#f00","#0f0","#00f"]).mode("hsl").domain([0,t-1]),n=[...e];for(let r=0;r<t;r+=1)"Cumulative"!==e[r].name&&(n[r].color=a(r).name());return n}function ho(e,t,a,n){const r=t.subsurface_column,l=Math.floor(e.length/25),i="As of: <b>".concat(X().format("D MMM YYYY, HH:mm"),"</b><br>")+"Note: <b>Click a box to access node-level charts.</b><br>";return{series:[{name:"Node Health",borderColor:"#444444",borderWidth:.5,data:e,rowsize:10,dataLabels:{enabled:!0,style:{textShadow:"none"},formatter(){return"".concat(this.point.id)}},events:{click(e,r){!function(e,t,a){Oo.apply(this,arguments)}(e.point.id,t,e=>{n(e)}),a(!0)}}}],chart:{type:"heatmap",height:160+20*l,marginTop:70,marginBottom:40,resetZoomButton:{position:{x:0,y:-30}}},plotOptions:{series:{cursor:"pointer"}},title:{text:"<b>Node Health Summary of ".concat(r.toUpperCase(),"</b>"),style:{fontSize:"14px"}},subtitle:{text:i,style:{fontSize:"0.75rem"}},xAxis:{visible:!1,categories:[]},yAxis:{reversed:!1,categories:[],title:null,labels:{format:"&ensp;",useHTML:!0}},colorAxis:{stops:[[0,"#7cb5ec"],[.5,"#ffed49"],[1,"#ff1414"]],min:0,max:2},legend:{enabled:!1},tooltip:{formatter(){const e=this.point,t=e.id_date,a=e.flagger,n=e.status,r=e.comment,l=e.id;let i="Ok",c="";if("undefined"!==typeof n){switch(n){case 2:i="Use with Caution";break;case 3:i="Spacial Case";break;case 4:i="Not Ok";break;default:i="Ok"}c="Identification Date: <b>".concat(X(t).format("DD MMM YYYY"),"</b><br/>")+"Comment: <b>".concat(r,"</b><br/>Flagger: <b>").concat(a,"</b>")}return"Node ID: <b>".concat(l,"</b><br/>Status: <b>").concat(i,"</b><br/>").concat(c)}},credits:{enabled:!1}}}function _o(e,t){const a=[];return e.forEach(e=>{const n=e.series_name,r=e.data,l=[];r.forEach(e=>{const t=e.series;l.push(...function(e){const t=[];return e.forEach(e=>{const a={x:e.data[0],y:e.data[1],name:e.data[2]};e.name.includes("Raw")&&(e.visible=!1),t.push(Object(p.a)(Object(p.a)({},e),{},{name:e.name,data:a}))}),e.data=[...t],e}(t))}),a.push(function(e,t,a){const n=a.subsurface_column,r=a.ts_start,l=a.ts_end,i=a.node_id,c="battery"===e?1:3,o=e.slice(0,c).toUpperCase()+e.slice(c);return{series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400},title:{text:"<b>".concat(o," Plot of ").concat(n.toUpperCase(),"</b>"),style:{fontSize:"10px"},margin:20,y:16},subtitle:{text:"Source: <b>Node ".concat(i,"</b><br/>As of: <b>").concat(X(r).format("D MMM YYYY, HH:mm")," - ").concat(X(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"9px"}},xAxis:{min:Date.parse(r),max:Date.parse(l),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Value</b>"}},tooltip:{crosshairs:!0,shared:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{itemStyle:{fontSize:"10px"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},time:{timezoneOffset:-480},credits:{enabled:!1}}}(n,l,t))}),a}function yo(e){const t=e.show,a=e.setNodeLevelChart,l=e.data,i=e.setData,c=()=>{a(!1),i(null)};return r.a.createElement(Oe.a,{open:t,onClose:c,maxWidth:"lg",fullWidth:!0},null!==l?r.a.createElement(n.Fragment,null,r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0,spacing:1},l.map((e,t)=>r.a.createElement(y.a,{item:!0,xs:12,key:t},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,options:e,allowChartUpdate:!0,callback:e=>e.reflow()})))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:c,color:"secondary",autoFocus:!0},"Close"))):r.a.createElement(_i.a,null))}function Oo(){return(Oo=Object(Eo.a)(fo.a.mark((function e(t,a,n){var r;return fo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Tc(r=Object(p.a)(Object(p.a)({},a),{},{node_id:t}),e=>{const t=_o(e,r);n(t)});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}dc()(fc.a),window.moment=X,vc()(fc.a);var jo=function(e){const t=e.match.params.tsm_sensor,a=e.width,l=e.input,i=e.disableBack,c=e.saveSVG,s=e.currentUser,m=e.isEOS;let u,d="",b=t;const g=Object(n.useState)({label:"3 days",unit:"days",duration:3}),f=Object(o.a)(g,2),E=f[0],v=f[1],_=Object(n.useState)({label:"4 hours",hour_value:"4"}),O=Object(o.a)(_,2),j=O[0],x=O[1];if("undefined"!==typeof l){const e=l.ts_end,t=l.tsm_sensor;d=e,u=X(e),b=t}else{const e=X();d=e.format("YYYY-MM-DD HH:mm:ss"),u=e}const k=E.unit,S=se(u,E.duration,k),C="undefined"!==typeof i&&i,D="undefined"!==typeof c&&c,A=Object(n.useState)([]),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useRef)([...Array(6)].map(()=>Object(n.createRef)())),N=Object(n.useState)(!1),Y=Object(o.a)(N,2),R=Y[0],H=Y[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=j.hour_value,q={ts_end:d,ts_start:S,subsurface_column:b,hour_value:U,include_comms_health:!m},W=Object(Ge.b)(a,"sm"),z={title:{text:"Loading"}},G=Object(n.useState)([{title:{text:"Loading"}}]),V=Object(o.a)(G,2),Q=V[0],Z=V[1],K=Object(n.useState)(null),J=Object(o.a)(K,2),$=J[0],ee=J[1],ae=Object(n.useState)(null),re=Object(o.a)(ae,2),le=re[0],ie=re[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),me=oe[0],ue=oe[1],de=Object(n.useState)(null),pe=Object(o.a)(de,2),be=pe[0],ge=pe[1];Object(n.useEffect)(()=>{M([]),ie(null),function(e,t){var a=e.subsurface_column,n=e.ts_end,r=e.ts_start,l=e.hour_value,i=e.include_comms_health,c="".concat(te.b,"/api/subsurface/get_subsurface_plot_data/")+"".concat(a,"/").concat(n,"/").concat(r,"/").concat(l)+"?include_comms_health=".concat(i);ne.a.get(c).then((function(e){var a=e.data;console.log("Subsurface Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(q,e=>{const t=[];e.forEach(({type:e,data:a})=>{const n=JSON.parse(JSON.stringify(a));let r=[];if("column_position"===e?r=function(e,t){const a=e.data,n=[];return a.forEach(({orientation:a,data:r})=>{const l=vo(r);l.forEach(e=>{e.turboThreshold=1e5});const i=Object(p.a)(Object(p.a)({},e),{},{data:l,orientation:a,type:t});n.push(i)}),n}(n,e):"displacement"===e?r=function(e,t){const a=[];return e.forEach((e,n)=>{const r=e.data,l=e.annotations;r[0].type="area";const i=vo(r);i.forEach(e=>{e.turboThreshold=1e5}),l.forEach(e=>{e.width=0,e.label.style={color:"gray"}});const c=Object(p.a)(Object(p.a)({},e),{},{data:i,annotations:l,type:t});a.push(c)}),a}(n,e):"velocity_alerts"===e&&(r=function(e,t){const a=e.velocity_alerts,n=e.timestamps_per_node,r=[],l=vo(n);return a.forEach(e=>{const a=e.orientation,n=e.data,i=[...l];Object.keys(n).forEach(e=>{const t="L2"===e?7:10,a="L2"===e?"#FFFF00":"#FF0000",r={data:n[e],type:"scatter",zIndex:5,name:e,marker:{symbol:"triangle",radius:t,fillColor:a,lineColor:"#000000",lineWidth:2}};i.push(r)});const c={data:i,type:t,orientation:a};r.push(c)}),r}(n,e)),"comms_health"===e){const e=function(e,t){const a=t.subsurface_column,n=t.ts_start,r=t.ts_end;return{series:e.data,chart:{type:"column",height:300,resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Communication Health Chart of ".concat(a.toUpperCase(),"</b>"),style:{fontSize:"14px"},margin:20,y:16},subtitle:{text:"Range: <b>".concat(X(n).format("D MMM YYYY, HH:mm")," - ").concat(X(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"12px"}},xAxis:{min:1,title:{text:"<b>Node number</b>"},allowDecimals:!1},yAxis:{min:0,max:100,title:{text:"<b>Health Percentage (%)</b>"}},tooltip:{crosshairs:!0,shared:!0,headerFormat:"Node {point.x}<br/>"},legend:{align:"right",verticalAlign:"middle",layout:"vertical"},credits:{enabled:!1}}}(a,q);ie(e)}else t.push(...r)}),M(t)})},[E,j]),Object(n.useEffect)(()=>{const e=[];I.forEach(t=>{const a=t.type;let n;"column_position"===a?n=function(e,t,a){const n=e.data,r=e.max_position,l=e.min_position,i=e.orientation,c=t.subsurface_column,o="across_slope"===i?"Across Slope":"Downslope";return{series:n,chart:{type:"scatter",zoomType:"x",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Column Position Plot of ".concat(c.toUpperCase(),"</b>"),style:{fontSize:"1rem"}},plotOptions:{series:{lineWidth:2,states:{hover:{enabled:!0,lineWidth:5}},marker:{enabled:!0,radius:3,lineColor:null}}},tooltip:{formatter(){return"Timestamp: <b>".concat(X(this.series.name).format("dddd, MMM D, HH:mm"),"</b><br>Depth: <b>").concat(this.y,"</b><br>Displacement: <b>").concat(this.x,"</b>")}},xAxis:{min:l,max:r+.02,gridLineWidth:1,title:{text:"<b>Horizontal displacement, ".concat(o," (m)</b>")}},yAxis:{title:{text:"<b>Depth (m)</b>"}},credits:{enabled:!1},legend:{enabled:!0,align:a?"right":"center",layout:a?"vertical":"horizontal",verticalAlign:a?"middle":"bottom",labelFormatter(){return"".concat(X(this.name).format("MM/DD, HH:mm"))}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q,W):"displacement"===a?n=function(e,t){const a=e.orientation,n=e.data,r=e.annotations,l=t.subsurface_column,i=t.ts_end;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Displacement Plot, ".concat("across_slope"===a?"Across Slope":"Downslope"," of ").concat(l.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(X(i).format("D MMM YYYY, HH:mm"),"</b><br><br><b>Note: </b> (+/-) consistently increasing/decreasing trend"),style:{fontSize:"0.6rem"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{plotBands:r,title:{text:"<b>Relative Displacement (mm)</b>"}},tooltip:{header:"{point.x:%Y-%m-%d}: {point.y:.2f}"},plotOptions:{spline:{marker:{enabled:!0}}},credits:{enabled:!1},legend:{enabled:!1},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q):"velocity_alerts"===a&&(n=function(e,t){const a=e.data,n=e.orientation,r=t.subsurface_column,l=t.ts_end,i="across_slope"===n?"Across Slope":"Downslope",c=a.map(e=>e.name).filter(e=>"number"===typeof e);return c.unshift(0),{series:a,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Velocity Alerts Plot, ".concat(i," of ").concat(r.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(X(l).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.6rem"}},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Time</b>"}},legend:{enabled:!1},yAxis:{categories:c,reversed:!0,title:{text:"<b>Nodes</b>"},labels:{formatter(){return this.value}}},tooltip:{formatter(){return"<b>".concat(X(this.x).format("DD MMM YYYY, HH:mm"),"</b>")}},plotOptions:{line:{marker:{enabled:!0,radius:2}}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,q)),e.push(n)}),Z(e),e.length>0&&D&&H(!0)},[I]),Object(n.useEffect)(()=>{!function(e,t){var a=e.subsurface_column,n="".concat(te.b,"/api/subsurface/get_subsurface_node_health/").concat(a);ne.a.get(n).then((function(e){var a=e.data;console.log("Subsurface Node Health Data",a),t(a)})).catch((function(e){console.error(e)}))}(q,e=>{const t=ho(function(e,t){const a=[];return e.forEach((e,t)=>{const n=e.id,r=e.status;let l="";2===r?l="#f9ff40":3===r?l="#ff8400":4===r&&(l="#ff6961");const i=Object(p.a)(Object(p.a)({name:t+1},e),{},{value:0,id:n+1,color:l});a.push(i)}),a}(e),q,ue,e=>{ge(e)});ee(t)})},[]),Object(n.useEffect)(()=>{if(R){const e=[];T.current.forEach(t=>{const a=t.current;if(null!==a){const t=a.chart.getSVGForExport();e.push(t)}}),F(e)}},[R,T]);const fe=Object(n.useRef)(null);return Object(n.useEffect)(()=>{if(L.length>0){const e=fe.current.outerHTML;Nc({user_id:s.user_id,tsm_sensor:b,site_code:l.site_code,chart_type:"subsurface",svg:e},e=>{})}},[L]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},!C&&r.a.createElement(y.a,{item:!0,sm:!0},r.a.createElement(Fc,e)),r.a.createElement(Wc,{isSubsurface:!0,selectedRangeInfo:E,setSelectedRangeInfo:v,selectedHourInterval:j,setSelectedHourInterval:x})),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},$&&r.a.createElement(y.a,{item:!0,xs:12,md:12},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,allowChartUpdate:!0,options:$}))),0===Q.length&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6,key:1},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,options:z}))),r.a.createElement(y.a,{item:!0,xs:12,md:6,key:2},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,options:z})))),le&&r.a.createElement(y.a,{item:!0,xs:12,md:12},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,allowChartUpdate:!0,options:le}))),Q.map((e,t)=>{const a=T.current[t];return r.a.createElement(y.a,{item:!0,xs:12,md:6,key:t},r.a.createElement(h.a,null,r.a.createElement(bc.a,{highcharts:fc.a,allowChartUpdate:!0,options:e,ref:a})))}))),D&&r.a.createElement(Xe.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:2400,viewBox:"0 0 1200 2400",ref:fe},L.map((e,t)=>{const a=t%2===1?0:600,l=800*Math.floor(t/2);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:a,y:l,dangerouslySetInnerHTML:{__html:e}}))}))),r.a.createElement(yo,{show:me,setNodeLevelChart:ue,data:be,setData:ge}))};var xo=function(e){const t=e.match.params.site_code,a=e.location,n=a.site,l=a.ts_end,i=a.to_include;let c=l,o=a.subsurface_columns,s=Object(p.a)({},i);"undefined"===typeof n&&(c=$()(),o=[],s={rainfall:!0,surficial:!0});const m={site_code:t,ts_end:c.format("YYYY-MM-DD HH:mm:ss")};return r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Fc,e)),s.rainfall&&r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(uo,Object.assign({},e,{input:m,disableBack:!0}))),s.surficial&&r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:16}},r.a.createElement(eo,Object.assign({},e,{input:m,disableBack:!0}))),o.map(t=>{const a=Object(p.a)(Object(p.a)({},m),{},{tsm_sensor:t});return r.a.createElement(y.a,{key:t,item:!0,xs:12},r.a.createElement(jo,Object.assign({},e,{input:a,disableBack:!0})))}))};var ko=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.isMobile,c=e.url,s=Object(n.useState)({value:null,data:{site_code:null}}),u=Object(o.a)(s,2),d=u[0],g=u[1],f=Object(n.useState)($()()),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)({rainfall:!0,surficial:!0,subsurface:{}}),j=Object(o.a)(_,2),x=j[0],k=j[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),D=C[0],A=C[1],w=(e,t=null)=>a=>{const n=a.target.checked;let r=n;if(null!==t){const e=x.subsurface;e[t]=n,r=e}k(Object(p.a)(Object(p.a)({},x),{},{[e]:r}))};Object(n.useEffect)(()=>()=>{h($()())},[a]),Object(n.useEffect)(()=>{const e=d.data.site_code;null!==e&&function(e,t){var a="".concat(te.b,"/api/subsurface/get_site_subsurface_columns/").concat(e);ne.a.get(a).then((function(a){var n=a.data;console.log("Subsurface Columns of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(e,e=>{A([]);const t={};e.forEach(e=>{const a=null===e.date_deactivated;t[e.logger.logger_name]=a}),k(Object(p.a)(Object(p.a)({},x),{},{subsurface:t})),A(e)})},[d.data.site_code]);const I=d.data,M=[];return Object.keys(x.subsurface).forEach(e=>{x.subsurface[e]&&M.push(e)}),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Consolidate charts per site"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wa,{value:d,changeHandler:e=>g(e)})),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:v,onChange:e=>h(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:18}},r.a.createElement(Dt.a,{component:"fieldset"},r.a.createElement(Xt.a,{component:"legend"},"Charts to Show"),r.a.createElement(Ua.a,{"aria-label":"position",row:!0},r.a.createElement(wt.a,{value:"rainfall",control:r.a.createElement(Jt.a,{color:"primary",onClick:w("rainfall"),checked:x.rainfall}),label:"Rainfall"}),r.a.createElement(wt.a,{value:"surficial",control:r.a.createElement(Jt.a,{color:"primary",onClick:w("surficial"),checked:x.surficial}),label:"Surficial"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:8}},r.a.createElement(Dt.a,{component:"fieldset"},r.a.createElement(Xt.a,{component:"legend"},"Subsurface Columns"),r.a.createElement(Ua.a,{"aria-label":"position",row:!0},D.map(e=>{const t=e.date_deactivated,a=e.logger.logger_name,n=null===t?"":" (Deactivated)";return r.a.createElement(wt.a,{key:a,value:a,control:r.a.createElement(Jt.a,{color:"primary",onClick:w("subsurface",a),checked:x.subsurface[a]}),label:a.toUpperCase()+n})}),0===D.length&&r.a.createElement(O.a,{variant:"body1"},"No site selected")))),!i&&r.a.createElement("div",{style:{height:120}})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{component:m.b,to:{pathname:"".concat(c,"/consolidated/").concat(I.site_code),ts_end:v,site:I,to_include:x,subsurface_columns:M},color:"primary",onClick:l,disabled:null===d.value},"View"),r.a.createElement(b.a,{onClick:l},"Cancel")))}));var So=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.isOpen,l=e.clickHandler,i=e.setReloadEqEvent,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(null),g=Object(o.a)(p,2),E=g[0],v=g[1],h=Object(n.useState)(0),_=Object(o.a)(h,2),O=_[0],j=_[1],x=Object(n.useState)(0),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)($()()),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!0),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(c.b)(),B=H.enqueueSnackbar,P=H.closeSnackbar,L=Object(k.a)(),F=L.first_name,U=L.last_name,q=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{P(e)}},"Dismiss");Object(n.useEffect)(()=>M($()()),[a]),Object(n.useEffect)(()=>{R(!(E>0&&O>0&&C>0&&u>=0&&u<=10))},[E,u,C,O]);const W=()=>{const e="".concat(F," ").concat(U).split(" ");let t="";e.forEach(e=>{t+=e.charAt(0)});!function(e,t){var a="".concat(te.b,"/api/analysis/insert_earthquake_event");ne.a.post(a,e).then((function(e){t(e)})).catch((function(e){console.error(e)}))}({magnitude:u,depth:E,long:O,lat:C,timestamp:I.format("YYYY-MM-DD HH:mm"),issued_by:t},e=>{200===e.status?(B("Success saving earthquake event",{variant:"success",autoHideDuration:7e3,action:q}),i(!0)):B("Error saving earthquake event",{variant:"error",autoHideDuration:7e3,action:q})}),l(!1)},z=(u>10||u<=0)&&null!==u,G=E<=0&&null!==u;return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Insert Earthquake Event"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:I,onChange:e=>M(e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Magnitude",onChange:e=>d(e.target.value),type:"number",InputProps:{inputProps:{max:10,min:1}},fullWidth:!0,helperText:z?"Insert magnitude from 0.1 to 10":"",error:z}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Depth (km)",defaultValue:"",onChange:e=>v(e.target.value),type:"number",fullWidth:!0,helperText:G?"Positive numbers only":"",error:G}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{type:"number",required:!0,label:"Latitude",defaultValue:"",onChange:e=>D(e.target.value)}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{component:"fieldset",fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Longitude",type:"number",defaultValue:"",onChange:e=>j(e.target.value)}))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:()=>W(),disabled:Y},"Submit"),r.a.createElement(b.a,{onClick:l,color:"secondary"},"Cancel")))})),Co=a(61),Do=a.n(Co),Ao=(a(599),a(1210)),wo=a(1253),Io=a(1211),Mo=a(1212),To=a(1254),No=a(1213),Yo=a(1214),Ro=a(626),Ho=a.n(Ro),Bo=a(627),Po=a.n(Bo),Lo=a(628),Fo=a.n(Lo);const Uo=Do.a.icon({iconUrl:Ho.a,shadowUrl:Po.a,iconRetinaUrl:Fo.a,iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],shadowAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});var qo=function(e){const t=e.eqEvents;let a=[12.8797,121.774],l=5;if(e.zoomIn){const e=t[0];a=[e.latitude,e.longitude],l=7}const i=Object(n.useRef)(),c=1===t.length,s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1];Object(n.useEffect)(()=>{c&&d(!0)},[t]),Object(n.useEffect)(()=>{u&&(null!==i&&i.current.leafletElement.openPopup(),d(!1))},[u]);const p=/\.0*$|(?<=\.[0-9]{0,2147483646})0*$/;return r.a.createElement(Ao.a,{style:{height:465},center:a,zoom:l},r.a.createElement(wo.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((e,t)=>{const a=e.latitude,l=e.longitude,o=e.magnitude,s=e.depth,m=e.critical_distance,u=e.eq_id,d=e.processed,b=[a,l],g=null===m?0:parseFloat(m);return r.a.createElement(n.Fragment,{key:u},r.a.createElement(Io.a,{center:b,fillColor:"blue",radius:1e3*g}),r.a.createElement(Mo.a,{icon:Uo,position:b,ref:c?i:Object(n.createRef)()},r.a.createElement(To.a,null,"Magnitude: ",r.a.createElement("strong",null,o.replace(p,""))," ",r.a.createElement("br",null),"Depth: ",r.a.createElement("strong",null,s.replace(p,""))," ",r.a.createElement("br",null),"Critical Distance: ",r.a.createElement("strong",null,g," km")," ",r.a.createElement("br",null),"Processed: ",r.a.createElement("strong",null,d?"Yes":"No"))))}),r.a.createElement(No.a,{style:{zIndex:550}},Lr.map(e=>r.a.createElement(Yo.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},r.a.createElement(To.a,null,r.a.createElement("strong",null,e.site_code.toUpperCase())," ",r.a.createElement("br",null),re(e,!1))))))};const Wo=Object(hl.a)({overrides:{MUIDataTableBodyCell:{root:{whiteSpace:"nowrap"}}}}),zo=[{name:"Timestamp"},{name:"Magnitude"},{name:"Issuer"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}}],Go=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}},{name:"Sites",options:{filter:!1}}];var Vo=function(e){const t=e.eqEvents,a=e.eqAlerts,n=e.eqAlertsPagination,l=e.setEqAlTblPage,i=r.a.useState(0),c=Object(o.a)(i,2),s=c[0],m=c[1],u=r.a.useState([]),d=Object(o.a)(u,2),b=d[0],g=d[1],f=r.a.useState([]),E=Object(o.a)(f,2),v=E[0],h=E[1];r.a.useEffect(()=>{g([...t]);const e=t.map(e=>[$()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.issuer.toUpperCase(),e.eq_id]);h([...e])},[t]);const _=(e,t)=>{const a=t.filter(t=>t.eq_id===e);g([...a])},j=r.a.useState([]),x=Object(o.a)(j,2),k=x[0],S=x[1];r.a.useEffect(()=>{const e=a.map(e=>{const t=e.eq_alerts.map(e=>e.site.site_code.toUpperCase());return[$()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id,t.join(", ")]});S([...e])},[a]);const C={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"standard",onRowClick(e,a,n){_(e[3],t)}},D={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",count:n.count,rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard",serverSide:!0,onChangePage:e=>{const t=e*n.limit;l(Object(p.a)(Object(p.a)({},n),{},{offset:t}))},onRowClick(e,t,n){_(e[2],a)}};return r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(qo,{eqEvents:b,zoomIn:1===b.length})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(T.a,{position:"static"},r.a.createElement(Le.a,{value:s,onChange:(e,t)=>m(t),variant:"fullWidth"},r.a.createElement(Fe.a,{label:"EQ Events"}),r.a.createElement(Fe.a,{label:"EQ Alerts"}))),0===s&&r.a.createElement(_l.a,{theme:Wo},r.a.createElement(vl.a,{title:"Latest Earthquake Events",columns:zo,options:C,data:v,style:{height:465}})),1===s&&r.a.createElement(_l.a,{theme:Wo},r.a.createElement(vl.a,{title:r.a.createElement(O.a,{variant:"body1"},"Earthquake Alerts"),columns:Go,options:D,data:k}))))};function Qo(e){const t=e.clickHandler;return r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:t,startIcon:r.a.createElement(nt.a,null)},"Insert MOMs")}function Zo(e){return $()(e).format("D MMMM YYYY, HH:mm")}function Ko(e){const t=e.first_name,a=e.last_name;return"".concat(t," ").concat(a)}function Jo(e){const t=e.moms_data,a=e.match.params.instance_id,n=t.find(e=>e.instance_id===parseInt(a,10));let l=[],i="";if("undefined"!==typeof n){l=n.moms;const e=n.feature.feature_type,t=n.feature_name;i="".concat(e," - ").concat(t)}const c=function(e){return e.map(e=>{const t=e.observance_ts,a=e.narrative,n=e.reporter,r=e.validator,l=e.op_trigger,i=e.remarks,c=a.narrative,o=a.timestamp;return[Zo(t),c,Zo(o),Ko(n),Ko(r),i,l]})}(l);return r.a.createElement(h.a,{style:{marginTop:16}},r.a.createElement(vl.a,{title:r.a.createElement(O.a,{variant:"h6"},"Manifestation of Movement Reports ",r.a.createElement("span",{style:{fontSize:"small"}},i.toUpperCase())),columns:["Observance Timestamp","Narrative","Report Timestamp","Reporter","Validator","Remarks","Alert Level"],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard"},data:c}))}var Xo,$o=function(e){const t=e.history,a=e.match,l=a.url,i=a.params.site_code,c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],d=s[1],p=Object(n.useState)([]),b=Object(o.a)(p,2),g=b[0],f=b[1];Object(n.useEffect)(()=>{!function(e,t){var a="".concat(te.b,"/api/manifestations_of_movement/get_moms_instances/").concat(e);ne.a.get(a).then((function(a){var n=a.data;console.log("MOMs Instances of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(i,e=>{const t=e.map(e=>{const t=e.feature.feature_type,a=e.feature_name,n=e.moms,r=e.instance_id,l=e.location,i=t.charAt(0).toUpperCase()+t.slice(1),c=n[0];let o=[];if("undefined"!==typeof c){const e=c.observance_ts,t=c.op_trigger;o=[i,a,l,Zo(e),t,r]}return o}).filter(e=>e.length>0).sort((e,t)=>t[4]-e[4]);f(t),d(e)})},[]);const E=Object(n.useState)(!1),v=Object(o.a)(E,2),_=v[0],y=v[1],O=e=>()=>y(e);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(Fc,e),r.a.createElement(Qo,{clickHandler:O(!0)})),r.a.createElement(h.a,{style:{marginTop:16}},r.a.createElement(vl.a,{title:"Manifestation of Movement Features of ".concat(i.toUpperCase()),columns:["Type",{name:"Name",options:{filter:!1}},{name:"Location",options:{filter:!1}},{name:"Last Observance Timestamp",options:{filter:!1}},"Alert Level",{name:"data",options:{display:!1,viewColumns:!1,filter:!1}}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"standard",onRowClick(e,a,n){const r=e[5];t.push("".concat(l,"/").concat(r))}},data:g})),r.a.createElement(ol,Object.assign({},e,{isOpen:_,closeHandler:O(!1)})),r.a.createElement(u.b,{path:"".concat(l,"/:instance_id"),render:e=>r.a.createElement(Jo,Object.assign({},e,{moms_data:m}))}))};dc()(mc.a);var es=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{tabBar:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:30}})})),ts=function(){return r.a.createElement(ft.a,{height:600,width:400,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},r.a.createElement("rect",{x:"0",y:"0",rx:"0",ry:"0",width:"400",height:"600"}))};function as(e,t){return r.a.createElement("span",null,r.a.createElement(b.a,{"aria-label":"Insert Earthquake Event",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:t(!0),startIcon:r.a.createElement(cc.a,null)},"Insert Earthquake Event"),r.a.createElement(b.a,{"aria-label":"Consolidate by site",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:e(!0),startIcon:r.a.createElement(oc.a,null)},"Consolidate by site"))}function ns(e,t){var a=[];return e&&0!==Object.keys(e).length&&e.xAxis[0]&&e.series[0].points.forEach((function(e){a.push(function(e,t){var a=t.data,n=t.type,i=t.dataLabel;return r.a.createElement("div",{key:a},Object(l.createPortal)(r.a.createElement(m.b,{to:"".concat(e,"/").concat(n,"/").concat(a),style:{fontSize:i.options.style.fontSize,position:"absolute",fontFamily:"Lucida Grande, Lucida Sans Unicode, Arial Helvetica, sans-serif",color:"#000000"}},a.toUpperCase()),i.div))}(t,e))})),a}function rs(e,t,a){var n=t.charAt(0).toUpperCase()+t.slice(1),r="<b>".concat(n," Data Availability</b>"),l=60,i="Timestamp: <b>".concat(Xo.format("D MMM YYYY, HH:mm"),"</b>");switch(t){case"surficial":i+="<br/>Note: Data presence within four hours<br/>until next release for event sites<br/>Data presence from 6AM to 12NN for <br/>routine and extended sites<br/><b>*Sites without markers</b>";break;case"subsurface":i+="<br/>Note: Data presence of raw data (not yet filtered)",95;break;case"loggers":95,l=100}return e&&l,{chart:{type:"heatmap",height:700,spacingTop:12,spacingRight:18},title:{text:r,style:{fontSize:"1rem"},y:20},subtitle:{text:i,style:{fontSize:"0.70rem"}},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},colorAxis:{stops:[[0,"#cccccc"],[1,"#7cb5ec"]],min:0,max:1},tooltip:{outside:!0,formatter:function(){var e,t=this.point,a=t.label,n=t.type,r=t.value,l=t.event_type,i=t.ts_last_data,c=t.ts_updated,o=t.diff_days,s=r?"With":"No";switch(n){case"rainfall":e="Rain gauge";break;case"surficial":e="Site";break;case"subsurface":e="Sensor";break;case"loggers":e="Logger"}var m="".concat(e,": <b>").concat(a,"</b><br/>")+"Presence: <b>".concat(s," data</b><br/>")+"Last data timestamp: <b>".concat($()(i).format("D MMM YYYY, HH:mm"),"</b><br/>");return m+="surficial"!==n?"<br/>Last update timestamp: <b>".concat($()(c).format("D MMM YYYY, HH:mm"),"</b><br/>")+"Days since last data: <b>".concat(o,"</b><br/>"):"Event type: <b>".concat(l,"</b>")}},credits:{enabled:!1},series:[{name:"",borderWidth:1,borderColor:"#444444",data:function(e,t,a){var n=[],r=0;return e.forEach((function(e,a){var l,i,c=e.last_data,o=e.ts_updated,s=e.diff_days,m=e.event_type,u=e.presence;"surficial"===t?(i=l=e.site_code,e.has_surficial_markers||(l+="*")):i=l="rainfall"===t?e.rain_gauge.gauge_name:"subsurface"===t?e.tsm_sensor.logger.logger_name:e.logger.logger_name;var d={x:a%5,y:5-r,value:u,label:l.toUpperCase(),data:i,type:t,ts_last_data:c,ts_updated:o,diff_days:s,event_type:m};n.push(d),a%5===4&&(r+=1)})),n}(a,t),dataLabels:{enabled:!0,useHTML:!0,color:"#000000",display:"none",style:{fontWeight:100},formatter:function(){return this.point.label}}}]}}var ls=Object(Ge.a)()((function(e){var t=e.width,a=e.location,l=e.match,i=l.path,c=l.url,d=es(),b=Object(Ge.b)(t,"sm");Xo=$()();var g=Object(n.useState)(!1),f=Object(o.a)(g,2),E=f[0],v=f[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),j=O[0],x=O[1],k=function(e){return function(){return v(e)}},S=function(e){return function(){return x(e)}},C=Object(n.useState)([]),D=Object(o.a)(C,2),A=D[0],w=D[1],I=Object(n.useState)(null),M=Object(o.a)(I,2),T=M[0],N=M[1],Y=Object(n.useState)(null),R=Object(o.a)(Y,2),H=R[0],B=R[1],P=Object(n.useState)([]),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)(null),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(null),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),X=Object(o.a)(J,2),ee=X[0],ae=X[1],le=Object(n.useState)(null),ie=Object(o.a)(le,2),ce=ie[0],oe=ie[1],se=Object(n.useState)(null),me=Object(o.a)(se,2),ue=me[0],de=me[1],pe=Object(n.useState)([]),be=Object(o.a)(pe,2),ge=be[0],fe=be[1],Ee=Object(n.useState)(null),ve=Object(o.a)(Ee,2),he=ve[0],_e=ve[1],Oe=Object(n.useState)({}),je=Object(o.a)(Oe,2),xe=je[0],ke=je[1],Se=Object(n.useContext)(Te).rainfallSummaryData,Ce=Object(n.useState)(null),De=Object(o.a)(Ce,2),Ae=De[0],we=De[1],Ie=function(e){return function(t){ke((function(a){return Object(p.a)(Object(p.a)({},a),{},Object(s.a)({},e,t))}))}};Object(n.useEffect)((function(){Mc("surficial",(function(e){U(e)})),Mc("tsm",(function(e){w(e)})),Mc("rain_gauges",(function(e){ae(e)})),Mc("loggers",(function(e){fe(e)}))}),[]),Object(n.useEffect)((function(){if(F.length>0){var e=rs(!b,"surficial",F);G(e)}}),[F,b]),Object(n.useEffect)((function(){if(A.length>0){var e=rs(!b,"subsurface",A);N(e)}}),[A,b]),Object(n.useEffect)((function(){if(ee.length>0){var e=rs(!b,"rainfall",ee);oe(e)}}),[ee,b]),Object(n.useEffect)((function(){if(ge.length>0){var e=rs(!b,"loggers",ge);_e(e)}}),[ge,b]),Object(n.useEffect)((function(){var e=ns(xe.rainfall,c);de(e)}),[xe.rainfall,c]),Object(n.useEffect)((function(){var e=ns(xe.surficial,c);K(e)}),[xe.surficial,c]),Object(n.useEffect)((function(){var e=ns(xe.subsurface,c);B(e)}),[xe.subsurface,c]),Object(n.useEffect)((function(){if(Se){var e=Se.rainfall_summary,t=Se.ts,a=function(e,t){var a=e.site_codes,n=e.list_1d,r=e.list_3d,l=null===t?"---":$()(t).format("D MMM YYYY, HH:mm");return{chart:{type:"column"},title:{text:"<b>Cumulative Rainfall Data vs Threshold Plot of Dynaslope Sites</b>",style:{fontSize:"1rem"},y:20},subtitle:{text:"As of: <b>".concat(l,"</b><br>Note: Percentage capped at 100%")},xAxis:{categories:a,title:{text:"<b>Sites</b>"}},yAxis:{min:0,max:100,title:{text:"<b>Threshold Ratio (%)</b>"}},tooltip:{shared:!0,useHTML:!0,formatter:function(){var e=this.x,t=this.points,a=t[0].point.data_source.replace(/_/g," "),n="<b>".concat(e," (").concat(a.toUpperCase(),")</b><br>");return t.forEach((function(e){n+="".concat(e.point.data_value,"<br>"),n+="- Percentage: <b>".concat(e.point.y.toFixed(2),"%</b><br>")})),n}},plotOptions:{column:{grouping:!1,shadow:!1}},series:[{name:"Three-day Cumulative Data",data:r,pointPadding:0,color:"#FF0000"},{name:"One-day Cumulative Data",data:n,pointPadding:.2}],credits:{enabled:!1}}}(function(e){var t=[],a=[],n=[];return e.forEach((function(e){var r=e.site_code,l=e["1D cml"],i=e["3D cml"],c=e["half of 2yr max"],o=e["2yr max"],s=e.DataSource,m=l?"".concat(l," mm"):"0 mm",u=i?"".concat(i," mm"):"0 mm",d={y:l/c*100,data_value:"<b><i>One Day Data</i></b><br>- Cumulative Data: <b>".concat(m,"</b><br>- Threshold: <b>").concat(c," mm</b>"),data_source:s},p={y:i/o*100,data_value:"<b><i>Three Day Data</i></b><br>- Cumulative Data: <b>".concat(u,"</b><br>- Threshold: <b>").concat(o," mm</b>"),data_source:s};t.push(d),a.push(p),n.push(r.toUpperCase())})),{list_1d:t,list_3d:a,site_codes:n}}(e),t);we(a)}}),[Se]);var Me=Object(n.useState)([]),Ne=Object(o.a)(Me,2),Ye=Ne[0],Re=Ne[1];Object(n.useEffect)((function(){var e=[];!function(e){var t="".concat(te.b,"/api/manifestations_of_movement/get_latest_alerts");ne.a.get(t).then((function(t){var a=t.data;console.log("MOMs Alerts",a),e(a)})).catch((function(e){console.error(e)}))}((function(t){t.forEach((function(t){var a=t.site_code,n=t.moms_alert,r={site_code:a,address:re(t,!0,"start"),moms_alert:n};e.push(r)})),Re(e)}))}),[c]);var He=[{name:"address",label:"Site",options:{filter:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=Ye[a].site_code;return r.a.createElement(m.b,{to:"".concat(c,"/moms/").concat(n),style:{color:"black"}},e)}}},{name:"moms_alert",label:"Alert"}],Be=Object(n.useState)([]),Pe=Object(o.a)(Be,2),Le=Pe[0],Fe=Pe[1];Object(n.useEffect)((function(){var e=[];!function(e){var t="".concat(te.b,"/api/analysis/get_on_demand_events");ne.a.get(t).then((function(t){var a=t.data;console.log("On Demand Events",a),e(a)})).catch((function(e){console.error(e)}))}((function(t){t.forEach((function(t){var a=t.alert_level,n=t.narrative,r=t.reporter,l=t.request_ts,i=t.tech_info,c=n.event_id,o=re(n.site,!0,"start"),s=c,m=$()(l).format("MMM DD, YYYY hh:mm A"),u={event_id:s,alert_level:a,rep:"".concat(r.first_name," ").concat(r.last_name),ts:m,tech_info:i,address:o};e.push(u)})),Fe(e)}))}),[]);var Ue=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=Le[a].event_id;return r.a.createElement(m.b,{to:"/monitoring/events/".concat(n),style:{color:"blue"}},e)}}},{name:"address",label:"Site"},{name:"ts",label:"Timestamp"},{name:"alert_level",label:"Alert Level"},{name:"rep",label:"Reporter"},{name:"tech_info",label:"Narrative"}],qe=Object(n.useState)([]),We=Object(o.a)(qe,2),ze=We[0],Ve=We[1],Qe=Object(n.useState)(!0),Ze=Object(o.a)(Qe,2),Ke=Ze[0],Je=Ze[1];Object(n.useEffect)((function(){Ke&&(!function(e){var t="".concat(te.b,"/api/analysis/get_earthquake_events");ne.a.get(t).then((function(t){var a=t.data;console.log("Earthquake Events",a),e(a)})).catch((function(e){console.error(e)}))}((function(e){Ve(e)})),Je(!1))}),[Ke]);var Xe=r.a.useState([]),$e=Object(o.a)(Xe,2),et=$e[0],tt=$e[1],at=r.a.useState({limit:5,offset:0,count:0}),nt=Object(o.a)(at,2),rt=nt[0],lt=nt[1],it=r.a.useState(!0),ct=Object(o.a)(it,2),ot=ct[0],st=ct[1];r.a.useEffect((function(){!function(e,t){var a=e.limit,n=e.offset,r="".concat(te.b,"/api/analysis/get_earthquake_alerts")+"?limit=".concat(a,"&offset=").concat(n);ne.a.get(r).then((function(e){var a=e.data;console.log("Earthquake Alerts",a),t(a)})).catch((function(e){console.error(e)}))}(rt,(function(e){var t=e.count,a=e.data;tt(Object(ye.a)(a)),ot&&(st(!1),lt(Object(p.a)(Object(p.a)({},rt),{},{count:t})))}))}),[rt,ot]);var mt=a.pathname===i;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(ut,{title:"Analysis | Site Data Analytics",customButtons:!(!b||!mt)&&as(k,S)})),r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(u.d,{location:a},r.a.createElement(u.b,{exact:!0,path:c,render:function(e){return r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==z?r.a.createElement(h.a,{elevation:2},r.a.createElement(bc.a,{highcharts:mc.a,options:z,callback:Ie("surficial"),allowChartUpdate:!1}),Z):r.a.createElement(ts,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==ce?r.a.createElement(h.a,{elevation:2},r.a.createElement(bc.a,{highcharts:mc.a,options:ce,callback:Ie("rainfall"),allowChartUpdate:!1}),ue):r.a.createElement(ts,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==T?r.a.createElement(h.a,{elevation:2},r.a.createElement(bc.a,{highcharts:mc.a,options:T,callback:Ie("subsurface"),allowChartUpdate:!1}),H):r.a.createElement(ts,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==he?r.a.createElement(h.a,{elevation:2},r.a.createElement(bc.a,{highcharts:mc.a,options:he,callback:Ie("loggers"),allowChartUpdate:!1})):r.a.createElement(ts,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12},null!==Ae?r.a.createElement(h.a,{elevation:2},r.a.createElement(bc.a,{highcharts:mc.a,options:Ae})):r.a.createElement("div",null,"Loading...")),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:7},r.a.createElement(h.a,{elevation:2},r.a.createElement(Vo,{eqEvents:ze,eqAlerts:et,eqAlertsPagination:rt,setEqAlTblPage:lt}))),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:5},r.a.createElement(h.a,{elevation:2},r.a.createElement(vl.a,{title:"Latest MOMs Alert",columns:He,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:6,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard"},data:Ye}))),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:12},r.a.createElement(h.a,{elevation:2},r.a.createElement(vl.a,{title:"Latest On Demand Events",columns:Ue,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"standard"},style:{height:465},data:Le}))))}}),r.a.createElement(u.b,{path:"".concat(c,"/surficial/:site_code"),render:function(e){return r.a.createElement(eo,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/rainfall/:rain_gauge"),render:function(e){return r.a.createElement(uo,Object.assign({},e,{width:t,chartType:"rainfall"}))}}),r.a.createElement(u.b,{path:"".concat(c,"/subsurface/:tsm_sensor"),render:function(e){return r.a.createElement(jo,Object.assign({},e,{width:t,chartType:"subsurface"}))}}),r.a.createElement(u.b,{path:"".concat(c,"/moms/:site_code"),render:function(e){return r.a.createElement($o,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/consolidated/:site_code"),render:function(e){return r.a.createElement(xo,Object.assign({},e,{width:t}))}}))),r.a.createElement(ko,{isOpen:E,clickHandler:k(!1),url:c}),r.a.createElement(So,{isOpen:j,clickHandler:S(!1),setReloadEqEvent:Je}))})),is=a(630),cs=a.n(is);function os(e,t,a,n){const r=t.site,l=t.start_ts,i=t.end_ts,c="Range: <b>".concat($()(l).format("DD MMM YYYY, HH:mm")," - ").concat($()(i).format("DD MMM YYYY, HH:mm"),"</b><br/>")+"Site: <b>".concat(r?r.label:"All","</b><br/>\n    <i>Note: Click on any alert triggers to show related monitoring events.</i>"),o=function(e){const t=["Alert 1","Alert 2","Alert 3"],a=e,n=[],r=[];let l,i;const c=a.length;let o;for(l=0;l<c;l+=1){const e=a[l],c=e.y,s=e.color,m=e.drilldown;n.push({name:t[l],y:c,color:s});const u=m.data,d=m.categories,p=m.trigger_events;for(o=u.length,i=0;i<o;i+=1)r.push({name:d[i],y:u[i],color:_c()(s).brighten(.5*(i+1)).hex(),alert_events:p[i]})}return{alerts_data:n,trigger_count:r}}(e);return{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"<b>Monitoring Event Alerts Summary</b>",y:22},subtitle:{text:c,style:{fontSize:"0.75rem"}},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{center:["50%","50%"]}},series:[{name:"Alerts",data:o.alerts_data,size:"80%",tooltip:{pointFormat:"Count: <b>{point.y} ({point.percentage:.1f}%)</b>"},dataLabels:{formatter(){return this.y>5?this.point.name:null},color:"#ffffff",distance:-30}},{name:"Count",data:o.trigger_count,size:"80%",innerSize:"60%",dataLabels:{formatter(){return this.y>1?"<b>".concat(this.point.name,":</b> ").concat(this.y):null}},point:{events:{click(e){const t=e.point,r=t.alert_events,l=t.name;a({alert_events:r,name:l}),n.reflow()}}}}],loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var ss=function(e){const t=e.highcharts,a=e.data,l=e.colors,i=e.isLoading,c=e.input,s=e.setSelectedTrigger,m=Object(n.useState)(null),u=Object(o.a)(m,2),d=u[0],b=u[1];let g=[];null!==a&&(g=function(e,t){const a=[];return e.forEach((e,n)=>{const r=Object(p.a)(Object(p.a)({},e),{},{color:t[n]});a.push(r)}),a}(a,l));const f=Object(n.useState)(os(g,c,s,d)),E=Object(o.a)(f,2),v=E[0],h=E[1];return Object(n.useEffect)(()=>{null!==d&&(i?d.showLoading():d.hideLoading())},[d,i]),Object(n.useEffect)(()=>{let e=!1;null!==d&&null!==a&&(h(os(g,c,s,d)),0===a.length&&(e=!0),e?d.showNoData():d.hideNoData())},[d,a]),r.a.createElement(bc.a,{highcharts:t,options:v,callback:e=>b(e)})};function ms(e,t){const a=t.site,n=t.year;return{chart:{type:"column"},title:{text:"<b>Monthly Monitoring Event Alerts</b>",y:22},subtitle:{text:"Year: <b>".concat(n,"</b><br/>")+"Site: <b>".concat(a?a.label:"All","</b>"),style:{fontSize:"0.75rem"}},series:e,xAxis:{categories:["January","February","March","April","May","June","July","August","September","October","November","December"]},yAxis:{min:0,title:{text:"<b>Number of heightened alerts</b>"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:mc.a.defaultOptions.title.style&&mc.a.defaultOptions.title.style.color||"gray"}}},legend:{backgroundColor:mc.a.defaultOptions.legend.backgroundColor||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,reversed:!0},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,formatter(){return 0===this.y?"":this.y}}}},loading:{hideDuration:2e3},lang:{noData:"No alert within this period"},credits:{enabled:!1}}}var us=function(e){const t=e.highcharts,a=e.data,l=e.colors,i=e.isLoading,c=e.input,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1];let b=[];null!==a&&(b=function(e,t){const a=[];return e.forEach((e,n)=>{const r=Object(p.a)(Object(p.a)({},e),{},{color:t[n]});a.push(r)}),a}(a,l),b.reverse());const g=Object(n.useState)(ms(b,c)),f=Object(o.a)(g,2),E=f[0],v=f[1];return Object(n.useEffect)(()=>{null!==u&&(i?u.showLoading():u.hideLoading())},[u,i]),Object(n.useEffect)(()=>{let e=!1;null!==u&&null!==a&&(v(ms(b,c)),0===a.length&&(e=!0),e?u.showNoData():u.hideNoData())},[u,a]),r.a.createElement(bc.a,{highcharts:t,options:E,callback:e=>d(e)})};var ds=function(e){const t=e.selectedTrigger,a=e.history,n=t.alert_events,l=t.name,i=n.map(e=>{const t=e.event_id,n=e.site,l=e.event_start,i=e.validity;return[r.a.createElement(b.a,{onClick:e=>a.push("/monitoring/events/".concat(t)),style:{color:"blue"}},r.a.createElement("u",null,t)),re(n),$()(l).format("DD MMMM YYYY, HH:mm"),$()(i).format("DD MMMM YYYY, HH:mm")]});return r.a.createElement(vl.a,{title:'Monitoring Events with "'.concat(l,'" trigger'),columns:[{name:"Event ID"},{name:"Site"},{name:"Event Start"},{name:"Validity"}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"simple"},data:i})};window.Highcharts=fc.a,cs()(window.Highcharts);const ps=Object(j.a)(e=>{const t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{inputGridContainer:{margin:"12px 0",[e.breakpoints.down("sm")]:{margin:"0 0"}},buttonGrid:{textAlign:"right",[e.breakpoints.down("sm")]:{textAlign:"right"}},button:{fontSize:16,paddingLeft:8},alert3:Object(p.a)(Object(p.a)({},t.alert3),{},{"&:hover *":{color:"#222222 !important"}}),card:{height:"auto"}})});function bs(e,t){return""===t?"Required field":""}function gs(e,t){const a=t.type,n=t.field,r=t.value,l=e[n],i=r,c=bs(0,r),o=fs(i);switch(a){case"UPDATE":return Object(p.a)(Object(p.a)({},e),{},{[n]:Object(p.a)(Object(p.a)({},l),{},{value:i,helper_text:c})});case"RESET":return Object(p.a)({},o);default:return Object(p.a)({},e)}}function fs(e){const t={};return e&&Object.keys(e).forEach(a=>{const n=e[a]?e[a]:"",r=(t[a],bs(0,n));t[a]={value:n,helper_text:r,required:!0}}),t}function Es(e){const t={};return Object.keys(e).forEach(a=>{t[a]=e[a].value}),t}var vs=function(e){const t=ps(),a=[_e.a,_e.b,_e.c],l=Object(n.useState)({data:null,is_loading:!0}),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)({data:null,is_loading:!0}),u=Object(o.a)(m,2),d=u[0],p=u[1],g=$()(),f={site:"",start_ts:g.clone().subtract(1,"year"),end_ts:g},v={site:"",year:$()().format("YYYY")},h=Object(n.useReducer)(gs,f,fs),_=Object(o.a)(h,2),j=_[0],x=_[1],k=Object(n.useReducer)(gs,v,fs),S=Object(o.a)(k,2),C=S[0],D=S[1],A=function(e=5){const t=(new Date).getFullYear();return Array.from({length:e},(a,n)=>t-e+n+1)}(),w=Object(n.useState)(null),I=Object(o.a)(w,2),M=I[0],T=I[1],N=(e,t)=>x({type:"UPDATE",field:e,value:$()(t).format("YYYY-MM-DD HH:mm:ss")}),Y=(e,t,a=!1)=>{const n={data:t,is_loading:a};"pie"===e?s(n):"stacked"===e&&p(n)},R=e=>()=>{let t,a;"pie"===e?(a=c.data,t=j):"stacked"===e&&(a=d.data,t=C),Y(e,a,!0);const n=Es(t);n.site&&(n.site_id=n.site.value);Rc({chart_type:e,inputs:n},t=>{Y(e,t)})};return Object(n.useEffect)(()=>{[{chart_type:"pie",inputs:f},{chart_type:"stacked",inputs:v}].forEach(e=>{Rc(e,t=>{Y(e.chart_type,t)})})},[]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ut,{title:"Analysis | Monitoring Alerts Analytics"}),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{className:t.card},r.a.createElement(V.a,null,r.a.createElement(O.a,{variant:"overline",display:"block",gutterBottom:!0},"Alerts Summary"),r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(wa,{value:j.site.value,changeHandler:e=>{x({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Start Timestamp",value:j.start_ts.value,onChange:e=>N("start_ts",e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"End Timestamp",value:j.end_ts.value,onChange:e=>N("end_ts",e),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,align:"right"},r.a.createElement(b.a,{size:"small",color:"primary",variant:"contained",onClick:R("pie")},"Submit")))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{className:t.card},r.a.createElement(V.a,null,r.a.createElement(ss,{highcharts:fc.a,data:c.data,isLoading:c.is_loading,colors:a,input:Es(j),setSelectedTrigger:T})))),M&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{className:t.card},r.a.createElement(ds,Object.assign({},e,{selectedTrigger:M})))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{className:t.card},r.a.createElement(V.a,null,r.a.createElement(O.a,{variant:"overline",display:"block",gutterBottom:!0},"Monthly Alerts Per Year"),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:8},r.a.createElement(wa,{value:C.site.value||"",changeHandler:e=>{D({type:"UPDATE",field:"site",value:e})},isClearable:!0,customPlaceholder:"If no input, all sites"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4},r.a.createElement(Dt.a,{required:!0,fullWidth:!0},r.a.createElement(Ta.a,{id:"alert_level_label"},"Year"),r.a.createElement(Na.a,{labelId:"alert_level_label",id:"alert_level",value:C.year.value,onChange:e=>D({type:"UPDATE",field:"year",value:e.target.value}),error:Boolean(C.year.helper_text)},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"---")),A.map(e=>r.a.createElement(P.a,{value:e,key:e},e))),r.a.createElement(E.a,{error:!0},C.year.helper_text))),r.a.createElement(y.a,{item:!0,xs:12,align:"right"},r.a.createElement(b.a,{size:"small",color:"primary",onClick:R("stacked"),variant:"contained"},"Submit")))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{className:t.card},r.a.createElement(V.a,null,r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(us,{highcharts:fc.a,data:d.data,isLoading:d.is_loading,colors:a,input:Es(C)})))))))))},hs=a(35),_s=a(1105);const ys=Object(j.a)(e=>({list:{maxHeight:"60vh",overflowY:"auto",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}},searchBox:{marginBottom:e.spacing(3)},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}}));var Os=r.a.memo((function(e){const t=e.selectedLogger,a=e.onLoggerClickFn,l=e.reloadList,i=e.loggers,c=e.setLoggers,s=e.setReloadList,m=ys(),u=Object(n.useState)([]),d=Object(o.a)(u,2),p=d[0],b=d[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1];return Object(n.useEffect)(()=>{Yc(e=>{const t=e.loggers,n=e.rain_gauges;t.forEach(e=>{const t=e.logger_model.has_rain,a=e.logger_name;if(t){const t=n.find(e=>e.gauge_name===a);e.rain_gauge=t||null}}),c(t),b(t),t.length>0&&a(t[0])()})},[]),Object(n.useEffect)(()=>{l&&setTimeout(()=>{Yc(e=>{const t=e.loggers,a=e.rain_gauges;t.forEach(e=>{const t=e.logger_model.has_rain,n=e.logger_name;if(t){const t=a.find(e=>e.gauge_name===n);e.rain_gauge=t||null}}),c(t)}),s(!1)},1e3)},[l]),Object(n.useEffect)(()=>{if(null!==E){const e=p.filter(e=>{const t=e.logger_name;return new RegExp("".concat(E.toLowerCase()),"gi").test(t.toLocaleLowerCase())});c(e)}else c(i)},[E]),r.a.createElement("div",{className:m.sticky},r.a.createElement(Kn.a,{fullWidth:!0,margin:"dense",placeholder:"Search loggers...",onChange:e=>v(e.target.value),className:m.searchBox}),r.a.createElement(Or.a,{"aria-label":"list",className:m.list},i.map(e=>{const n=e.logger_name,l=e.logger_id,i=null!==t&&t.logger_id===l;return r.a.createElement(xr.a,{button:!0,key:e.logger_id,onClick:a(e),selected:i},r.a.createElement(kr.a,{primary:n.toUpperCase()}))})))})),js=a(1183),xs=a(98),ks=a.n(xs),Ss=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],Cs=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Ds(e){var t=e.inputRef,a=e.mask,n=Object(da.a)(e,["inputRef","mask"]);return r.a.createElement(ks.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function As(e){var t=e.rainGauge,a=e.saveUpdate,l=t.date_activated,i=t.date_deactivated,c=t.rain_id,s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p={value:i,helper_text:null},g=Object(n.useState)(p),f=Object(o.a)(g,2),E=f[0],v=f[1];Object(n.useEffect)((function(){v(p)}),[t]);var h=E.value?$()(E.value).format("DD MMMM YYYY"):"---";return r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"RAIN GAUGE")),!u&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date activated:")," ",$()(l).format("DD MMMM YYYY")),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date deactivated:")," ",h)),u&&r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Deactivated",value:E.value||null,onChange:function(e){return function(e){var t="";null===e?t="Required field":e.isValid()||(t="Enter a valid date"),v({value:e,helper_text:t})}(e)},helperText:E.helper_text||"",error:Boolean(E.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0})))),r.a.createElement(js.a,{style:{justifyContent:"flex-end"}},!u&&r.a.createElement(b.a,{color:"primary",onClick:function(){return d(!0)}},"Edit"),u&&r.a.createElement(n.Fragment,null,r.a.createElement(b.a,{color:"primary",onClick:function(){return d(!1)}},"Cancel"),r.a.createElement(b.a,{color:"secondary",onClick:function(){return function(){d(!1);var e={date_deactivated:E.value.format("YYYY-MM-DD"),section:"rain",rain_id:c};a(e)}()},disabled:Boolean(E.helper_text)||null===E.helper_text},"Save"))))}function ws(e){var t=e.tsmSensor,a=e.saveUpdate,l=t.date_activated,i=t.date_deactivated,c=t.version,s=t.number_of_segments,m=t.segment_length,u=t.tsm_id,d=Object(n.useState)(!1),p=Object(o.a)(d,2),g=p[0],f=p[1],E={value:i,helper_text:null},v=Object(n.useState)(E),h=Object(o.a)(v,2),_=h[0],j=h[1];Object(n.useEffect)((function(){j(E)}),[t]);var x=_.value?$()(_.value).format("DD MMMM YYYY"):"---";return r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"TILT SENSOR")),!g&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:12,md:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Version:")," ",c),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,md:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"No. of segments:")," ",s),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,md:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Segment length:")," ",m),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date activated:")," ",$()(l).format("DD MMMM YYYY")),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,md:6,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date deactivated:")," ",x)),g&&r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Deactivated",value:_.value||null,onChange:function(e){return function(e){var t="";null===e?t="Required field":e.isValid()||(t="Enter a valid date"),j({value:e,helper_text:t})}(e)},helperText:_.helper_text||"",error:Boolean(_.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0})))),r.a.createElement(js.a,{style:{justifyContent:"flex-end"}},!g&&r.a.createElement(b.a,{color:"primary",onClick:function(){return f(!0)}},"Edit"),g&&r.a.createElement(n.Fragment,null,r.a.createElement(b.a,{color:"primary",onClick:function(){return f(!1)}},"Cancel"),r.a.createElement(b.a,{color:"secondary",onClick:function(){return function(){f(!1);var e={date_deactivated:_.value.format("YYYY-MM-DD"),section:"tilt",tsm_id:u};a(e)}()},disabled:Boolean(_.helper_text)||null===_.helper_text},"Save"))))}function Is(e){var t=e.tsmSensor,a=e.saveUpdate,n=t.version,l=t.accelerometers;return r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"ACCELEROMETERS")),l.map((function(e){return r.a.createElement(Ms,{row:e,version:n,key:e.accel_id,saveUpdate:a})}))))}function Ms(e){var t=e.row,a=e.version,l=e.saveUpdate,i=t.node_id,c=t.accel_number,m=t.voltage_min,u=t.voltage_max,d=t.in_use,g=t.date_updated,v=t.status,h=t.accel_id,_=t.tsm_id,j={status:"",remarks:""},x=Object(n.useState)(!1),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(Object(p.a)({in_use:Boolean(d),voltage_max:u,voltage_min:m,date_updated:g},j)),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(!1),N=Object(o.a)(T,2),Y=N[0],R=N[1];Object(n.useEffect)((function(){M(Object(p.a)(Object(p.a)({},I),j))}),[Y]);var H,B=function(e,t){M(Object(p.a)(Object(p.a)({},I),{},Object(s.a)({},e,t)))},L=Object.keys(I).some((function(e){return""===I[e]})),F=null!==I.date_updated?$()(I.date_updated).format("DD MMMM YYYY"):"---";return r.a.createElement(n.Fragment,{key:h},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,r.a.createElement("u",null,"Node ",i,1===a?"":", Accel ".concat(c)))),!C&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:2,variant:"body1",align:"center"},r.a.createElement("strong",null,"Active:")," ",I.in_use?"Yes":"No"),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:3,variant:"body1",align:"center"},r.a.createElement("strong",null,"Min Voltage:")," ",I.voltage_min),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:4,md:6,lg:3,variant:"body1",align:"center"},r.a.createElement("strong",null,"Max Voltage:")," ",I.voltage_max),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Last Update:")," ",F),v.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Latest Flag")),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Status:")," ",2===(H=v[0].status)?"Use with caution":3===H?"Special case":4===H?"Not OK":""),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:12,md:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Timestamp:")," ",$()(v[0].ts_flagged).format("DD MMMM YYYY")),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:12,md:12,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Flagger:")," ",v[0].flagger),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"body1",align:"center"},r.a.createElement("strong",null,"Remarks:")," ",v[0].remarks||"---"))),C&&r.a.createElement(n.Fragment,null,r.a.createElement(Dt.a,{fullWidth:!0,component:y.a,item:!0,xs:12,sm:3,style:{justifyContent:"center",alignItems:"center"}},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:I.in_use,onChange:function(e){return B("in_use",e.target.checked)},name:"isActive",color:"primary"}),label:"Active"})),r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Min Voltage",type:"number",value:I.voltage_min,onChange:function(e){return B("voltage_min",e.target.value)},helperText:I.voltage_min?"":"Required field",error:!I.voltage_min&&0!==I.voltage_min})),r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Max Voltage",type:"number",value:I.voltage_max,onChange:function(e){return B("voltage_max",e.target.value)},helperText:I.voltage_max?"":"Required field",error:!I.voltage_max&&0!==I.voltage_max})),r.a.createElement(y.a,{item:!0,xs:12,sm:3,align:"center"},r.a.createElement(b.a,{color:"primary",variant:"contained",onClick:function(){return R(!Y)}},Y?"Cancel flag":"Add flag")),Y&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:3},r.a.createElement(Dt.a,{required:!0,fullWidth:!0,error:!I.status},r.a.createElement(Ta.a,null,"Status"),r.a.createElement(Na.a,{value:I.status,onChange:function(e){return B("status",e.target.value)},error:!I.status},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),r.a.createElement(P.a,{value:"2",key:"2"},"Use with caution"),r.a.createElement(P.a,{value:"3",key:"3"},"Special case"),r.a.createElement(P.a,{value:"4",key:"4"},"Not OK")),r.a.createElement(E.a,{error:!0},I.status?"":"Required field"))),r.a.createElement(y.a,{item:!0,xs:12,sm:9},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Remarks",value:I.remarks,onChange:function(e){return B("remarks",e.target.value)},helperText:I.remarks?"":"Required field",error:!I.remarks})))),r.a.createElement(y.a,{item:!0,xs:12,align:"right"},!C&&r.a.createElement(b.a,{color:"primary",onClick:function(){return D(!0)}},"Edit"),C&&r.a.createElement(n.Fragment,null,r.a.createElement(b.a,{color:"primary",onClick:function(){return D(!1)}},"Cancel"),r.a.createElement(b.a,{color:"secondary",onClick:function(){return function(){D(!1);var e=$()().format("YYYY-MM-DD"),t=Object(p.a)(Object(p.a)({},I),{},{section:"accelerometers",accel_id:h,node_id:i,tsm_id:_,has_new_status:Y,flagger:Object(k.a)(),ts_updated:e});l(t)}()},disabled:L},"Save"))))}function Ts(e){var t=e.selectedLogger,a=e.saveUpdate,l=t.date_activated,i=t.date_deactivated,c=t.latitude,m=t.longitude,u=t.logger_id,d=t.logger_mobile,g=t.logger_model.logger_type,E="---",v=null;if(d){var h=t.logger_mobile,_=h.sim_num,j=h.mobile_id;v=j,E=Object(xs.conformToMask)(_,Cs).conformedValue}var x={date_deactivated:{value:i,helper_text:"",required:!1},logger_number:{value:E,helper_text:"",required:!0},latitude:{value:c,helper_text:"",required:!0},longitude:{value:m,helper_text:"",required:!0}},k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],D=S[1],A=Object(n.useState)(x),w=Object(o.a)(A,2),I=w[0],M=w[1];Object(n.useEffect)((function(){M(x)}),[t]);var T=function(e,t){var a=I[e],n="";""===t&&Boolean(a.required)&&(n="Required field"),"date_deactivated"!==e||null===t||t.isValid()||(n="Enter a valid date"),"logger_number"===e&&t.includes("x")&&(n="Enter complete mobile number");var r=Object(p.a)(Object(p.a)({},I),{},Object(s.a)({},e,Object(p.a)(Object(p.a)({},a),{},{value:t,helper_text:n})));M(r)},N=Object(n.useState)(!1),Y=Object(o.a)(N,2),R=Y[0],H=Y[1];Object(n.useEffect)((function(){return H(Object.keys(I).some((function(e){var t=I[e],a=t.required,n=t.helper_text;return a&&""!==n||!a&&""!==n})))}),[I]);var B=I.date_deactivated.value?$()(I.date_deactivated.value).format("DD MMMM YYYY"):"---";return r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"subtitle1",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"LOGGER INFO")),!C&&r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date installed:")," ",$()(l).format("DD MMMM YYYY")),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Date deactivated:")," ",B),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Type:")," ",g.toUpperCase()),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Logger number:")," ",I.logger_number.value),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Latitude:")," ",I.latitude.value),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,sm:6,lg:4,variant:"body1",align:"center"},r.a.createElement("strong",null,"Longitude:")," ",I.longitude.value)),C&&r.a.createElement(n.Fragment,null,r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:6,lg:3},r.a.createElement(Bl.b,{autoOk:!0,label:"Date Deactivated",value:I.date_deactivated.value||null,onChange:function(e){return T("date_deactivated",e)},helperText:I.date_deactivated.helper_text||"",error:Boolean(I.date_deactivated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),"---"!==I.logger_number.value&&r.a.createElement(y.a,{item:!0,xs:6,lg:3},r.a.createElement(f.a,{required:!0,fullWidth:!0,label:"Logger Number",InputProps:{inputComponent:Ds,inputProps:{mask:Ss}},InputLabelProps:{shrink:!0},value:I.logger_number.value,onChange:function(e){return T("logger_number",e.target.value)},helperText:I.logger_number.helper_text||"",error:Boolean(I.logger_number.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,lg:3},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Latitude",type:"number",value:I.latitude.value,onChange:function(e){return T("latitude",e.target.value)},helperText:I.latitude.helper_text||"",error:Boolean(I.latitude.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,lg:3},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Longitude",type:"number",value:I.longitude.value,onChange:function(e){return T("longitude",e.target.value)},helperText:I.longitude.helper_text||"",error:Boolean(I.longitude.helper_text)})))),r.a.createElement(js.a,{style:{justifyContent:"flex-end"}},!C&&r.a.createElement(b.a,{color:"primary",onClick:function(){return D(!0)}},"Edit"),C&&r.a.createElement(n.Fragment,null,r.a.createElement(b.a,{color:"primary",onClick:function(){return D(!1)}},"Cancel"),r.a.createElement(b.a,{color:"secondary",onClick:function(){return function(){D(!1);var e={};Object.keys(I).forEach((function(t){var a=I[t].value,n=a;$.a.isMoment(a)&&(n=a.format("YYYY-MM-DD")),"logger_number"===t&&(n=a.replace(/[()+-\s]/g,"")),e[t]=n})),e.section="loggers",e.mobile_id=v,e.logger_id=u,a(e)}()},disabled:R},"Save"))))}var Ns=function(e){var t=e.selectedLogger,a=e.setReloadList,l=t.logger_name,i=t.logger_model,o=i.has_rain,s=i.has_tilt,m=t.tsm_sensor,u=t.rain_gauge,d=Object(c.b)(),p=d.enqueueSnackbar,g=d.closeSnackbar,f=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){g(e)}},"Dismiss")},E=function(e){e.has_rain=o,1===o&&(e.rain=u),a(!0),console.log(e),function(e,t){var a="".concat(te.b,"/api/sensor_deployment/save_data_update");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save data update reponse",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t=e.status,a=e.message;p(a,{variant:!0===t?"success":"error",autoHideDuration:5e3,action:f})}))};return r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"h6"},r.a.createElement("strong",null,l.toUpperCase())),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ts,{selectedLogger:t,saveUpdate:E})),1===o&&Boolean(u)&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(As,{rainGauge:u,saveUpdate:E})),1===s&&Boolean(m)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(ws,{tsmSensor:m,saveUpdate:E})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Is,{tsmSensor:m,saveUpdate:E}))))};let Ys=null;function Rs(e,t){const a=t.type,n=t.field,r=t.value,l=e[n],i=r,c=r,o=l.required,s=Ys(n,c,o);switch(a){case"UPDATE":return Object(p.a)(Object(p.a)({},e),{},{[n]:Object(p.a)(Object(p.a)({},l),{},{value:i,helper_text:s})});default:return Object(p.a)({},e)}}var Hs=function(e){const t=e.onTiltFormUpdate,a=e.initReducer,l=e.getHelperText,i=e.checkInputFields;Ys=l;const c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useReducer)(Rs,{date_activated:null,version:"",segment_length:"",number_of_segment:""},a),b=Object(o.a)(d,2),g=b[0],E=b[1];return Object(n.useEffect)(()=>{const e=i(g),a=m.some(e=>null===e||""===e),n=e||a,r=function(e){const t=e=>Object.keys(e).reduce((a,n)=>{const r=Object(p.a)({},a),l=e[n].value;let i=l;return"undefined"===typeof l&&(i=t(e[n])),""===l&&(i=null),"site"===n&&(i=l.data),$.a.isMoment(l)&&(i=l.format("YYYY-MM-DD HH:mm:ss")),r[n]=i,r},{});return t(e)}(Object(p.a)(Object(p.a)({},g),{},{segment_list:{value:m}}));t(r,n)},[g,m]),r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Tilt Sensor")),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:6,md:3},r.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:g.date_activated.value||null,onChange:e=>E({type:"UPDATE",field:"date_activated",value:e}),helperText:g.date_activated.helper_text||"",error:Boolean(g.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:6,md:2},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Version",type:"number",value:g.version.value,onChange:e=>E({type:"UPDATE",field:"version",value:e.target.value}),helperText:g.version.helper_text||"",error:Boolean(g.version.helper_text)}))),r.a.createElement(y.a,{item:!0,xs:6,md:3},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Segment Length",type:"number",value:g.segment_length.value,onChange:e=>E({type:"UPDATE",field:"segment_length",value:e.target.value}),helperText:g.segment_length.helper_text||"",error:Boolean(g.segment_length.helper_text)}))),r.a.createElement(y.a,{item:!0,xs:6,md:4},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Number of Segment",type:"number",value:g.number_of_segment.value,onChange:e=>(e=>{E({type:"UPDATE",field:"number_of_segment",value:e});const t=""!==e?parseInt(e,10):0,a=Array.from(Array(t),(e,t)=>null);u([...a])})(e.target.value),helperText:g.number_of_segment.helper_text||"",error:Boolean(g.number_of_segment.helper_text)}))),0!==m.length&&r.a.createElement(O.a,{variant:"overline",display:"block",component:y.a,item:!0,xs:12},"Segments"),0!==m.length&&m.map((e,t)=>r.a.createElement(y.a,{item:!0,xs:4,sm:3,lg:2,key:"segment_container_".concat(t+1)},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Segment ".concat(t+1),key:"segment_".concat(t+1),type:"number",placeholder:"Enter ID",InputLabelProps:{shrink:!0},value:e||"",onChange:e=>((e,t)=>{const a=[...m];a[t]=e,u(a)})(e.target.value,t),helperText:""===e?"Required field":"",error:Boolean(""===e)}))))))};const Bs=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Ps(e){const t=e.inputRef,a=e.mask,n=Object(da.a)(e,["inputRef","mask"]);return r.a.createElement(ks.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function Ls(e,t,a){if(""===t&&a)return"Required field";if("logger_number"===e&&t.includes("x"))return"Enter complete mobile number";if(["date_installed","date_activated"].includes(e)&&null!==t&&!t.isValid())return"Enter a valid date";if(["installed_sensors","personnel"].includes(e)&&0===t.length)return!0;if(("version"===e||"segment_length"===e||"number_of_segment"===e)&&(0===t||"0"===t))return"Invalid value";if("segment_list"===e){if(Object.keys(t).some(e=>""===t[e].segment_value))return"Invalid segment value inserted"}return""}function Fs(e,t){const a=t.type,n=t.field,r=t.value;let l=e[n],i=r,c=r;if(["installed_sensors","personnel"].includes(n)){const e=r.name,t=r.checked,a=l.value;t?(a.push(e),i=a):i=a.filter(t=>t!==e),c=i}try{if("tilt"===n){const e=r.tilt_data,t=r.test_value;i=e,c=t}const t=r.sensor;if(e.installed_sensors.value.includes(t)){const a=r.data;i=a,c=a,l=e[t][n]}}catch(m){}let o=!1;try{o=l.required}catch(m){}const s=Ls(n,c,o);switch(a){case"UPDATE":return Object(p.a)(Object(p.a)({},e),{},{[n]:Object(p.a)(Object(p.a)({},l),{},{value:i,helper_text:s})});case"ADD_ATTRIBUTE":return Object(p.a)(Object(p.a)({},e),{},{[n]:r});case"UPDATE_SENSOR":const t=r.sensor;return Object(p.a)(Object(p.a)({},e),{},{[t]:{[n]:Object(p.a)(Object(p.a)({},l),{},{value:i,helper_text:s})}});case"UPDATE_TILT":return Object(p.a)(Object(p.a)({},e),{},{[n]:Object(p.a)(Object(p.a)({},l),{},{value:i,helper_text:s})});case"DELETE_ATTRIBUTE":return delete e[n],e;case"RESET":const a=Us(i);return Object(p.a)({},a);default:return Object(p.a)({},e)}}function Us(e){const t={},a=["date_activated"];return Object.keys(e).forEach(n=>{const r=!a.includes(n);t[n]={value:e[n],helper_text:null,required:r}}),t}const qs=["brain","kate","sky","jec","kennex","reyn","web","oscar","dan","arnel","troy"];var Ws=function(e){const t=e.setIsAddLogger,a=e.setReloadList,l={site:"",logger_name:"",date_installed:null,latitude:"",longitude:"",location_description:"",network:"",logger_number:"",logger_type:"",installed_sensors:[],personnel:[]},i=Object(n.useReducer)(Fs,l,Us),s=Object(o.a)(i,2),m=s[0],u=s[1],d=Object(n.useState)(!0),g=Object(o.a)(d,2),v=g[0],h=g[1],_=Object(c.b)(),j=_.enqueueSnackbar,x=_.closeSnackbar,k=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{x(e)}},"Dismiss"),S=(e,t)=>m[e].value.includes(t),C=e=>t=>{const a=t.target,n=a.name,r=a.checked;if(u({type:"UPDATE",field:e,value:{name:n,checked:r}}),"installed_sensors"===e)if(r){let e=Us({date_activated:null});"tilt"===n&&(e={required:!0,helper_text:null,value:null}),u({type:"ADD_ATTRIBUTE",field:n,value:e})}else u({type:"DELETE_ATTRIBUTE",field:n})},D=e=>Object.keys(e).some(t=>{const a=e[t],n=a.required,r=a.helper_text;return"undefined"===typeof n?D(e[t]):n&&(""!==r||null===r)||!n&&""!==r&&null!==r});return Object(n.useEffect)(()=>{"router"===m.logger_type.value&&(m.logger_number={required:!1,helper_text:"",value:"has_value"},m.network={required:!1,helper_text:"",value:"has_value"});const e=D(m);h(e)},[m]),r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"h6"},r.a.createElement("strong",null,"Logger Deployment Form")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(wa,{required:!0,value:m.site.value,changeHandler:e=>u({type:"UPDATE",field:"site",value:e})})),r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(f.a,{required:!0,fullWidth:!0,label:"Logger Name",value:m.logger_name.value,onChange:e=>u({type:"UPDATE",field:"logger_name",value:e.target.value}),helperText:m.logger_name.helper_text||"",error:Boolean(m.logger_name.helper_text)})),"router"!==m.logger_type.value&&r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(f.a,{required:!0,fullWidth:!0,label:"Logger Number",InputProps:{inputComponent:Ps,inputProps:{mask:Bs}},InputLabelProps:{shrink:!0},value:m.logger_number.value,onChange:e=>u({type:"UPDATE",field:"logger_number",value:e.target.value}),helperText:m.logger_number.helper_text||"",error:Boolean(m.logger_number.helper_text)})),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(Bl.b,{required:!0,autoOk:!0,label:"Date Installed",value:m.date_installed.value||null,onChange:e=>u({type:"UPDATE",field:"date_installed",value:e}),helperText:m.date_installed.helper_text||"",error:Boolean(m.date_installed.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Latitude",type:"number",value:m.latitude.value,onChange:e=>u({type:"UPDATE",field:"latitude",value:e.target.value}),helperText:m.latitude.helper_text||"",error:Boolean(m.latitude.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,lg:4},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Longitude",type:"number",value:m.longitude.value,onChange:e=>u({type:"UPDATE",field:"longitude",value:e.target.value}),helperText:m.longitude.helper_text||"",error:Boolean(m.longitude.helper_text)})),"router"!==m.logger_type.value&&r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:5,lg:3},r.a.createElement(Dt.a,{required:!0,fullWidth:!0,error:Boolean(m.network.helper_text)},r.a.createElement(Ta.a,{id:"network"},"Main Network of Location"),r.a.createElement(Na.a,{labelId:"network-select-label",id:"network-select-id",value:m.network.value,onChange:e=>u({type:"UPDATE",field:"network",value:e.target.value}),error:Boolean(m.network.helper_text)},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),r.a.createElement(P.a,{value:"Globe",key:"globe"},"Globe"),r.a.createElement(P.a,{value:"Smart",key:"smart"},"Smart")),r.a.createElement(E.a,{error:!0},m.network.helper_text))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:7,lg:9},r.a.createElement(f.a,{fullWidth:!0,required:!0,label:"Location Description",value:m.location_description.value,onChange:e=>u({type:"UPDATE",field:"location_description",value:e.target.value}),helperText:m.location_description.helper_text||"",error:Boolean(m.location_description.helper_text)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"8px 0"}})),r.a.createElement(Dt.a,{component:y.a,item:!0,xs:12,lg:6,container:!0,alignItems:"center"},r.a.createElement(Xt.a,{component:"legend",required:!0},"Logger Type"),r.a.createElement(At.a,{row:!0,"aria-label":"logger_type_group",name:"logger_type",value:m.logger_type.value,onChange:e=>u({type:"UPDATE",field:"logger_type",value:e.target.value}),style:{justifyContent:"center"}},r.a.createElement(wt.a,{value:"masterbox",control:r.a.createElement(It.a,{color:"primary"}),label:"Master Box",key:"master_box"}),r.a.createElement(wt.a,{value:"arq",control:r.a.createElement(It.a,{color:"primary"}),label:"ARQ",key:"arq"}),r.a.createElement(wt.a,{value:"router",control:r.a.createElement(It.a,{color:"primary"}),label:"Router",key:"router"}),r.a.createElement(wt.a,{value:"gateway",control:r.a.createElement(It.a,{color:"primary"}),label:"Gateway",key:"gateway"}))),r.a.createElement(Dt.a,{component:y.a,item:!0,xs:12,lg:6,container:!0,alignItems:"center",error:Boolean(m.installed_sensors.helper_text)},r.a.createElement(Xt.a,{component:"legend",required:!0},"Installed Sensors"),r.a.createElement(Ua.a,{row:!0,style:{justifyContent:"center"}},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{name:"rain",checked:S("installed_sensors","rain"),onChange:C("installed_sensors")}),label:"Rain"}),r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{name:"tilt",checked:S("installed_sensors","tilt"),onChange:C("installed_sensors")}),label:"Tilt"}),r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{name:"piezo",checked:S("installed_sensors","piezo"),onChange:C("installed_sensors")}),label:"Piezometer"}),r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{name:"soms",checked:S("installed_sensors","soms"),onChange:C("installed_sensors")}),label:"Soil Moisture"})),m.installed_sensors.helper_text&&r.a.createElement(E.a,null,"Select at least one")),r.a.createElement(Dt.a,{component:y.a,item:!0,xs:12,container:!0,alignItems:"center",error:Boolean(m.personnel.helper_text)},r.a.createElement(Xt.a,{component:"legend",required:!0},"Personnel"),r.a.createElement(Ua.a,{row:!0,style:{justifyContent:"center"}},qs.map(e=>r.a.createElement(wt.a,{key:e,control:r.a.createElement(Jt.a,{name:e,checked:S("personnel",e),onChange:C("personnel")}),label:"".concat(le(e))}))),m.personnel.helper_text&&r.a.createElement(E.a,null,"Select at least one"))))),m.installed_sensors.value.includes("rain")&&r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Rain Gauge")),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.rain.date_activated.value||null,onChange:e=>u({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"rain"}}),helperText:m.rain.date_activated.helper_text||"",error:Boolean(m.rain.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("piezo")&&r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Piezometer")),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.piezo.date_activated.value||null,onChange:e=>u({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"piezo"}}),helperText:m.piezo.date_activated.helper_text||"",error:Boolean(m.piezo.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("soms")&&r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(G.a,{variant:"outlined"},r.a.createElement(V.a,{component:y.a,container:!0,spacing:2},r.a.createElement(O.a,{variant:"h6",display:"block",component:y.a,item:!0,xs:12},r.a.createElement("strong",null,"Soil Moisture")),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Bl.b,{autoOk:!0,label:"Date Activated",value:m.soms.date_activated.value||null,onChange:e=>u({type:"UPDATE_SENSOR",field:"date_activated",value:{data:e,sensor:"soms"}}),helperText:m.soms.date_activated.helper_text||"",error:Boolean(m.soms.date_activated.helper_text),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,fullWidth:!0})))))),m.installed_sensors.value.includes("tilt")&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Hs,{onTiltFormUpdate:(e,t)=>{u({type:"UPDATE_TILT",field:"tilt",value:{test_value:!t||"",tilt_data:e}})},initReducer:Us,getHelperText:Ls,checkInputFields:D})),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end"},r.a.createElement(b.a,{color:"primary",onClick:e=>t(!1)},"Cancel"),r.a.createElement(b.a,{color:"primary",onClick:e=>u({type:"RESET",value:l})},"Clear"),r.a.createElement(b.a,{variant:"contained",color:"secondary",style:{marginRight:8},onClick:()=>{const e=function(e){const t=e=>Object.keys(e).reduce((a,n)=>{const r=Object(p.a)({},a),l=e[n].value;let i=l;return"undefined"===typeof l&&(i=t(e[n])),""===l&&(i=null),"logger_number"===n&&(i=l.replace(/[()+-\s]/g,"")),"site"===n&&(i=l.data),$.a.isMoment(l)&&(i=l.format("YYYY-MM-DD")),r[n]=i,r},{});return t(e)}(m);e.date_installed=$()(e.date_installed).format("YYYY-MM-DD");e.installed_sensors.includes("tilt")&&(e.tilt.date_activated=$()(e.tilt.date_activated).format("YYYY-MM-DD")),console.log(e),function(e,t){var a="".concat(te.b,"/api/sensor_deployment/save_logger_deployment");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save deployment logs reponse",a),t(a)})).catch((function(e){console.error(e)}))}(e,e=>{const n=e.status,r=e.message;let l;n?(l="success",t(!1),a(!0)):l="error",j(r,{variant:l,autoHideDuration:5e3,action:k})})},disabled:v},"Submit")))};const zs=Object(j.a)(e=>{const t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{tabBar:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:{overflowY:"auto",height:"calc(100vh - 250px)",[e.breakpoints.down("md")]:{height:"80vh"}},insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"},form_message_style:{color:"red",fontStyle:"italic"}})});function Gs(e){return r.a.createElement("span",null,r.a.createElement(b.a,{"aria-label":"Add logger",variant:"contained",color:"primary",size:"small",onClick:()=>e(!0),startIcon:r.a.createElement(Kt.a,null)},"Add logger"))}var Vs=function(e){const t=zs(),a=Object(hs.a)(),l=Object(_s.a)(a.breakpoints.up("sm")),i=Object(n.useState)(!1),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],b=d[1],g=Object(n.useState)(!1),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)([]),_=Object(o.a)(h,2),O=_[0],j=_[1];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ut,{title:"Analysis | Loggers and Sensors Form",className:t.sticky,customButtons:!!l&&Gs(m)}),r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,sm:3,lg:2},r.a.createElement(Os,{selectedLogger:p,onLoggerClickFn:e=>()=>{b(e),console.log("Selected logger",e)},reloadList:E,loggers:O,setLoggers:j,setReloadList:v})),r.a.createElement(y.a,{item:!0,xs:12,sm:9,lg:10},!s&&null!==p&&r.a.createElement(Ns,{selectedLogger:p,setReloadList:v}),s&&r.a.createElement(Ws,{setIsAddLogger:m,setReloadList:v})))))},Qs=a(1226),Zs=a(1231),Ks=a(1188),Js=a(1250),Xs=a(1220),$s=a(1221),em=a(1222),tm=a(1223),am=a(103),nm=a.n(am),rm=a(1217);var lm=function(e){const t=e.onClose,a=e.open,n=e.isUnregistered,l=e.setBlockModal,i=e.setSaveContactModal;return r.a.createElement(Oe.a,{onClose:()=>{t()},"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(je.a,{id:"simple-dialog-title"},"Message options"),r.a.createElement(Or.a,null,n&&r.a.createElement(xr.a,{button:!0,onClick:()=>{t(),i(!0)}},r.a.createElement(Sr.a,null,r.a.createElement(Fl.a,null)),r.a.createElement(kr.a,{primary:"Save number"})),r.a.createElement(xr.a,{button:!0,onClick:()=>{t(),l(!0)}},r.a.createElement(Sr.a,null,r.a.createElement(rm.a,null)),r.a.createElement(kr.a,{primary:"Block number"}))))};var im=r.a.memo((function(e){const t=e.open,a=e.setBlockModal,l=e.mobileDetails,i=e.setOpenOptions,s=l.sim_num,m=l.mobile_id,u=Object(c.b)(),d=u.enqueueSnackbar,p=u.closeSnackbar,g=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{p(e)}},"Dismiss"),E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useState)(null),O=Object(o.a)(y,2),j=O[0],x=O[1],S=Object(k.a)().user_id;return r.a.createElement(Oe.a,{open:t,onExited:()=>_(""),"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Block mobile number (+".concat(s,")")),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Provide the reason for blocking this mobile number from Chatterbox"),r.a.createElement(f.a,{autoFocus:!0,value:h,onChange:e=>{const t=e.target.value;_(t);let a="";""===t&&(a="This is a required field"),x(a)},margin:"dense",id:"reason",label:"Reason",multiline:!0,fullWidth:!0,required:!0,placeholder:"Enter reason",inputProps:{maxLength:500},error:""===h,helperText:j})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:()=>a(!1),color:"primary"},"Cancel"),r.a.createElement(b.a,{onClick:()=>{if(""===h)x("This is a required field");else{a(!1);const e={mobile_id:m,reporter_id:S,reason:h};console.log(e),function(e,t){var a="".concat(te.b,"/api/contacts/save_block_number");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save blocked contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}(e,e=>{const t=e.status,a=e.message;console.log(e),d(a,t?{variant:"success",autoHideDuration:4e3,action:g}:{variant:"error",autoHideDuration:3e3,action:g})}),i(!1)}},color:"secondary"},"Block")))})),cm=a(1218),om=a(1219),sm=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],mm=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function um(e,t){var a=[];if("municipality"===t){var n=e.map((function(e){var t=e.municipality,a=e.province;return{id:t,label:"".concat(t,", ").concat(a)}})).sort((function(e,t){return e.id.localeCompare(t.id)}));a=Object(ye.a)(n)}else if(["province","region"].includes(t)){var r=Object(ye.a)(new Set(e.map((function(e){return e[t]})).sort())).map((function(e){return{id:e,label:e}}));a=Object(ye.a)(r)}return a}function dm(e){var t=e.inputRef,a=e.mask,n=Object(da.a)(e,["inputRef","mask"]);return r.a.createElement(ks.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0}))}function pm(e,t){var a=[];return"mobile"===t?e.forEach((function(e,t){var n=e.mobile_number;n.sim_num=n.sim_num.replace(/[()+-\s]/g,""),a.push(e)})):e.forEach((function(e,t){var n=Object(p.a)({},e);delete n.mobile_id;var r=n.landline_id,l=n.pte_code;void 0===r&&(n.landline_id=0),n.landline_num=n.landline_num.replace(/[()+-\s]/g,""),n.pte_code=parseInt(l,10),Number.isNaN(l)&&(n.pte_code=0),a.push(n)})),a}function bm(e,t){var a=t.type,n=t.category,r=t.payload,l=Object(ye.a)(e),i={status:1,has_delete:!0};switch("email"===n?i="":"mobile"===n?i=Object(p.a)(Object(p.a)({},i),{},{mobile_number:{sim_num:"",mobile_id:0,gsm_id:""}}):"landline"===n&&(i=Object(p.a)(Object(p.a)({},i),{},{landline_num:"",pte_code:"",area_code:""})),a){case"UPDATE":return"email"===n?l[r.key]=r.value:"mobile"===n&&["sim_num","gsm_id"].includes(r.data)?l[r.key].mobile_number[r.data]=r.value:l[r.key][r.data]=r.value,Object(ye.a)(l);case"ADD":return[].concat(Object(ye.a)(l),[i]);case"DELETE":return l.splice(r.key,1),Object(ye.a)(l)}return[]}function gm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=t.filter((function(t){return t.scope===e})).map((function(e){return{id:e.name.toLowerCase(),label:e.name.toUpperCase()}}));return a}var fm=r.a.memo((function(e){var t=e.setContactForm,a=e.chosenContact,l=e.isEditMode,i=e.setContactFormForEdit,m=e.handleClose,u=e.isFromChatterbox,d=e.setSnackbarKey,g=Object(n.useState)([]),E=Object(o.a)(g,2),v=E[0],h=E[1],_=[],j=[],x=[],k=0,S="",C=[],D="",A="",w=[],I=!0,M=!0,T=!1,N=0,Y={first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0},H=Object(n.useContext)(Ca).sites;if(l||u){var B=a.mobile_numbers,L=a.ewi_recipient,F=a.ewi_restriction,U=a.landline_numbers,q=a.emails,W=a.first_name,z=a.last_name,G=a.middle_name,V=a.nickname,Z=a.user_id,K=a.organizations,J=a.status,X=a.ground_reminder_recipient;if(Y={first_name:W,last_name:z,middle_name:G,nickname:V,user_id:Z},0!==K.length){var $=K[0].organization,ee=$.scope,ae=$.name,re=K[0].site;k=ee,S=ae,C=gm(ee,v);var le=function(e,t,a){var n=t.municipality,r=t.province,l=t.region,i=t.site_id,c="",o="",s=[];return 0===e||1===e?c={value:i}:2===e?o=n:3===e?o=r:4===e?o=l:5===e&&(s=a.map((function(e){return{value:e.site.site_id}}))),{site:c,location:o,multi_sites:s}}(ee,re,K);D=le.site,A=le.location,w=le.multi_sites}if(null!==F)if(0!==F.length)N=F.alert_level;_=B.map((function(e,t){var a,n=JSON.parse(JSON.stringify(e)),r=n.mobile_number.sim_num;return n.mobile_number.sim_num=(a=r,Object(xs.conformToMask)(a,mm).conformedValue),n})),j=U,x=q,M=1===L,T=1===X,I=1===J}var ie=[{id:0,label:"Community"},{id:1,label:"Barangay"},{id:2,label:"Municipal",select_label:"Municipality",list:um(H,"municipality")},{id:3,label:"Provincial",select_label:"Province",list:um(H,"province")},{id:4,label:"Regional",select_label:"Region",list:um(H,"region")},{id:5,label:"National"}],ce=Object(n.useState)(Y),oe=Object(o.a)(ce,2),se=oe[0],me=oe[1],de=Object(n.useState)(k),pe=Object(o.a)(de,2),be=pe[0],ge=pe[1],fe=Object(n.useState)(D),Ee=Object(o.a)(fe,2),ve=Ee[0],he=Ee[1],_e=Object(n.useState)(w),ye=Object(o.a)(_e,2),Oe=ye[0],je=ye[1],xe=Object(n.useState)(A),ke=Object(o.a)(xe,2),Se=ke[0],Ce=ke[1],De=Object(n.useState)(C),Ae=Object(o.a)(De,2),we=Ae[0],Ie=Ae[1],Me=Object(n.useState)(S),Te=Object(o.a)(Me,2),Ne=Te[0],Ye=Te[1],Re=Object(n.useReducer)(bm,_),He=Object(o.a)(Re,2),Be=He[0],Pe=He[1],Le=Object(n.useReducer)(bm,j),Fe=Object(o.a)(Le,2),Ue=Fe[0],qe=Fe[1],We=Object(n.useReducer)(bm,x),ze=Object(o.a)(We,2),Ge=ze[0],Ve=ze[1],Qe=Object(n.useState)(M),Ze=Object(o.a)(Qe,2),Ke=Ze[0],Je=Ze[1],Xe=Object(n.useState)(T),$e=Object(o.a)(Xe,2),et=$e[0],tt=$e[1],at=Object(n.useState)(I),nt=Object(o.a)(at,2),rt=nt[0],lt=nt[1],it=Object(c.b)(),ct=it.enqueueSnackbar,ot=it.closeSnackbar,st=Object(n.useState)(N),mt=Object(o.a)(st,2),ut=mt[0],dt=mt[1],pt=Object(n.useState)(!1),bt=Object(o.a)(pt,2),gt=bt[0],ft=bt[1],Et=Object(n.useState)(""),vt=Object(o.a)(Et,2),ht=vt[0],_t=vt[1],yt=function(){return u&&m(),l?i(!1):t(!1)},Ot=function(e){return function(t){me(Object(p.a)(Object(p.a)({},se),{},Object(s.a)({},e,t.target.value)))}},jt=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){ot(e)}},"Dismiss")};Object(n.useEffect)((function(){var e;e=function(e){h(e)},ue("".concat(te.b,"/api/contacts/get_all_organizations"),e)}),[]),Object(n.useEffect)((function(){if(ve&&be<3){var e=ve.value,t=H.filter((function(t){return t.site_id===e}));_t(t[0].area_code)}else _t("")}),[ve,be]),Object(n.useEffect)((function(){if(Se&&be<4){var e=ie[be].select_label.toLowerCase(),t=H.filter((function(t){return t[e]===Se}));t.length>0&&_t(t[0].area_code)}else _t("")}),[Se,be]);var xt=Object(n.useState)([]),kt=Object(o.a)(xt,2),St=kt[0],Ct=kt[1];Object(n.useEffect)((function(){if(""!==be){l||(he(""),Ce(""),Ye(""));var e=gm(be,v);Ie(e),Ct(ie[be].list||[])}}),[be,v]),Object(n.useEffect)((function(){var e;e=function(e,t,a){var n=e.first_name,r=e.last_name,l=a.scope,i=a.site,c=a.office,o=a.location,s=(a.multi_sites,t.mobile_nums),m=t.landline_nums,u=!1,d=!1,p=!1;return s.forEach((function(e,t){var a=e.mobile_number.sim_num;!1===u&&(u=""===a||a.includes("x"))})),0!==m.length&&m.forEach((function(e,t){var a=e.landline_num;!1===p&&(p=""===a||a.includes("x"))})),0===l||1===l?d=""===i||""===c:2===l||3===l||4===l?d=""===o||""===c:5===l&&(d=""===c),""===n||""===r||!0===u||!0===d||!0===p}(se,{mobile_nums:Be,landline_nums:Ue},{scope:be,site:ve,office:Ne,location:Se,multi_sites:Oe}),ft(e)}),[se,Be,Ue,be,ve,Ne,Se,Oe]);var At=function(){var e=pm(Be,"mobile"),t=pm(Ue,"landline"),a=Ke?1:0,n=et?1:0,r=rt?1:0,l={user:Object(p.a)(Object(p.a)({},se),{},{emails:Ge,ewi_recipient:a,ground_reminder_recipient:n,restriction:ut,status:r}),affiliation:{site:ve,location:Se,scope:be,office:Ne,multi_sites:Oe},contact_numbers:{mobile_numbers:e,landline_numbers:t}},i=ct("Saving contact...",{variant:"warning",persist:!0,action:jt});yt(),function(e,t){var a="".concat(te.b,"/api/contacts/save_contact");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}(l,(function(e){var t,a=e.status,n=e.message;ot(i),!0===a?(!function(){if(!u){var e=ct("Updating contacts list...",{variant:"warning",persist:!0});d(e)}}(),t="success"):t="error",ct(n,{variant:t,autoHideDuration:5e3,action:jt})}))};return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},!u&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"-webkit-center"}},r.a.createElement(Js.a,null,r.a.createElement(cm.a,null))),r.a.createElement(y.a,{item:!0,xs:9},r.a.createElement(O.a,{variant:"h5",align:"center"},"Contact Form")),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(R.a,{edge:"start",onClick:yt},r.a.createElement(Zt.a,null))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Personal Details")),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"First Name",value:se.first_name,onChange:Ot("first_name"),margin:"dense",required:!0,error:""===se.first_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Last Name",value:se.last_name,onChange:Ot("last_name"),margin:"dense",required:!0,error:""===se.last_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Middle Name",value:se.middle_name||"",onChange:Ot("middle_name"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Nickname",value:se.nickname||"",onChange:Ot("nickname"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Affiliation")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ya,{div_id:"scope",label:"Scope",changeHandler:function(e){return ge(e.target.value)},value:be,list:ie,mapping:{id:"id",label:"label"},required:!0,error:""===be})),[0,1].includes(be)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(wa,{value:ve,changeHandler:function(e){return he(e)}})),[2,3,4].includes(be)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ya,{div_id:"location",label:ie[be].select_label,changeHandler:function(e){return Ce(e.target.value)},value:Se,list:St,mapping:{id:"id",label:"label"},required:!0,error:""===Se})),5===be&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wa,{value:Oe,changeHandler:function(e){return je(e)},isMulti:!0,isClearable:!0,enableSelectAll:!0})),we.length>0&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ya,{div_id:"office",label:"Office",changeHandler:function(e){return Ye(e.target.value)},value:Ne,list:we,mapping:{id:"id",label:"label"},required:!0,error:""===Ne})),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Dt.a,null,r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:rt,onChange:function(e){return lt(e.target.checked)},value:"checkedA",color:"primary"}),label:"Active"}))),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Dt.a,null,r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:Ke,onChange:function(e){return Je(e.target.checked)},value:"checkedB",color:"primary"}),label:"EWI Recipient"}))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(Dt.a,null,r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:et,onChange:function(e){return tt(e.target.checked)},value:"checkedC",color:"primary"}),label:"Ground Data Reminder Recipient"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ya,{div_id:"ewi_restriction",label:"Ewi Restriction",changeHandler:function(e){return dt(e.target.value)},value:ut,list:[{id:0,label:"No restrictions"},{id:-1,label:"Do not send on extended and routine monitoring"},{id:1,label:"Do not send on Alert 1"},{id:2,label:"Do not send on Alert 2 and below"}],mapping:{id:"id",label:"label"},required:!0,error:""===ut})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Mobile")),0===Be.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No mobile number saved")),Be.map((function(e,t){var a=e.mobile_number,l=a.sim_num,i=a.gsm_id,c=e.status,o="undefined"!==typeof e.has_delete,s=!0;return s=""===l||l.includes("x"),r.a.createElement(n.Fragment,{key:t},t>0&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"8px 0"}})),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Mobile Number",value:l,onChange:function(e){return Pe({type:"UPDATE",payload:{data:"sim_num",value:e.target.value,key:t},category:"mobile"})},InputProps:{inputComponent:dm,inputProps:{mask:sm}},required:!0,error:s}))),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(Ya,{div_id:"network",label:"Network",changeHandler:function(e){return Pe({type:"UPDATE",payload:{data:"gsm_id",value:e.target.value,key:t},category:"mobile"})},value:i,list:[{id:2,label:"Globe/TM"},{id:3,label:"Smart/TNT/Sun"}],mapping:{id:"id",label:"label"},required:!0,error:""===i})),r.a.createElement(y.a,{item:!0,xs:o?8:12,style:{textAlign:"center"}},r.a.createElement(wt.a,{style:{margin:0},control:r.a.createElement(Jt.a,{checked:Boolean(c),onChange:function(e){return Pe({type:"UPDATE",payload:{data:"status",value:e.target.checked?1:0,key:t},category:"mobile"})},color:"primary"}),label:"Active"})),o&&r.a.createElement(y.a,{item:!0,xs:4,style:{textAlign:"center"}},r.a.createElement(R.a,{edge:"end",size:"small","aria-label":"delete",title:"Delete number input",onClick:function(){return Pe({type:"DELETE",payload:{key:t}})}},r.a.createElement(Oi.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(om.a,null),onClick:function(){return Pe({type:"ADD",category:"mobile"})}},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Landline")),0===Ue.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No landline number saved")),Ue.map((function(e,t){var a=e.landline_num,l=e.pte_code,i=e.area_code,c=!0;return c=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:"landline-".concat(t)},r.a.createElement(y.a,{item:!0,xs:3},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Area Code",value:i||ht,onChange:function(e){return function(e,t){var a={type:"UPDATE",payload:{data:"area_code",value:e.target.value,key:t},category:"landline"};qe(a)}(e,t)},required:!0,error:""===ht}))),r.a.createElement(y.a,{item:!0,xs:3,style:{textAlign:"center"}},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"select-pte-cod-labele"},"PTE Code"),r.a.createElement(Na.a,{labelId:"select-pte-code-label",id:"select-pte-code",required:!0,value:l||0,onChange:function(e){return function(e,t){var a={type:"UPDATE",payload:{data:"pte_code",value:e.target.value,key:t},category:"landline"};qe(a)}(e,t)}},r.a.createElement(P.a,{value:0},"None"),r.a.createElement(P.a,{value:3},"3 - Bayan Telco"),r.a.createElement(P.a,{value:5},"5 - Eastern Comms. PH"),r.a.createElement(P.a,{value:6},"6 - ABS-CBN Convergence"),r.a.createElement(P.a,{value:7},"7 - Globe Telecom, Inc."),r.a.createElement(P.a,{value:8},"8 - PLDT, Inc.")))),r.a.createElement(y.a,{item:!0,xs:5},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Landline Number",value:a,onChange:function(e){return function(e,t){var a={type:"UPDATE",payload:{data:"landline_num",value:e.target.value,key:t},category:"landline"};qe(a)}(e,t)},InputProps:{inputComponent:dm,inputProps:{mask:[/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/]}},required:!0,error:c}))),r.a.createElement(y.a,{item:!0,xs:1,style:{textAlign:"center"}},r.a.createElement(R.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return qe({type:"DELETE",payload:{key:t}})}},r.a.createElement(Oi.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(om.a,null),onClick:function(){return qe({type:"ADD",category:"landline"})}},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Email")),0===Ge.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),Ge.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Email",value:e.email,onChange:function(e){return Ve({type:"UPDATE",payload:{value:e.target.value,key:t},category:"email"})}}))),r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(R.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return Ve({type:"DELETE",payload:{key:t}})}},r.a.createElement(Oi.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(om.a,null),onClick:function(){return Ve({type:"ADD",category:"email"})}},"Add email")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"16px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{color:"secondary",variant:"contained",style:{marginRight:6},onClick:function(){return At()},disabled:gt},"Save"),r.a.createElement(b.a,{variant:"contained",onClick:yt},"Cancel")))}));var Em=r.a.memo((function(e){var t=e.open,a=e.setSaveContactModal,l=e.mobileDetails,i=l.sim_num,s=l.mobile_id,m={emails:[],ewi_recipient:[],ewi_restriction:[],landline_numbers:[],first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0,organizations:[],status:0,mobile_numbers:[{mobile_number:{sim_num:i,mobile_id:s},priority:0,status:1}]},u=Object(n.useContext)(Te).contacts,d=Object(n.useState)("existing"),p=Object(o.a)(d,2),g=p[0],f=p[1],E=Object(n.useState)(!0),v=Object(o.a)(E,2),h=v[0],_=v[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(n.useState)(!0),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(c.b)().enqueueSnackbar,I=u.map((function(e){var t=e.user_id,a=e.first_name,n=e.last_name;return{label:"".concat(a," ").concat(n),value:t,data:e}})),M=function(){a(!1)};return r.a.createElement(Oe.a,{open:t,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Save mobile number (+".concat(i,")")),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Choose whether to add number to an existing contact or fill-out a new contact form."),r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex",marginBottom:16}},r.a.createElement(At.a,{"aria-label":"save-number-options",name:"save-number-options",row:!0,style:{justifyContent:"space-around"},value:g,onChange:function(e){return f(e.target.value)}},r.a.createElement(wt.a,{value:"existing",control:r.a.createElement(It.a,null),label:"Add to existing contact"}),r.a.createElement(wt.a,{value:"new",control:r.a.createElement(It.a,null),label:"Create new contact"}))),"existing"===g&&r.a.createElement(y.a,{container:!0,spacing:2,style:{marginBottom:200}},r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement(Sa,{label:"Contact Person",options:I,value:x,changeHandler:function(e){return k(e)},placeholder:"Type name of contact person",openMenuOnClick:!1,renderDropdownIndicator:!1,isClearable:!0})),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(vt.a,{title:"Inactive numbers will not receive EWI if a contact is an EWI recipient.",arrow:!0},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:D,onChange:function(e){return A(e.target.checked)},name:"is_active",color:"primary"}),label:"Set as active"})))),"new"===g&&r.a.createElement(fm,{setContactForm:function(e){_(!1)},chosenContact:m,isEditMode:h,setContactFormForEdit:function(e){_(e)},handleClose:M,isFromChatterbox:!0})),"existing"===g&&r.a.createElement(Se.a,null,r.a.createElement(b.a,{variant:"text",onClick:function(){!function(e,t){var a="".concat(te.b,"/api/contacts/attach_mobile_number_to_existing_user");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({user_id:x.value,mobile_id:s,status:D?1:0},(function(e){var t,a=e.status,n=e.message;!0===a?(M(),t="success"):t="error",w(n,{variant:t,autoHideDuration:4e3})}))},color:"secondary"},"Save"),r.a.createElement(b.a,{variant:"text",onClick:M,color:"primary"},"Cancel")))})),vm=Object(j.a)((function(e){return{inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}}));function hm(e,t){var a=[],n=[];return e.forEach((function(t){var r=t.user,l=t.status,i=r.first_name,c=r.last_name,o=r.organizations,s="".concat(i," ").concat(c),m=ie(o);1===e.length&&(n=Object(ye.a)(m));var u=s,d=null;m.length>0&&(u="".concat(m[0].toUpperCase(),": ").concat(m.slice(1).join(", ")),d=m[0]),a.push({sender:s,org:u,level:d,inactive:!l})})),{sender_arr:a,orgs_arr:n}}function _m(e,t){var a=t.sms_msg,n=t.ts,l=t.source,i=t.send_status,c=t.ts_sent,o=function(e){var t=$()(e);return t.isSame($()(),"day")?t.format("HH:mm"):t.format("MMM D")}(n);return r.a.createElement(y.a,{container:!0,justify:"space-between",spacing:0},r.a.createElement(y.a,{item:!0,xs:1,style:{flexBasis:0,marginRight:6}},"inbox"===l?r.a.createElement(Xs.a,{fontSize:"small"}):r.a.createElement(Z.a,{fontSize:"small"})),r.a.createElement(y.a,{item:!0,xs:!0,className:e.overflowEllipsis},a),r.a.createElement(y.a,{item:!0,style:{marginRight:8},className:e.noFlexGrow},o),r.a.createElement(y.a,{item:!0,style:{paddingTop:2,marginRight:8}},(0===i||null===i&&null!==c)&&r.a.createElement($s.a,{className:e.sentIcon}),i>0&&i<=5&&r.a.createElement(qa.a,{color:"primary",className:e.sentIcon}),(-1===i||i>5)&&r.a.createElement(yt.a,{color:"error",className:e.sentIcon})))}var ym=r.a.memo((function(e){var t=e.messagesArr,a=e.hidden,l=vm(),i=Object(p.a)(Object(p.a)({},e),{},{classes:l}),c=r.a.useState(!1),s=Object(o.a)(c,2),u=s[0],d=s[1],b=r.a.useState(!1),g=Object(o.a)(b,2),f=g[0],E=g[1],v=r.a.useState(!1),_=Object(o.a)(v,2),j=_[0],x=_[1],k=r.a.useState(!1),S=Object(o.a)(k,2),C=S[0],D=S[1],A=r.a.useState({}),w=Object(o.a)(A,2),I=w[0],M=w[1],T=function(e,t){E(e),M(t),d(!0)};return r.a.createElement(n.Fragment,null,0===t.length?r.a.createElement(h.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?l.hidden:""},r.a.createElement("div",null,"No conversations")):r.a.createElement(Or.a,{dense:!0,className:a?l.hidden:""},t.slice(0,50).map((function(e,t){return function(e,t,a,l){var i=e.messages,c=e.mobile_details,s=t.classes,u=t.url,d=t.width,b=t.async,g=t.is_desktop,f=t.searchFilters,E=c.mobile_id,v=c.sim_num,h=c.users,_=oe(v),j=[{sender:_,org:_,inactive:!1}],x=[],k=0===h.length;if(!k){var S=hm(h),C=S.sender_arr,D=S.orgs_arr;j=C,x=D}var A=null;if("undefined"!==typeof f&&(A=Object(p.a)({},f),i.length>0)){var w=Object(o.a)(i,1)[0],I=w.is_per_convo,M=w.ts;I&&(A.ts_end=M)}var T=f?"No conversations":"No conversation yet",N=r.a.createElement(em.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return r.a.createElement(m.b,{to:{pathname:"".concat(u,"/").concat(E),state:{async:b,search_filters:A,test:"data"}},key:"".concat(l,"-").concat(E),className:s.link},r.a.createElement(xr.a,{alignItems:"center",button:!0},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,{alt:"User",src:nm.a,className:s.bigAvatar})),r.a.createElement(kr.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0,className:s.noFlexGrow},r.a.createElement(O.a,{variant:"body1",className:s.overflowEllipsis,component:"div",style:{display:"flex",alignItems:"center"}},j.map((function(e,t){return r.a.createElement(n.Fragment,{key:"".concat(e.sender,"-").concat(E)},j.length>1&&e.inactive&&N,r.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<j.length-1&&","))})))),x.map((function(e,t){var a=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:s.noFlexGrow},r.a.createElement(ba.a,{color:a,size:"small",label:e}))})),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,container:!0,justify:Object(Ge.c)("sm",d)?"flex-end":"flex-start",alignItems:"center"},1===j.length&&j[0].inactive&&N,r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},_)),r.a.createElement(y.a,{item:!0,xs:!0,style:{textAlign:"right",flexGrow:g?0:1,flexBasis:"auto"}},r.a.createElement(R.a,{size:"small",onClick:function(e){e.preventDefault(),a(k,c)}},r.a.createElement(tm.a,null)))),primaryTypographyProps:{className:s.overflowEllipsis},secondary:i.length>0?_m(s,i[0]):r.a.createElement("div",{style:{textAlign:"center"}},T),secondaryTypographyProps:{component:"div"}})))}(e,i,T,t)}))),r.a.createElement(lm,{open:u,onClose:function(e){d(!1)},isUnregistered:f,setBlockModal:x,setSaveContactModal:D}),r.a.createElement(im,{open:j,setBlockModal:x,mobileDetails:I,setOpenOptions:d}),r.a.createElement(Em,{open:C,setSaveContactModal:D,mobileDetails:I,setOpenOptions:d}))})),Om=a(1227),jm=a(1228),xm=a(1224),km=a(1225),Sm=Object(j.a)((function(e){return Object(_e.d)(e)}));function Cm(e){var t=e.sim_num,a=e.users,n=t;if(a.length>0){var r=hm(a).sender_arr,l=[];r.forEach((function(e){var t=e.sender,a=e.level;if(!e.inactive){var n=null!==a?"".concat(a," "):"";l.push("".concat(n).concat(t))}})),l.length>0&&(n=l.join(", ")),l.length>1&&(n+="(shared number)")}return n}var Dm=Object(Ce.a)()((function(e){var t=e.has_multiple_sites,a=e.fullScreen,l=e.isOpen,i=e.closeHandler,c=e.tagOption,m=e.tagObject,u=e.mobileDetails,d=e.message,p=Sm(),g=function(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],l=a[1],i=ne.a.CancelToken.source();return Object(n.useEffect)((function(){var t="".concat(te.b,"/api/chatterbox/get_message_tag_options/sms").concat(e,"_users");ne.a.get(t,{cancelToken:i.token}).then((function(e){var t=e.data.map((function(e){return{value:e.tag_id,label:e.tag}}));l(t)})).catch((function(e){console.log(e)}))}),[e]),r}(c),E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],_=v[1],O=Object(n.useState)([]),j=Object(o.a)(O,2),S=j[0],C=j[1],D=Object(n.useState)(!1),A=Object(o.a)(D,2),w=A[0],I=A[1],M=Object(n.useState)(!1),T=Object(o.a)(M,2),N=T[0],Y=T[1],R=Object(n.useState)(!1),H=Object(o.a)(R,2),B=H[0],P=H[1],L=Object(n.useState)(!1),F=Object(o.a)(L,2),U=F[0],q=F[1],W=Object(n.useState)(!1),z=Object(o.a)(W,2),G=z[0],V=z[1],Q=Object(n.useState)(null),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)(""),ee=Object(o.a)(X,2),ae=ee[0],re=ee[1],le=Object(n.useState)(""),ie=Object(o.a)(le,2),ce=ie[0],oe=ie[1],se=Object(n.useState)(""),ue=Object(o.a)(se,2),de=ue[0],pe=ue[1],be=Object(n.useState)(""),ge=Object(o.a)(be,2),fe=ge[0],Ee=ge[1],ve=Object(n.useState)(null),he=Object(o.a)(ve,2),_e=he[0],Ce=he[1],De=u.users.length>0;Object(n.useEffect)((function(){null!==h?(I(h.some((function(e){return"#AlertFYI"===e.label}))),Y(h.some((function(e){return"#Permission"===e.label}))),P(h.some((function(e){return"#RainInfo"===e.label}))),q(h.some((function(e){return"#GroundMeasResend"===e.label}))),V(h.some((function(e){return"#EwiResponse"===e.label})))):(I(!1),Y(!1),P(!1),q(!1),V(!1))}),[h]);var Ae=Object(n.useState)(!1),we=Object(o.a)(Ae,2),Ie=we[0],Me=we[1];return Object(n.useEffect)((function(){var e=!1;De?(w&&(null!==K&&""!==ae||(e=!0)),N&&(null!==K&&""!==ce||(e=!0)),(B||G)&&(e=null===K&&"specified-sites"===de||""===de),U&&(e=null===K||""===fe||null===_e)):e=!0,Me(e)}),[w,K,ae,N,ce,B,de,U,fe,_e,G]),Object(n.useEffect)((function(){var e=m.tags.map((function(e){return{value:e.tag_id,label:e.tag.tag}}));_(e),C(e)}),[m]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:a,open:l,"aria-labelledby":"form-dialog-title",TransitionComponent:a?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Chatterbox Message Tagging"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Attach or remove tags to a message."),r.a.createElement(ke.a,{className:p.dyna_error},"NOTE: You must manually remove any site logs created (if any) by a tag when removing a tag to a message."),0===g.length?r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(x.a,null)):r.a.createElement(n.Fragment,null,r.a.createElement(Sa,{label:"Tags",options:g,value:h,changeHandler:function(e){return _(e)},placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0}),w&&r.a.createElement("div",{style:{marginTop:18}},r.a.createElement(ke.a,{color:"textPrimary"},"Alert FYI"),r.a.createElement(wa,{value:K,changeHandler:function(e){return J(e)},isMulti:!0,required:!0}),r.a.createElement(Xt.a,{component:"legend",style:{marginTop:24}},"Purpose"),r.a.createElement(At.a,{"aria-label":"fyi-purpose",name:"fyi-purpose",row:!0,style:{justifyContent:"space-around"},value:ae,onChange:function(e){return re(e.target.value)}},r.a.createElement(wt.a,{value:"alert raising",control:r.a.createElement(It.a,null),label:"Alert raising"}),r.a.createElement(wt.a,{value:"alert lowering",control:r.a.createElement(It.a,null),label:"Alert lowering"}))),(B||G)&&r.a.createElement("div",{style:{marginTop:18}},r.a.createElement(ke.a,{color:"textPrimary"},B?"Rainfall Information":"EWI Response"),r.a.createElement(Xt.a,{component:"legend",style:{marginTop:12}},"Attach narrative to"),r.a.createElement(At.a,{"aria-label":"attach-narrative",name:"attach-narrative",row:!0,style:{justifyContent:"space-around",marginBottom:12},value:de,onChange:function(e){return pe(e.target.value)}},r.a.createElement(wt.a,{value:"default-sites",control:r.a.createElement(It.a,null),label:"All sites of stakeholder"}),r.a.createElement(wt.a,{value:"specified-sites",control:r.a.createElement(It.a,null),label:"Specify sites"})),"specified-sites"===de&&r.a.createElement(wa,{value:K,changeHandler:function(e){return J(e)},isMulti:!0,required:!0})),N&&r.a.createElement("div",{style:{marginTop:18}},r.a.createElement(ke.a,{color:"textPrimary"},"Permission"),r.a.createElement(wa,{value:K,changeHandler:function(e){return J(e)},isMulti:!0,required:!0}),r.a.createElement(Xt.a,{component:"legend",style:{marginTop:24}},"Purpose"),r.a.createElement(At.a,{"aria-label":"permission-purpose",name:"permission-purpose",row:!0,style:{justifyContent:"space-around"},value:ce,onChange:function(e){return oe(e.target.value)}},r.a.createElement(wt.a,{value:"alert 3 raising",control:r.a.createElement(It.a,null),label:"Alert 3 Raising"}),r.a.createElement(wt.a,{value:"alert 3 lowering",control:r.a.createElement(It.a,null),label:"Alert 3 Lowering"}),r.a.createElement(wt.a,{value:"on demand raising",control:r.a.createElement(It.a,null),label:"On Demand Raising"}))),U&&r.a.createElement("div",{style:{marginTop:18}},r.a.createElement(ke.a,{color:"textPrimary"},"Ground Measurement Resend"),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xt.a,{component:"legend",style:{marginBottom:12}},"Attach narrative to"),r.a.createElement(wa,{value:K,changeHandler:function(e){return J(e)},isMulti:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{required:!0,label:"Sender",value:fe,onChange:function(e){return Ee(e.target.value)},fullWidth:!0,title:"Name of ground data sender (this will appear on site log)"})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(ta.b,{required:!0,autoOk:!0,label:"Timestamp Received",value:_e,onChange:function(e){return Ce(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,title:"Timestamp when data was received (either via Facebook or GSM server)"})))))),t&&"outbox"===c&&r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xt.a,{component:"legend",style:{marginTop:12}},"Attach manual EWI narrative to"),r.a.createElement(wa,{value:K,changeHandler:function(e){return J(e)},isMulti:!0,required:!0})))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{color:"primary",onClick:function(){var e=m.id,a=m.source,n=m.ts,r=null,l=[];w||(u.users.forEach((function(e){e.user.organizations.forEach((function(e){var t=e.site.site_id;!l.includes(t)&&l.push(t)}))})),r=Cm(u)),U&&(r=fe,n=_e.format("YYYY-MM-DD HH:mm:00")),(N||w||U||(B||G)&&"specified-sites"===de)&&(l=[],l=K.map((function(e){return e.value}))),t&&"outbox"===c&&(l=K.map((function(e){return e.value})));var o="inbox"===a?"inbox_id":"outbox_id",p=[];if(S.length>0&&(p=null===h?Object(ye.a)(S):S.filter((function(e){return!h.some((function(t){return t.value===e.value}))}))),p.length>0){var b,g=p.map((function(e){return e.value}));!function(e,t){me("".concat(te.b,"/api/general_data_tag/handle_delete_tags"),e,t)}({tag_type:"sms".concat(a,"_user_tags"),tag_details:(b={},Object(s.a)(b,o,e),Object(s.a)(b,"delete_tag_id_list",g),b)},(function(e){console.log("untag response",e)}))}var f,E=[];if(null!==h&&(E=h.filter((f=0,function(e){return e!==S[f]||!++f}))),E.length>null){var v,_=E.map((function(e){return e.value})),y=d;w?y=ae:N&&(y=ce),function(e,t){me("".concat(te.b,"/api/general_data_tag/handle_update_insert_tags"),e,t)}({tag_type:"sms".concat(a,"_user_tags"),contact_person:r,message:y,tag_details:(v={user_id:Object(k.a)().user_id},Object(s.a)(v,o,e),Object(s.a)(v,"tag_id_list",_),Object(s.a)(v,"site_id_list",l),Object(s.a)(v,"ts",$()().format("YYYY-MM-DD HH:mm:ss")),Object(s.a)(v,"ts_message",n),v)},(function(e){console.log("tag response",e)}))}i()},disabled:Ie},"Submit"),r.a.createElement(b.a,{onClick:i},"Cancel")))})),Am=Object(j.a)((function(e){var t;return{root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"},chatItemSent:{justifyContent:"flex-end"},chatBubble:(t={flexGrow:0,maxWidth:"65%"},Object(s.a)(t,e.breakpoints.down("xs"),{maxWidth:"75%"}),Object(s.a)(t,e.breakpoints.up("md"),{maxWidth:"50%"}),Object(s.a)(t,"paddingLeft","12px !important"),Object(s.a)(t,"paddingRight",12),Object(s.a)(t,"paddingTop",12),Object(s.a)(t,"paddingBottom",6),Object(s.a)(t,"border","solid 1px rgba(215, 215, 215, 1)"),Object(s.a)(t,"backgroundColor","rgba(245, 245, 245, 1)"),t),chatBubbleReceived:{marginLeft:14,"&:before":{content:"''",left:69,right:"auto",top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:71.5,right:"auto",top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatBubbleSent:{marginRight:14,"&:before":{content:"''",left:"auto",right:69,top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:"auto",right:71.5,top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatMessage:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",fontSize:"0.75rem",lineHeight:"1.25em"},timestampArea:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:12},timestamp:{fontSize:"0.65rem"},tagButton:{padding:0,zIndex:1},sentIcon:{fontSize:"1rem"}}}));var wm=Object(j.a)((function(e){return{arrow:{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}},popper:(t=e.palette.common.black,{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(t," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(t," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(t," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(t)}}}),tooltip:{position:"relative",backgroundColor:e.palette.common.black},tooltipPlacementLeft:{margin:"0 8px"},tooltipPlacementRight:{margin:"0 8px"},tooltipPlacementTop:{margin:"8px 0"},tooltipPlacementBottom:{margin:"8px 0"}};var t}));function Im(e){var t=wm(),a=t.arrow,n=Object(da.a)(t,["arrow"]),l=r.a.useState(null),i=Object(o.a)(l,2),c=i[0],s=i[1],m=e.title;return r.a.createElement(vt.a,Object.assign({classes:n,PopperProps:{popperOptions:{modifiers:{arrow:{enabled:Boolean(c),element:c}}}}},e,{title:r.a.createElement(r.a.Fragment,null,m,r.a.createElement("span",{className:a,ref:s}))}))}var Mm=function(e){var t=e.has_multiple_sites,a=e.message_list,l=e.mobileDetails,i=e.searchFilters,c=e.setScrollToBottom,s=Am(),m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(!1),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(""),_=Object(o.a)(h,2),y=_[0],j=_[1],k={id:"",source:"",tags:[]},S=Object(n.useState)(k),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(1),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),H=Y[0],B=Y[1],P=Object(n.useState)(!1),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)(!1),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(null),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1];Object(n.useEffect)((function(){var e=a.slice(0).reverse();p(e),B(e),c(!0)}),[a,c]);var J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,a=arguments.length>2?arguments[2]:void 0;return function(){A(t),v(e),j(a)}},X=function(e){var t=e.convo_id,a=d.map((function(e){return e.convo_id===t&&(e.send_status=0),e}));p(a),function(e,t){var a="".concat(te.b,"/api/chatterbox/resend_message/").concat(e);ne.a.get(a).then((function(e){var a=e.data;console.log("Resend message",a),"undefined"!==typeof t&&t(a)})).catch((function(e){console.error(e)}))}(t)},ee=function(e){G(!0);var t=l.users,a=l.sim_num,n="+".concat(a),r=n;if(null!==t&&t.length>0){var i=t[0].user,c=i.first_name,o=i.last_name;r="".concat(c," ").concat(o," (").concat(n,")")}var s={ts:e.ts,message:e.sms_msg,source:e.source,contact:r};K(s)},ae=i?"No conversations":"No conversation yet";return r.a.createElement(n.Fragment,null,0===a.length&&r.a.createElement(O.a,{variant:"subtitle1",align:"center",style:{marginTop:8}},ae),H.length>=20&&r.a.createElement(b.a,{color:"primary",size:"small",fullWidth:!0,onClick:function(){var e=l.mobile_id;U(!0),function(e,t,a){var n="".concat(te.b,"/api/chatterbox/load_more_messages/").concat(e,"/").concat(t);ne.a.get(n).then((function(e){var t=e.data;console.log("Additional loaded messages",t),a(t)})).catch((function(e){console.error(e)}))}(e,M,(function(e){U(!1),B(e);var t=e.slice(0).reverse();p(t.concat(d))})),T(M+1)},endIcon:F&&r.a.createElement(x.a,{size:"1.5rem"})},r.a.createElement("strong",null,"Load",F&&"ing"," more messages...")),r.a.createElement(Or.a,{className:s.root},d.map((function(e){return function(e,t,a,l,i){var c=t.convo_id,s=t.source,m=t.sms_msg,u=t.ts,d=t.ts_sent,p=t.send_status,b=t.tags,g={tags:b,source:s,ts:u,id:t["".concat(s,"_id")]},f="outbox"===s,E=$()(u).format("M/D/YYYY HH:mm:ss"),v=r.a.createElement(Ks.a,{style:{textAlign:"-webkit-center"}},r.a.createElement(Js.a,{alt:"Remy Sharp",src:nm.a})),h=b.length>0,_=h?r.a.createElement(xm.a,{fontSize:"small",color:"primary"}):r.a.createElement(km.a,{fontSize:"small",color:"primary"}),y=b.map((function(e){return e.tag.tag})).join(", "),j=[v,r.a.createElement(kr.a,{className:"".concat(e.chatBubble," ").concat(f?e.chatBubbleSent:e.chatBubbleReceived),primary:r.a.createElement(O.a,{component:"span",className:e.chatMessage,variant:"body2",color:"textPrimary"},r.a.createElement("span",{style:{paddingRight:6,zIndex:1}},m),r.a.createElement(Im,{disableFocusListener:!0,disableHoverListener:!h,title:y},r.a.createElement(R.a,{className:e.tagButton,onClick:a(!0,g,m)},_)),r.a.createElement(R.a,{className:e.tagButton,onClick:function(){return i(t)},title:"Insert to logs"},r.a.createElement(Qs.a,{fontSize:"small",color:"primary"}))),secondary:r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.timestamp,style:{paddingRight:f?6:0}},E),p>=0&&p<5&&null!==p&&r.a.createElement(Im,{disableFocusListener:!0,title:"SENDING"},r.a.createElement($s.a,{className:e.sentIcon})),5===p&&r.a.createElement(Im,{disableFocusListener:!0,title:"SENT: ".concat($()(d).format("M/D/YYYY HH:mm:ss"))},r.a.createElement(qa.a,{color:"primary",className:e.sentIcon})),(-1===p||p>5)&&r.a.createElement(n.Fragment,null,r.a.createElement(Im,{disableFocusListener:!0,title:"UNSENT"},r.a.createElement(yt.a,{color:"error",className:e.sentIcon})),r.a.createElement(Im,{disableFocusListener:!0,title:"Resend"},r.a.createElement(Ul.a,{color:"action",className:e.sentIcon,onClick:function(){return l(t)}})))),secondaryTypographyProps:{component:"div",className:e.timestampArea}})];f&&(j=j.reverse());var x=j,k=Object(o.a)(x,2),S=k[0],C=k[1];return r.a.createElement(xr.a,{alignItems:"flex-start",className:f?e.chatItemSent:"",key:c},S,C)}(s,e,J,X,ee)}))),r.a.createElement(Dm,{has_multiple_sites:t,isOpen:E,closeHandler:J(!1),tagOption:D.source,tagObject:D,mobileDetails:l,message:y}),r.a.createElement(Di,{isOpen:z,closeHandler:function(){return G(!1)},saveOnly:!0,isFromChatterbox:Z}))},Tm=Object(j.a)((function(e){var t,a,n=Object(_e.d)(e);return{regularContainer:Object(p.a)(Object(p.a)({},n.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(p.a)({},n.pageContentMargin),divider:Object(p.a)(Object(p.a)({},n.pageContentMargin),{},{margin:0}),sticky:(t={position:"sticky",top:56},Object(s.a)(t,e.breakpoints.up("sm"),{top:63}),Object(s.a)(t,e.breakpoints.up("md"),{top:118}),Object(s.a)(t,"backgroundColor","white"),Object(s.a)(t,"borderBottom","1px solid rgba(0, 0, 0, 0.12)"),Object(s.a)(t,"zIndex",3),t),chatHead:(a={paddingLeft:8},Object(s.a)(a,e.breakpoints.up("md"),{paddingLeft:0}),Object(s.a)(a,"display","flex"),Object(s.a)(a,"alignItems","center"),a),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40},noFlexGrow:{flexGrow:0}}})),Nm=function(){return r.a.createElement(ft.a,{height:70,width:800,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 800 70",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},r.a.createElement("rect",{x:"69",y:"7",rx:"4",ry:"4",width:"663",height:"19"}),r.a.createElement("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"293",height:"14"}),r.a.createElement("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"201",height:"6"}),r.a.createElement("circle",{cx:"30",cy:"30",r:"30"}))},Ym=function(e){return r.a.createElement(ft.a,{height:160,width:446,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"3 0 446 160",preserveAspectRatio:"xMinYMin slice",style:{height:"100%",width:"100%"}},r.a.createElement("circle",{cx:"19",cy:"25",r:"16"}),r.a.createElement("rect",{x:"40",y:"12",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"40",y:"29",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"420",cy:"71",r:"16"}),r.a.createElement("rect",{x:"179",y:"76",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"179",y:"58",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"21",cy:"117",r:"16"}),r.a.createElement("rect",{x:"45",y:"104",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"45",y:"122",rx:"5",ry:"5",width:"220",height:"10"}))};function Rm(e){var t=e.setHasMultipleSites,a=e.mobile_details,l=e.classes,i=e.saveNumberModal,c=e.searchFilters,s=a.users,m=oe(a.sim_num),u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],b=d[1],g=[{sender:m,org:m,inactive:!1}],f=[];Object(n.useEffect)((function(){t(f.length>2)}),[f]);var E=0===s.length;if(!E){var v=hm(s),h=v.sender_arr,j=v.orgs_arr;g=h,f=j}var x=r.a.createElement(em.a,{style:{color:"red",marginRight:6},fontSize:"small",titleAccess:"Inactive number"});return r.a.createElement(y.a,{container:!0,alignItems:"center"},r.a.createElement("div",{style:{marginRight:12}},r.a.createElement(Js.a,{alt:"User",src:nm.a,className:l.bigAvatar})),r.a.createElement("div",null,r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(O.a,{variant:"body1",component:"div",style:{display:"flex",alignItems:"center"}},g.map((function(e,t){return r.a.createElement(n.Fragment,{key:e.sender},g.length>1&&e.inactive&&x,r.a.createElement("span",{title:e.org,style:{paddingRight:4}},e.sender,t<g.length-1&&","))})))),f.map((function(e,t){var a=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:l.noFlexGrow},r.a.createElement(ba.a,{color:a,size:"small",label:e}))}))),!E&&r.a.createElement(y.a,{container:!0,alignItems:"center"},1===g.length&&g[0].inactive&&x,r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},m))),r.a.createElement(_.a,{ml:1,flex:"display"},c&&r.a.createElement(vt.a,{title:"Filters enabled",arrow:!0},r.a.createElement(Om.a,{color:"primary"}))),E&&r.a.createElement(y.a,{container:!0,item:!0,xs:!0,justify:"flex-end"},r.a.createElement(R.a,{size:"small","aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){b(e.currentTarget)}},r.a.createElement(tm.a,null)),r.a.createElement(B.a,{id:"simple-menu",anchorEl:p,getContentAnchorEl:null,keepMounted:!0,open:Boolean(p),onClose:function(){b(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(P.a,{style:{fontSize:12},key:"save_unknown",onClick:function(){b(null),i()}},"Save unknown number"))))}var Hm=function(e){return function(t){t.preventDefault(),e.goBack()}};var Bm=function(e){var t=e.history,a=e.match.params.mobile_id,l=e.location.state,i=null;if("undefined"!==typeof l){var s=l.search_filters;i=s}var m=Tm(),u=Object(k.a)(),d=Object(c.b)(),p=d.enqueueSnackbar,g=d.closeSnackbar,f=Object(n.useState)(!1),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)({message_list:null,mobile_details:{}}),y=Object(o.a)(_,2),O=y[0],j=y[1],x=Object(n.useState)(""),S=Object(o.a)(x,2),C=S[0],D=S[1],A=Object(n.useState)(""),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)(null),N=Object(o.a)(T,2),Y=N[0],H=N[1],B=Object(n.useState)([]),P=Object(o.a)(B,2),L=P[0],F=P[1],U=Object(n.useState)(!1),q=Object(o.a)(U,2),W=q[0],z=q[1];Object(n.useEffect)((function(){var e;return"undefined"!==typeof ve&&(ve.emit("join_mobile_id_room",{mobile_id:a,search_filters:i}),e=function(e){var t=e.mobile_details,a=e.messages;j({mobile_details:t,message_list:a})},ve.on("receive_mobile_id_room_update",(function(t){console.log("Mobile ID Room Update",t),e(t)}))),function(){"undefined"!==typeof ve&&(ve.emit("leave_mobile_id_room",a),ve.removeListener("receive_mobile_id_room_update"))}}),[ve,a,i]);var G=O.mobile_details,V=O.message_list,Z=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){g(e)}},"Dismiss")},K=Object(n.useRef)(null),J=Object(n.useState)(!1),X=Object(o.a)(J,2),$=X[0],ee=X[1];return Object(n.useEffect)((function(){K.current.scrollIntoView()}),[$]),r.a.createElement(n.Fragment,null,null==V?r.a.createElement("div",{className:m.regularContainer,style:{paddingLeft:16,paddingBottom:0}},r.a.createElement(Nm,null)):r.a.createElement("div",{className:"".concat(m.regularContainer," ").concat(m.sticky)},r.a.createElement("div",{className:m.chatHead},r.a.createElement(R.a,{"aria-label":"Back",color:"primary",className:m.backButton,onClick:Hm(t)},r.a.createElement(jm.a,{className:m.backIcon})),r.a.createElement(Rm,{setHasMultipleSites:z,mobile_details:G,classes:m,saveNumberModal:function(){h(!0)},searchFilters:i}))),r.a.createElement("div",{className:m.regularContainer},null===V?r.a.createElement("div",{style:{padding:"0 16px"}},r.a.createElement(Ym,{style:{height:"100%"}})):r.a.createElement(Mm,{has_multiple_sites:W,message_list:V,searchFilters:i,mobileDetails:G,setScrollToBottom:ee})),null!==V&&r.a.createElement(n.Fragment,null,r.a.createElement(Q.a,{className:m.divider}),r.a.createElement("div",{className:m.chatInputContainer},r.a.createElement(Fa,{value:C,disableSend:""===C,setComposedMessage:D,messageChangeHandler:function(e){return D(e.target.value)},sendButtonClickHandler:function(){var e=G.mobile_id,t=G.gsm_id,a=Cm(G),n={sms_msg:"".concat(C," - ").concat(u.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:[{mobile_id:e,gsm_id:t}],is_ewi:!1,priority:parseInt(I,10)||null,ts_sending:Y?Y.format("YYYY-MM-DD HH:mm:ss"):null,user_id:u.user_id,tag_data:{site_list:L.map((function(e){return e.value})),contact_person:a}},r=ia,l="Message successfully sent!";null!==n.ts_sending&&(r=ca,l="Message successfully queued!"),r(n,(function(e){e.status?(p(l,{variant:"success",autoHideDuration:7e3,action:Z}),D("")):p(e.message,{variant:"error",autoHideDuration:7e3,action:Z})}),(function(){p("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:Z})}))},setPriority:M,setTsSending:H,priority:I,tsSending:Y,sites:L,setSites:F}))),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:K}),r.a.createElement(Em,{open:v,setSaveContactModal:h,mobileDetails:G}))};const Pm=Object(j.a)(e=>({dialogContent:{"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}}}));var Lm=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,l=e.recipientsList,i=Pm();return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send a Message"),r.a.createElement(R.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Zt.a,null)))),r.a.createElement(xe.a,{className:i.dialogContent},r.a.createElement(ke.a,null,"Choose your recipients and compose a message, then send it."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(Ja,{isMobile:t,textboxValue:"",recipientsList:l,modalStateHandler:a}))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:a,color:"primary"},"Cancel")))})),Fm=a(1114),Um=a(652),qm=a(350),Wm=a.n(qm),zm=a(631);var Gm=Object(zm.a)(Object(d.a)(e=>({fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:1}})),Object(Ge.a)())((function(e){const t=e.classes,a=e.clickHandler,n=e.width;return r.a.createElement(Fm.a,{in:!0,unmountOnExit:!0,style:{transitionDelay:"100ms"}},r.a.createElement(Um.a,{color:"secondary","aria-label":"Add",className:t.fab,size:Object(Ge.c)("md",n)?"large":"medium",onClick:a},r.a.createElement(Wm.a,null)))})),Vm=Object(n.createContext)(),Qm={sites:[],orgs:[],only_ewi_recipients:!1,include_inactive_numbers:!1,ts_start:null,ts_end:null,string_search:"",tag_search:{value:""},mobile_number_search:"",name_search:""};function Zm(e,t){var a=t.type,n=t.value;switch(a){case"UPDATE_SITES":var r=n;return null===r&&(r=[]),Object(p.a)(Object(p.a)({},e),{},{sites:r});case"UPDATE_ORGS":var l=n;return null===l&&(l=[]),Object(p.a)(Object(p.a)({},e),{},{orgs:l});case"UPDATE_ONLY_EWI_RECIPIENTS":return Object(p.a)(Object(p.a)({},e),{},{only_ewi_recipients:n});case"UPDATE_INCLUDE_INACTIVE_NUMBERS":return Object(p.a)(Object(p.a)({},e),{},{include_inactive_numbers:n});case"UPDATE_TS_START":return Object(p.a)(Object(p.a)({},e),{},{ts_start:n});case"UPDATE_TS_END":return Object(p.a)(Object(p.a)({},e),{},{ts_end:n});case"UPDATE_STRING_SEARCH":return Object(p.a)(Object(p.a)({},e),{},{string_search:n});case"UPDATE_TAG_SEARCH":var i=n;return null===i&&(i={value:""}),Object(p.a)(Object(p.a)({},e),{},{tag_search:i});case"UPDATE_MOBILE_NUMBER_SEARCH":return Object(p.a)(Object(p.a)({},e),{},{mobile_number_search:n});case"UPDATE_NAME_SEARCH":var c=n;return null===c&&(c=""),Object(p.a)(Object(p.a)({},e),{},{name_search:c});case"UPDATE_ALL_DATA":return Object(p.a)({},n);case"RESET":return Object(p.a)({},Qm);default:return Object(p.a)({},e)}}function Km(e){var t=e.children,a=Object(n.useReducer)(Zm,Qm),l=Object(o.a)(a,2),i={search_state:l[0],search_dispatch:l[1]};return r.a.createElement(Vm.Provider,{value:i},t)}var Jm=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,l=e.setSearchResultsToEmpty,i=e.modalState,c=e.url,s=e.tagList,u=e.recipientsList,d=Object(n.useContext)(Ca).organizations,p=Object(n.useContext)(Vm),g=p.search_state,E=p.search_dispatch,v=g.sites,h=g.orgs,_=g.only_ewi_recipients,j=g.include_inactive_numbers,x=g.ts_start,k=g.ts_end,S=g.string_search,C=g.tag_search,D=g.mobile_number_search,A=g.name_search,w=Object(n.useState)([]),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),R=Y[0],H=Y[1];Object(n.useEffect)((function(){var e=d.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}}));T(e)}),[d]);var L=Object(n.useState)(!0),F=Object(o.a)(L,2),U=F[0],q=F[1],W=v.length>0||h.length>0,z=[x,k].every((function(e){return null===e})),G=[x,k].every((function(e){return null!==e}))||z;Object(n.useEffect)((function(){var e=!0;W?G&&(e=!1):G&&!z&&(e=!1),(D||A||S||C.label)&&(e=!1),q(e)}),[v,h,x,k,D,A,S,C,z,G,W]),Object(n.useEffect)((function(){if("undefined"!==typeof u){var e=u.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,l=t;return""!==n&&(l="".concat(t," (").concat(n,")")),{label:l+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));H(e)}}),[u]);var V=Object(n.useState)(null),Z=Object(o.a)(V,2),K=Z[0],J=Z[1],X=function(){return J(null)},ee=function(e,t){E({type:"UPDATE_TS_END",value:$()()}),E({type:"UPDATE_TS_START",value:$()().subtract(e,t)}),X()};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:i,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},"Search Chatterbox"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Fill in at least one field from any of the filters. NOTE: the broader the search filters, the longer the query might run."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(O.a,{variant:"subtitle1",component:y.a,item:!0,xs:12},"CONTACT FILTERS"),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(wa,{value:v,changeHandler:function(e){return E({type:"UPDATE_SITES",value:e})},isMulti:!0,disabled:Boolean(D||A)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Sa,{label:"Organization(s)",options:M,value:h,changeHandler:function(e){return E({type:"UPDATE_ORGS",value:e})},placeholder:"Select organization(s)",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0,isDisabled:Boolean(D||A)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"OR")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Sa,{label:"Saved Contact",options:R,value:A,changeHandler:function(e){return E({type:"UPDATE_NAME_SEARCH",value:e})},placeholder:"Select contact",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0,isDisabled:Boolean(W||D)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"OR")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{id:"mobile-number-filter",label:"Mobile Number",type:"number",value:D,onChange:function(e){return E({type:"UPDATE_MOBILE_NUMBER_SEARCH",value:e.target.value})},placeholder:"Start number entry with 639 or enter last four digits",InputLabelProps:{shrink:!0},disabled:Boolean(W||A)}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(O.a,{variant:"subtitle1",component:y.a,item:!0,xs:12},"MESSAGE FILTERS"),r.a.createElement(O.a,{variant:"subtitle2",component:y.a,item:!0,xs:12},"Note: Date filters required for tag and string search."),r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(y.a,{item:!0,xs:12,sm:5},r.a.createElement(ta.b,{autoOk:!0,label:"Start Date/Time",value:x,onChange:function(e){return E({type:"UPDATE_TS_START",value:e})},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null===x&&null!==k,helperText:null===x&&null!==k&&"Both date/time must have values"})),r.a.createElement(y.a,{item:!0,xs:12,sm:5},r.a.createElement(ta.b,{autoOk:!0,label:"End Date/Time",value:k,onChange:function(e){return E({type:"UPDATE_TS_END",value:e})},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0,InputLabelProps:{shrink:!0},error:null!==x&&null===k,helperText:null!==x&&null===k&&"Both date/time must have values"})),r.a.createElement(y.a,{item:!0,xs:12,sm:2},r.a.createElement(b.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return J(e.currentTarget)},variant:"contained",color:"primary"},"Range"),r.a.createElement(B.a,{id:"simple-menu",anchorEl:K,keepMounted:!0,open:Boolean(K),onClose:X},r.a.createElement(P.a,{onClick:function(){return ee(12,"hours")}},"12 hours"),r.a.createElement(P.a,{onClick:function(){return ee(1,"day")}},"1 day"),r.a.createElement(P.a,{onClick:function(){return ee(3,"days")}},"3 days"),r.a.createElement(P.a,{onClick:function(){return ee(1,"week")}},"1 week")))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{id:"string-filter",label:"Keyword",value:S,onChange:function(e){return E({type:"UPDATE_STRING_SEARCH",value:e.target.value})},placeholder:"Enter keyword",InputLabelProps:{shrink:!0},disabled:z}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Sa,{label:"Tag",options:s,value:C,changeHandler:function(e){return E({type:"UPDATE_TAG_SEARCH",value:e})},placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isDisabled:z,isClearable:!0})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),!U&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:_,onChange:function(e){return E({type:"UPDATE_ONLY_EWI_RECIPIENTS",value:e.target.checked})},name:"onlyEWIRecipients"}),label:"Only EWI recipients"})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:j,onChange:function(e){return E({type:"UPDATE_INCLUDE_INACTIVE_NUMBERS",value:e.target.checked})},name:"includeInactiveNumbers"}),label:"Include inactive numbers"}))))),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:a},"Cancel"),r.a.createElement(b.a,{onClick:function(){return E({type:"RESET"})}},"RESET"),r.a.createElement(b.a,{onClick:function(){a(),l()},color:"secondary",disabled:U,component:m.b,to:{pathname:"".concat(c,"/search_results"),state:{sites:v,organizations:h,only_ewi_recipients:_,include_inactive_numbers:j,ts_start:x?$()(x).format("YYYY-MM-DD HH:mm:ss"):x,ts_end:k?$()(k).format("YYYY-MM-DD HH:mm:ss"):k,string_search:S,tag_search:C,mobile_number_search:D,name_search:A}}},"Search")))})),Xm=a(1229),$m=a(1230),eu=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{regularContainer:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0,padding:"16px 0"}),chatInputContainer:Object(p.a)({},t.pageContentMargin),divider:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40}})})),tu=function(e){return function(t){t.preventDefault(),e.goBack()}};function au(e){var t=e.width,a=e.history;return Object(Ge.b)(t,"sm")?r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:tu(a),startIcon:r.a.createElement(Pc.a,null)},"Back to conversation list"):r.a.createElement(R.a,{variant:"contained",color:"primary",size:"small",onClick:tu(a)},r.a.createElement(Pc.a,null))}var nu=function(e){var t=e.location,a=e.width,l=e.url,i=e.is_desktop,c=e.searchResults,s=e.setSearchResults,m=e.ListLoader,u=eu(),d=t.state,p=d.sites,g=d.organizations,f=d.only_ewi_recipients,E=d.include_inactive_numbers,v=d.ts_start,h=d.ts_end,j=d.string_search,x=d.tag_search,k=d.mobile_number_search,S=d.name_search,C=Object(n.useState)(!1),D=Object(o.a)(C,2),A=D[0],w=D[1],I=null===p&&null===g,M=""!==j||""!==x.value,T=Object(n.useState)(0),N=Object(o.a)(T,2),Y=N[0],R=N[1],H=Object(n.useState)(!1),B=Object(o.a)(H,2),P=B[0],L=B[1];return Object(n.useEffect)((function(){var e,t=0===c.length;if(!I&&t||P){w(!0);var a={site_ids:p.map((function(e){return e.value})),org_ids:g.map((function(e){return e.value})),only_ewi_recipients:f,include_inactive_numbers:E,ts_start:v,ts_end:h,string_search:j,tag_search:x,mobile_number_search:k,name_search:S,updated_offset:Y};"undefined"!==typeof ve&&(ve.emit("get_search_results",a),e=function(e){w(!1),s(e),L(!1)},ve.on("receive_search_results",(function(t){console.log("Chatterbox Search Results",t),e(t)})))}return function(){"undefined"!==typeof ve&&ve.removeListener("receive_search_results")}}),[ve,p,g,v,h,Y,P]),r.a.createElement("div",{className:u.pageContentMargin},r.a.createElement(ut,{title:"Communications | Chatterbox"}),r.a.createElement(y.a,{container:!0},r.a.createElement("div",null,r.a.createElement(au,e)),r.a.createElement(Xe.a,{smDown:!0},r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:12}})),r.a.createElement(O.a,{component:y.a,item:!0,xs:!0,variant:"h5"},"Search Results"),r.a.createElement(Xe.a,{smUp:!0},r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:8}}))),r.a.createElement(_.a,{display:"flex",flexWrap:"wrap"},0!==p.length&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Site(s):")," ",p.map((function(e){return e.data.site_code.toUpperCase()})).join(", "))),0!==g.length&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Organizations(s):")," ",g.map((function(e){return e.label})).join(", "))),v&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Start Date/Time: "),v)),h&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"End Date/Time: "),h)),j&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"String: "),j)),x.label&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Tag: "),x.label)),k&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Mobile Number: "),k)),0!==S.length&&r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Has name search"))),r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Only EWI Recipients:")," ",le(f.toString()))),r.a.createElement(_.a,{mr:2},r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("strong",null,"Include Inactive Numbers:")," ",le(E.toString())))),r.a.createElement(Q.a,{style:{marginTop:12}}),M&&!A&&r.a.createElement(_.a,{display:"flex",flexDirection:"row-reverse"},c.length>=20&&r.a.createElement(b.a,{size:"small",style:{margin:10},onClick:function(){R(Y+20),L(!0)},variant:"contained",color:"primary",endIcon:r.a.createElement(Xm.a,null)},"Next"),Y>0&&r.a.createElement(b.a,{size:"small",style:{margin:10},onClick:function(){Y>0&&(R(Y-20),L(!0))},variant:"contained",color:"primary",startIcon:r.a.createElement($m.a,null)},"Previous")),I&&r.a.createElement(O.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No search input")),A?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(m,null)):c.length>0?r.a.createElement(ym,{width:a,url:l,messagesArr:c,searchFilters:{ts_start:v,ts_end:h},hidden:!1,is_desktop:i}):r.a.createElement(O.a,{variant:"h6",align:"center",style:{paddingTop:"5em"}},r.a.createElement("strong",null,"No results found")))};const ru=Object(j.a)(e=>({inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}));function lu(e){const t=e.onClose,a=e.open,n=e.chosenMessage,l=Object(c.b)(),i=l.enqueueSnackbar,o=l.closeSnackbar,s=n.ts,m=n.sms_msg,u=n.ts_sending,d=n.task_id,p=n.recipients,g=Object(k.a)(),f=()=>{t()},E=e=>r.a.createElement(b.a,{color:"primary",onClick:()=>{o(e)}},"Dismiss");return r.a.createElement(Oe.a,{onClose:f,"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(je.a,{id:"simple-dialog-title"},"Queued Message"),r.a.createElement(xe.a,null,r.a.createElement(y.a,{container:!0},r.a.createElement(O.a,{variant:"body2",component:y.a,item:!0,xs:6},"Created: ",r.a.createElement("strong",null,$()(s).format("D MMM YYYY, HH:mm"))),r.a.createElement(O.a,{variant:"body2",component:y.a,item:!0,xs:6,align:"right"},"Sending time: ",r.a.createElement("strong",null,$()(u).format("D MMM YYYY, HH:mm")))),r.a.createElement(Q.a,{style:{margin:"12px 0"}}),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0},"Recipient(s): ",r.a.createElement("strong",null,p)),r.a.createElement(O.a,{variant:"body1"},m)),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:()=>{const e={is_ewi:!1,task_id:d,user_id:g.user_id},a=i("Canceling queued message...",{variant:"warning",persist:!0});t(),oa(e,e=>{o(a);let t,n=e.message;e.status?(t="success",n="Queued message succesfully canceled!"):t="error",i(n,{variant:t,autoHideDuration:7e3,action:E})},()=>{o(a),i("Error canceling queued message...",{variant:"error",autoHideDuration:7e3,action:E})})},color:"secondary"},"Cancel Sending"),r.a.createElement(b.a,{onClick:f,color:"primary"},"Close")))}var iu=function(e){const t=e.messagesArr,a=e.hidden,l=ru(),i=Object(p.a)(Object(p.a)({},e),{},{classes:l}),c=Object(n.useState)(!1),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),b=Object(o.a)(d,2),g=b[0],f=b[1],E=e=>{f(e),u(!0)};return r.a.createElement(n.Fragment,null,0===t.length?r.a.createElement(h.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?l.hidden:""},r.a.createElement("div",null,"No queued messages")):r.a.createElement(Or.a,{dense:!0,className:a?l.hidden:""},t.map((e,t)=>function(e,t,a,n){const l=e.ts_sending,i=e.sms_msg,c=e.recipient_list_preview,o=e.recipient_list,s=t.classes,m=t.width,u=function(e,t){let a=e.map(e=>{const t=e.users[0].user,a=t.first_name,n=t.last_name;return"".concat(a," ").concat(n)}).join(", ");return 5===e.length&&(a="".concat(a," and ").concat(t.length-5," others")),a}(c,o);return r.a.createElement(xr.a,{alignItems:"center",button:!0,key:"i".concat(n),onClick:t=>{t.preventDefault();const n=Object(p.a)(Object(p.a)({},e),{},{recipients:u});a(n)}},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,{alt:"User",src:nm.a,className:s.bigAvatar})),r.a.createElement(kr.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0,className:s.noFlexGrow},r.a.createElement(O.a,{variant:"body1",className:s.overflowEllipsis,component:"div",style:{display:"flex",alignItems:"center"}},u)),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,container:!0,justify:Object(Ge.c)("sm",m)?"flex-end":"flex-start",alignItems:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Sending time: ",$()(l).format("D MMM YYYY, HH:mm")))),primaryTypographyProps:{className:s.overflowEllipsis},secondary:i,secondaryTypographyProps:{component:"div"}}))}(e,i,E,t))),null!==g&&r.a.createElement(lu,{open:m,setOpenOptions:u,chosenMessage:g,onClose:e=>{u(!1)}}))},cu=Object(j.a)((function(e){var t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{tabBar:Object(p.a)(Object(p.a)({},t.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16}})})),ou=function(){return r.a.createElement(ft.a,{speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",viewBox:"0 0 600 400",style:{width:"100%"}},r.a.createElement("circle",{cx:"47",cy:"48",r:"26"}),r.a.createElement("rect",{x:"90",y:"36",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"47",cy:"108",r:"26"}),r.a.createElement("rect",{x:"90",y:"96",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"168",r:"26"}),r.a.createElement("rect",{x:"90",y:"156",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"228",r:"26"}),r.a.createElement("rect",{x:"90",y:"216",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"288",r:"26"}),r.a.createElement("rect",{x:"90",y:"276",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"348",r:"26"}),r.a.createElement("rect",{x:"90",y:"336",rx:"0",ry:"0",width:"489",height:"29"}))};function su(e){var t=e.modalState,a=e.modalStateHandler;return r.a.createElement(Oe.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:t},r.a.createElement(je.a,{id:"simple-dialog-title"},"Chatterbox Information"),r.a.createElement(xe.a,null,r.a.createElement(O.a,{variant:"h6",gutterBottom:!0,align:"center"},"Inbox"),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Inbox tab contains the list of our contacts who recently sent a message to our server. The first contact in the list is the most recent message sender, and so on.",r.a.createElement("br",null),r.a.createElement("br",null),"\u2003\u2003Unlike a regular message list on a messaging app, outbound messages to our contacts do not affect the order of the list nor the appearance of a contact on the list (because our server sends a lot of messages, especially when routine, that incoming messages might get unnoticed)."),r.a.createElement(Q.a,{style:{margin:"8px 0"}}),r.a.createElement(O.a,{variant:"h6",gutterBottom:!0,align:"center"},"Unsent"),r.a.createElement(O.a,{variant:"body1",gutterBottom:!0,align:"justify"},"\u2003\u2003Unsent tab displays conversation threads which contains unsent messages within one day span. Unsent messages refer to messages in the process of sending or messages with failed sending attempt.")))}var mu=Object(Ge.a)()((function(e){var t=e.location,a=e.match.url,l=e.width,i=cu(),c=Object(n.useContext)(Te),s=c.latestMessageCollection,m=c.recipientsList,d=Object(n.useState)(0),p=Object(o.a)(d,2),g=p[0],f=p[1],E=Object(n.useState)(!1),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useState)(!1),O=Object(o.a)(y,2),j=O[0],x=O[1],k=Object(n.useState)([{label:"Inbox",href:"inbox"},{label:"Unsent",href:"unsent"},{label:"Queued",href:"queued"}]),S=Object(o.a)(k,2),C=S[0],D=S[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),I=w[0],M=w[1],T=Object(n.useState)([]),N=Object(o.a)(T,2),Y=N[0],B=N[1],P=Object(n.useState)(!1),L=Object(o.a)(P,2),F=L[0],U=L[1],q=function(e,t){return function(){"send"===e?_(t):"search"===e?x(t):"info"===e&&U(t)}};Object(n.useEffect)((function(){if(null!==s.inbox){var e=s.unsent.length,t=s.queue.length,a="Unsent";e>0&&(a=r.a.createElement(H.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:e,overlap:"rectangle"},"Unsent"));var n="Queued";t>0&&(n=r.a.createElement(H.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:t,overlap:"rectangle"},"Queued")),D((function(e){return[].concat(Object(ye.a)(e.slice(0,1)),[{label:a,href:"unsent"},{label:n,href:"queued"}])}))}}),[s]),Object(n.useEffect)((function(){!function(e){var t="".concat(te.b,"/api/chatterbox/get_all_tags");ne.a.get(t).then((function(t){var a=t.data;console.log("All Tags",a),"undefined"!==typeof e&&e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.map((function(e){return{value:e.tag_id,label:"".concat(e.tag," (").concat(e.source.match(/sms(.*)_/)[1],")"),source:e.source}}));B(t)}))}),[]);var W=Object(Ge.c)("md",l),z=r.a.createElement("span",null,r.a.createElement(R.a,{color:"primary","aria-label":"Chatterbox info",onClick:q("info",!0)},r.a.createElement(Ll.a,{fontSize:"large"})),r.a.createElement(b.a,{"aria-label":"Compose message",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:q("send",!0),startIcon:r.a.createElement(Qs.a,null)},"Compose"),r.a.createElement(b.a,{"aria-label":"Search messages",variant:"contained",color:"primary",size:"small",onClick:q("search",!0),startIcon:r.a.createElement(Zs.a,null)},"Search"));return r.a.createElement(Km,null,r.a.createElement(u.d,{location:t},r.a.createElement(u.b,{exact:!0,path:a,render:function(e){return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:i.pageContentMargin},r.a.createElement(ut,{title:"Communications | Chatterbox",customButtons:!!W&&z})),r.a.createElement("div",{className:i.tabBar},r.a.createElement(gt,{chosenTab:g,onSelect:function(e){return f(e)},tabsArray:C})),r.a.createElement("div",{className:"".concat(i.tabBar," ").concat(i.tabBarContent)},null===s.inbox?r.a.createElement(ou,null):r.a.createElement(ym,{width:l,url:a,messagesArr:s.inbox,hidden:0!==g,is_desktop:W}),1===g&&(null===s.unsent?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(ou,null)):r.a.createElement(ym,{width:l,url:a,messagesArr:s.unsent,hidden:1!==g,is_desktop:W})),2===g&&(null===s.queue?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(ou,null)):r.a.createElement(iu,{width:l,url:a,messagesArr:s.queue,hidden:2!==g,is_desktop:W}))),!W&&r.a.createElement(Gm,{clickHandler:q("send",!0)}),r.a.createElement(Lm,{modalStateHandler:q("send",!1),modalState:h,recipientsList:m}),r.a.createElement(Jm,{modalStateHandler:q("search",!1),modalState:j,setSearchResultsToEmpty:function(){return M([])},url:a,recipientsList:m,tagList:Y}),r.a.createElement(su,{modalStateHandler:q("info",!1),modalState:F}))}}),r.a.createElement(u.b,{path:"".concat(a,"/search_results"),render:function(e){return r.a.createElement(nu,Object.assign({},e,{messageCollection:s,url:a,width:l,is_desktop:W,searchResults:I,setSearchResults:M,ListLoader:ou}))}}),r.a.createElement(u.b,{path:"".concat(a,"/:mobile_id"),render:function(e){return r.a.createElement(Bm,Object.assign({},e,{messageCollection:s}))}})))})),uu=a(1189),du=a(1112),pu=a(446),bu=a(1232),gu=a(1235),fu=a(1236),Eu=a(1237),vu=a(1238),hu=a(1239),_u=a(1240),yu=a(1241),Ou=a(1242),ju=a(1247),xu=r.a.memo((function(e){var t=e.classes,a=e.row,n=e.index,l=e.onContactClickFn,i=a.user_id,c=a.first_name,o=a.last_name,s=a.organizations,m=ie(s),u=ce(s);return r.a.createElement(xr.a,{button:!0,onClick:l(a,n),key:i},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(cm.a,null))),r.a.createElement(kr.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8}},"".concat(o,", ").concat(c))),m.map((function(e,a){var n=0===a,l=n?"secondary":"primary";return n&&u?r.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(vt.a,{arrow:!0,disableFocusListener:!0,title:"Contact Priority",placement:"top"},r.a.createElement(ba.a,{color:l,size:"small",label:e,icon:r.a.createElement(bu.a,{style:{color:"gold"}})}))):r.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(ba.a,{color:l,size:"small",label:e}))})))}))}));var ku=function(e){var t=e.contacts,a=e.onContactClickFn,l=e.classes,i=e.searchStr,c=Math.ceil(t.length/10),s=Object(n.useState)(1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)([]),b=Object(o.a)(p,2),g=b[0],f=b[1];return Object(n.useEffect)((function(){var e=t.slice(10*(u-1),10*(u-1)+10);f(e)}),[u,t]),Object(n.useEffect)((function(){return d(1)}),[i]),r.a.createElement(n.Fragment,null,r.a.createElement(Or.a,{dense:!0,style:{paddingTop:0}},g.map((function(e,t){return r.a.createElement(xu,{row:e,index:t+10*(u-1),onContactClickFn:a,classes:l,key:"list-".concat(t)})}))),r.a.createElement(ju.a,{count:c,variant:"outlined",defaultPage:1,boundaryCount:2,page:u,shape:"rounded",onChange:function(e,t){d(t)},style:{justifyContent:"center",display:"flex"}}))};var Su=r.a.memo((function(e){const t=e.blocked_numbers,a=e.onBlockContactClickFn;return 0===t.length?r.a.createElement("div",null,"No blocked contact"):r.a.createElement(Or.a,{dense:!0,style:{paddingTop:0}},t.map(e=>{const t=e.mobile_number,n=t.mobile_id,l=t.sim_num;return r.a.createElement(xr.a,{button:!0,onClick:a(e),key:n},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(rm.a,null))),r.a.createElement(kr.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8}},"+".concat(l))))}))}))}));function Cu(e){const t=e.row,a=t.network,l=t.prefixes;return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"h5",style:{marginBottom:12}},a),r.a.createElement(h.a,{style:{padding:"24px 16px"}},r.a.createElement(y.a,{container:!0,spacing:3},l.map(e=>r.a.createElement(O.a,{variant:"body1",component:y.a,item:!0,xs:2,align:"center",key:e},e)))))}var Du=r.a.memo((function(e){const t=function(e){const t=[],a=[];return e.forEach(e=>{const n=e.prefix,r=e.network_id,l="0".concat(n);1===r?a.push(l):t.push(l)}),[{network:"Globe",prefixes:a},{network:"Smart",prefixes:t}]}(e.sim_prefixes);return r.a.createElement(n.Fragment,null,t.map(e=>r.a.createElement(n.Fragment,{key:e.network},r.a.createElement(Cu,{row:e}),r.a.createElement("div",{style:{marginBottom:24}}))))})),Au=a(1233),wu=a(1234),Iu=Object(j.a)((function(e){return{root:{width:"100%"},icons:Object(s.a)({fontSize:"1.15rem"},e.breakpoints.down("xs"),{fontSize:"1.7rem"}),details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},title:{fontSize:14},pos:{marginBottom:12}}}));function Mu(e,t){var a="";return 0===e?a="community":1===e?a="barangay":2===e?a="municipal":3===e?a="provincial":4===e?a="regional":5===e&&(a="national"),{header:"".concat(le(a)," ").concat(t.toUpperCase()),offices:"".concat(a,"_").concat(t)}}function Tu(e){var t=e.checkbox_data,a=e.updatePrimary,l=e.contact_per_org,i=e.setContactsPerOrg,c=e.contacts_key,s=e.classes,m=Object(n.useState)(0),u=Object(o.a)(m,2),d=u[0],p=u[1],g=[];Object(n.useEffect)((function(){var e=!1;if(t.find((function(e){return 1===e.primary_contact}))&&!1===e){e=!0;var a=t.find((function(e){return 1===e.primary_contact})).user_org_id.toString();p(a)}}),[]);return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,key:"contact_radio_button"},r.a.createElement(Dt.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(Xt.a,{component:"legend",style:{textAlign:"center",marginBottom:8}},"Choose primary contact."),r.a.createElement(At.a,{"aria-label":"choose_primary_contact",name:"choose_primary_contact",value:d,onChange:function(e){p(e.target.value)},row:!0,style:{justifyContent:"space-around"}},t.map((function(e,t){var a=e.contact_person,n=e.user_org_id,l=a.first_name,i=a.last_name;return r.a.createElement(wt.a,{value:n.toString(),control:r.a.createElement(It.a,{color:"primary"}),label:"".concat(l," ").concat(i),key:"contact_radio_button_".concat(t+1)})}))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end"},r.a.createElement(b.a,{variant:"contained",color:"secondary",size:"small",className:s.button,style:{marginRight:8},startIcon:r.a.createElement(Au.a,null),onClick:function(){a();var e=parseInt(d,10);t.forEach((function(t,a){var n=0;e===t.user_org_id&&(n=1),t.primary_contact=n,g.push(t)})),l[c]=g,i(l),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a="".concat(te.b,"/api/contacts/save_primary_contact");ne.a.post(a,e).then((function(e){var a=e.data;console.log("Save updated primary contact",a),null!==t&&t(a)})).catch((function(e){console.error(e)}))}(g,(function(e){var t;t="update_all_contacts",ve.emit(t)}))}},"Save"),r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",className:s.button,startIcon:r.a.createElement(wu.a,null),onClick:function(){return a()}},"Back")))}function Nu(e){var t=e.siteData,a=e.classes,l=e.isUpdatePrimary,i=e.setIsUpdatePrimary,c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)({}),p=Object(o.a)(d,2),g=p[0],f=p[1],E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],_=v[1],j=Object(n.useState)([]),x=Object(o.a)(j,2),k=x[0],S=x[1];Object(n.useEffect)((function(){i(!1);var e={},a=[];t&&t.forEach((function(t,n){var r=t.org_name,l=Mu(t.scope,r).offices;void 0===e[l]?(e[l]=[t],a.push(l)):e[l].push(t)})),f(e),u(a)}),[t]);var C=function(e){i(!l),void 0!==e&&(_(g[e]),S(e))};return l?r.a.createElement(Tu,{checkbox_data:h,updatePrimary:C,contact_per_org:g,setContactsPerOrg:f,contacts_key:k,classes:a}):m.map((function(e,t){var n=g[e][0],l=Mu(n.scope,n.org_name).header,i=g[e].find((function(e){return 1===e.primary_contact})),c="No primary contact set";if("undefined"!==typeof i){var o=i.contact_person,s=o.first_name,m=o.last_name;c="".concat(s," ").concat(m)}return r.a.createElement(y.a,{item:!0,xs:12,sm:6,lg:4,align:"center",key:"contact_per_org_".concat(t+1)},r.a.createElement(G.a,{className:a.root,key:"contact_per_org_card_".concat(t+1)},r.a.createElement(V.a,{key:"contact_per_org_content_".concat(t+1)},r.a.createElement(O.a,{variant:"subtitle2"},l),r.a.createElement(O.a,{variant:"body1"},c)),r.a.createElement(js.a,{disableSpacing:!0},r.a.createElement(y.a,{container:!0,justify:"flex-end"},r.a.createElement(b.a,{size:"small",color:"primary",onClick:function(){return C(e)}},"Update")))))}))}var Yu=r.a.memo((function(e){var t=e.siteLabel,a=e.siteID,l=e.siteData,i=Object(n.useState)(!1),c=Object(o.a)(i,2),s=c[0],m=c[1],u=Iu();return r.a.createElement(n.Fragment,{key:"site_ID".concat(a+1)},r.a.createElement($e.a,null,r.a.createElement(et.a,{expandIcon:r.a.createElement(Jr.a,null)},r.a.createElement(O.a,{variant:"body1"},t)),r.a.createElement(Q.a,null),r.a.createElement(tt.a,{className:u.details},r.a.createElement(y.a,{container:!0,spacing:3,style:{marginTop:6}},r.a.createElement(Nu,{siteData:l,classes:u,isUpdatePrimary:s,setIsUpdatePrimary:m}))),r.a.createElement(Q.a,null)))}),(function(e,t){return!(!e.siteData||!t.siteData)&&e.siteData.length===t.siteData.length}));var Ru=Object(Ce.a)()((function(e){const t=e.fullScreen,a=e.modalState,l=e.modalStateHandler,i=e.isMobile,c=e.contactsArray,s=e.classes,m=e.setChosenContact,u=e.setSlideOpen,d=Object(n.useContext)(Ca).organizations,p=Object(n.useState)([]),g=Object(o.a)(p,2),f=g[0],E=g[1];Object(n.useEffect)(()=>{const e=d.map(e=>{let t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}});E(e)},[d]);const v=Object(n.useState)(null),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)(null),j=Object(o.a)(O,2),x=j[0],k=j[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),D=C[0],A=C[1],w=r.a.useCallback(e=>()=>{m(e),l(),u(!0)},[]);return Object(n.useEffect)(()=>{let e=[];if(null!==x){const t=x.map(e=>e.value);e=c.filter(e=>{const a=e.organizations;let n=null;return 0!==a.length&&(n=a[0].organization.org_id),t.includes(n)})}if(null!==_){const t=_.map(e=>e.data.site_code);let a=c;0!==e.length&&(a=e),e=[],a.forEach(a=>{a.organizations.every(n=>{const r=n.site.site_code;return!t.includes(r)||(e.push(a),!1)})})}e.length>0?A(e):A(null)},[x,_]),r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?ma:ua},r.a.createElement(je.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search contacts"),r.a.createElement(R.a,{color:"inherit",onClick:l,"aria-label":"Close",style:{padding:0}},r.a.createElement(Zt.a,null)))),r.a.createElement(xe.a,{style:{overflowY:"auto"}},r.a.createElement(ke.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(wa,{value:_,changeHandler:e=>y(e),isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Sa,{label:"Organizations",options:f,value:x,changeHandler:(I="organizations",e=>{"sites"===I?y(e):"organizations"===I&&k(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),null!==D?r.a.createElement(ku,Object.assign({},e,{contacts:D,classes:s,onContactClickFn:w})):null,!i&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:l},"Close")));var I})),Hu=Object(j.a)((function(e){var t,a=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},a),{},{tabBar:Object(p.a)(Object(p.a)({},a.pageContentMargin),{},{margin:0}),tabBarContent:{marginTop:16},sticky:(t={position:"sticky",top:146},Object(s.a)(t,e.breakpoints.down("sm"),{top:48}),Object(s.a)(t,"backgroundColor","white"),Object(s.a)(t,"zIndex",1),t),noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,width:400},overflow:Object(s.a)({overflowY:"auto",height:"calc(100vh - 250px)"},e.breakpoints.down("md"),{height:"80vh"}),insetDivider:{padding:"8px 70px !important"},nested:{paddingLeft:e.spacing(4)},hidden:{display:"none !important"}})})),Bu=function(e){return r.a.createElement(ft.a,Object.assign({speed:2,width:700,height:350,viewBox:"0 0 700 350"},e),r.a.createElement("rect",{x:"4",y:"8",rx:"3",ry:"3",width:"8",height:"317"}),r.a.createElement("rect",{x:"7",y:"317",rx:"3",ry:"3",width:"669",height:"8"}),r.a.createElement("rect",{x:"669",y:"9",rx:"3",ry:"3",width:"7",height:"313"}),r.a.createElement("rect",{x:"5",y:"8",rx:"3",ry:"3",width:"669",height:"7"}),r.a.createElement("rect",{x:"114",y:"52",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"77",cy:"60",r:"15"}),r.a.createElement("rect",{x:"116",y:"105",rx:"6",ry:"6",width:"420",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"113",r:"15"}),r.a.createElement("rect",{x:"115",y:"158",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"78",cy:"166",r:"15"}),r.a.createElement("rect",{x:"117",y:"211",rx:"6",ry:"6",width:"444",height:"15"}),r.a.createElement("circle",{cx:"79",cy:"219",r:"15"}),r.a.createElement("rect",{x:"117",y:"263",rx:"6",ry:"6",width:"483",height:"15"}),r.a.createElement("circle",{cx:"80",cy:"271",r:"15"}))};function Pu(e){var t=e.contact,a=e.chosenContact,l=e.setSlideOpen,i=e.classes,c=e.setContactFormForEdit,o=e.siteOrgs,s=e.isContactPriority,m=o.sites,u=o.org,d=a.status,p=a.emails,g=a.ewi_recipient,f=a.landline_numbers,E=a.mobile_numbers,v=a.ewi_restriction,h=a.ground_reminder_recipient;return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:2},r.a.createElement(Js.a,null,r.a.createElement(cm.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"h5",align:"center"},t)),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(Xe.a,{smDown:!0,lgUp:!0},r.a.createElement(R.a,{onClick:function(){return l(!1)}},r.a.createElement(Zt.a,null)))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center",paragraph:!0},"Affiliation")),null!==u?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},r.a.createElement(vt.a,{arrow:!0,disableFocusListener:!0,disableHoverListener:!s,title:"Contact Priority",placement:"top"},r.a.createElement(ba.a,{color:"secondary",label:r.a.createElement(O.a,{variant:"body1"},u.toUpperCase()),icon:s?r.a.createElement(bu.a,{style:{color:"gold"}}):null}))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},m.map((function(e){var t=e.site_code,a=re(e,!1);return r.a.createElement(vt.a,{key:t,title:a,"aria-label":a},r.a.createElement(ba.a,{color:"primary",label:r.a.createElement(O.a,{variant:"body2"},t.toUpperCase())}))})))):r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center",paragraph:!0},"No affiliations saved")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"Status"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},0===d?"Inactive":"Active")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Recipient"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},0===g?"No":"Yes")),v&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Restriction"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},"Do not send on ",-1===v.alert_level?"routine and extended monitoring":"Alert ".concat(v.alert_level)," ",v.alert_level>1&&"and below"))),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"Ground Data Reminder Recipient"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},0===h?"No":"Yes")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Mobile")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Or.a,{dense:!0},0===E.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No mobile numbers saved")):E.map((function(e){return r.a.createElement(xr.a,{key:e.mobile_number.mobile_id},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(kt.a,null))),r.a.createElement(kr.a,{primary:"+".concat(e.mobile_number.sim_num)}),r.a.createElement(uu.a,null,r.a.createElement(kr.a,{secondary:"Status: ".concat(0===e.status?"Inactive":"Active")})))})))),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Landline")),r.a.createElement(y.a,{item:!0,xs:12},0===f.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No landline numbers saved")):r.a.createElement(Or.a,{dense:!0},f.map((function(e){return r.a.createElement(xr.a,{key:e.landline_id},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(gu.a,null))),r.a.createElement(kr.a,{primary:"".concat(0===e.area_code?"":"(0".concat(e.area_code,")")," ").concat(0===e.pte_code?"":e.pte_code).concat(e.landline_num)}))})))),r.a.createElement(y.a,{item:!0,xs:12,className:i.insetDivider},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Email")),r.a.createElement(y.a,{item:!0,xs:12},0===p.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No email addresses saved")):r.a.createElement(Or.a,{dense:!0},p.map((function(e){return r.a.createElement(xr.a,{key:e.email_id},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(fu.a,null))),r.a.createElement(kr.a,{primary:e.email}))})))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(yi.a,null),onClick:function(){return c(!0)}},"Edit")))}function Lu(e){var t=e.chosenContact,a=e.setSlideOpen;if(0===t.length)return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"caption",display:"block"},"No initial blocked contact")));var n=t.mobile_number,l=t.reporter,i=t.ts,c=t.reason,o=n.sim_num,s=n.users,m=l.first_name,u=l.last_name,d="No contact details";s.length>0&&(d=s.map((function(e){return"".concat(e.user.last_name,", ").concat(e.user.first_name)})).join(" | "));var p=$()(i).format("MMMM D, YYYY, HH:mm:ss");return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(Js.a,null,r.a.createElement(Eu.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"h5",align:"center"},"+".concat(o))),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(Xe.a,{smDown:!0,lgUp:!0},r.a.createElement(R.a,{onClick:function(){return a(!1)}},r.a.createElement(Zt.a,null)))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Details")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},d)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Reason")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},r.a.createElement("i",null,c))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},p)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Reporter")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"".concat(u,", ").concat(m))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(b.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(vu.a,null),disabled:!0},"Unblock (soon)")))}var Fu=function(e){var t=e.search_str,a=e.setSearchStr,n=e.inputProps;return r.a.createElement(f.a,{margin:"dense",hiddenLabel:!0,fullWidth:!0,variant:"outlined",placeholder:"Type contact name",InputProps:n,value:t,onChange:function(e){return a(e.target.value)}})};var Uu=function(e){var t=Hu(),a=Object(n.useContext)(Te).contacts,l=Object(n.useState)([]),i=Object(o.a)(l,2),s=i[0],m=i[1],u=Object(n.useState)({}),d=Object(o.a)(u,2),p=d[0],b=d[1],g=Object(n.useState)(0),f=Object(o.a)(g,2),E=f[0],v=f[1],_=Object(n.useState)(!1),j=Object(o.a)(_,2),x=j[0],k=j[1],S=Object(n.useState)(!1),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(!1),I=Object(o.a)(w,2),M=I[0],Y=I[1],H=Object(n.useState)(""),B=Object(o.a)(H,2),P=B[0],U=B[1],q=Object(n.useState)([]),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)([]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)([]),X=Object(o.a)(J,2),$=X[0],ee=X[1],ae=Object(n.useState)([]),le=Object(o.a)(ae,2),oe=le[0],se=le[1],me=Object(n.useState)("active_numbers"),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],be=Object(n.useState)(null),ge=Object(o.a)(be,2),fe=ge[0],Ee=ge[1],ve=Object(n.useState)(!1),he=Object(o.a)(ve,2),_e=he[0],ye=he[1],je=r.a.useCallback((function(e,t){return function(){b(e),v(t),k(!0)}}),[]),xe=r.a.useCallback((function(e){return function(){K(e),k(!0)}}),[]),ke=function(e){k(e),A(e),Y(!1)},Se=function(e){Y(e),A(e)},Ce=function(e){pe(e)},De=Object(c.b)(),Ae=De.enqueueSnackbar,we=De.closeSnackbar,Ie=Object(n.useContext)(Ca).sites;Object(n.useEffect)((function(){var e={};a.length>0&&(e=a[E]),b(e),null!==fe&&(we(fe),Ee(null),Ae("Loading contacts list successful!",{variant:"success",autoHideDuration:5e3}))}),[fe,a]),Object(n.useEffect)((function(){var e=P.length;if(e>2){var t=a.filter((function(e){var t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(P),"gi").test(n)}));m(t)}else 0===e&&m(a)}),[a,P]),Object(n.useEffect)((function(){!function(e){var t="".concat(te.b,"/api/contacts/get_blocked_numbers");ne.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.blocked_numbers;t&&(G(a),0!==a.length&&K(a[0]))})),function(e){var t="".concat(te.b,"/api/contacts/sim_prefix");ne.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.prefixes;t&&ee(a)}))}),[]),Object(n.useEffect)((function(){!function(e){var t="".concat(te.b,"/api/contacts/get_contact_prioritization");ne.a.get(t).then((function(t){var a=t.data;console.log("All Sites Stakeholders",a),e(a)})).catch((function(e){console.error(e)}))}((function(e){se(e)}))}),[a]);var Me="",Ne=null,Ye=!1;if(p.hasOwnProperty("user_id")){var Re=p.first_name,He=p.last_name,Be=p.organizations;Me="".concat(Re," ").concat(He),Ne=ie(Be,!0),Ye=ce(Be)}var Pe,Le=function(){return D?r.a.createElement(fm,{setContactForm:ke,chosenContact:p,setSnackbarKey:Ee,isEditMode:M,setContactFormForEdit:Se,isFromChatterbox:!1}):""!==Me?r.a.createElement(Pu,{contact:Me,chosenContact:p,setSlideOpen:k,classes:t,setContactFormForEdit:Se,siteOrgs:Ne,isContactPriority:Ye}):void 0},Fe=r.a.createElement(Fu,{search_str:P,setSearchStr:U,inputProps:{endAdornment:r.a.createElement(du.a,{position:"end"},r.a.createElement(R.a,{"aria-controls":"sortContacts","aria-haspopup":"true",onClick:function(e){ye(!_e)},color:"primary"},r.a.createElement(hu.a,null)))}});return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ut,{title:"Communications | Contacts"}),r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(Xe.a,{mdUp:!0},r.a.createElement(y.a,{item:!0,xs:12,className:t.sticky,style:{paddingBottom:0}},Fe)),r.a.createElement(Xe.a,{smDown:!0},r.a.createElement(y.a,{item:!0,md:4,lg:3},r.a.createElement("div",{className:t.sticky},Fe,r.a.createElement(Or.a,{component:"nav","aria-label":"main"},r.a.createElement(xr.a,{button:!0,onClick:function(){return Ce("active_numbers")},selected:"active_numbers"===de},r.a.createElement(Sr.a,null,r.a.createElement(_u.a,null)),r.a.createElement(kr.a,{primary:"Contacts List"})),r.a.createElement(pu.a,{in:"active_numbers"===de,timeout:"auto",unmountOnExit:!0},r.a.createElement(Or.a,{component:"div",disablePadding:!0},r.a.createElement(xr.a,{button:!0,onClick:function(){return ke(!0)},className:t.nested},r.a.createElement(Sr.a,null,r.a.createElement(vu.a,null)),r.a.createElement(kr.a,{primary:"Add Contact"})))),r.a.createElement(xr.a,{button:!0,onClick:function(){return Ce("blocked_numbers")},selected:"blocked_numbers"===de},r.a.createElement(Sr.a,null,r.a.createElement(rm.a,null)),r.a.createElement(kr.a,{primary:"Blocked Contacts"})),r.a.createElement(xr.a,{button:!0,onClick:function(){return Ce("contact_prioritization")},selected:"contact_prioritization"===de},r.a.createElement(Sr.a,null,r.a.createElement(yu.a,null)),r.a.createElement(kr.a,{primary:"Contact Prioritization"})),r.a.createElement(xr.a,{button:!0,onClick:function(){return Ce("sim_prefixes")},selected:"sim_prefixes"===de},r.a.createElement(Sr.a,null,r.a.createElement(Ou.a,null)),r.a.createElement(kr.a,{primary:"SIM Prefixes"})))))),r.a.createElement(y.a,{item:!0,xs:12,md:8,lg:9},0===a.length?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Bu,null)):r.a.createElement(n.Fragment,null,r.a.createElement(Xe.a,{xsUp:"active_numbers"!==de,implementation:"css"},r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(y.a,{item:!0,xs:12,lg:7},r.a.createElement(ku,{classes:t,contacts:s,onContactClickFn:je,searchStr:P})),r.a.createElement(Xe.a,{mdDown:!0},r.a.createElement(y.a,{item:!0,lg:5},""!==Me&&r.a.createElement(h.a,{elevation:1,style:{padding:16,zIndex:2},className:"".concat(t.sticky," ").concat(t.overflow),variant:"outlined"},Le())),r.a.createElement(F.a,{open:D,style:{zIndex:1}})),r.a.createElement(Xe.a,{smDown:!0,lgUp:!0},r.a.createElement(L.a,{direction:"left",in:x,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(h.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},Le())),r.a.createElement(F.a,{open:x,style:{zIndex:1}})),r.a.createElement(Xe.a,{mdUp:!0},r.a.createElement(Oe.a,{fullScreen:!0,open:x,TransitionComponent:ma},r.a.createElement(T.a,{style:{position:"relative"}},r.a.createElement(N.a,null,r.a.createElement(R.a,{edge:"start",color:"inherit",onClick:function(){return ke(!1)},"aria-label":"close"},r.a.createElement(Zt.a,null)))),r.a.createElement(h.a,{elevation:0,style:{padding:16}},Le()))))),r.a.createElement(Xe.a,{xsUp:"blocked_numbers"!==de,implementation:"css"},r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(y.a,{item:!0,xs:12,lg:7},r.a.createElement(Su,{blocked_numbers:z,onBlockContactClickFn:xe})),r.a.createElement(Xe.a,{mdDown:!0},r.a.createElement(y.a,{item:!0,lg:5},r.a.createElement(h.a,{elevation:1,style:{padding:16,zIndex:2},className:t.sticky,variant:"outlined"},r.a.createElement(Lu,{chosenContact:Z,setSlideOpen:k})))),r.a.createElement(Xe.a,{smDown:!0,lgUp:!0},r.a.createElement(L.a,{direction:"left",in:x,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(h.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},r.a.createElement(Lu,{chosenContact:Z,setSlideOpen:k}))),r.a.createElement(F.a,{open:x,style:{zIndex:1}})),r.a.createElement(Xe.a,{mdUp:!0},r.a.createElement(Oe.a,{fullScreen:!0,open:x,TransitionComponent:ma},r.a.createElement(T.a,{style:{position:"relative"}},r.a.createElement(N.a,null,r.a.createElement(R.a,{edge:"start",color:"inherit",onClick:function(){return ke(!1)},"aria-label":"close"},r.a.createElement(Zt.a,null)))),r.a.createElement(h.a,{elevation:0,style:{padding:16}},r.a.createElement(Lu,{chosenContact:Z,setSlideOpen:k})))))),r.a.createElement(Xe.a,{xsUp:"contact_prioritization"!==de,implementation:"css"},r.a.createElement(O.a,{variant:"body1",style:{marginBottom:12}},r.a.createElement("strong",null,r.a.createElement("i",null,"Note: Contact priority can only be chosen from stakeholders that are currently active and EWI recipients."))),0!==oe.length&&Ie.map((function(e,t){var a=e.site_id,n=e.site_code,l=re(e,!0,"start"),i=oe[n];return r.a.createElement(Yu,{siteLabel:l,siteID:a,siteData:i,key:t})}))),r.a.createElement(Xe.a,{xsUp:"sim_prefixes"!==de,implementation:"css"},r.a.createElement(Du,{sim_prefixes:$}))))),r.a.createElement(Ru,{modalStateHandler:(Pe=!1,function(){ye(Pe)}),modalState:_e,setSlideOpen:k,contactsArray:s,classes:t,chosenContact:p,setChosenContact:b}))},qu=a(205),Wu=a(202),zu=a(1190),Gu=a(432),Vu=a.n(Gu);const Qu=Object(j.a)(e=>{const t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1},noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},insetDivider:{padding:"8px 70px !important"}})}),Zu={to:[],cc:[],bcc:[]};var Ku=function(e){const t=Qu(),a=(e.siteId,Object(n.useState)(Zu)),l=Object(o.a)(a,2),i=l[0],c=l[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],g=Object(n.useState)({}),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(n.useState)(""),O=Object(o.a)(_,2),j=O[0],x=O[1],k=Object(n.useState)(""),S=Object(o.a)(k,2),C=S[0],D=S[1],A=(e,t)=>{const a=i[e].push(t);c(Object(p.a)(Object(p.a)({},i),a))},w=(e,t,a)=>{const n=i[e].splice(i[e].indexOf(t),1);c(Object(p.a)(Object(p.a)({},i),n))};return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ut,{title:"Communications | MailBox"}),r.a.createElement(y.a,{container:!0,spacing:4,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:"sending_options"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Yt.a,{label:"To",value:i.to,onAdd:e=>A("to",e),onDelete:(e,t)=>w("to",e),fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{label:"Subject",value:j,onChange:e=>x(e.target.value),margin:"dense",fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Yt.a,{label:"Cc",value:i.cc,onAdd:e=>A("cc",e),onDelete:(e,t)=>w("cc",e),fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Yt.a,{label:"Bcc",value:i.bcc,onAdd:e=>A("bcc",e),onDelete:(e,t)=>w("bcc",e),fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,key:"message_body"},r.a.createElement(zl.a,{theme:"snow",value:C,onChange:D})),r.a.createElement(y.a,{item:!0,xs:12,key:"buttons"},r.a.createElement(b.a,{color:"secondary",onClick:()=>{const e={recipients:[...i.to,...i.cc,...i.bcc],subject:j,mail_body:C};console.log("payload",e),function(e,t){const a="".concat(te.b,"/api/mailbox/send_email");console.log(e),ne.a.post(a,e).then(e=>{const a=e.data;console.log("Send email response",a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{console.log("AXIOS Response",e);e.status?(h({text:"Email sent!",color:qu.a[600]}),c(Zu),x(""),D("")):h({text:"Email sent!",color:Wu.a[600]}),d(!0)})}},"SEND"),r.a.createElement(b.a,{color:"primary",onClick:()=>{c({to:[],cc:[],bcc:[]}),x(""),D("")}},"Discard/Reset"))),r.a.createElement(zu.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:u,autoHideDuration:6e3,onClose:e=>d(!1),ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},v.text),action:[r.a.createElement(R.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:e=>d(!1)},r.a.createElement(Vu.a,null))],style:{backgroundColor:v.color}}))},Ju=a(602),Xu=a(1243);const $u=Object(j.a)(e=>{const t=Object(_e.d)(e);return Object(p.a)(Object(p.a)({},t),{},{customPaper:{padding:8,marginTop:20,textAlign:"center"},bigAvatar:{margin:10,width:40,height:40}})}),ed=Object(d.a)(e=>({badge:{right:14,top:48,padding:"0 4px"}}))(H.a);var td=function(e){const t=$u(),a=e.siteCode,l=Object(n.useState)(null),i=Object(o.a)(l,2),c=i[0],s=i[1];return Object(n.useEffect)(()=>{var e,l;e=a,l=e=>{console.log(e);const a=function(e,t){const a=[],l=[];return Object.keys(t).forEach(e=>{let t=l;/lewc|lgu/i.test(e)&&(t=a),t.push(e)}),a.concat(l).map((a,l,i)=>{const c=t[a].map((t,a)=>{const n=t.last_name,l=t.first_name,i=t.salutation,c=t.status,o=t.primary_contact,s=i||"";let m="Active",u=r.a.createElement(qa.a,{style:{color:"green"}});Boolean(o)&&c?(m="Contact Priority",u=r.a.createElement(Xu.a,{style:{color:"gold"}})):c||(m="Inactive",u=r.a.createElement(Wa.a,{style:{color:"gray"}}));const d=r.a.createElement(vt.a,{arrow:!0,title:m,placement:"top",enterTouchDelay:200},u);return r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:4,lg:3,justify:"center",alignItems:"center",container:!0,spacing:1,key:"staff_".concat(a+1)},r.a.createElement(ed,{badgeContent:d},r.a.createElement(Js.a,{alt:"Stakeholder",src:nm.a,className:e.bigAvatar})),r.a.createElement(O.a,{variant:"subtitle1",color:c?"textPrimary":"textSecondary"},"".concat(s," ").concat(l," ").concat(n)))});return r.a.createElement(n.Fragment,{key:"fragment_".concat(l+1)},r.a.createElement(y.a,{item:!0,xs:12,key:"org_label_".concat(l+1)},r.a.createElement(O.a,{variant:"subtitle1"},r.a.createElement("strong",null,a.toUpperCase()))),r.a.createElement(y.a,{item:!0,xs:12,justify:"space-evenly",alignItems:"center",container:!0,spacing:1,key:"staff_list_".concat(l+1)},c),i.length>l+1&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,{style:{margin:"16px 0"}})))})}(t,e);s(a)},ne.a.get("".concat(te.b,"/api/users/get_community_orgs_by_site/").concat(e)).then(e=>{const t=e.data;l(t)})},[]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary",gutterBottom:!0},r.a.createElement("strong",null,"Site Stakeholders"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1,justify:"center"},null===c?"Loading...":0!==c.length?c:"No site stakeholders"))};const ad=e=>t=>{t.preventDefault(),e.push("/community/site_info"),e.replace("/community/site_info")};var nd=function(e){const t=e.width,a=e.history;return Object(Ge.b)(t,"sm")?r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:ad(a)},r.a.createElement(Pc.a,{style:{fontSize:16}})," Back"):r.a.createElement(R.a,{variant:"contained",color:"primary",size:"small",onClick:ad(a),style:{marginLeft:6}},r.a.createElement(Pc.a,null))},rd=["I","II","III","IV-A","IV-B","V","VI","VII","VIII","IX","X","XI","XII","XIII","CAR","NCR","BARMM"];function ld(e,t){var a=e[t-1],n=[],r=[];return Object.keys(a).forEach((function(e){"d"!==a[e]&&"w"!==a[e]||("d"===a[e]?n.push(e):r.push(e))})),de(n),de(r),[{key:"dry",list:n},{key:"wet",list:r}]}function id(e,t){var a=t.type,n=t.field,r=t.value,l=e[n],i=function(e,t){return""===t?"Required field":"site_code"===e&&t.length<3?"Site code must be three-lettered keyword":""}(n,r),c=r;switch(["purok","sitio","households"].includes(n)&&(c=r||null),"season"===n&&(c=parseInt(r,10)),a){case"UPDATE":return Object(p.a)(Object(p.a)({},e),{},Object(s.a)({},n,Object(p.a)(Object(p.a)({},l),{},{value:c,helper_text:i})));default:return Object(p.a)({},e)}}function cd(e){var t={},a=["sitio","purok","active","site_id"];return Object.keys(e).forEach((function(n){t[n]={value:e[n],helper_text:null,required:!a.includes(n)}})),t}var od=function(e){var t=e.siteInformation,a=e.setSiteInformationData,l=e.seasons,i=e.setIsDisabled,c=Object(n.useReducer)(id,t,cd),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)([]),p=Object(o.a)(d,2),b=p[0],g=p[1];return Object(n.useEffect)((function(){var e=Object.keys(m).some((function(e){var t=m[e],a=t.required,n=t.helper_text;return a&&""!==n&&null!==n}));i(e),a(function(e){var t={};return Object.keys(e).forEach((function(a){t[a]=e[a].value})),t}(m))}),[m]),Object(n.useEffect)((function(){if(null!==m.season.value){var e=ld(l,m.season.value);g(e)}}),[m.season.value]),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{label:"Site code",fullWidth:!0,required:!0,inputProps:{maxLength:3},value:m.site_code.value.toUpperCase(),onChange:function(e){return u({type:"UPDATE",field:"site_code",value:e.target.value})},helperText:m.site_code.helper_text||"",error:Boolean(m.site_code.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Purok",fullWidth:!0,placeholder:"Enter purok if available",InputLabelProps:{shrink:!0},value:m.purok.value||"",onChange:function(e){return u({type:"UPDATE",field:"purok",value:e.target.value})}})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Sitio",fullWidth:!0,placeholder:"Enter sitio if available",InputLabelProps:{shrink:!0},value:m.sitio.value||"",onChange:function(e){return u({type:"UPDATE",field:"sitio",value:e.target.value})}})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Barangay",fullWidth:!0,required:!0,value:m.barangay.value,onChange:function(e){return u({type:"UPDATE",field:"barangay",value:e.target.value})},helperText:m.barangay.helper_text||"",error:Boolean(m.barangay.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Municipality",fullWidth:!0,required:!0,value:m.municipality.value,onChange:function(e){return u({type:"UPDATE",field:"municipality",value:e.target.value})},helperText:m.municipality.helper_text||"",error:Boolean(m.municipality.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Province",fullWidth:!0,required:!0,value:m.province.value,onChange:function(e){return u({type:"UPDATE",field:"province",value:e.target.value})},helperText:m.province.helper_text||"",error:Boolean(m.province.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{required:!0,fullWidth:!0,error:Boolean(m.region.helper_text)},r.a.createElement(Ta.a,{id:"region"},"Region"),r.a.createElement(Na.a,{labelId:"region-select-label",id:"region-select-id",required:!0,value:m.region.value,onChange:function(e){return u({type:"UPDATE",field:"region",value:e.target.value})}},r.a.createElement(P.a,{value:""},r.a.createElement("em",null,"None")),rd.map((function(e,t){return r.a.createElement(P.a,{value:e,key:t},e)}))))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"PSGC",fullWidth:!0,type:"number",required:!0,value:m.psgc.value,onChange:function(e){return u({type:"UPDATE",field:"psgc",value:e.target.value})},helperText:m.psgc.helper_text||"",error:Boolean(m.psgc.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Latitude",fullWidth:!0,required:!0,type:"number",value:m.latitude.value||"",onChange:function(e){return u({type:"UPDATE",field:"latitude",value:e.target.value})},helperText:m.latitude.helper_text||"",error:Boolean(m.latitude.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(f.a,{label:"Longitude",fullWidth:!0,required:!0,type:"number",value:m.longitude.value||"",onChange:function(e){return u({type:"UPDATE",field:"longitude",value:e.target.value})},helperText:m.longitude.helper_text||"",error:Boolean(m.longitude.helper_text)})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(f.a,{label:"Elements at Risk",fullWidth:!0,required:!0,value:m.households.value||"",onChange:function(e){return u({type:"UPDATE",field:"households",value:e.target.value})},helperText:m.households.helper_text||"",error:Boolean(m.households.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Dt.a,null,r.a.createElement(wt.a,{control:r.a.createElement(Jt.a,{checked:m.active.value,onChange:function(e){return u({type:"UPDATE",field:"active",value:e.target.checked})},value:"checkedA",color:"primary"}),label:"Active site"}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{component:"fieldset",required:!0,error:Boolean(m.season.helper_text)},r.a.createElement(Xt.a,{component:"legend"},"Season"),r.a.createElement(At.a,{row:!0,"aria-label":"season_group",name:"season",value:m.season.value.toString(),onChange:function(e){var t=e.target.value;u({type:"UPDATE",field:"season",value:t});var a=ld(l,t);g(a)}},l.map((function(e,t){var a=e.season_group_id;return r.a.createElement(wt.a,{value:a.toString(),control:r.a.createElement(It.a,{color:"primary"}),label:"Season  ".concat(a),key:"season_".concat(a)})}))))),r.a.createElement(y.a,{item:!0,container:!0,xs:12},b.map((function(e){var t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(O.a,{variant:"subtitle1",color:"textSecondary",align:"center"},le(t)),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary",align:"center"},a.map((function(e){return le(e)})).join(", ")))}))))};var sd=Object(Ce.a)()((function(e){var t=e.fullScreen,a=e.isOpen,l=e.seasons,i=e.editButtonAction,s=e.siteInformation,m=Object(n.useContext)(Ca).setRefreshSites,u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],g=d[1],f=Object(n.useState)(!0),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(c.b)(),y=_.enqueueSnackbar,O=_.closeSnackbar,j=function(e){return r.a.createElement(b.a,{color:"primary",onClick:function(){O(e)}},"Dismiss")},x=function(){i(!1)};return r.a.createElement(Oe.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(je.a,{id:"form-dialog-title"},"Edit site information"),r.a.createElement(xe.a,null,r.a.createElement(ke.a,null,"Update necessary fields of site information form then save."),r.a.createElement(od,{siteInformation:s,setSiteInformationData:g,seasons:l,setIsDisabled:h})),r.a.createElement(Se.a,null,r.a.createElement(b.a,{onClick:x,color:"primary"},"Cancel"),r.a.createElement(b.a,{color:"primary",onClick:function(){!function(e,t){const a="".concat(te.b,"/api/sites/save_site_information");ne.a.post(a,e).then(e=>{const a=e.data;t(a),console.log("Save site info data reponse",a)}).catch(e=>{console.error(e)})}(p,(function(e){var t=e.status,a=e.message;"success"===t&&(x(),m(!0)),y(a,{variant:t,autoHideDuration:3e3,action:j})}))},disabled:v},"Save")))}));const md=Object(j.a)(e=>{const t=Object(Ju.a)(e);return Object(_e.d)(t)}),ud=()=>r.a.createElement(ft.a,{height:125,width:380,speed:2,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb"},r.a.createElement("rect",{x:"129",y:"20",rx:"3",ry:"3",width:"123",height:"44"}),r.a.createElement("rect",{x:"18",y:"80",rx:"3",ry:"3",width:"350",height:"22"}));var dd=function(e){const t=e.width,a=e.siteInformation,l=(md(),Object(n.useState)(null)),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)([]),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)([]),_=Object(o.a)(h,2),j=_[0],x=_[1],k=Object(n.useState)(!1),S=Object(o.a)(k,2),C=S[0],D=S[1];Object(n.useEffect)(()=>{"undefined"!==typeof a&&s(a)},[a]),Object(n.useEffect)(()=>{var e;null!==c&&(e=e=>{v(e)},ne.a.get("".concat(te.b,"/api/sites/get_seasons")).then(t=>{const a=t.data;e(a)}).catch(e=>{console.log(e)}),function(e,t){ne.a.get("".concat(te.b,"/api/sites/get_site_season/").concat(e)).then(e=>{const a=e.data;t(a)}).catch(e=>{console.log(e)})}(c.site_code,e=>{const t=e.season_months,a=t.routine_schedules,n=[],r=[];a.forEach(e=>{const t=$()().isoWeekday(e.iso_week_day).format("dddd");"d"===e.season_type?n.push(t):r.push(t)});x([{key:"dry",list:n},{key:"wet",list:r}]),delete t.routine_schedules,delete t.season_group_id;const l=[],i=[];Object.keys(t).forEach(e=>{"d"===t[e]?l.push(e):i.push(e)}),de(l),de(i);p([{key:"dry",list:l},{key:"wet",list:i}])}))},[c]);const A=()=>{D(!C)};return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2,justify:"space-between",alignItems:"stretch"},r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(nd,Object.assign({},e,{width:t}))),r.a.createElement(y.a,{item:!0,xs:!0,container:!0,justify:"flex-end"},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",onClick:A,startIcon:r.a.createElement(yi.a,null)},"Edit Info"))),r.a.createElement(y.a,{container:!0,spacing:2},null!==c?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h4"},c.site_code.toUpperCase()),r.a.createElement(O.a,{variant:"h5",color:"textSecondary"},re(c,!1))),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(G.a,{raised:!0},r.a.createElement(V.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Geographic Information"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Region"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},c.region)),r.a.createElement(y.a,{item:!0,xs:!0,sm:9,md:8,lg:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Philippine Standard Geographic Code"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},c.psgc)),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",color:"textSecondary"},"Seasons")),d.length>0&&d.map(e=>{const t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},le(t)),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>le(e)).join(", ")))})))))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,alignItems:"center"},r.a.createElement(G.a,{raised:!0,style:{width:"100%"}},r.a.createElement(V.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Monitoring Information"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",color:"textSecondary"},"Routine Schedules")),j.length>0&&j.map(e=>{const t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},le(t)),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},a.map(e=>le(e)).join(", ")))})),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Current Alert Level"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},"---")))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(G.a,{raised:!0},r.a.createElement(V.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Site Status"))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Active"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},c.active?"Yes":"No")),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Elements at Risk"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},c.households||"---")))))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(G.a,{raised:!0,style:{width:"100%"}},r.a.createElement(V.a,null,r.a.createElement(td,{siteCode:c.site_code}))))):r.a.createElement(y.a,{item:!0,xs:!0,style:{width:"100%"}},r.a.createElement(ud,null))),r.a.createElement(sd,{isOpen:C,siteInformation:a,editButtonAction:A,seasons:E}))};var pd=function(e){const t=e.siteMapData,a=e.hoveredSite,l=e.url,i=[12.8797,121.774],c=Object(n.useRef)(t.map(()=>Object(n.createRef)()));return Object(n.useEffect)(()=>{if(null!==a){const e=t.findIndex(e=>e.site_code===a),n=c.current[e].current;null!==n&&n.leafletElement.openPopup()}},[a]),r.a.createElement(Ao.a,{style:{height:"75vh"},center:i,zoom:5,scrollWheelZoom:"center"},r.a.createElement(wo.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((e,t)=>{const a=e.site_code;return r.a.createElement(Yo.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0,ref:c.current[t]},r.a.createElement(To.a,null,r.a.createElement(m.b,{to:"".concat(l,"/").concat(a),style:{color:"black"}},r.a.createElement("strong",null,a.toUpperCase())," ",r.a.createElement("br",null),re(e,!1))))}))};const bd=Object(j.a)(e=>{const t=Object(_e.d)(e),a=118+.06*(window.innerHeight-118);return Object(p.a)(Object(p.a)({},t),{},{sticky:{position:"sticky",top:a,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}})}),gd=()=>r.a.createElement(ft.a,{height:300,width:684,speed:1,foregroundColor:"#f3f3f3",backgroundColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"561",height:"700"}));function fd(e){const t=e.sitesPerRegion,a=e.url,n=e.setHoveredSite,l=Object.keys(t).sort();return r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"center"},l.map(e=>{const l="inactive"!==e?e.toUpperCase():"Inactive Sites";return r.a.createElement(y.a,{container:!0,justify:"center",key:e,style:{margin:"8px 0"}},r.a.createElement(O.a,{variant:"h6",component:y.a,item:!0,xs:12,align:"center",style:{marginBottom:4}},["I","V","X"].includes(l.charAt(0))&&"inactive"!==e?"Region ".concat(l):l),t[e].map(e=>r.a.createElement(O.a,{variant:"body2",component:y.a,item:!0,xs:12,align:"center",key:e.site_code},r.a.createElement(m.b,{to:"".concat(a,"/").concat(e.site_code),style:{color:"black"},onFocus:t=>n(e.site_code),onMouseOver:t=>n(e.site_code)},re(e,!0,"start")))))}))}var Ed=Object(Ge.a)()((function(e){const t=bd(),a=e.width,l=e.location,i=e.match.url,c=Object(n.useContext)(Ca).all_sites_including_inactive,s=Object(n.useState)(null),m=Object(o.a)(s,2),d=m[0],b=m[1],g=Object(n.useState)(null),f=Object(o.a)(g,2),E=f[0],v=f[1],h=Object(n.useState)(null),_=Object(o.a)(h,2),j=_[0],x=_[1];return Object(n.useEffect)(()=>{if(c.length>0){const e=[],t={};c.forEach(a=>{let n=a.region;a.active||(n="inactive"),t[n]||(t[n]=[]),t[n].push(a),e.push(Object(p.a)(Object(p.a)({},a),{},{url:"".concat(i,"/").concat(a.site_code)}))}),v(e),x(t)}},[c]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(ut,{title:"Community | Site Information"})),r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(u.d,{location:l},r.a.createElement(u.b,{exact:!0,path:i,render:e=>r.a.createElement(y.a,{container:!0,spacing:3,justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},null===E?r.a.createElement(gd,null):r.a.createElement("div",{className:t.sticky},r.a.createElement(pd,{siteMapData:E,width:a,url:i,hoveredSite:d}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center"},r.a.createElement(O.a,{variant:"h5",component:y.a,item:!0,xs:12,align:"center",gutterBottom:!0},r.a.createElement("strong",null,"Dynaslope Project Sites")),null===j?"Loading":r.a.createElement(fd,{sitesPerRegion:j,url:i,setHoveredSite:b})))}),r.a.createElement(u.b,{path:"".concat(i,"/:site_code"),render:e=>{const t=e.match.params.site_code,n=c.filter(e=>e.site_code===t).pop();return r.a.createElement(dd,Object.assign({},e,{width:a,siteInformation:n}))}}))))}));const vd=Object(j.a)(e=>({list:{maxHeight:"60vh",overflowY:"auto",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"}},searchBox:{marginBottom:e.spacing(3)},sticky:{position:"sticky",top:146,[e.breakpoints.down("sm")]:{top:48},backgroundColor:"white",zIndex:1}}));var hd=function(e){const t=e.users,a=e.onMemberClickFn,l=e.selectedUserDetails,i=vd(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],g=p[1];return Object(n.useEffect)(()=>{u(t)},[t]),Object(n.useEffect)(()=>{if(null!==b){const e=t.filter(e=>{const t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(b.toLowerCase()),"gi").test(n.toLocaleLowerCase())});u(e)}else u(t)},[b]),r.a.createElement("div",{className:i.sticky},r.a.createElement(Kn.a,{fullWidth:!0,margin:"dense",placeholder:"Search Dynaslope staff...",onChange:e=>g(e.target.value),className:i.searchBox}),r.a.createElement(Or.a,{"aria-label":"list",className:i.list},null!==m&&m.map(e=>{const t="".concat(e.last_name,", ").concat(e.first_name),n=null!==l&&l.user_id===e.user_id;return r.a.createElement(xr.a,{button:!0,key:e.user_id,onClick:a(e),selected:n},r.a.createElement(kr.a,{primary:t}))})))},_d=a(1184),yd=a(1244),Od=a(1245),jd=a(1246),xd=a(633),kd=a.n(xd);var Sd=a(634),Cd=a.n(Sd),Dd=Object(j.a)((function(e){var t;return{root:{maxWidth:"100%",flexGrow:1},container:{maxWidth:"50%"},media:{objectPosition:"top"},avatar:(t={width:150,height:150},Object(s.a)(t,e.breakpoints.down("md"),{width:100,height:100}),Object(s.a)(t,"backgroundColor","#f2f2f2"),t),avatarContainer:{marginTop:-72,marginBottom:e.spacing(1)},editButton:{backgroundColor:"#f2f2f2","&:hover":{backgroundColor:"#f2f2f2"}},nickname:{marginBottom:e.spacing(2)},listBody:{paddingLeft:e.spacing(7),paddingRight:e.spacing(11),textAlign:"center"},link:{textDecoration:"none",color:"black"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"}}}));function Ad(e){var t=e.inputRef,a=e.mask,n=Object(da.a)(e,["inputRef","mask"]);return r.a.createElement(ks.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}var wd=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],Id=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function Md(e,t,a){return""===t&&a?"Required field":"sim_num"!==e||t.match(/^[a-z0-9]+$/i)?"birthday"!==e||null===t||t.isValid()?"":"Enter a valid date":"Enter complete mobile number"}function Td(e,t){var a,n,r,l=t.type,i=t.field,c=t.value,o=t.key,m=t.category,u=null,d=null,b=null,g=null,f=e.field_with_error;if("ADD"===l){var E={};"mobile_numbers"===m?(g=Object(ye.a)(e.mobile_numbers),E=Yd({status:1,mobile_number:{sim_num:"",mobile_id:0,gsm_id:0}})):"emails"===m&&(g=Object(ye.a)(e.emails),E=Nd({email:"",email_id:0})),g.push(E),f.add("".concat(m,".").concat(g.length-1))}else if("DELETE"===l){"mobile_numbers"===m?g=Object(ye.a)(e.mobile_numbers):"emails"===m&&(g=Object(ye.a)(e.emails)),g.splice(o,1),f.forEach((function(e){e.includes("".concat(m,".").concat(o))&&f.delete(e)}))}else{u=e[i];var v=i;if(d=c,["middle_name","sex"].includes(i)&&(d=c||null),"sim_num"===i&&(d=c.replace(/[()+-\s]/g,"")),"undefined"===typeof m&&(b=Md(i,d,u.required)),g=[],["status","sim_num","gsm_id"].includes(i)){g=Object(ye.a)(e.mobile_numbers);var h={};if("status"===i)u=g[o][i],h=g[o];else u=g[o].mobile_number[i],h=g[o].mobile_number;b=Md(i,d,u.required);var _=Object(p.a)(Object(p.a)({},u),{},{value:d,helper_text:b});h[i]=_,v="mobile_numbers.".concat(o)}if("email"===i){var y=(g=Object(ye.a)(e.emails))[o];b=Md(i,d,(u=y[i]).required);var O=Object(p.a)(Object(p.a)({},u),{},{value:d,helper_text:b});y[i]=O,v="emails.".concat(o)}"undefined"!==typeof m&&(f.has(v)&&f.delete(v),v+=".".concat(i)),b?f.add(v):f.delete(v)}switch(l){case"UPDATE":return Object(p.a)(Object(p.a)({},e),{},(a={},Object(s.a)(a,i,Object(p.a)(Object(p.a)({},u),{},{value:d,helper_text:b})),Object(s.a)(a,"field_with_error",f),a));case"UPDATE_MOBILE":return Object(p.a)(Object(p.a)({},e),{},{mobile_numbers:g,field_with_error:f});case"UPDATE_EMAIL":return Object(p.a)(Object(p.a)({},e),{},{emails:g,field_with_error:f});case"ADD":return Object(p.a)(Object(p.a)({},e),{},(n={},Object(s.a)(n,m,g),Object(s.a)(n,"field_with_error",f),n));case"DELETE":return Object(p.a)(Object(p.a)({},e),{},(r={},Object(s.a)(r,m,g),Object(s.a)(r,"field_with_error",f),r));default:return Object(p.a)({},e)}}function Nd(e){return Object(p.a)(Object(p.a)({},e),{},{email:{value:e.email,helper_text:null,required:!0}})}function Yd(e){var t=e.mobile_number;return Object(p.a)(Object(p.a)({},e),{},{status:{value:e.status,helper_text:null,required:!1},mobile_number:Object(p.a)(Object(p.a)({},t),{},{sim_num:{value:t.sim_num,helper_text:null,required:!0}})})}function Rd(e){var t={},a=["middle_name","sex","birthday"];return Object.keys(e).forEach((function(n){var r={value:e[n],helper_text:null,required:!a.includes(n)};"mobile_numbers"===n&&(r=e[n].map((function(e){return Yd(e)}))),"emails"===n&&(r=e[n].map((function(e){return Nd(e)}))),t[n]=r})),t.field_with_error=new Set,t}function Hd(e){return Object(xs.conformToMask)(e,Id).conformedValue}function Bd(e){var t=e.classes,a=e.selectedUserDetails,l=e.setIsEdit,i=Object(n.useReducer)(Td,a,Rd),s=Object(o.a)(i,2),m=s[0],u=s[1],d=Object(n.useContext)(Ca).setRefreshUser,g=Object(c.b)().enqueueSnackbar;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,style:{marginTop:8}},r.a.createElement(y.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"First Name",required:!0,value:m.first_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"first_name",value:e.target.value})},helperText:m.first_name.helper_text||"",error:Boolean(m.first_name.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Last Name",required:!0,value:m.last_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"last_name",value:e.target.value})},helperText:m.last_name.helper_text||"",error:Boolean(m.last_name.helper_text)})),r.a.createElement(y.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Middle Name",value:m.middle_name.value||"",onChange:function(e){return u({type:"UPDATE",field:"middle_name",value:e.target.value})}})),r.a.createElement(y.a,{item:!0,xs:6,sm:3},r.a.createElement(f.a,{label:"Nickname",required:!0,value:m.nickname.value||"",onChange:function(e){return u({type:"UPDATE",field:"nickname",value:e.target.value})},helperText:m.nickname.helper_text||"",error:Boolean(m.nickname.helper_text),disabled:!0})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(Bl.b,{autoOk:!0,label:"Birthday",value:m.birthday.value||null,onChange:function(e){return u({type:"UPDATE",field:"birthday",value:e})},helperText:m.birthday.helper_text||"",error:Boolean(m.birthday.helper_text),ampm:!1,placeholder:"01/01/2000",format:"MM/DD/YYYY",mask:"__/__/____",clearable:!0,disableFuture:!0}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(Ta.a,{id:"sex-label"},"Sex"),r.a.createElement(Na.a,{labelId:"sex-label",id:"sex-select",value:m.sex.value||"",onChange:function(e){return u({type:"UPDATE",field:"sex",value:e.target.value})}},r.a.createElement(P.a,{value:""},"---"),r.a.createElement(P.a,{value:"M"},"Male"),r.a.createElement(P.a,{value:"F"},"Female")))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Q.a,null)),r.a.createElement(y.a,{item:!0,xs:12,lg:8,container:!0,spacing:1},r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"h6",align:"center"},"Contact Numbers"),m.mobile_numbers.map((function(e,t){var a=e.mobile_number,n=a.sim_num,l=a.mobile_id,i=a.gsm_id,c=e.status,o=0!==l;return r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:t},r.a.createElement(y.a,{item:!0,xs:o?5:4},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{label:"Mobile Number",required:!0,value:Hd(n.value),onChange:function(e){return u({type:"UPDATE_MOBILE",field:"sim_num",value:e.target.value,key:t,category:"mobile_numbers"})},InputProps:{inputComponent:Ad,inputProps:{mask:wd}},helperText:n.helper_text||"",error:Boolean(n.helper_text)}))),r.a.createElement(y.a,{item:!0,xs:o?4:3},r.a.createElement(Ya,{div_id:"network",label:"Network",changeHandler:function(e){return u({type:"UPDATE_MOBILE",field:"gsm_id",value:e.target.value,key:t,category:"mobile_numbers"})},value:i.value?i.value:i,list:[{id:2,label:"Globe/TM"},{id:3,label:"Smart/TNT/Sun"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(y.a,{item:!0,xs:o?2:3,container:!0,justify:"center"},r.a.createElement(wt.a,{style:{margin:0},control:r.a.createElement(Jt.a,{checked:Boolean(c.value),onChange:function(e){return u({type:"UPDATE_MOBILE",field:"status",value:e.target.checked?1:0,key:t,category:"mobile_numbers"})},color:"primary"}),label:"Active"})),!o&&r.a.createElement(y.a,{item:!0,xs:2,container:!0,justify:"center"},r.a.createElement(R.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return u({type:"DELETE",key:t,category:"mobile_numbers"})}},r.a.createElement(Oi.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,className:t.alignRight},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(om.a,null),onClick:function(){return u({type:"ADD",category:"mobile_numbers"})}},"Add number"))),r.a.createElement(y.a,{item:!0,xs:12,lg:4,container:!0,spacing:1},r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"h6",align:"center"},"Emails"),0===m.emails.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),m.emails.map((function(e,t){var a=e.email,n=0!==e.email_id;return r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:t},r.a.createElement(y.a,{item:!0,xs:n?12:10},r.a.createElement(Dt.a,{fullWidth:!0},r.a.createElement(f.a,{required:!0,label:"Email Address",value:a.value,onChange:function(e){return u({type:"UPDATE_EMAIL",field:"email",value:e.target.value,key:t,category:"emails"})},helperText:a.helper_text||"",error:Boolean(a.helper_text)}))),!n&&r.a.createElement(y.a,{item:!0,xs:2,container:!0,justify:"center"},r.a.createElement(R.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return u({type:"DELETE",key:t,category:"emails"})}},r.a.createElement(Oi.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,className:t.alignRight},r.a.createElement(b.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(om.a,null),onClick:function(){return u({type:"ADD",category:"emails"})}},"Add email"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"flex-end",style:{marginTop:8}},r.a.createElement(b.a,{color:"secondary",variant:"contained",style:{marginRight:6},disabled:m.field_with_error.size>0,onClick:function(){var e=function(e){var t={},a=Object(Fi.cloneDeep)(e);return delete a.field_with_error,Object.keys(a).forEach((function(e){var n=null;if("mobile_numbers"===e)n=a[e].map((function(e){var t=e.mobile_number,a=e.status;return Object(p.a)(Object(p.a)({},e),{},{status:a.value,mobile_number:Object(p.a)(Object(p.a)({},t),{},{sim_num:t.sim_num.value})})}));else if("emails"===e)n=a[e].map((function(e){return Object(p.a)(Object(p.a)({},e),{},{email:e.email.value})}));else if("birthday"===e){var r=a[e].value;n="string"===typeof r?r:r.format("YYYY-MM-DD")}else n=a[e].value;t[e]=n})),t}(m);e.mobile_numbers.forEach((function(e,t){var a=e.mobile_number;a.gsm_id=a.gsm_id.value?a.gsm_id.value:a.gsm_id})),console.log("Final",e),function(e,t){const a="".concat(te.b,"/api/users/update_user_info");ne.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(e,(function(e){var t=e.status,a=e.message;g(a,{variant:t,autoHideDuration:5e3}),"success"===t&&(l(!1),d(!0))}))}},"Save"),r.a.createElement(b.a,{color:"primary",variant:"contained",onClick:function(){return l(!1)}},"Cancel"))))}function Pd(e){var t=e.classes,a=e.selectedUserDetails,l=a.first_name,i=a.last_name,c=a.middle_name,o=a.nickname,s=a.birthday,m=a.sex,u=a.mobile_numbers,d=a.emails,p=["","NA",null].includes(c)?"":"".concat(c,"."),b=null===s?"---":$()(s).format("MMMM DD, YYYY"),g="---";null!==m&&(g="F"===m.toUpperCase()?"Female":"Male");return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{component:y.a,item:!0,xs:12,gutterBottom:!0,variant:"h5"},"".concat(l," ").concat(p," ").concat(i)),r.a.createElement(O.a,{component:y.a,item:!0,xs:12,variant:"body2",color:"textSecondary",gutterBottom:!0,className:t.nickname},o),r.a.createElement(y.a,{item:!0,xs:12,container:!0,style:{marginBottom:16}},r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(yd.a,{style:{paddingRight:8}}),r.a.createElement(O.a,{variant:"h6"},b)),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,justify:"center",alignItems:"center"},r.a.createElement(Od.a,{style:{paddingRight:8}}),r.a.createElement(O.a,{variant:"h6"},g))),r.a.createElement(y.a,{item:!0,xs:12,lg:6},r.a.createElement(O.a,{variant:"h6"},"Contact Numbers"),r.a.createElement(Or.a,{dense:!0},0===u.length?r.a.createElement(xr.a,{className:t.listBody},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(kt.a,null))),r.a.createElement(kr.a,{primary:"No mobile numbers saved"})):u.map((function(e){return r.a.createElement(xr.a,{className:t.listBody,key:e.mobile_number.mobile_id},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(kt.a,null))),r.a.createElement(kr.a,{primary:"".concat((a=e.mobile_number.sim_num,a.match(/[()+-\s]/g)?a:new kd.a("(+000) 00-000-0000").apply(a))," | ").concat(2===e.mobile_number.gsm_id?"Globe":"SMART/TNT/Sun"),secondary:"Status: ".concat(0===e.status?"Inactive":"Active")}));var a})))),r.a.createElement(y.a,{item:!0,xs:12,lg:6},r.a.createElement(O.a,{variant:"h6"},"Emails"),r.a.createElement(Or.a,{dense:!0},0===d.length?r.a.createElement(xr.a,{className:t.listBody},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(fu.a,null))),r.a.createElement(kr.a,{primary:"No email addresses saved"})):d.map((function(e){return r.a.createElement(xr.a,{className:t.listBody,key:e.email_id},r.a.createElement(Ks.a,null,r.a.createElement(Js.a,null,r.a.createElement(fu.a,null))),r.a.createElement(kr.a,{primary:e.email}))})))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6"},"Monitoring Shifts"),r.a.createElement(pi,{nickname:o})))}var Ld=function(e){var t=e.selectedUserDetails,a=e.isUser,l=e.url,i=Dd(),c=Object(n.useState)(!1),s=Object(o.a)(c,2),u=s[0],d=s[1],p=Object(n.useState)(!1),b=Object(o.a)(p,2),g=b[0],f=b[1],E=function(){d(!0),f(!1)},v=function(){return r.a.createElement(n.Fragment,null,r.a.createElement(R.a,{className:i.editButton,onClick:function(){return f(!0)}},r.a.createElement(yi.a,{color:"primary"})),r.a.createElement(Oe.a,{onClose:function(){return f(!1)},"aria-labelledby":"simple-dialog-title",open:g},r.a.createElement(je.a,{id:"simple-dialog-title"},"Profile options"),r.a.createElement(Or.a,null,r.a.createElement(xr.a,{button:!0,onClick:E},r.a.createElement(Sr.a,null,r.a.createElement(yi.a,null)),r.a.createElement(kr.a,{primary:"Edit info"})),r.a.createElement(m.b,{to:"".concat(l,"/credentials"),className:i.link},r.a.createElement(xr.a,{button:!0},r.a.createElement(Sr.a,null,r.a.createElement(jd.a,null)),r.a.createElement(kr.a,{primary:"Update credentials"}))))))};return r.a.createElement(n.Fragment,null,r.a.createElement(_d.a,{component:"img",height:"200",className:i.media,image:Cd.a,title:"Dynaslope Header Pic"}),r.a.createElement(V.a,{className:i.alignCenter},r.a.createElement(y.a,{container:!0,justify:"center"},r.a.createElement(y.a,{container:!0,item:!0,xs:12,className:i.avatarContainer,justify:"center"},r.a.createElement(H.a,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:a&&!u&&r.a.createElement(v,null)},r.a.createElement(Js.a,{className:i.avatar,src:nm.a}))),u?r.a.createElement(Bd,{classes:i,selectedUserDetails:t,setIsEdit:d}):r.a.createElement(Pd,{classes:i,selectedUserDetails:t}))))};const Fd=Object(j.a)(e=>Object(p.a)(Object(p.a)({},Object(_e.d)(e)),{},{schedIcon:{width:50,height:50,display:"flex"},margin:{margin:e.spacing(1)},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1}})),Ud=r.a.forwardRef((e,t)=>r.a.createElement(L.a,Object.assign({direction:"up",ref:t},e)));var qd=function(e){const t=e.match.url,a=Fd(),l=Object(n.useContext)(Ca).users,i=Object(k.a)(),c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],g=p[1],f=Object(n.useState)(!0),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),j=O[0],x=O[1],S=Object(n.useState)(!1),C=Object(o.a)(S,2),D=C[0],A=C[1];Object(n.useEffect)(()=>{u(l)},[l]),Object(n.useEffect)(()=>{if("undefined"!==typeof m&&null!==m){const e=m.filter(e=>{if(e.user_id===i.user_id)return e});g(e[0])}},[m]),Object(n.useEffect)(()=>{"undefined"!==typeof b&&null!==b&&(b.user_id===i.user_id?x(!0):x(!1),b.teams.forEach(e=>{A("web-admin"===e.team.team_name)}))},[b]);const w=()=>{h(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(ut,{title:"Dynaslope | Staff Profiles"})),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(y.a,{container:!0,justify:"center",spacing:2},null!==m&&r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(hd,{users:m,onMemberClickFn:e=>()=>{g(e),h(!0)},isWebAdmin:D,isUser:j,selectedUserDetails:b})),null!==b&&r.a.createElement(n.Fragment,null,r.a.createElement(Xe.a,{smDown:!0},r.a.createElement(y.a,{item:!0,xs:12,md:8},"undefined"!==typeof b&&r.a.createElement(G.a,null,r.a.createElement(Ld,{currentUser:i,selectedUserDetails:b,isUser:j,isAdmin:D,url:t})))),r.a.createElement(Xe.a,{mdUp:!0},r.a.createElement(Oe.a,{fullScreen:!0,open:v,onClose:w,TransitionComponent:Ud},r.a.createElement(T.a,{className:a.appBar},r.a.createElement(N.a,{style:{justifyContent:"flex-end"}},r.a.createElement(R.a,{edge:"end",color:"inherit",onClick:w,"aria-label":"close"},r.a.createElement(Zt.a,null)))),"undefined"!==typeof b&&r.a.createElement(Ld,{currentUser:i,selectedUserDetails:b,isUser:j,isAdmin:D,url:t})))))))},Wd=a(636),zd=a.n(Wd),Gd=a(1185),Vd=a(637),Qd=a.n(Vd),Zd=a(638),Kd=a.n(Zd),Jd=a(635),Xd=a.n(Jd);const $d=Object(j.a)(e=>({paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},avatar_success:{margin:e.spacing(1),backgroundColor:"green"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},form_display:{display:"block"},form_hide:{display:"none"}}));function ep(e){const t=e.history,a=$d(),l=Object(n.useState)(""),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(""),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(n.useState)(""),y=Object(o.a)(_,2),j=y[0],x=y[1],S=Object(n.useState)(""),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(!0),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)(!1),Y=Object(o.a)(N,2),H=Y[0],B=Y[1],P=Object(n.useState)("error"),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)("Update login credentials"),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(!1),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(k.a)().user_id;Object(n.useEffect)(()=>{v.length>5||j.length>5?v===j?(s("Enter your old password below"),T(!1),U("primary")):(s("Passwords did not matched"),T(!0),U("error")):(s("Password too short"),U("error")),0!==v.length&&0!==j.length||s("")},[v,j]);const X=()=>{t.push("/profile")};return r.a.createElement(Gd.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:a.paper},r.a.createElement(Js.a,{className:Z?a.avatar_success:a.avatar},Z?r.a.createElement(Xd.a,null):r.a.createElement(zd.a,null)),r.a.createElement(O.a,{component:"h1"},z),r.a.createElement("div",{className:Z?a.form_hide:a.form_display},r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"New username (leave empty if no changes)",name:"Username",onChange:e=>p(e.target.value)}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",fullWidth:!0,type:H?"text":"password",label:"New password",id:"password1",onChange:e=>h(e.target.value),InputProps:{endAdornment:r.a.createElement(du.a,{position:"end"},r.a.createElement(R.a,{"aria-label":"toggle password visibility",onClick:()=>B(!H)},H?r.a.createElement(Qd.a,null):r.a.createElement(Kd.a,null)))}}),r.a.createElement(f.a,{variant:"outlined",margin:"normal",type:"password",fullWidth:!0,id:"password2",label:"Confirm new password",onChange:e=>x(e.target.value)}),r.a.createElement(O.a,{variant:"body2",color:F},c),r.a.createElement(f.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"currentpassword",label:"Current password",type:"password",id:"password",autoComplete:"current-password",disabled:M,onChange:e=>A(e.target.value)})),r.a.createElement(b.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:a.submit,disabled:M,onClick:Z?X:()=>{!function(e,t){const a="".concat(te.b,"/api/users/update_account");ne.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({user_id:J,username:d,new_password:v,old_password:D},e=>{"success"===e?(G("Account update success"),K(!0)):(K(!1),s("Invalid old password"),U("error"))})}},Z?"go to profile":"save changes"),!Z&&r.a.createElement(b.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:X},"Cancel")))}var tp=a(640),ap=a.n(tp),np=a(639),rp=a.n(np),lp=a(433),ip=a.n(lp),cp=a(642),op=a.n(cp),sp=a(641),mp=a.n(sp);const up=Object(j.a)(e=>({paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.primary.main,padding:5},successIcon:{margin:e.spacing(1),width:70,height:70,color:"green",backgroundColor:"white"},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)},hide:{display:"none"},flex:{display:"flex"}}));function dp(e){const t=e.inputRef,a=e.mask,n=Object(da.a)(e,["inputRef","mask"]);return r.a.createElement(ks.a,Object.assign({},n,{ref:e=>{t(e?e.inputElement:null)},mask:a,placeholderChar:"\xd7",showMask:!0}))}const pp=[{value:"Mr.",label:"Mr."},{value:"Ms.",label:"Ms."},{value:"Mrs.",label:"Mrs."}];function bp(){const e=up(),t=Object(n.useContext)(Ca).setRefreshUser,a=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],l=Object(n.useState)(""),i=Object(o.a)(l,2),c=i[0],s=i[1],m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(""),E=Object(o.a)(g,2),v=E[0],h=E[1],_=Object(n.useState)(""),j=Object(o.a)(_,2),x=j[0],k=j[1],S=Object(n.useState)([]),C=Object(o.a)(S,2),D=C[0],A=C[1],w=Object(n.useState)(""),I=Object(o.a)(w,2),M=I[0],T=I[1],N=Object(n.useState)([]),Y=Object(o.a)(N,2),H=Y[0],B=Y[1],P=Object(n.useState)(""),L=Object(o.a)(P,2),F=L[0],U=L[1],q=Object(n.useState)(""),W=Object(o.a)(q,2),z=W[0],G=W[1],V=Object(n.useState)(""),Z=Object(o.a)(V,2),K=Z[0],J=Z[1],X=Object(n.useState)(!1),ee=Object(o.a)(X,2),ae=ee[0],re=ee[1],le=Object(n.useState)(null),ie=Object(o.a)(le,2),ce=ie[0],oe=ie[1],se=Object(n.useState)("m"),me=Object(o.a)(se,2),ue=me[0],de=me[1],pe=Object(n.useState)("Mr."),be=Object(o.a)(pe,2),ge=be[0],fe=be[1],Ee=Object(n.useState)(!0),ve=Object(o.a)(Ee,2),he=ve[0],_e=ve[1];Object(n.useEffect)(()=>{_e(""===z||""===K)},[z,K]);const ye=()=>{const e=H.map(e=>e.replace(/[()+-\s]/g,"")),a=[];e.forEach(e=>{const t={mobile_number:{mobile_id:0,sim_num:e},status:1};a.push(t)});!function(e,t){const a="".concat(te.b,"/api/users/create_dynaslope_user");ne.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}({user_id:0,first_name:c,middle_name:d,last_name:v,nickname:x,salutation:ge,birthday:ce,sex:ue,emails:D,mobile_numbers:""!==e?a:[],landline_numbers:[],ewi_recipient:0,status:1,username:z,password:K},e=>{e.status&&(re(!0),t(!0))})};return r.a.createElement(Gd.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:e.paper},r.a.createElement(Js.a,{className:ae?e.successIcon:e.avatar},ae?r.a.createElement(rp.a,{className:e.successIcon}):r.a.createElement(ap.a,null)),r.a.createElement(O.a,{component:"h1",variant:"h5"},ae?"New user was created!":" Create Dynaslope User"),r.a.createElement("div",{className:ae?e.hide:e.form},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,md:3},r.a.createElement(f.a,{variant:"outlined",value:ge,fullWidth:!0,select:!0,onChange:e=>fe(e.target.value),SelectProps:{native:!0}},pp.map(e=>r.a.createElement("option",{key:e.value,value:e.value},e.label)))),r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(f.a,{variant:"outlined",value:c,label:"First Name",fullWidth:!0,onChange:e=>s(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12,sm:5},r.a.createElement(f.a,{variant:"outlined",value:d,label:"Middle Name",fullWidth:!0,onChange:e=>p(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:v,label:"Last Name",fullWidth:!0,onChange:e=>h(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(f.a,{variant:"outlined",value:x,fullWidth:!0,label:"Nickame",onChange:e=>k(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12,md:4},r.a.createElement(f.a,{variant:"outlined",value:ue,fullWidth:!0,select:!0,onChange:e=>de(e.target.value),SelectProps:{native:!0}},r.a.createElement("option",{value:"m"},"Male"),r.a.createElement("option",{value:"f"},"Female"))),r.a.createElement(y.a,{item:!0,xs:12,md:8},r.a.createElement(ea.a,{utils:aa.a},r.a.createElement(Bl.b,{disableToolbar:!0,variant:"dialog",format:"yyyy-MM-DD",margin:"normal",label:"Birth Date",value:ce,onChange:e=>(e=>{const t=$()(e).format("yyy-MM-DD");oe(t)})(e),KeyboardButtonProps:{"aria-label":"change date"},placeholder:"YYYY-MM-DD",fullWidth:!0,style:{marginTop:0},disableFuture:!0,maxDate:$()().subtract(15,"years")}))),H.length>0&&H.map((t,n)=>r.a.createElement(y.a,{item:!0,xs:12,key:t,className:e.flex},r.a.createElement(f.a,{variant:"outlined",value:t,fullWidth:!0,label:"Phone",InputProps:{inputComponent:dp,inputProps:{mask:a}}}),r.a.createElement(vt.a,{title:"remove from list"},r.a.createElement(R.a,{variant:"contained",style:{margin:2,color:"red"},onClick:e=>(e=>{const t=H;t.splice(e,1),B([...t])})(n)},r.a.createElement(mp.a,null))))),r.a.createElement(y.a,{item:!0,xs:12,className:e.flex},r.a.createElement(f.a,{variant:"outlined",value:F,fullWidth:!0,onChange:e=>U(e.target.value),placeholder:"Mobile Number",InputProps:{inputComponent:dp,inputProps:{mask:a}}}),r.a.createElement(vt.a,{title:"add to list"},r.a.createElement(R.a,{color:"primary",variant:"contained",style:{margin:2},onClick:e=>(()=>{if(F.length>0){const e=H;e.push(F),B([...e]),U("")}})()},r.a.createElement(op.a,null)))),r.a.createElement(Q.a,null),D.length>0&&D.map((e,t)=>r.a.createElement(y.a,{item:!0,xs:12,key:e},r.a.createElement(Kn.a,{fullWidth:!0,value:e,onChange:e=>T(e.target.value),endAdornment:r.a.createElement(du.a,{position:"end"},r.a.createElement(vt.a,{title:"Remove email from list"},r.a.createElement(R.a,{onClick:e=>(e=>{const t=D;t.splice(e,1),A([...t])})(t)},r.a.createElement(ip.a,null))))}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Kn.a,{fullWidth:!0,placeholder:D.length>0?"Add another email":"Email",value:M,onChange:e=>T(e.target.value),endAdornment:r.a.createElement(du.a,{position:"end"},r.a.createElement(vt.a,{title:"add email to list"},r.a.createElement(R.a,{color:"primary",onClick:e=>(()=>{if(M.length>0){const e=D;e.push(M),A([...e]),T("")}})()},r.a.createElement(Wm.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:z,fullWidth:!0,label:"username",type:"text",onChange:e=>G(e.target.value)})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(f.a,{variant:"outlined",value:K,fullWidth:!0,label:"Password",type:"password",onChange:e=>J(e.target.value)})))),r.a.createElement(b.a,{fullWidth:!0,variant:"contained",color:"primary",className:e.submit,onClick:ae?e=>{window.location.href=te.c}:e=>ye(),disabled:!ae&&he},ae?"Dashboard":"Create"),ae&&r.a.createElement(b.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:e=>(s(""),p(""),h(""),k(""),de(""),oe(null),fe(""),G(""),J(""),A([]),B([]),_e(!0),void re(!1))},"Create another account")))}var gp=function(e){var t=e.location,a=e.match.url;return r.a.createElement(u.d,{location:t},r.a.createElement(u.b,{exact:!0,path:a,component:fl}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/events"),component:Rl}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/shifts_and_reports"),component:hi}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/issues_and_reminders"),component:Bi}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/logs"),component:Mi}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/qa"),component:ic}),r.a.createElement(u.b,{path:"".concat(a,"monitoring"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(u.b,{path:"".concat(a,"analysis/sites"),component:ls}),r.a.createElement(u.b,{path:"".concat(a,"analysis/alerts"),component:vs}),r.a.createElement(u.b,{path:"".concat(a,"analysis/forms/loggers_and_sensors"),component:Vs}),r.a.createElement(u.b,{path:"".concat(a,"analysis"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(u.b,{path:"".concat(a,"communication/chatterbox"),component:mu}),r.a.createElement(u.b,{path:"".concat(a,"communication/contacts"),component:Uu}),r.a.createElement(u.b,{path:"".concat(a,"communication/mailbox"),component:Ku}),r.a.createElement(u.b,{path:"".concat(a,"communication"),render:function(){return r.a.createElement("h3",null,"Sorry. We could not find what you are looking for.")}}),r.a.createElement(u.b,{path:"".concat(a,"community/site_info"),component:Ed}),r.a.createElement(u.b,{path:"".concat(a,"profile/credentials"),component:ep}),r.a.createElement(u.b,{path:"".concat(a,"profile/create"),component:bp}),r.a.createElement(u.b,{path:"".concat(a,"profile"),component:qd}),r.a.createElement(u.b,{render:function(){return r.a.createElement("h3",null," Not found")}}))};var fp=function(e){const t=e.match.params,a=t.site_code,l=t.ts_end,i=t.chart_type,s=t.tsm_sensor,m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],p=u[1],b=Object(n.useState)(""),g=Object(o.a)(b,2),f=g[0],E=g[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(c.b)().enqueueSnackbar,x=Object(k.a)(),S=Object(j.a)(e=>Object(_e.d)(e))();Object(n.useEffect)(()=>{O("Please wait for the charts to load before closing the page. If loading took long enough, please wait for about a minute and check your connection before trying again. If loading problem persist, contact the developers.",{variant:"warning",autoHideDuration:1e4,style:{whiteSpace:"pre-line"},anchorOrigin:{vertical:"top",horizontal:"center"}});const t={site_code:a,ts_end:l};let n;"rainfall"===i?(n=r.a.createElement(uo,Object.assign({},e,{input:t,currentUser:x,disableBack:!0,saveSVG:!0})),p(n)):"surficial"===i?(n=r.a.createElement(eo,Object.assign({},e,{input:t,currentUser:x,disableBack:!0,disableMarkerList:!0,isEndOfShift:!0,saveSVG:!0})),E(n)):"subsurface"===i&&(t.tsm_sensor=s,n=r.a.createElement(jo,Object.assign({},e,{input:t,currentUser:x,disableBack:!0,saveSVG:!0,isEOS:!0})),y(n))},[]);const C=le(i);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:S.pageContentMargin},r.a.createElement(ut,{title:"Chart Rendering | ".concat(a.toUpperCase()," | ").concat(C)})),r.a.createElement("div",{className:S.pageContentMargin},d,f,_))};var Ep=Object(d.a)((function(e){var t;return{app:{height:"100%",minHeight:"85vh",display:"flex",flexDirection:"column",justifyContent:"space-between"},body:(t={marginTop:60},Object(s.a)(t,e.breakpoints.up("sm"),{marginTop:70}),Object(s.a)(t,e.breakpoints.up("md"),{marginTop:124}),t)}}))((function(e){var t=e.classes;Object(n.useEffect)((function(){document.title="MIA 3.0 - Dynaslope Monitoring and Information Application"}),[]);var a=Object(n.useState)(!1),l=Object(o.a)(a,2),i=l[0],c=l[1],s=function(e){return function(){c(e)}},d=Object(n.useState)(null),p=Object(o.a)(d,2),b=p[0],g=p[1],f=Object(n.useRef)(!1);Object(n.useEffect)((function(){return Object(k.b)((function(e){g(e),e&&(f.current=setInterval(k.e,te.a))})),function(){return clearInterval(f.current)}}),[]);var E=function(){g(!0),f.current=setInterval(k.e,te.a)},v=function(){g(!1),clearInterval(f.current)};return r.a.createElement(m.a,null,r.a.createElement(u.d,null,r.a.createElement(u.b,{path:"/bulletin/:release_id",component:Wt}),r.a.createElement(u.b,{path:"/chart_rendering/:site_code/:ts_end/:chart_type/:tsm_sensor?",component:fp}),r.a.createElement(u.b,{exact:!0,path:"/login",render:function(e){return null===b?r.a.createElement("div",null,"Loading..."):b?r.a.createElement(u.a,{to:"/"}):r.a.createElement(M,Object.assign({},e,{onLogin:E}))}}),r.a.createElement(u.b,{path:"/",render:function(e){return null===b?r.a.createElement("div",null,"Loading..."):b?r.a.createElement(Da,null,r.a.createElement(Qe.b,null,r.a.createElement(hr,null,r.a.createElement(Ne,null,r.a.createElement(be,null,r.a.createElement(Pe,Object.assign({},e,{drawerHandler:s,onLogout:v})),r.a.createElement(Je,Object.assign({},e,{drawerHandler:s,drawer:i,onLogout:v}))),r.a.createElement("div",{className:t.app},r.a.createElement("div",{className:t.body},r.a.createElement(gp,e))),r.a.createElement(Y,null))))):r.a.createElement(u.a,{to:"/login"})}})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function vp(){}console.log=vp,console.warn=vp,console.error=vp,i.a.render(r.a.createElement(c.a,{maxSnack:3,anchorOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(Ep,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return o}));var n=a(2),r=a(0),l=a.n(r),i=a(99),c=Object(r.createContext)(),o=function(e){var t=e.children,a=Object(r.useState)(null),o=Object(n.a)(a,2),s=o[0],m=o[1];Object(r.useEffect)((function(){return Object(i.b)(),Object(i.e)((function(e){return m(e)})),function(){return Object(i.h)()}}),[]);var u={server_time:s};return l.a.createElement(c.Provider,{value:u},t)}},207:function(e,t,a){e.exports=a.p+"static/media/phivolcs-dynaslope-logo.de612ba1.png"},22:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return u}));var n=a(15),r=a.n(n),l=a(10);function i(e,t){const a="".concat(l.b,"/api/refresh_session");r.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}function c(e){const t=JSON.parse(localStorage.getItem("data"));if(null!==t){const a=t.tokens,n=a.access_token,c=a.refresh_token;!function(e,t){const a="".concat(l.b,"/api/check_session");r.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(n,a=>{const n=a.is_logged_in;n&&i(c,e=>{t.tokens.access_token=e.access_token,localStorage.setItem("data",JSON.stringify(t))}),e(n)})}else e(!1)}function o(){const e=JSON.parse(localStorage.getItem("data"));i(e.tokens.refresh_token,t=>{e.tokens.access_token=t.access_token,localStorage.setItem("data",JSON.stringify(e))})}function s(e,t,a){!function(e,t){const a="".concat(l.b,"/api/login");r.a.post(a,e).then(e=>{const a=e.data;console.log(a),t(a)}).catch(e=>{console.error(e)})}(e,e=>{const n=e.ok,r=e.message,l=e.data;n?(localStorage.setItem("data",JSON.stringify(l)),t(l)):a(r)})}function m(e){localStorage.clear(),e()}function u(){return JSON.parse(localStorage.getItem("data")).user}},27:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return i}));var n=a(9),r="#FCEE27",l="#F8991D",i="#991B1E";t.d=function(e){var t;return{dynaslopeLogo:{height:60},phivolcsLogo:{height:70,marginTop:8},phivolcsDynaslopeLogo:{height:62},pageContentMargin:(t={margin:"0 16px"},Object(n.a)(t,e.breakpoints.up("md"),{margin:"0 64px"}),Object(n.a)(t,e.breakpoints.up("lg"),{margin:"0 100px"}),t),paperContainer:{width:"100%",overflowX:"auto"},sectionHeadContainer:{margin:"20px 0"},sectionHead:Object(n.a)({fontSize:"1.5rem"},e.breakpoints.down("xs"),{fontSize:"1.2rem"}),extended:{backgroundColor:"green","& *":{fontWeight:"bolder"}},alert0:{backgroundColor:"#EEEEEE","& *":{fontWeight:"bolder",color:"black !important"}},alert1:{backgroundColor:"#FCEE27","& *":{fontWeight:"bolder"}},alert2:{backgroundColor:"#F8991D","& *":{color:"white !important",fontWeight:"bolder"}},alert3:{backgroundColor:"#991B1E","& *":{color:"white !important",fontWeight:"bolder"}},invalidAlert:{backgroundColor:"#EEEEEE","& *":{color:"red !important"}},dyna_error:{color:"#FE0000"}}}},609:function(e,t,a){e.exports=a.p+"static/media/login-bg-img.6bf92800.jpg"},612:function(e,t,a){e.exports=a.p+"static/media/notif_sound.4fc52fe1.mp3"},613:function(e,t,a){"use strict";(function(e){var n=a(2),r=a(3),l=a(0),i=a.n(l),c=a(37),o=a(76),s=a(1118),m=a(334),u=a(50),d=a(647),p=a(356),b=a(177),g=a(650),f=a(174),E=a(1108),v=a(446),h=a(1106),_=a(1107),y=a(1109),O=a(1110),j=a(6),x=a.n(j),k=a(207),S=a.n(k),C=a(27),D=a(22),A=a(110);const w=Object(o.a)(e=>Object(r.a)(Object(r.a)({},Object(C.d)(e)),{},{list:{width:300,maxWidth:360},nested:{paddingLeft:e.spacing(3)},nestedText:{fontSize:"0.9rem"},drawerHeader:{height:220,display:"block",alignItems:"center",textAlign:"center",padding:16},logo:{height:105},titleBlock:{display:"block",margin:"0 4px"},projectTitle:{fontWeight:600},link:{textDecoration:"none"}}));t.a=function(t){const a=t.drawerHandler,r=t.drawer,o=t.navigationLabels,j=t.history,k=t.onLogout,C=w(),I=Object(l.useState)({}),M=Object(n.a)(I,2),T=M[0],N=M[1],Y=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent),R=Object(D.a)().nickname,H=Object(l.useContext)(A.a).server_time;return i.a.createElement(s.a,{open:r,onClose:a(!1),onOpen:a(!0),disableBackdropTransition:!Y,disableDiscovery:Y},i.a.createElement("div",{tabIndex:0,role:"button",onKeyDown:a(!1)},i.a.createElement("div",{className:C.list},i.a.createElement(m.a,{className:C.drawerHeader},i.a.createElement("img",{src:S.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(C.phivolcsDynaslopeLogo," ").concat(C.logo)}),i.a.createElement(u.a,{variant:"h5",className:C.projectTitle},"MIA 3.0"),i.a.createElement(u.a,{variant:"subtitle2",className:C.projectSubtitle},"Monitoring and Information Application"),i.a.createElement(u.a,{variant:"subtitle1",style:{marginTop:6,fontWeight:600}},"Hello ",R,"!"),i.a.createElement(u.a,{variant:"button"},H?x()(H).format("ddd DD-MMM-YYYY HH:mm:ss"):"Loading server time...")),i.a.createElement(d.a,null),i.a.createElement(p.a,{component:"nav"},i.a.createElement(b.a,{button:!0,onClick:()=>{j.push("/profile")}},i.a.createElement(g.a,null,i.a.createElement(h.a,null)),i.a.createElement(f.a,{primary:"Profile"})),i.a.createElement(b.a,{button:!0,onClick:()=>{Object(D.d)(()=>{k(),j.push("/login")})}},i.a.createElement(g.a,null,i.a.createElement(_.a,null)),i.a.createElement(f.a,{primary:"Logout"}))),i.a.createElement(d.a,null),i.a.createElement(p.a,{component:"nav",subheader:i.a.createElement(E.a,{component:"div"},"Directory")},o.map(({key:e,main:t,sub:n})=>i.a.createElement(l.Fragment,{key:e},i.a.createElement(b.a,{button:!0,onClick:()=>(e=>{const t="undefined"!==typeof T[e]&&T[e];N(a=>({[e]:!t}))})(e)},i.a.createElement(f.a,{primary:t}),T[e]?i.a.createElement(y.a,null):i.a.createElement(O.a,null)),i.a.createElement(v.a,{in:T[e],timeout:"auto",unmountOnExit:!0},i.a.createElement(p.a,{component:"div",disablePadding:!0},n.map((e,t)=>{const n=e.label,r=e.link,l=e.soon,o=e.divider;if("undefined"!==typeof l){const e=i.a.createElement("span",null,n,i.a.createElement(u.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON"));return i.a.createElement(b.a,{key:n,button:!0,className:C.nested,disabled:!0},i.a.createElement(f.a,{primaryTypographyProps:{className:C.nestedText},primary:e}))}return"undefined"!==typeof o?i.a.createElement(b.a,{key:t,divider:!0,button:!1,style:{paddingTop:0,marginBottom:8}}):i.a.createElement(c.b,{to:r,key:n,className:C.link},i.a.createElement(b.a,{button:!0,className:C.nested,onClick:a(!1)},i.a.createElement(f.a,{primaryTypographyProps:{className:C.nestedText},primary:n})))})))))))))}}).call(this,a(220))},615:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-head.990f0dc9.png"},616:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-footer.131de212.png"},634:function(e,t,a){e.exports=a.p+"static/media/dyna_wall.d9a91c1f.jpg"},657:function(e,t,a){e.exports=a(1092)},662:function(e,t,a){},99:function(e,t,a){"use strict";a.d(t,"h",(function(){return s})),a.d(t,"b",(function(){return m})),a.d(t,"e",(function(){return u})),a.d(t,"d",(function(){return p})),a.d(t,"a",(function(){return d})),a.d(t,"g",(function(){return b})),a.d(t,"c",(function(){return g})),a.d(t,"f",(function(){return f}));var n,r=a(208),l=a.n(r),i=a(10),c=a(22);function o(){"undefined"!==typeof n&&null!==n||(n=l()("".concat(i.b,"/misc"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function s(){n.close(),n=null}function m(){o(),n.emit("get_server_time")}function u(e){n.on("receive_server_time",(function(t){e(t)}))}function d(){o(),n.emit("get_monitoring_shifts")}function p(e){n.on("receive_monitoring_shifts",(function(t){var a=JSON.parse(t);console.log("Monitoring Shifts:",a),e(a)})),n.on("reconnect",(function(){n.emit("get_monitoring_shifts")}))}function b(){null!==n&&n.removeListener("receive_monitoring_shifts")}function g(){var e=Object(c.a)().user_id;o(),n.emit("get_user_notifications",e)}function f(e){n.on("receive_user_notifications",(function(t){console.log("Notifications:",t),e(t)})),n.on("reconnect",(function(){var e=Object(c.a)().user_id;n.emit("get_user_notifications",e)}))}}},[[657,1,2]]]);
//# sourceMappingURL=main.75db1842.chunk.js.map