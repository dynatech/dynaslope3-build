(this["webpackJsonpweb-ui"]=this["webpackJsonpweb-ui"]||[]).push([[0],{125:function(e,t){e.exports="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQAAgMAAAACc8MQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURcXFxf///+np6dbW1sCaIHAAAAnDSURBVHja7d0xbuw2FEBRNW7UaGtu1LDR1tiwcTNbU6NmGgcJEqQIkPx4SOq9uffuQAcg+Uj/by+LmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZ5e77+fW1/1H5+vo+BYB9/Z/f/nflcQpAafvH1/9lIAD58zEEcIDtuf9r5VuAt+7Z9v/q6xQAuf8hdkI6wHfbf613nYrpAM/9lyunAOjvf08BOMCvnYBvfBbSAba2/98eArC//70E8AA/+f59rwIgZ6B3nIboAD/8/vcRoAP8+PvfRYAOsO0vdAjAnILfaR7GA7z2/W8wD9MBni9+f/qTkA6w7S93CEDeAtNvg3SAZ4fvT70N0gG2vUuHAOQtMPU2SAd4dvr+tNsgHWDrtQKyPovgAbqtgKxrgA6w7R07BMjX1RNgPwVAr4CMawAP0PoC5LsQ0QHWzt+/FwHYKyDdGqADbN2/P9lBiAe4+gPkmobpAANWQK41gAcYsQJSrQE6wNaGADwEAD6I53wcxwOMWQGJ7kN0gHXQ96d5FMEDXKMAsoxCdIBt2PcnuQ/hAdZxAEUA8hiUZhSiAwzcA3PsgniAayRAhlEID9CGAlQBwGNQjlEIDzB2D0ywC+IB2mCAKgB4EM4wDOMBRu+B4XdBPEAbDlAFQO+B0XdBPMA6HqAIwD4Fg5+DeIA2AaAKgN4DY++CeIAZe2DoXRAP0KYAVAHAV6HY1yE8wDoHoAjAPgUDn4N4gDYJoAoggADgOSjuJIQHWGcBFAHYc1DYSQgP0KYBVAHQp2DUc1AAAeAA6zyAIgB7Dgo6CeEB2kSAKoAAAoDnoJiTEB5gnQlQBBBAAPIkHHIWFkAAOECbClAFCNfU798/BUDfhSLehvAA61yAIoAAAsTqYy7ALgD7LhTwNoQHaJMBqgACCAC+DQe8DwsgABtgmw1wCCCAAOD3kHgvIgIIAAeY/SIW7k1MAAHgANd0gFMAAQQQQADsq3i4d3EBBBBAAAEEEEAALMD074/201EBBBBAAAEEEEAAAQQQQAABBBBAAAEEEEAAAQQQQAAMgD8bFEAAAQQQQAABBKACXNMB/P8CAggggABx8v8OCyAAG8DfISKAAGwAf5eYAAKwAfydogIIAAfwd4sLIAAbYParqH9jJBqAf2eIDuDfGhNAADaAf3OUDuDfHcYD+LfH6QBzb0OnAAIIQJ6F403CAgiAB5h6GzoECNjMWbgKIIAA6Fn4FIA9CUWcgwSYOQkdAgggAHoSqgKE7GLPQQLMm4RizkECzDsHDwGC1tinoAAC4AEu9hwkwKxJKOocJMCsSegQIGyNfQoKMOkcPAVgn4NxT0EB5uyCVYCFvQueArB3wdB7oAATrkOHAKFr7FNQgAnn4CkAexcMvgcKMHwXrAIs7F3wFCB4g69DZRGAvQtWARb2LngKEL4NPQgLMHgXrAIkaEWPQQIM3QUPAVJ0kccgAUbugjn2QAHGjUJVgCQ9B62AU4AkbWPWwGMRIEsXeQwSYNR96FgEYK+BUwD2Gki1AgQYcB+qAqSq+6NIWQRgr4EqQLI29CEoQPdp+BSAvQYSrgABej6Ol1OAjGug3yz0WARAr4GcK0CAfheiugiQsw08BQnQbxtMuwUK0GkbrIsAC3kbPBYBMvdEb4ECdNgG6yJA7l58FnksAqQXAJ+BArx6EqY/AwV4TeBNvl+Anwq8zfcL8MN5uC4CvEfbD5fA4xTgPb6/wY9BOsDzhftweQhAvgq9x4MIHGD7evVZ/OsUgPsimv8spAP0+aeSiQXoAL3+rWxaATpAv38snVSADtDzd+mkFKAD9P1lSgkF6AC9f5tWOgE6QP9fp5ZMgA4w4vfppRLAA1z7gA4BKE/h+Z/I6QCDvj+PAB1g4B9YOAWADkGphiE8wNA/t1cE4J6BWU5COsDgv7ka/9/P0gG20X95O/pJiAe49uEdAnDPwPgnIR1g/BYYfBvEA0z5/sg3IjrAc5/UQwDwFhh4G8QDXPu0DgGITyHRn0XoAPO2wKDbIB7guU/tIUC0FbBP7hQAOwXFnIXoAOs+vSoA8DEs7sMYHeC539BDAOhFKOCFCA9wywqItAboAPesgEBrAA9w0wqIswboANt+W6cAyLeQaK8idIAbV0CMNYAHuO4EOARgr4AIawAPcN0LcAgAvQqHuRLjAZ77zT0EQK+A29cAHuD2FXD3GsADtPsBigA3tu4BqgKgV8C9a4AOEGIF3LkG8ABXDIBDAOZ76P0vo3iAZxSAhwDgMejOUYgOsO5hqgKgV8Bda4AOsO2BOgXA3oTuuw/hAVokgCIAeQy6ZxTCA1yxAA4ByGPQHaMQHmCNBlAFAI9Bd4xCdIBwe+DsXRAPcMUDOARA74Gzd0E6wLoHrAqA3gPn7oJ4gBYRoAjA3gNn7oJ4gCsmwCEAeg+cuQvSAYLugfN2QTzAFRXgEAC9B87bBekAYffAWbsgHuCKC3AIgN4DZ+2CdIBtD9wpAPoUnHMO4gFaZIAiAHsPnLEL4gHW2ABVAPBVaM51CA/QYgMUAdin4PhzEA+wRgeoAqD3wPG7IB0g/B44ehfEA6zxAaoA4KvQ+OsQHqDFBygCsE/BsecgHmDNAFAFQJ+CY89BPEDLAFAEYJ+CI89BPMCaA6AKgD4FR56DeICWA6AIwD4Fx52DeIA1C0AVAH0KjjsH8QAtC0ARQAAByHPQqEkID7DmAagCoOegUZMQHqDlASgCsE/BMecgHmDNBFAFEEAA8Bw0ZhLCA7RMAEUA9hw0YhLCA6y5AKoAAggAnoNGTEJ4gJYLoAjAnoP6T0ICCAAHWLMBVAHQc1D/SQgP0LIBFAEEEIA8B/WehPAAaz6AKoAAAoAn4d6zMB6g5QMoAgggAHkS7jsL4wHWjABVAAEEAE/CfWdhAQSAA7SMAEWAfu0pE4B9F+p5G8IDrDkBqgACCACehHvOwgIIAAdoOQGKAAIIQL4L9bsNCSAAHGDNClAFEEAA8F2o321IAAHgAC0rQBFAAAG4Pxz/PQHYt+Fe92EBBIADrHkBqgACCPB6H3kBPgVAv4f0ehERQAA4QMsLUAQQQADyi1inNzE6wJYZ4BRAAAHA7yF9XkQEEEAAAdAAH5kBPgVAv4j1eRMTQAABBEADtMwARQABBBBAAO7PRbr8ZEQAAdgAW26AUwABBBBAAOzPRXr8ZEQAAQQQQAABwAAfuQE+BRBAAAEEwP50vMfPxwUQQAABBBAADNByAxQBBBBAAAH+pd8AoDH47zbOd5EAAAAASUVORK5CYII="},163:function(e,t,a){e.exports=a.p+"static/media/phivolcs-dynaslope-logo.de612ba1.png"},23:function(e,t,a){"use strict";var n=a(9);t.a=function(e){var t;return{dynaslopeLogo:{height:60},phivolcsLogo:{height:70,marginTop:8},phivolcsDynaslopeLogo:{height:62},pageContentMargin:(t={margin:"0 16px"},Object(n.a)(t,e.breakpoints.up("md"),{margin:"0 64px"}),Object(n.a)(t,e.breakpoints.up("lg"),{margin:"0 100px"}),t),paperContainer:{width:"100%",overflowX:"auto"},sectionHeadContainer:{margin:"20px 0"},sectionHead:Object(n.a)({fontSize:"1.5rem"},e.breakpoints.down("xs"),{fontSize:"1.2rem"}),extended:{backgroundColor:"green"},alert0:{backgroundColor:"#EEEEEE"},alert1:{backgroundColor:"#FCEE27"},alert2:{backgroundColor:"#F8991D","& *":{color:"white !important"}},alert3:{backgroundColor:"#991B1E","& *":{color:"white !important"}}}}},398:function(e,t,a){e.exports=a.p+"static/media/login-bg-img.6bf92800.jpg"},401:function(e,t,a){"use strict";(function(e){var n=a(8),r=a(9),i=a(89),l=a(90),c=a(94),o=a(91),s=a(96),m=a(0),u=a.n(m),d=a(30),p=a(570),g=a(249),f=a(47),b=a(421),E=a(260),v=a(261),h=a(557),_=a(194),y=a(558),O=a(295),x=a(556),j=a(559),S=a(560),C=a(5),k=a(163),A=a.n(k),w=a(23),D=function(t){function a(){var e,t;Object(i.a)(this,a);for(var n=arguments.length,l=new Array(n),s=0;s<n;s++)l[s]=arguments[s];return(t=Object(c.a)(this,(e=Object(o.a)(a)).call.apply(e,[this].concat(l)))).state={open:{}},t.handleNestedList=function(e){var a=t.state.open,n="undefined"!==typeof a[e]&&a[e];t.setState((function(t){return{open:Object(r.a)({},e,!n)}}))},t}return Object(s.a)(a,t),Object(l.a)(a,[{key:"render",value:function(){var t=this,a=this.props,n=a.classes,r=a.drawerHandler,i=a.drawer,l=a.navigationLabels,c=this.state.open,o=e.browser&&/iPad|iPhone|iPod/.test(navigator.userAgent);return u.a.createElement(p.a,{open:i,onClose:r(!1),onOpen:r(!0),disableBackdropTransition:!o,disableDiscovery:o},u.a.createElement("div",{tabIndex:0,role:"button",onKeyDown:r(!1)},u.a.createElement("div",{className:n.list},u.a.createElement(g.a,{className:n.drawerHeader},u.a.createElement("img",{src:A.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(n.phivolcsDynaslopeLogo," ").concat(n.logo)}),u.a.createElement(f.a,{variant:"h5",className:n.projectTitle},"MIA 3.0"),u.a.createElement(f.a,{variant:"subtitle2",className:n.projectSubtitle},"Monitoring and Information Application")),u.a.createElement(b.a,null),u.a.createElement(E.a,{component:"nav"},u.a.createElement(v.a,{button:!0},u.a.createElement(h.a,null,u.a.createElement(x.a,null)),u.a.createElement(_.a,{primary:"Profile"}))),u.a.createElement(b.a,null),u.a.createElement(E.a,{component:"nav",subheader:u.a.createElement(y.a,{component:"div"},"Directory")},l.map((function(e){var a=e.key,i=e.main,l=e.sub;return u.a.createElement(m.Fragment,{key:a},u.a.createElement(v.a,{button:!0,onClick:function(){return t.handleNestedList(a)}},u.a.createElement(_.a,{primary:i}),c[a]?u.a.createElement(j.a,null):u.a.createElement(S.a,null)),u.a.createElement(O.a,{in:c[a],timeout:"auto",unmountOnExit:!0},u.a.createElement(E.a,{component:"div",disablePadding:!0},l.map((function(e){var t=e.label,a=e.link;return u.a.createElement(d.b,{to:a,key:t,className:n.link},u.a.createElement(v.a,{button:!0,className:n.nested,onClick:r(!1)},u.a.createElement(_.a,{primaryTypographyProps:{className:n.nestedText},primary:t})))})))))}))))))}}]),a}(m.Component);t.a=Object(C.a)((function(e){return Object(n.a)({},Object(w.a)(e),{},function(e){return{list:{width:300,maxWidth:360},nested:{paddingLeft:e.spacing(3)},nestedText:{fontSize:"0.9rem"},drawerHeader:{height:160,display:"block",alignItems:"center",textAlign:"center",padding:16},logo:{height:105},titleBlock:{display:"block",margin:"0 4px"},projectTitle:{fontWeight:600},link:{textDecoration:"none"}}}(e))}),{withTheme:!0})(D)}).call(this,a(185))},406:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-head.ff13773e.png"},407:function(e,t,a){e.exports=a.p+"static/media/phivolcs-letter-footer.fc7bb5bf.png"},427:function(e,t,a){e.exports=a(546)},432:function(e,t,a){},491:function(e,t){},546:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(18),l=a.n(i),c=(a(432),a(31)),o=a(2),s=a(9),m=a(30),u=a(126),d=a(5),p=a(8),g=a(127),f=a(578),b=a(239),E=a(298),v=a(577),h=a(99),_=a(292),y=a(259),O=a(47),x=a(60),j=a(580),S=a(17),C=a.n(S),k="http://dynaslope.phivolcs.dost.gov.ph:5000";function A(e,t){var a="".concat(k,"/api/refresh_session");C.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}function w(e){var t=JSON.parse(localStorage.getItem("data"));if(null!==t){var a=t.tokens,n=a.access_token,r=a.refresh_token;!function(e,t){var a="".concat(k,"/api/check_session");C.a.get(a,{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}(n,(function(a){var n=a.is_logged_in;n&&A(r,(function(e){t.tokens.access_token=e.access_token,localStorage.setItem("data",JSON.stringify(t))})),e(n)}))}else e(!1)}function D(){var e=JSON.parse(localStorage.getItem("data"));A(e.tokens.refresh_token,(function(t){e.tokens.access_token=t.access_token,localStorage.setItem("data",JSON.stringify(e))}))}function M(e,t,a){!function(e,t){var a="".concat(k,"/api/login");C.a.post(a,e).then((function(e){var a=e.data;console.log(a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var n=e.ok,r=e.message,i=e.data;n?(localStorage.setItem("data",JSON.stringify(i)),t(i)):a(r)}))}function I(){return JSON.parse(localStorage.getItem("data")).user}var N=a(163),T=a.n(N),H=a(398),R=a.n(H);function Y(){return r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",r.a.createElement(v.a,{color:"inherit",href:"https://material-ui.com/"},"Project Dynaslope")," ",(new Date).getFullYear(),".")}var B=Object(x.a)((function(e){var t,a;return{root:{height:"100vh"},image:{backgroundImage:"url(".concat(R.a,")"),backgroundSize:"cover",backgroundPosition:"center"},paperContainer:{display:"flex",alignItems:"center",justifyContent:"center"},paper:Object(s.a)({margin:e.spacing(0,4),display:"flex",flexDirection:"column",alignItems:"center",paddingBottom:e.spacing(5)},e.breakpoints.up("lg"),{paddingBottom:e.spacing(9)}),phivolcsDynaslopeLogo:(t={margin:e.spacing(1),height:200},Object(s.a)(t,e.breakpoints.between("sm","md"),{height:164}),Object(s.a)(t,e.breakpoints.only("xs"),{height:140}),t),form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},title:(a={margin:e.spacing(2,0)},Object(s.a)(a,e.breakpoints.down("sm"),{fontSize:"1.25rem"}),Object(s.a)(a,e.breakpoints.only("xs"),{margin:e.spacing(0,0)}),a),passwordField:Object(s.a)({margin:e.spacing(0,0,3,0)},e.breakpoints.only("xs"),{margin:e.spacing(0,0,1,0)}),buttonChild:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"}}}));function L(e){var t=B(),a=Object(n.useState)({username:"",password:""}),i=Object(o.a)(a,2),l=i[0],c=i[1],m=Object(n.useState)({username:!1,password:!1}),u=Object(o.a)(m,2),d=u[0],v=u[1],x=Object(n.useState)(""),S=Object(o.a)(x,2),C=S[0],k=S[1],A=Object(n.useState)(!1),w=Object(o.a)(A,2),D=w[0],I=w[1],N=e.history,H=e.onLogin,R=function(){Object.entries(l).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];""===n&&G(a,n)})),Object.values(d).includes(!0)?k("Fill up all required fields"):(I(!0),M(l,(function(){I(!1),H(),N.push("/")}),(function(e){I(!1),k(e)})))},L=l.username,P=l.password,F=function(e){return function(t){var a=t.target.value;c(Object(p.a)({},l,Object(s.a)({},e,a))),k(""),G(e,a)}},z=function(e){return function(t){G(e,l[e])}},G=function(e,t){v(Object(p.a)({},d,Object(s.a)({},e,""===t)))};return r.a.createElement(y.a,{container:!0,component:"main",className:t.root},r.a.createElement(f.a,null),r.a.createElement(y.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),r.a.createElement(y.a,{item:!0,xs:12,sm:8,md:5,component:h.a,elevation:6,square:!0,className:t.paperContainer},r.a.createElement("div",{className:t.paper},r.a.createElement("img",{src:T.a,alt:"PHIVOLCS-Dynaslope Logo",className:t.phivolcsDynaslopeLogo}),r.a.createElement(O.a,{component:"h1",variant:"h5",align:"center",className:t.title},r.a.createElement("strong",null,"MONITORING AND INFORMATION APPLICATION (MIA 3.0)")),r.a.createElement("div",{className:t.form},r.a.createElement(b.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:L,onChange:F("username"),onFocus:z("username"),error:d.username}),r.a.createElement(b.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:P,onChange:F("password"),onKeyPress:function(e){"Enter"===e.key&&R()},onFocus:z("password"),error:d.password,className:t.passwordField}),""!==C&&r.a.createElement(E.a,{error:!0,focused:!0},C),r.a.createElement(g.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:R,disabled:D},D?r.a.createElement("div",{className:t.buttonChild},r.a.createElement("span",{style:{marginRight:6}},"Signing In... "),r.a.createElement(j.a,{color:"secondary",size:20})):r.a.createElement("span",null,"Sign In")),r.a.createElement(_.a,{mt:5},r.a.createElement(Y,null))))))}var P=a(581),F=a(249);var z=Object(d.a)((function(e){var t;return{footer:(t={display:"flex",padding:"2% 0",flexDirection:"column",marginTop:40,justifyContent:"center",alignItems:"center",textAlign:"center"},Object(s.a)(t,e.breakpoints.down("sm"),{marginTop:30}),Object(s.a)(t,"zIndex",0),t),footerText:Object(s.a)({fontSize:"0.5rem"},e.breakpoints.up("sm"),{fontSize:"0.85rem"})}}))((function(e){var t=e.classes;return r.a.createElement(P.a,{position:"static",className:t.footer},r.a.createElement(F.a,null,r.a.createElement(O.a,{variant:"subtitle2",color:"inherit",className:t.footerText},"4F PHIVOLCS Building, C. P. Garcia Avenue, UP Campus, Diliman, Quezon City 1101 ",r.a.createElement("br",null),"Tel. no. (02) 8426-1468 loc. 401 & 403 | dynaslope.phivolcs@gmail.com ",r.a.createElement("br",null),"www.facebook.com/dynaslopecommunity")))})),G=a(171),U=a(400),W=a(361),q=a(582),V=a(556),Q=a(23);var Z,K=Object(d.a)((function(e){return Object(p.a)({},Object(Q.a)(e),{},function(e){return{root:{width:"100%"},grow:{flexGrow:1},menuButton:Object(s.a)({display:"flex",marginLeft:-12,marginRight:0},e.breakpoints.up("md"),{display:"none"}),projectTitle:{display:"block",fontWeight:900},titleBlock:{display:"block",margin:"0 4px",alignItems:"center",textAlign:"center",justifyContent:"center"},projectSubtitle:Object(s.a)({display:"none",fontSize:"0.7rem",marginTop:-3},e.breakpoints.up("md"),{display:"block"}),logo:Object(s.a)({marginRight:12},e.breakpoints.down("sm"),{marginRight:0}),sectionDesktop:Object(s.a)({display:"none"},e.breakpoints.up("md"),{display:"flex",padding:"4px 0"}),list:{width:250},menu:{marginTop:40}}}(e))}),{withTheme:!0})((function(e){var t=e.classes,a=e.drawerHandler,i=e.history,l=e.onLogout,c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],u=s[1],d=function(){u(null)},p=I().first_name;return r.a.createElement("div",{className:t.root},r.a.createElement(P.a,{position:"fixed",color:"primary"},r.a.createElement(F.a,null,r.a.createElement(G.a,{onClick:a(!0),className:t.menuButton,color:"inherit","aria-label":"Open drawer"},r.a.createElement(q.a,null)),r.a.createElement("img",{src:T.a,alt:"PHIVOLCS-Dynaslope Logo",className:"".concat(t.phivolcsDynaslopeLogo," ").concat(t.logo," ").concat(t.sectionDesktop)}),r.a.createElement("div",{className:t.titleBlock},r.a.createElement(O.a,{className:t.projectTitle,variant:"h4",color:"inherit",noWrap:!0},"MIA 3.0"),r.a.createElement(O.a,{variant:"caption",className:t.projectSubtitle,color:"inherit"},"Monitoring and Information Application")),r.a.createElement("div",{className:t.grow}),r.a.createElement("div",{className:t.sectionDesktop},r.a.createElement(g.a,{"aria-owns":"menu-list-grow","aria-haspopup":"true",onClick:function(e){u(e.currentTarget)},color:"inherit",startIcon:r.a.createElement(V.a,null)},r.a.createElement("strong",null,p))))),r.a.createElement(U.a,{id:"simple-menu",anchorEl:m,keepMounted:!0,open:Boolean(m),onClose:d,className:t.menu},r.a.createElement(W.a,{disabled:!0,onClick:d},"Profile",r.a.createElement(O.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")),r.a.createElement(W.a,{onClick:function(){var e;e=function(){l(),i.push("/login")},localStorage.clear(),e()}},"Logout")))})),J=a(568),X=a(422),$=a(562),ee=a(193),te=a(550),ae=a(555),ne=a(11),re=a.n(ne),ie=a(155),le=a(401),ce=a(164),oe=a.n(ce);function se(){"undefined"!==typeof Z&&null!==Z||(Z=oe()("".concat(k,"/misc"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]})),Z.emit("get_server_time")}var me=Object(x.a)((function(e){return{navBar:Object(s.a)({display:"none"},e.breakpoints.up("md"),{display:"block"}),appBar:{top:70},popper:{zIndex:500,marginTop:2},list:{width:250},link:{textDecoration:"none",color:"blue"}}})),ue=[{key:"monitoring",main:"Monitoring",sub:[{label:"Dashboard",link:"/"},{label:"Events Table",link:"/monitoring/events"},{label:"Shifts and Reports",link:"/monitoring/shifts_and_reports"},{label:"Issues and Reminders",link:"/monitoring/issues_and_reminders"},{label:"Site Logs",link:"/monitoring/logs"},{label:"Quality Assurance",link:"/monitoring/qa",soon:!0}]},{key:"analysis",main:"Analysis",sub:[{label:"Site Data Analytics",link:"/analysis/sites"},{label:"Communications Analytics",link:"/analysis/communications",soon:!0},{label:"Monitoring Alerts Analytics",link:"/analysis/alerts",soon:!0}]},{key:"communication",main:"Communication",sub:[{label:"Chatterbox",link:"/communication/chatterbox"},{label:"Contacts",link:"/communication/contacts"},{label:"Mailbox",link:"/communication/mailbox"}]},{key:"community",main:"Community",sub:[{label:"Site Information",link:"/community/site_info"},{label:"Stakeholders' Concerns",link:"/community/concerns",soon:!0},{label:"Community Feedback",link:"/community/feedback",soon:!0}]},{key:"knowledge",main:"Knowledge Management",sub:[{label:"Protocols",link:"/knowlegde/protocols",soon:!0},{label:"Papers",link:"/knowledge/papers",soon:!0}]}];var de=r.a.memo(Object(ie.a)()((function(e){var t=e.width,a=e.drawerHandler,i=e.drawer,l=me(),c=window.location.pathname.split("/")[1],s=ue.findIndex((function(e){return e.key===c})),u=Object(n.useState)(-1===s?0:s),d=Object(o.a)(u,2),p=d[0],g=d[1],f=Object(n.useState)(null),b=Object(o.a)(f,2),E=b[0],v=b[1],_=Object(n.useState)(null),x=Object(o.a)(_,2),j=x[0],S=x[1],C=Object(n.useState)(!1),k=Object(o.a)(C,2),A=k[0],w=k[1],D=Object(n.useState)(null),M=Object(o.a)(D,2),I=M[0],N=M[1],T=Object(n.useState)("Loading server time..."),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=ue[p===E&&null!==j?j:p].sub;Object(n.useEffect)((function(){S(p)}),[p]),Object(n.useEffect)((function(){var e;se(),e=function(e){var t=re()(e).format("ddd DD-MMM-YYYY HH:mm:ss");Y(t)},Z.on("receive_server_time",(function(t){e(t)}))}),[]);var L=function(e){var t=p;w(!0),N(e.currentTarget),v(t)},F=function(e){I.contains(e.target)||(w(!1),setTimeout((function(){return g(E)}),100))},z=function(e){w(!1)};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:l.navBar},r.a.createElement(P.a,{position:"fixed",color:"default",className:l.appBar},r.a.createElement(y.a,{container:!0,spacing:0,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(J.a,{value:p,onChange:function(e,t){g(t)},indicatorColor:"primary",textColor:"primary",variant:Object(ie.c)("md",t)?"standard":"scrollable",scrollButtons:"on",centered:Object(ie.c)("md",t)},ue.map((function(e){var t=e.main,a=e.key;return r.a.createElement(X.a,{key:a,label:t,"aria-owns":A?"monitoring-menu":null,"aria-haspopup":"true",onClick:L})})))),r.a.createElement(y.a,{item:!0,xs:2,align:"center"},r.a.createElement(O.a,{variant:"button"},R))))),r.a.createElement($.a,{className:l.popper,open:A,anchorEl:I,transition:!0,disablePortal:!0},(function(e){var t=e.TransitionProps,a=e.placement;return r.a.createElement(ee.a,Object.assign({},t,{id:"monitoring-menu",style:{transformOrigin:"bottom"===a?"center top":"center bottom"}}),r.a.createElement(h.a,null,r.a.createElement(te.a,{onClickAway:F},r.a.createElement(ae.a,null,B.map((function(e){var t=e.label,a=e.link,n="undefined"!==typeof e.soon;return n?r.a.createElement(W.a,{key:t,onClick:z,disabled:n},t,n&&r.a.createElement(O.a,{component:"span",variant:"overline",style:{paddingLeft:4}},"SOON")):r.a.createElement(m.b,{to:a,key:t,className:l.link},r.a.createElement(W.a,{onClick:z},t))}))))))})),r.a.createElement(le.a,{drawer:i,drawerHandler:a,navigationLabels:ue}))}))),pe=a(95),ge=a(617),fe=a(618);var be=Object(d.a)((function(e){return{pageTitleContainer:Object(s.a)({margin:"24px 0 18px"},e.breakpoints.down("sm"),{margin:"10px 0 10px"}),pageTitle:{fontSize:"0.85rem"},hasCustomButtons:{display:"flex",alignItems:"baseline",justifyContent:"space-between",paddingTop:12,paddingBottom:12}}}))((function(e){var t=e.title,a=e.classes,n=e.customButtons,i=void 0!==n&&n,l=a.pageTitleContainer;return i&&(l+=" ".concat(a.hasCustomButtons)),r.a.createElement("div",{className:l},r.a.createElement(O.a,{variant:"overline",className:a.pageTitle},t),n)})),Ee=a(579),ve=function(e){e.preventDefault()};function he(e){return r.a.createElement(X.a,Object.assign({component:"a",onClick:ve},e))}var _e,ye=Object(d.a)((function(e){return{root:{flexGrow:1}}}))((function(e){var t=e.chosenTab,a=e.onSelect,n=e.tabsArray,i=e.classes;return r.a.createElement(Ee.a,null,r.a.createElement(P.a,{position:"static",color:"default",className:i.root},r.a.createElement(J.a,{variant:"fullWidth",value:t,onChange:function(e,t){a(t)}},n.map((function(e){var t=e.label,a=e.href;return r.a.createElement(he,{label:t,href:a,key:a})})))))})),Oe=a(421),xe=a(58),je=a(664),Se=a(594),Ce=a(593),ke=a(596),Ae=a(597),we=a(598),De=a(599),Me=a(600),Ie=a(595),Ne=a(563),Te=a(583),He=a(564),Re=a(584),Ye=a(296),Be=a(375),Le=a(376),Pe=a(660),Fe=a(565),ze=a(585);function Ge(){"undefined"!==typeof _e&&null!==_e||(_e=oe()("".concat(k,"/monitoring"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function Ue(e){Ge(),_e.on("reconnecting",(function(){e(!0)})),_e.on("reconnect",(function(){e(!1)})),_e.on("reconnect_failed",(function(){console.log("failed")}))}function We(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Ge(),console.log("Payload: { key: data }",e,t);var a={data:t,key:e};_e.send(a)}function qe(){_e.close(),_e=null}function Ve(e){Ge(),_e.on("receive_alerts_from_db",(function(t){var a=JSON.parse(t);console.log("Alerts from DB: ",a),e(a)}))}var Qe=Object(ze.a)()((function(e){var t=e.isShowing,a=e.hide,i=e.data,c=e.isValidating,s=i.site,m=i.trigger_id,u=i.ts_updated,d=Object(n.useState)(""),p=Object(o.a)(d,2),f=p[0],E=p[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],O=I();O.user_id;function x(){a(),E(""),y("")}var j=""===f;return t?l.a.createPortal(r.a.createElement(n.Fragment,null,r.a.createElement(Ne.a,{open:!0,onClose:x,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Validate Trigger"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Select whether trigger is valid or invalid. Also, provide remarks."),r.a.createElement(Ye.a,{component:"fieldset",style:{display:"flex"}},r.a.createElement(Be.a,{"aria-label":"trigger_validity",name:"trig_validity_1",row:!0,style:{justifyContent:"space-around"},value:f,onChange:function(e){var t=Number.parseInt(e.target.value,10);E(t)}},r.a.createElement(Le.a,{value:1,control:r.a.createElement(Pe.a,null),label:"Valid"}),!c&&r.a.createElement(Le.a,{value:0,control:r.a.createElement(Pe.a,null),label:"Validating"}),r.a.createElement(Le.a,{value:-1,control:r.a.createElement(Pe.a,null),label:"Invalid"}))),r.a.createElement(b.a,{autoFocus:!0,margin:"dense",id:"remarks",label:"Remarks",onChange:function(e){y(e.target.value)},value:_,fullWidth:!0})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:x,color:"primary"},"Cancel"),r.a.createElement(g.a,{onClick:function(e){!function(e,t,a,n,r,i){We("validate_trigger",{site_code:e,alert_status:n,trigger_id:t,trigger_ts:a,remarks:r,user_id:i})}(s,m,u,f,_,O.user_id),a(),E(""),y("")},color:"primary",disabled:j},"Confirm")))),document.body):null})),Ze=function(){var e=Object(n.useState)(!1),t=Object(o.a)(e,2),a=t[0],r=t[1];return{isShowing:a,toggle:function(){r(!a)}}},Ke=a(16),Je=a(172),Xe=a.n(Je),$e=a(406),et=a.n($e),tt=a(407),at=a.n(tt);function nt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"end",n=e.purok,r=e.sitio,i=e.barangay,l=e.municipality,c=e.province,o=e.site_code,s="";if(null!==r&&(s="Sitio ".concat(r,", ")),null!==n&&(s+="Purok ".concat(n,", ")),s+="Brgy. ".concat(i,", ").concat(l,", ").concat(c),t){var m=o.toUpperCase();"end"===a?s+=" (".concat(m,")"):s="".concat(m," (").concat(s,")")}return s}function rt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};if(t){var n=e.split(" "),r=n.map((function(e){return a(e)}));return r.join(" ")}return a(e)}function it(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=null,n=e.map((function(e){var n=e.site,r=e.org_name;return a=r.toUpperCase(),t?n:n.site_code.toUpperCase()}));return t?{sites:n,org:a}:(a&&n.unshift(a),n)}function lt(e){return"0"===e[0]||e.match(/[a-z]/i)?e:"+".concat(e)}function ct(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"days",n="YYYY-MM-DD HH:mm:ss",r=e.subtract(t,a).format(n);return r}function ot(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;C.a.post(e,t).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e),null!==n&&n(e)}))}function st(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;C.a.get(e).then((function(e){var a=e.data;null!==t&&t(a)})).catch((function(e){console.log(e)}))}function mt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.offsetHeight,n=getComputedStyle(e),r=n.marginBottom,i=n.marginTop,l=parseFloat(r)+parseFloat(i);return t?l:a+l}function ut(e){var t=e.classes;return r.a.createElement("div",{id:"letter-head",className:t.letterHeadContainer},r.a.createElement("img",{src:et.a,alt:"PHIVOLCS Letter Head",className:t.phivolcsLetterHead}))}function dt(e){var t=e.classes;return r.a.createElement("div",{id:"letter-foot",className:"".concat(t.letterHeadContainer," ").concat(t.letterFooterContainer)},r.a.createElement("img",{src:at.a,alt:"PHIVOLCS Letter Footer",className:t.phivolcsLetterHead}))}function pt(e){var t=e.classes,a=e.bulletinDetail,i=e.isMD,l=a.bulletin_control_code,c=a.site_address,o=a.data_ts,s=a.alert_description_group,m=a.recommended_response;return r.a.createElement(n.Fragment,null,r.a.createElement(O.a,{variant:"body2",align:"center",className:t.title},r.a.createElement("strong",null,"DYNASLOPE LANDSLIDE ALERT LEVEL INFORMATION: ",l)),r.a.createElement(O.a,{variant:"body2",component:"div",className:t.mainInfo},r.a.createElement(y.a,{container:!0,spacing:i?2:1},r.a.createElement(y.a,{item:!0,xs:4},"Location:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,c)),r.a.createElement(y.a,{item:!0,xs:4},"Date/Time:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,o)),r.a.createElement(y.a,{item:!0,xs:4},"Alert Level Released:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,s)),r.a.createElement(y.a,{item:!0,xs:4},"Recommended Response:"),r.a.createElement(y.a,{item:!0,xs:8},r.a.createElement("strong",null,m)))))}var gt=Object(ie.a)()((function(e){var t=e.releaseId,a=e.width,i=function(e){return Object(x.a)((function(t){var a,n,r,i,l,c,o,m,u,d,p,g,f,b,E,v,h;"undefined"===typeof e?a={letterHeadContainer:(n={width:"inherit",height:"auto",boxSizing:"border-box",padding:"28px 44px"},Object(s.a)(n,t.breakpoints.only("md"),{padding:"58.3324px 91.6652px"}),Object(s.a)(n,t.breakpoints.up("lg"),{padding:"116.6648px 183.3304px"}),n),letterFooterContainer:(r={paddingTop:0,marginTop:16},Object(s.a)(r,t.breakpoints.only("md"),{marginTop:"33.3328px"}),Object(s.a)(r,t.breakpoints.up("lg"),{marginTop:"66.6656px"}),r),phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:(i={padding:"0 44px",height:629,maxHeight:629,overflowY:"hidden"},Object(s.a)(i,t.breakpoints.only("md"),{padding:"0 91.6652px",height:1310.3957,maxHeight:1310.3957}),Object(s.a)(i,t.breakpoints.up("lg"),{padding:"0 183.3304px",height:2620.7914,maxHeight:2620.7914}),i),title:(l={marginBottom:16,fontSize:"0.8rem"},Object(s.a)(l,t.breakpoints.only("md"),{marginBottom:33.3328,fontSize:"1.6664rem"}),Object(s.a)(l,t.breakpoints.up("lg"),{marginBottom:66.6656,fontSize:"3.47111rem"}),l),mainInfo:(c={border:"0.5px solid black",padding:"8px 12px",fontSize:"0.65rem",letterSpacing:0,marginBottom:12},Object(s.a)(c,t.breakpoints.only("md"),{padding:"16.6664px 24.9996px",fontSize:"1.354145rem",marginBottom:24.9996}),Object(s.a)(c,t.breakpoints.up("lg"),{padding:"33.3328px 49.9992px",fontSize:"2.70829rem",marginBottom:49.9992}),c),sectionHeader:(o={fontSize:"0.7rem"},Object(s.a)(o,t.breakpoints.only("md"),{fontSize:"1.45831rem"}),Object(s.a)(o,t.breakpoints.up("lg"),{fontSize:"2.91662rem"}),o),sectionDetails:(m={fontSize:"0.65rem"},Object(s.a)(m,t.breakpoints.only("md"),{fontSize:"1.354145rem"}),Object(s.a)(m,t.breakpoints.up("lg"),{fontSize:"2.70829rem"}),m),indent:(u={marginLeft:24},Object(s.a)(u,t.breakpoints.only("md"),{marginLeft:49.9992}),Object(s.a)(u,t.breakpoints.up("lg"),{marginLeft:99.9984}),u),divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}}:a={letterHeadContainer:(d={width:"inherit",height:"auto",boxSizing:"border-box",padding:"7px 11px"},Object(s.a)(d,t.breakpoints.only("md"),{padding:"20px 22.9163px"}),Object(s.a)(d,t.breakpoints.up("lg"),{padding:"29.1662px 45.8326px"}),d),letterFooterContainer:(p={paddingTop:0,marginTop:16},Object(s.a)(p,t.breakpoints.only("md"),{marginTop:"8.3332px"}),Object(s.a)(p,t.breakpoints.up("lg"),{marginTop:"16.6664px"}),p),phivolcsLetterHead:{maxWidth:"100%",maxHeight:"100%",height:"auto"},body:(g={overflowY:"hidden",padding:"0 11px",height:"100%",maxHeight:"100%"},Object(s.a)(g,t.breakpoints.only("md"),{padding:"0 22.9163px",height:"100%",maxHeight:"100%"}),Object(s.a)(g,t.breakpoints.up("lg"),{padding:"0 45.8326px",height:"100%",maxHeight:"100%"}),g),title:(f={marginBottom:4,fontSize:"0.65625rem"},Object(s.a)(f,t.breakpoints.only("md"),{marginBottom:16,fontSize:"1.45rem"}),Object(s.a)(f,t.breakpoints.up("lg"),{marginBottom:33.3328,fontSize:"1.367163rem"}),f),mainInfo:(b={border:"0.5px solid black",letterSpacing:0,padding:"2px 3px",fontSize:"0.4875rem",marginBottom:3},Object(s.a)(b,t.breakpoints.only("md"),{padding:"10px 16px",fontSize:"1rem",marginBottom:12}),Object(s.a)(b,t.breakpoints.up("lg"),{padding:"8.3332px 12.4998px",fontSize:"1.01560875rem",marginBottom:12.4998}),b),sectionHeader:(E={fontSize:"0.525rem"},Object(s.a)(E,t.breakpoints.only("md"),{fontSize:"1.2rem"}),Object(s.a)(E,t.breakpoints.up("lg"),{fontSize:"1.0937325rem"}),E),sectionDetails:(v={fontSize:"0.4875rem"},Object(s.a)(v,t.breakpoints.only("md"),{fontSize:"1rem"}),Object(s.a)(v,t.breakpoints.up("lg"),{fontSize:"1.01560875rem"}),v),indent:(h={marginLeft:6},Object(s.a)(h,t.breakpoints.only("md"),{marginLeft:12.4998}),Object(s.a)(h,t.breakpoints.up("lg"),{marginLeft:24.9996}),h),divider:{margin:"12px 0px 2px"},releaseDetailsArea:{display:"flex",justifyContent:"space-between"}};return a}))}(t)(),l=Object(n.useState)([]),c=Object(o.a)(l,2),m=c[0],u=c[1],d=Object(n.useState)(!1),g=Object(o.a)(d,2),f=g[0],b=g[1],E=Object(n.useState)(!1),v=Object(o.a)(E,2),h=v[0],_=v[1],S=Object(n.useRef)(null),A=Object(n.useState)({site:{},alert_level:0,bulletin_control_code:"",site_address:"",alert_description_group:"",recommended_response:"",community_response:"",lewc_lgu_response:"",households_at_risk:"",has_ground_trigger:!1,ground_movement_details:"",prepared_triggers:[],no_data_triggers:[],publishers:"",next_ewi_release_ts:""}),w=Object(o.a)(A,2),D=w[0],M=w[1],I=D.alert_level,N=D.community_response,T=D.households_at_risk,H=D.lewc_lgu_response,R=D.prepared_triggers,Y=D.has_ground_trigger,B=D.site.barangay,L=D.no_data_triggers,P=D.publishers,F=D.next_ewi_release_ts,z=D.ground_movement_details,G=Object(ie.c)("md",a);Object(n.useEffect)((function(){var a=t;"undefined"===typeof t&&(a=e.match.params.release_id);!function(e,t){var a="".concat(k,"/api/monitoring/create_bulletin/").concat(e);C.a.get(a).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}(a,(function(e){var t=nt(e.site,!1),a=Object(p.a)({},e,{site_address:t});b(!0),M(a)}))}),[]),Object(n.useEffect)((function(){if(null!==S.current){var e=S.current,t=Array.from(e.children),a=0;t.forEach((function(e,t){if("subcontent"!==e.id)a+=mt(e);else{a+=mt(e,!0);var n=Array.from(e.children),r=[];n.forEach((function(e){var t=mt(e);a+t<1310.3957?a+=t:(a+=t,r.push(e),e.setAttribute("style","display: none"))})),u(r)}})),""!==D.site_address&&_(!0)}}),[D,S]);var U=!1;return r.a.createElement(n.Fragment,null,f?r.a.createElement(n.Fragment,null,r.a.createElement("div",{id:"bulletin-root",className:i.root},r.a.createElement(ut,{classes:i}),r.a.createElement("div",{id:"bulletin-content",className:i.body,ref:S},r.a.createElement(pt,{classes:i,bulletinDetail:D,isMD:G}),r.a.createElement(y.a,{container:!0,spacing:G?2:1,id:"subcontent"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"AREA SITUATION"),":"))),R.map((function(e,t,a){var l=e.is_ground,c=e.trigger_source,o="";!U&&l&&(o=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),U=!0);var s=!1;0===t?s=!0:a[t-1].trigger_source!==c&&(s=!0);var m="";if(s){var u=c.toUpperCase();m=r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(i.sectionHeader," ").concat(l?i.indent:"")},r.a.createElement("strong",null,l?r.a.createElement("u",null,r.a.createElement("i",null,u)):u)))}var d="";return L.includes(c)&&(!s&&l||!l)&&(d=r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:"0 !important"}},r.a.createElement(O.a,{variant:"body2",className:"".concat(i.sectionDetails," ").concat(i.indent)},"Currently, no data available."))),r.a.createElement(n.Fragment,{key:"key-".concat(t+1)},o,m,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(i.sectionDetails," ").concat(i.indent),dangerouslySetInnerHTML:{__html:e.description}})),d)})),(!Y||0===I)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionHeader},r.a.createElement("strong",null,"GROUND MOVEMENT"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(i.sectionDetails," ").concat(i.indent)},z))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionHeader},r.a.createElement("strong",null,"ELEMENTS AT RISK"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:"".concat(i.sectionDetails," ").concat(i.indent)},T)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionHeader},r.a.createElement("strong",null,r.a.createElement("u",null,"OTHER RECOMMENDATIONS"),":"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionDetails},r.a.createElement("strong",null,"For the Landslide Early Warning Committee (LEWC):")," ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:H}}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionDetails},r.a.createElement("strong",null,"For the Community:")," ",N)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",className:i.sectionDetails},r.a.createElement("strong",null,"NOTE:")," This bulletin contains the official Alert Level and Recommended Response of the Dynaslope Project for Brgy. ",B," and will hold true until a new bulletin is released.")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{className:i.divider})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{component:"div",variant:"body2",className:"".concat(i.sectionDetails," ").concat(i.releaseDetailsArea)},0===I?r.a.createElement("span",null):r.a.createElement("span",null,"Next bulletin on: ",r.a.createElement("strong",null,F)),r.a.createElement("span",null,"Released by: ",r.a.createElement("strong",null,P)))))),r.a.createElement(dt,{classes:i})),m.length>0&&r.a.createElement("div",{id:"bulletin-root-2",className:i.root},r.a.createElement(ut,{classes:i}),r.a.createElement("div",{id:"bulletin-content",className:i.body,ref:S},r.a.createElement(pt,{classes:i,bulletinDetail:D,isMD:G}),r.a.createElement(y.a,{container:!0,spacing:G?2:1,id:"excess-content"},m.map((function(e,t){return r.a.createElement(y.a,{key:"key-".concat(t+1),item:!0,xs:12,dangerouslySetInnerHTML:{__html:e.innerHTML}})})))),r.a.createElement(dt,{classes:i})),h&&r.a.createElement("div",{id:"is-loaded"})):r.a.createElement(y.a,{item:!0,style:{textAlign:"center"}},r.a.createElement(j.a,{size:50}),r.a.createElement(O.a,null,"Loading Bulletin")))}));var ft=Object(ze.a)()((function(e){var t=e.classes,a=e.fullScreen,i=e.isOpenBulletinModal,l=e.setIsOpenBulletinModal,s=e.releaseDetail,m=s.release_id,u=s.site_code,d=s.site_id,f=s.type,E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],_=v[1],O=Object(n.useState)([]),x=Object(o.a)(O,2),j=x[0],S=x[1],C=Object(n.useState)(""),A=Object(o.a)(C,2),w=A[0],D=A[1],M=Object(n.useState)(""),I=Object(o.a)(M,2),N=I[0],T=I[1],H=Object(n.useState)(!1),R=Object(o.a)(H,2),Y=R[0],B=(R[1],Object(n.useState)({})),L=Object(o.a)(B,2),P=L[0],F=L[1],z=Object(c.useSnackbar)(),G=z.enqueueSnackbar,U=z.closeSnackbar,W=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){U(e)}},"Dismiss")};Object(n.useEffect)((function(){"undefined"!==typeof m&&i&&function(e,t){st("".concat(k,"/api/bulletin_email/get_bulletin_email_details/").concat(e),t)}(m,(function(e){var t=e.subject,a=e.recipients,n=e.mail_body,r=e.file_name,i=e.narrative_details;F(i),S(a),_(t),D(n),T(r)}))}),[i]);var q,V=function(){l(!1),F({}),S([]),_(""),D(""),T("")},Q="";return"undefined"!==typeof u&&(Q=u.toUpperCase()),r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:a,open:i,"aria-labelledby":"form-dialog-title",maxWidth:"md"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Early Warning Bulletin for ",Q),r.a.createElement(He.a,null,r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Mail Content",value:w,onChange:function(e){D(e.target.value)},placeholder:"Add mail content",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Xe.a,{label:"To",value:j,onAdd:function(e){return function(e){var t=j;t.push(e),S(Object(Ke.a)(t))}(e)},onDelete:function(e,t){return function(e,t){j.splice(j.indexOf(e),1),S(Object(Ke.a)(j))}(e)},fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(gt,{releaseId:m})))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:(q=m,function(){!function(e,t){st("".concat(k,"/api/bulletin/download_bulletin/").concat(e),t)}(q,(function(e){console.log("LOG bulletin_download",e)}))}),color:"primary"},"Download"),r.a.createElement(g.a,{color:"secondary",onClick:function(){var e={subject:h,recipients:j,mail_body:w,release_id:m,file_name:N},t=G("Sending EWI bulletin...",{variant:"warning",persist:!0});V(),function(e,t,a){ot("".concat(k,"/api/mailbox/send_email"),e,t,a)}(e,(function(e){console.log("sent bulletin email...",e);var a,n,r=e.status,i=e.message;if(U(t),r)if(G(i,{variant:"success",autoHideDuration:7e3,action:W}),We("update_db_alert_ewi_sent_status",{alert_db_group:f,site_id:d,ewi_group:"bulletin"}),"object"===typeof P){var l=function(e){var t="",a=e.length,n=0;return e.forEach((function(e){console.log("%d: %s",n,e);var r="";switch(e){case"rusolidum@phivolcs.dost.gov.ph":r="RUS";break;case"asdaag48@gmail.com":r="ASD";break;default:r=e}t+=r,a!==n+1&&(t+=", "),n+=1})),t}(j),c=Object(p.a)({},P,{narrative:"".concat(P.narrative," ").concat(l),timestamp:re()().format("YYYY-MM-DD HH:mm:ss")});a=c,n=function(e){console.log("NARRATIVE WRITTEN!")},ot("".concat(k,"/api/narratives/write_narratives_to_db"),a,n)}else console.log("NO NARRATIVE WRITTEN: TEST ONLY");else G(i,{variant:"error",autoHideDuration:7e3,action:W})}),(function(){U(t),G("Send bulletin failed. Ask the devs.",{variant:"error",autoHideDuration:7e3,action:W})}))},disabled:!1},Y?"Sent already (Send again?)":"Send"),r.a.createElement(g.a,{onClick:V,color:"primary"},"Cancel")))}));function bt(e,t){ot("".concat(k,"/api/end_of_shift/save_eos_data_analysis"),e,t)}var Et=a(592),vt=a(591),ht=a(587),_t=a(588),yt=a(380),Ot=a(394),xt=a(48),jt=a(40),St=a(586);function Ct(e,t,a){var n="".concat(k,"/api/chatterbox/send_message");C.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}var kt=a(293),At=a(420),wt=Object(n.forwardRef)((function(e,t){return r.a.createElement(kt.a,Object.assign({direction:"up"},e,{ref:t}))})),Dt=Object(n.forwardRef)((function(e,t){return r.a.createElement(At.a,Object.assign({},e,{ref:t}))})),Mt=a(168),It=a(417),Nt=a(396),Tt=a(408),Ht=a.n(Tt),Rt=a(300);function Yt(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(O.a,Object.assign({color:"textSecondary",className:t.classes.noOptionsMessage},a),n)}function Bt(e){var t=e.inputRef,a=Object(Mt.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))}function Lt(e){var t=e.selectProps,a=e.innerRef,n=e.children,i=e.innerProps;return r.a.createElement(b.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:Bt,inputProps:Object(p.a)({className:t.classes.input,inputRef:a,children:n},i)}},t.textFieldProps))}function Pt(e){var t=e.innerRef,a=e.isFocused,n=e.isSelected,i=e.innerProps,l=e.children,c=e.data.color;return r.a.createElement(W.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400,color:c}},i),l)}function Ft(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(O.a,Object.assign({color:"textSecondary",className:t.classes.placeholder},a),n)}function zt(e){var t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)}function Gt(e){var t=e.children,a=e.selectProps,n=e.isFocused,i=e.data,l=e.removeProps,c=i.chipLabel,o="undefined"!==typeof c?c:t;return r.a.createElement(Nt.a,{tabIndex:-1,label:o,className:"".concat(a.classes.chip," ").concat(Object(s.a)({},a.classes.chipFocused,n)),onDelete:l.onClick,deleteIcon:r.a.createElement(Ht.a,l)})}function Ut(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(h.a,Object.assign({square:!0,className:t.classes.paper},a),n)}var Wt=Object(d.a)((function(e){return{root:{flexGrow:1},input:{display:"flex",padding:0,height:"auto"},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object(Rt.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},paper:{position:"absolute",zIndex:2,marginTop:e.spacing(1),left:0,right:0},divider:{height:e.spacing(2)}}}),{withTheme:!0})((function(e){var t=e.classes,a=e.changeHandler,n=e.options,i=e.value,l=e.label,c=e.placeholder,o=e.renderDropdownIndicator,s=e.openMenuOnClick,m=e.isMulti,u=e.isDisabled,d=e.isClearable,g=e.hasAlternativeChipLabel,f={input:function(e){return Object(p.a)({},e,{color:"blue","& input":{font:"inherit"}})}},b={Control:Lt,Menu:Ut,MultiValue:Gt,NoOptionsMessage:Yt,Option:Pt,Placeholder:Ft,ValueContainer:zt},E=void 0===s||s,v=void 0!==m&&m,h=void 0!==u&&u,_=void 0!==d&&d;return!1===(void 0===o||o)&&(b.DropdownIndicator=function(){return null},b.IndicatorSeparator=function(){return null}),r.a.createElement("div",{className:t.root},r.a.createElement(Ee.a,null,r.a.createElement(It.a,{classes:t,styles:f,textFieldProps:{label:l,InputLabelProps:{shrink:!0}},options:n,components:b,value:i,onChange:a,placeholder:c,isMulti:v,openMenuOnFocus:!1,openMenuOnClick:E,isDisabled:h,isClearable:_,hasAlternativeChipLabel:g})))}));var qt=Object(n.createContext)(),Vt=function(e){var t=e.children,a=Object(n.useState)([]),i=Object(o.a)(a,2),l=i[0],s=i[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)([]),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)(null),h=Object(o.a)(v,2),_=h[0],y=h[1];Object(n.useEffect)((function(){var e;e=function(e){p(e)},st("".concat(k,"/api/sites/get_sites_data"),e)}),[]),Object(n.useEffect)((function(){var e;e=function(e){s(e)},st("".concat(k,"/api/users/get_dynaslope_users"),e)}),[]),Object(n.useEffect)((function(){var e;e=function(e){E(e)},st("".concat(k,"/api/users/get_organizations"),e)}),[]);var O=Object(c.useSnackbar)(),x=O.enqueueSnackbar,j=O.closeSnackbar,S=Object(n.useState)(null),C=Object(o.a)(S,2),A=C[0],w=C[1];Object(n.useEffect)((function(){if(null!==_)if(!0===_){var e=x("Connection lost... Features will not work properly... Reconnecting...",{variant:"warning",persist:!0});w(e)}else j(A),x("Reconnection successful...",{variant:"success",autoHideDuration:5e3})}),[_]);var D={users:l,sites:d,organizations:b,is_reconnecting:_,setIsReconnecting:y};return r.a.createElement(qt.Provider,{value:D},t)};function Qt(e,t,a){return e.map((function(e){var n=e.site_code,r=e.site_id,i=n.toUpperCase();t&&(i=nt(e,!0,"start"));var l="black";if("undefined"!==typeof a&&null!==a){var c=a.latest,o=a.extended,s=a.overdue,m=[].concat(Object(Ke.a)(c),Object(Ke.a)(s)),u=n.toLowerCase();m.find((function(e){return e.event.site.site_code===u}))&&(l="red"),o.find((function(e){return e.event.site.site_code===u}))&&(l="green")}return{value:r,label:i,data:e,color:l}}))}var Zt=function(e){var t=e.value,a=e.changeHandler,i=e.isMulti,l=e.renderDropdownIndicator,c=e.includeAddressOnOptions,o=e.returnSiteDataCallback,s=e.isFromSiteLogs,m=Object(n.useContext)(qt).sites,u=Qt(m,"undefined"===typeof c||c,s),d="undefined"!==typeof i&&i,p=d?"Select site(s)":"Select site",g="undefined"!==typeof l&&l,f=t;if(""!==t&&null!==t){var b=t.label,E=t.value;if("undefined"!==typeof o&&o){var v=m.find((function(e){return e.site_id===E}));"undefined"!==typeof v&&o(v)}"undefined"!==typeof b||d||(f=u[E-1])}return r.a.createElement(Wt,{label:i?"Site(s)":"Site",options:u,value:f,changeHandler:a,placeholder:p,renderDropdownIndicator:g,openMenuOnClick:!0,isMulti:d})};var Kt=Object(pe.a)(Object(d.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},link:{textDecoration:"none"}}})),Object(ze.a)())((function(e){var t=e.classes,a=e.fullScreen,i=e.isOpen,l=e.clickHandler,s=e.setComposedMessage,m=Object(n.useState)(re()().format("YYYY-MM-DD HH:mm:ss")),u=Object(o.a)(m,2),d=u[0],p=u[1],f=Object(n.useState)(null),b=Object(o.a)(f,2),E=b[0],v=b[1],h=Object(n.useState)(!0),_=Object(o.a)(h,2),O=_[0],x=_[1],j=Object(c.useSnackbar)(),S=j.enqueueSnackbar,A=j.closeSnackbar,w=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){A(e)}},"Dismiss")},D=function(){var e=function(e){var t=[];return e.forEach((function(e,a){var n=e.data,r=n.site_code,i=n.barangay,l=n.municipality,c=n.province,o="Brgy. ".concat(i,", ").concat(l,", ").concat(c);t.push({site_code:r,site_info:o})})),t}(E),t=O,a=re()(d).format("LLL");!function(e,t){var a="".concat(k,"/api/rainfall/get_all_site_rainfall_data");C.a.post(a,e).then((function(e){var a=e.data;console.log("Get rain information data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({is_express:t,site_details:e,date_time:d,as_of:a},(function(e){var t=e.status,a=e.message,n=e.ewi;s(n),!0===t?(l(),S(a,{variant:"success",autoHideDuration:3e3,action:w})):S(a,{variant:"error",autoHideDuration:3e3,action:w})}))};return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:a,open:i,"aria-labelledby":"form-dialog-title",TransitionComponent:a?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},"Load Templates"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Select template to be loaded."),r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Zt,{value:E,changeHandler:function(e){v(e)},isMulti:!0})),r.a.createElement(y.a,{item:!0,xs:6,className:t.inputGridContainer},r.a.createElement(yt.a,{title:"Example tooltip",placement:"top",interactive:!0},r.a.createElement(Ye.a,null,r.a.createElement(Le.a,{control:r.a.createElement(Ot.a,{checked:O,onChange:function(e){return x(e.target.checked)},value:"checkedB",color:"primary"}),label:"Express data in percentage"})))),r.a.createElement(y.a,{item:!0,xs:6,className:t.inputGridContainer},r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Data timestamp",value:d,onChange:function(e){return p(re()(e).format("YYYY-MM-DD HH:mm:ss"))},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0}))))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{color:"primary",onClick:function(){return D()}},"Select"),r.a.createElement(g.a,{onClick:l},"Cancel")))})),Jt=Object(x.a)((function(e){return{container:{display:"flex",alignItems:"center",paddingTop:16},textBox:{width:"100%",flexGrow:2,margin:0},iconArea:{textAlign:"right",flexShrink:2}}}));var Xt=function(e){var t=e.limitRows,a=e.value,i=e.disableSend,l=e.messageChangeHandler,c=e.sendButtonClickHandler,s=e.setComposedMessage,m=e.disableTemplateLoader,u=Jt(),d=void 0===t||t,p=Object(n.useState)(!1),g=Object(o.a)(p,2),f=g[0],E=g[1],v=function(e){return function(){return E(e)}};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:u.container},r.a.createElement(b.a,{id:"message_textbox",label:"Message",multiline:!0,rows:"4",rowsMax:d?4:10,fullWidth:!0,className:u.textBox,margin:"dense",variant:"filled",value:a,onChange:l}),r.a.createElement("div",{className:u.iconArea},r.a.createElement(G.a,{color:"primary","aria-label":"Send message",onClick:c,disabled:i},r.a.createElement(ht.a,null)),!m&&r.a.createElement(G.a,{color:"primary","aria-label":"More options",onClick:v(!0)},r.a.createElement(_t.a,null)))),r.a.createElement(Kt,{isOpen:f,setComposedMessage:s,clickHandler:v(!1)}))},$t=a(553),ea=a(299),ta=a(589),aa=a(590);var na=Object(d.a)((function(e){return{checkboxes:{paddingTop:4,paddingBottom:4}}}))((function(e){var t=e.classes,a=(e.label,e.changeHandler),i=e.choices,l=e.checkboxStyle;return r.a.createElement(n.Fragment,null,i.map((function(e,n){var i=e.state,c=e.value,o=e.label,s=e.is_disabled;return r.a.createElement(Le.a,{key:n,control:r.a.createElement(Ot.a,{checked:i,onChange:a(c),value:c,disabled:"undefined"!==typeof s&&s,className:t.checkboxes}),label:o,className:l})})))})),ra=Object(x.a)((function(e){var t,a;return{formControl:{width:"-webkit-fill-available",marginTop:8,"&:first-child":{marginTop:12}},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxSites:(t={flex:"1 1 25%"},Object(s.a)(t,e.breakpoints.down("xs"),{"&:last-child":{flexBasis:"58.5%"}}),Object(s.a)(t,e.breakpoints.up("sm"),{flexBasis:"17%"}),Object(s.a)(t,e.breakpoints.up("md"),{flexBasis:"9%"}),t),checkboxOrganizations:(a={flex:"1 1 45%"},Object(s.a)(a,e.breakpoints.up("sm"),{flexBasis:"17%","&:last-child":{flexBasis:"77%"}}),Object(s.a)(a,e.breakpoints.up("md"),{flexBasis:"9%","&:last-child":{flexBasis:"45%"}}),a),checkboxGroup:{flexDirection:"row",paddingTop:6},buttons:Object(s.a)({},e.breakpoints.down("xs"),{padding:"12px 6px"})}}));var ia=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.setRecipients,c=ra(),s=Object(n.useContext)(qt),m=s.sites,u=s.organizations,d=m.map((function(e){return{label:e.site_code.toUpperCase(),value:e.site_id,state:!1}})),f=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{label:t+e.name.toUpperCase(),value:e.org_id,state:!1}})),b=Object(n.useState)(!1),E=Object(o.a)(b,2),v=E[0],h=E[1],_=Object(n.useState)(d),y=Object(o.a)(_,2),O=y[0],x=y[1],j=Object(n.useState)(f),S=Object(o.a)(j,2),A=S[0],w=S[1],D={handleCheckAll:function(e,t){return function(){var a,n;"sites"===e?(a=O,n=x):"organizations"===e&&(a=A,n=w);var r=a.map((function(e){return Object(p.a)({},e,{state:t})}));n(Object(Ke.a)(r))}},handleChange:function(e){return function(t){return function(a){var n=a.target.checked;if("only_ewi_recipient"===e)h(n);else{var r,i;"sites"===e?(r=O,i=x):"organizations"===e&&(r=A,i=w);var l=r.findIndex((function(e){return e.value===t}));r[l].state=n,i(Object(Ke.a)(r))}}}}};return r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt,maxWidth:"md"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Select recipients"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Choose your preferred sites and offices as message recipients."),r.a.createElement(Ye.a,{className:c.formControl},r.a.createElement(Le.a,{control:r.a.createElement(Ot.a,{checked:v,onChange:function(e){return h(e.target.checked)},value:"only_ewi_recipients",className:c.checkboxes}),label:"Only EWI Recipients"})),[{state_list:A,group:"Organizations",list:u},{state_list:O,group:"Sites",list:m}].map((function(e){return function(e,t,a){var n=t.state_list,i=t.group,l=t.list,c=a.handleCheckAll,o=a.handleChange,s=i.toLowerCase();return r.a.createElement(Ye.a,{component:"fieldset",className:e.formControl,key:i},r.a.createElement($t.a,{component:"legend",className:e.formLabel},r.a.createElement("span",null,i),r.a.createElement("span",null,[{label:"Check all",component:r.a.createElement(ta.a,null),bool:!0},{label:"Uncheck all",component:r.a.createElement(aa.a,null),bool:!1}].map((function(t){return r.a.createElement(G.a,{"aria-label":t.label,color:"primary",className:e.buttons,onClick:c(s,t.bool),key:t.label},t.component)})))),r.a.createElement(ea.a,{className:e.checkboxGroup},r.a.createElement(na,{choices:l.map((function(e){return function(e,t,a){var n;"Sites"===t?n="site_id":"Organizations"===t&&(n="org_id");return a.filter((function(t){return t.value===e[n]})).pop()}(e,i,n)})),changeHandler:o(s),checkboxStyle:e["checkbox".concat(i)]})))}(c,e,D)}))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:function(){var e=[],t=[];O.forEach((function(t){t.state&&e.push(t.value)})),A.forEach((function(e){e.state&&t.push(e.value)})),function(e,t){var a="".concat(k,"/api/contacts/get_recipients_option");C.a.post(a,e).then((function(e){var a=e.data;console.log("Selected recipients",a),t(a)})).catch((function(e){console.error(e)}))}({site_ids:e,org_ids:t,only_ewi_recipients:v},(function(e){var t=e.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,i=t;return""!==n&&(i="".concat(t," (").concat(n,")")),{label:i+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));l(t)})),i()},color:"primary"},"Select"),r.a.createElement(g.a,{onClick:i},"Cancel"))))}));var la=function(e){var t=e.isMobile,a=e.textboxValue,i=e.disableQuickSelect,l=e.releaseId,s=e.siteCode,m=e.fromEWIModal,u=e.modalStateHandler,d=e.updateSentStatusObj,p=e.recipientsList,f=Object(c.useSnackbar)(),b=f.enqueueSnackbar,E=f.closeSnackbar,v=I(),h=Object(n.useState)([]),_=Object(o.a)(h,2),O=_[0],x=_[1],S=Object(n.useState)([]),A=Object(o.a)(S,2),w=A[0],D=A[1],M=Object(n.useState)(!1),N=Object(o.a)(M,2),T=N[0],H=N[1],R=Object(n.useState)(a),Y=Object(o.a)(R,2),B=Y[0],L=Y[1],P="undefined"!==typeof i&&i,F="undefined"!==typeof m&&m,z=Object(n.useState)(!1),U=Object(o.a)(z,2),W=U[0],q=U[1];Object(n.useEffect)((function(){"undefined"!==typeof s&&(q(!0),function(e,t){var a="".concat(k,"/api/contacts/get_contacts_per_site/").concat(e);C.a.get(a).then((function(e){var a=e.data;console.log(e),console.log(a),t(a)})).catch((function(e){console.error(e)}))}(s,(function(e){var t=[],a=[],n=d.type,r=d.public_alert_symbol.alert_level;e.forEach((function(e){if(e.mobile_numbers.length>0){var i,l=e.user_id,c=e.last_name,o=e.first_name,s=e.organizations,m=e.ewi_recipient,u=e.ewi_restriction,d=s[0].organization,p=d.name,g=d.scope,f=p.toUpperCase();if("lgu"===p)1===g&&(i="B"),2===g&&(i="M"),3===g&&(i="P"),f=i+f;var b={label:"".concat(c,", ").concat(o," (").concat(f,")"),value:l,data:e};if(t.push(b),1===m){var E=!0;"extended"===n?(E=!1,("lewc"===p||g<3&&"lgu"===p)&&(E=!0)):null!==u&&0!==r&&r<u.alert_level&&(E=!1),E&&a.push(b)}}})),D(t),x(a),q(!1)})))}),[s]),Object(n.useEffect)((function(){if("undefined"!==typeof p){q(!0);var e=p.map((function(e){var t=e.label,a=e.mobile_id,n=e.org,r=e.sim_num,i=t;return""!==n&&(i="".concat(t," (").concat(n,")")),{label:i+=" - ".concat(r),chipLabel:"".concat(t," - ").concat(r),value:a,sim_num:r,data:e}}));D(e),x([]),q(!1)}}),[p]);var V=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){E(e)}},"Dismiss")},Q=null===O||0===O.length,Z=""===B||"undefined"===typeof B;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},W&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(j.a,{size:20})),r.a.createElement(y.a,{item:!0,xs:!0},r.a.createElement(Wt,{label:"Recipients",options:w,value:O,changeHandler:function(e){return x(e)},placeholder:"Select recipients",renderDropdownIndicator:!0,openMenuOnClick:!0,isMulti:!0})),!P&&r.a.createElement(y.a,{item:!0,style:{textAlign:"right"}},r.a.createElement(G.a,{"aria-label":"Quick select option",onClick:function(e){return H(!0)}},r.a.createElement(vt.a,null)))),r.a.createElement(ia,{isOpen:T,closeHandler:function(e){return H(!1)},setRecipients:x}),!t&&r.a.createElement("div",{style:{height:80}}),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(Xt,{limitRows:!1,value:B,disableSend:Q||Z,sendButtonClickHandler:function(){var e=[];F?O.forEach((function(t){t.data.mobile_numbers.forEach((function(t){return e.push({mobile_id:t.mobile_number.mobile_id,gsm_id:t.mobile_number.gsm_id})}))})):O.forEach((function(t){var a=t.data,n=a.mobile_id,r=a.gsm_id;e.push({mobile_id:n,gsm_id:r})}));var t={sms_msg:"".concat(B," - ").concat(v.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:e},a=b("Sending EWI message...",{variant:"warning",persist:!0});u(),Ct(t,(function(e){if(E(a),F&&e.status){!function(e,t){var a="".concat(k,"/api/chatterbox/get_ewi_sms_narrative/").concat(e);C.a.get(a).then((function(e){var a=e.data;console.log("EWI recipients",a),t(a)})).catch((function(e){console.error(e)}))}(l,(function(e){var t=e.narrative,a=e.site_list,n=e.event_id,r=e.type_id,i=function(e){var t=new Map;return e.forEach((function(e){var a=e.data.organizations;if(a.length>0){var n=a[0].organization,r=n.name,i=n.scope,l="";if("lgu"===r)switch(i){case 1:l="B";break;case 2:l="M";break;case 3:l="P"}t.set(l+r.toUpperCase())}})),Array.from(t.keys()).join(", ")}(O);!function(e,t){var a="".concat(k,"/api/narratives/write_narratives_to_db");C.a.post(a,e).then((function(e){var a=e.data;console.log("EWI SMS reponse",a),t(a)})).catch((function(e){console.error(e)}))}({type_id:r,site_list:a,event_id:n,narrative:"".concat(t," ").concat(i),user_id:v.user_id,timestamp:re()().format("YYYY-MM-DD HH:mm:ss")},(function(){}))})),function(e,t){ot("".concat(k,"/api/general_data_tag/insert_ewi_sms_tag"),e,t)}({user_id:I().user_id,outbox_id:e.outbox_id,ts:re()().format("YYYY-MM-DD HH:mm:ss")});var t=d.site_id;We("update_db_alert_ewi_sent_status",{alert_db_group:d.type,site_id:t,ewi_group:"sms"})}e.status?b("EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:V}):b(e.message,{variant:"error",autoHideDuration:7e3,action:V})}),(function(){b("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:V})}))},messageChangeHandler:function(e){return L(e.target.value)},setComposedMessage:L,disableTemplateLoader:F})))};var ca=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,i=e.textboxValue,l=e.releaseDetail,c=l.release_id,o=l.site_code;return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Early Warning Information"),r.a.createElement(G.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Et.a,null)))),r.a.createElement(He.a,{style:{overflowY:"auto"}},r.a.createElement(Re.a,null,"Early warning information recipients for this site is already pre-loaded. Add additional site-related contacts if necessary. Use Chatterbox for non-site-related contacts."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(la,{isMobile:t,textboxValue:i,disableQuickSelect:!0,releaseId:c,siteCode:o,fromEWIModal:!0,updateSentStatusObj:l,modalStateHandler:a}))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:a,color:"primary"},"Cancel")))}));function oa(e){var t=e.is_loading_recipients,a=e.textboxValue,i=e.sendHandler;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,justify:"space-around",alignItems:"flex-end"},t&&r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(j.a,{size:20}))),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(Xt,{limitRows:!1,value:a,disableSend:!1,sendButtonClickHandler:i,messageChangeHandler:function(){return console.log("tried msg change")}})))}var sa=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,n=e.modalState,i=e.textboxValue,l=e.siteList,o=Object(c.useSnackbar)(),s=o.enqueueSnackbar,m=o.closeSnackbar,u=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){m(e)}},"Dismiss")};return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:n,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send Routine Early Warning Information"),r.a.createElement(G.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Et.a,null)))),r.a.createElement(He.a,{style:{overflowY:"hidden"}},r.a.createElement(Re.a,null,"Early warning information recipients for this site is already pre-loaded. Recipients are LEWC, Barangay, and Municipal LGUs per site. If you need to add a new recipient, add a new community contact via chatterbox."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(oa,{isMobile:t,textboxValue:i,disableQuickSelect:!0,sendHandler:function(){var e=I(),t=e.user_id,n=e.nickname,r={site_list:l,user_id:t,nickname:n};a(),function(e,t,a){var n="".concat(k,"/api/chatterbox/send_routine_ewi_sms");C.a.post(n,e).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e),a(e)}))}(r,(function(e){if(console.log(e),e.status)s("Routine EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:u});else{var t=e.site_ids.map((function(e){return e.toUpperCase()}));s("Some problems occurred sending EWI SMS to ".concat(t.join(", ")),{variant:"error",persist:!0,action:u})}}),(function(e){console.log("error_response",e),s("Error sending routine EWI SMS...",{variant:"error",autoHideDuration:7e3,action:u})}))},fromEWIModal:!0,updateSentStatusObj:"",modalStateHandler:a}))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:a,color:"primary"},"Cancel")))})),ma=a(297),ua=a(303);var da=Object(d.a)((function(e){return{formControl:{minWidth:120}}}))((function(e){var t=e.classes,a=e.list,i=e.mapping,l=e.label,c=e.div_id,o=e.changeHandler,s=e.value,m=e.css,u=e.error,d=e.required,p=e.disabled,g="undefined"!==typeof d&&d,f="undefined"!==typeof u&&u;return r.a.createElement(n.Fragment,null,r.a.createElement(Ye.a,{required:g,error:f,className:"".concat(t.formControl," ").concat(m),fullWidth:!0},r.a.createElement(ma.a,{htmlFor:c},l),r.a.createElement(ua.a,{value:s,onChange:o,name:c,inputProps:{id:c},disabled:p},r.a.createElement(W.a,{value:""},r.a.createElement("em",null,"---")),a.map((function(e,t){return r.a.createElement(W.a,{value:e[i.id],key:t},e[i.label])})))))})),pa=a(89),ga=a(90),fa=a(94),ba=a(91),Ea=a(96),va=a(302),ha=function(e){function t(){var e,a;Object(pa.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(fa.a)(this,(e=Object(ba.a)(t)).call.apply(e,[this].concat(r)))).state={labelWidth:0},a}return Object(Ea.a)(t,e),Object(ga.a)(t,[{key:"componentDidMount",value:function(){this.setState({labelWidth:l.a.findDOMNode(this.InputLabelRef).offsetWidth})}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.list,i=t.mapping,l=t.label,c=t.div_id,o=t.changeHandler,s=t.value,m=t.css,u=this.state.labelWidth;return r.a.createElement(Ye.a,{required:!0,variant:"outlined",className:"".concat(a.formControl," ").concat(m)},r.a.createElement(ma.a,{ref:function(t){e.InputLabelRef=t},htmlFor:c},l),r.a.createElement(ua.a,{value:s,onChange:o,name:c,input:r.a.createElement(va.a,{labelWidth:u,id:c}),fullWidth:!0},r.a.createElement(W.a,{value:""},r.a.createElement("em",null,"---")),n.map((function(e,t){return r.a.createElement(W.a,{value:e[i.id],key:t},e[i.label])}))))}}]),t}(n.Component),_a=Object(d.a)((function(e){return{formControl:{minWidth:120}}}))(ha),ya={id:"user_id",label:"name"};function Oa(e){return e.map((function(e){var t=e.user_id,a=e.first_name,n=e.last_name;return{user_id:t,name:"".concat(n,", ").concat(a)}}))}var xa=function(e){var t=e.variant,a=e.label,i=e.div_id,l=e.changeHandler,c=e.value,s=e.css,m=e.disabled,u=e.returnFullNameCallback,d=e.isCommunityStaff,p=Object(n.useState)([]),g=Object(o.a)(p,2),f=g[0],b=g[1],E=Object(n.useContext)(qt).users;if(Object(n.useEffect)((function(){var t=C.a.CancelToken.source();if(d){var a=e.site_code,n="".concat(k,"/api/users/get_community_users_by_site/").concat(a);C.a.get(n,{cancelToken:t.token}).then((function(e){var t=Oa(e.data);b(t)})).catch((function(e){console.log(e)}))}else{var r=Oa(E);b(r)}return function(){t.cancel()}}),[E]),"undefined"!==typeof u&&u){var v=f.find((function(e){return e.user_id===c}));"undefined"!==typeof v&&u(v.name)}return r.a.createElement(n.Fragment,null,"standard"===t&&r.a.createElement(da,{label:a,div_id:i,changeHandler:l,value:0===f.length?"":c,list:f,mapping:ya,css:s,disabled:m}),"outlined"===t&&r.a.createElement(_a,{label:a,div_id:i,changeHandler:l,value:0===f.length?"":c,list:f,mapping:ya,css:s}))},ja=Object(n.createContext)(),Sa=function(e){var t=e.children,a=Object(n.useState)(""),i=Object(o.a)(a,2),l=i[0],c=i[1],s=Object(n.useState)("---"),m=Object(o.a)(s,2),u=m[0],d=m[1];return r.a.createElement(ja.Provider,{value:{reporter_id_ct:l,setReporterIdCt:c,ct_full_name:u,setCTFullName:d}},t)},Ca=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{root:{width:"100%"},sectionHead:Object(p.a)({},t.sectionHead,{marginBottom:24}),expansionPanelSummaryContent:{justifyContent:"space-between"},invalidCandidate:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)"},validCandidate:{background:"linear-gradient(315deg, #00b712 0%, #5aff15 74%)"},partialInvalidCandidate:{background:"linear-gradient(315deg, #bbf0f3 0%, #f6d285 74%)"},inputWidth:{width:"50%"}})}));function ka(e){return re()(e).format("DD MMMM YYYY, HH:mm")}var Aa=function(){return r.a.createElement(xe.a,{height:60,width:700,speed:.5,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}))};function wa(e){var t=e.alertData,a=e.classes,i=e.expanded,l=e.handleExpansion,c=e.index,o=e.releaseFormOpenHandler,s=e.isShowingValidation,m=e.toggleValidation,u=e.validationDetails,d="",p="",f="",b=[],E=!1,v=t.general_status,h=t.is_release_time,_=t.unresolved_moms_list,x=t.validity_status,j="valid";if("undefined"!==typeof x&&(j=x),"routine"===v){var S=t.data_ts,C=t.public_alert_symbol;d="ROUTINE RELEASE",p=ka(S),f=C}else{var k=t.site_code,A=t.release_details,w=t.internal_alert_level,D=t.trigger_list_arr,M=A.data_ts;d=k,p=ka(M),f=w,E="No new triggers"!==(b="undefined"===typeof D?[]:D)&&b.length>0}d=d.toUpperCase();var I=v.toUpperCase(),N=a.alert0;return"invalid"===j?N=a.alert3:"partially valid"===j&&(N=a.alert2),r.a.createElement(je.a,{key:"panel-".concat(c+1),expanded:i==="panel".concat(c),onChange:l("panel".concat(c))},r.a.createElement(Ce.a,{"aria-controls":"panel".concat(c,"bh-content"),id:"panel".concat(c,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:N}},[d,p,j.toUpperCase(),I].map((function(e,t){return r.a.createElement(O.a,{key:"candidate-column-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Oe.a,{style:{marginBottom:12}}),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},p)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Internal Alert:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},f))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"TRIGGERS")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},E?b.map((function(e,t){var a=e.ts_updated,i=e.alert,l=(e.tech_info,e.trigger_id),c=e.trigger_type,o=ka(a),p="Valid",f=!1,E=!1;try{var v=e.validating_status;0===v?(p="Validating",E=!0,f=!0):null===v?(p="---",f=!0):1===v&&(f=!1)}catch(_){}try{e.invalid&&(p="Invalid")}catch(_){}var h=["surficial","rainfall","subsurface"].includes(c)&&f;return r.a.createElement(n.Fragment,{key:"trigger-".concat(c,"-").concat(i)},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Trigger"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},i)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:!0,align:h?"flex-start":"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Status:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},p)),h&&r.a.createElement(y.a,{item:!0,xs:!0,justify:"flex-end",container:!0},r.a.createElement(g.a,{onClick:m(!0,{site:d,trigger_id:l,ts_updated:a}),variant:"contained",color:"secondary",size:"small","aria-label":"Validate trigger"},"Validate")),r.a.createElement(Qe,{isShowing:s,data:u,hide:m(!1,{}),isValidating:E}),b.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)))})):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"No new triggers"))))),"undefined"!==typeof _&&_.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"UNRESOLVED MOMS LIST")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:2,alignItems:"center"},_.map((function(e,t){var a=e.moms_instance,i=e.observance_ts,l=e.op_trigger,c=a.feature.feature_type,o=a.feature_name,s="".concat(rt(c)," ").concat(o.toUpperCase()),m=ka(i);return r.a.createElement(n.Fragment,{key:e.moms_id},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Feature"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:4,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Last Report"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Alert Level"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},l)),_.length>t+1&&r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)))}))))))),r.a.createElement(Oe.a,null),r.a.createElement(Ie.a,null,r.a.createElement(g.a,{color:"secondary",size:"small","aria-label":"Release candidate alert",startIcon:r.a.createElement(ke.a,null),onClick:o(t,v),disabled:!h},"Release")))}function Da(e){var t=e.siteAlert,a=e.classes,n=e.expanded,i=e.handleExpansion,l=e.smsHandler,c=e.bulletinHandler,o=e.keyName,s=e.type,m=e.history,u=t.event,d=t.internal_alert_level,p=t.releases,f=t.day,b=t.sent_statuses,E=t.public_alert_symbol,v=E.alert_level,h=b.is_sms_sent,_=b.is_bulletin_sent,x=u.validity,j=u.site,S=u.event_start,C=u.event_id,k=j.site_code,A=j.site_id,w=k.toUpperCase(),D=ka(S),M=ka(x),I=p[0],N=I.release_id,T=I.data_ts,H=I.release_time,R=T;1===p.length||(R=re()(T).add(30,"minutes")),R=ka(R);var Y=[w,d];return"extended"===s?Y.push("Day ".concat(f)):Y.push(R,H),r.a.createElement(je.a,{expanded:n===o,onChange:i(o)},r.a.createElement(Ce.a,{"aria-controls":"".concat(o,"bh-content"),id:"".concat(o,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:a["alert".concat(v)]}},Y.map((function(e,t){return r.a.createElement(O.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Oe.a,{style:{marginBottom:12}}),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Start:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},D)),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Event Validity:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},M))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"LATEST RELEASE")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},[["Internal Alert",d],["Data Timestamp",ka(T)],["Release Time",H]].map((function(e,t){return r.a.createElement(y.a,{key:e[0],item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},e[0]),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},e[1]))}))))),r.a.createElement(Oe.a,null),r.a.createElement(Ie.a,null,r.a.createElement(g.a,{size:"small",color:"primary",startIcon:r.a.createElement(Ae.a,null),onClick:function(){return m.push("/monitoring/events/".concat(C))},align:"left"},"Timeline"),r.a.createElement(g.a,{size:"small",color:"primary",startIcon:r.a.createElement(we.a,null),onClick:l({release_id:N,site_code:k,site_id:A,type:s,public_alert_symbol:E}),endIcon:h&&r.a.createElement(De.a,null)},"EWI SMS"),r.a.createElement(g.a,{size:"small",color:"primary",startIcon:r.a.createElement(Me.a,null),onClick:c({release_id:N,site_code:k,site_id:A,type:s}),endIcon:_&&r.a.createElement(De.a,null)},"Bulletin")))}function Ma(e){var t=e.siteAlert,a=e.classes,n=e.expanded,i=e.handleExpansion,l=e.smsHandler,c=e.keyName,o=t.released_sites,s=o[0].data_ts;return s=ka(s),r.a.createElement(je.a,{expanded:n===c,onChange:i(c)},r.a.createElement(Ce.a,{"aria-controls":"".concat(c,"bh-content"),id:"".concat(c,"bh-header"),classes:{content:a.expansionPanelSummaryContent,root:a.alert0}},["ROUTINE",s].map((function(e,t){return r.a.createElement(O.a,{key:"exp-columns-".concat(t+1),color:"textSecondary",variant:"body2"},e)}))),r.a.createElement(Oe.a,{style:{marginBottom:12}}),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{component:"span",variant:"body1",color:"textSecondary",style:{paddingRight:8}},"Data Timestamp:"),r.a.createElement(O.a,{component:"span",variant:"body1",color:"textPrimary"},s))),r.a.createElement(y.a,{item:!0,xs:12,style:{margin:"6px 0"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textPrimary"},"ROUTINE SITES")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},o.map((function(e,t){return r.a.createElement(y.a,{key:"site-".concat(e.site_code),item:!0,xs:2,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},e.site_code.toUpperCase()))}))))),r.a.createElement(Oe.a,null),r.a.createElement(Ie.a,null,r.a.createElement(g.a,{size:"small",color:"primary",startIcon:r.a.createElement(we.a,null),onClick:l(o)},"EWI SMS")))}var Ia=function(e){var t=e.candidateAlertsData,a=e.alertsFromDbData,i=e.width,l=e.releaseFormOpenHandler,c=e.history,s=Ca(),m=Object(n.useState)(!1),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(!1),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)({}),h=Object(o.a)(v,2),_=h[0],x=h[1],j=Ze(),S=j.isShowing,A=j.toggle,w=Ze(),D=w.isShowing,M=w.toggle,I=Object(n.useState)({}),N=Object(o.a)(I,2),T=N[0],H=N[1],R=Object(n.useState)(!1),Y=Object(o.a)(R,2),B=Y[0],L=Y[1],P=r.a.useContext(ja),F=P.reporter_id_ct,z=P.setReporterIdCt,G=P.setCTFullName,U=Object(n.useState)({}),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=function(e){return function(t,a){p(!!a&&e)}},Z=Object(n.useState)(""),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=function(e){return function(t){H(e),function(e,t){var a="".concat(k,"/api/chatterbox/get_ewi_message/").concat(e);C.a.get(a).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(e.release_id,(function(e){X(e),A()}))}},ee=function(e,t){return function(){x(t),E(e)}},te=function(e){return function(t){H(e),L(!0)}},ae=(Object(ie.c)("md",i),[]),ne=[],re=[],le=[];return null!==a&&(ae=a.latest,ne=a.extended,re=a.overdue,le=a.routine),r.a.createElement("div",{className:s.root},r.a.createElement(y.a,{container:!0,className:s.sectionHeadContainer},r.a.createElement(y.a,{item:!0,xs:12,align:"right",style:{marginBottom:22}},r.a.createElement(xa,{variant:"standard",label:"Monitoring Partner",div_id:"reporter_id_ct",changeHandler:function(e){return z(e.target.value)},value:F,css:s.inputWidth,returnFullNameCallback:function(e){return G(e)}})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:s.sectionHead,variant:"h5"},"Candidate Alerts")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===t?r.a.createElement(Aa,null):0!==t.length?t.map((function(e,t){return r.a.createElement(wa,{key:"exp-".concat(t+1),classes:s,alertData:e,expanded:d,handleExpansion:Q,releaseFormOpenHandler:l,index:t,isShowingValidation:b,toggleValidation:ee,validationDetails:_})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No candidate alerts")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:s.sectionHead,variant:"h5"},"Event Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Aa,null):ae.length>0?ae.map((function(e,t){return r.a.createElement(Da,{key:"latest-".concat(t+1),keyName:"latest-".concat(t+1),classes:s,siteAlert:e,expanded:d,handleExpansion:Q,smsHandler:$,bulletinHandler:te,type:"latest",history:c})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No active alerts on database")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:s.sectionHead,variant:"h5"},"Extended Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Aa,null):ne.length>0?ne.map((function(e,t){return r.a.createElement(Da,{key:"db-alert-".concat(t+1),keyName:"db-alert-".concat(t+1),classes:s,siteAlert:e,expanded:d,handleExpansion:Q,smsHandler:$,index:t,bulletinHandler:te,type:"extended",history:c})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No sites under extended monitoring")),null===a?r.a.createElement(Aa,null):"undefined"!==typeof le.released_sites&&le.released_sites.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:s.sectionHead,variant:"h5"},"Routine Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},r.a.createElement(Ma,{key:"routine-alert-panel",keyName:"routine-alert-panel",classes:s,siteAlert:le,expanded:d,handleExpansion:Q,smsHandler:function(e){return function(){!function(e,t){var a="".concat(k,"/api/chatterbox/get_routine_ewi_template");C.a.get(a).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}(0,(function(t){V(e),X(t),M()}))}},index:0,bulletinHandler:te,type:"routine",history:c}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{className:s.sectionHead,variant:"h5"},"Overdue Event Monitoring")),r.a.createElement(y.a,{item:!0,xs:12,style:{marginBottom:22}},null===a?r.a.createElement(Aa,null):re.length>0?re.map((function(e,t){return r.a.createElement(Da,{key:"overdue-alert-".concat(t+1),keyName:"overdue-alert-".concat(t+1),classes:s,siteAlert:e,expanded:d,handleExpansion:Q,smsHandler:$,index:t,bulletinHandler:te,type:"overdue",history:c})})):r.a.createElement(O.a,{variant:"body1",align:"center"},"No sites under overdue alerts")),r.a.createElement(ft,{classes:s,isOpenBulletinModal:B,setIsOpenBulletinModal:L,releaseDetail:T})),r.a.createElement(ca,{modalStateHandler:A,modalState:S,textboxValue:J,releaseDetail:T}),r.a.createElement(sa,{modalStateHandler:M,modalState:D,textboxValue:J,siteList:q}))},Na=a(601),Ta=a(602),Ha=a(603);function Ra(e){return re()(e).format("D MMMM YYYY, H:mm")}var Ya=function(){return r.a.createElement(xe.a,{height:300,width:684,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"8",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"1",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"0",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"8",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"238",y:"140",rx:"0",ry:"0",width:"206",height:"116"}),r.a.createElement("rect",{x:"469",y:"140",rx:"0",ry:"0",width:"206",height:"116"}))};var Ba=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),i=a[0],l=a[1],c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],u=s[1],d=function(e){return function(t){l(!0),u(e)}},p=function(){l(!1)},f="",b=e.generatedAlertsData,E=Object(n.useContext)(qt).sites;return null!==b&&b.length>0&&(f=function(e,t,a,i){var l=e.site_code,c=e.ts,o=e.internal_alert,s=e.validity,m=e.current_trigger_alerts,u=e.event_triggers,d=function(e,t){for(var a=null,n=0;n<t.length;n+=1)if(t[n].site_code===e){a=t[n];break}return a}(l,i),p=Ra(c),f=nt(d),b=[],E=null;return m.forEach((function(e){var t=e.type,a=e.details;if("subsurface"===t)E=a.trigger_details;else{var n=a.alert_level,i=a.alert_symbol,l="rainfall"===t&&n>0?" (".concat(a.rain_gauge,")"):"";b.push(r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",align:"center"},t.charAt(0).toUpperCase()+t.slice(1)," Alert"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",align:"center"},i,r.a.createElement(O.a,{component:"span",variant:"body2",color:"textPrimary",align:"center"},l))))}})),r.a.createElement(Ne.a,{fullWidth:!0,open:t,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(Te.a,{id:"alert-dialog-title"},r.a.createElement("div",null,f),r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},p)),r.a.createElement(He.a,null,r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Internal Alert Level"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),""!==s&&r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"Validity"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},Ra(s))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"OPERATIONAL ALERT STATUS"))),b.map((function(e){return e})),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textPrimary"},"Subsurface Column Status")),E.length>0?E.map((function(e){var t=e.alert_symbol,a=e.tsm_name;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},a.toUpperCase()),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},t))})):r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"No subsurface sensors available")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),u.length>0&&r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"caption",color:"textPrimary"},r.a.createElement("strong",null,"EVENT TRIGGERS"))),u.map((function(e){var t=e.ts_updated,a=e.alert,i=e.tech_info,l=e.invalid,c=e.invalid_details,o=Ra(t);return r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:a},r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"Trigger | ",a))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},o)),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},i)),"undefined"!==typeof l&&!0===l&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},r.a.createElement("strong",null,"INVALIDATED ALERT"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},"".concat(c.user.first_name," ").concat(c.user.last_name))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},Ra(c.ts_ack))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},c.remarks))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)))})))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:a,color:"primary",autoFocus:!0},"Close")))}(b[m],i,p,E)),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{container:!0,spacing:2},null===b?r.a.createElement(Ya,null):b.map((function(e,t){return function(e,t,a,n){var i=e.ts,l=e.site_code,c=e.internal_alert,o=Ra(i);return r.a.createElement(y.a,{item:!0,xs:6,sm:4,lg:3,key:t},r.a.createElement(Na.a,{className:"alert-card"},r.a.createElement(Ta.a,{onClick:a(t)},r.a.createElement(Ha.a,{style:{paddingBottom:16}},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",gutterBottom:!0},o),r.a.createElement("div",{style:{display:"flex",alignItems:"baseline",alignContent:"flex-end",justifyContent:"space-between"}},r.a.createElement(O.a,{variant:"h5",component:"h2"},l.toUpperCase()),r.a.createElement(O.a,{className:"card-internal-alert",color:"textSecondary"},c))))))}(e,t,d)})),f))},La=a(604),Pa=a(605),Fa=a(606),za=a(607),Ga=a(608);var Ua=Object(d.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},checkboxes:{paddingTop:4,paddingBottom:4},checkboxesGroup:Object(s.a)({display:"flex",flexDirection:"column"},e.breakpoints.up("sm"),{flexDirection:"row",justifyContent:"space-between"})}}))((function(e){var t=e.classes,a=e.switchState,i=e.switchHandler,l=e.switchValue,c=e.label,o=e.changeHandler,s=(e.setTriggersState,e.choices);return r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,c),r.a.createElement(La.a,{checked:a,onChange:i,value:l})),a?r.a.createElement(n.Fragment,null,r.a.createElement(ea.a,{className:t.checkboxesGroup},s.map((function(e,a){var n=e.state,i=e.value,l=e.label,c=n.status,s=n.disabled;return r.a.createElement(Le.a,{key:a,control:r.a.createElement(Ot.a,{checked:c,onChange:o(i),value:i,className:t.checkboxes,disabled:s}),label:l})}))),r.a.createElement(E.a,null,"Add required if required")):r.a.createElement("div",null))})),Wa=function(e,t){return function(a,n){return function(r){var i="timestamp"===a?r:r.target.value,l=parseInt(n.charAt(1),10);e({action:"UPDATE_DETAILS",trigger_type:t,value:Object(s.a)({alert_level:l},a,i)})}}},qa=function(e,t){return function(a){var n=a.target.checked;if(e({action:"TOGGLE_SWITCH",trigger_type:t,value:n}),["on_demand","earthquake"].includes(t)){var r,i=null;"on_demand"===t?(r={reason:"",reporterId:""},i=12):"earthquake"===t&&(r={magnitude:"",longitude:"",latitude:""},i=11),e({action:n?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:Object(p.a)({alert_level:1,timestamp:null,tech_info:"",internal_sym_id:i},r)})}}},Va=function(e,t){return function(a){return function(n){var r=n.target.checked,i=null;"surficial"===t?2===a?i=6:3===a&&(i=4):"subsurface"===t&&(2===a?i=3:3===a&&(i=1)),e({action:r?"ADD_TRIGGER":"REMOVE_TRIGGER",trigger_type:t,value:{alert_level:a,status:r,disabled:!1,timestamp:null,tech_info:"",internal_sym_id:i}})}}},Qa=function(e,t){return function(a){var n=a.target.value;e({action:"REMOVE_TRIGGER",trigger_type:t,value:"clear_all"}),e({action:"ADD_TRIGGER",trigger_type:t,value:{alert_level:parseInt(n,10),timestamp:null,tech_info:"",internal_sym_id:8}})}},Za=function(e,t,a){return function(n){var r=n.target.value;t({action:"UPDATE_DETAILS",trigger_type:a,value:Object(s.a)({alert_level:1},e,r)})}};var Ka=Object(d.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.changeHandler,i=e.labelFor,l=e.trigger_timestamp,c=e.tech_info;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Trigger Timestamp (".concat(i,")"),value:l,onChange:a("timestamp",i),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,label:"Technical Information (".concat(i,")"),multiline:!0,rowsMax:"2",placeholder:'Enter technical info for "'.concat(i,'" trigger'),value:c,onChange:a("tech_info",i),fullWidth:!0})))}));var Ja=Object(d.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=e.triggersReleased,c=a.subsurface,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach((function(e){var t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(p.a)({},e,{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0}));var u=m.trigger_2,d=m.trigger_3,g=m.trigger_nd,f=[{state:u,value:2,label:"Release trigger (s2)"},{state:d,value:3,label:"Release trigger (S3)"}],b=l.filter((function(e){return"subsurface"===e.trigger_source}));if(b.length>0){var E=b.pop();f.push({state:g,value:"nd",label:"No data ([s/S]0)"}),-1===E.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(Ua,{label:"Subsurface",switchState:o,switchHandler:qa(i,"subsurface"),switchValue:"subsurface_switch",choices:f,changeHandler:Va(i,"subsurface")})),u.status&&o?r.a.createElement(Ka,{labelFor:"s2",trigger_timestamp:u.timestamp,tech_info:u.tech_info,changeHandler:Wa(i,"subsurface")}):r.a.createElement("div",null),d.status&&o?r.a.createElement(Ka,{labelFor:"S3",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:Wa(i,"subsurface")}):r.a.createElement("div",null))}));var Xa=Object(d.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=e.triggersReleased,c=a.surficial,o=c.switchState,s=c.triggers,m={trigger_2:{status:!1,disabled:!1},trigger_3:{status:!1,disabled:!1},trigger_nd:{status:!1,disabled:!1}};0!==s.length&&s.forEach((function(e){var t=e.alert_level,a=e.status,n=e.disabled;m["trigger_".concat(t)]=Object(p.a)({},e,{status:a,disabled:n}),"nd"===t?(m.trigger_2.disabled=!0,m.trigger_3.disabled=!0):m.trigger_nd.disabled=!0}));var u=m.trigger_2,d=m.trigger_3,g=m.trigger_nd,f=[{state:u,value:2,label:"Release trigger (g2)"},{state:d,value:3,label:"Release trigger (G3)"}],b=l.filter((function(e){return"surficial"===e.trigger_source}));if(b.length>0){var E=b.pop();f.push({state:g,value:"nd",label:"No data ([g/G]0)"}),-1===E.alert_level&&(m.trigger_nd.status=!0,m.trigger_nd.disabled=!1)}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(Ua,{label:"Surficial",switchState:o,switchHandler:qa(i,"surficial"),switchValue:"surficial_switch",choices:f,changeHandler:Va(i,"surficial")})),u.status?r.a.createElement(Ka,{labelFor:"g2",trigger_timestamp:u.timestamp,tech_info:u.tech_info,changeHandler:Wa(i,"surficial")}):r.a.createElement("div",null),d.status?r.a.createElement(Ka,{labelFor:"G3",trigger_timestamp:d.timestamp,tech_info:d.tech_info,changeHandler:Wa(i,"surficial")}):r.a.createElement("div",null))})),$a=Object(x.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}));var en=function(e){var t=e.triggersState,a=(e.setTriggerState,$a()),i=t.moms,l=i.switchState,c=i.triggers,o=function(){console.log("change has been made")};return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:l?a.groupGridContainer:""},r.a.createElement(Ye.a,{component:"fieldset",className:a.formControl},r.a.createElement($t.a,{component:"legend",className:a.formLabel},r.a.createElement("span",null,"Manifestation of Movement"))),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"body1",color:"textSecondary"},"NOTE: If you want to add MOMs in the release, use MOMs Insert Form.")),c.map((function(e){var t=e.alert,i=e.timestamp,l=e.tech_info,c=e.moms_list;return r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:12,sm:3,align:"center"},r.a.createElement(O.a,{variant:"body1",component:"span",color:"textSecondary"},"Trigger: "),r.a.createElement(O.a,{variant:"body1",component:"span"},r.a.createElement("strong",null,t))),r.a.createElement(y.a,{item:!0,xs:12,sm:9,align:"center"},r.a.createElement(O.a,{variant:"body1",component:"span",color:"textSecondary"},"Trigger Timestamp: "),r.a.createElement(O.a,{variant:"body1",component:"span"},r.a.createElement("strong",null,i.format("YYYY/MM/DD HH:mm:00")))),c.map((function(e){var t=e.moms_instance,a=e.observance_ts,n=t.feature.feature_type,i=t.feature_name,l=t.instance_id;return r.a.createElement(y.a,{key:l,item:!0,xs:12,container:!0,spacing:0,justify:"space-around"},r.a.createElement(y.a,{item:!0,xs:6,sm:!0,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Feature Type"),r.a.createElement(O.a,{variant:"body2"},r.a.createElement("strong",null,rt(n)))),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Feature Name"),r.a.createElement(O.a,{variant:"body2"},r.a.createElement("strong",null,i))),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Observance Timestamp"),r.a.createElement(O.a,{variant:"body2"},r.a.createElement("strong",null,re()(a).format("YYYY/MM/DD HH:mm:00")))))})),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:a.inputGridContainer},r.a.createElement(b.a,{required:!0,label:"Technical Info",multiline:!0,rowsMax:"2",placeholder:"Enter technical info for 'MOMs' trigger",value:l,onChange:o,fullWidth:!0})))})))))};var tn=Object(d.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},radios:{paddingTop:4,paddingBottom:4},radioGroup:Object(s.a)({display:"flex",flexDirection:"column"},e.breakpoints.up("sm"),{flexDirection:"row",justifyContent:"space-between"})}}))((function(e){var t=e.classes,a=e.id,i=e.label,l=e.changeHandler,c=e.radioValue,o=e.choices,s=e.switchState,m=e.switchValue,u=e.switchHandler;return r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,i),r.a.createElement(La.a,{checked:s,onChange:u,value:m})),s?r.a.createElement(n.Fragment,null,r.a.createElement(Be.a,{className:t.radioGroup,"aria-label":i,name:a,value:c,onChange:l},o.map((function(e,a){var n=e.value,i=e.label;return r.a.createElement(Le.a,{key:a,value:n,control:r.a.createElement(Pe.a,{className:t.radios}),label:i})}))),r.a.createElement(E.a,null,"Add required if required")):r.a.createElement("div",null))}));var an=Object(d.a)((function(e){return{groupGridContainer:{marginTop:0,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=e.triggersReleased,c=a.rainfall,o=c.switchState,s=c.triggers,m={alert_level:""};0!==s.length&&s.forEach((function(e){m=Object(p.a)({},e,{alert_level:"".concat(e.alert_level)})}));var u=[{value:"1",label:"Release new trigger"}],d=l.filter((function(e){return"rainfall"===e.trigger_source}));if(d.length>0){d.pop();u.push({value:"-1",label:"No data (R0)"},{value:"-2",label:"Intermediate threshold (rx)"})}return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:o?t.groupGridContainer:""},r.a.createElement(tn,{label:"Rainfall",id:"rainfall",switchState:o,switchHandler:qa(i,"rainfall"),switchValue:"rainfall_switch",radioValue:m.alert_level,choices:u,changeHandler:Qa(i,"rainfall")})),"1"===m.alert_level&&o?r.a.createElement(Ka,{labelFor:"R1",trigger_timestamp:m.timestamp,tech_info:m.tech_info,changeHandler:Wa(i,"rainfall")}):r.a.createElement("div",null))}));var nn=Object(d.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=a.earthquake,c=l.switchState,o=l.triggers,s={timestamp:null,tech_info:"",magnitude:null,latitude:null,longitude:null};0!==o.length&&(s=Object(p.a)({},o[0]));var m=s,u=m.timestamp,d=m.tech_info,g=m.magnitude,f=m.latitude,E=m.longitude;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"Earthquake"),r.a.createElement(La.a,{checked:c,onChange:qa(i,"earthquake"),value:"switch_earthquake"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(Ka,{labelFor:"e1",trigger_timestamp:u,tech_info:d,changeHandler:Wa(i,"earthquake")}),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"magnitude",label:"Magnitude",value:g,onChange:Za("magnitude",i,"earthquake"),type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"latitude",label:"Latitude",value:f,onChange:Za("latitude",i,"earthquake"),type:"number"})),r.a.createElement(y.a,{item:!0,xs:12,sm:4,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"longitude",label:"Longitude",value:E,onChange:Za("longitude",i,"earthquake"),type:"number"}))):r.a.createElement("div",null))})),rn=[{user_id:1,name:"MLGU Something"},{user_id:2,name:"LEWC Chenes"},{user_id:3,name:"BLGU Chos"}];var ln=Object(d.a)((function(e){return{formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},groupGridContainer:{marginTop:0,marginBottom:0},inputGridContainer:{marginTop:6,marginBottom:6}}}))((function(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=a.on_demand,c=l.switchState,o=l.triggers,s={timestamp:null,tech_info:"",reason:"",reporterId:""};0!==o.length&&(s=Object(p.a)({},o[0]));var m=s,u=m.timestamp,d=m.tech_info,g=m.reason,f=m.reporterId;return r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",null,"On Demand"),r.a.createElement(La.a,{checked:c,onChange:qa(i,"on_demand"),value:"switch_on_demand"})))),c?r.a.createElement(n.Fragment,null,r.a.createElement(Ka,{labelFor:"d1",trigger_timestamp:u,tech_info:d,changeHandler:Wa(i,"on_demand")}),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"reason",label:"Reason",value:g,onChange:Za("reason",i,"on_demand"),placeholder:"Enter reason of on-demand request",multiline:!0,rowsMax:2,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(da,{label:"Reporter",div_id:"reporter_id",changeHandler:Za("reporterId",i,"on_demand"),value:f,list:rn,mapping:{id:"user_id",label:"name"}}))):r.a.createElement("div",null))}));var cn=Object(x.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}}));function on(e){var t=e.setModalTitle,a=e.generalData,i=e.classes,l=e.handleEventChange,c=e.handleDateTime,o=e.setGeneralData,s=e.isUpdatingRelease,m=e.changeState,u=a.siteId,d=a.dataTimestamp,g=a.releaseTime,f=a.reporterIdMt,b=a.reporterIdCt;Object(n.useEffect)((function(){t("Provide information to the following fields.")}),[]);return r.a.createElement(n.Fragment,null,s&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"secondary"},"You chose a data timestamp that has been released. You are allowed to update release details but changes on triggers and alert level cannot be accepted. For those kind of changes, please contact the Software Infra Devs. Thank you."))),r.a.createElement(y.a,{item:!0,xs:12,className:i.inputGridContainer},r.a.createElement(Zt,{value:u,changeHandler:function(e){return function(e){var t=e.label,n=e.data;o(Object(p.a)({},a,{siteId:e,address:t,siteCode:n.site_code})),m("siteId",e)}(e)}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:i.inputGridContainer},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Data timestamp",value:d,onChange:c("dataTimestamp"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:i.inputGridContainer},r.a.createElement(Pa.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:g,onChange:c("releaseTime"),clearable:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:i.inputGridContainer},r.a.createElement(xa,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",changeHandler:l("reporterIdMt"),value:f,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:i.inputGridContainer},r.a.createElement(xa,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",changeHandler:l("reporterIdCt"),value:b,disabled:!0})))}function sn(e){var t=e.classes,a=e.triggersState,i=e.setTriggersState,l=e.setModalTitle,c=e.hasNoGroundData,o=e.setHasNoGroundData,s=e.triggersReleased,m=e.alert_level,u=e.setAlert0,d=e.isAlert0,p=a.subsurface.switchState,g=a.surficial.switchState,f=a.moms.switchState;return Object(n.useEffect)((function(){l("Add triggers if not yet included in this release.")}),[]),r.a.createElement(n.Fragment,null,0!==m&&r.a.createElement(y.a,{item:!0,xs:12,className:d?t.groupGridContainer:""},r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"Lower to Alert 0"),r.a.createElement(La.a,{checked:d,onChange:function(e){return u(e.target.checked)},value:"has_no_ground_data"})))),!p&&!g&&!f&&r.a.createElement(y.a,{item:!0,xs:12,className:c?t.groupGridContainer:""},r.a.createElement(Ye.a,{component:"fieldset",className:t.formControl},r.a.createElement($t.a,{component:"legend",className:t.formLabel},r.a.createElement("span",{style:{color:"#f50057"}},"No Ground Data (ND)"),r.a.createElement(La.a,{checked:c,onChange:function(e){return o(e.target.checked)},value:"has_no_ground_data"})))),!1===d&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",color:"secondary"},"Ground-Related Triggers")),r.a.createElement(Ja,{triggersState:a,setTriggersState:i,triggersReleased:s}),r.a.createElement(Xa,{triggersState:a,setTriggersState:i,triggersReleased:s}),r.a.createElement(en,{triggersState:a,setTriggersState:i}),r.a.createElement(y.a,{item:!0,xs:12,style:{paddingTop:20}},r.a.createElement(O.a,{variant:"h6",color:"secondary"},"Secondary Triggers")),r.a.createElement(an,{triggersState:a,setTriggersState:i,triggersReleased:s}),r.a.createElement(nn,{triggersState:a,setTriggersState:i}),r.a.createElement(ln,{triggersState:a,setTriggersState:i})))}function mn(e){var t=e.classes,a=e.handleEventChange,i=e.generalData,l=e.internalAlertLevel,c=e.setModalTitle,s=e.mtFullName,m=e.ctFullName,u=e.ewiPayload,d=e.isAlertRecomputing,p=i.siteId,g=i.dataTimestamp,f=i.releaseTime,E=i.comments,v=Object(n.useState)(null),h=Object(o.a)(v,2),_=h[0],x=h[1];Object(n.useEffect)((function(){c("Review release summary. Add comment if necessary.");var e=[];"undefined"!==typeof u.trigger_list_arr&&(e=u.trigger_list_arr);var t=r.a.createElement(O.a,{variant:"body2",color:"textPrimary",align:"center"},"No triggers included in this release.");e.length>0&&(t=e.map((function(e,t){var a=e.ts_updated,i=e.alert_level,l=e.trigger_type,c=e.tech_info,o=l.charAt(0).toUpperCase()+l.slice(1),s=re()(a).format("DD MMMM YYYY, HH:mm");return r.a.createElement(n.Fragment,{key:"".concat(t+1)},r.a.createElement(y.a,{item:!0,xs:6,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Trigger"),r.a.createElement(O.a,{variant:"body2",color:"textPrimary"},"".concat(o," Alert ").concat(i))),r.a.createElement(y.a,{item:!0,xs:6,align:"center"},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Trigger timestamp"),r.a.createElement(O.a,{variant:"body2",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:12,align:"center",style:{paddingBottom:20}},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Tech info"),r.a.createElement(O.a,{variant:"caption",color:"textPrimary"},c)))}))),x(t)}),[u]);var S=re()(g).format("DD MMMM YYYY, HH:mm"),C=re()(f).format("HH:mm");return r.a.createElement(n.Fragment,null,d?r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(j.a,null)):r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Site"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},p.label)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Internal Alert"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},l)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Data Timestamp"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},S)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Release Time"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},C)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"MT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},s)),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"CT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"button",color:"textSecondary"},"Triggers")),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,align:"center"},_)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(b.a,{label:"Comments",multiline:!0,rowsMax:"2",placeholder:"Enter additional comments necessary",value:E,onChange:a("comments"),fullWidth:!0}))))}var un=function(e){var t=e.activeStep,a=e.generalData,i=e.setGeneralData,l=e.setInternalAlertLevel,c=e.internalAlertLevel,m=e.setPublicAlertLevel,u=e.isUpdatingRelease,d=e.currentTriggersStatus,g=e.setDBSavedTriggers,f=e.siteCurrentAlertLevel,b=e.setSiteCurrentAlertLevel,E=cn(),v=Object(p.a)({classes:E},e),h=I(),_=h.first_name,x=h.last_name,j="".concat(x,", ").concat(_),S=r.a.useContext(ja).ct_full_name,C=Object(n.useState)(Object(Ke.a)(d)),A=Object(o.a)(C,2),w=A[0],D=A[1],M=function(e,t){"siteId"===e?function(e,t){var a=e.site_id,n="".concat(k,"/api/monitoring/get_site_alert_details");st(n+="?site_id=".concat(a),t)}({site_id:t.value},(function(e){console.log(e);var t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_sources,r=e.alert_level;D(n),g(n),m(a),l(t),b(r)})):i(Object(p.a)({},a,Object(s.a)({},e,t)))},N=function(e){return function(t){M(e,t)}},T=function(e){return function(t){var a=t.target.value;M(e,a)}},H=["What are the release details?","List the triggers.","Add Comments and Review Release Summary"];return r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},function(e){switch(e){case 0:return r.a.createElement(on,Object.assign({},v,{handleDateTime:N,handleEventChange:T,isUpdatingRelease:u,changeState:M}));case 1:return r.a.createElement(sn,Object.assign({},v,{triggersReleased:w,alert_level:f}));case 2:return r.a.createElement(mn,Object.assign({},v,{mtFullName:j,ctFullName:S,internalAlertLevel:c,handleEventChange:T}));case 3:return r.a.createElement(O.a,{variant:"body1"},"Early warning information released! Please wait for the dashboard to update or check the site event timeline to confirm if EWI is released.");default:return"Uknown stepIndex"}}(t),r.a.createElement("div",{className:E.root},r.a.createElement(O.a,{className:E.instructions}),r.a.createElement(Fa.a,{activeStep:t,alternativeLabel:!0},H.map((function(e){return r.a.createElement(za.a,{key:e},r.a.createElement(Ga.a,null))}))))))},dn=Object(x.a)((function(e){return{inputGridContainer:{marginTop:8,marginBottom:8},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"})}}));function pn(e,t){var a=t.rainfall,n=!1;return a.switchState&&a.triggers.forEach((function(e){e.alert_level<0&&(n=!0)})),e||n}var gn={subsurface:{switchState:!1,triggers:[]},surficial:{switchState:!1,triggers:[]},moms:{switchState:!1,triggers:[]},rainfall:{switchState:!1,triggers:[]},earthquake:{switchState:!1,triggers:[]},on_demand:{switchState:!1,triggers:[]}};function fn(e,t){var a=t.action,n=t.trigger_type,r=t.value,i={},l=[];if("RESET_STATE"!==a){var c=e[n];l=(i=Object(p.a)({},c)).triggers}switch(a){case"TOGGLE_SWITCH":return Object(p.a)({},e,Object(s.a)({},n,Object(p.a)({},i,{switchState:r})));case"ADD_TRIGGER":return Object(p.a)({},e,Object(s.a)({},n,Object(p.a)({},i,{triggers:[].concat(Object(Ke.a)(l),[r])})));case"REMOVE_TRIGGER":var o;return o="clear_all"===r?[]:l.filter((function(e){return e.alert_level!==r.alert_level})),Object(p.a)({},e,Object(s.a)({},n,Object(p.a)({},i,{triggers:o})));case"UPDATE_DETAILS":var m=l.map((function(e){return e.alert_level===r.alert_level?Object(p.a)({},e,{},r):e}));return Object(p.a)({},e,Object(s.a)({},n,Object(p.a)({},i,{triggers:m})));case"RESET_STATE":return Object(p.a)({},gn);default:return e}}var bn=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.chosenCandidateAlert,c=e.setChosenCandidateAlert,s=e.setIsOpenRoutineModal,m=dn(),u=I().user_id,d=Object(n.useState)({}),f=Object(o.a)(d,2),b=f[0],E=f[1],v=Object(n.useState)(0),h=Object(o.a)(v,2),_=h[0],O=h[1],x=Object(n.useState)(!0),j=Object(o.a)(x,2),S=j[0],C=j[1],A=[1,2,3],w=Object(n.useState)(""),D=Object(o.a)(w,2),M=D[0],N=D[1],T=Object(n.useState)(""),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)(""),L=Object(o.a)(B,2),P=L[0],F=L[1],z=r.a.useContext(ja).reporter_id_ct,G={dataTimestamp:null,releaseTime:re()(),siteId:{},siteCode:"",address:"",reporterIdCt:z,reporterIdMt:u,comments:"",publicAlertSymbol:"",publicAlertLevel:"",triggerListStr:""},U=Object(n.useState)(Object(p.a)({},G)),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=Object(n.useState)(!1),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)(!1),$=Object(o.a)(X,2),ee=$[0],te=$[1],ae=Object(n.useState)(0),ne=Object(o.a)(ae,2),ie=ne[0],le=ne[1],ce=Object(n.useState)(!1),oe=Object(o.a)(ce,2),se=oe[0],me=oe[1],ue=Object(n.useReducer)(fn,Object(p.a)({},gn)),de=Object(o.a)(ue,2),pe=de[0],ge=de[1],fe=Object(n.useState)([]),be=Object(o.a)(fe,2),Ee=be[0],ve=be[1],he=Object(n.useState)([]),_e=Object(o.a)(he,2),ye=_e[0],Oe=_e[1];Object(n.useEffect)((function(){var e,t,a,n=q.dataTimestamp,r=q.siteCode;if("object"===typeof n&&null!==n){var i=re()(n).format("YYYY-MM-DD HH:mm:ss");e=r,t=i,a=function(e){Object.entries(e).length>1&&te(!0)},st("".concat(k,"/api/monitoring/get_monitoring_releases_by_data_ts/").concat(e,"/").concat(t),a)}}),[q.dataTimestamp]),Object(n.useEffect)((function(){if(null!==l&&"routine"!==l.general_status){var e=l.site_id,t=l.site_code,a=l.public_alert_level,n=l.public_alert_symbol,r=l.release_details,i=l.trigger_list_arr,c=l.has_ground_data,o=l.non_triggering_moms,s=l.internal_alert_level,m=l.current_triggers_status,d=l.saved_event_triggers,g=l.to_extend_validity,f=r.data_ts,v=r.trigger_list_str;N(s);var h=[];i.forEach((function(e){if(!0!==e.invalid&&h.push(e),"moms"===e.trigger_type){var t=e.moms_list;e.moms_id_list=t.map((function(e){return e.moms_id}))}}));var _=null;if(o.length>0)_={moms_id_list:o.map((function(e){return e.moms_id}))};E(Object(p.a)({},b,{site_id:e,site_code:t,public_alert_level:a,public_alert_symbol:n,release_details:{data_ts:f,trigger_list_str:v,release_time:re()().format("HH:mm:00")},publisher_details:{publisher_mt_id:u,publisher_ct_id:z},trigger_list_arr:h,non_triggering_moms:_,to_extend_validity:g})),J(!c);var y=Object(p.a)({},q,{reporterIdCt:z,dataTimestamp:re()(f),siteId:{value:e,label:t.toUpperCase()},siteCode:t,triggerListStr:v,publicAlertSymbol:n,publicAlertLevel:a,nonTriggeringMoms:o});V(Object(p.a)({},y)),ge({action:"RESET_STATE"}),"undefined"!==typeof d&&ve(d);var x=[];i.forEach((function(e){var t=e.trigger_type,a=e.alert_level,n=e.ts_updated,r=e.internal_sym_id,i=e.tech_info,l=e.alert;if("undefined"===typeof e.invalid){var c={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};ge(c);var o={alert:l,alert_level:a,internal_sym_id:r,tech_info:i,disabled:!1,status:!0,timestamp:re()(n)};if("moms"===t){var s=e.moms_list;o.moms_list=s,o.moms_id_list=s.map((function(e){return e.moms_id}))}if(ge(c={action:"ADD_TRIGGER",trigger_type:t,value:o}),t in["on demand","earthquake"]){var m=null;switch(t){case"on demand":m={action:"UPDATE_TRIGGER",trigger_type:t,value:{od_details:{request_ts:"",narrative:""}}};break;case"earthquake":m={action:"UPDATE_TRIGGER",trigger_type:t,value:{eq_details:{magnitude:"",latitude:"",longitude:""}}}}null!=m&&ge(m)}}else x.push(t)})),Oe(m),m.forEach((function(e){var t=e.trigger_source,a=e.alert_level;if(!x.includes(t)){var n=a;-1===a&&"rainfall"!==t&&(n="nd");var r={action:"TOGGLE_SWITCH",trigger_type:t,value:!0};ge(r),ge(r={action:"ADD_TRIGGER",trigger_type:t,value:{status:!0,disabled:!1,alert_level:n,timestamp:null,tech_info:""}})}})),O(2)}else V(Object(p.a)({},G)),ge({action:"RESET_STATE"}),ve([]),Oe([]),N(""),O(0)}),[l,z]);var xe=Object(n.useState)(!1),je=Object(o.a)(xe,2),Se=je[0],Ce=je[1];Object(n.useEffect)((function(){if(C(!0),0===_){var e=q.siteId,t=q.dataTimestamp,a=q.releaseTime,n=q.reporterIdCt,r=q.reporterIdMt;C(""===e||null===t||null===a||""===n||""===r)}else if(1===_){for(var i=Object.keys(pe),l=!1,c=0;c<i.length;c+=1){var o=pe[i[c]],s=o.switchState,m=o.triggers;if(s){var u=m.length;if(0===u)l=!0;else for(var d=0;d<u;d+=1)if([1,2,3].includes(m[d].alert_level)){if("on_demand"===i[c]){var p=m[d],g=p.reason,f=p.reporterId,b=p.tech_info,E=p.timestamp;""!==b&&""!==E&&""!==g&&""!==f||(l=!0)}else if("earthquake"===i[c]){var v=m[d],h=v.tech_info,y=v.timestamp,O=v.magnitude,x=v.longitude,j=v.latitude;""!==h&&""!==y&&""!==O&&""!==x&&""!==j||(l=!0)}else{var S=m[d],k=S.tech_info,A=S.timestamp;""!==k&&null!==A||(l=!0)}break}}}C(l)}else if(2===_){C(""===z||Se)}}),[q,pe,_,z,Se]),Object(n.useEffect)((function(){var e=pe.subsurface,t=pe.surficial;(e.switchState||t.switchState)&&J(!1)}),[pe.subsurface,pe.surficial]);var ke=function(){i(),O(0),c(null),V(Object(p.a)({},G)),E({}),me(!1),J(!1)};return r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Alert Release Form"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,P),r.a.createElement(un,{activeStep:_,isUpdatingRelease:ee,triggersState:pe,setTriggersState:ge,generalData:q,setGeneralData:V,internalAlertLevel:M,setInternalAlertLevel:N,setPublicAlertLevel:Y,setModalTitle:F,ewiPayload:b,hasNoGroundData:K,setHasNoGroundData:J,currentTriggersStatus:ye,setDBSavedTriggers:ve,siteCurrentAlertLevel:ie,setSiteCurrentAlertLevel:le,isAlert0:se,setAlert0:me,isAlertRecomputing:Se})),r.a.createElement(Fe.a,null,_===A.length?r.a.createElement("div",null,r.a.createElement(g.a,{onClick:ke,color:"primary"},"Okay")):r.a.createElement(y.a,{container:!0,spacing:1,justify:"space-between"},r.a.createElement(y.a,{item:!0,xs:!0,style:{display:null===l?"flex":"none"}},r.a.createElement(g.a,{onClick:s,className:m.backButton},"Release Routine")),r.a.createElement(y.a,{item:!0,xs:!0,align:"right"},r.a.createElement(g.a,{onClick:ke,color:"primary"},"Cancel"),r.a.createElement(g.a,{disabled:0===_,onClick:function(){O((function(e){return e-1}))},className:m.backButton},"Back"),r.a.createElement(g.a,{variant:"contained",color:"primary",onClick:function(){O((function(e){return e+1}));var e=q.siteId,t=q.siteCode,a=q.publicAlertSymbol,n=q.dataTimestamp,r=q.releaseTime,i=q.reporterIdMt,l=q.reporterIdCt,c=q.comments,o=q.triggerListStr,s=[],m={};if(0===_)E(Object(p.a)({},b,{site_id:e.value,site_code:t,public_alert_level:R,public_alert_symbol:a,release_details:{data_ts:re()(n).format("YYYY-MM-DD HH:mm:00"),trigger_list_str:o,release_time:re()(r).format("HH:mm:00")},publisher_details:{publisher_mt_id:i,publisher_ct_id:l},non_triggering_moms:[]}));else if(1===_){var u={latest_trigger_list:s=function(e){var t=[];return Object.keys(e).forEach((function(a){if(e[a].switchState){var n=e[a].triggers,r="on_demand"===a?"on demand":a;n.forEach((function(e){var n=e.timestamp,i=e.alert_level,l=e.internal_sym_id,c=e.tech_info,o=null;null!==n&&(o=n.format("YYYY-MM-DD HH:mm:00"));var s,m=i;switch("nd"===i?m=-1:"rx"===i&&(m=-2),a){case"moms":s={moms_id_list:e.moms_id_list};break;case"on_demand":s={od_details:{request_ts:o,narrative:e.reason,reporter_id:e.reporterId}};break;case"earthquake":var u=e.magnitude,d=e.latitude,g=e.longitude;s={eq_details:{magnitude:parseFloat(u),latitude:parseFloat(d),longitude:parseFloat(g)}};break;default:s={}}var f=Object(p.a)({},s,{alert_level:m,internal_sym_id:l,tech_info:c,trigger_type:r,ts_updated:o});t.push(f)}))}})),t}(pe),current_trigger_list:Ee,has_no_ground_data:K,is_alert_0:se};console.log("JSON data for alert generation recomputation",u),Ce(!0);var d=s.filter((function(e){return e.alert_level>0}));!function(e,t){ot("".concat(k,"/api/monitoring/create_release_details"),e,t)}(u,(function(e){var t=e.internal_alert_level,a=e.public_alert_level,n=e.trigger_list_str,r=e.public_alert_symbol;Y(a),N(t),E(Object(p.a)({},b,{public_alert_level:a,public_alert_symbol:r,internal_alert_level:t,release_details:Object(p.a)({},b.release_details,{trigger_list_str:n}),trigger_list_arr:d,to_extend_validity:pn(K,pe)})),Ce(!1)}))}else _===A.length-1&&(F(""),(m=b).release_details.comments=c,E(m),console.log("Submitting data...",b),We("insert_ewi",b))},disabled:S},_===A.length-1?"Submit":"Next"))))))})),En=a(260),vn=a(609),hn=a(261),_n=a(194),yn=a(557),On=Object(x.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{margin:"auto"},cardHeader:{padding:e.spacing(1,2)},list:{width:200,height:230,backgroundColor:e.palette.background.paper,overflow:"auto"},button:{margin:e.spacing(.5,0)}}}));function xn(e,t){return e.filter((function(e){return!t.some((function(t){return t.value===e.value}))}))}function jn(e,t){return e.filter((function(e){return t.some((function(t){return t.value===e.value}))}))}var Sn=function(e){var t=e.routineData,a=e.setRoutineData,i=e.a0SiteList,l=e.setA0SiteList,c=e.NDSiteList,m=e.setNDSiteList,u=e.dataTimestamp,d=e.setDataTimestamp,f=On(),b=r.a.useContext(ja).reporter_id_ct,E=Object(n.useState)(null),v=Object(o.a)(E,2),h=v[0],_=v[1];Object(n.useEffect)((function(){_(t.release_time)}),[t]);var O=t.reporter_id_mt,x=function(e){return function(n){var r=Object(p.a)({},t,Object(s.a)({},e,n));d(re()(n).format("YYYY-MM-DD HH:mm:00")),a(r)}},j=r.a.useState([]),S=Object(o.a)(j,2),C=S[0],k=S[1],A=jn(C,i.site_id_list),w=jn(C,c.site_id_list),D=function(e,t){return function(){var a=C.findIndex((function(t){return t.value===e})),n=Object(Ke.a)(C);if(-1===a){var r=t.find((function(t){return t.value===e}));n.push(r)}else n.splice(a,1);k(n)}},M=function(e){return jn(C,e).length},I=function(e){return function(){var t,a;M(e)===e.length?k(xn(C,e)):k((t=C,a=e,[].concat(Object(Ke.a)(t),Object(Ke.a)(xn(a,t)))))}},N=function(e,t){var a=t.site_id_list;return r.a.createElement(Na.a,null,r.a.createElement(vn.a,{className:f.cardHeader,avatar:r.a.createElement(Ot.a,{onClick:I(a),checked:M(a)===a.length&&0!==a.length,indeterminate:M(a)!==a.length&&0!==M(a),disabled:0===a.length,inputProps:{"aria-label":"all site_id_list selected"}}),title:e}),r.a.createElement(Oe.a,null),r.a.createElement(En.a,{className:f.list,dense:!0,component:"div",role:"list"},a.map((function(e){var t=e.value,n=e.label,i="transfer-list-all-item-".concat(t,"-label");return r.a.createElement(hn.a,{key:t,role:"listitem",button:!0,onClick:D(t,a)},r.a.createElement(yn.a,null,r.a.createElement(Ot.a,{checked:C.some((function(e){return e.value===t})),tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":i}})),r.a.createElement(_n.a,{id:i,primary:n}))})),r.a.createElement(hn.a,null)))};return r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:f.inputGridContainer},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Data timestamp",value:u,onChange:x("data_timestamp"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,error:null===u})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:f.inputGridContainer},r.a.createElement(Pa.a,{required:!0,autoOk:!0,ampm:!1,label:"Time of release",mask:"__:__",placeholder:"00:00",value:h,onChange:x("release_time"),clearable:!0})),r.a.createElement(y.a,{container:!0,spacing:2,justify:"center",alignItems:"center",className:f.root},r.a.createElement(y.a,{item:!0},N("A0 Sites",i)),r.a.createElement(y.a,{item:!0},r.a.createElement(y.a,{container:!0,direction:"column",alignItems:"center"},r.a.createElement(g.a,{variant:"outlined",size:"small",className:f.button,onClick:function(){m(Object(p.a)({},c,{site_id_list:c.site_id_list.concat(A)})),l(Object(p.a)({},i,{site_id_list:xn(i.site_id_list,A)})),k(xn(C,A))},disabled:0===A.length,"aria-label":"move selected NDSiteList"},">"),r.a.createElement(g.a,{variant:"outlined",size:"small",className:f.button,onClick:function(){l(Object(p.a)({},i,{site_id_list:i.site_id_list.concat(w)})),m(Object(p.a)({},c,{site_id_list:xn(c.site_id_list,w)})),k(xn(C,w))},disabled:0===w.length,"aria-label":"move selected a0SiteList"},"<"))),r.a.createElement(y.a,{item:!0},N("ND Sites",c))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:f.inputGridContainer},r.a.createElement(xa,{variant:"standard",label:"MT Personnel",div_id:"reporter_id_mt",value:O,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:f.inputGridContainer},r.a.createElement(xa,{variant:"standard",label:"CT Personnel",div_id:"reporter_id_ct",value:b,disabled:!0}))))};function Cn(e){var t=[];return e.length>0&&(t=e.map((function(e){var t=e.site_code;return{state:!0,value:e.site_id,label:t.toUpperCase(),is_disabled:!1}}))),t}var kn=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.chosenCandidateAlert,c=e.setChosenCandidateAlert,s=I().user_id,m=r.a.useContext(ja).reporter_id_ct,u=Object(n.useContext)(qt).sites,d=Object(n.useState)({}),f=Object(o.a)(d,2),b=f[0],E=f[1],v={public_alert_symbol:"A0",public_alert_level:"0",data_ts:null,release_time:re()(),general_status:"routine",reporter_id_ct:m,reporter_id_mt:s,non_triggering_moms:{}},h=Object(n.useState)(Object(p.a)({},v)),_=Object(o.a)(h,2),y=_[0],O=_[1],x=Object(n.useState)(Object(p.a)({},{site_id_list:[],internal_alert_level:"A0",trigger_list_str:null})),j=Object(o.a)(x,2),S=j[0],C=j[1],A=Object(n.useState)(Object(p.a)({},{site_id_list:[],internal_alert_level:"ND",trigger_list_str:null})),w=Object(o.a)(A,2),D=w[0],M=w[1],N=Object(n.useState)([]),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(null),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=0===S.site_id_list.length&&0===D.site_id_list.length||""===m;return Object(n.useEffect)((function(){O(Object(p.a)({},v));var e=Cn(u);R(e)}),[u]),Object(n.useEffect)((function(){var e,t;null===l&&(null!==L?(e=L,t=function(e){var t=Cn(e.unreleased_sites);C(Object(p.a)({},S,{site_id_list:t}))},st("".concat(k,"/api/monitoring/get_unreleased_routine_sites/").concat(e),t)):(C(Object(p.a)({},S,{site_id_list:[]})),M(Object(p.a)({},D,{site_id_list:[]}))))}),[L,l]),Object(n.useEffect)((function(){if("undefined"!==typeof l&&null!==l&&"routine"===l.general_status){var e=Object(p.a)({},l);delete e.routine_details;var t=Object(p.a)({},v,{},e);O(t),P(e.data_ts),Object(p.a)({},l).routine_details.forEach((function(e){var t=e.site_id_list,a=e.internal_alert_level,n=H.filter((function(e){return t.includes(e.value)})),r=Object(p.a)({},e,{site_id_list:n});"A0"===a?C(r):M(r)})),E(Object(p.a)({},b))}}),[l,H]),r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Routine Release Form"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,'Transfer site codes to their respective list if needed. Put sites with ground data on "A0 Sites" list while put sites without ground data on "ND Sites".'),r.a.createElement(Sn,{routineData:y,setRoutineData:O,a0SiteList:S,setA0SiteList:C,NDSiteList:D,setNDSiteList:M,dataTimestamp:L,setDataTimestamp:P})),r.a.createElement(Fe.a,null,r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(g.a,{onClick:function(){i(),c(null),P(null)},color:"primary"},"Cancel"),r.a.createElement(g.a,{variant:"contained",color:"primary",onClick:function(){var e=re()(y.data_ts).format("YYYY-MM-DD HH:mm:ss"),t=re()(y.release_time).format("HH:mm:ss"),a=Object(p.a)({},y,{data_timestamp:e,release_time:t,routine_details:[Object(p.a)({},S),Object(p.a)({},D)]});console.log("Submitting data...",a),We("insert_ewi",a),i()},disabled:F},"Submit"))))))})),An=a(610),wn=a(611),Dn=a(612),Mn=a(306),In=a.n(Mn);var Nn=[{active:!0,barangay:"Agbatuan",municipality:"Dumarao",province:"Capiz",psgc:61904001,purok:null,region:"VI",season:1,site_code:"agb",site_id:1,sitio:null,latitude:11.28137,longitude:122.8311},{active:!0,barangay:"Poblacion",municipality:"Bakun",province:"Benguet",psgc:141103009,purok:null,region:"CAR",season:2,site_code:"bak",site_id:2,sitio:null,latitude:16.7907,longitude:120.6616},{active:!0,barangay:"Banlasan",municipality:"Calape",province:"Bohol",psgc:71210003,purok:null,region:"VI",season:1,site_code:"ban",site_id:3,sitio:null,latitude:9.888559,longitude:123.9488},{active:!0,barangay:"Baras",municipality:"Tarangnan",province:"Samar",psgc:86020008,purok:null,region:"VIII",season:1,site_code:"bar",site_id:4,sitio:null,latitude:11.90208,longitude:124.6566},{active:!0,barangay:"Bayabas",municipality:"Labo",province:"Camarines Norte",psgc:51606009,purok:null,region:"V",season:1,site_code:"bay",site_id:5,sitio:null,latitude:14.18797,longitude:122.4675},{active:!0,barangay:"Boloc",municipality:"Tubungan",province:"Iloilo",psgc:63046016,purok:null,region:"VI",season:2,site_code:"blc",site_id:6,sitio:null,latitude:10.82665,longitude:122.3108},{active:!0,barangay:"Bolodbolod",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412004,purok:"3 & 4",region:"VIII",season:1,site_code:"bol",site_id:7,sitio:null,latitude:10.30199,longitude:125.1279},{active:!0,barangay:"Bato",municipality:"Sibonga",province:"Cebu",psgc:72246007,purok:null,region:"VI",season:1,site_code:"bto",site_id:8,sitio:null,latitude:10.01379,longitude:123.5776},{active:!0,barangay:"San Carlos",municipality:"Dapa",province:"Surigao del Norte",psgc:166707025,purok:null,region:"XIII",season:1,site_code:"car",site_id:9,sitio:null,latitude:9.719629,longitude:125.9737},{active:!0,barangay:"Cudog",municipality:"Lagawe",province:"Ifugao",psgc:142704010,purok:null,region:"CAR",season:2,site_code:"cud",site_id:10,sitio:"Natuwolan at Wadwad",latitude:16.80931,longitude:121.1047},{active:!0,barangay:"Dadong",municipality:"Tarragona",province:"Davao Oriental",psgc:112511003,purok:null,region:"XI",season:1,site_code:"dad",site_id:11,sitio:"Sagasa",latitude:7.13731,longitude:126.4509},{active:!0,barangay:"Gaas",municipality:"Balamban",province:"Cebu",psgc:72208014,purok:null,region:"VII",season:1,site_code:"gaa",site_id:12,sitio:null,latitude:10.42352,longitude:123.7851},{active:!0,barangay:"Gamut",municipality:"Tago",province:"Surigao del Sur",psgc:166818012,purok:null,region:"XIII",season:1,site_code:"gam",site_id:13,sitio:null,latitude:9.0101,longitude:126.1676},{active:!0,barangay:"1 & 2",municipality:"Hinabangan",province:"Samar",psgc:86008012,purok:null,region:"VIII",season:1,site_code:"hin",site_id:14,sitio:null,latitude:11.70064,longitude:125.0691},{active:!0,barangay:"Humayhumay",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611013,purok:null,region:"VII",season:1,site_code:"hum",site_id:15,sitio:null,latitude:10.18392,longitude:123.2503},{active:!0,barangay:"Imelda",municipality:"Tarangnan",province:"Samar",psgc:86020024,purok:null,region:"VIII",season:1,site_code:"ime",site_id:16,sitio:null,latitude:11.90383,longitude:124.7526},{active:!0,barangay:"Immuli",municipality:"Pidigan",province:"Abra",psgc:140118005,purok:null,region:"CAR",season:2,site_code:"imu",site_id:17,sitio:null,latitude:17.52308,longitude:120.6046},{active:!0,barangay:"Inabasan",municipality:"Maasin",province:"Iloilo",psgc:63029025,purok:null,region:"VI",season:2,site_code:"ina",site_id:18,sitio:"Sambag",latitude:10.86991,longitude:122.4362},{active:!0,barangay:"Poblacion 1",municipality:"San Jorge",province:"Samar",psgc:86025024,purok:null,region:"VIII",season:1,site_code:"jor",site_id:19,sitio:null,latitude:11.97779,longitude:124.8249},{active:!0,barangay:"Ambuklao",municipality:"Bokod",province:"Benguet",psgc:141104001,purok:null,region:"CAR",season:2,site_code:"lab",site_id:20,sitio:"Labey",latitude:16.47032,longitude:120.7054},{active:!0,barangay:"Laygayon",municipality:"Pinabacdao",province:"Samar",psgc:86013013,purok:null,region:"VIII",season:1,site_code:"lay",site_id:21,sitio:null,latitude:11.5127,longitude:125.0257},{active:!0,barangay:"Lipanto",municipality:"St. Bernard",province:"Southern Leyte",psgc:86412016,purok:"1",region:"VIII",season:1,site_code:"lip",site_id:22,sitio:null,latitude:10.22767,longitude:125.1266},{active:!0,barangay:"Looc",municipality:"Villanueva",province:"Misamis Oriental",psgc:104326011,purok:null,region:"X",season:1,site_code:"loo",site_id:23,sitio:null,latitude:8.597964,longitude:124.7775},{active:!0,barangay:"Lipata",municipality:"Paranas",province:"Samar",psgc:86022016,purok:null,region:"VIII",season:1,site_code:"lpa",site_id:24,sitio:null,latitude:11.78625,longitude:125.0196},{active:!0,barangay:"Literon",municipality:"Calbiga",province:"Samar",psgc:86004017,purok:null,region:"VIII",season:1,site_code:"lte",site_id:25,sitio:null,latitude:11.59037,longitude:125.0903},{active:!0,barangay:"Lunas",municipality:"Maasin City",province:"Southern Leyte",psgc:86407034,purok:null,region:"VIII",season:1,site_code:"lun",site_id:26,sitio:"Caianuhan",latitude:10.25819,longitude:124.877},{active:!0,barangay:"Magsaysay",municipality:"Kibawe",province:"Bukidnon",psgc:101308016,purok:"1, 2 & 3",region:"X",season:1,site_code:"mag",site_id:27,sitio:null,latitude:7.51923,longitude:125.0598},{active:!0,barangay:"Ambassador",municipality:"Tublay",province:"Benguet",psgc:141114001,purok:null,region:"CAR",season:2,site_code:"mam",site_id:28,sitio:"Mamuyod",latitude:16.4883,longitude:120.689},{active:!0,barangay:"Marirong",municipality:"Leon",province:"Iloilo",psgc:63028059,purok:null,region:"VI",season:2,site_code:"mar",site_id:29,sitio:null,latitude:10.827459,longitude:122.321555},{active:!0,barangay:"Mac-Arthur",municipality:"Esperanza",province:"Agusan del Sur",psgc:160303010,purok:null,region:"XIII",season:1,site_code:"mca",site_id:30,sitio:null,latitude:8.58543,longitude:125.741},{active:!0,barangay:"Manghulyawon",municipality:"La Libertad",province:"Negros Oriental",psgc:184613013,purok:null,region:"VII",season:1,site_code:"mng",site_id:31,sitio:"Dao",latitude:10.04793,longitude:123.2062},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msl",site_id:32,sitio:"Lower Mesolong",latitude:7.629616,longitude:125.5445},{active:!0,barangay:"Sto. Nino",municipality:"Talaingod",province:"Davao del Norte",psgc:112322003,purok:null,region:"XI",season:1,site_code:"msu",site_id:33,sitio:"Upper Mesolong",latitude:7.628743,longitude:125.5403},{active:!0,barangay:"Nagyubuyuban",municipality:"San Fernando City",province:"La Union",psgc:13314034,purok:"5",region:"I",season:2,site_code:"nag",site_id:34,sitio:null,latitude:16.62678,longitude:120.4176},{active:!0,barangay:"Nurcia",municipality:"Lanuza",province:"Surigao del Sur",psgc:166810011,purok:null,region:"XIII",season:1,site_code:"nur",site_id:35,sitio:null,latitude:9.269702,longitude:126.1384},{active:!0,barangay:"Oslao",municipality:"San Francisco",province:"Surigao del Norte",psgc:166719010,purok:null,region:"XIII",season:1,site_code:"osl",site_id:36,sitio:null,latitude:9.75719,longitude:125.4014},{active:!0,barangay:"Parasanon",municipality:"Pinabacdao",province:"Samar",psgc:86013022,purok:null,region:"VIII",season:1,site_code:"par",site_id:37,sitio:null,latitude:11.51487,longitude:125.0255},{active:!0,barangay:"Pepe",municipality:"Leon",province:"Iloilo",psgc:63028070,purok:null,region:"VI",season:2,site_code:"pep",site_id:38,sitio:"Bangi",latitude:10.78788,longitude:122.3336},{active:!0,barangay:"Pinagkamaligan",municipality:"Calauag",province:"Quezon",psgc:45607060,purok:null,region:"IVB",season:1,site_code:"pin",site_id:39,sitio:null,latitude:13.9536,longitude:122.2855},{active:!0,barangay:"Planas",municipality:"Guihulngan City",province:"Negros Oriental",psgc:184611027,purok:null,region:"VII",season:1,site_code:"pla",site_id:40,sitio:"Mambog",latitude:10.15984,longitude:123.2459},{active:!0,barangay:"Pange",municipality:"Matnog",province:"Sorsogon",psgc:56212032,purok:null,region:"V",season:1,site_code:"png",site_id:41,sitio:null,latitude:12.63063,longitude:124.0183},{active:!0,barangay:"Puguis",municipality:"La Trinidad",province:"Benguet",psgc:141110013,purok:null,region:"CAR",season:2,site_code:"pug",site_id:42,sitio:"Longlong",latitude:16.44655,longitude:120.5706},{active:!0,barangay:"Antadao",municipality:"Sagada",province:"Mt. Province",psgc:144409005,purok:null,region:"CAR",season:2,site_code:"sag",site_id:43,sitio:null,latitude:17.08263,longitude:120.9248},{active:!0,barangay:"Sibajay",municipality:"Boston",province:"Davao Oriental",psgc:112503006,purok:null,region:"XI",season:1,site_code:"sib",site_id:44,sitio:null,latitude:7.82567,longitude:126.3834},{active:!0,barangay:"Amgaleyguey",municipality:"Buguias",province:"Benguet",psgc:141105002,purok:null,region:"CAR",season:2,site_code:"sin",site_id:45,sitio:"Sinipsip",latitude:16.7234,longitude:120.7815},{active:!0,barangay:"Sumalsag",municipality:"Malitbog",province:"Bukidnon",psgc:101313011,purok:null,region:"X",season:1,site_code:"sum",site_id:46,sitio:null,latitude:8.54511,longitude:124.8597},{active:!0,barangay:"Talahid",municipality:"Almeria",province:"Biliran",psgc:87801012,purok:null,region:"VIII",season:1,site_code:"tal",site_id:47,sitio:null,latitude:11.63742,longitude:124.3665},{active:!0,barangay:"Taga",municipality:"Pinukpuk",province:"Kalinga",psgc:143209022,purok:null,region:"CAR",season:2,site_code:"tga",site_id:48,sitio:null,latitude:17.57347,longitude:121.3834},{active:!0,barangay:"Tue",municipality:"Tadian",province:"Mt. Province",psgc:144410019,purok:null,region:"CAR",season:2,site_code:"tue",site_id:49,sitio:null,latitude:16.97229,longitude:120.8286},{active:!0,barangay:"Umingan",municipality:"Alimodian",province:"Iloilo",psgc:63002053,purok:null,region:"VI",season:2,site_code:"umi",site_id:50,sitio:null,latitude:10.90807,longitude:122.3278}],Tn=Qt(Nn);var Hn=Object(d.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1},formControl:{width:"-webkit-fill-available"},formLabel:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},justify:{display:"flex",justifyContent:"space-evenly"}}}))((function(e){var t=e.classes,a=e.issueReminderData,i=e.setIssueReminderData,l=e.fullScreen,c=e.toResolve,m=a.iar_id,u=a.detail,d=a.ts_expiration,g=a.resolution,f=a.is_event_entry,E=a.site_id_list,v=Object(n.useState)("general"),h=Object(o.a)(v,2),_=h[0],O=h[1],x=Object(n.useState)(_),j=Object(o.a)(x,2),S=j[0],C=j[1],k=Object(n.useState)(S),A=Object(o.a)(k,2),w=A[0],D=A[1],M=Object(n.useState)(!1),I=Object(o.a)(M,2),N=I[0],T=I[1],H=Object(n.useState)(!1),R=Object(o.a)(H,2),Y=R[0],B=R[1];Object(n.useEffect)((function(){if(T(f),""!==m&&"undefined"!==typeof m){var e=E.map((function(e){return Tn.filter((function(t){return t.value===e})).pop()}));i(Object(p.a)({},a,{site_id_list:e}))}null!==E&&"undefined"!==typeof E&&E.length>0&&(O("site"),C("site"),D("site")),null===d&&B(!0)}),[]),Object(n.useEffect)((function(){}),[a]);var L,P=function(e){return function(t){var n=t.target.value;i(Object(p.a)({},a,Object(s.a)({},e,n)))}},F=function(e){var t=e.target,n=t.value,r=t.checked;switch(n){case"is_event_entry":T(r),r||B(!1),i(Object(p.a)({},a,{is_event_entry:r}));break;case"is_persistent":B(r),i(Object(p.a)({},a,{is_persistent:r}))}};return r.a.createElement(jt.a,{utils:xt.a},c?r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Resolution",value:g||"",onChange:P("resolution"),placeholder:"Enter resolution",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField}))):r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Be.a,{"aria-label":"position",name:"position",value:S,onChange:function(e){var t=e.target.value;C(t),D(t)},row:!0,className:l?"":t.justify},r.a.createElement(Le.a,{value:"general",control:r.a.createElement(Pe.a,{color:"primary"}),label:"General issue/reminder",labelPlacement:"end"}),r.a.createElement(Le.a,{value:"site",control:r.a.createElement(Pe.a,{color:"primary"}),label:"Site-specific issue/reminder",labelPlacement:"end"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{style:{marginBottom:8}})),"site"===w&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Zt,{value:E,changeHandler:function(e){return i(Object(p.a)({},a,{site_id_list:e}))},isMulti:!0,includeAddressOnOptions:!1})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Le.a,{key:"is_event_entry",control:r.a.createElement(Ot.a,{checked:N,onChange:F,value:"is_event_entry",className:t.checkboxes}),label:r.a.createElement("div",null,"Related to current monitoring event ",r.a.createElement(yt.a,{title:"Checking this will make the issue/reminder expire at the end of site(s) current monitoring event validity"},r.a.createElement("strong",null,"[?]"))),className:"primary"}))),(w||!N)&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(Le.a,{key:"is_persistent",control:r.a.createElement(Ot.a,{checked:Y,onChange:F,value:"is_persistent",className:t.checkboxes}),label:"Persistent reminder",className:"primary"})),Y?r.a.createElement(y.a,{item:!0,md:6}):r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(St.b,{autoOk:!0,label:"Issue/Reminder Expiration",value:d,onChange:(L="ts_expiration",function(e){i(Object(p.a)({},a,Object(s.a)({},L,e)))}),ampm:!1,format:"YYYY-MM-DD HH:mm:ss",mask:"____-__-__ __:__:__",clearable:!0}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{style:{margin:"8px 0"}})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{required:!0,label:"Details",value:u,onChange:P("detail"),placeholder:"Enter detail",multiline:!0,rowsMax:6,fullWidth:!0,className:t.textField}))))})),Rn={detail:"",iar_id:"",site_id_list:null,user_id:"",postings:"",resolution:null,resolved_by:null,ts_resolved:null,ts_posted:re()().format("YYYY-MM-DD HH:mm:ss"),ts_expiration:null,is_event_entry:!1,is_persistent:!1};var Yn=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.setIsIandRUpdateNeeded,c=e.chosenIssueReminder,s=e.isIandRUpdateNeeded,m=e.toResolve,u=Object(n.useState)({}),d=Object(o.a)(u,2),f=d[0],b=d[1];Object(n.useEffect)((function(){if(s){var e=c,t=c.postings.map((function(e){return e.site_id})),a=[];c.postings.forEach((function(e){var t=e.event;null!==t&&a.push(t)})),e.site_id_list=t,e.is_event_entry=a.length>0,b(e)}else b(Rn)}),[a,c]);var E=function(){l(!1),i(!1)};return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Issues and Reminder Form"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Provide information to the following fields."),r.a.createElement(Hn,{issueReminderData:f,setIssueReminderData:b,fullScreen:t,toResolve:m})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:E,color:"primary"},"Cancel"),r.a.createElement(g.a,{color:"secondary",onClick:function(){if(""!==f.resolution){var e=I().user_id;!function(e,t){var a=e,n=e.ts_posted,r=e.ts_expiration,i=e.site_id_list,l=[];null!==i&&i.forEach((function(e){var t=e.value;l.push(t)})),a.user_id=I().user_id,a.ts_posted=re()(n).format("YYYY-MM-DD HH:mm:ss"),"Invalid date"!==r&&(a.ts_expiration=re()(r).format("YYYY-MM-DD HH:mm:ss")),a.site_id_list=l,We("write_issues_and_reminders",a)}(Object(p.a)({},f,{ts_resolved:re()().format("YYYY-MM-DD HH:mm:ss"),resolved_by:e})),E()}},disabled:!1},"Submit")))})),Bn=Object(x.a)((function(e){return{inputGridContainer:{marginTop:8,marginBottom:8},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),gridList:{height:"100vh",margin:"0 !important",boxShadow:"0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12)","&::-webkit-scrollbar":{width:5},"&::-webkit-scrollbar-track":{boxShadow:"inset 0 0 5px grey"},"&::-webkit-scrollbar-thumb":{background:"rgba(127, 127, 127, 0.7)"},position:"sticky",top:148,padding:8},hasNoIssues:{display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"},icon:{color:"rgba(255, 255, 255, 0.54)"},previewText:{padding:"12px",fontSize:"14px"},tile:{border:"0.5px solid #b2b2b2",padding:"0 !important",marginBottom:6,"&:last-of-type":{marginBottom:0}},tileBar:{background:"#7f7f7f",height:"50px !important"}}}));function Ln(e){var t=e.isCardModalOpen,a=e.chosenIssueReminder,n=e.setCardModalOpen,i=e.setIsOpenIssueReminderModal,l=e.setToResolve,c=e.setIsIandRUpdateNeeded,o=a.site_list,s=a.ts_posted,m=a.detail,u=a.issue_reporter,d=u.first_name,p=u.last_name,f=Pn(o,!1),b=re()(s).format("DD MMMM YYYY, HH:mm");return r.a.createElement(Ne.a,{open:t,maxWidth:"sm"},r.a.createElement(Te.a,{style:{paddingBottom:8}},r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(In.a,{style:{paddingRight:8}})," ",f)),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,b),r.a.createElement(Re.a,{style:{textIndent:40},align:"justify"},m),r.a.createElement(Re.a,{align:"right",style:{marginBottom:0}},"".concat(d," ").concat(p))),r.a.createElement(Fe.a,{disableSpacing:!0},r.a.createElement(g.a,{onClick:function(){n(!1),l(!1),i(!0),c(!0)},color:"primary"},"Edit"),r.a.createElement(g.a,{onClick:function(){n(!1),l(!0),i(!0),c(!0)},color:"secondary"},"Resolve"),r.a.createElement(g.a,{onClick:function(){return n(!1)},color:"primary",autoFocus:!0},"Close")))}function Pn(e,t){var a=t?"GENERAL":"General";return 0!==e.length&&(a=e.join(", ")),a}var Fn=function(e){var t=e.isOpenIssueReminderModal,a=e.setIsOpenIssueReminderModal,i=e.isIandRUpdateNeeded,l=e.setIsIandRUpdateNeeded,c=Bn(),s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],g=Object(n.useState)(!1),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)({site_list:[],site_id_list:null,ts_posted:null,detail:"",issue_reporter:{first_name:"",last_name:""}}),h=Object(o.a)(v,2),_=h[0],y=h[1],x=Object(n.useState)(!1),j=Object(o.a)(x,2),S=j[0],C=j[1],k=Object(n.useState)(!1),A=Object(o.a)(k,2),w=A[0],D=A[1];Object(n.useEffect)((function(){var e;e=function(e){E(!1);var t=r.a.createElement(O.a,{component:"div",style:{fontStyle:"italic",width:"auto",height:0}},"No active issues");if(0!==e.length){var a=function(e){return e.map((function(e,t){var a=[],n=[],r=[],i=null===e.ts_expiration;e.postings.forEach((function(e){var t=e.event_id,i=e.site_id,l=e.site;null!==i&&(a.push(i),n.push(l.site_code.toUpperCase()),r.push(t))}));var l=0!==r.length;return Object(p.a)({},e,{site_id_list:a,site_list:n,site_events_list:r,is_event_entry:l,is_persistent:i})}))}(e);t=function(e,t,a){return t.map((function(t,n){var i=t.site_list,l=t.detail,c=t.issue_reporter,o=Pn(i);return r.a.createElement(An.a,{key:"test ".concat(n+1),cols:2,className:e.tile},r.a.createElement(O.a,{className:e.previewText},l),r.a.createElement(wn.a,{className:e.tileBar,title:o,subtitle:"".concat(c.first_name," ").concat(c.last_name),actionIcon:r.a.createElement(yt.a,{title:"Expand card"},r.a.createElement(G.a,{"aria-label":"Expand",className:e.icon,onClick:a(t)},r.a.createElement(In.a,null)))}))}))}(c,a,M),E(!0)}d(t)},Ge(),_e.on("receive_issues_and_reminders",(function(t){var a=JSON.parse(t);e(a)}))}),[c]);var M=function(e){return function(t){y(e),C(!0)}};return r.a.createElement(n.Fragment,null,r.a.createElement(Dn.a,{component:"div",cellHeight:"auto",className:"".concat(c.gridList," ").concat(!b&&c.hasNoIssues)},u),r.a.createElement(Ln,{isCardModalOpen:S,setCardModalOpen:C,chosenIssueReminder:_,setToResolve:D,setIsOpenIssueReminderModal:a,setIsIandRUpdateNeeded:l}),r.a.createElement(Yn,{isOpen:t,isIandRUpdateNeeded:i,chosenIssueReminder:_,setIsIandRUpdateNeeded:l,toResolve:w,closeHandler:function(){a(!1)}}))},zn=a(613),Gn=a(614),Un=a(409),Wn=a.n(Un);var qn=Object(pe.a)(Object(d.a)((function(e){return{fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:1}}})),Object(ie.a)())((function(e){var t=e.classes,a=e.clickHandler,n=e.width;return r.a.createElement(zn.a,{in:!0,unmountOnExit:!0,style:{transitionDelay:"100ms"}},r.a.createElement(Gn.a,{color:"secondary","aria-label":"Add",className:t.fab,size:Object(ie.c)("md",n)?"large":"medium",onClick:a},r.a.createElement(Wn.a,null)))})),Vn=a(615);function Qn(e){var t=e.momsEntry,a=e.updateField,n=e.isAddingNewInstance,i=e.location,l=e.site_code,c=t.moms,o=t.options;return r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Wt,{label:"Feature Type",options:o.feature_type,value:c.feature_type,changeHandler:a("feature_type"),placeholder:"Select feature type",renderDropdownIndicator:!0,openMenuOnClick:!0})),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1},r.a.createElement(yt.a,{title:"Feature names are auto-generated. To add new MOMs feature name, choose (Add new instance)",placement:"top",interactive:!0},r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Wt,{label:"Feature Name",options:o.feature_name.options,isDisabled:o.feature_name.disabled,value:c.feature_name,changeHandler:a("feature_name"),placeholder:o.feature_name.disabled?"Disabled":"Select feature name",renderDropdownIndicator:!0,openMenuOnClick:!0}))),n&&r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Location",multiline:!0,rowsMax:"2",placeholder:"Enter location of new instance",value:i,onChange:a("location"),fullWidth:!0,InputLabelProps:{shrink:!0}}))),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(Wt,{label:"Alert Level",options:o.alert_level.options,isDisabled:o.alert_level.disabled,value:c.alert_level,changeHandler:a("alert_level"),placeholder:o.alert_level.disabled?"Disabled":"Select alert level",renderDropdownIndicator:!0,openMenuOnClick:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Observance Timestamp",value:c.observance_ts,onChange:a("observance_ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Narrative",multiline:!0,rowsMax:"2",placeholder:"Enter report narrative",value:c.narrative,onChange:a("narrative"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(xa,{variant:"standard",label:"Reporter",div_id:"reporter",changeHandler:a("reporter"),value:c.reporter,isCommunityStaff:"true",site_code:l})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(b.a,{label:"Remarks",multiline:!0,rowsMax:"2",placeholder:"Enter expert's remarks",value:c.remarks,onChange:a("remarks"),fullWidth:!0,InputLabelProps:{shrink:!0}})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:6},r.a.createElement(xa,{variant:"standard",label:"Validator",div_id:"validator",changeHandler:a("validator"),value:c.validator})))}var Zn=function(e){var t=e.momsEntries,a=e.setMomsEntries,i=e.siteCode,l=e.site,c=e.setSite,s=e.selectSite,m="undefined"!==typeof s&&s,u=Object(n.useState)(!1),d=Object(o.a)(u,2),p=d[0],f=d[1],b=function(e){return function(t){return function(n){var r="";"feature_name"===t&&("(Add new instance)"===n.label?f(!0):f(!1)),["feature_type","feature_name","alert_level","observance_ts"].includes(t)?r=n:["narrative","remarks","reporter","validator","location"].includes(t)&&(r=n.target.value),a({action:"UPDATE_DETAILS",key:e,attribute:t,value:r})}}},E=function(e){return function(){return a({action:"DELETE_INSTANCE",key:e})}};return r.a.createElement(n.Fragment,null,m&&r.a.createElement("div",{style:{marginBottom:12}},r.a.createElement(Zt,{value:l,changeHandler:function(e){return c(e)}})),!m||m&&null!==l?r.a.createElement(n.Fragment,null,r.a.createElement(jt.a,{utils:xt.a},t.map((function(e,a){var l=0===a,c=t.length===a+1;return r.a.createElement(n.Fragment,{key:a},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:l?12:0}},r.a.createElement(O.a,{variant:"subtitle2"},"Entry Number ",a+1),!l&&r.a.createElement(G.a,{"aria-label":"delete",color:"primary",onClick:E(a)},r.a.createElement(Vn.a,null))),r.a.createElement(Qn,{momsEntry:e,updateField:b(a),isAddingNewInstance:p,site_code:i}),!c&&r.a.createElement(Oe.a,{style:{margin:"24px 0 12px"},variant:"middle"}))}))),r.a.createElement("div",{style:{margin:"16px 0",textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:function(){return a({action:"ADD_INSTANCE"})}},"Add MOMs Observation"))):r.a.createElement("div",{style:{height:200}}))},Kn={moms:{feature_type:null,feature_name:null,alert_level:null,observance_ts:null,narrative:"",reporter:"",remarks:"",validator:""},options:{feature_type:[],feature_name:{options:[],disabled:!0},alert_level:{options:[],disabled:!0}}};function Jn(e,t){var a=t.action,n=t.key,r=t.attribute,i=t.value,l=JSON.parse(JSON.stringify(e));switch(a){case"OVERWRITE":return Object(Ke.a)(i);case"ADD_INSTANCE":return[].concat(Object(Ke.a)(e),[JSON.parse(JSON.stringify(Kn))]);case"DELETE_INSTANCE":return l.splice(n,1),Object(Ke.a)(l);case"UPDATE_DETAILS":if(l[n].moms[r]=i,"feature_type"===r){var c=i.instances,o=i.alerts,s=c.map((function(e){return{value:e.instance_id,label:rt(e.feature_name)}}));s.push({value:0,label:"(Add new instance)"});var m=o.map((function(e){var t=e.feature_alert_id,a=e.alert_level,n=e.description;return{value:i,feature_alert_id:t,label:a,description:n}})),u=l[n],d=u.moms,g=u.options;l[n].options=Object(p.a)({},g,{feature_name:{options:s,disabled:!1},alert_level:{options:m,disabled:!1}}),l[n].moms=Object(p.a)({},d,{feature_name:null,alert_level:null})}return Object(Ke.a)(l);default:return e}}var Xn=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.match,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1],f=Object(n.useState)(null),b=Object(o.a)(f,2),E=b[0],v=b[1],h=Object(n.useReducer)(Jn,[]),_=Object(o.a)(h,2),y=_[0],O=_[1];Object(n.useEffect)((function(){if("undefined"!==typeof l){var e=l.params.site_code;v(e)}}),[l]),Object(n.useEffect)((function(){null!==u&&v(u.data.site_code)}),[u]);var x=Object(c.useSnackbar)(),j=x.enqueueSnackbar,S=x.closeSnackbar,A=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){S(e)}},"Dismiss")},w=Object(n.useState)([]),D=Object(o.a)(w,2),M=D[0],N=D[1];return Object(n.useEffect)((function(){null!==E&&function(e,t){var a="".concat(k,"/api/manifestations_of_movement/get_moms_features/").concat(e);C.a.get(a).then((function(e){var a=e.data;console.log("MOMs Features",a),t(a)})).catch((function(e){console.error(e)}))}(E,(function(e){var t=e.map((function(e){var t=e.feature_id,a=e.feature_type,n=e.instances,r=e.alerts;return{value:t,label:rt(a),instances:n,alerts:r}}));N(Object(p.a)({},M,{feature_type:t}));var a=Kn;a.options.feature_type=t,O({action:"OVERWRITE",value:[a]})}))}),[E]),r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Insert Manifestation of Movement Form"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Provide manifestation of movement (MOMs) details to save information in our database."),r.a.createElement(Zn,{momsEntries:y,setMomsEntries:O,siteCode:E,site:u,setSite:d,selectSite:!0})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:i,color:"primary"},"Cancel"),r.a.createElement(g.a,{onClick:function(){console.log("moms_entries",y);var e={moms_list:y.map((function(e,t){var a=e.moms,n=a.alert_level,r=a.feature_name,i=a.feature_type,l=a.narrative,c=a.observance_ts,o=a.remarks,s=a.reporter,m=a.validator,u=a.location,d=re()(c).format("YYYY-MM-DD HH:mm:ss"),p=I();return{alert_level:n.label,instance_id:r.value,feature_name:"(Add new instance)"===r.label?null:r.label,feature_type:i.label,report_narrative:l,observance_ts:d,remarks:o,reporter_id:s,validator_id:m,location:u,iomp:p.user_id}})),site_code:E};console.log("PAYLOAD",e),i(),function(e,t,a){var n="".concat(k,"/api/manifestations_of_movement/write_monitoring_moms_to_db");console.log("moms_list",e),C.a.post(n,e).then((function(e){var a=e.data;null!==t&&(console.log("Moms Insert result",a),t(a))})).catch((function(e){console.log(e),null!==a&&a(e)}))}(e,(function(e){e.status?(We("run_alert_generation",{site_code:E}),j("MOMs input success!",{variant:"success",autoHideDuration:7e3,action:A})):j(e.message,{variant:"error",autoHideDuration:7e3,action:A})}),(function(){j("Error MOMS input...",{variant:"error",autoHideDuration:7e3,action:A})}))},color:"primary"},"Submit"))))})),$n=a(616);function er(e){var t=e.clickHandler;return r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:t,startIcon:r.a.createElement($n.a,null)},"Insert MOMs")}var tr=[{label:"Monitoring Tables",href:"monitoring-tables"},{label:"Generated Alerts",href:"generated-alerts"}];var ar=Object(pe.a)(Object(ie.a)(),Object(d.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{tabBar:Object(p.a)({},t.pageContentMargin),tabBarContent:{marginTop:30}})})))((function(e){var t=e.classes,a=e.width,i=e.history,l=Object(n.useState)(0),c=Object(o.a)(l,2),s=c[0],m=c[1],u=Object(n.useState)(null),d=Object(o.a)(u,2),p=d[0],f=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),v=E[0],h=E[1],_=Object(n.useState)(null),O=Object(o.a)(_,2),x=O[0],j=O[1],S=Object(n.useState)(!1),C=Object(o.a)(S,2),k=C[0],A=C[1],w=Object(n.useState)(!1),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)(null),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(!1),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=Object(n.useState)(!1),z=Object(o.a)(F,2),G=z[0],U=z[1],W=Object(n.useState)(!1),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=function(e){return function(){return Q(e)}},K=Object(n.useContext)(qt).setIsReconnecting;Object(n.useEffect)((function(){var e;return Ue(K),e=function(e){return f(e)},Ge(),_e.on("receive_generated_alerts",(function(t){var a=JSON.parse(t);console.log("Generated alerts: ",a),e(a)})),function(e){Ge(),_e.on("receive_candidate_alerts",(function(t){var a=JSON.parse(t);console.log("Candidate alerts: ",a),e(a)}))}((function(e){return h(e)})),Ve((function(e){return j(e)})),function(){qe()}}),[]);var J,X=function(e,t){return function(){"is_open_release_modal"===e?A(t):"is_open_issues_modal"===e?(U(!t),P(t)):"is_routine_modal_open"===e&&I(t)}},$=function(e,t){return function(){R(e),"routine"===t?X("is_routine_modal_open",!0)():X("is_open_release_modal",!0)()}},ee=Object(ie.c)("md",a),te=r.a.createElement("span",null,r.a.createElement(g.a,{"aria-label":"Add issue/reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:X("is_open_issues_modal",!0),startIcon:r.a.createElement(ge.a,null)},"Add issue/reminder"),r.a.createElement("span",{style:{marginRight:8}},r.a.createElement(er,{clickHandler:Z(!0)})),r.a.createElement(g.a,{"aria-label":"Release alert",variant:"contained",color:"primary",size:"small",onClick:$(null),startIcon:r.a.createElement(fe.a,null)},"Release Alert"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(be,{title:"Alert Monitoring | Dashboard",customButtons:!!ee&&te})),r.a.createElement("div",{className:t.tabBar},r.a.createElement(y.a,{container:!0,spacing:3},r.a.createElement(y.a,{item:!0,xs:12,md:3},r.a.createElement(Fn,{isOpenIssueReminderModal:L,setIsOpenIssueReminderModal:P,isIandRUpdateNeeded:G,setIsIandRUpdateNeeded:U})),r.a.createElement(y.a,{item:!0,md:9},r.a.createElement(ye,{chosenTab:s,onSelect:function(e){m(e)},tabsArray:tr}),r.a.createElement("div",{className:t.tabBarContent},0===s&&r.a.createElement(Ia,{width:a,candidateAlertsData:v,alertsFromDbData:x,releaseFormOpenHandler:$,history:i}),1===s&&r.a.createElement(Ba,{generatedAlertsData:p}))))),!ee&&r.a.createElement(qn,{clickHandler:X("is_open_release_modal",!0)}),r.a.createElement(bn,{isOpen:k,closeHandler:X("is_open_release_modal",!1),setChosenCandidateAlert:R,chosenCandidateAlert:H,alertsFromDbData:x,setIsOpenRoutineModal:(J=null,function(){R(J),X("is_open_release_modal",!1)(),X("is_routine_modal_open",!0)()})}),r.a.createElement(kn,{isOpen:M,closeHandler:X("is_routine_modal_open",!1),chosenCandidateAlert:H,setChosenCandidateAlert:R}),r.a.createElement(Xn,{isOpen:V,closeHandler:Z(!1)}))})),nr=a(72),rr=a.n(nr),ir=a(235),lr=a(576),cr=a(204),or=a(621),sr=a(625),mr=Object(x.a)((function(e){return{timeline:{margin:"0 auto",lineColor:"#DDDDDD",paddingTop:24}}}));function ur(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.moms_details,i=n.moms_instance,l=i.feature.feature_type,c=i.feature_name,o=n.op_trigger,s=n.validator,m=s.first_name,u=s.last_name,d=n.reporter,p=d.first_name,g=d.last_name,f=n.narrative.narrative,b=n.remarks,E=n.moms_id,v=a?"Non-triggering ":"",h=r.a.createElement("ul",{key:E},r.a.createElement("li",null,v,"Feature: ",rt(l)," ",c," (",t+o,")"),r.a.createElement("ul",null,r.a.createElement("li",null,"Narrative: ",f),r.a.createElement("li",null,"Reporter: ","".concat(p," ").concat(g)),r.a.createElement("li",null,"Remarks: ",b),r.a.createElement("li",null,"Validator: ","".concat(m," ").concat(u))));return h}function dr(e,t,a,i){var l=[],c=0;return e.forEach((function(e){c+=1;var o=e.item_timestamp,s=e.item_data,m=e.item_type,u=null,d=re()(o).format("DD MMMM YYYY, hh:mm A");if("narrative"===m)u=r.a.createElement(cr.TimelineItem,{key:c,dateText:d,style:{color:"#969696"},dateComponent:r.a.createElement("div",{style:{display:"block",float:"right",padding:"10px",marginRight:38,background:"rgb(150, 150, 150)",color:"#fff"}},d)},r.a.createElement(O.a,{variant:"body2",component:"div"},s.narrative));else if("release"===m){var p=s.release_time,f=s.data_ts,b=s.release_publishers,E=s.triggers,v=s.is_onset,h=s.internal_alert_level,_=s.moms_releases,x=s.release_id,j=s.comments,S=e.release_type,C=function(e){var t="#F8991D";return"end_of_validity"===e?t="#00B200":"overdue"===e?t="#FA4413":"extended"===e?t="#00B200":"routine"===e&&(t="#59081E"),t}(S),k=function(e){var t="EARLY WARNING INFORMATION";return"end_of_validity"===e?t="END OF MONITORING":"overdue"===e?t="OVERDUE":"extended"===e?t="EXTENDED MONITORING":"routine"===e&&(t="ROUTINE MONITORING"),t}(S),A=re()(f);v||(A=A.add(30,"minutes")),A=A.format("MMMM Do YYYY, h:mm A");var w="",D="";b.forEach((function(e){var t=e.role,a=e.user_details,n=a.first_name,r=a.last_name;"mt"===t&&(w="".concat(n," ").concat(r)),"ct"===t&&(D="".concat(n," ").concat(r))})),u=r.a.createElement(cr.TimelineItem,{key:c,dateText:d,style:{color:C},dateInnerStyle:{background:C,lineHeight:"48px",textAlign:"center"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(or.a,{style:{color:C,height:45,width:"auto",paddingRight:8}},r.a.createElement(Me.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(O.a,{variant:"caption",component:"div",style:{color:C}},r.a.createElement("strong",null,k)),r.a.createElement(O.a,{variant:"h6",component:"div",style:{color:C,lineHeight:1.2}},r.a.createElement("strong",null,A)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(O.a,{variant:"body2",style:{color:C}},"Release Time: ",r.a.createElement("strong",null,p)),r.a.createElement(O.a,{variant:"body2",style:{color:C}},"Internal Alert Level: ",r.a.createElement("strong",null,h))),E.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",component:"div",style:{color:C}},r.a.createElement("strong",null,function(e){return r.a.createElement("ul",null,e.map((function(e){var t=e.ts,a=e.info,i=e.internal_sym,l=i.trigger_symbol,c=l.alert_symbol,o=l.trigger_hierarchy.trigger_source,s=i.alert_symbol,m=e.trigger_id,u="moms"===o?"Manifestation of Movement":rt(o),d=r.a.createElement("li",null,"".concat(u," (").concat(c,") alert triggered on ").concat(re()(t).format("MMMM Do YYYY, hh:mm A"))),p=r.a.createElement("ul",null,r.a.createElement("li",null,a)),g=[];if("moms"===o)e.trigger_misc.moms_releases.forEach((function(e){var t=ur(e,s);g.push(t)}));else if("on demand"===o)e.trigger_misc.on_demand;return r.a.createElement(n.Fragment,{key:m},d,p,g.map((function(e){return e})))})))}(E))))),_.length>0&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",component:"div",style:{color:C}},r.a.createElement("strong",null,_.map((function(e){return ur(e,"m",!0)})))))),""!==j&&null!==j&&r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between"},r.a.createElement(O.a,{variant:"body2",style:{color:C}},"Comments: ",r.a.createElement("strong",null,j)))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,container:!0,justify:"space-between",alignItems:"center"},r.a.createElement(O.a,{variant:"body2",style:{color:C}},w," | ",D),r.a.createElement(g.a,{"aria-label":"Show bulletin",variant:"text",color:"primary",size:"small",onClick:t({release_id:x,site_code:a,site_id:i})},"Bulletin"))))}else if("eos"===m){u=r.a.createElement(cr.TimelineItem,{key:c,dateText:d,style:{color:"#3f51b5"},dateInnerStyle:{background:"#3f51b5",lineHeight:"48px"},bodyContainerStyle:{background:"#EEEEEE",padding:"18px 20px",borderRadius:"8px",boxShadow:"0.2rem 0.2rem 0.5rem 0 rgba(0, 0, 0, 0.2)"}},r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,container:!0,alignItems:"center"},r.a.createElement(or.a,{style:{color:"#3f51b5",height:45,width:"auto",paddingRight:8}},r.a.createElement(sr.a,{style:{height:45,width:"auto"}})),r.a.createElement("div",null,r.a.createElement(O.a,{variant:"caption",component:"div",style:{color:"#3f51b5"}},r.a.createElement("strong",null,"END-OF-SHIFT-ANALYSIS")),r.a.createElement(O.a,{variant:"h6",component:"div",style:{color:"#3f51b5",lineHeight:1.2}},r.a.createElement("strong",null,re()(o).format("MMMM Do YYYY, h:mm A"))))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",style:{color:"#3f51b5"},dangerouslySetInnerHTML:{__html:s}}))))}l.push(u)})),l}var pr=function(e){var t=e.match.params.event_id,a=mr(),i=Object(n.useState)({event_id:t,site_code:"---",site_id:1,validity:re()(),event_start:re()(),site_address:"",status:1}),l=Object(o.a)(i,2),c=l[0],s=l[1],m=Object(n.useState)([]),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)({}),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)(!1),h=Object(o.a)(v,2),_=h[0],x=h[1];Object(n.useEffect)((function(){!function(e,t){var a=e.event_id,n="".concat(k,"/api/monitoring/get_event_timeline_data/").concat(a);C.a.get(n).then((function(e){var a=e.data;console.log("Event details",a),t(a)})).catch((function(e){console.error("Problem in getEventTimelineEntries Axios request"),console.error(e)}))}({event_id:t},(function(e){var t=e.event_details,a=e.timeline_items;Object.keys(t).length>0&&(s(t),p(a))}))}),[]);var j=1===c.status?"ROUTINE":"EVENT",S=re()(c.event_start).format("MMMM Do YYYY, hh:mm A"),A="PRESENT";return null!==c.validity&&(A=re()(c.validity).format("MMMM Do YYYY, hh:mm A")),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,j," MONITORING TIMELINE")),r.a.createElement(O.a,{variant:"h4",align:"center"},c.site_address," (",c.site_code.toUpperCase(),")"),r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"".concat(S," to ").concat(A))),r.a.createElement(cr.Timeline,{className:a.timeline,lineColor:"#DDDDDD"},dr(d,(function(e){return function(t){console.log(e),E(e),x(!0)}}),c.site_code,c.site_id)),r.a.createElement(ft,{classes:a,isOpenBulletinModal:_,setIsOpenBulletinModal:x,releaseDetail:b}))},gr=a(166),fr=a.n(gr),br=a(133),Er=a.n(br),vr=function(e){function t(){var e,a;Object(pa.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(fa.a)(this,(e=Object(ba.a)(t)).call.apply(e,[this].concat(r)))).handleTextChange=function(e){var t=a.props,n=t.options,r=t.onSearch,i=n.onSearchChange;i&&i(e.target.value),r(e.target.value)},a.onKeyDown=function(e){var t=a.props,n=t.onHide,r=t.onSearchClick;27===e.keyCode?n():13===e.keyCode&&r()},a}return Object(Ea.a)(t,e),Object(ga.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,i=t.onHide,l=t.searchText,c=t.onSearchClick;return r.a.createElement(ee.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(b.a,{placeholder:"Search events using YYYY-MM-DD format...",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(G.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(fr.a,null)),r.a.createElement(G.a,{className:a.clearIcon,onClick:i},r.a.createElement(Er.a,null))))}}]),t}(r.a.Component),hr=Object(d.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(vr),_r=[],yr=Object(x.a)((function(e){return Object(p.a)({},Object(Q.a)(e),{eventTable:{minWidth:"900px"}})}));var Or=Object(ir.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var xr=Object(ie.a)()((function(e){var t=e.width,a=e.location,i=e.match.url,l=yr(),c=Object(n.useState)([["Loading Data..."]]),d=Object(o.a)(c,2),g=d[0],f=d[1],b=Object(n.useState)(0),E=Object(o.a)(b,2),v=E[0],_=E[1],y=Object(n.useState)(10),x=Object(o.a)(y,2),S=x[0],A=x[1],w=Object(n.useState)(1),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)({}),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=Object(n.useState)([]),z=Object(o.a)(F,2),G=z[0],U=z[1],W=Object(n.useState)([]),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=Object(n.useState)(""),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useContext)(qt).sites;Object(n.useEffect)((function(){var e={};ne.forEach((function(t){var a=nt(t,!0,"start"),n=t.site_code.toUpperCase();_r.push(n),e[n]={site_id:t.site_id,address:a}})),P(e)}),[ne]),Object(n.useEffect)((function(){R(!0),function(e,t){var a=e.limit,n=e.offset,r=e.include_count,i=e.filters,l=e.search_str,c="".concat(k,"/api/monitoring/get_monitoring_events?filter_type=complete&offset=").concat(n,"&limit=").concat(a);r&&(c+="&include_count=true"),i.length>0&&(c+=i.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("")),""!==l&&(c+="&search=".concat(l)),C.a.get(c).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}({include_count:!0,limit:v*S+S,offset:v*S,filters:G,search_str:J},(function(e){var t=e.events,a=e.count,n=function(e,t){return e.map((function(e,a){var n=e.event_id,r=e.site_code,i=e.entry_type,l=e.event_start,c=e.validity,o=e.public_alert,s=null,m="ROUTINE";""!==l&&null!==l&&(s=re()(l).format("D MMMM YYYY, HH:mm")),""!==c&&null!==c&&(m=re()(c).format("D MMMM YYYY, HH:mm"));var u="";Object.keys(t).length&&(u=t[r.toUpperCase()].address);return[n,u,i,o,s,m]}))}(t,L);f(n),I(a),R(!1)}))}),[v,S,G,J,i,L]);var le={textLabels:{body:{noMatch:"No data"}},filterType:"multiselect",responsive:Object(ie.c)(t,"xs")?"scroll":"scrollFullHeight",searchText:J,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:S,count:M,page:v,filter:!0,selectableRows:"none",print:!1,download:!1,serverSide:!0,onTableChange:function(e,t){if("changePage"===e){var a=t.page;_(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==S&&A(n)}else"resetFilters"===e?(Q({}),U([])):"onSearchOpen"===e&&ae(!0)},onSearchChange:function(e){console.log("Searching for ".concat(e))},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){var r=null;if(0!==e.length){n=!1;var i=ce[t].name;if("site_name"===i){var l=[],c=[];e.forEach((function(e){l.push(L[e].site_id),c.push(e)})),a.push({name:"site_ids",data:l}),r=c}else if("entry_type"===i){var o,m=[],u=[];e.forEach((function(e){"EVENT"===e?o=2:"ROUTINE"===e&&(o=1),m.push(e),u.push(o)})),a.push({name:"entry_types",data:u}),r=m}Q(Object(p.a)({},V,Object(s.a)({},i,r)))}})),n&&Q({}),U(a)},customSearchRender:function(e,t,a,n){var i=e||"";te&&(i=J,ae(!1));return r.a.createElement(hr,{searchText:e,onSearch:t,onHide:function(){a(),ae(!1)},options:n,onSearchClick:function(){return X(i)}})}},ce=[{name:"event_id",label:"Event ID",options:{filter:!1,customBodyRender:function(e,t){t.rowIndex;return"Loading Data..."===e?e:function(e,t){return r.a.createElement(m.b,{to:"".concat(e,"/").concat(t)},t)}(i,e)}}},{name:"site_name",label:"Site",options:{filter:!0,filterList:"undefined"===typeof V.site_name?[]:V.site_name,filterOptions:{names:_r}}},{name:"entry_type",label:"Entry Type",options:{filter:!0,filterList:"undefined"===typeof V.entry_type?[]:V.entry_type,filterOptions:{names:["ROUTINE","EVENT"]},sort:!1}},{name:"public_alert",label:"Last Alert Level",options:{filter:!0,sort:!0}},{name:"ts_start",label:"Event Start",options:{filter:!1,sort:!1}},{name:"ts_end",label:"Event End",options:{filter:!1,sort:!1}}];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:l.pageContentMargin},r.a.createElement(be,{title:"Alert Monitoring | Events"})),r.a.createElement("div",{className:l.pageContentMargin},r.a.createElement(u.d,{location:a},r.a.createElement(u.b,{exact:!0,path:i,render:function(e){return r.a.createElement(h.a,{className:l.paperContainer},r.a.createElement(lr.a,{theme:Or},r.a.createElement(rr.a,{title:r.a.createElement(O.a,{variant:"h5",component:"div"},"Monitoring Events Table",H&&r.a.createElement(j.a,{size:24,style:{marginLeft:15,position:"relative",top:4}})),data:g,columns:ce,options:le})))}}),r.a.createElement(u.b,{path:"".concat(i,"/:event_id"),render:function(e){return r.a.createElement(pr,Object.assign({},e,{width:t}))}}))))})),jr=a(631),Sr=a(630),Cr=a(202),kr=a.n(Cr),Ar=a(626),wr=a(627),Dr=a(628),Mr=a(629),Ir=a(200),Nr=a.n(Ir),Tr=a(201),Hr=a.n(Tr),Rr=Object(x.a)((function(e){return{root:{width:"100%"},icons:Object(s.a)({fontSize:"1.15rem"},e.breakpoints.down("xs"),{fontSize:"1.7rem"}),details:{alignItems:"center"},column:{flexBasis:"33.33%"},helper:{borderLeft:"2px solid ".concat(e.palette.divider),padding:"".concat(e.spacing(),"px ").concat(e.spacing(2),"px")},link:{color:e.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}}}}));function Yr(e){return Object.keys(e).filter((function(t){return!0===e[t]}))}function Br(e){var t=e.shiftSummary,a=e.dataAnalysis,n=e.shiftNarratives;return"".concat(t,"<br/><br/>").concat(a,"<br/><br/>").concat(n)}var Lr=function(e){var t=e.data,a=e.shiftStartTs,i=e.currentUser,l=Rr(),m=t.site_code,u=t.eos_head,d=t.shift_start_info,f=t.shift_end_info,b=t.data_analysis,E=t.narratives,v=t.event_id,h=t.validity,_="".concat(u,"<br/>").concat(d,"<br/><br/>").concat(f),x=Object(n.useState)(_),j=Object(o.a)(x,2),S=j[0],A=j[1],w=Object(n.useState)(b),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)(b.length),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(E),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=Object(n.useState)(!1),z=Object(o.a)(F,2),G=z[0],U=z[1],W=Object(c.useSnackbar)(),q=W.enqueueSnackbar,V=W.closeSnackbar,Q=Object(n.useState)(null),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X={rainfall:!1,surficial:!1},$=[["rainfall","Rainfall",!1]],ee=t.has_markers,te=t.has_surficial_data,ae=t.subsurface_columns,ne="Surficial",ie=!1;ee?te||(ne+=" (No data)",ie=!0):(ne+=" (No markers)",ie=!0),$.push(["surficial",ne,ie]),ae.forEach((function(e){var t=e.logger.logger_name,a="subsurface_".concat(t),n="Subsurface - ".concat(t.toUpperCase());X[a]=!1;var r=!e.has_data;r&&(n+=" (No data)"),$.push([a,n,r])}));var le=Object(n.useState)(X),ce=Object(o.a)(le,2),oe=ce[0],se=ce[1],me=$.map((function(e){return{state:oe[e[0]],value:e[0],label:e[1],is_disabled:e[2]}}));!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(n.useRef)();Object(n.useEffect)((function(){r.current=e})),Object(n.useEffect)((function(){var e=setInterval((function(){r.current()}),t);return a&&clearInterval(e),function(){return clearInterval(e)}}),[t,a])}((function(){bt({shift_ts:a,event_id:v,dataAnalysis:M},(function(e){console.log("response",e)}))}),1e4,G);var ue=re()(a).add(12,"hours"),de=re()(h),pe=de.isBefore(ue)?de.subtract(30,"minutes").format("YYYY-MM-DD HH:mm:ss"):re()(ue).format("YYYY-MM-DD HH:mm:ss"),ge="".concat("http://dynaslope.phivolcs.dost.gov.ph","/chart_rendering/").concat(m,"/").concat(pe),fe=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){V(e)}},"Dismiss")},be={toolbar:["bold","italic","link","bulletedList","numberedList","blockQuote","|","undo","redo"]},Ee=[{label:"Shift Summary",value:S,key:"shift_summary",updateFn:A},{label:"Data Analysis",value:M,key:"data_analysis",updateFn:I}],ve=H>1500;return r.a.createElement(je.a,null,r.a.createElement(Ce.a,{expandIcon:r.a.createElement(kr.a,null)},r.a.createElement("div",{className:l.column},r.a.createElement(O.a,{variant:"body1"},m.toUpperCase())),r.a.createElement("div",{className:l.column},r.a.createElement(O.a,{variant:"body1"},"Shift Report"))),r.a.createElement(Oe.a,null),r.a.createElement(Se.a,{className:l.details},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:12}},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Charts"))),r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,justify:"space-around"},r.a.createElement(na,{label:"Data Sources",changeHandler:function(e){return function(t){var a=t.target.checked;if(se(Object(p.a)({},oe,Object(s.a)({},e,a))),a){var n=e;["surficial","rainfall"].includes(e)||(n=e.replace("_","/")),window.open("".concat(ge,"/").concat(n),"_blank")}}},choices:me,checkboxStyle:"primary"})),Ee.map((function(e){var t=e.label,a=e.value,i=e.key,l=e.updateFn;return r.a.createElement(n.Fragment,{key:i},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,t))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Nr.a,{editor:Hr.a,config:be,onInit:function(e){e.setData(a),function(e){e.editing.view.document.on("enter",(function(t,a){a.isSoft?e.execute("enter"):e.execute("shiftEnter"),a.preventDefault(),t.stop(),e.editing.view.scrollToTheSelection()}),{priority:"high"})}(e)},onChange:function(e,a){var n=a.getData();"Data Analysis"===t&&R(n.length),l(n)}})),"Data Analysis"===t&&r.a.createElement(y.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",style:{color:ve?"red":"black"}},r.a.createElement(yt.a,{title:"Content of text area is formatted on the background using HTML. HTML elements are included in the character count.",placement:"top",interactive:!0,arrow:!0},r.a.createElement("div",null,r.a.createElement(Ar.a,{color:"primary",fontSize:"small"}),"\xa0")),r.a.createElement(O.a,{variant:"caption"},r.a.createElement("strong",null,"Character count (including HTML): ",H,"/1500"))))})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1"},r.a.createElement("strong",null,"Shift Narratives ")),r.a.createElement(O.a,{variant:"body2"},r.a.createElement("i",null,"NOTE: It is recommended NOT to add narratives via this text box. Use Site Logs Form instead then click Refresh."))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Nr.a,{editor:Hr.a,config:be,onInit:function(e){e.setData(L),J(e)},onChange:function(e,t){var a=t.getData();P(a)}})))),r.a.createElement(Oe.a,null),r.a.createElement(Ie.a,null,r.a.createElement(g.a,{size:"small",onClick:function(){var e,t,a=Yr(oe),n={site_code:m,user_id:i.user_id,charts:a,file_name:"".concat(m,"_chart.pdf")};e=n,t=function(e){var t=e.message,a=e.file_response,n=a.file_path,r=a.message;console.log("response",r),"success"===t?q("Charts Saved! Path: ".concat(n),{variant:"success",autoHideDuration:7e3,action:fe}):q("Error saving charts...",{variant:"error",autoHideDuration:7e3,action:fe})},ot("".concat(k,"/api/end_of_shift/download_eos_charts"),e,t)},startIcon:r.a.createElement(wr.a,null)},"Download Charts"),r.a.createElement(g.a,{size:"small",startIcon:r.a.createElement(Dr.a,null),onClick:function(){!function(e,t){var a=e.shift_ts,n=e.event_id,r="".concat(k,"/api/end_of_shift/get_narrative/").concat(a,"/").concat(n);C.a.get(r).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}({shift_ts:a,event_id:v},(function(e){P(e),K.setData(e)}))}},"Refresh"),r.a.createElement(g.a,{size:"small",color:"primary",startIcon:r.a.createElement(Mr.a,null),onClick:function(){var e=re()(pe).add(30,"minutes").format("YYYY-MM-DD HH:mm:ss"),t={shift_ts:a,event_id:v,dataAnalysis:M},n=q("Sending End-of-Shift Report...",{variant:"warning",persist:!0});bt(t,(function(t){console.log("save_response",t),function(e,t,a){st("".concat(k,"/api/end_of_shift/get_eos_email_details/").concat(e,"/").concat(t),a)}(v,e,(function(e){var t,a,r,l=e.subject,c=e.file_name,o=e.recipients,s=Yr(oe),u={mail_body:Br({shiftSummary:S,dataAnalysis:M,shiftNarratives:L}),subject:l,recipients:o,file_name:c,site_code:m,user_id:i.user_id,charts:s};t=u,a=function(e){V(n),console.log(e),"Success"===e?q("End-of-Shift Report Sent!",{variant:"success",autoHideDuration:7e3,action:fe}):q("Error sending End-of-Shift Report...",{variant:"error",autoHideDuration:7e3,action:fe})},r=function(){V(n),q("Error sending End-of-Shift Report...",{variant:"error",autoHideDuration:7e3,action:fe})},ot("".concat(k,"/api/mailbox/send_eos_email"),t,a,r),U(!0)}))}))},disabled:ve},"Send")))};var Pr=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.eosData,c=e.setSelectedEosData,s=e.setModalOpen,m=e.setEosData,u=Object(n.useState)([]),d=Object(o.a)(u,2),p=d[0],f=d[1],b=Object(n.useState)([]),E=Object(o.a)(b,2),v=E[0],h=E[1],_=function(e){return function(t){h(function(e){var t=e.eosData,a=e.selectedSite,n=e.setSelectedSite,r=e.index,i=a,l=[];return!1===i.includes(r)?(i.push(r),n(i)):(i.pop(r),n(i)),i.forEach((function(e){l.push(t[e])})),l}({eosData:l,selectedSite:p,setSelectedSite:f,index:e}))}},y=!1;return null!==l&&(y=0===l.length),r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,maxWidth:"sm","aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Generate End-of-Shift Report"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Select sites to create end-of-shift report."),null===l&&r.a.createElement(j.a,{style:{position:"absolute",left:"50%",top:"50%"}}),!0===y&&r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"No active sites."),null!==l&&l.map((function(e,t){var a=e.site_code,n=e.event_id,i=a.toUpperCase();return r.a.createElement(Ye.a,{key:n},r.a.createElement(Le.a,{control:r.a.createElement(Ot.a,{key:n,onChange:_(t),value:a,color:"primary"}),label:i}))}))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:function(){i(),m(null)},color:"primary"},"Cancel"),r.a.createElement(g.a,{onClick:function(){c(v),s(!1)},color:"primary"},"Submit"))))})),Fr=Object(x.a)((function(e){var t;return{inputGridContainer:Object(s.a)({margin:"12px 0"},e.breakpoints.down("sm"),{margin:"0 0"}),expansionPanelsGroup:(t={margin:"12px 0"},Object(s.a)(t,e.breakpoints.down("sm"),{margin:"24px 0"}),Object(s.a)(t,"marginTop",16),t),buttonGrid:Object(s.a)({textAlign:"right"},e.breakpoints.down("sm"),{textAlign:"right"}),button:{fontSize:16,paddingLeft:8}}})),zr=function(){return r.a.createElement(xe.a,{height:150,width:700,speed:.5,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"-4",y:"5",rx:"4",ry:"4",width:"700",height:"111"}))};function Gr(e,t,a){var n="am"===t?"07:30:00":"19:30:00",r=re()(e).format("YYYY-MM-DD ".concat(n));return function(e,t){var a=e.shift_start,n="".concat(k,"/api/end_of_shift/get_end_of_shift_reports/").concat(a);C.a.get(n).then((function(e){var a=e.data;console.log("EOS Data",a),t(a)})).catch((function(e){console.error("Problem in Axios request"),console.error(e)}))}({shift_start:r},(function(e){a(e)})),r}function Ur(e){var t=e.isStart,a="No event report to generate";return"undefined"!==t&&t&&(a="Generate end-of-shift reports here"),r.a.createElement(h.a,{style:{height:"20vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC"}},r.a.createElement("div",null,a))}var Wr=Object(ie.a)()((function(e){var t,a,i=e.width,l=Fr(),c=re()(),s=c.hour(),m=Object(n.useState)(c.format("YYYY-MM-DD")),u=Object(o.a)(m,2),d=u[0],p=u[1],f=Object(n.useState)(s>=10&&s<=22?"am":"pm"),b=Object(o.a)(f,2),E=b[0],v=b[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),x=O[0],j=(O[1],Object(n.useState)(null)),S=Object(o.a)(j,2),C=S[0],k=S[1],A=Object(n.useState)(null),w=Object(o.a)(A,2),D=w[0],M=w[1],N=Object(n.useState)(null),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(!1),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=I(),z=function(e){p(e)};return r.a.createElement(n.Fragment,null,r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",alignItems:"center",spacing:4},[{label:"Shift Start",value:d,id:"start_ts"}].map((function(e){var t=e.id;return r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:t,className:l.inputGridContainer},function(e,t){var a=e.label,n=e.value;return e.id,r.a.createElement(Sr.b,{required:!0,autoOk:!0,label:a,value:n,onChange:t,ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"____/__/__",clearable:!0,disableFuture:!0,variant:"dialog",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,z))})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0},r.a.createElement(da,{div_id:"shift_time",label:"Shift Time",changeHandler:function(e){return v(e.target.value)},value:E,list:[{id:"am",label:"AM"},{id:"pm",label:"PM"}],mapping:{id:"id",label:"label"},required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:!0,className:"".concat(l.inputGridContainer," ").concat(l.buttonGrid)},r.a.createElement(g.a,{variant:"contained",color:"secondary",size:Object(ie.b)("sm",i)?"small":"medium",onClick:(a="site_list",function(e){if("generate_report"===a)P(!1);else{P(!0);var t=Gr(d,E,k);R(t)}})},"Generate ",r.a.createElement(jr.a,{className:l.button}))))),r.a.createElement("div",{className:l.expansionPanelsGroup},null===D&&!x&&r.a.createElement(Ur,{isStart:!0}),x?r.a.createElement(zr,null):r.a.createElement(h.a,null,null!==D&&(D.length>0?D.map((function(e,t){return r.a.createElement(Lr,{data:e,key:t,shiftStartTs:H,currentUser:F})})):r.a.createElement(Ur,null)))),r.a.createElement(Pr,{isOpen:L,closeHandler:(t=!1,function(){return P(t)}),eosData:C,setSelectedEosData:M,setModalOpen:P,setEosData:k}))})),qr=a(307),Vr=a.n(qr);function Qr(e,t,a){return r.a.createElement(m.b,{className:e.link,to:"events/".concat(t)},a.toUpperCase())}var Zr=Object(pe.a)(Object(ie.a)(),Object(d.a)((function(e){var t=Object(Q.a)(e);return{inputGridContainer:Object(s.a)({margin:"12px 0"},e.breakpoints.down("sm"),{margin:"0 0"}),divider:Object(p.a)({},t.pageContentMargin,{margin:0}),selects:Object(s.a)({width:"auto"},e.breakpoints.up("md"),{width:"-webkit-fill-available"}),alignCenter:{textAlign:"center"},button:{fontSize:16,paddingLeft:8},def_padding:{padding:16},form_input:{paddingTop:10},root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular},link:{textDecoration:"none"},valueFont:{color:"black",textDecoration:"none"},summary:{justifyContent:"space-evenly"}}})))((function(e){var t=e.classes,a=e.width,i=e.location,l=e.match,c=Object(n.useState)(null),s=Object(o.a)(c,2),m=s[0],d=s[1],p=Object(n.useState)(null),f=Object(o.a)(p,2),b=f[0],E=f[1],v=Object(n.useState)(null),_=Object(o.a)(v,2),x=_[0],j=_[1],S=Object(n.useState)(""),C=Object(o.a)(S,2),A=C[0],w=C[1],D=Object(n.useState)("staff_name"),M=Object(o.a)(D,2),I=M[0],N=M[1],T=Object(n.useState)(""),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=Object(n.useState)({}),L=Object(o.a)(B,2),P=L[0],F=L[1],z=Object(n.useState)(""),G=Object(o.a)(z,2),U=G[0],W=G[1],q=Object(n.useState)("Please enter filters."),V=Object(o.a)(q,2),Q=V[0],Z=V[1];Object(n.useEffect)((function(){if("staff_name"===I)F({ts_start:re()(m).format("YYYY-MM-DD HH:mm:ss"),ts_end:re()(b).format("YYYY-MM-DD HH:mm:ss"),user_id:R});else if("shift_date"===I){var e=function(e,t){var a=null,n=null;if("am"===t){var r=re()(e).set({hour:7,minute:30,second:0});a=re()(r).format("YYYY-MM-DD HH:mm:ss"),n=re()(r).add(13,"hours").format("YYYY-MM-DD HH:mm:ss")}else if("pm"===t){var i=re()(e).set({hour:7,minute:30,second:0});a=re()(i).format("YYYY-MM-DD HH:mm:ss"),n=re()(i).add(13,"hours").format("YYYY-MM-DD HH:mm:ss")}return{shift_start:a,shift_end:n}}(x,A),t=e.shift_start,a=e.shift_end;F({ts_start:t,ts_end:a})}else console.error("PROBLEM WITH HANDLE SUBMIT. 'select_by' provided is undefined.")}),[I,m,b,R,x,A]);var K=function(e){return function(t){switch(e){case"ts_start":d(t),E(re()(t).add(14,"days"));break;case"ts_end":E(t);break;case"shift_date":j(t)}}},J=function(e){return function(t){var a=t.target.value;switch(e){case"shift_sched":w(a);break;case"select_by":N(a);break;case"user_id":Y(a)}}},X=function(){var e,a;e=P,a=function(e){!function(e,t,a){var n,i=a.select_by,l=a.setDataHeader,c=a.payload,o=c.ts_start,s=c.ts_end,m=re()(o).format("MMMM D, YYYY");if(re()(s).format("MMMM D, YYYY"),"shift_date"===i){var u=t[0],d=u.ampm,p=u.ct,g=u.mt;n=r.a.createElement(h.a,{className:e.def_padding},r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:3},r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textSecondary"},"Shift Date"),r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textPrimary"},m)),r.a.createElement(y.a,{item:!0,xs:3},r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textSecondary"},"Shift Schedule"),r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textPrimary"},d)),r.a.createElement(y.a,{item:!0,xs:3},r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textSecondary"},"MT Personnel"),r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textPrimary"},g)),r.a.createElement(y.a,{item:!0,xs:3},r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textSecondary"},"CT Personnel"),r.a.createElement(O.a,{className:e.alignCenter,variant:"body1",color:"textPrimary"},p))))}l(n)}(t,e,{select_by:I,setDataHeader:W,payload:P});var a=function(e,t,a){var n=[];return"staff_name"===t?n=a.map((function(t,a){var n=t.date,i=t.data,l=t.ampm,c=t.mt,o=t.ct,s=Vr.a.toWords(i.length),m="".concat(rt(s)," (").concat(i.length,")"),u=i.map((function(t,a){var n=t.general_status,i=t.site_code,l=t.public_alert_level,c=t.event_id,o=t.internal_alert,s=Qr(e,c,i);return r.a.createElement(y.a,{item:!0,xs:4,key:"site_alert_".concat(a+1),className:e.summary},r.a.createElement(O.a,{variant:"body2",className:e.alignCenter},r.a.createElement("span",{className:e.valueFont},s)),r.a.createElement(O.a,{variant:"body2",className:e.alignCenter},r.a.createElement("span",{className:e.valueFont},"Alert ",l," (",o,")")),r.a.createElement(O.a,{variant:"body2",color:"textSecondary",className:e.alignCenter},"Monitoring status: ",r.a.createElement("span",{className:e.valueFont},rt(n))))}));return r.a.createElement(je.a,{key:"monitoring_date_".concat(a+1)},r.a.createElement(Ce.a,{expandIcon:r.a.createElement(kr.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:4,className:e.alignCenter},r.a.createElement(O.a,{color:"textSecondary"},"Shift Date: ",r.a.createElement("span",{className:e.valueFont},re()(n).format("MMMM D, YYYY")))),r.a.createElement(y.a,{item:!0,xs:4,className:e.alignCenter},r.a.createElement(O.a,{color:"textSecondary"},"Sites Monitored: ",r.a.createElement("span",{className:e.valueFont},m))),r.a.createElement(y.a,{item:!0,xs:4,className:e.alignCenter},r.a.createElement(O.a,{color:"textSecondary"},"Shift Schedule: ",r.a.createElement("span",{className:e.valueFont},l))))),r.a.createElement(Oe.a,null),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:2,className:e.def_padding},r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",className:e.alignCenter},"Shift Schedule"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",className:e.alignCenter},l)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",className:e.alignCenter},"MT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",className:e.alignCenter},c)),r.a.createElement(y.a,{item:!0,xs:4},r.a.createElement(O.a,{variant:"body1",color:"textSecondary",className:e.alignCenter},"CT Personnel"),r.a.createElement(O.a,{variant:"body1",color:"textPrimary",className:e.alignCenter},o)),r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20}},r.a.createElement(Oe.a,null)),u)),r.a.createElement(Oe.a,null))})):"shift_date"===t&&(n=a.map((function(t,a){var n=t.public_alert_level,i=t.data,l=Vr.a.toWords(i.length),c="".concat(rt(l)," (").concat(i.length,")"),o=i.map((function(t,a){var n=t.general_status,i=t.site_code,l=t.event_id,c=Qr(e,l,i);return r.a.createElement(y.a,{item:!0,xs:4,key:"site_alert_".concat(a+1)},r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Site code: ",r.a.createElement("span",{className:e.valueFont},c)),r.a.createElement(O.a,{variant:"body2",color:"textSecondary"},"Monitoring status: ",r.a.createElement("span",{className:e.valueFont},rt(n))))}));return r.a.createElement(je.a,{key:"monitoring_date_".concat(a+1)},r.a.createElement(Ce.a,{expandIcon:r.a.createElement(kr.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:6,className:e.alignCenter},r.a.createElement(O.a,{color:"textSecondary"},r.a.createElement("span",{className:e.valueFont},"Alert ",n))),r.a.createElement(y.a,{item:!0,xs:6,className:e.alignCenter},r.a.createElement(O.a,{color:"textSecondary"},"Number of sites: ",r.a.createElement("span",{className:e.valueFont},c))))),r.a.createElement(Oe.a,null),r.a.createElement(Se.a,null,r.a.createElement(y.a,{container:!0,spacing:2,className:e.def_padding},o)))}))),n}(t,I,e);Z(r.a.createElement(O.a,{style:{fontStyle:"italic"}},"No shift data")),a.length>0&&Z(a)},ot("".concat(k,"/api/shift_checker/get_shift_data"),e,a)};return r.a.createElement(n.Fragment,null,r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(u.d,{location:i},r.a.createElement(u.b,{exact:!0,path:l,render:function(e){return r.a.createElement(y.a,{container:!0,justify:"space-between",alignContent:"center",spacing:2},r.a.createElement(y.a,{item:!0,sm:12,md:3},r.a.createElement(h.a,{className:t.def_padding},r.a.createElement("div",{className:t.form_input},r.a.createElement(da,{label:"Select by",div_id:"select_by",changeHandler:J("select_by"),value:I,list:[{id:"shift_date",label:"Shift Date"},{id:"staff_name",label:"Staff Name"}],mapping:{id:"id",label:"label"}})),"shift_date"===I&&r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.form_input},r.a.createElement(da,{label:"AM or PM?",div_id:"shift_sched",changeHandler:J("shift_sched"),value:A,list:[{id:"am",label:"AM Shift"},{id:"pm",label:"PM Shift"}],mapping:{id:"id",label:"label"}})),r.a.createElement("div",{className:t.form_input},r.a.createElement(Sr.a,{required:!0,autoOk:!0,label:"Shift Date",value:x,onChange:K("shift_date"),ampm:!1,placeholder:"2010/01/01",format:"YYYY/MM/DD",mask:"__/__/____",clearable:!0,disableFuture:!0,variant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}}))),"staff_name"===I&&r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.form_input},r.a.createElement(xa,{label:"Staff Name",div_id:"user_id",changeHandler:J("user_id"),value:R,variant:"standard"})),[{label:"Start Timestamp",value:m,id:"ts_start"},{label:"End Timestamp",value:b,id:"ts_end"}].map((function(e,a){return r.a.createElement("div",{key:e.id,className:t.form_input},function(e,t){var a=e.label,n=e.value,i=e.id;return r.a.createElement(St.a,{required:!0,autoOk:!0,label:a,value:n,onChange:t(i),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0,variant:"outlined",fullWidth:!0,InputProps:{style:{paddingRight:0}}})}(e,K))}))),r.a.createElement("div",{style:{textAlign:"right",paddingTop:16}},r.a.createElement(g.a,{variant:"contained",color:"secondary",size:Object(ie.b)("sm",a)?"small":"medium",onClick:X},"Generate ",r.a.createElement(jr.a,{className:t.button}))))),r.a.createElement(y.a,{item:!0,sm:12,md:9},r.a.createElement("div",{className:t.root},U,Q)))}}),r.a.createElement(u.b,{path:"".concat(l,"/:event_id"),render:function(t){return r.a.createElement(pr,Object.assign({},e,{width:a}))}}))))})),Kr=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{tabBar:Object(p.a)({},t.pageContentMargin,{margin:0}),tabBarContent:{marginTop:30}})})),Jr=[{label:"End-of-Shift Report Generator",href:"report-generator"},{label:"Monitoring Shift Checker",href:"shift-checker"}];var Xr=function(e){var t=Object(n.useState)(0),a=Object(o.a)(t,2),i=a[0],l=a[1],c=Kr();return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:c.pageContentMargin},r.a.createElement(be,{title:"Alert Monitoring | Shifts & Reports"})),r.a.createElement("div",{className:c.tabBar},r.a.createElement(ye,{chosenTab:i,onSelect:function(e){l(e)},tabsArray:Jr})),r.a.createElement("div",{className:"".concat(c.pageContentMargin," ").concat(c.tabBarContent)},0===i&&r.a.createElement(Wr,null),1===i&&r.a.createElement(Zr,null)))},$r=a(622),ei=a(632),ti=a(633),ai=function(e){function t(){var e,a;Object(pa.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(fa.a)(this,(e=Object(ba.a)(t)).call.apply(e,[this].concat(r)))).handleTextChange=function(e){var t=a.props.options.onSearchChange;t&&t(e.target.value),a.props.onSearch(e.target.value)},a.onKeyDown=function(e){27===e.keyCode?a.props.onHide():13===e.keyCode&&a.props.onSearchClick()},a}return Object(Ea.a)(t,e),Object(ga.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,i=t.onHide,l=t.searchText,c=t.onSearchClick;return r.a.createElement(ee.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(b.a,{placeholder:"Type words to search narrative column",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(G.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(fr.a,null)),r.a.createElement(G.a,{className:a.clearIcon,onClick:i},r.a.createElement(Er.a,null))))}}]),t}(r.a.Component),ni=Object(d.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(ai);function ri(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.a.post(t,e).then((function(e){var t=e.data;null!==a&&a(t)})).catch((function(e){console.log(e)}))}var ii=Object(d.a)((function(e){return{inputGridContainer:{marginTop:6,marginBottom:6},checkboxGridContainer:{marginTop:12,marginBottom:6},selectInput:Object(s.a)({width:"auto"},e.breakpoints.down("xs"),{width:"250px"}),root:{width:"90%"},backButton:{marginRight:1},instructions:{marginTop:1,marginBottom:1}}}))((function(e){var t=e.classes,a=e.narrativeData,n=e.setNarrativeData,i=e.siteList,l=e.setSiteList,c=e.isFromSiteLogs,o=a.narrative,m=a.timestamp,u=a.user_id,d=function(e){return function(t){n(Object(p.a)({},a,Object(s.a)({},e,t)))}},g=function(e){return function(t){var r=t.target.value;n(Object(p.a)({},a,Object(s.a)({},e,r)))}};return r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{container:!0,justify:"space-evenly",alignItems:"center",spacing:1},r.a.createElement(y.a,{item:!0,xs:12,className:t.inputGridContainer},r.a.createElement(Zt,{value:i,changeHandler:function(e){l(e)},isMulti:!0,isFromSiteLogs:c})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Sr.a,{required:!0,autoOk:!0,label:"Date",value:m,onChange:d("timestamp"),ampm:!1,placeholder:"2020-01-01",format:"YYYY-MM-DD",mask:"____-__-__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,className:t.inputGridContainer},r.a.createElement(Pa.b,{required:!0,autoOk:!0,label:"Time",value:m,onChange:d("timestamp"),ampm:!1,placeholder:"00:00",format:"HH:mm",mask:"__:__",clearable:!0,disableFuture:!0,fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:t.inputGridContainer},r.a.createElement(xa,{variant:"standard",label:"Reporter",div_id:"user_id",changeHandler:g("user_id"),value:u,disabled:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:12,className:t.inputGridContainer},r.a.createElement(b.a,{required:!0,id:"standard-multiline-static",label:"Narrative",value:o,onChange:g("narrative"),placeholder:"Enter narrative",multiline:!0,rows:"4",rowsMax:4,fullWidth:!0,className:t.textField,variant:"filled"}))))}));var li=Object(ze.a)()((function(e){var t,a=e.fullScreen,i=e.isOpen,l=e.closeHandler,c=e.setIsUpdateNeeded,s=e.chosenNarrative,m=e.isUpdateNeeded,u=e.isEditMode,d=e.isFromSiteLogs,p=I(),f={narrative_id:null,timestamp:re()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:p.user_id,event_id:null,type_id:1},b=Object(n.useState)(null),E=Object(o.a)(b,2),v=E[0],h=E[1],_=Object(n.useState)(f),y=Object(o.a)(_,2),O=y[0],x=y[1],j=Object(n.useState)(!0),S=Object(o.a)(j,2),C=S[0],A=S[1],w=Object(n.useContext)(qt).sites,D=(t=!0,w.map((function(e){var a=e.site_code,n=e.site_id,r=a.toUpperCase();return t&&(r=nt(e,!0,"start")),{value:n,label:r,data:e}})));Object(n.useEffect)((function(){if(0!==Object.keys(s).length){var e=s.id,t=s.narrative,a=s.timestamp,n=s.site_id,r=s.user_id,i=s.event_id,l=s.type_id,c=D.filter((function(e){return e.value===n}));delete c.data,h(Object(Ke.a)(c)),x({narrative_id:e,timestamp:a,narrative:t,user_id:r,event_id:i,type_id:l})}}),[s]),Object(n.useEffect)((function(){var e=""!==O.narrative&&null!==O.site_list;A(!e)}),[O]);var M=function(){x({narrative_id:null,narrative:"",user_id:p.user_id,event_id:"",type_id:1}),h(v)},N=function(){x({narrative_id:null,timestamp:re()().format("YYYY-MM-DD HH:mm"),narrative:"",user_id:p.user_id,event_id:"",type_id:1}),h(null)},T=function(){l(),N()};return r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:a,open:i,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Site Logs Form"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Note: Only monitoring-related narratives can be entered in this form. Please use other forms dedicated to its purposes."),r.a.createElement(ii,{narrativeData:O,setNarrativeData:x,siteList:v,setSiteList:h,isFromSiteLogs:d})),r.a.createElement(Fe.a,null,r.a.createElement("div",null,r.a.createElement(g.a,{onClick:T,color:"primary"},"Cancel"),r.a.createElement(g.a,{onClick:N},"Reset"),r.a.createElement(g.a,{variant:"contained",color:"primary",onClick:function(){var e,t=[];v.forEach((function(e){var a=e.value;t.push(a)})),O.site_list=t,O.timestamp=re()(O.timestamp).format("YYYY-MM-DD HH:mm:ss"),O.user_id=p.user_id,e=function(e){console.log("ret",e),M(),c(!m),u&&T()},ri(O,"".concat(k,"/api/narratives/write_narratives_to_db"),e)},disabled:C},u?"Save Edits":"Save & Add More")))))}));var ci=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,n=e.closeHandler,i=e.chosenNarrative,l=e.setIsUpdateNeeded,c=e.isUpdateNeeded,o=i.id,s=i.narrative;return r.a.createElement("div",null,r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Site Logs Delete"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Are you sure you want to delete this narrative?"),r.a.createElement(Re.a,{align:"center"},'"'.concat(s,'"'))),r.a.createElement(Fe.a,null,r.a.createElement("div",null,r.a.createElement(g.a,{onClick:n,color:"primary"},"Cancel"),r.a.createElement(g.a,{variant:"contained",color:"secondary",onClick:function(){var e;e=function(e){n(),console.log("ret",e),l(!c)},ri({narrative_id:o},"".concat(k,"/api/narratives/delete_narratives_from_db"),e)},disabled:!1},"Confirm")))))})),oi=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{inputGridContainer:Object(s.a)({margin:"12px 0"},e.breakpoints.down("sm"),{margin:"0 0"}),buttonGrid:Object(s.a)({textAlign:"right"},e.breakpoints.down("sm"),{textAlign:"right"}),button:{fontSize:16,paddingLeft:8},alert3:Object(p.a)({},t.alert3,{"&:hover *":{color:"#222222 !important"}})})})),si=Object(ir.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var mi=Object(ie.a)()((function(e){var t=e.width,a=oi(),i=Object(n.useState)([]),l=Object(o.a)(i,2),c=l[0],m=l[1],u=Object(n.useState)(0),d=Object(o.a)(u,2),f=d[0],b=d[1],E=Object(n.useState)(10),v=Object(o.a)(E,2),_=v[0],y=v[1],O=Object(n.useState)(0),x=Object(o.a)(O,2),j=x[0],S=x[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),D=w[0],M=w[1],I=Object(n.useState)([]),N=Object(o.a)(I,2),T=N[0],H=N[1],R=Object(n.useState)(""),Y=Object(o.a)(R,2),B=Y[0],L=Y[1],P=Object(n.useState)(!1),F=Object(o.a)(P,2),z=F[0],U=F[1],q=Object(n.useState)(!0),V=Object(o.a)(q,2),Q=V[0],Z=V[1],K=Object(n.useState)(!1),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)(!1),te=Object(o.a)(ee,2),ae=te[0],ne=te[1],le=Object(n.useState)(!1),ce=Object(o.a)(le,2),oe=ce[0],se=ce[1],me=Object(n.useState)({}),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],Ee=Object(n.useState)(!1),ve=Object(o.a)(Ee,2),he=ve[0],_e=ve[1],ye=Object(n.useState)(null),Oe=Object(o.a)(ye,2),xe=Oe[0],je=Oe[1],Se=Object(n.useContext)(qt).setIsReconnecting,Ce=Object(n.useContext)(qt).sites,ke=[],Ae={};Ce.forEach((function(e){var t=e.site_code.toUpperCase();ke.push(t),Ae[t]=e.site_id})),Object(n.useEffect)((function(){return Ue(Se),Ve((function(e){return je(e)})),function(){qe()}}),[]),Object(n.useEffect)((function(){Z(!0),function(e,t){var a=e.include_count,n=e.limit,r=e.offset,i=e.filters,l=e.search_str,c="".concat(k,"/api/narratives/get_narratives?limit=").concat(n,"&offset=").concat(r);a&&(c+="&include_count=true"),0!==i.length&&(c+=i.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("")),""!==l&&(c+="&search=".concat(l)),C.a.get(c).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}({include_count:!0,limit:_,offset:f*_,filters:D,search_str:B},(function(e){var t=e.narratives,a=e.count,n=t.map((function(e){var t=e.narrative,a=e.user_details,n=e.site_id,r=e.user_id,i=e.id,l=e.type_id,c=e.event_id,o=e.timestamp,s=a.last_name,m=a.first_name;return{narrative:t,user_details:"".concat(m," ").concat(s),site_name:nt(e.site,!0,"start"),timestamp:o,type:e.type_id,actions:"---",site_id:n,user_id:r,id:i,type_id:l,event_id:c}}));m(n),S(a),Z(!1)}))}),[f,_,D,B,he]);var we=function(e,t){return function(){"is_narrative_modal_open"===e?($(!X),se(!1)):"is_open_delete_modal"===e&&ne(!ae)}},De={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(ie.c)(t,"xs")?"scroll":"scrollFullHeight",serverSide:!0,searchText:B,searchPlaceholder:"Type words to search narrative column",rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:j,page:f,onTableChange:function(e,t){if("changePage"===e){var a=t.page;b(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==_&&y(n)}else"resetFilters"===e?(H({}),M([])):"onSearchOpen"===e&&U(!0)},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){if(0!==e.length){n=!1;var r=Me[t].name;if("site_name"===r){var i=[],l=[];e.forEach((function(e){i.push(Ae[e]),l.push(e)})),a.push({name:"site_ids",data:i}),H(Object(p.a)({},T,Object(s.a)({},r,l)))}}})),n&&H({}),M(a)},customSearchRender:function(e,t,a,n){var i=e||"";z&&(i=B,U(!1));return r.a.createElement(ni,{searchText:e,onSearch:t,onHide:function(){a(),U(!1)},options:n,onSearchClick:function(){return L(i)}})}},Me=[{name:"timestamp",label:"Timestamp",options:{filter:!1,sort:!1,customBodyRender:function(e){return re()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"site_name",label:"Site",options:{display:"true",filter:!0,filterType:"custom",filterList:"undefined"===typeof T.site_name?[]:T.site_name,filterOptions:{logic:function(e,t){return!!t.length&&!t.includes(e)},display:function(e,t,n,i){var l=xe.latest,c=xe.extended,o=xe.overdue,s=[].concat(Object(Ke.a)(l),Object(Ke.a)(o));return r.a.createElement(Ye.a,null,r.a.createElement(ma.a,null,"Site"),r.a.createElement(ua.a,{multiple:!0,value:e[n],renderValue:function(e){return e.join(", ")},onChange:function(a){e[n]=a.target.value,t(e[n],n,i)}},ke.map((function(t){var i=t.toLowerCase(),l=s.find((function(e){return e.event.site.site_code===i})),o=c.find((function(e){return e.event.site.site_code===i})),m=a.alert0;l&&(m=a.alert3),o&&(m=a.extended);var u=l||o?r.a.createElement(yn.a,null,r.a.createElement(ge.a,null)):"";return r.a.createElement(W.a,{key:t,value:t,className:m},r.a.createElement(Ot.a,{color:"primary",checked:e[n].indexOf(t)>-1}),r.a.createElement(_n.a,{primary:t}),u)}))))}},sort:!1}},{name:"narrative",label:"Narrative",options:{filter:!1,sort:!1}},{name:"type",label:"Type",options:{filter:!0}},{name:"user_details",label:"Reporter",options:{filter:!1}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:function(e,t){var a=t.rowIndex;return function(e,t){var a=t.setChosenNarrative,n=t.setIsOpenNarrativeModal,i=t.setIsOpenDeleteModal,l=t.setIsEditMode;return r.a.createElement("span",null,r.a.createElement(G.a,{tooltip:"Edit",style:{float:"left"},onClick:function(t){a(e),n(!0),l(!0),console.log("Edit",e)}},r.a.createElement(ei.a,{style:{fontSize:20}})),r.a.createElement(G.a,{tooltip:"Delete",style:{float:"left"},onClick:function(t){a(e),i(!0)}},r.a.createElement(ti.a,{style:{fontSize:20}})))}(c[a],{setChosenNarrative:pe,setIsOpenNarrativeModal:$,isOpenNarrativeModal:X,setIsOpenDeleteModal:ne,isOpenDeleteModal:ae,setIsEditMode:se,isEditMode:oe})}}}],Ie=Object(ie.c)("md",t),Te=r.a.createElement("span",null,r.a.createElement(g.a,{"aria-label":"Write a site log",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:we("is_narrative_modal_open")},r.a.createElement(fe.a,{style:{paddingRight:4,fontSize:20}}),"Write a Site Log"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(be,{title:"Alert Monitoring | Site Logs",customButtons:!!Ie&&Te})),r.a.createElement(Ne.a,{open:Q,fullWidth:!0},r.a.createElement(He.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement($r.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:a.pageContentMargin},r.a.createElement(h.a,{className:a.paperContainer},r.a.createElement(lr.a,{theme:si},r.a.createElement(rr.a,{title:"Site Logs",data:c,columns:Me,options:De})))),r.a.createElement(li,{isOpen:X,closeHandler:we("is_narrative_modal_open"),setIsUpdateNeeded:_e,isUpdateNeeded:he,chosenNarrative:de,isFromSiteLogs:xe,isEditMode:oe}),r.a.createElement(ci,{isOpen:ae,closeHandler:we("is_open_delete_modal"),chosenNarrative:de,setIsUpdateNeeded:_e,isUpdateNeeded:he}))})),ui=function(e){function t(){var e,a;Object(pa.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(fa.a)(this,(e=Object(ba.a)(t)).call.apply(e,[this].concat(r)))).handleTextChange=function(e){var t=a.props.options.onSearchChange;t&&t(e.target.value),a.props.onSearch(e.target.value)},a.onKeyDown=function(e){27===e.keyCode?a.props.onHide():13===e.keyCode&&a.props.onSearchClick()},a}return Object(Ea.a)(t,e),Object(ga.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.options,i=t.onHide,l=t.searchText,c=t.onSearchClick;return r.a.createElement(ee.a,{appear:!0,in:!0,timeout:300},r.a.createElement("div",{className:a.main,ref:function(t){return e.rootRef=t}},r.a.createElement(b.a,{placeholder:"Type words to search details column",className:a.searchText,InputProps:{"aria-label":n.textLabels.toolbar.search},value:l||"",onChange:this.handleTextChange,fullWidth:!0,inputRef:function(t){return e.searchField=t}}),r.a.createElement(G.a,{className:a.clearIcon,style:{marginLeft:6},onClick:c},r.a.createElement(fr.a,null)),r.a.createElement(G.a,{className:a.clearIcon,onClick:i},r.a.createElement(Er.a,null))))}}]),t}(r.a.Component),di=Object(d.a)((function(e){return{main:{display:"flex",flex:"1 0 auto"},searchText:{flex:"0.8 0"},clearIcon:{"&:hover":{color:e.palette.error.main}}}}),{name:"CustomSearchRender"})(ui),pi={},gi=Object(ir.a)({overrides:{MUIDataTableHeadCell:{root:{zIndex:"0 !important"}}}});var fi=Object(pe.a)(Object(d.a)((function(e){return Object(p.a)({},Object(Q.a)(e),{},function(e){return{inputGridContainer:Object(s.a)({margin:"12px 0"},e.breakpoints.down("sm"),{margin:"0 0"}),buttonGrid:Object(s.a)({textAlign:"right"},e.breakpoints.down("sm"),{textAlign:"right"}),button:{fontSize:16,paddingLeft:8}}}(e))}),{withTheme:!0}),Object(ie.a)())((function(e){var t=e.classes,a=e.width,i=Object(n.useState)([]),l=Object(o.a)(i,2),c=l[0],m=l[1],u=Object(n.useState)(0),d=Object(o.a)(u,2),f=d[0],b=d[1],E=Object(n.useState)(5),v=Object(o.a)(E,2),_=v[0],y=v[1],O=Object(n.useState)(0),x=Object(o.a)(O,2),j=x[0],S=x[1],A=Object(n.useState)([]),w=Object(o.a)(A,2),D=w[0],M=w[1],I=Object(n.useState)([]),N=Object(o.a)(I,2),T=N[0],H=N[1],R=Object(n.useState)(""),Y=Object(o.a)(R,2),B=Y[0],L=Y[1],P=Object(n.useState)(!1),F=Object(o.a)(P,2),z=F[0],U=F[1],W=Object(n.useState)(!0),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=Object(n.useState)(!1),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)({}),le=Object(o.a)(ne,2),ce=le[0],oe=le[1],se=Object(n.useState)(!1),me=Object(o.a)(se,2),ue=me[0],de=me[1],pe=Object(n.useState)(!1),ge=Object(o.a)(pe,2),Ee=ge[0];ge[1],Object(n.useEffect)((function(){Q(!0),function(e,t){var a=e.include_count,n=e.limit,r=e.offset,i=e.filters,l=e.search_str,c=e.include_expired,o="".concat(k,"/api/issues_and_reminders/get_issues_and_reminders");if(o+="?include_expired=".concat(c),null!==n||null!==r){if(o+="&limit=".concat(n,"&offset=").concat(r),a&&(o+="&include_count=true"),0!==i.length)o+=i.map((function(e){var t=e.name;return e.data.map((function(e){return"&".concat(t,"=").concat(e)})).join("")})).join("");""!==l&&(o+="&search=".concat(l))}console.log(o),C.a.get(o).then((function(e){var a=e.data;t(a)})).catch((function(e){console.error(e)}))}({include_count:!0,limit:_,offset:f*_,filters:D,search_str:B,include_expired:!0},(function(e){var t=e.issues_and_reminders,a=e.count;m(t),S(a),Q(!1)}))}),[f,_,D,B,ue,te,J]);var ve=function(e,t){return function(){"is_issue_reminder_modal_open"===e&&(X(t),de(t))}},he={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",print:!1,download:!1,filterType:"multiselect",responsive:Object(ie.c)(a,"xs")?"scroll":"scrollFullHeight",serverSide:!0,rowsPerPageOptions:[5,10,15],rowsPerPage:_,count:j,page:f,onTableChange:function(e,t){if("changePage"===e){var a=t.page;b(a)}else if("changeRowsPerPage"===e){var n=t.rowsPerPage;n!==_&&y(n)}else"resetFilters"===e?(H({}),M([])):"onSearchOpen"===e&&U(!0)},onFilterChange:function(e,t){var a=[],n=!0;t.forEach((function(e,t){if(0!==e.length){n=!1;var r=_e[t].name;if("site_name"===r){var i=[],l=[];e.forEach((function(e){i.push(pi[e]),l.push(e)})),a.push({name:"site_ids",data:i}),H(Object(p.a)({},T,Object(s.a)({},r,l)))}}})),n&&H({}),M(a)},customSearchRender:function(e,t,a,n){var i=e||"";z&&(i=B,U(!1));return r.a.createElement(di,{searchText:e,onSearch:t,onHide:function(){a(),U(!1)},options:n,onSearchClick:function(){return L(i)}})}},_e=[{name:"ts_posted",label:"Date Posted",options:{filter:!1,customBodyRender:function(e){return re()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"detail",label:"Details",options:{filter:!1}},{name:"reporter",label:"Reporter",options:{filter:!0,customBodyRender:function(e,t){var a=t.rowIndex,n=c[a];return"".concat(n.issue_reporter.first_name," ").concat(n.issue_reporter.last_name)}}},{name:"ts_expiration",label:"Posted Until",options:{filter:!1,sort:!1,customBodyRender:function(e){return null===e?"-":re()(e).format("DD MMMM YYYY, HH:mm:ss")}}},{name:"resolved_by",label:"Resolved By",options:{filter:!1,customBodyRender:function(e){return null===e?"-":e}}},{name:"resolution",label:"Resolution",options:{filter:!1,customBodyRender:function(e){return null===e?"-":e}}},{name:"actions",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=c[a],i=n.ts_expiration,l=n.resolution;return re()(i).isAfter(re()())||null!==l?"Finished":function(e,t){var a=t.setChosenIssueReminder,n=t.setIsOpenIssueReminderModal,i=t.setIsOpenDeleteModal,l=t.setIsIandRUpdateNeeded;return r.a.createElement("span",null,r.a.createElement(G.a,{tooltip:"Edit",style:{float:"left"},onClick:function(t){a(e),n(!0),l(!0)}},r.a.createElement(ei.a,{style:{fontSize:20}})),1===e.type_id&&r.a.createElement(G.a,{tooltip:"Delete",style:{float:"left"},onClick:function(t){a(e),i(!0)}},r.a.createElement(ti.a,{style:{fontSize:20}})))}(n,{setChosenIssueReminder:oe,setIsOpenIssueReminderModal:X,isOpenIssueReminderModal:J,setIsOpenDeleteModal:ae,isOpenDeleteModal:te,setIsIandRUpdateNeeded:de})}}}],ye=Object(ie.c)("md",a),Oe=r.a.createElement("span",null,r.a.createElement(g.a,{"aria-label":"Post an Issue or reminder",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:ve("is_issue_reminder_modal_open",!0)},r.a.createElement(fe.a,{style:{paddingRight:4,fontSize:20}}),"Post an Issue / Reminder"));return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(be,{title:"Alert Monitoring | Issues and Reminders",customButtons:!!ye&&Oe})),r.a.createElement(Ne.a,{open:V,fullWidth:!0},r.a.createElement(He.a,null,r.a.createElement("div",{style:{flexGrow:1}},r.a.createElement($r.a,{variant:"query",color:"secondary"})))),r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(h.a,{className:t.paperContainer},r.a.createElement(lr.a,{theme:gi},r.a.createElement(rr.a,{title:"Issues and Reminders",data:c,columns:_e,options:he})))),r.a.createElement(Yn,{isOpen:J,closeHandler:ve("is_issue_reminder_modal_open",!1),isIandRUpdateNeeded:ue,setIsIandRUpdateNeeded:de,chosenIssueReminder:ce,toResolve:Ee}))})),bi=a(639),Ei=a(640),vi=a(138),hi=a.n(vi),_i=a(410),yi=a.n(_i),Oi=a(69),xi=a.n(Oi),ji=a(36),Si=a.n(ji),Ci=a(167),ki=a.n(Ci),Ai=a(620),wi=a(635),Di=a(411);function Mi(e,t){var a="".concat(k,"/api/analysis/get_latest_data_presence/").concat(e);C.a.get(a).then((function(a){var n=a.data;console.log("Data Presence: ".concat(e),n),t(n)})).catch((function(e){console.error(e)}))}function Ii(e,t){var a="".concat(k,"/api/analysis/save_chart_svg");C.a.post(a,e).then((function(e){var a=e.data;console.log("Save SVG",a),t(a)})).catch((function(e){console.error(e)}))}function Ni(e,t){var a=[];return 0===t.length?a[0]={chart:{type:"bar"},series:[]}:t.forEach((function(t){var n,r=t.dataset_name,i=function(e){var t=e.dataset_name,a=e.dataset;return"velocity_acceleration"===t?a.forEach((function(e,t){var n=e.name;"Trend Line"===n?a[t]=Object(p.a)({},a[t],{type:"spline"}):"Threshold Interval"===n?a[t]=Object(p.a)({},a[t],{type:"arearange",lineWidth:0,fillOpacity:.2,zIndex:0,color:"#FFEB32"}):"Last Data Point"===n&&(a[t]=Object(p.a)({},a[t],{marker:{symbol:"asterisk",lineColor:"#ff9e32",lineWidth:4}}))})):"displacement_interpolation"===t?a.forEach((function(e,t){var n=e.name;"Surficial Data"===n?a[t].type="scatter":"Interpolation"===n&&(a[t]=Object(p.a)({},a[t],{marker:{enabled:!0,radius:0}}))})):"velocity_acceleration_time"===t&&a.forEach((function(e,t){var n=e.name;"Velocity"===n?a[t].yAxis=0:"Acceleration"===n&&(a[t].yAxis=1)})),a}(t);if("velocity_acceleration"===r)n=function(e,t){var a=t.site_code,n=t.marker_name,r=t.ts_end;return{series:e,time:{timezoneOffset:-480},chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity Acceleration Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>As of: <b>").concat(re()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{title:{text:"<b>Velocity (cm/day)</b>"}},yAxis:{title:{text:"<b>Acceleration (cm/day^2)</b>"}},tooltip:{headerFormat:"",shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1}}}(i,e);else if("displacement_interpolation"===r)n=function(e,t){var a=t.site_code,n=t.marker_name,r=t.end_date;return{series:e,time:{timezoneOffset:-480},chart:{type:"spline",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Displacement Interpolation Chart of ".concat(a.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(n,"</b><br/>As of: <b>").concat(re()(r).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},tooltip:{crosshairs:!0},plotOptions:{line:{marker:{enabled:!0}},scatter:{tooltip:{pointFormat:"Date/Time: <b>{point.x:%A, %e %b, %H:%M:%S}</b><br>Displacement: <b>{point.y:.2f}</b>"}}},credits:{enabled:!1}}}(i,e);else if("velocity_acceleration_time"===r){var l=i.findIndex((function(e){return"Timestamps"===e.name})),c=JSON.parse(JSON.stringify(i)),s=c.splice(l,1);n=function(e,t,a){var n=a.site_code,r=a.marker_name,i=a.end_date;return{series:e,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",resetZoomButton:{position:{x:0,y:-30}}},title:{text:"<b>Velocity & Acceleration vs Time Chart of ".concat(n.toUpperCase(),"</b>"),y:22},subtitle:{text:"Source: <b>Marker ".concat(r,"</b><br/>As of: <b>").concat(re()(i).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"13px"}},xAxis:{categories:t,type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},labels:{formatter:function(){return re()(this.value).format("D MMM")}},title:{text:"<b>Time (Days)</b>"}},yAxis:[{title:{text:"<b>Velocity (cm/day)</b>",style:{color:Si.a.getOptions().colors[1]}}},{title:{text:"<b>Acceleration (cm/days^2)</b>",style:{color:Si.a.getOptions().colors[0]}},labels:{style:{color:Si.a.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!1}}},credits:{enabled:!1}}}(c,Object(o.a)(s,1)[0].data,e)}a.push(n)})),a}a.n(Di)()(Si.a),Si.a.SVGRenderer.prototype.symbols.asterisk=function(e,t,a,n){return["M",e-3,t-3,"L",e+a+3,t+n+3,"M",e+a+3,t-3,"L",e-3,t+n+3,"M",e-4,t+n/2,"L",e+a+4,t+n/2,"M",e+a/2,t-4,"L",e+a/2,t+n+4,"z"]},Si.a.VMLRenderer&&(Si.a.VMLRenderer.prototype.symbols.asterisk=Si.a.SVGRenderer.prototype.symbols.asterisk);var Ti=Object(d.a)(Q.a)((function(e){e.classes;var t=e.timestamps,a=e.hideTrending,i=e.history,l=e.match,c=(l.url,l.params.marker_name),o=e.siteCode,s=e.trendingData,m=e.setTrendingData,u=r.a.useRef(null),d={site_code:o,marker_name:c,ts_end:t.end,ts_start:t.start};Object(n.useEffect)((function(){if(null!==u){var e=u.current;null!==e&&e.chart.showLoading(),function(e,t){var a=e.site_code,n=e.marker_name,r=e.ts_end,i="".concat(k,"/api/surficial/get_surficial_marker_trending_data/")+"".concat(a,"/").concat(n,"/").concat(r);C.a.get(i).then((function(e){var a=e.data;console.log("Surficial Marker Trending Data",a),t(a)})).catch((function(e){console.error(e)}))}(d,(function(t){(m(Object(Ke.a)(t)),null!==e)&&e.chart.hideLoading()}))}}),[c]);var p=function(e,t,a){return Ni(e,t).map((function(e){return r.a.createElement(xi.a,{highcharts:Si.a,options:e,ref:a})}))}(d,s,u);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{textAlign:"right",marginTop:24}},r.a.createElement(g.a,{variant:"contained",onClick:a(i),color:"primary",size:"small"},"Hide")),p.map((function(e,t){return r.a.createElement("div",{style:{marginTop:24},key:t},r.a.createElement(h.a,null,e))})))})),Hi=a(634),Ri=function(e){return function(t){t.preventDefault(),e.push("/analysis/sites"),e.replace("/analysis/sites")}};var Yi=function(e){var t=e.width,a=e.history;return Object(ie.b)(t,"sm")?r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:Ri(a)},r.a.createElement(Hi.a,{style:{fontSize:16}})," Back to site list"):r.a.createElement(G.a,{variant:"contained",color:"primary",size:"small",onClick:Ri(a),style:{marginLeft:6}},r.a.createElement(Hi.a,null))};ki()(Si.a);var Bi=function(e){return function(t){t.preventDefault(),e.goBack()}};function Li(e){var t=e.editModal,a=e.fullScreen,i=e.setEditModal,l=e.siteCode,m=e.setRedrawChart,u=e.chosenPoint,d=t.is_open,f=t.ts,E=t.name,v=t.measurement,h=t.mo_id,_=t.data_id,x=u.ts,j=u.measurement,S=Object(c.useSnackbar)(),A=S.enqueueSnackbar,w=S.closeSnackbar,D=Object(n.useState)(!1),M=Object(o.a)(D,2),I=M[0],N=M[1],T=Object(n.useState)("one"),H=Object(o.a)(T,2),R=H[0],Y=H[1];Object(n.useEffect)((function(){N(!1)}),[d]);var B=function(e,a){return function(n){var r=a;"ts"===e?r=n:"measurement"===e&&(r=n.target.value),i(Object(p.a)({},t,Object(s.a)({},e,r)))}},L=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){w(e)}},"Dismiss")};return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:a,open:d,"aria-labelledby":"form-dialog-title",TransitionComponent:a?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},"Update surficial data"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Carefully edit the necessary fields or delete entries if needed."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(O.a,{variant:"subtitle1",style:{fontWeight:"bold"}},l.toUpperCase()," - Marker ",E),r.a.createElement(O.a,{variant:"body2"},"Timestamp: ",re()(x).format("DD MMMM YYYY, HH:mm:ss")),r.a.createElement(O.a,{variant:"body2"},"Measurement: ",j," cm")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"EDIT")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(b.a,{label:"Change marker data measurement",value:v,onChange:B("measurement"),type:"number",fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12},"Change observation timestamp (applies to the rest of the points)"),r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Observation Timestamp",value:re()(f),onChange:B("ts"),ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0,fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:function(){var e={};x!==f&&(e=Object(p.a)({},e,{mo_id:h,ts:re()(f).format("YYYY-MM-DD HH:mm:ss")})),j!==v&&(e=Object(p.a)({},e,{data_id:_,measurement:v})),i(Object(p.a)({},t,{is_open:!1})),0!==Object.keys(e).length&&function(e,t){var a="".concat(k,"/api/surficial/update_surficial_data");C.a.post(a,e).then((function(e){var a=e.data;console.log("Update Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){"success"===e.status?(A("Surficial data update successful!",{variant:"success",autoHideDuration:7e3,action:L}),m(!0)):A("Error updating surficial data...",{variant:"error",autoHideDuration:7e3,action:L})}))}},"Update Data")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",style:{fontWeight:"bold"}},"DELETE")),r.a.createElement(y.a,{item:!0,xs:12},"Be careful on deleting marker data. Delete only IF REALLY NEEDED."),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Ye.a,{component:"fieldset"},r.a.createElement(Be.a,{"aria-label":"gender",name:"gender1",value:R,onChange:function(e){return Y(e.target.value)}},r.a.createElement(Le.a,{value:"one",control:r.a.createElement(Pe.a,null),label:"Delete measurement of this marker only"}),r.a.createElement(Le.a,{value:"all",control:r.a.createElement(Pe.a,null),label:"Delete all measurements from given marker observation"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:function(){return N(!0)}},"Delete Data")),I&&r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(Ai.a,{variant:"contained",size:"small",color:"secondary","aria-label":"small contained button group"},r.a.createElement(g.a,{disabled:!0},"Are you sure?"),r.a.createElement(g.a,{onClick:function(){var e=t.data_id,a=t.mo_id,n=e;"all"===R&&(n=a);var r={quantity:R,id:n};i(Object(p.a)({},t,{is_open:!1})),function(e,t){var a="".concat(k,"/api/surficial/delete_surficial_data");C.a.post(a,e).then((function(e){var a=e.data;console.log("Delete Surficial Data Response",a),t(a)})).catch((function(e){console.error(e)}))}(r,(function(e){"success"===e.status?(A("Surficial data delete successful!",{variant:"success",autoHideDuration:7e3,action:L}),m(!0)):A("Error deleting surficial data...",{variant:"error",autoHideDuration:7e3,action:L})}))}},"Yes"),r.a.createElement(g.a,{onClick:function(){return N(!1)}},"No"))))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:B("is_open",!1)},"Cancel")))}var Pi=Object(ze.a)()((function(e){var t,a=e.width,i=e.match,l=i.url,c=i.params.site_code,s=e.fullScreen,d=e.disableBack,f=e.disableMarkerList,b=e.saveSVG,E=e.input,v=e.currentUser,_=e.isEndOfShift,y="";if("undefined"!==typeof E){var O=E.ts_end;y=O,t=re()(O)}else{var x=re()();y=x.format("YYYY-MM-DD HH:mm:ss"),t=x}var j="undefined"!==typeof d&&d,S="undefined"!==typeof f&&f,A="undefined"!==typeof b&&b,w="undefined"!==typeof _&&_,D=ct(t,3,"months"),M=r.a.useRef(null),I=Object(n.useState)({start:D,end:y}),N=Object(o.a)(I,2),T=N[0],H=(N[1],Object(n.useState)(!1)),R=Object(o.a)(H,2),Y=R[0],B=R[1],L=Object(n.useState)(!0),P=Object(o.a)(L,2),F=P[0],z=P[1],G=Object(n.useState)([]),U=Object(o.a)(G,2),W=U[0],q=U[1],V=Object(n.useState)([]),Q=Object(o.a)(V,2),Z=Q[0],K=Q[1],J=Object(n.useState)({data_id:null,mo_id:null,name:null,ts:null,measurement:0}),X=Object(o.a)(J,2),$=X[0],ee=X[1],te=Object(n.useState)({data_id:null,mo_id:null,name:null,ts:null,measurement:0,is_open:!1}),ae=Object(o.a)(te,2),ne=ae[0],le=ae[1];Object(n.useEffect)((function(){var e=M.current;((null!==e||F)&&e.chart.showLoading(),F)&&(!function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.site_code,r=e.start,i=e.end,l="".concat(k,"/api/surficial/get_surficial_plot_data/")+"".concat(n,"/").concat(r,"/").concat(i);a&&(l+="?is_end_of_shift=true"),C.a.get(l).then((function(e){var a=e.data;console.log("Surficial Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(Object(p.a)({site_code:c},T),(function(t){if(q(t),null!==e){var a=e.chart;a.hideLoading(),A&&B(!0);var n=a.legend.group,r=a.legend.allItems,i=r[r.length-1],l=function(e){a.series.forEach((function(t){t.setVisible(e,!1)})),a.redraw()},c=a.legend.contentGroup.getBBox(),o=c.height,s=c.width,m=n.translateX+i.legendGroup.translateX+s-40,u=n.translateY+o-20;a.renderer.button("Show All",m,u,(function(){return l(!0)})).add(),a.renderer.button("Hide All",m+75,u,(function(){return l(!1)})).add()}}),w),z(!1))}),[F]),Object(n.useEffect)((function(){var e=M.current.chart.getSVGForExport();Y&&Ii({user_id:v.user_id,site_code:c,chart_type:"surficial",svg:e},(function(e){}))}),[Y]);var ce=function(e,t){return r.a.createElement(xi.a,{highcharts:Si.a,options:e,ref:t})}(function(e,t,a,n,r,i){var l=e.site_code,c=e.timestamps,o=c.start,s=c.end,m=re()(o,"YYYY-MM-DD HH:mm:ss"),u=re()(s,"YYYY-MM-DD HH:mm:ss"),d=Object(ie.b)(a,"sm")?"1rem":"0.90rem",g=m;if(i&&t.length>0){var f=t[0].data;f.length>0&&(g=re()(f[0].x))}return{title:{text:"<b>Surficial Data History Chart of ".concat(l.toUpperCase(),"</b>"),style:{fontSize:d},margin:36,y:18},time:{timezoneOffset:-480},series:t,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:24,spacingRight:24},subtitle:{text:"".concat("","As of: <b>").concat(re()(u).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.75rem"}},yAxis:{title:{text:"<b>Displacement (cm)</b>"}},xAxis:{min:Date.parse(g),max:Date.parse(u),type:"datetime",dateTimeLabelFormats:{month:"%e. %b %Y",year:"%b"},title:{text:"<b>Date</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{line:{marker:{enabled:!0},dashStyle:"ShortDash"},series:{marker:{radius:3},cursor:"pointer",point:{events:{click:function(){var e=this.data_id,t=this.x,a=this.y,i=this.mo_id,l={data_id:e,name:this.series.name,mo_id:i,ts:re()(t),measurement:a};r(l),n(Object(p.a)({},l,{is_open:!0}))}}}}},loading:{showDuration:100,hideDuration:1e3},credits:{enabled:!1}}}({site_code:c,timestamps:T},W,a,le,ee,w),M);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},!j&&r.a.createElement(Yi,e),W.length>0&&!S&&r.a.createElement(Ai.a,{variant:"contained",color:"primary",size:"small","aria-label":"Site markers button group"},r.a.createElement(g.a,{disabled:!0,style:{color:"#000000"}},"Marker"),Object(ie.b)(a,"sm")?W.map((function(e){var t=e.marker_name,a=e.marker_id;return r.a.createElement(g.a,{component:m.b,to:"".concat(l,"/").concat(t),key:a},t)})):r.a.createElement(g.a,{color:"primary",variant:"contained",size:"small"},r.a.createElement(wi.a,null)))),r.a.createElement(h.a,{style:{marginTop:24}},ce),r.a.createElement(Li,{chosenPoint:$,editModal:ne,setEditModal:le,fullScreen:s,siteCode:c,setRedrawChart:z}),r.a.createElement(u.b,{path:"".concat(l,"/:marker_name"),render:function(e){return r.a.createElement(Ti,Object.assign({},e,{timestamps:T,siteCode:c,hideTrending:Bi,trendingData:Z,setTrendingData:K}))}}))})),Fi=a(661);window.moment=ne,ki()(Si.a);var zi={set:{"24h":[],"72h":[],rain:[],null_ranges:[],max_rval:0,max_72h:0,gauge_name:"loading",distance:0,data_source:"loading",threshold_value:0},series_data:[],max_rval_data:[]},Gi={"24h":"rgba(73, 105, 252, 0.9)","72h":"rgba(239, 69, 50, 0.9)",rain:"rgba(0, 0, 0, 0.9)"};function Ui(e,t){var a=e.set,n=e.max_rval_data,r=e.null_processed,i=a.distance,l=a.max_rval,c=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"column",zoomType:"x",panning:!0,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Instantaneous Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source : <b>".concat(Vi(i,c),"</b><br/>As of: <b>").concat(ne(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),plotBands:r,type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:Qi}},yAxis:{max:l,min:0,title:{text:"<b>Value (mm)</b>"}},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}function Wi(e,t){var a=e.set,n=e.series_data,r=a.distance,i=a.max_72h,l=a.threshold_value,c=a.gauge_name,o=t.ts_start,s=t.ts_end,m=t.site_code;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:400,resetZoomButton:{position:{x:0,y:-30}},spacingTop:16,spacingRight:24},title:{text:"<b>Cumulative Rainfall Chart of ".concat(m.toUpperCase(),"</b>"),style:{fontSize:"0.85rem"},margin:26,y:20},subtitle:{text:"Source: <b>".concat(Vi(r,c),"</b><br/>As of: <b>").concat(ne(s).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.65rem"}},xAxis:{min:Date.parse(o),max:Date.parse(s),type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"},events:{setExtremes:Qi}},yAxis:{title:{text:"<b>Value (mm)</b>"},max:Math.max(0,i-parseFloat(l))+parseFloat(l),min:0,plotBands:[{value:Math.round(10*parseFloat(l/2))/10,color:Gi["24h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"24-hr threshold (".concat(l/2,")")}},{value:l,color:Gi["72h"],dashStyle:"shortdash",width:2,zIndex:0,label:{text:"72-hr threshold (".concat(l,")")}}]},tooltip:{shared:!0,crosshairs:!0},plotOptions:{series:{marker:{radius:3},cursor:"pointer"}},legend:{enabled:!1},credits:{enabled:!1},time:{timezoneOffset:-480}}}var qi=function(e){var t,a=e.match.params,i=a.rain_gauge,l=a.site_code,c=e.input,s=e.disableBack,m=e.currentUser,u=e.saveSVG,d="undefined"!==typeof i?1:4,g=Object(n.useState)([]),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)([]),_=Object(o.a)(v,2),O=_[0],x=_[1],j=Object(n.useRef)(Object(Ke.a)(Array(d)).map((function(){return{instantaneous:Object(n.createRef)(),cumulative:Object(n.createRef)()}}))),S=Object(n.useState)(!1),A=Object(o.a)(S,2),w=A[0],D=A[1],M=Object(n.useState)([]),I=Object(o.a)(M,2),N=I[0],T=I[1],H="undefined"!==typeof s&&s,R="undefined"!==typeof u&&u,Y="",B="";if("undefined"!==typeof c){var L=c.ts_end;Y=L,t=ne(L),B=l}else{var P=ne();Y=P.format("YYYY-MM-DD HH:mm:ss"),t=P,B=i.substr(0,3)}var F={ts_start:ct(t,3,"days"),ts_end:Y,site_code:B},z={cumulative:Wi(zi,F),instantaneous:Ui(zi,F)};Object(n.useEffect)((function(){!function(e,t){var a=e.site_code,n=e.ts_end,r="".concat(k,"/api/rainfall/get_rainfall_plot_data/").concat(a,"/").concat(n);C.a.get(r).then((function(e){var a=e.data;console.log("Rainfall Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(F,(function(e){var t=e;"undefined"!==typeof i&&(t=e.filter((function(e){return e.gauge_name==="rain_".concat(i)}))),E(t)}))}),[]),Object(n.useEffect)((function(){var e=[];b.forEach((function(t){var a=function(e){var t=e.null_ranges,a=[],n=[];Object.keys(Gi).forEach((function(t){var r=Gi[t],i={name:t,step:!0,data:e[t],color:r,id:t,fillOpacity:1,lineWidth:1};"rain"!==t?a.push(i):n.push(i)}));var r=t.map((function(e){return{from:e.from,to:e.to,color:"rgba(68, 170, 213, 0.3)"}}));return{set:e,series_data:a,max_rval_data:n,null_processed:r}}(t);e.push(a)})),e.length>0&&x(e)}),[b]);var G=Object(n.useState)([]),U=Object(o.a)(G,2),W=U[0],q=U[1];Object(n.useEffect)((function(){var e=[];O.forEach((function(t){var a=Ui(t,F),n=Wi(t,F);e.push({instantaneous:a,cumulative:n})})),q(e),e.length>0&&R&&D(!0)}),[O]),Object(n.useEffect)((function(){if(w){var e=[];j.current.forEach((function(t){var a=t.instantaneous,n=t.cumulative,r=a.current.chart,i=n.current.chart.getSVGForExport(),l=r.getSVGForExport();e.push({c:i,i:l})})),T(e)}}),[w]);var V=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(N.length>0){var e=V.current.outerHTML;Ii({user_id:m.user_id,site_code:l,chart_type:"rainfall",svg:e},(function(e){}))}}),[N]),r.a.createElement(n.Fragment,null,!H&&r.a.createElement(Yi,e),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},j.current.map((function(e,t){var a=Object(p.a)({},z);return W.length>0&&(a=W[t]),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(h.a,null,r.a.createElement(xi.a,{highcharts:Si.a,options:a.instantaneous,ref:e.instantaneous}))),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(h.a,null,r.a.createElement(xi.a,{highcharts:Si.a,options:a.cumulative,ref:e.cumulative}))))})))),R&&r.a.createElement(Fi.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:1600,viewBox:"0 0 1200 1600",ref:V},N.map((function(e,t){var a=e.i,i=e.c;return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:0,y:400*t,dangerouslySetInnerHTML:{__html:a}}),r.a.createElement("svg",{x:600,y:400*t,dangerouslySetInnerHTML:{__html:i}}))})))))};function Vi(e,t){var a=t.toUpperCase();return null===e?a:"".concat(a," (").concat(e," KM)")}function Qi(e){var t=this.chart,a=Si.a.charts;"syncExtremes"!==e.trigger&&Si.a.each(a,(function(a){a!==t&&a.xAxis[0].setExtremes&&a.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})}))}function Zi(e){for(var t=e.length,a=function(e){var t=Object(Ke.a)(Ki);if(t.length!==e){for(var a=0;a<e;a+=1){var n={index:a,size:e},r=Ji(n,2*Math.PI*2/3),i=Ji(n,1*Math.PI*2/3),l=Ji(n,0*Math.PI*2/3);t[a]="#".concat(r).concat(l).concat(i)}Ki=Object(Ke.a)(t)}return t}(t),n=Object(Ke.a)(e),r=0;r<t;r+=1)"Cumulative"!==e[r].name&&(n[r].color=a[r]);return n}window.moment=ne,ki()(Si.a);var Ki=[];function Ji(e,t){var a=e.index,n=e.size,r=Math.sin(Math.PI/n*2*a+t),i=(Math.floor(127*r)+128).toString(16);return 1===i.length?"0".concat(i):i}var Xi=function(e){var t,a=e.match.params.tsm_sensor,i=e.width,l=e.input,c=e.disableBack,s=e.saveSVG,m=e.currentUser,u="",d=a;if("undefined"!==typeof l){var g=l.ts_end,f=l.tsm_sensor;u=g,t=ne(g),d=f}else{var b=ne();u=b.format("YYYY-MM-DD HH:mm:ss"),t=b}var E=ct(t,7,"days"),v="undefined"!==typeof c&&c,_="undefined"!==typeof s&&s,O=Object(n.useState)({start:E,end:u}),x=Object(o.a)(O,2),j=x[0],S=(x[1],Object(n.useState)([])),A=Object(o.a)(S,2),w=A[0],D=A[1],M=Object(n.useRef)(Object(Ke.a)(Array(6)).map((function(){return Object(n.createRef)()}))),I=Object(n.useState)(!1),N=Object(o.a)(I,2),T=N[0],H=N[1],R=Object(n.useState)([]),Y=Object(o.a)(R,2),B=Y[0],L=Y[1],P={ts_end:j.end,ts_start:j.start,subsurface_column:d},F=Object(ie.b)(i,"sm");Object(n.useEffect)((function(){!function(e,t){var a=e.subsurface_column,n=e.ts_end,r="".concat(k,"/api/subsurface/get_subsurface_plot_data/").concat(a,"/").concat(n);C.a.get(r).then((function(e){var a=e.data;console.log("Subsurface Plot Data",a),t(a)})).catch((function(e){console.error(e)}))}(P,(function(e){var t=[];e.forEach((function(e){var a=e.type,n=e.data,r=JSON.parse(JSON.stringify(n)),i=[];"column_position"===a?i=function(e,t){var a=e.data,n=[];return a.forEach((function(a){var r=a.orientation,i=Zi(a.data),l=Object(p.a)({},e,{data:i,orientation:r,type:t});n.push(l)})),n}(r,a):"displacement"===a?i=function(e,t){var a=[];return e.forEach((function(e,n){var r=e.data,i=e.annotations;r[0].type="area";var l=Zi(r);i.forEach((function(e){e.width=0,e.label.style={color:"gray"}}));var c=Object(p.a)({},e,{data:l,annotations:i,type:t});a.push(c)})),a}(r,a):"velocity_alerts"===a&&(i=function(e,t){var a=e.velocity_alerts,n=e.timestamps_per_node,r=[],i=Zi(n);return a.forEach((function(e){var a=e.orientation,n=e.data,l=Object(Ke.a)(i);Object.keys(n).forEach((function(e){var t="L2"===e?7:10,a="L2"===e?"#FFFF00":"#FF0000",r={data:n[e],type:"scatter",zIndex:5,name:e,marker:{symbol:"triangle",radius:t,fillColor:a,lineColor:"#000000",lineWidth:2}};l.push(r)}));var c={data:l,type:t,orientation:a};r.push(c)})),r}(r,a)),t.push.apply(t,Object(Ke.a)(i))})),D(t)}))}),[j]);var z=Object(n.useState)([]),G=Object(o.a)(z,2),U=G[0],W=G[1];Object(n.useEffect)((function(){var e=[];w.forEach((function(t){var a,n=t.type;"column_position"===n?a=function(e,t,a){var n=e.data,r=e.max_position,i=e.min_position,l=e.orientation,c=t.subsurface_column,o="across_slope"===l?"Across Slope":"Downslope";return{series:n,chart:{type:"scatter",zoomType:"x",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Column Position Plot of ".concat(c.toUpperCase(),"</b>"),style:{fontSize:"1rem"}},plotOptions:{series:{lineWidth:2,states:{hover:{enabled:!0,lineWidth:5}},marker:{enabled:!0,radius:3,lineColor:null}}},tooltip:{formatter:function(){return"Timestamp: <b>".concat(ne(this.series.name).format("dddd, MMM D, HH:mm"),"</b><br>Depth: <b>").concat(this.y,"</b><br>Displacement: <b>").concat(this.x,"</b>")}},xAxis:{min:i,max:r+.02,gridLineWidth:1,title:{text:"<b>Horizontal displacement, ".concat(o," (m)</b>")}},yAxis:{title:{text:"<b>Depth (m)</b>"}},credits:{enabled:!1},legend:{enabled:!0,align:a?"right":"center",layout:a?"vertical":"horizontal",verticalAlign:a?"middle":"bottom",labelFormatter:function(){return"".concat(ne(this.name).format("MM/DD, HH:mm"))}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,P,F):"displacement"===n?a=function(e,t){var a=e.orientation,n=e.data,r=e.annotations,i=t.subsurface_column,l=t.ts_end;return{series:n,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Displacement Plot, ".concat("across_slope"===a?"Across Slope":"Downslope"," of ").concat(i.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(ne(l).format("D MMM YYYY, HH:mm"),"</b><br><br><b>Note: </b> (+/-) consistently increasing/decreasing trend"),style:{fontSize:"0.6rem"}},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Date</b>"}},yAxis:{plotBands:r,title:{text:"<b>Relative Displacement (mm)</b>"}},tooltip:{header:"{point.x:%Y-%m-%d}: {point.y:.2f}"},plotOptions:{spline:{marker:{enabled:!0}}},credits:{enabled:!1},legend:{enabled:!1},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,P):"velocity_alerts"===n&&(a=function(e,t){var a=e.data,n=e.orientation,r=t.subsurface_column,i=t.ts_end,l="across_slope"===n?"Across Slope":"Downslope",c=a.map((function(e){return e.name+1}));return{series:a,chart:{type:"line",zoomType:"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-30}},spacingTop:20,spacingRight:24},title:{text:"<b>Velocity Alerts Plot, ".concat(l," of ").concat(r.toUpperCase(),"</b>"),style:{fontSize:"1rem"},margin:20,y:16},subtitle:{text:"As of: <b>".concat(ne(i).format("D MMM YYYY, HH:mm"),"</b>"),style:{fontSize:"0.6rem"}},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e %b %Y",year:"%Y"},title:{text:"<b>Time</b>"}},legend:{enabled:!1},yAxis:{categories:c,reversed:!0,title:{text:"<b>Depth (m)</b>"},labels:{formatter:function(){return this.value}}},tooltip:{formatter:function(){return"<b>".concat(ne(this.x).format("DD MMM YYYY, HH:mm"),"</b>")}},plotOptions:{line:{marker:{enabled:!0,radius:2}}},time:{timezoneOffset:-480},exporting:{sourceHeight:800,sourceWidth:600}}}(t,P)),e.push(a)})),W(e),e.length>0&&_&&H(!0)}),[w]),Object(n.useEffect)((function(){if(T){var e=[];M.current.forEach((function(t){var a=t.current.chart.getSVGForExport();e.push(a)})),L(e)}}),[T,M]);var q=Object(n.useRef)(null);Object(n.useEffect)((function(){if(B.length>0){var e=q.current.outerHTML;Ii({user_id:m.user_id,tsm_sensor:d,site_code:l.site_code,chart_type:"subsurface",svg:e},(function(e){}))}}),[B]);var V={title:{text:"Loading"}};return r.a.createElement(n.Fragment,null,!v&&r.a.createElement(Yi,e),r.a.createElement("div",{style:{marginTop:16}},r.a.createElement(y.a,{container:!0,spacing:4},M.current.map((function(e,t){var a=Object(p.a)({},V);return U.length>0&&(a=U[t]),r.a.createElement(y.a,{item:!0,xs:12,md:6,key:t},r.a.createElement(h.a,null,r.a.createElement(xi.a,{highcharts:Si.a,options:a,ref:e})))})))),_&&r.a.createElement(Fi.a,{xsUp:!0,implementation:"css"},r.a.createElement("svg",{width:1200,height:2400,viewBox:"0 0 1200 2400",ref:q},B.map((function(e,t){var a=t%2===1?0:600,i=800*Math.floor(t/2);return r.a.createElement(n.Fragment,{key:t},r.a.createElement("svg",{x:a,y:i,dangerouslySetInnerHTML:{__html:e}}))})))))};var $i=function(e){var t=e.match.params.site_code,a=e.location,i=a.site,l=a.ts_end,c=a.to_include,o=l,s=a.subsurface_columns,m=Object(p.a)({},c);"undefined"===typeof i&&(o=re()(),s=[],m={rainfall:!0,surficial:!0});var u={site_code:t,ts_end:o.format("YYYY-MM-DD HH:mm:ss")};return r.a.createElement(n.Fragment,null,r.a.createElement(Yi,e),r.a.createElement(y.a,{container:!0,spacing:1},m.rainfall&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(qi,Object.assign({},e,{input:u,disableBack:!0}))),m.surficial&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Pi,Object.assign({},e,{input:u,disableBack:!0}))),s.map((function(t){var a=Object(p.a)({},u,{tsm_sensor:t});return r.a.createElement(y.a,{key:t,item:!0,xs:12},r.a.createElement(Xi,Object.assign({},e,{input:a,disableBack:!0})))}))))},el=Object(x.a)((function(e){return{link:{textDecoration:"none"}}}));var tl=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.clickHandler,l=e.isMobile,c=e.url,u=(el(),Object(n.useState)({value:null,data:{site_code:null}})),d=Object(o.a)(u,2),f=d[0],b=d[1],E=Object(n.useState)(re()()),v=Object(o.a)(E,2),h=v[0],_=v[1],x=Object(n.useState)({rainfall:!0,surficial:!0,subsurface:{}}),j=Object(o.a)(x,2),S=j[0],A=j[1],w=Object(n.useState)([]),D=Object(o.a)(w,2),M=D[0],I=D[1],N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(a){var n=a.target.checked,r=n;if(null!==t){var i=S.subsurface;i[t]=n,r=i}A(Object(p.a)({},S,Object(s.a)({},e,r)))}};Object(n.useEffect)((function(){return function(){_(re()())}}),[a]),Object(n.useEffect)((function(){var e=f.data.site_code;null!==e&&function(e,t){var a="".concat(k,"/api/subsurface/get_site_subsurface_columns/").concat(e);C.a.get(a).then((function(a){var n=a.data;console.log("Subsurface Columns of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(e,(function(e){I([]);var t={};e.forEach((function(e){var a=null===e.date_deactivated;t[e.logger.logger_name]=a})),A(Object(p.a)({},S,{subsurface:t})),I(e)}))}),[f.data.site_code]);var T=f.data,H=[];return Object.keys(S.subsurface).forEach((function(e){S.subsurface[e]&&H.push(e)})),r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},"Consolidate charts per site"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Zt,{value:f,changeHandler:function(e){return b(e)}})),r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:h,onChange:function(e){return _(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"__/__/____ __:__",clearable:!0,disableFuture:!0})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:18}},r.a.createElement(Ye.a,{component:"fieldset"},r.a.createElement($t.a,{component:"legend"},"Charts to Show"),r.a.createElement(ea.a,{"aria-label":"position",row:!0},r.a.createElement(Le.a,{value:"rainfall",control:r.a.createElement(Ot.a,{color:"primary",onClick:N("rainfall"),checked:S.rainfall}),label:"Rainfall"}),r.a.createElement(Le.a,{value:"surficial",control:r.a.createElement(Ot.a,{color:"primary",onClick:N("surficial"),checked:S.surficial}),label:"Surficial"})))),r.a.createElement(y.a,{item:!0,xs:12,style:{marginTop:8}},r.a.createElement(Ye.a,{component:"fieldset"},r.a.createElement($t.a,{component:"legend"},"Subsurface Columns"),r.a.createElement(ea.a,{"aria-label":"position",row:!0},M.map((function(e){var t=e.date_deactivated,a=e.logger.logger_name,n=null===t?"":" (Deactivated)";return r.a.createElement(Le.a,{key:a,value:a,control:r.a.createElement(Ot.a,{color:"primary",onClick:N("subsurface",a),checked:S.subsurface[a]}),label:a.toUpperCase()+n})})),0===M.length&&r.a.createElement(O.a,{variant:"body1"},"No site selected")))),!l&&r.a.createElement("div",{style:{height:120}})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{component:m.b,to:{pathname:"".concat(c,"/consolidated/").concat(T.site_code),ts_end:h,site:T,to_include:S,subsurface_columns:H},color:"primary",onClick:i,disabled:0===f.length},"Submit"),r.a.createElement(g.a,{onClick:i},"Cancel")))}));var al=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.clickHandler,l=e.setReloadEqEvent,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(null),f=Object(o.a)(p,2),E=f[0],v=f[1],h=Object(n.useState)(0),_=Object(o.a)(h,2),O=_[0],x=_[1],j=Object(n.useState)(0),S=Object(o.a)(j,2),A=S[0],w=S[1],D=Object(n.useState)(re()()),M=Object(o.a)(D,2),N=M[0],T=M[1],H=Object(n.useState)(!0),R=Object(o.a)(H,2),Y=R[0],B=R[1],L=Object(c.useSnackbar)(),P=L.enqueueSnackbar,F=L.closeSnackbar,z=I(),G=z.first_name,U=z.last_name,W=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){F(e)}},"Dismiss")};Object(n.useEffect)((function(){return T(re()())}),[a]),Object(n.useEffect)((function(){B(!(E>0&&O>0&&A>0&&u>=0&&u<=10))}),[E,u,A,O]);var q=function(){var e="".concat(G," ").concat(U).split(" "),t="";e.forEach((function(e){t+=e.charAt(0)})),function(e,t){var a="".concat(k,"/api/analysis/insert_earthquake_event");C.a.post(a,e).then((function(e){t(e)})).catch((function(e){console.error(e)}))}({magnitude:u,depth:E,long:O,lat:A,timestamp:N.format("YYYY-MM-DD HH:mm"),issued_by:t},(function(e){200===e.status?(P("Success saving earthquake event",{variant:"success",autoHideDuration:7e3,action:W}),l(!0)):P("Error saving earthquake event",{variant:"error",autoHideDuration:7e3,action:W})})),i(!1)},V=(u>10||u<=0)&&null!==u,Q=E<=0&&null!==u;return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},"Insert Earthquake Event"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Fill in the following."),r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(jt.a,{utils:xt.a},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(St.b,{required:!0,autoOk:!0,label:"Data Timestamp",value:N,onChange:function(e){return T(e)},ampm:!1,placeholder:"2010/01/01 00:00",format:"YYYY/MM/DD HH:mm",mask:"____/__/__ __:__",clearable:!0,disableFuture:!0}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ye.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Magnitude",onChange:function(e){return d(e.target.value)},type:"number",InputProps:{inputProps:{max:10,min:1}},fullWidth:!0,helperText:V?"Insert magnitude from 0.1 to 10":"",error:V}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ye.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Depth (km)",defaultValue:"",onChange:function(e){return v(e.target.value)},type:"number",fullWidth:!0,helperText:Q?"Positive numbers only":"",error:Q}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ye.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{type:"number",required:!0,label:"Latitude",defaultValue:"",onChange:function(e){return w(e.target.value)}}))),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Ye.a,{component:"fieldset",fullWidth:!0},r.a.createElement(b.a,{required:!0,label:"Longitude",type:"number",defaultValue:"",onChange:function(e){return x(e.target.value)}}))))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{color:"primary",onClick:function(){return q()},disabled:Y},"Submit"),r.a.createElement(g.a,{onClick:i,color:"secondary"},"Cancel")))})),nl=a(49),rl=a.n(nl),il=(a(393),a(667)),ll=a(662),cl=a(636),ol=a(637),sl=a(666),ml=a(638),ul=a(412),dl=a.n(ul),pl=a(413),gl=a.n(pl),fl=a(414),bl=a.n(fl),El=rl.a.icon({iconUrl:dl.a,shadowUrl:gl.a,iconRetinaUrl:bl.a,iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],shadowAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28]});var vl=function(e){var t=e.eqEvents,a=[12.8797,121.774],i=5;if(e.zoomIn){var l=t[0];a=[l.latitude,l.longitude],i=7}var c=/\.0*$|(?<=\.[0-9]{0,2147483646})0*$/;return r.a.createElement(il.a,{style:{height:465},center:a,zoom:i},r.a.createElement(ll.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((function(e){var t=e.latitude,a=e.longitude,i=e.magnitude,l=e.depth,o=e.critical_distance,s=e.eq_id,m=[t,a],u=null===o?0:parseFloat(o);return r.a.createElement(n.Fragment,{key:s},r.a.createElement(cl.a,{center:m,fillColor:"blue",radius:1e3*u}),r.a.createElement(ol.a,{icon:El,position:m},r.a.createElement(sl.a,null,"Magnitude: ",r.a.createElement("strong",null,i.replace(c,""))," ",r.a.createElement("br",null),"Depth: ",r.a.createElement("strong",null,l.replace(c,""))," ",r.a.createElement("br",null),"Critical Distance: ",r.a.createElement("strong",null,u," km"))))})),Nn.map((function(e){return r.a.createElement(ml.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},r.a.createElement(sl.a,null,r.a.createElement("strong",null,e.site_code.toUpperCase())," ",r.a.createElement("br",null),nt(e,!1)))})))},hl=Object(ir.a)({overrides:{MUIDataTableBodyCell:{root:{whiteSpace:"nowrap"}}}}),_l=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}}],yl=[{name:"Timestamp"},{name:"Magnitude"},{name:"eq_id",options:{display:!1,viewColumns:!1,filter:!1}},{name:"Sites",options:{filter:!1}}];var Ol=function(e){var t=e.eqEvents,a=e.eqAlerts,n=e.eqAlertsPagination,i=e.setEqAlTblPage,l=r.a.useState(0),c=Object(o.a)(l,2),s=c[0],m=c[1],u=r.a.useState([]),d=Object(o.a)(u,2),g=d[0],f=d[1],b=r.a.useState([]),E=Object(o.a)(b,2),v=E[0],h=E[1];r.a.useEffect((function(){f(Object(Ke.a)(t));var e=t.map((function(e){return[re()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id]}));h(Object(Ke.a)(e))}),[t]);var _=function(e,t){var a=t.filter((function(t){return t.eq_id===e}));f(Object(Ke.a)(a))},x=r.a.useState([]),j=Object(o.a)(x,2),S=j[0],C=j[1];r.a.useEffect((function(){var e=a.map((function(e){var t=e.eq_alerts.map((function(e){return e.site.site_code.toUpperCase()}));return[re()(e.ts).format("D MMM YYYY, HH:mm"),parseFloat(e.magnitude),e.eq_id,t.join(", ")]}));C(Object(Ke.a)(e))}),[a]);var k={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,search:!1,filter:!1,viewColumns:!1,responsive:"scrollMaxHeight",onRowClick:function(e,a,n){_(e[2],t)}},A={textLabels:{body:{noMatch:"No data"}},selectableRows:"none",count:n.count,rowsPerPage:3,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"scrollMaxHeight",serverSide:!0,onChangePage:function(e){var t=e*n.limit;i(Object(p.a)({},n,{offset:t}))},onRowClick:function(e,t,n){_(e[2],a)}};return r.a.createElement(y.a,{container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(vl,{eqEvents:g,zoomIn:1===g.length})),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(P.a,{position:"static"},r.a.createElement(J.a,{value:s,onChange:function(e,t){return m(t)},variant:"fullWidth"},r.a.createElement(X.a,{label:"EQ Events"}),r.a.createElement(X.a,{label:"EQ Alerts"}))),0===s&&r.a.createElement(lr.a,{theme:hl},r.a.createElement(rr.a,{title:"Latest Earthquake Events",columns:_l,options:k,data:v,style:{height:465}})),1===s&&r.a.createElement(lr.a,{theme:hl},r.a.createElement(rr.a,{title:r.a.createElement(O.a,{variant:"body1"},"Earthquake Alerts"),columns:yl,options:A,data:S}))))};function xl(e){return re()(e).format("D MMMM YYYY, HH:mm")}function jl(e){var t=e.first_name,a=e.last_name;return"".concat(t," ").concat(a)}function Sl(e){var t=e.moms_data,a=e.match.params.instance_id,n=t.find((function(e){return e.instance_id===parseInt(a,10)})),i=[],l="";if("undefined"!==typeof n){i=n.moms;var c=n.feature.feature_type,o=n.feature_name;l="".concat(c," - ").concat(o)}var s=function(e){return e.map((function(e){var t=e.observance_ts,a=e.narrative,n=e.reporter,r=e.validator,i=e.op_trigger,l=e.remarks,c=a.narrative,o=a.timestamp;return[xl(t),c,xl(o),jl(n),jl(r),l,i]}))}(i);return r.a.createElement(h.a,{style:{marginTop:16}},r.a.createElement(rr.a,{title:r.a.createElement(O.a,{variant:"h6"},"Manifestation of Movement Reports ",r.a.createElement("span",{style:{fontSize:"small"}},l.toUpperCase())),columns:["Observance Timestamp","Narrative","Report Timestamp","Reporter","Validator","Remarks","Alert Level"],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"scrollMaxHeight"},data:s}))}var Cl,kl=function(e){var t=e.history,a=e.match,i=a.url,l=a.params.site_code,c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],d=s[1],p=Object(n.useState)([]),g=Object(o.a)(p,2),f=g[0],b=g[1];Object(n.useEffect)((function(){!function(e,t){var a="".concat(k,"/api/manifestations_of_movement/get_moms_instances/").concat(e);C.a.get(a).then((function(a){var n=a.data;console.log("MOMs Instances of ".concat(e.toUpperCase()),n),t(n)})).catch((function(e){console.error(e)}))}(l,(function(e){var t=e.map((function(e){var t=e.feature.feature_type,a=e.feature_name,n=e.moms,r=e.instance_id,i=e.location,l=t.charAt(0).toUpperCase()+t.slice(1),c=n[0],o=[];if("undefined"!==typeof c){var s=c.observance_ts,m=c.op_trigger;o=[l,a,i,xl(s),m,r]}return o})).filter((function(e){return e.length>0})).sort((function(e,t){return t[4]-e[4]}));b(t),d(e)}))}),[]);var E=Object(n.useState)(!1),v=Object(o.a)(E,2),_=v[0],y=v[1],O=function(e){return function(){return y(e)}};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(Yi,e),r.a.createElement(er,{clickHandler:O(!0)})),r.a.createElement(h.a,{style:{marginTop:16}},r.a.createElement(rr.a,{title:"Manifestation of Movement Features of ".concat(l.toUpperCase()),columns:["Type",{name:"Name",options:{filter:!1}},{name:"Location",options:{filter:!1}},{name:"Last Observance Timestamp",options:{filter:!1}},"Alert Level",{name:"data",options:{display:!1,viewColumns:!1,filter:!1}}],options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:5,rowsPerPageOptions:[],print:!1,download:!1,responsive:"scrollMaxHeight",onRowClick:function(e,a,n){var r=e[5];t.push("".concat(i,"/").concat(r))}},data:f})),r.a.createElement(Xn,Object.assign({},e,{isOpen:_,closeHandler:O(!1)})),r.a.createElement(u.b,{path:"".concat(i,"/:instance_id"),render:function(e){return r.a.createElement(Sl,Object.assign({},e,{moms_data:m}))}}))};yi()(hi.a);var Al=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{tabBar:Object(p.a)({},t.pageContentMargin,{margin:0}),tabBarContent:{marginTop:30}})})),wl=function(){return r.a.createElement(xe.a,{height:600,width:400,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("rect",{x:"0",y:"0",rx:"0",ry:"0",width:"400",height:"600"}))};function Dl(e,t){return r.a.createElement("span",null,r.a.createElement(g.a,{"aria-label":"Insert Earthquake Event",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:t(!0)},r.a.createElement(bi.a,{style:{paddingRight:4,fontSize:20}}),"Insert Earthquake Event"),r.a.createElement(g.a,{"aria-label":"Consolidate by site",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:e(!0)},r.a.createElement(Ei.a,{style:{paddingRight:4,fontSize:20}}),"Consolidate by site"))}function Ml(e,t){var a=[];return e&&0!==Object.keys(e).length&&e.xAxis[0]&&e.series[0].points.forEach((function(e){a.push(function(e,t){var a=t.data,n=t.type,l=t.dataLabel;return r.a.createElement("div",{key:a},Object(i.createPortal)(r.a.createElement(m.b,{to:"".concat(e,"/").concat(n,"/").concat(a),style:{fontSize:l.options.style.fontSize,position:"absolute",fontFamily:"Lucida Grande, Lucida Sans Unicode, Arial Helvetica, sans-serif",color:"#000000"}},a.toUpperCase()),l.div))}(t,e))})),a}function Il(e,t,a){var n=t.charAt(0).toUpperCase()+t.slice(1),r="<b>".concat(n," Data Availability</b>"),i=60,l="Timestamp: <b>".concat(Cl.format("D MMM YYYY, HH:mm"),"</b>");switch(t){case"surficial":l+="<br/>Note: Data presence within four hours until next release<br/><b>*Sites without markers</b>";break;case"subsurface":85,i=100;break;case"loggers":95,i=100}return e&&i,{chart:{type:"heatmap",height:600,spacingTop:12,spacingRight:18},title:{text:r,style:{fontSize:"1rem"},y:20},subtitle:{text:l,style:{fontSize:"0.70rem"}},xAxis:{visible:!1},yAxis:{visible:!1},legend:{enabled:!1},colorAxis:{stops:[[0,"#cccccc"],[1,"#7cb5ec"]],min:0,max:1},tooltip:{outside:!0,formatter:function(){var e,t=this.point,a=t.label,n=t.type,r=t.value,i=t.ts_last_data,l=t.ts_updated,c=t.diff_days,o=r?"With":"No";switch(n){case"rainfall":e="Rain gauge";break;case"surficial":e="Site";break;case"subsurface":e="Sensor";break;case"loggers":e="Logger"}var s="".concat(e,": <b>").concat(a,"</b><br/>")+"Presence: <b>".concat(o," data</b><br/>")+"Last data timestamp: <b>".concat(re()(i).format("D MMM YYYY, HH:mm"),"</b>");return"surficial"!==n&&(s+="<br/>Last update timestamp: <b>".concat(re()(l).format("D MMM YYYY, HH:mm"),"</b><br/>")+"Days since last data: <b>".concat(c,"</b><br/>")),s}},credits:{enabled:!1},series:[{name:"",borderWidth:1,borderColor:"#444444",data:function(e,t,a){var n=[],r=0;return e.forEach((function(e,a){var i,l=e.last_data,c=e.ts_updated,o=e.diff_days,s=e.presence;"surficial"===t?(i=e.site_code,e.has_surficial_markers||(i+="*")):i="rainfall"===t?e.rain_gauge.gauge_name:"subsurface"===t?e.tsm_sensor.logger.logger_name:e.logger.logger_name;var m={x:a%5,y:5-r,value:s,label:i.toUpperCase(),data:i,type:t,ts_last_data:l,ts_updated:c,diff_days:o};n.push(m),a%5===4&&(r+=1)})),n}(a,t),dataLabels:{enabled:!0,useHTML:!0,color:"#000000",display:"none",style:{fontWeight:100},formatter:function(){return this.point.label}}}]}}var Nl=Object(ie.a)()((function(e){var t=e.width,a=e.location,i=e.match,l=i.path,c=i.url,d=Al(),g=Object(ie.b)(t,"sm");Cl=re()();var f=Object(n.useState)(!1),b=Object(o.a)(f,2),E=b[0],v=b[1],_=Object(n.useState)(!1),O=Object(o.a)(_,2),x=O[0],j=O[1],S=function(e){return function(){return v(e)}},A=function(e){return function(){return j(e)}},w=Object(n.useState)([]),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)(null),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(null),B=Object(o.a)(Y,2),L=B[0],P=B[1],F=Object(n.useState)([]),z=Object(o.a)(F,2),G=z[0],U=z[1],W=Object(n.useState)(null),q=Object(o.a)(W,2),V=q[0],Q=q[1],Z=Object(n.useState)(null),K=Object(o.a)(Z,2),J=K[0],X=K[1],$=Object(n.useState)([]),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(null),le=Object(o.a)(ne,2),ce=le[0],oe=le[1],se=Object(n.useState)(null),me=Object(o.a)(se,2),ue=me[0],de=me[1],pe=Object(n.useState)([]),ge=Object(o.a)(pe,2),fe=ge[0],Ee=ge[1],ve=Object(n.useState)(null),he=Object(o.a)(ve,2),ye=he[0],Oe=he[1],xe=Object(n.useState)({}),je=Object(o.a)(xe,2),Se=je[0],Ce=je[1],ke=Object(n.useState)(null),Ae=Object(o.a)(ke,2),we=Ae[0],De=Ae[1],Me=function(e){return function(t){Ce((function(a){return Object(p.a)({},a,Object(s.a)({},e,t))}))}};Object(n.useEffect)((function(){Mi("surficial",(function(e){U(e)})),Mi("tsm",(function(e){I(e)})),Mi("rain_gauges",(function(e){ae(e)})),Mi("loggers",(function(e){Ee(e)}))}),[]),Object(n.useEffect)((function(){if(G.length>0){var e=Il(!g,"surficial",G);Q(e)}}),[G,g]),Object(n.useEffect)((function(){if(M.length>0){var e=Il(!g,"subsurface",M);R(e)}}),[M,g]),Object(n.useEffect)((function(){if(te.length>0){var e=Il(!g,"rainfall",te);oe(e)}}),[te,g]),Object(n.useEffect)((function(){if(fe.length>0){var e=Il(!g,"loggers",fe);Oe(e)}}),[fe,g]),Object(n.useEffect)((function(){var e=Ml(Se.rainfall,c);de(e)}),[Se.rainfall,c]),Object(n.useEffect)((function(){var e=Ml(Se.surficial,c);X(e)}),[Se.surficial,c]),Object(n.useEffect)((function(){var e=Ml(Se.subsurface,c);P(e)}),[Se.subsurface,c]);var Ie=Object(n.useContext)(qt).setIsReconnecting;Object(n.useEffect)((function(){var e;return Ue(Ie),e=function(e){var t=function(e){var t=e.site_codes,a=e.list_1d,n=e.list_3d;return{chart:{type:"column"},title:{text:"<b>Cumulative Rainfall Data vs Threshold Plot of Dynaslope Sites</b>",style:{fontSize:"1rem"},y:20},subtitle:{text:"As of: <b>".concat(re()().format("D MMM YYYY, HH:mm"),"</b><br>Note: Percentage capped at 100%")},xAxis:{categories:t,title:{text:"<b>Sites</b>"}},yAxis:{min:0,max:100,title:{text:"<b>Threshold Ratio (%)</b>"}},tooltip:{shared:!0,useHTML:!0,formatter:function(){var e=this.x,t=this.points,a=t[0].point.data_source.replace(/_/g," "),n="<b>".concat(e," (").concat(a.toUpperCase(),")</b><br>");return t.forEach((function(e){n+="".concat(e.point.data_value,"<br>"),n+="- Percentage: <b>".concat(e.point.y.toFixed(2),"%</b><br>")})),n}},plotOptions:{column:{grouping:!1,shadow:!1}},series:[{name:"Three-day Cumulative Data",data:n,pointPadding:0,color:"#FF0000"},{name:"One-day Cumulative Data",data:a,pointPadding:.2}],credits:{enabled:!1}}}(function(e){var t=[],a=[],n=[];return e.forEach((function(e){var r=e.site_code,i=e["1D cml"],l=e["3D cml"],c=e["half of 2yr max"],o=e["2yr max"],s=e.DataSource,m=i?"".concat(i," mm"):"0 mm",u=l?"".concat(l," mm"):"0 mm",d={y:i/c*100,data_value:"<b><i>One Day Data</i></b><br>- Cumulative Data: <b>".concat(m,"</b><br>- Threshold: <b>").concat(c," mm</b>"),data_source:s},p={y:l/o*100,data_value:"<b><i>Three Day Data</i></b><br>- Cumulative Data: <b>".concat(u,"</b><br>- Threshold: <b>").concat(o," mm</b>"),data_source:s};t.push(d),a.push(p),n.push(r.toUpperCase())})),{list_1d:t,list_3d:a,site_codes:n}}(e));De(t)},Ge(),_e.on("receive_rainfall_data",(function(t){var a=JSON.parse(t);console.log("All Site Rainfall Data: ",a),e(a)})),function(){qe()}}),[]);var Ne=Object(n.useState)([]),Te=Object(o.a)(Ne,2),He=Te[0],Re=Te[1];Object(n.useEffect)((function(){var e=[];!function(e){var t="".concat(k,"/api/manifestations_of_movement/get_latest_alerts");C.a.get(t).then((function(t){var a=t.data;console.log("MOMs Alerts",a),e(a)})).catch((function(e){console.error(e)}))}((function(t){t.forEach((function(t){var a=t.site_code,n=t.moms_alert,r={site_code:a,address:nt(t,!0,"start"),moms_alert:n};e.push(r)})),Re(e)}))}),[c]);var Ye=[{name:"address",label:"Site",options:{filter:!1,customBodyRender:function(e,t){var a=t.rowIndex,n=He[a].site_code;return r.a.createElement(m.b,{to:"".concat(c,"/moms/").concat(n),style:{color:"black"}},e)}}},{name:"moms_alert",label:"Alert"}],Be=Object(n.useState)([]),Le=Object(o.a)(Be,2),Pe=Le[0],Fe=Le[1],ze=Object(n.useState)(!0),We=Object(o.a)(ze,2),Ve=We[0],Qe=We[1];Object(n.useEffect)((function(){Ve&&(!function(e){var t="".concat(k,"/api/analysis/get_earthquake_events");C.a.get(t).then((function(t){var a=t.data;console.log("Earthquake Events",a),e(a)})).catch((function(e){console.error(e)}))}((function(e){Fe(e)})),Qe(!1))}),[Ve]);var Ze=r.a.useState([]),Je=Object(o.a)(Ze,2),Xe=Je[0],$e=Je[1],et=r.a.useState({limit:5,offset:0,count:0}),tt=Object(o.a)(et,2),at=tt[0],rt=tt[1],it=r.a.useState(!0),lt=Object(o.a)(it,2),ct=lt[0],ot=lt[1];r.a.useEffect((function(){!function(e,t){var a=e.limit,n=e.offset,r="".concat(k,"/api/analysis/get_earthquake_alerts")+"?limit=".concat(a,"&offset=").concat(n);C.a.get(r).then((function(e){var a=e.data;console.log("Earthquake Alerts",a),t(a)})).catch((function(e){console.error(e)}))}(at,(function(e){var t=e.count,a=e.data;$e(Object(Ke.a)(a)),ct&&(ot(!1),rt(Object(p.a)({},at,{count:t})))}))}),[at,ct]);var st=a.pathname===l;return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(be,{title:"Analysis | Site Data Analytics",customButtons:!(!g||!st)&&Dl(S,A)})),r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(u.d,{location:a},r.a.createElement(u.b,{exact:!0,path:c,render:function(e){return r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==V?r.a.createElement(h.a,{elevation:2},r.a.createElement(xi.a,{highcharts:hi.a,options:V,callback:Me("surficial"),allowChartUpdate:!1}),J):r.a.createElement(wl,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==ce?r.a.createElement(h.a,{elevation:2},r.a.createElement(xi.a,{highcharts:hi.a,options:ce,callback:Me("rainfall"),allowChartUpdate:!1}),ue):r.a.createElement(wl,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==H?r.a.createElement(h.a,{elevation:2},r.a.createElement(xi.a,{highcharts:hi.a,options:H,callback:Me("subsurface"),allowChartUpdate:!1}),L):r.a.createElement(wl,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12,md:6,lg:3},null!==ye?r.a.createElement(h.a,{elevation:2},r.a.createElement(xi.a,{highcharts:hi.a,options:ye,callback:Me("loggers"),allowChartUpdate:!1})):r.a.createElement(wl,{style:{height:"100%"}})),r.a.createElement(y.a,{item:!0,xs:12},null!==we?r.a.createElement(h.a,{elevation:2},r.a.createElement(xi.a,{highcharts:hi.a,options:we})):r.a.createElement("div",null,"Loading...")),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:7},r.a.createElement(h.a,{elevation:2},r.a.createElement(Ol,{eqEvents:Pe,eqAlerts:Xe,eqAlertsPagination:at,setEqAlTblPage:rt}))),r.a.createElement(y.a,{item:!0,xs:12,md:12,lg:5},r.a.createElement(h.a,{elevation:2},r.a.createElement(rr.a,{title:"Latest MOMs Alert",columns:Ye,options:{textLabels:{body:{noMatch:"No data"}},selectableRows:"none",rowsPerPage:6,rowsPerPageOptions:[],print:!1,download:!1,viewColumns:!1,responsive:"scrollMaxHeight"},data:He}))))}}),r.a.createElement(u.b,{path:"".concat(c,"/surficial/:site_code"),render:function(e){return r.a.createElement(Pi,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/rainfall/:rain_gauge"),render:function(e){return r.a.createElement(qi,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/subsurface/:tsm_sensor"),render:function(e){return r.a.createElement(Xi,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/moms/:site_code"),render:function(e){return r.a.createElement(kl,Object.assign({},e,{width:t}))}}),r.a.createElement(u.b,{path:"".concat(c,"/consolidated/:site_code"),render:function(e){return r.a.createElement($i,Object.assign({},e,{width:t}))}}))),r.a.createElement(tl,{isOpen:E,clickHandler:S(!1),url:c}),r.a.createElement(al,{isOpen:x,clickHandler:A(!1),setReloadEqEvent:Qe}))})),Tl=a(619),Hl=a(651),Rl=a(652),Yl=a(623),Bl=a(663),Ll=a(644),Pl=a(645),Fl=a(646),zl=a(647),Gl=a(125),Ul=a.n(Gl),Wl=a(161),ql=a(641),Vl=Object(x.a)({avatar:{backgroundColor:Wl.a[100],color:Wl.a[600]}});var Ql=function(e){Vl();var t=e.onClose,a=e.open,n=e.isUnregistered,i=e.setBlockModal,l=e.setSaveContactModal;return r.a.createElement(Ne.a,{onClose:function(){t()},"aria-labelledby":"simple-dialog-title",open:a},r.a.createElement(Te.a,{id:"simple-dialog-title"},"Message options"),r.a.createElement(En.a,null,n&&r.a.createElement(hn.a,{button:!0,onClick:function(){return l(!0)}},r.a.createElement(yn.a,null,r.a.createElement(wr.a,null)),r.a.createElement(_n.a,{primary:"Save number"})),r.a.createElement(hn.a,{button:!0,onClick:function(){return i(!0)}},r.a.createElement(yn.a,null,r.a.createElement(ql.a,null)),r.a.createElement(_n.a,{primary:"Block number"}))))};var Zl,Kl=r.a.memo((function(e){var t=e.open,a=e.setBlockModal,i=e.mobileDetails,l=e.setOpenOptions,s=i.sim_num,m=i.mobile_id,u=Object(c.useSnackbar)(),d=u.enqueueSnackbar,p=u.closeSnackbar,f=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){p(e)}},"Dismiss")},E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],_=v[1],y=Object(n.useState)(null),O=Object(o.a)(y,2),x=O[0],j=O[1],S=I().user_id;return r.a.createElement(Ne.a,{open:t,onExited:function(){return _("")},"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Block mobile number (+".concat(s,")")),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Provide the reason for blocking this mobile number from Chatterbox"),r.a.createElement(b.a,{autoFocus:!0,value:h,onChange:function(e){var t=e.target.value;_(t);var a="";""===t&&(a="This is a required field"),j(a)},margin:"dense",id:"reason",label:"Reason",multiline:!0,fullWidth:!0,required:!0,placeholder:"Enter reason",inputProps:{maxLength:500},error:""===h,helperText:x})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:function(){return a(!1)},color:"primary"},"Cancel"),r.a.createElement(g.a,{onClick:function(){if(""===h)j("This is a required field");else{a(!1);var e={mobile_id:m,reporter_id:S,reason:h};console.log(e),function(e,t){var a="".concat(k,"/api/contacts/save_block_number");C.a.post(a,e).then((function(e){var a=e.data;console.log("Save blocked contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}(e,(function(e){var t=e.status,a=e.message;console.log(e),d(a,t?{variant:"success",autoHideDuration:4e3,action:f}:{variant:"error",autoHideDuration:3e3,action:f})})),l(!1)}},color:"secondary"},"Block")))})),Jl=a(642),Xl=a(643),$l=a(308),ec=a.n($l);function tc(){"undefined"!==typeof Zl&&null!==Zl||(Zl=oe()("".concat(k,"/communications"),{reconnectionDelay:1e4,reconnectionAttempts:30,transports:["websocket"]}))}function ac(e,t){tc(),"chatterbox"===e?(Zl.emit("get_latest_messages"),Zl.emit("get_all_mobile_numbers")):"contacts"===e&&Zl.emit("get_all_contacts"),Zl.on("reconnecting",(function(){t(!0)})),Zl.on("reconnect",(function(){t(!1)})),Zl.on("reconnect_failed",(function(){console.log("failed")}))}var nc={0:["LEWC"],1:["LGU","NGO"],2:["LGU","NGO","PNP"],3:["LGU","NGO","PNP"],4:["NGO","OCD","PHIVOLCS","DOST"],5:["NGO","OCD","PHIVOLCS","DOST","MGB"]},rc=["(","+","6","3","9",")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/],ic=["(","+",/\d/,/\d/,/\d/,")"," ",/\d/,/\d/,"-",/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/];function lc(e){var t=e.inputRef,a=e.mask,n=Object(Mt.a)(e,["inputRef","mask"]);return r.a.createElement(ec.a,Object.assign({},n,{ref:function(e){t(e?e.inputElement:null)},mask:a,placeholderChar:"x",showMask:!0,keepCharPositions:!0}))}function cc(e,t){var a=[];return"mobile"===t?e.forEach((function(e,t){var n=e.mobile_number;n.sim_num=n.sim_num.replace(/[()+-\s]/g,""),a.push(e)})):e.forEach((function(e,t){delete e.mobile_id,void 0===e.landline_id&&(e.landline_id=0),e.landline_num=e.landline_num.replace(/[()+-\s]/g,""),a.push(e)})),a}function oc(e,t){var a=t.type,n=t.category,r=t.payload,i=Object(Ke.a)(e),l={status:1,has_delete:!0};switch("email"===n?l="":"mobile"===n?l=Object(p.a)({},l,{mobile_number:{sim_num:"",mobile_id:0}}):"landline"===n&&(l=Object(p.a)({},l,{landline_num:""})),a){case"UPDATE":return"email"===n?i[r.key]=r.value:"mobile"===n&&"sim_num"===r.data?i[r.key].mobile_number[r.data]=r.value:i[r.key][r.data]=r.value,Object(Ke.a)(i);case"ADD":return[].concat(Object(Ke.a)(i),[l]);case"DELETE":return i.splice(r.key,1),Object(Ke.a)(i)}}var sc=r.a.memo((function(e){var t=e.municipalities,a=e.provinces,i=e.regions,l=e.setContactForm,m=e.chosenContact,u=e.isEditMode,d=e.setContactFormForEdit,f=e.handleClose,E=e.isFromChatterbox,v=[{mobile_number:{sim_num:"",mobile_id:0},status:1}],h=[],_=[],x=0,j="",S="",A="",w=1,D=!0,M=0,I={first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0};if(u){var N=m.mobile_numbers,T=m.ewi_recipient,H=m.ewi_restriction,R=m.landline_numbers,Y=m.emails,B=m.first_name,L=m.last_name,P=m.middle_name,F=m.nickname,z=m.user_id,U=m.organizations,W=m.status;if(I={first_name:B,last_name:L,middle_name:P,nickname:F,user_id:z},0!==U.length){var q=U[0].organization,V=q.scope;x=V,j=q.name;var Q=function(e,t){var a=t.municipality,n=t.province,r=t.region,i=t.site_id,l="",c="";return 0===e||1===e?(l={value:i},c=""):2===e?(l="",c=a):3===e?(l="",c=n):4===e&&(l="",c=r),{site:l,location:c}}(V,U[0].site);S=Q.site,A=Q.location}if(null!==H)if(0!==H.length)M=H.alert_level;v=N.map((function(e,t){var a,n=JSON.parse(JSON.stringify(e)),r=n.mobile_number.sim_num;return n.mobile_number.sim_num=(a=r,Object($l.conformToMask)(a,ic).conformedValue),n})),h=R,_=Y,D=1===T,w=1===W}var Z=[{id:0,label:"Community"},{id:1,label:"Barangay"},{id:2,label:"Municipal",select_label:"Municipality",list:t},{id:3,label:"Provincial",select_label:"Province",list:a},{id:4,label:"Regional",select_label:"Region",list:i},{id:5,label:"National"}],K=Object(n.useState)(I),J=Object(o.a)(K,2),X=J[0],$=J[1],ee=Object(n.useState)(x),te=Object(o.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)(S),ie=Object(o.a)(re,2),le=ie[0],ce=ie[1],oe=Object(n.useState)(A),se=Object(o.a)(oe,2),me=se[0],ue=se[1],de=Object(n.useState)([]),pe=Object(o.a)(de,2),ge=pe[0],fe=pe[1],be=Object(n.useState)(j),Ee=Object(o.a)(be,2),ve=Ee[0],he=Ee[1],_e=Object(n.useReducer)(oc,v),ye=Object(o.a)(_e,2),xe=ye[0],je=ye[1],Se=Object(n.useReducer)(oc,h),Ce=Object(o.a)(Se,2),ke=Ce[0],Ae=Ce[1],we=Object(n.useReducer)(oc,_),De=Object(o.a)(we,2),Me=De[0],Ie=De[1],Ne=Object(n.useState)(D),Te=Object(o.a)(Ne,2),He=Te[0],Re=Te[1],Be=Object(n.useState)(w),Pe=Object(o.a)(Be,2),Fe=Pe[0],ze=Pe[1],Ge=Object(c.useSnackbar)(),Ue=Ge.enqueueSnackbar,We=Ge.closeSnackbar,qe=Object(n.useState)(M),Ve=Object(o.a)(qe,2),Qe=Ve[0],Ze=Ve[1],Ke=Object(n.useState)(!1),Je=Object(o.a)(Ke,2),Xe=Je[0],$e=Je[1],et=function(){return E&&f(),u?d(!1):l(!1)},tt=function(e){return function(t){$(Object(p.a)({},X,Object(s.a)({},e,t.target.value)))}},at=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){We(e)}},"Dismiss")};Object(n.useEffect)((function(){if(""!==ae){var e=nc[ae].map((function(e){return{id:e.toLowerCase(),label:e}}));fe(e),u||(ce(""),ue(""),he(""))}}),[ae]);var nt=Object(n.useState)({}),rt=Object(o.a)(nt,2),it=(rt[0],rt[1]);Object(n.useEffect)((function(){it({user:Object(p.a)({},X)});var e;e=function(e,t,a){var n=e.first_name,r=e.last_name,i=a.scope,l=a.site,c=a.office,o=a.location,s=t.mobile_nums,m=t.landline_nums,u=!1,d=!1,p=!1;return s.forEach((function(e,t){var a=e.mobile_number.sim_num;!1===u&&(u=""===a||a.includes("x"))})),0!==m.length&&m.forEach((function(e,t){var a=e.landline_num;!1===p&&(p=""===a||a.includes("x"))})),0===i||1===i?d=""===l||""===c:2===i||3===i||4===i?d=""===o||""===c:5===i&&(d=""===o),""===n||""===r||!0===u||!0===d||!0===p}(X,{mobile_nums:xe,landline_nums:ke},{scope:ae,site:le,office:ve,location:me}),$e(e)}),[X,xe,ke,ae,le,ve,me]);var lt=function(){var e=cc(xe,"mobile"),t=cc(ke,"landline"),a=He?1:0,n=Fe?1:0;!function(e,t){var a="".concat(k,"/api/contacts/save_contact");C.a.post(a,e).then((function(e){var a=e.data;console.log("Save contact data reponse",a),t(a)})).catch((function(e){console.error(e)}))}({user:Object(p.a)({},X,{emails:Me,ewi_recipient:a,restriction:Qe,status:n}),affiliation:{site:le,location:me,scope:ae,office:ve},contact_numbers:{mobile_numbers:e,landline_numbers:t}},(function(e){var t,a=e.status,n=e.message;!0===a?(et(),t="update_all_contacts",tc(),Zl.emit(t),Ue(n,{variant:"success",autoHideDuration:3e3,action:at}),Ue("Updating contact list...",{variant:"warning",autoHideDuration:3e3,action:at})):Ue(n,{variant:"error",autoHideDuration:3e3,action:at})}))};return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"-webkit-center"}},r.a.createElement(Bl.a,null,r.a.createElement(Jl.a,null))),r.a.createElement(y.a,{item:!0,xs:9},r.a.createElement(O.a,{variant:"h5",align:"center"},"Contact Form")),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(G.a,{edge:"start",onClick:et},r.a.createElement(Et.a,null))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Personal Details")),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"First Name",value:X.first_name,onChange:tt("first_name"),margin:"dense",required:!0,error:""===X.first_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Last Name",value:X.last_name,onChange:tt("last_name"),margin:"dense",required:!0,error:""===X.last_name})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Middle Name",value:X.middle_name,onChange:tt("middle_name"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(b.a,{label:"Nickname",value:X.nickname,onChange:tt("nickname"),margin:"dense"})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Affiliation")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(da,{div_id:"scope",label:"Scope",changeHandler:function(e){return ne(e.target.value)},value:ae,list:Z,mapping:{id:"id",label:"label"},required:!0,error:""===ae})),[0,1].includes(ae)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(Zt,{value:le,changeHandler:function(e){return ce(e)}})),[2,3,4].includes(ae)&&r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(da,{div_id:"location",label:Z[ae].select_label,changeHandler:function(e){return ue(e.target.value)},value:me,list:Z[ae].list,mapping:{id:"id",label:"label"},required:!0,error:""===me})),r.a.createElement(y.a,{item:!0,xs:6},r.a.createElement(da,{div_id:"office",label:"Office",changeHandler:function(e){return he(e.target.value)},value:ve,list:ge,mapping:{id:"id",label:"label"},required:!0,error:""===ve})),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Ye.a,null,r.a.createElement(Le.a,{control:r.a.createElement(Ot.a,{checked:Fe,onChange:function(e){return ze(e.target.checked)},value:"checkedA",color:"primary"}),label:"Active"}))),r.a.createElement(y.a,{item:!0,xs:6,style:{textAlign:"center"}},r.a.createElement(Ye.a,null,r.a.createElement(Le.a,{control:r.a.createElement(Ot.a,{checked:He,onChange:function(e){return Re(e.target.checked)},value:"checkedB",color:"primary"}),label:"EWI Recipient"}))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(da,{div_id:"ewi_restriction",label:"Ewi Restriction",changeHandler:function(e){return Ze(e.target.value)},value:Qe,list:[{id:0,label:"No restrictions"},{id:1,label:"Do not send on Alert 1"},{id:2,label:"Do not send on Alert 2 and below"}],mapping:{id:"id",label:"label"},required:!0,error:""===Qe})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Mobile")),xe.map((function(e,t){var a=e.mobile_number.sim_num,i=e.status,l="undefined"!==typeof e.has_delete,c=!0;return c=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(Ye.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Mobile Number",value:a,onChange:function(e){return je({type:"UPDATE",payload:{data:"sim_num",value:e.target.value,key:t},category:"mobile"})},id:"formatted-numberformat-input",InputProps:{inputComponent:lc,inputProps:{mask:rc}},required:!0,error:c}))),r.a.createElement(y.a,{item:!0,xs:3,style:{textAlign:"center"}},r.a.createElement(Le.a,{style:{margin:0},control:r.a.createElement(Ot.a,{checked:Boolean(i),onChange:function(e){return je({type:"UPDATE",payload:{data:"status",value:e.target.checked?1:0,key:t},category:"mobile"})},color:"primary"}),label:"Active"})),0!==t&&l?r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(G.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return je({type:"DELETE",payload:{key:t}})}},r.a.createElement(ti.a,null))):r.a.createElement(Fi.a,null,r.a.createElement(y.a,{item:!0,xs:2})))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(Xl.a,null),onClick:function(){return je({type:"ADD",category:"mobile"})}},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Landline")),0===ke.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No landline number saved")),ke.map((function(e,t){var a=e.landline_num,i=!0;return i=""===a||a.includes("x"),r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Ye.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Landline Number",value:a,onChange:function(e){return Ae({type:"UPDATE",payload:{data:"landline_num",value:e.target.value,key:t},category:"landline"})},id:"formatted-numberformat-input",InputProps:{inputComponent:lc,inputProps:{mask:[/\d/,/\d/,/\d/,"-",/\d/,/\d/,/\d/,/\d/]}},required:!0,error:i}))),r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(G.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return Ae({type:"DELETE",payload:{key:t}})}},r.a.createElement(ti.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(Xl.a,null),onClick:function(){return Ae({type:"ADD",category:"landline"})}},"Add number")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"Email")),0===Me.length&&r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",color:"textSecondary",align:"center",paragraph:!0},"No email address saved")),Me.map((function(e,t){return r.a.createElement(n.Fragment,{key:t},r.a.createElement(y.a,{item:!0,xs:10},r.a.createElement(Ye.a,{fullWidth:!0},r.a.createElement(b.a,{label:"Email",value:e.email,onChange:function(e){return Ie({type:"UPDATE",payload:{value:e.target.value,key:t},category:"email"})},id:"formatted-numberformat-input"}))),r.a.createElement(y.a,{item:!0,xs:2,style:{textAlign:"center"}},r.a.createElement(G.a,{edge:"end",size:"small","aria-label":"delete",onClick:function(){return Ie({type:"DELETE",payload:{key:t}})}},r.a.createElement(ti.a,null))))})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",startIcon:r.a.createElement(Xl.a,null),onClick:function(){return Ie({type:"ADD",category:"email"})}},"Add email")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"16px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{color:"secondary",variant:"contained",style:{marginRight:6},onClick:function(){return lt()},disabled:Xe},"Save"),r.a.createElement(g.a,{variant:"contained",onClick:function(){return d(!1)}},"Cancel")))}));var mc=r.a.memo((function(e){var t=e.open,a=e.setSaveContactModal,i=e.mobileDetails,l=i.sim_num,c={mobile_numbers:[{sim_num:l,mobile_id:i.mobile_id,priority:0,status:1}],user:{emails:[],ewi_recipient:[],ewi_restriction:[],landline_numbers:[],first_name:"",last_name:"",middle_name:"",nickname:"",user_id:0,organizations:[]}},s=Object(n.useState)(""),m=Object(o.a)(s,2),u=(m[0],m[1]),d=Object(n.useState)(!0),p=Object(o.a)(d,2),f=p[0],b=p[1],E=Object(n.useState)(!1),v=Object(o.a)(E,2),h=(v[0],v[1]),_=Object(n.useState)([]),y=Object(o.a)(_,2),O=y[0],x=(y[1],Object(n.useState)([])),j=Object(o.a)(x,2),S=j[0],C=(j[1],Object(n.useState)([])),k=Object(o.a)(C,2),A=k[0],w=(k[1],function(){return a(!1)});return r.a.createElement(Ne.a,{open:t,onExited:function(){return u("")},"aria-labelledby":"form-dialog-title"},r.a.createElement(Te.a,{id:"form-dialog-title"},"Save mobile number (+".concat(l,")")),r.a.createElement(He.a,null,r.a.createElement(sc,{municipalities:O,provinces:S,regions:A,setContactForm:function(e){h(e),b(!1)},chosenContact:c,isEditMode:f,setContactFormForEdit:function(e){b(e),h(e)},handleClose:w,isFromChatterbox:!0})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:w,color:"primary"},"Close")))})),uc=Object(x.a)((function(e){return{inline:{display:"inline"},overflowEllipsis:{fontSize:"inherit",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},link:{textDecoration:"none"},noFlexGrow:{flexGrow:0},hidden:{display:"none !important"},sentIcon:{fontSize:"1.10rem"}}}));function dc(e){var t=e.user,a=t.first_name,n=t.last_name,r=t.organizations;return{sender:"".concat(a," ").concat(n),orgs:it(r)}}function pc(e,t){var a=t.sms_msg,n=t.ts,i=t.source,l=t.send_status,c=t.ts_sent,o=function(e){var t=re()(e);return t.isSame(re()(),"day")?t.format("HH:mm"):t.format("MMM D")}(n);return r.a.createElement(y.a,{container:!0,justify:"space-between",spacing:0},r.a.createElement(y.a,{item:!0,xs:1,style:{flexBasis:0,marginRight:6}},"inbox"===i?r.a.createElement(Ll.a,{fontSize:"small"}):r.a.createElement(Pl.a,{fontSize:"small"})),r.a.createElement(y.a,{item:!0,xs:!0,className:e.overflowEllipsis},a),r.a.createElement(y.a,{item:!0,style:{marginRight:8},className:e.noFlexGrow},o),r.a.createElement(y.a,{item:!0,style:{paddingTop:2,marginRight:8}},(0===l||null===l&&null!==c)&&r.a.createElement(Fl.a,{className:e.sentIcon}),l>0&&l<=5&&r.a.createElement(ta.a,{color:"primary",className:e.sentIcon}),(-1===l||l>5)&&r.a.createElement(zl.a,{color:"error",className:e.sentIcon})))}var gc=function(e){var t=e.messagesArr,a=e.hidden,i=uc(),l=Object(p.a)({},e,{classes:i}),c=r.a.useState(!1),s=Object(o.a)(c,2),u=s[0],d=s[1],g=r.a.useState(!1),f=Object(o.a)(g,2),b=f[0],E=f[1],v=r.a.useState(!1),_=Object(o.a)(v,2),x=_[0],j=_[1],S=r.a.useState(!1),C=Object(o.a)(S,2),k=C[0],A=C[1],w=r.a.useState({}),D=Object(o.a)(w,2),M=D[0],I=D[1],N=function(e,t){E(e),I(t),d(!0)};return r.a.createElement(n.Fragment,null,0===t.length?r.a.createElement(h.a,{style:{height:"30vh",padding:60,display:"flex",justifyContent:"center",alignItems:"center",background:"gainsboro",border:"4px solid #CCCCCC",marginTop:30},className:a?i.hidden:""},r.a.createElement("div",null,"No conversations")):r.a.createElement(En.a,{dense:!0,className:a?i.hidden:""},t.map((function(e){return function(e,t,a){var n=e.messages,i=e.mobile_details,l=Object(o.a)(n,1)[0],c=t.classes,s=t.url,u=t.width,d=t.async,p=t.is_desktop,g=i.mobile_id,f=i.sim_num,b=i.user_details,E=lt(f),v=E,h=[],_=null===b;if(!_){var x=dc(b);v=x.sender,h=x.orgs}return r.a.createElement(m.b,{to:{pathname:"".concat(s,"/").concat(g),state:{async:d}},key:g,className:c.link},r.a.createElement(hn.a,{alignItems:"center",button:!0},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,{alt:v,src:Ul.a,className:c.bigAvatar})),r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:!0,className:c.noFlexGrow},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8},className:c.overflowEllipsis},v)),h.map((function(e,t){var a=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:c.noFlexGrow},r.a.createElement(Nt.a,{color:a,size:"small",label:e}))})),r.a.createElement(y.a,{item:!0,xs:6,sm:!0,style:{textAlign:Object(ie.c)("sm",u)?"right":"left"}},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},E)),r.a.createElement(y.a,{item:!0,xs:!0,style:{textAlign:"right",flexGrow:p?0:1,flexBasis:"auto"}},r.a.createElement(G.a,{size:"small",onClick:function(e){e.preventDefault(),a(_,i)}},r.a.createElement(_t.a,null)))),primaryTypographyProps:{className:c.overflowEllipsis},secondary:n.length>0?pc(c,l):r.a.createElement("div",{style:{textAlign:"center"}},"No conversation yet"),secondaryTypographyProps:{component:"div"}})))}(e,l,N)}))),r.a.createElement(Ql,{open:u,onClose:function(e){d(!1)},isUnregistered:b,setBlockModal:j,setSaveContactModal:A}),r.a.createElement(Kl,{open:x,setBlockModal:j,mobileDetails:M,setOpenOptions:d}),r.a.createElement(mc,{open:k,setSaveContactModal:A,mobileDetails:M,setOpenOptions:d}))},fc=a(650),bc=a(648),Ec=a(649);var vc=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.isOpen,i=e.closeHandler,l=e.tagOption,c=e.isMobile,m=e.tagObject,u=e.mobileDetails,d=e.message,p=function(e){var t=Object(n.useState)([]),a=Object(o.a)(t,2),r=a[0],i=a[1],l=C.a.CancelToken.source();return Object(n.useEffect)((function(){var t="".concat(k,"/api/chatterbox/get_message_tag_options/sms").concat(e,"_users");C.a.get(t,{cancelToken:l.token}).then((function(e){var t=e.data.map((function(e){return{value:e.tag_id,label:e.tag}}));i(t)})).catch((function(e){console.log(e)}))}),[e]),r}(l),f=Object(n.useState)(null),b=Object(o.a)(f,2),E=b[0],v=b[1],h=Object(n.useState)([]),_=Object(o.a)(h,2),y=_[0],O=_[1];return Object(n.useEffect)((function(){var e=m.tags.map((function(e){return{value:e.tag_id,label:e.tag.tag}}));v(e),O(e)}),[m]),r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},"General Data Tagging"),r.a.createElement(He.a,null,r.a.createElement(Re.a,null,"Attach tags to selected data."),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Wt,{label:"Tags",options:p,value:E,changeHandler:function(e){return v(e)},placeholder:"Select tags",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),!c&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{color:"primary",onClick:function(){var e=m.id,t=m.source,a=null,n=[];null!==u.user_details&&(u.user_details.user.organizations.forEach((function(e){console.log("org",e);var t=e.site.site_id;!n.includes(t)&&n.push(t)})),a=function(e){var t=e.sim_num,a=e.user_details;if(null!==a){var n=dc(a),r=n.sender,i=n.orgs,l="";i.forEach((function(e){l+="".concat(e," ")})),t=l+r}return t}(u));var r="inbox"===t?"inbox_id":"outbox_id",l=[];if(console.log(y,E),y.length>0&&(l=null===E?Object(Ke.a)(y):y.filter((function(e){return!E.some((function(t){return t.value===e.value}))}))),l.length>0){var c;console.log("missing_tags",l);var o=l.map((function(e){return e.value})),p={tag_type:"sms".concat(t,"_user_tags"),tag_details:(c={},Object(s.a)(c,r,e),Object(s.a)(c,"delete_tag_id_list",o),c)};console.log("delete_payload",p),function(e,t){ot("".concat(k,"/api/general_data_tag/handle_delete_tags"),e,t)}(p,(function(e){console.log("untag response",e)}))}var g,f=[];if(null!==E&&(f=E.filter((g=0,function(e){return e!==y[g]||!++g}))),f.length>null){var b;console.log("new_tags",f);var v=f.map((function(e){return e.value})),h={tag_type:"sms".concat(t,"_user_tags"),contact_person:a,message:d,tag_details:(b={user_id:I().user_id},Object(s.a)(b,r,e),Object(s.a)(b,"tag_id_list",v),Object(s.a)(b,"site_id_list",n),Object(s.a)(b,"ts",re()().format("YYYY-MM-DD HH:mm:ss")),b)};console.log("PAYLOAD",h),function(e,t){ot("".concat(k,"/api/general_data_tag/handle_update_insert_tags"),e,t)}(h,(function(e){console.log("tag response",e)}))}i()}},"Submit"),r.a.createElement(g.a,{onClick:i},"Cancel")))})),hc=Object(x.a)((function(e){var t;return{root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"},chatItemSent:{justifyContent:"flex-end"},chatBubble:(t={flexGrow:0,maxWidth:"65%"},Object(s.a)(t,e.breakpoints.down("xs"),{maxWidth:"75%"}),Object(s.a)(t,e.breakpoints.up("md"),{maxWidth:"50%"}),Object(s.a)(t,"paddingLeft","12px !important"),Object(s.a)(t,"paddingRight",12),Object(s.a)(t,"paddingTop",12),Object(s.a)(t,"paddingBottom",6),Object(s.a)(t,"border","solid 1px rgba(215, 215, 215, 1)"),Object(s.a)(t,"backgroundColor","rgba(245, 245, 245, 1)"),t),chatBubbleReceived:{marginLeft:14,"&:before":{content:"''",left:69,right:"auto",top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:71.5,right:"auto",top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatBubbleSent:{marginRight:14,"&:before":{content:"''",left:"auto",right:69,top:14,border:"18px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(215, 215, 215, 1) transparent transparent transparent"},"&:after":{content:"''",left:"auto",right:71.5,top:15,border:"20px solid",position:"absolute",width:0,height:0,bottom:"auto",borderColor:"rgba(245, 245, 245, 1) transparent transparent transparent"}},chatMessage:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",fontSize:"0.75rem",lineHeight:"1.25em"},timestampArea:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:12},timestamp:{fontSize:"0.65rem"},tagButton:{padding:0,zIndex:1},sentIcon:{fontSize:"1rem"}}}));var _c=Object(x.a)((function(e){return{arrow:{position:"absolute",fontSize:6,"&::before":{content:'""',margin:"auto",display:"block",width:0,height:0,borderStyle:"solid"}},popper:(t=e.palette.common.black,{'&[x-placement*="bottom"] $arrow':{top:0,left:0,marginTop:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"0 1em 1em 1em",borderColor:"transparent transparent ".concat(t," transparent")}},'&[x-placement*="top"] $arrow':{bottom:0,left:0,marginBottom:"-0.95em",width:"2em",height:"1em","&::before":{borderWidth:"1em 1em 0 1em",borderColor:"".concat(t," transparent transparent transparent")}},'&[x-placement*="right"] $arrow':{left:0,marginLeft:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 1em 1em 0",borderColor:"transparent ".concat(t," transparent transparent")}},'&[x-placement*="left"] $arrow':{right:0,marginRight:"-0.95em",height:"2em",width:"1em","&::before":{borderWidth:"1em 0 1em 1em",borderColor:"transparent transparent transparent ".concat(t)}}}),tooltip:{position:"relative",backgroundColor:e.palette.common.black},tooltipPlacementLeft:{margin:"0 8px"},tooltipPlacementRight:{margin:"0 8px"},tooltipPlacementTop:{margin:"8px 0"},tooltipPlacementBottom:{margin:"8px 0"}};var t}));function yc(e){var t=_c(),a=t.arrow,n=Object(Mt.a)(t,["arrow"]),i=r.a.useState(null),l=Object(o.a)(i,2),c=l[0],s=l[1],m=e.title;return r.a.createElement(yt.a,Object.assign({classes:n,PopperProps:{popperOptions:{modifiers:{arrow:{enabled:Boolean(c),element:c}}}}},e,{title:r.a.createElement(r.a.Fragment,null,m,r.a.createElement("span",{className:a,ref:s}))}))}var Oc=function(e){var t=e.message_list,a=e.mobileDetails,i=e.setScrollToBottom,l=hc(),c=Object(n.useState)([]),s=Object(o.a)(c,2),m=s[0],u=s[1],d=Object(n.useState)(!1),p=Object(o.a)(d,2),f=p[0],b=p[1],E=Object(n.useState)(""),v=Object(o.a)(E,2),h=v[0],_=v[1],y={id:"",source:"",tags:[]},x=Object(n.useState)(y),j=Object(o.a)(x,2),S=j[0],A=j[1],w=Object(n.useState)(1),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)([]),T=Object(o.a)(N,2),H=T[0],R=T[1];Object(n.useEffect)((function(){var e=t.slice(0).reverse();u(e),R(e),i(!0)}),[t]);var Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,a=arguments.length>2?arguments[2]:void 0;return function(){A(t),b(e),_(a)}};return r.a.createElement(n.Fragment,null,0===t.length&&r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"No conversation yet"),H.length>=20&&r.a.createElement(g.a,{color:"primary",size:"small",fullWidth:!0,onClick:function(){!function(e,t,a){var n="".concat(k,"/api/chatterbox/load_more_messages/").concat(e,"/").concat(t);C.a.get(n).then((function(e){var t=e.data;console.log("Additional loaded messages",t),a(t)})).catch((function(e){console.error(e)}))}(a.mobile_id,M,(function(e){R(e);var t=e.slice(0).reverse();u(t.concat(m))})),I(M+1)}},r.a.createElement("strong",null,"Load more messages...")),r.a.createElement(En.a,{className:l.root},m.map((function(e){return function(e,t,a){var i=t.convo_id,l=t.source,c=t.sms_msg,s=t.ts,m=t.ts_sent,u=t.send_status,d=t.tags,p={tags:d,source:l,id:t["".concat(l,"_id")]},g="outbox"===l,f=re()(s).format("M/D/YYYY HH:mm:ss"),b=r.a.createElement(Yl.a,{style:{textAlign:"-webkit-center"}},r.a.createElement(Bl.a,{alt:"Remy Sharp",src:Ul.a})),E=d.length>0,v=E?r.a.createElement(bc.a,{fontSize:"small",color:"primary"}):r.a.createElement(Ec.a,{fontSize:"small",color:"primary"}),h=d.map((function(e){return e.tag.tag})).join(", "),_=[b,r.a.createElement(_n.a,{className:"".concat(e.chatBubble," ").concat(g?e.chatBubbleSent:e.chatBubbleReceived),primary:r.a.createElement(O.a,{component:"span",className:e.chatMessage,variant:"body2",color:"textPrimary"},r.a.createElement("span",{style:{paddingRight:6,zIndex:1}},c),r.a.createElement(yc,{disableFocusListener:!0,disableHoverListener:!E,title:h},r.a.createElement(G.a,{className:e.tagButton,onClick:a(!0,p,c)},v))),secondary:r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:e.timestamp,style:{paddingRight:g?6:0}},f),u>=0&&u<5&&null!==u&&r.a.createElement(yc,{disableFocusListener:!0,title:"SENDING"},r.a.createElement(Fl.a,{className:e.sentIcon})),5===u&&r.a.createElement(yc,{disableFocusListener:!0,title:"SENT: ".concat(re()(m).format("M/D/YYYY HH:mm:ss"))},r.a.createElement(ta.a,{color:"primary",className:e.sentIcon})),(-1===u||u>5)&&r.a.createElement(yc,{disableFocusListener:!0,title:"UNSENT"},r.a.createElement(zl.a,{color:"error",className:e.sentIcon}))),secondaryTypographyProps:{component:"div",className:e.timestampArea}})];g&&(_=_.reverse());var y=_,x=Object(o.a)(y,2),j=x[0],S=x[1];return r.a.createElement(hn.a,{alignItems:"flex-start",className:g?e.chatItemSent:"",key:i},j,S)}(l,e,Y)}))),r.a.createElement(vc,{isOpen:f,closeHandler:Y(!1),tagOption:S.source,tagObject:S,mobileDetails:a,message:h}))},xc=Object(x.a)((function(e){var t,a,n=Object(Q.a)(e);return{regularContainer:Object(p.a)({},n.pageContentMargin,{margin:0,padding:"16px 0"}),chatInputContainer:Object(p.a)({},n.pageContentMargin),divider:Object(p.a)({},n.pageContentMargin,{margin:0}),sticky:(t={position:"sticky",top:56},Object(s.a)(t,e.breakpoints.up("sm"),{top:63}),Object(s.a)(t,e.breakpoints.up("md"),{top:118}),Object(s.a)(t,"backgroundColor","white"),Object(s.a)(t,"borderBottom","1px solid rgba(0, 0, 0, 0.12)"),Object(s.a)(t,"zIndex",3),t),chatHead:(a={paddingLeft:8},Object(s.a)(a,e.breakpoints.up("md"),{paddingLeft:0}),Object(s.a)(a,"display","flex"),Object(s.a)(a,"alignItems","center"),a),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40},noFlexGrow:{flexGrow:0}}})),jc=function(){return r.a.createElement(xe.a,{height:70,width:800,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",preserveAspectRatio:"xMinYMin slice"},r.a.createElement("rect",{x:"69",y:"7",rx:"4",ry:"4",width:"663",height:"19"}),r.a.createElement("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"293",height:"14"}),r.a.createElement("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"201",height:"6"}),r.a.createElement("circle",{cx:"30",cy:"30",r:"30"}))},Sc=function(e){return r.a.createElement(xe.a,{height:160,width:446,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("circle",{cx:"19",cy:"25",r:"16"}),r.a.createElement("rect",{x:"39",y:"12",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"40",y:"29",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"420",cy:"71",r:"16"}),r.a.createElement("rect",{x:"179",y:"76",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"179",y:"58",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("circle",{cx:"21",cy:"117",r:"16"}),r.a.createElement("rect",{x:"45",y:"104",rx:"5",ry:"5",width:"220",height:"10"}),r.a.createElement("rect",{x:"45",y:"122",rx:"5",ry:"5",width:"220",height:"10"}))};var Cc=function(e){return function(t){t.preventDefault(),e.goBack()}};var kc=function(e){var t=e.history,a=e.match.params.mobile_id,i=e.location.state.async,l=e.messageCollection,s=e.socket,m=xc(),u=I(),d=Object(c.useSnackbar)(),p=d.enqueueSnackbar,f=d.closeSnackbar,b=Object(n.useState)({message_list:null,mobile_details:{}}),E=Object(o.a)(b,2),v=E[0],h=E[1],_=Object(n.useState)(""),x=Object(o.a)(_,2),j=x[0],S=x[1];Object(n.useEffect)((function(){var e;return i&&"undefined"!==typeof s&&(s.emit("join_mobile_id_room",a),e=function(e){var t=e.mobile_details,a=e.messages;h({mobile_details:t,message_list:a})},tc(),Zl.on("receive_mobile_id_room_update",(function(t){console.log("Mobile ID Room Update",t),e(t)}))),function(){i&&"undefined"!==typeof s&&(s.emit("leave_mobile_id_room",a),Zl.removeListener("receive_mobile_id_room_update"))}}),[s]);var C=v.mobile_details,k=v.message_list;if(!i&&null!==l.inbox){var A=Object(Ke.a)(l.inbox).filter((function(e){return e.mobile_details.mobile_id===parseInt(a,10)}));if(A.length>0){var w=A.pop(),D=w.mobile_details,M=w.messages;C=D,k=M}}var N=function(e){return r.a.createElement(g.a,{color:"primary",onClick:function(){f(e)}},"Dismiss")},T=Object(n.useRef)(null),H=Object(n.useState)(!1),R=Object(o.a)(H,2),Y=R[0],B=R[1];return Object(n.useEffect)((function(){T.current.scrollIntoView()}),[Y]),r.a.createElement(n.Fragment,null,null===k?r.a.createElement("div",{className:m.regularContainer,style:{paddingLeft:16,paddingBottom:0}},r.a.createElement(jc,null)):r.a.createElement("div",{className:"".concat(m.regularContainer," ").concat(m.sticky)},r.a.createElement("div",{className:m.chatHead},r.a.createElement(G.a,{"aria-label":"Back",color:"primary",className:m.backButton,onClick:Cc(t)},r.a.createElement(fc.a,{className:m.backIcon})),function(e,t){var a=e.user_details,n=lt(e.sim_num),i=n,l=[],c=null===a;if(!c){var o=dc(a);i=o.sender,l=o.orgs}return r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{marginRight:12}},r.a.createElement(Bl.a,{alt:i,src:Ul.a,className:t.bigAvatar})),r.a.createElement("div",null,r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"flex-end"},r.a.createElement(y.a,{item:!0,className:t.noFlexGrow},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8}},i)),l.map((function(e,a){var n=0===a?"secondary":"primary";return r.a.createElement(y.a,{key:a,item:!0,xs:!0,className:t.noFlexGrow},r.a.createElement(Nt.a,{color:n,size:"small",label:e}))}))),!c&&r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},n)))}(C,m))),r.a.createElement("div",{className:m.regularContainer},null===k?r.a.createElement("div",{style:{padding:"0 16px"}},r.a.createElement(Sc,{style:{height:"100%"}})):r.a.createElement(Oc,{message_list:k,mobileDetails:C,setScrollToBottom:B})),null!==k&&r.a.createElement(n.Fragment,null,r.a.createElement(Oe.a,{className:m.divider}),r.a.createElement("div",{className:m.chatInputContainer},r.a.createElement(Xt,{value:j,disableSend:""===j,messageChangeHandler:function(e){return S(e.target.value)},sendButtonClickHandler:function(){var e=C,t=e.mobile_id,a=e.gsm_id;Ct({sms_msg:"".concat(j," - ").concat(u.nickname," from PHIVOLCS-DYNASLOPE"),recipient_list:[{mobile_id:t,gsm_id:a}]},(function(e){e.status?(p("EWI SMS Sent!",{variant:"success",autoHideDuration:7e3,action:N}),S("")):p(e.message,{variant:"error",autoHideDuration:7e3,action:N})}),(function(){p("Error sending EWI SMS...",{variant:"error",autoHideDuration:7e3,action:N})}))}}))),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:T}))};var Ac=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,i=e.modalState,l=(e.textboxValue,e.recipientsList),c=Object(n.useState)(""),s=Object(o.a)(c,2),m=s[0];return s[1],r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:i,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Send a Message"),r.a.createElement(G.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Et.a,null)))),r.a.createElement(He.a,{style:{overflowY:"hidden"}},r.a.createElement(Re.a,null,"Choose your recipients and compose a message, then send it."),r.a.createElement("div",{style:{marginTop:20}},r.a.createElement(la,{isMobile:t,textboxValue:m,recipientsList:l,modalStateHandler:a}))),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:a,color:"primary"},"Cancel")))})),wc=Object(x.a)((function(e){return{link:{textDecoration:"none"}}}));var Dc=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.modalStateHandler,i=e.setSearchResultsToEmpty,l=e.modalState,c=e.url,s=e.isMobile,u=wc(),d=Object(n.useContext)(qt).organizations,p=Object(n.useState)([]),f=Object(o.a)(p,2),b=f[0],E=f[1];Object(n.useEffect)((function(){var e=d.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}}));E(e)}),[d]);var v,h=Object(n.useState)([]),_=Object(o.a)(h,2),y=_[0],O=_[1],x=Object(n.useState)([]),j=Object(o.a)(x,2),S=j[0],C=j[1];return r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:l,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search Chatterbox"),r.a.createElement(G.a,{color:"inherit",onClick:a,"aria-label":"Close",style:{padding:0}},r.a.createElement(Et.a,null)))),r.a.createElement(He.a,{style:{overflowY:"hidden"}},r.a.createElement(Re.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Wt,{label:"Organizations",options:b,value:S,changeHandler:(v="organizations",function(e){"sites"===v?O(e):"organizations"===v&&C(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Zt,{value:y,changeHandler:function(e){return O(e)},isMulti:!0})),!s&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:function(){a(),i()},color:"primary"},r.a.createElement(m.b,{to:{pathname:"".concat(c,"/search_results"),state:{sites:y,organizations:S}},className:u.link},"Search")),r.a.createElement(g.a,{onClick:a},"Cancel")))})),Mc=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{regularContainer:Object(p.a)({},t.pageContentMargin,{margin:0,padding:"16px 0"}),chatInputContainer:Object(p.a)({},t.pageContentMargin),divider:Object(p.a)({},t.pageContentMargin,{margin:0}),backButton:{padding:0,marginRight:12},backIcon:{width:40,height:40}})})),Ic=function(e){return function(t){t.preventDefault(),e.goBack()}};function Nc(e){var t=e.width,a=e.history;return Object(ie.b)(t,"sm")?r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:Ic(a),startIcon:r.a.createElement(Hi.a,null)},"Back to conversation list"):r.a.createElement(G.a,{variant:"contained",color:"primary",size:"small",onClick:Ic(a)},r.a.createElement(Hi.a,null))}var Tc=function(e){var t=e.location,a=e.socket,i=e.width,l=e.url,c=e.is_desktop,s=e.searchResults,m=e.setSearchResults,u=e.ListLoader,d=Mc(),p=t.state,g=p.sites,f=p.organizations,b=Object(n.useState)(!1),E=Object(o.a)(b,2),v=E[0],h=E[1],_=null===g&&null===f;return Object(n.useEffect)((function(){var e,t=0===s.length;if(!_&&t){h(!0);var n={site_ids:g.map((function(e){return e.value})),org_ids:f.map((function(e){return e.value}))};"undefined"!==typeof a&&(a.emit("get_search_results",n),e=function(e){h(!1),m(e)},Zl.on("receive_search_results",(function(t){console.log("Chatterbox Search Results",t),e(t)})))}return function(){"undefined"!==typeof a&&Zl.removeListener("receive_search_results")}}),[a,s,g,f]),r.a.createElement("div",{className:d.pageContentMargin},r.a.createElement(be,{title:"Communications | Chatterbox"}),r.a.createElement(Nc,e),r.a.createElement(O.a,{variant:"h5",style:{marginTop:24}},"SEARCH RESULTS"),_&&r.a.createElement(O.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No search input")),v?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(u,null)):s.length>0?r.a.createElement(gc,{width:i,url:l,messagesArr:s,async:!0,hidden:!1,is_desktop:c}):r.a.createElement(O.a,{variant:"h6",align:"center"},r.a.createElement("strong",null,"No results found")))},Hc=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{tabBar:Object(p.a)({},t.pageContentMargin,{margin:0}),tabBarContent:{marginTop:16}})})),Rc=function(){return r.a.createElement(xe.a,{height:400,width:600,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("circle",{cx:"47",cy:"48",r:"26"}),r.a.createElement("rect",{x:"90",y:"36",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"47",cy:"108",r:"26"}),r.a.createElement("rect",{x:"90",y:"96",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"168",r:"26"}),r.a.createElement("rect",{x:"90",y:"156",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"228",r:"26"}),r.a.createElement("rect",{x:"90",y:"216",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"288",r:"26"}),r.a.createElement("rect",{x:"90",y:"276",rx:"0",ry:"0",width:"489",height:"29"}),r.a.createElement("circle",{cx:"49",cy:"348",r:"26"}),r.a.createElement("rect",{x:"90",y:"336",rx:"0",ry:"0",width:"489",height:"29"}))};var Yc=Object(ie.a)()((function(e){var t=e.location,a=e.match.url,i=e.width,l=Hc(),c=Object(n.useState)(0),s=Object(o.a)(c,2),m=s[0],d=s[1],p=Object(n.useState)(!1),f=Object(o.a)(p,2),b=f[0],E=f[1],v=Object(n.useState)(!1),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)({inbox:null,unsent:null}),x=Object(o.a)(O,2),j=x[0],S=x[1],C=Object(n.useState)([{label:"Inbox",href:"inbox"},{label:"Unsent",href:"unsent"}]),k=Object(o.a)(C,2),A=k[0],w=k[1],D=Object(n.useState)([]),M=Object(o.a)(D,2),I=M[0],N=M[1],T=Object(n.useState)([]),H=Object(o.a)(T,2),R=H[0],Y=H[1],B=function(e,t){return function(){"send"===e?E(t):"search"===e&&y(t)}},L=Object(n.useContext)(qt).setIsReconnecting;Object(n.useEffect)((function(){var e;return ac("chatterbox",L),e=function(e){S(e);var t=e.unsent.length,a="Unsent",n=A.findIndex((function(e){return e.href===a}));t>0&&(a=r.a.createElement(Tl.a,{style:{padding:"0 8px"},color:"secondary",badgeContent:t,overlap:"rectangle"},"Unsent")),w((function(e){return[].concat(Object(Ke.a)(e.slice(0,n)),[{label:a,href:"unsent"}])}))},tc(),Zl.on("receive_latest_messages",(function(t){console.log("Latest messages",t),e(t)})),function(e){tc(),Zl.on("receive_all_mobile_numbers",(function(t){console.log("All Saved Mobile Numbers",t),e(t)}))}((function(e){Y(e)})),function(){Zl.removeListener("receive_latest_messages")}}),[]);var P=Object(ie.c)("md",i),F=r.a.createElement("span",null,r.a.createElement(g.a,{"aria-label":"Compose message",variant:"contained",color:"primary",size:"small",style:{marginRight:8},onClick:B("send",!0)},r.a.createElement(Hl.a,{style:{paddingRight:4,fontSize:20}}),"Compose"),r.a.createElement(g.a,{"aria-label":"Search messages",variant:"contained",color:"primary",size:"small",onClick:B("search",!0)},r.a.createElement(Rl.a,{style:{paddingRight:4,fontSize:20}}),"Search"));return r.a.createElement(u.d,{location:t},r.a.createElement(u.b,{exact:!0,path:a,render:function(e){return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:l.pageContentMargin},r.a.createElement(be,{title:"Communications | Chatterbox",customButtons:!!P&&F})),r.a.createElement("div",{className:l.tabBar},r.a.createElement(ye,{chosenTab:m,onSelect:function(e){return d(e)},tabsArray:A})),r.a.createElement("div",{className:"".concat(l.tabBar," ").concat(l.tabBarContent)},null===j.inbox?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Rc,null)):r.a.createElement(gc,{width:i,url:a,messagesArr:j.inbox,hidden:0!==m,is_desktop:P}),null===j.unsent?r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(Rc,null)):r.a.createElement(gc,{width:i,url:a,messagesArr:j.unsent,async:!0,hidden:1!==m,is_desktop:P})),!P&&r.a.createElement(qn,{clickHandler:B("send",!0)}),r.a.createElement(Ac,{modalStateHandler:B("send",!1),modalState:b,recipientsList:R}),r.a.createElement(Dc,{modalStateHandler:B("search",!1),modalState:_,setSearchResultsToEmpty:function(){return N([])},url:a}))}}),r.a.createElement(u.b,{path:"".concat(a,"/search_results"),render:function(e){return r.a.createElement(Tc,Object.assign({},e,{messageCollection:j,socket:Zl,url:a,width:i,is_desktop:P,searchResults:I,setSearchResults:N,ListLoader:Rc}))}}),r.a.createElement(u.b,{path:"".concat(a,"/:mobile_id"),render:function(e){return r.a.createElement(kc,Object.assign({},e,{messageCollection:j,socket:Zl}))}}))})),Bc=a(624),Lc=a(566),Pc=a(419),Fc=a(653),zc=a(654),Gc=a(655),Uc=a(656),Wc=a(657),qc=a(658),Vc=a(659);var Qc=r.a.memo((function(e){var t=e.contacts,a=e.onContactClickFn,n=e.classes;return r.a.createElement(En.a,{dense:!0,style:{paddingTop:0}},t.map((function(e){var t=e.user_id,i=e.first_name,l=e.last_name,c=it(e.organizations);return r.a.createElement(hn.a,{button:!0,onClick:a(e),key:t},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,null,r.a.createElement(Jl.a,null))),r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8}},"".concat(l,", ").concat(i))),c.map((function(e,t){var a=0===t?"secondary":"primary";return r.a.createElement(y.a,{key:t,item:!0,xs:!0,className:n.noFlexGrow},r.a.createElement(Nt.a,{color:a,size:"small",label:e}))})))}))})))}));var Zc=r.a.memo((function(e){var t=e.blocked_numbers,a=e.onBlockContactClickFn;return 0===t.length?r.a.createElement("div",null,"No blocked contact"):r.a.createElement(En.a,{dense:!0,style:{paddingTop:0}},t.map((function(e){var t=e.mobile_number,n=t.mobile_id,i=t.sim_num;return r.a.createElement(hn.a,{button:!0,onClick:a(e),key:n},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,null,r.a.createElement(ql.a,null))),r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"body1",style:{marginRight:8}},"+".concat(i))))}))})))}));var Kc=r.a.memo((function(e){var t=function(e){var t=[],a=[];return e.forEach((function(e){var n=e.prefix,r=e.network_id,i="0".concat(n);1===r?a.push(i):t.push(i)})),{globe:a,smart:t}}(e.sim_prefixes),a=t.globe,n=t.smart;return r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(En.a,{dense:!0,style:{paddingTop:0}},r.a.createElement(hn.a,null,r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"h6",style:{marginRight:8}},"Smart")))})),n.map((function(e){var t="".concat(e);return r.a.createElement(hn.a,{key:e},r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"subtitle1",style:{marginRight:8}}," ",t)))}))})))),r.a.createElement(y.a,{item:!0,xs:12,md:6},r.a.createElement(En.a,{dense:!0,style:{paddingTop:0}},r.a.createElement(hn.a,null,r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"h6",style:{marginRight:8}},"Globe")))})),a.map((function(e){var t="".concat(e);return r.a.createElement(hn.a,{key:e},r.a.createElement(_n.a,{primary:r.a.createElement(y.a,{container:!0,spacing:0,justify:"flex-start",alignItems:"center"},r.a.createElement(y.a,{item:!0,xl:!0,style:{flexGrow:1}},r.a.createElement(O.a,{variant:"subtitle1",style:{marginRight:8}}," ",t)))}))})))))}));var Jc=Object(ze.a)()((function(e){var t=e.fullScreen,a=e.modalState,i=e.modalStateHandler,l=e.isMobile,c=e.contactsArray,s=e.classes,m=e.setChosenContact,u=Object(n.useContext)(qt).organizations,d=Object(n.useState)([]),p=Object(o.a)(d,2),f=p[0],b=p[1];Object(n.useEffect)((function(){var e=u.map((function(e){var t="";switch(e.scope){case 1:t="Barangay ";break;case 2:t="Municipal ";break;case 3:t="Provincial ";break;case 4:t="Regional ";break;case 5:t="National "}return{value:e.org_id,label:t+e.name.toUpperCase()}}));b(e)}),[u]);var E,v=Object(n.useState)(null),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(n.useState)(null),x=Object(o.a)(O,2),j=x[0],S=x[1],C=Object(n.useState)([]),k=Object(o.a)(C,2),A=k[0],w=k[1],D=r.a.useCallback((function(e){return function(){m(e),M()}}),[]),M=function(){i()};return Object(n.useEffect)((function(){var e=[];if(null!==j){var t=j.map((function(e){return e.value}));e=c.filter((function(e){var a=e.organizations,n=null;return 0!==a.length&&(n=a[0].organization.org_id),t.includes(n)}))}if(null!==_){var a=_.map((function(e){return e.data.site_code})),n=c;0!==e.length&&(n=e),e=[],n.forEach((function(t){t.organizations.every((function(n){var r=n.site.site_code;return!a.includes(r)||(e.push(t),!1)}))}))}e.length>0?w(e):w(null)}),[j,_]),r.a.createElement(Ne.a,{fullWidth:!0,fullScreen:t,open:a,"aria-labelledby":"form-dialog-title",TransitionComponent:t?wt:Dt},r.a.createElement(Te.a,{id:"form-dialog-title"},r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.a.createElement("span",null,"Search contacts"),r.a.createElement(G.a,{color:"inherit",onClick:i,"aria-label":"Close",style:{padding:0}},r.a.createElement(Et.a,null)))),r.a.createElement(He.a,{style:{overflowY:"auto"}},r.a.createElement(Re.a,null,"Fill in the following"),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Zt,{value:_,changeHandler:function(e){return y(e)},isMulti:!0})),r.a.createElement("div",{style:{margin:"24px 0"}},r.a.createElement(Wt,{label:"Organizations",options:f,value:j,changeHandler:(E="organizations",function(e){"sites"===E?y(e):"organizations"===E&&S(e)}),placeholder:"Select organizations",renderDropdownIndicator:!1,openMenuOnClick:!0,isMulti:!0})),null!==A?r.a.createElement(Qc,Object.assign({},e,{contacts:A,classes:s,onContactClickFn:D})):null,!l&&r.a.createElement("div",{style:{height:240}})),r.a.createElement(Fe.a,null,r.a.createElement(g.a,{onClick:i},"Close")))}));function Xc(e,t){var a=[];if("municipality"===t){var n=e.map((function(e){var t=e.municipality,a=e.province;return{id:t,label:"".concat(t,", ").concat(a)}}));a=Object(Ke.a)(n)}else if(["province","region"].includes(t)){var r=Object(Ke.a)(new Set(e.map((function(e){return e[t]})).sort())).map((function(e){return{id:e,label:e}}));a=Object(Ke.a)(r)}return a}function $c(e){var t=e.contact,a=e.chosenContact,i=e.setSlideOpen,l=e.classes,c=e.setContactFormForEdit,o=it(a.organizations,!0),s=o.sites,m=o.org,u=a.status,d=a.emails,p=a.ewi_recipient,f=a.landline_numbers,b=a.mobile_numbers;return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:2},r.a.createElement(Bl.a,null,r.a.createElement(Jl.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"h5",align:"center"},t)),r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(Fi.a,{smDown:!0,lgUp:!0},r.a.createElement(G.a,{onClick:function(){return i(!1)}},r.a.createElement(Et.a,null)))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center",paragraph:!0},"Affiliation")),null!==m?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(Nt.a,{color:"secondary",label:r.a.createElement(O.a,{variant:"body1"},m.toUpperCase())})),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"center"}},s.map((function(e){var t=e.site_code,a=nt(e,!1);return r.a.createElement(yt.a,{key:t,title:a,"aria-label":a},r.a.createElement(Nt.a,{color:"primary",label:r.a.createElement(O.a,{variant:"body2"},t.toUpperCase())}))})))):r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center",paragraph:!0},"No affiliations saved")),r.a.createElement(y.a,{item:!0,xs:12,className:l.insetDivider},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"Status"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},0===u?"Inactive":"Active")),r.a.createElement(y.a,{item:!0,xs:12,className:l.insetDivider},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},r.a.createElement("strong",null,"EWI Recipient"))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},0===p?"No":"Yes")),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Contact Information")),r.a.createElement(y.a,{item:!0,xs:12,className:l.insetDivider},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Mobile")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(En.a,{dense:!0},0===b.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No mobile numbers saved")):b.map((function(e){return r.a.createElement(hn.a,{key:e.mobile_number.mobile_id},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,null,r.a.createElement(we.a,null))),r.a.createElement(_n.a,{primary:"+".concat(e.mobile_number.sim_num)}),r.a.createElement(Bc.a,null,r.a.createElement(_n.a,{secondary:"Status: ".concat(0===e.status?"Inactive":"Active")})))})))),r.a.createElement(y.a,{item:!0,xs:12,className:l.insetDivider},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Landline")),r.a.createElement(y.a,{item:!0,xs:12},0===f.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No landline numbers saved")):r.a.createElement(En.a,{dense:!0},f.map((function(e){return r.a.createElement(hn.a,{key:e.landline_id},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,null,r.a.createElement(Fc.a,null))),r.a.createElement(_n.a,{primary:"+".concat(e.landline_num)}))})))),r.a.createElement(y.a,{item:!0,xs:12,className:l.insetDivider},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle1",align:"center"},"Email")),r.a.createElement(y.a,{item:!0,xs:12},0===d.length?r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{color:"textSecondary",variant:"body2",align:"center"},"No email addresses saved")):r.a.createElement(En.a,{dense:!0},d.map((function(e){return r.a.createElement(hn.a,{key:e.email_id},r.a.createElement(Yl.a,null,r.a.createElement(Bl.a,null,r.a.createElement(zc.a,null))),r.a.createElement(_n.a,{primary:"+".concat(e.email)}))})))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(ei.a,null),onClick:function(){return c(!0)}},"Edit")))}function eo(e){var t=e.chosenContact;if(0===t.length)return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"caption",display:"block"},"No initial blocked contact")));var a=t.mobile_number,n=t.reporter,i=t.ts,l=t.reason,c=a.sim_num,o=a.user_details,s=n.first_name,m=n.last_name,u="No contact details";if(null!==o){var d=o.user,p=d.first_name,f=d.last_name;u="".concat(f,", ").concat(p)}var b=re()(i).format("MMMM D, YYYY, HH:mm:ss");return r.a.createElement(y.a,{container:!0,spacing:1,alignItems:"center",justify:"space-evenly"},r.a.createElement(y.a,{item:!0,xs:1},r.a.createElement(Bl.a,null,r.a.createElement(Gc.a,null))),r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(O.a,{variant:"h5",align:"center"},"+".concat(c))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Details")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},u)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Reason")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},r.a.createElement("i",null,l))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body2",align:"center"},b)),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"h6",align:"center"},"Reporter")),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"body1",align:"center"},"".concat(m,", ").concat(s))),r.a.createElement(y.a,{item:!0,xs:12,style:{padding:"12px 4px"}},r.a.createElement(Oe.a,null)),r.a.createElement(y.a,{item:!0,xs:12,style:{textAlign:"right"}},r.a.createElement(g.a,{color:"secondary",variant:"contained",startIcon:r.a.createElement(Uc.a,null),disabled:!0},"Unblock (soon)")))}var to=function(e){var t=e.search_str,a=e.setSearchStr,n=e.inputProps;return r.a.createElement(b.a,{margin:"dense",hiddenLabel:!0,fullWidth:!0,variant:"outlined",placeholder:"Type contact name",InputProps:n,value:t,onChange:function(e){return a(e.target.value)}})};var ao=Object(d.a)((function(e){var t,a=Object(Q.a)(e);return Object(p.a)({},a,{tabBar:Object(p.a)({},a.pageContentMargin,{margin:0}),tabBarContent:{marginTop:16},sticky:(t={position:"sticky",top:146},Object(s.a)(t,e.breakpoints.down("sm"),{top:48}),Object(s.a)(t,"backgroundColor","white"),Object(s.a)(t,"zIndex",1),t),noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},overflow:Object(s.a)({overflowY:"auto",height:760},e.breakpoints.down("md"),{height:570}),insetDivider:{padding:"8px 70px !important"}})}))((function(e){var t=e.classes,a=Object(n.useState)([]),i=Object(o.a)(a,2),l=i[0],c=i[1],s=Object(n.useState)([]),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)({}),g=Object(o.a)(p,2),f=g[0],b=g[1],E=Object(n.useState)(!1),v=Object(o.a)(E,2),_=v[0],O=v[1],x=Object(n.useState)(!1),j=Object(o.a)(x,2),S=j[0],A=j[1],w=Object(n.useState)(!1),D=Object(o.a)(w,2),M=D[0],I=D[1],N=Object(n.useState)(!1),T=Object(o.a)(N,2),H=T[0],R=T[1],Y=Object(n.useState)(!1),B=Object(o.a)(Y,2),L=B[0],z=B[1],U=Object(n.useState)(""),W=Object(o.a)(U,2),q=W[0],V=W[1],Q=Object(n.useState)([]),Z=Object(o.a)(Q,2),K=Z[0],J=Z[1],X=Object(n.useState)([]),$=Object(o.a)(X,2),ee=$[0],te=$[1],ae=Object(n.useState)([]),ne=Object(o.a)(ae,2),re=ne[0],ie=ne[1],le=Object(n.useState)([]),ce=Object(o.a)(le,2),oe=ce[0],se=ce[1],me=Object(n.useState)([]),ue=Object(o.a)(me,2),de=ue[0],pe=ue[1],ge=Object(n.useState)([]),fe=Object(o.a)(ge,2),Ee=fe[0],ve=fe[1],he=Object(n.useState)(!1),_e=Object(o.a)(he,2),ye=_e[0],Oe=_e[1],xe=r.a.useCallback((function(e){return function(){b(e),O(!0)}}),[]),je=r.a.useCallback((function(e){return function(){te(e),O(!0)}}),[]),Se=function(e){O(e),A(e),z(!1)},Ce=function(e){z(e),A(e)},ke=Object(n.useContext)(qt),Ae=ke.setIsReconnecting,we=ke.sites;Object(n.useEffect)((function(){var e;return ac("contacts",Ae),e=function(e){c(e),e.length>0&&b(e[0]),d(e)},tc(),Zl.on("receive_all_contacts",(function(t){console.log("All Contacts",t),e(t)})),function(){Zl.removeListener("receive_all_contacts")}}),[]),Object(n.useEffect)((function(){se(Xc(we,"municipality")),pe(Xc(we,"province")),ve(Xc(we,"region"))}),[we]),Object(n.useEffect)((function(){var e=l.filter((function(e){var t=e.first_name,a=e.last_name,n="".concat(t," ").concat(a);return new RegExp("".concat(q),"gi").test(n)}));d(e)}),[q]),Object(n.useEffect)((function(){!function(e){var t="".concat(k,"/api/contacts/blocked_numbers");C.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.blocked_numbers;t&&(J(a),0!==a.length&&te(a[0]))})),function(e){var t="".concat(k,"/api/contacts/sim_prefix");C.a.get(t).then((function(t){var a=t.data;e(a)})).catch((function(e){console.error(e)}))}((function(e){var t=e.status,a=e.prefixes;t&&ie(a)}))}),[]);var De="";if(f.hasOwnProperty("user_id")){var Me=f.first_name,Ie=f.last_name;De="".concat(Me," ").concat(Ie)}var Te,He=function(e){return e?r.a.createElement(sc,{municipalities:oe,provinces:de,regions:Ee,setContactForm:Se,chosenContact:f,isEditMode:L,setContactFormForEdit:Ce,isFromChatterbox:!1}):M?r.a.createElement(eo,{chosenContact:ee}):r.a.createElement($c,{contact:De,chosenContact:f,setSlideOpen:O,classes:t,setContactFormForEdit:Ce})},Re=r.a.createElement(to,{search_str:q,setSearchStr:V,inputProps:{endAdornment:r.a.createElement(Lc.a,{position:"end"},r.a.createElement(G.a,{"aria-controls":"sortContacts","aria-haspopup":"true",onClick:function(e){Oe(!ye)},color:"primary"},r.a.createElement(Wc.a,null)))}});return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(be,{title:"Communications | Contacts"}),r.a.createElement(y.a,{container:!0,spacing:4},r.a.createElement(Fi.a,{mdUp:!0},r.a.createElement(y.a,{item:!0,xs:12,className:t.sticky,style:{paddingBottom:0}},Re)),r.a.createElement(Fi.a,{smDown:!0},r.a.createElement(y.a,{item:!0,md:4,lg:3},r.a.createElement("div",null,r.a.createElement(y.a,null,Re),r.a.createElement(En.a,{component:"nav","aria-label":"main"},r.a.createElement(hn.a,{button:!0,onClick:function(){return Se(!0)}},r.a.createElement(yn.a,null,r.a.createElement(Uc.a,null)),r.a.createElement(_n.a,{primary:"Add contact"})),r.a.createElement(hn.a,{button:!0,onClick:function(){return R(!1),void I(!M)}},r.a.createElement(yn.a,null,M?r.a.createElement(qc.a,null):r.a.createElement(ql.a,null)),M?r.a.createElement(_n.a,{primary:"Show active numbers"}):r.a.createElement(_n.a,{primary:"Show blocked numbers"})),r.a.createElement(hn.a,{button:!0,onClick:function(){return I(!1),void R(!H)}},r.a.createElement(yn.a,null,r.a.createElement(Vc.a,null)),r.a.createElement(_n.a,{primary:"Sim Prefixes"})))))),r.a.createElement(y.a,{item:!0,xs:12,md:8,lg:5},H?r.a.createElement(Kc,{sim_prefixes:re}):M?r.a.createElement(Zc,{blocked_numbers:K,onBlockContactClickFn:je}):r.a.createElement(Qc,Object.assign({},e,{contacts:u,onContactClickFn:xe,showBlockedNumbers:M}))),r.a.createElement(Fi.a,{mdDown:!0},r.a.createElement(y.a,{item:!0,lg:4},""!==De&&r.a.createElement(h.a,{elevation:1,style:{padding:16,zIndex:2},className:"".concat(t.sticky," ").concat(S&&t.overflow)},He(S))),r.a.createElement(Pc.a,{open:S,style:{zIndex:1}})),r.a.createElement(Fi.a,{smDown:!0,lgUp:!0},r.a.createElement(kt.a,{direction:"left",in:_,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement(h.a,{elevation:4,className:"".concat(t.paper," ").concat(t.overflow),style:{padding:24,zIndex:2}},He(S))),r.a.createElement(Pc.a,{open:_,style:{zIndex:1}})),r.a.createElement(Fi.a,{mdUp:!0},r.a.createElement(Ne.a,{fullScreen:!0,open:_,TransitionComponent:wt},r.a.createElement(P.a,{style:{position:"relative"}},r.a.createElement(F.a,null,r.a.createElement(G.a,{edge:"start",color:"inherit",onClick:function(){return Se(!1)},"aria-label":"close"},r.a.createElement(Et.a,null)))),r.a.createElement(h.a,{elevation:0,style:{padding:16}},He(S))))),r.a.createElement(Jc,{modalStateHandler:(Te=!1,function(){Oe(Te)}),modalState:ye,contactsArray:u,classes:t,chosenContact:f,setChosenContact:b}))})),no=a(162),ro=a(159),io=a(351),lo=a(416),co=a.n(lo),oo=Object(x.a)((function(e){var t,a=Object(Q.a)(e);return Object(p.a)({},a,{sticky:(t={position:"sticky",top:146},Object(s.a)(t,e.breakpoints.down("sm"),{top:48}),Object(s.a)(t,"backgroundColor","white"),Object(s.a)(t,"zIndex",1),t),noFlexGrow:{flexGrow:0},paper:{position:"fixed",right:0,top:116,height:"100%",width:400},insetDivider:{padding:"8px 70px !important"}})})),so={to:[],cc:[],bcc:[]};var mo=function(e){var t=oo(),a=(e.siteId,Object(n.useState)(so)),i=Object(o.a)(a,2),l=i[0],c=i[1],s=Object(n.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],f=Object(n.useState)({}),E=Object(o.a)(f,2),v=E[0],h=E[1],_=Object(n.useState)(""),O=Object(o.a)(_,2),x=O[0],j=O[1],S=Object(n.useState)(""),A=Object(o.a)(S,2),w=A[0],D=A[1],M=function(e,t){var a=l[e].push(t);c(Object(p.a)({},l,{},a))},I=function(e,t,a){var n=l[e].splice(l[e].indexOf(t),1);c(Object(p.a)({},l,{},n))};return r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(be,{title:"Communications | MailBox"}),r.a.createElement(y.a,{container:!0,spacing:4,alignItems:"center"},r.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:1,key:"sending_options"},r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Xe.a,{label:"To",value:l.to,onAdd:function(e){return M("to",e)},onDelete:function(e,t){return I("to",e)},fullWidth:!0,required:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(b.a,{label:"Subject",value:x,onChange:function(e){return j(e.target.value)},margin:"dense",fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Xe.a,{label:"Cc",value:l.cc,onAdd:function(e){return M("cc",e)},onDelete:function(e,t){return I("cc",e)},fullWidth:!0})),r.a.createElement(y.a,{item:!0,xs:12,sm:6},r.a.createElement(Xe.a,{label:"Bcc",value:l.bcc,onAdd:function(e){return M("bcc",e)},onDelete:function(e,t){return I("bcc",e)},fullWidth:!0}))),r.a.createElement(y.a,{item:!0,xs:12,key:"message_body"},r.a.createElement(Nr.a,{editor:Hr.a,data:w,config:{height:500},onInit:function(e){e.setData(w)},onChange:function(e,t){var a=t.getData();D(a)}})),r.a.createElement(y.a,{item:!0,xs:12,key:"buttons"},r.a.createElement(g.a,{color:"secondary",onClick:function(){var e=l.to,t=l.cc,a=l.bcc,n={recipients:[].concat(Object(Ke.a)(e),Object(Ke.a)(t),Object(Ke.a)(a)),subject:x,mail_body:w};console.log("payload",n),function(e,t){var a="".concat(k,"/api/mailbox/send_email");console.log(e),C.a.post(a,e).then((function(e){var a=e.data;console.log("Send email response",a),t(a)})).catch((function(e){console.error(e)}))}(n,(function(e){console.log("AXIOS Response",e),e.status?(h({text:"Email sent!",color:no.a[600]}),c(so),j(""),D("")):h({text:"Email sent!",color:ro.a[600]}),d(!0)}))}},"SEND"),r.a.createElement(g.a,{color:"primary",onClick:function(){c({to:[],cc:[],bcc:[]}),j(""),D("")}},"Discard/Reset"))),r.a.createElement(io.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:u,autoHideDuration:6e3,onClose:function(e){return d(!1)},ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},v.text),action:[r.a.createElement(G.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:function(e){return d(!1)}},r.a.createElement(co.a,null))],style:{backgroundColor:v.color}}))};var uo=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{customPaper:{padding:8,marginTop:20,textAlign:"center"},bigAvatar:{margin:10,width:60,height:60}})}));var po=function(e){var t=uo(),a=e.siteCode,i=Object(n.useState)([]),l=Object(o.a)(i,2),c=l[0],s=l[1];return Object(n.useEffect)((function(){var e,i;e=a,i=function(e){var a=function(e,t){return Object.keys(t).map((function(a,i){var l=t[a].map((function(t,a){var n=t.last_name,i=t.first_name,l=t.salutation;return r.a.createElement(y.a,{item:!0,xs:12,sm:3,justify:"center",alignItems:"center",container:!0,spacing:1,key:"staff_".concat(a+1)},r.a.createElement(Bl.a,{alt:"User",src:Ul.a,className:e.bigAvatar}),r.a.createElement(O.a,{variant:"subtitle1"},"".concat(l," ").concat(i," ").concat(n)))}));return r.a.createElement(n.Fragment,{key:"fragment_".concat(i+1)},r.a.createElement(y.a,{item:!0,xs:12,key:"org_label_".concat(i+1),style:{paddingTop:15}},r.a.createElement(O.a,{variant:"h6"},a.toUpperCase())),r.a.createElement(y.a,{item:!0,xs:12,justify:"space-evenly",alignItems:"center",container:!0,spacing:1,key:"staff_list_".concat(i+1)},l),r.a.createElement(Oe.a,{className:e.Divider}))}))}(t,e);s(a)},C.a.get("".concat(k,"/api/users/get_community_orgs_by_site/").concat(e)).then((function(e){var t=e.data;i(t)}))}),[]),r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Site Stakeholders"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},c))},go=function(e){return function(t){t.preventDefault(),e.push("/community/site_info"),e.replace("/community/site_info")}};var fo=function(e){var t=e.width,a=e.history;return Object(ie.b)(t,"sm")?r.a.createElement(g.a,{variant:"contained",color:"primary",size:"small",onClick:go(a)},r.a.createElement(Hi.a,{style:{fontSize:16}})," Back"):r.a.createElement(G.a,{variant:"contained",color:"primary",size:"small",onClick:go(a),style:{marginLeft:6}},r.a.createElement(Hi.a,null))},bo=function(){return r.a.createElement(xe.a,{height:125,width:380,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},r.a.createElement("rect",{x:"129",y:"20",rx:"3",ry:"3",width:"123",height:"44"}),r.a.createElement("rect",{x:"18",y:"80",rx:"3",ry:"3",width:"350",height:"22"}))};var Eo=Object(d.a)(Q.a)((function(e){var t=e.classes,a=e.width,i=e.match.params.site_code,l=e.siteInformation,c=Object(n.useContext)(qt).sites,s=Object(n.useState)(null),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)([]),g=Object(o.a)(p,2),f=g[0],b=g[1],E=Object(n.useState)([]),v=Object(o.a)(E,2),h=v[0],_=v[1];return Object(n.useEffect)((function(){if("undefined"===typeof l){for(var e=0;e<c.length;e+=1)if(c[e].site_code===i){d(c[e]);break}}else d(l)}),[l,c]),Object(n.useEffect)((function(){null!==u&&function(e,t){C.a.get("".concat(k,"/api/sites/get_site_season/").concat(e)).then((function(e){var a=e.data;t(a)})).catch((function(e){console.log(e)}))}(u.site_code,(function(e){var t=e.season_months,a=t.routine_schedules,n=[],r=[];a.forEach((function(e){var t=re()().isoWeekday(e.iso_week_day).format("dddd");"d"===e.season_type?n.push(t):r.push(t)})),_([{key:"dry",list:n},{key:"wet",list:r}]),delete t.routine_schedules,delete t.season_group_id;var i=[],l=[];Object.keys(t).forEach((function(e){"d"===t[e]?i.push(e):l.push(e)})),b([{key:"dry",list:i},{key:"wet",list:l}])}))}),[u]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(fo,Object.assign({},e,{width:a}))),r.a.createElement(y.a,{container:!0,spacing:2},null!==u?r.a.createElement(n.Fragment,null,r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h4"},u.site_code.toUpperCase()),r.a.createElement(O.a,{variant:"h5",color:"textSecondary"},nt(u,!1))),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(Oe.a,{className:t.divider})),r.a.createElement(y.a,{item:!0,xs:6,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Geographic Information"))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Philippine Standard",r.a.createElement("br",null),"Geographic Code"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},u.psgc)),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Region"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},u.region)),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:0},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Seasons")),f.length>0&&f.map((function(e){var t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(O.a,{variant:"subtitle1",color:"textSecondary"},rt(t)),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},a.map((function(e){return rt(e)})).join(", ")))})))),r.a.createElement(y.a,{item:!0,xs:6,container:!0,spacing:1},r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(O.a,{variant:"h6",color:"textPrimary"},r.a.createElement("strong",null,"Monitoring Information"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center",container:!0,spacing:0},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Routine Schedules")),h.length>0&&h.map((function(e){var t=e.key,a=e.list;return r.a.createElement(y.a,{item:!0,xs:6,key:t},r.a.createElement(O.a,{variant:"subtitle1",color:"textSecondary"},rt(t)),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},a.map((function(e){return rt(e)})).join(", ")))}))),r.a.createElement(y.a,{item:!0,xs:!0,align:"center"},r.a.createElement(O.a,{variant:"subtitle2",color:"textSecondary"},"Current Alert Level"),r.a.createElement(O.a,{variant:"subtitle1",color:"textPrimary"},"---"))),r.a.createElement(y.a,{item:!0,xs:12,align:"center"},r.a.createElement(po,{siteCode:u.site_code}))):r.a.createElement(y.a,{item:!0,xs:!0,style:{width:"100%"}},r.a.createElement(bo,null))))}));var vo=function(e){var t=e.siteMapData,a=[12.8797,121.774];return r.a.createElement(il.a,{style:{height:700},center:a,zoom:6},r.a.createElement(ll.a,{attribution:'\xa9 <a href="https://www.mapbox.com/about/maps/">Mapbox</a> \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',id:"mapbox.streets",url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw"}),t.map((function(e){var t=e.url,a=e.onClickHandler;return r.a.createElement(ml.a,{key:e.site_id,center:[e.latitude,e.longitude],fillColor:"green",fillOpacity:1,color:"black",weight:1,radius:4,bringToFront:!0},r.a.createElement(sl.a,null,r.a.createElement(m.b,{to:t,style:{textDecoration:"none",color:"black"},onClick:function(e){return a}},r.a.createElement("strong",null,e.site_code.toUpperCase())," ",r.a.createElement("br",null),nt(e,!1))))})))},ho=Object(x.a)((function(e){var t=Object(Q.a)(e);return Object(p.a)({},t,{centerer:{textAlign:"center"}})})),_o=function(){return r.a.createElement(xe.a,{height:300,width:684,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"110",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"210",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"310",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"410",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"510",y:"1",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"10",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"110",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"210",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"310",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"410",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"510",y:"80",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"10",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"110",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"210",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"310",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"410",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"510",y:"159",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"10",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"110",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"210",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"310",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"410",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}),r.a.createElement("rect",{x:"510",y:"238",rx:"0",ry:"0",width:"88.41",height:"63"}))},yo=function(){return r.a.createElement(xe.a,{height:300,width:684,speed:1,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:{width:"100%"}},r.a.createElement("rect",{x:"10",y:"1",rx:"0",ry:"0",width:"561",height:"700"}))};var Oo=Object(ie.a)()((function(e){var t=ho(),a=e.width,i=e.location,l=e.match.url,c=Object(n.useContext)(qt).sites,s=Object(n.useState)(null),d=Object(o.a)(s,2),g=d[0],f=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),v=E[0],h=E[1],_=Object(n.useState)(null),x=Object(o.a)(_,2),j=x[0],S=x[1];return Object(n.useEffect)((function(){var e=function(e,t,a){return e.map((function(e,n){var i=e.site_code;return r.a.createElement(y.a,{item:!0,xs:4,sm:3,lg:2,key:"card_grid_".concat(n+1)},r.a.createElement(m.b,{to:"".concat(t,"/").concat(i),style:{textDecoration:"none",color:"black"},onClick:function(t){return a(e)}},r.a.createElement(Na.a,{className:"alert-card"},r.a.createElement(Ta.a,null,r.a.createElement(Ha.a,{style:{paddingBottom:16}},r.a.createElement(O.a,{variant:"h5",component:"h2",align:"center"},i.toUpperCase()))))))}))}(c,l,f);h(e);var t=function(e,t,a){return e.map((function(e,n){return Object(p.a)({},e,{url:"".concat(t,"/").concat(e.site_code),onClickHandler:a(e)})}))}(c,l,f);S(t)}),[c]),r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(be,{title:"Community | Site Information"})),r.a.createElement("div",{className:t.pageContentMargin},r.a.createElement(u.d,{location:i},r.a.createElement(u.b,{exact:!0,path:l,render:function(e){return r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{item:!0,xs:12,sm:6},null===j?r.a.createElement(yo,null):r.a.createElement(vo,{siteMapData:j})),r.a.createElement(y.a,{item:!0,xs:12,sm:6,container:!0,spacing:1},null===v?r.a.createElement(_o,null):v))}}),r.a.createElement(u.b,{path:"".concat(l,"/:site_code"),render:function(e){return r.a.createElement(Eo,Object.assign({},e,{width:a,siteInformation:g}))}}))))}));var xo=function(e){var t=e.location,a=e.match.url;return r.a.createElement(u.d,{location:t},r.a.createElement(u.b,{exact:!0,path:a,component:ar}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/events"),component:xr}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/shifts_and_reports"),component:Xr}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/issues_and_reminders"),component:fi}),r.a.createElement(u.b,{path:"".concat(a,"monitoring/logs"),component:mi}),r.a.createElement(u.b,{path:"".concat(a,"monitoring"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(u.b,{path:"".concat(a,"analysis/sites"),component:Nl}),r.a.createElement(u.b,{path:"".concat(a,"analysis"),render:function(){return r.a.createElement("h3",null," Not yet created")}}),r.a.createElement(u.b,{path:"".concat(a,"communication/chatterbox"),component:Yc}),r.a.createElement(u.b,{path:"".concat(a,"communication/contacts"),component:ao}),r.a.createElement(u.b,{path:"".concat(a,"communication/mailbox"),component:mo}),r.a.createElement(u.b,{path:"".concat(a,"communication"),render:function(){return r.a.createElement("h3",null,"Sorry. We could not find what you are looking for.")}}),r.a.createElement(u.b,{path:"".concat(a,"community/site_info"),component:Oo}),r.a.createElement(u.b,{render:function(){return r.a.createElement("h3",null," Not found")}}))};var jo=function(e){var t=e.match.params,a=t.site_code,i=t.ts_end,l=t.chart_type,s=t.tsm_sensor,m=Object(n.useState)(""),u=Object(o.a)(m,2),d=u[0],p=u[1],g=Object(n.useState)(""),f=Object(o.a)(g,2),b=f[0],E=f[1],v=Object(n.useState)(""),h=Object(o.a)(v,2),_=h[0],y=h[1],O=Object(c.useSnackbar)().enqueueSnackbar,j=I(),S=Object(x.a)((function(e){return Object(Q.a)(e)}))();Object(n.useEffect)((function(){O("Please wait for the charts to load before closing the page. If loading took long enough, please wait for about a minute and check your connection before trying again. If loading problem persist, contact the developers.",{variant:"warning",autoHideDuration:1e4,style:{whiteSpace:"pre-line"},anchorOrigin:{vertical:"top",horizontal:"center"}});var t,n={site_code:a,ts_end:i};"rainfall"===l?(t=r.a.createElement(qi,Object.assign({},e,{input:n,currentUser:j,disableBack:!0,saveSVG:!0})),p(t)):"surficial"===l?(t=r.a.createElement(Pi,Object.assign({},e,{input:n,currentUser:j,disableBack:!0,disableMarkerList:!0,isEndOfShift:!0,saveSVG:!0})),E(t)):"subsurface"===l&&(n.tsm_sensor=s,t=r.a.createElement(Xi,Object.assign({},e,{input:n,currentUser:j,disableBack:!0,saveSVG:!0})),y(t))}),[]);var C=rt(l);return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:S.pageContentMargin},r.a.createElement(be,{title:"Chart Rendering | ".concat(a.toUpperCase()," | ").concat(C)})),r.a.createElement("div",{className:S.pageContentMargin},d,b,_))};var So=Object(d.a)((function(e){var t;return{app:{height:"100%",minHeight:"85vh",display:"flex",flexDirection:"column",justifyContent:"space-between"},body:(t={marginTop:60},Object(s.a)(t,e.breakpoints.up("sm"),{marginTop:70}),Object(s.a)(t,e.breakpoints.up("md"),{marginTop:124}),t)}}))((function(e){var t=e.classes;Object(n.useEffect)((function(){document.title="MIA 3.0 - Dynaslope Monitoring and Information Application"}),[]);var a=Object(n.useState)(!1),i=Object(o.a)(a,2),l=i[0],c=i[1],s=function(e){return function(){c(e)}},d=Object(n.useState)(null),p=Object(o.a)(d,2),g=p[0],f=p[1],b=Object(n.useRef)(!1);Object(n.useEffect)((function(){return w((function(e){f(e),e&&(b.current=setInterval(D,15e5))})),function(){return clearInterval(b.current)}}),[]);var E=function(){f(!0),b.current=setInterval(D,15e5)},v=function(){f(!1),clearInterval(b.current)};return r.a.createElement(m.a,null,r.a.createElement(u.d,null,r.a.createElement(u.b,{path:"/bulletin/:release_id",component:gt}),r.a.createElement(u.b,{path:"/chart_rendering/:site_code/:ts_end/:chart_type/:tsm_sensor?",component:jo}),r.a.createElement(u.b,{exact:!0,path:"/login",render:function(e){return null===g?r.a.createElement("div",null,"Loading..."):g?r.a.createElement(u.a,{to:"/"}):r.a.createElement(L,Object.assign({},e,{onLogin:E}))}}),r.a.createElement(u.b,{path:"/",render:function(e){return null===g?r.a.createElement("div",null,"Loading..."):g?r.a.createElement(Vt,null,r.a.createElement(Sa,null,r.a.createElement(K,Object.assign({},e,{drawerHandler:s,onLogout:v})),r.a.createElement(de,{drawerHandler:s,drawer:l}),r.a.createElement("div",{className:t.app},r.a.createElement("div",{className:t.body},r.a.createElement(xo,e))),r.a.createElement(z,null))):r.a.createElement(u.a,{to:"/login"})}})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Co(){}console.log=Co,console.warn=Co,console.error=Co,l.a.render(r.a.createElement(c.SnackbarProvider,{maxSnack:3,anchorOrigin:{vertical:"bottom",horizontal:"right"}},r.a.createElement(So,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[427,1,2]]]);
//# sourceMappingURL=main.dd2f2572.chunk.js.map